!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("G6"),require("React"),require("_")):"function"==typeof define&&define.amd?define(["G6","React","_"],e):"object"==typeof exports?exports.Graphin=e(require("G6"),require("React"),require("_")):t.Graphin=e(t.G6,t.React,t._)}(self,(function(t,e,i){return(()=>{"use strict";var s={835:e=>{e.exports=t},24:t=>{t.exports=e},479:t=>{t.exports=i}},o={};function n(t){var e=o[t];if(void 0!==e)return e.exports;var i=o[t]={exports:{}};return s[t](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{n.r(a),n.d(a,{Behaviors:()=>b,Components:()=>ht,G6:()=>j(),GraphinContext:()=>r,Utils:()=>Q,default:()=>ke,registerFontFamily:()=>Ce,useBehaviorHook:()=>l});var t={};n.r(t),n.d(t,{handleAutoZoom:()=>ft,handleChangeZoom:()=>gt,handleRealZoom:()=>yt,handleZoomIn:()=>ut,handleZoomOut:()=>pt});var e={};n.r(e),n.d(e,{focusNodeById:()=>vt,highlightNodeById:()=>mt});var i=n(479),s=n(24),o=n.n(s);const r=o().createContext({graph:{},apis:{},theme:{},layout:{}});const l=t=>{const{type:e,defaultConfig:s,userProps:n,mode:a="default"}=t,{graph:l}=o().useContext(r),{disabled:d}=n,c=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i}(n,["disabled"]);o().useEffect((()=>{if(l&&!l.destroyed&&!(0,i.isEmpty)(l)&&(l.removeBehaviors(e,a),!d))return l.addBehaviors(Object.assign(Object.assign({type:e},s),c),a),()=>{l.destroyed||l.removeBehaviors(e,a)}}),[])},d={disabled:!1,trigger:"mouseenter",activeState:"active",inactiveState:"inactive",resetSelected:!1},c={disabled:!1,brushStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},onSelect:()=>{},onDeselect:()=>{},selectedState:"selected",trigger:"shift",includeEdges:!0,includeCombos:!1},h={disabled:!1,multiple:!0,trigger:"shift",selectedState:"selected",selectNode:!0,selectEdge:!1,selectCombo:!0},p={direction:"both",enableOptimize:!1,scalableRange:0,shouldBegin:()=>!0,disabled:!1},u={disabled:!1,enableDelegate:!1,delegateStyle:{},onlyChangeComboSize:!1,activeState:"",selectedState:"selected"},g={disabled:!1,updateEdge:!0,delegateStyle:{},enableDelegate:!1,onlyChangeComboSize:!1,comboActiveState:"",selectedState:"selected"},y=t=>{const{graph:e,layout:i,dragNodes:n,updateContext:a}=o().useContext(r),{autoPin:l,pinAction:d,dragNodeMass:c=1e10}=t,{instance:h}=i;return(0,s.useEffect)((()=>{var t;const{simulation:i,type:s}=h||{type:null===(t=e.get("layout"))||void 0===t?void 0:t.type},o=()=>{var t;i?i.stop():((null===(t=e.get("layoutController"))||void 0===t?void 0:t.layoutMethods)||[]).forEach((t=>{var e;return null===(e=t.stop)||void 0===e?void 0:e.call(t)}))},r=t=>{if(("graphin-force"===s||"force2"===s)&&t.item){const i=t.item.get("model");i.layout=Object.assign(Object.assign({},i.layout),{force:{mass:l?c:null}});const s=[];e.getNodes().forEach((t=>{if(t.hasState("selected")){const e=t.get("model");e.layout||(e.layout={}),e.layout.force={mass:l?c:null},s.push(e)}}));let o=n.concat([i]);s.length>1&&(o=o.concat(s)),a({dragNodes:o})}};return e.on("node:dragstart",o),e.on("node:dragend",r),()=>{e.off("node:dragstart",o),e.off("node:dragend",r)}}),[e,l,h,n,a]),(0,s.useEffect)((()=>{const{id:t,pinned:i}=d||{};if(!t)return;let s=n;if(i){const i=e.findById(t);if(!i)return;const o=i.get("model");o.layout||(o.layout={}),o.layout.force={mass:l?c:null},s.push(o)}else s=n.filter((e=>e.id!==t));a({dragNodes:s})}),[d]),null};y.defaultProps={autoPin:!1,dragNodeMass:1e10,pinAction:void 0};const f={disabled:!1,delegateStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},onSelect:()=>{},onDeselect:()=>{},selectedState:"selected",trigger:"shift",includeEdges:!0};const m={trigger:"click"},v={sensitivity:2,minZoom:void 0,maxZoom:void 0,enableOptimize:!1,optimizeZoom:.1,fixSelectedItems:{fixAll:!1,fixLineWidth:!1,fixLabel:!1,fixState:"selected"},disabled:!1,animate:!1,animateCfg:{duration:500}},b={DragCanvas:t=>(l({type:"drag-canvas",userProps:t,defaultConfig:p}),null),ZoomCanvas:t=>(l({type:"zoom-canvas",userProps:t,defaultConfig:v}),null),ClickSelect:t=>(l({type:"click-select",userProps:t,defaultConfig:h}),null),BrushSelect:t=>(l({type:"brush-select",userProps:t,defaultConfig:c}),null),DragNode:t=>(l({type:"drag-node",userProps:t,defaultConfig:g}),null),ResizeCanvas:t=>{const{graphDOM:e}=t,o=s.useContext(r);return s.useEffect((()=>{const{graph:t}=o,s=(0,i.debounce)((()=>{const{clientWidth:i,clientHeight:s}=e;t.set("width",i),t.set("height",s);const o=t.get("canvas");o&&(o.changeSize(i,s),t.autoPaint())}),200);return window.addEventListener("resize",s,!1),()=>{window.removeEventListener("resize",s,!1)}}),[]),null},LassoSelect:t=>(l({type:"lasso-select",userProps:t,defaultConfig:f}),null),DragCombo:t=>(l({type:"drag-combo",userProps:t,defaultConfig:u}),null),ActivateRelations:t=>(l({type:"activate-relations",userProps:t,defaultConfig:d}),null),TreeCollapse:t=>{const{onChange:e}=t,i=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i}(t,["onChange"]),{graph:o}=s.useContext(r);return l({defaultConfig:m,userProps:i,type:"collapse-expand"}),s.useEffect((()=>{const t=t=>{const{item:i,collapsed:s}=t;i.get("model").collapsed=s,e&&e(i,s)};return o.on("itemcollapsed",t),()=>{o.off("itemcollapsed",t)}}),[]),null},FitView:t=>{const{padding:e,isBindLayoutChange:i}=t,{graph:n}=o().useContext(r);return(0,s.useEffect)((()=>{const t=()=>{n.fitView(e)};return t(),i&&n.on("afterlayout",t),()=>{i&&n.off("afterlayout",t)}}),[]),null},FontPaint:()=>{const{graph:t}=o().useContext(r);return o().useEffect((()=>{const e=setTimeout((()=>{t.getNodes().forEach((e=>{t.setItemState(e,"normal",!0)})),t.paint()}),1600);return()=>{clearTimeout(e)}}),[]),null},DragNodeWithForce:y,Hoverable:t=>{const e=s.useContext(r),{bindType:i="node",disabled:o}=t,{graph:n}=e;return s.useEffect((()=>{if(o)return;const t=t=>{n.setItemState(t.item,"hover",!0)},e=t=>{n.setItemState(t.item,"hover",!1)},s=t=>{n.setItemState(t.item,"hover",!0)},a=t=>{n.setItemState(t.item,"hover",!1)};return"node"===i&&(n.on("node:mouseenter",t),n.on("node:mouseleave",e)),"edge"===i&&(n.on("edge:mouseenter",s),n.on("edge:mouseleave",a)),()=>{"node"===i&&(n.off("node:mouseenter",t),n.off("node:mouseleave",e)),"edge"===i&&(n.off("edge:mouseenter",s),n.off("edge:mouseleave",a))}}),[n,o]),null}},x=t=>{const{bindType:e="node",container:i,disableAutoAdjust:n}=t,{graph:a}=o().useContext(r),[l,d]=o().useState({visible:!1,x:0,y:0,item:null,selectedItems:[]}),c=t=>{t.preventDefault(),t.stopPropagation();const s=a.get("width"),o=a.get("height");if(!i.current)return;const r=i.current.getBoundingClientRect(),l=a.get("offsetX")||0,c=a.get("offsetY")||0,h=a.getContainer().offsetTop,p=a.getContainer().offsetLeft;let u=t.canvasX+p+l,g=t.canvasY+h+c;if(n||(u+r.width>s&&(u=t.canvasX-r.width-l+p),g+r.height>o&&(g=t.canvasY-r.height-c+h)),"node"===e){const{x:e,y:i}=t.item&&t.item.getModel(),s=a.getCanvasByPoint(e,i),o=t.canvasX-s.x,n=t.canvasY-s.y;u-=o,g-=n}d((e=>Object.assign(Object.assign({},e),{visible:!0,x:u,y:g,item:t.item})))},h=()=>{d((t=>t.visible?Object.assign(Object.assign({},t),{visible:!1,x:0,y:0}):t))};(0,s.useEffect)((()=>{const t=t=>{d((e=>Object.assign(Object.assign({},e),{selectedItems:t.selectedItems})))};return a.on(`${e}:contextmenu`,c),a.on("canvas:click",h),a.on("canvas:drag",h),a.on("wheelzoom",h),"canvas"===e&&a.on("nodeselectchange",t),()=>{a.off(`${e}:contextmenu`,c),a.off("canvas:click",h),a.off("canvas:drag",h),a.off("wheelzoom",h),a.off("nodeselectchange",t)}}),[a,e]);const{x:p,y:u,visible:g,item:y,selectedItems:f}=l;return{oneShow:c,onClose:h,item:y,selectedItems:f,visible:g,x:p,y:u}},O={width:"120px",boxShadow:"0 4px 12px rgb(0 0 0 / 15%)"},w=o().createRef();var S=n(835),j=n.n(S);const E={r:249,scaleRByWheel:!0,minR:100,maxR:500,delegateStyle:{stroke:"#000",strokeOpacity:.8,lineWidth:2,fillOpacity:.1,fill:"#ccc"},showLabel:!1};var C=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};const k={members:[],type:"round-convex",nonMembers:[],style:{fill:"lightblue",stroke:"blue",opacity:.2},padding:10},N=(t,e)=>{const{style:i={}}=t,s=C(t,["style"]),{style:o={}}=e,n=C(e,["style"]);return Object.assign(Object.assign(Object.assign({},s),n),{style:Object.assign(Object.assign({},i),o)})};let M;const P=[{type:"graphin-force",options:{},title:"渐进力导"},{type:"force",title:"D3力导",options:{preventOverlap:!0,linkDistance:250,nodeStrength:30,edgeStrength:.1,collideStrength:.8,nodeSize:30,alpha:.3,alphaDecay:.028,alphaMin:.01,forceSimulation:null,clustering:!1}},{type:"concentric",title:"同心圆布局",options:{minNodeSpacing:60,preventOverlap:!0,nodeSize:60}},{type:"grid",options:{},title:"网格布局"},{type:"radial",options:{},title:"辐射布局"},{type:"dagre",title:"层次布局",options:{}},{type:"circular",options:{},title:"环形布局"},{type:"gForce",options:{linkDistance:()=>200,preventOverlap:!0},title:"G6力导"},{type:"mds",options:{},title:"降维布局"},{type:"random",options:{},title:"随机布局"}],D=P.map((t=>{const{type:e,options:i}=t;return Object.assign({type:e},i)})).reduce(((t,e)=>Object.assign(Object.assign({},t),{[e.type]:e})),{}),L=()=>({type:"circle",style:{labelCfg:{position:"top"}},status:{}}),_={primaryEdgeColor:"#ddd",edgeSize:1,mode:"light"},T=t=>{const{edgeSize:e,primaryEdgeColor:i,mode:s}=Object.assign(Object.assign({},_),t),o={light:{stroke:i,label:i,disabled:"#ddd"},dark:{stroke:i,label:i,disabled:"#ddd3"}}[s];return{type:"graphin-line",style:{keyshape:{type:"line",lineWidth:e,stroke:o.stroke,strokeOpacity:1,lineAppendWidth:9,cursor:"pointer"},halo:{visible:!1,cursor:"pointer",strokeOpacity:.4},label:{value:"",position:"top",fill:o.label,fontSize:12,textAlign:"center"},animate:{}},status:{hover:{halo:{visible:!0}},selected:{halo:{visible:!0},keyshape:{lineWidth:2},label:{visible:!0}},active:{halo:{visible:!0},keyshape:{lineWidth:2},label:{visible:!0}},inactive:{halo:{visible:!1},keyshape:{strokeOpacity:.1},label:{visible:!1}},disabled:{halo:{visible:!1},keyshape:{lineWidth:.5,stroke:o.disabled},label:{visible:!1}}}}},I={primaryColor:"#FF6A00",nodeSize:26,mode:"light"},A=t=>{const{nodeSize:e,primaryColor:i,mode:s}=Object.assign(Object.assign({},I),t),o={light:{fill:i,fillOpacity:.1,stroke:i,strokeOpacity:1,icon:i,badge:{fill:i,stroke:i,font:"#fff"},label:"#000",disabled:"#ddd"},dark:{fill:i,fillOpacity:.3,stroke:i,strokeOpacity:1,icon:"#fff",badge:{fill:i,stroke:i,font:"#fff"},label:"#fff",disabled:"#ddd3"}}[s];return{type:"graphin-circle",style:{keyshape:{size:e,fill:o.fill,fillOpacity:o.fillOpacity,stroke:o.stroke,strokeOpacity:o.strokeOpacity,lineWidth:1,opacity:1,type:"circle"},label:{position:"bottom",value:"",fill:o.label,fontSize:12,offset:0,background:void 0,fillOpacity:1},icon:{type:"text",value:"",size:e/2,fill:o.icon,fillOpacity:1,offset:[0,0]},badges:[],halo:{visible:!1,fillOpacity:.1}},status:{normal:{},selected:{halo:{visible:!0},keyshape:{lineWidth:5}},hover:{halo:{visible:!0}},active:{},inactive:{keyshape:{fillOpacity:.04,strokeOpacity:.04},icon:{fillOpacity:.04},label:{fillOpacity:.04}},disabled:{halo:{visible:!1},keyshape:{fill:o.disabled,stroke:o.disabled},icon:{fill:o.disabled},label:{fill:o.disabled}}}}},$=t=>Array.from(String(t)).reduce(((t,e)=>e.charCodeAt(0)>255?t+2:t+1),0),z=t=>Math.floor(Math.random()*t),F={},B=t=>"#"===t.charAt(0)?t.slice(1):t,R=t=>{const e=3===t.length||4===t.length;return{r:e?`${t.slice(0,1)}${t.slice(0,1)}`:t.slice(0,2),g:e?`${t.slice(1,2)}${t.slice(1,2)}`:t.slice(2,4),b:e?`${t.slice(2,3)}${t.slice(2,3)}`:t.slice(4,6),a:(e?`${t.slice(3,4)}${t.slice(3,4)}`:t.slice(6,8))||"ff"}},W=t=>parseInt(t,16),G=({r:t,g:e,b:i,a:s})=>({r:W(t),g:W(e),b:W(i),a:+(W(s)/255).toFixed(2)});class q{constructor(t){this.nodeIds=[],this.bfs=t=>{var e;if(!this.root)return;const i=[];for(i.push(this.root);i.length;){const s=i.shift();if(t(s))return s;(null===(e=null==s?void 0:s.children)||void 0===e?void 0:e.length)&&i.push(...s.children)}},this.getRoot=()=>this.root,this.getNode=t=>this.bfs((e=>e.id===t)),this.addRoot=(t,e)=>{this.root={id:t,children:[]},this.nodeIds.push(t)},this.addNode=t=>{const{parentId:e,id:i,data:s}=t;if(!this.root)return void this.addRoot(i,s);let o;if(e)o=this.getNode(e);else{const t=Math.floor(Math.random()*this.nodeIds.length);o=this.getNode(this.nodeIds[t])}o?(this.nodeIds.push(i),o.children.push({id:i,parent:o,children:[]})):console.error("Parent node doesn't exist!")},t&&(this.root=t)}}const H=(t,e)=>{e(t),t.children&&t.children.length>0&&t.children.forEach((t=>{H(t,e)}))},Z=H,V={nodeCount:10,nodeType:"company"};class U{constructor(t){this.initNodes=()=>{const{nodeCount:t,nodeType:e}=this.options,i=Array.from({length:t});this.nodes=i.map(((t,i)=>({id:`node-${i}`,label:`node-${i}`,type:e})));for(let e=0;e<t;e+=1)for(let i=0;i<t-1;i+=1)this.edges.push({source:`node-${e}`,target:`node-${i}`});this.nodeIds=this.nodes.map((t=>t.id))},this.expand=t=>(this.edges=[],this.nodes=[],t.forEach((t=>{for(let e=0;e<this.options.nodeCount;e+=1)this.nodes.push({id:`${t.id}-${e}`,type:t.type}),this.edges.push({source:`${t.id}-${e}`,target:t.id})})),this),this.type=t=>(this.nodes=this.nodes.map((e=>Object.assign(Object.assign({},e),{type:t}))),this),this.circle=(t="")=>{let e=t;return-1===this.nodeIds.indexOf(e)&&(e="node-0"),this.edges=this.edges.filter((t=>t.source===e||t.target===e)),this},this.random=(t=.5)=>{const{nodeCount:e}=this.options,i=parseInt(String(e*t)),s=this.nodeIds.sort((()=>Math.random()-.5)).slice(0,i);return this.edges=this.edges.filter((t=>-1!==s.indexOf(t.target))),this.edges=this.edges.sort((()=>Math.random()-.5)).slice(0,i),this},this.tree=()=>{this.edges=[],this.treeData=new q;const t=this.nodeIds[0];return this.nodeIds.forEach((t=>{this.treeData.addNode({id:t,style:{label:{value:t}}})})),this.treeData.bfs((e=>{var i;return e.id!==t&&this.edges.push({source:null===(i=null==e?void 0:e.parent)||void 0===i?void 0:i.id,target:e.id,properties:[]}),!1})),this},this.value=()=>({nodes:this.nodes,edges:this.edges}),this.combos=t=>{const e=new Set;return this.nodes=this.nodes.map(((i,s)=>{const o=`combo-${Math.ceil((s+1)/t)}`;return e.add(o),Object.assign(Object.assign({},i),{comboId:o})})),this.combosData=[...e].map((t=>({id:t,label:t}))),this},this.graphin=()=>({nodes:this.nodes.map((t=>Object.assign(Object.assign({},t),{id:t.id,type:"graphin-circle",comboId:t.comboId,style:{label:{value:`${t.id}`}}}))),edges:this.edges.map((t=>({source:t.source,target:t.target}))),combos:this.combosData}),this.graphinTree=()=>{const t=this.treeData.getRoot();return Z(t,(t=>{delete t.parent})),t},this.options=V,this.options.nodeCount=t,this.nodes=[],this.edges=[],this.nodeIds=[],this.treeData=new q,this.initNodes()}}function X(t){return t%2==0}const Y=(t,e)=>e.split(".").reduce(((t,e,i,s)=>{const o=t[e];return o||i===s.length-1?o:{}}),t),K=t=>()=>{console.error(`⚠️ @antv/graphin Utils 不再提供 ${t} 方法，请从 lodash 中引入！`),console.error(`⚠️ @antv/graphin Utils no longer provides ${t} methods, please use lodash instead!`)},Q={hexToRgba:(t,e)=>{const i=B(t),s=R(i);return((t,e)=>{const{r:i,g:s,b:o,a:n}=t;var a;return`rgba(${i}, ${s}, ${o}, ${a=e,!isNaN(parseFloat(String(a)))&&isFinite(Number(a))?e:n})`})(G(s),e)},debug:t=>(F[t]||(F[t]=((t=1)=>`rgba(${z(255)},${z(255)},${z(255)},${t})`)()),F[t],(...t)=>{}),mock:t=>new U(t),shallowEqual:(t,e)=>{let i=!0;const s=Object.keys(t),o=Object.keys(e);if(s.length!==o.length)return!1;for(let o=0;o<s.length;o++){const n=s[o];if(t[n]!==e[n]){i=!1;break}}return i},hexToRgbaToHex:(t,e=1)=>{const i=B(t),s=R(i),o=G(s),{r:n,g:a,b:r}=o;let l=n.toString(16),d=a.toString(16),c=r.toString(16),h=Math.round(255*Number(e)).toString(16);return 1===l.length&&(l=`0${l}`),1===d.length&&(d=`0${d}`),1===c.length&&(c=`0${c}`),1===h.length&&(h=`0${h}`),`#${l}${d}${c}${h}`},getNodeStyleByTheme:A,getEdgeStyleByTheme:T,getComboStyleByTheme:L,deepMix:K("deepMix"),cloneDeep:K("cloneDeep"),uuid:()=>{function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return`${t()+t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`},walk:Z,processEdges:(t,{poly:e=30,loop:s=10,loopLabelPosition:o=1}={poly:30,loop:10,loopLabelPosition:1})=>{const n={};t.forEach(((t,e)=>{const i=Object.assign({},t),{source:s,target:o}=i,a=`${s}-${o}`;i.id=i.id||`${s}-${o}-${e}`;const r=`${o}-${s}`;n[a]?n[a].push(i):n[r]?(i.revert=!0,n[r].push(i)):n[a]=[i]}));const a=Object.values(n),r=[];return a.forEach((t=>{if(t.length>1){const n=X(t.length);t.forEach(((t,a)=>{var l;const{source:d,target:c}=t,h=d===c,p=a;let u;if(n){const t=Math.ceil((p+1)/2);u=e*t}else{const t=X(p)?p:p+1,i=Math.ceil(t/2);u=e*i}let g,y=X(p)?u:-u;if(t.revert&&(y=-y,delete t.revert),h){const e=p*s;if(g={type:"loop",loop:{distance:e}},null===(l=t.style)||void 0===l?void 0:l.label){const i=0,s=-(30*o+2*e);t.style.label.offset=[i,s]}}else g={type:"poly",poly:{distance:y}};(0,i.merge)(t,{style:{keyshape:g}}),t.isMultiple=!0,r.push(t)}))}else r.push(t[0])})),r},calcByteLength:$,layouts:P,uniqBy:K("uniqBy"),getEnumDataMap:(t,e)=>{const i=new Map;return t.forEach((t=>{const s=Y(t,e),o=i.get(s);o?i.set(s,[...o,t]):i.set(s,[t])})),i},getEnumValue:Y},{getEnumValue:J,getEnumDataMap:tt}=Q,et=({bindType:t="node",sortKey:e})=>{const i=o().useContext(r),{graph:s}=i,n=s.save();if(n.children)return console.error("not support tree graph"),{dataMap:new Map,options:{}};const a=tt(n[`${t}s`],e),l=[...a.keys()].map((t=>{const e=(a.get(t)||[{}])[0],i=J(e,"style.keyshape.fill"),s=J(e,"style.color");return{color:i||s,value:t,label:t,checked:!0}}));return{dataMap:a,options:l}},it={position:"absolute",top:"0px",right:"0px"},st=t=>{const{bindType:e="node",sortKey:i,children:s,style:n}=t,{dataMap:a,options:r}=et({bindType:e,sortKey:i});return o().createElement("div",{className:"graphin-components-legend",style:Object.assign(Object.assign({},it),n)},s({bindType:e,sortKey:i,dataMap:a,options:r}))};st.Node=t=>{const{graph:e,theme:i}=o().useContext(r),{options:n,dataMap:a,onChange:l}=t,{mode:d}=i,[c,h]=o().useState({options:n});(0,s.useEffect)((()=>{h({options:n})}),[n]);const{options:p}=c,u=t=>{const i=Object.assign(Object.assign({},t),{checked:!t.checked}),s=p.map((e=>e.value===t.value?i:e));h({options:s}),a.get(i.value).forEach((t=>{e.setItemState(t.id,"active",i.checked),e.setItemState(t.id,"inactive",!i.checked);const{id:s}=t;e.findById(s).getEdges().forEach((t=>{e.setItemState(t,"normal",i.checked),e.setItemState(t,"inactive",!i.checked)}))})),l(i,s)};return o().createElement("ul",{className:"graphin-components-legend-content"},p.map((t=>{const{label:e,checked:i,color:s}=t,n={light:{active:s,inactive:"#ddd"},dark:{active:s,inactive:"#2f2f2f"}},a=i?"active":"inactive";return o().createElement("li",{key:t.value,className:"item",onClick:()=>{u(t)},onKeyDown:()=>{u(t)}},o().createElement("span",{className:"dot",style:{background:n[d][a]}}),o().createElement("span",{className:"label",style:{color:{light:{active:"#000",inactive:"#ddd"},dark:{active:"#fff",inactive:"#2f2f2f"}}[d][a]}},e))})))};const ot=st,nt={className:"graphin-minimap",viewportClassName:"graphin-minimap-viewport",type:"default",padding:50,size:[200,120],delegateStyle:{fill:"#40a9ff",stroke:"#096dd9"},refresh:!0},at={position:"absolute",bottom:0,left:0,background:"#fff",boxShadow:"0px 8px 10px -5px rgba(0,0,0,0.2), 0px 16px 24px 2px rgba(0,0,0,0.14), 0px 6px 30px 5px rgba(0,0,0,0.12)"},rt={line:{stroke:"#FA8C16",lineWidth:.5},itemAlignType:"center"},lt=t=>{const{bindType:e="node",container:i}=t,n=o().useContext(r),{graph:a}=n,l=(0,s.useRef)(),[d,c]=o().useState({visible:!1,x:0,y:0,item:null}),h=i=>{i.preventDefault(),i.stopPropagation(),l.current&&window.clearTimeout(l.current);const s=a.getPointByClient(i.clientX,i.clientY);let{x:o,y:n}=a.getCanvasByPoint(s.x,s.y);if("node"===e&&i.item){const{x:t=0,y:e=0}=i.item.getModel(),s=a.getCanvasByPoint(t,e),r=i.canvasX-s.x,l=i.canvasY-s.y;o-=r,n-=l}l.current=window.setTimeout((()=>{c((t=>Object.assign(Object.assign({},t),{visible:!0,item:i.item,x:o,y:n})))}),t.delay.show)},p=()=>{l.current&&window.clearTimeout(l.current),l.current=window.setTimeout((()=>{c((t=>Object.assign(Object.assign({},t),{visible:!1,item:null,x:0,y:0})))}),t.delay.hide)},u=()=>{c(Object.assign(Object.assign({},d),{visible:!1,x:0,y:0,item:null}))},g=t=>{const i=a.getPointByClient(t.clientX,t.clientY);let{x:s,y:o}=a.getCanvasByPoint(i.x,i.y);if("node"===e){if(t.item){const{x:e=0,y:i=0}=t.item.getModel(),n=a.getCanvasByPoint(e,i);s-=t.canvasX-n.x,o-=t.canvasY-n.y}c(Object.assign(Object.assign({},d),{visible:!0,x:s,y:o,item:t.item}))}},y=()=>{clearTimeout(l.current)};return(0,s.useEffect)((()=>{var t,s;return a.on(`${e}:mouseenter`,h),a.on(`${e}:mouseleave`,p),a.on("afterremoveitem",p),a.on("node:dragstart",u),a.on("node:dragend",g),null===(t=i.current)||void 0===t||t.addEventListener("mouseenter",y),null===(s=i.current)||void 0===s||s.addEventListener("mouseleave",p),()=>{var t,s;console.log("effect..remove...."),a.off(`${e}:mouseenter`,h),a.off(`${e}:mouseleave`,p),a.off("afterremoveitem",p),a.off("node:dragstart",u),a.off("node:dragend",g),null===(t=i.current)||void 0===t||t.removeEventListener("mouseenter",y),null===(s=i.current)||void 0===s||s.removeEventListener("mouseleave",p)}}),[]),Object.assign({},d)},dt={width:"120px",boxShadow:"0 4px 12px rgb(0 0 0 / 15%)"},ct=o().createRef(),ht={ContextMenu:t=>{const{bindType:e,children:i,style:s,disableAutoAdjust:n}=t,a=x({bindType:e,container:w,disableAutoAdjust:n}),{visible:r,x:l,y:d,item:c}=a,h={position:"absolute",left:l,top:d};if("function"!=typeof i)return console.error("<ContextMenu /> children should be a function"),null;const p=c&&!c.destroyed&&c.getModel&&c.getModel().id||"";return o().createElement("div",{ref:w,className:"graphin-components-contextmenu",style:Object.assign(Object.assign(Object.assign({},O),s),h),key:p},r&&i(Object.assign(Object.assign({},a),{id:p})))},Hull:t=>{const e=o().useContext(r),{graph:s}=e,{options:n}=t;return o().useEffect((()=>{M&&M.length&&M.forEach((t=>s.removeHull(t))),M=n.map((t=>s.createHull(N(k,Object.assign({id:`${Math.random()}`},t)))));const t=(0,i.debounce)((()=>{M.forEach(((t,e)=>{t.group.destroyed?M[e]=s.createHull(N(k,Object.assign({id:`${Math.random()}`},n[e]))):t.updateData(t.members)}))}));return s.on("afterupdateitem",t),s.on("aftergraphrefreshposition",t),()=>{s.off("afterupdateitem",t),s.off("aftergraphrefreshposition",t)}}),[s,n]),null},MiniMap:t=>{const{graph:e}=o().useContext(r),{options:i,style:s={}}=t,n=o().useRef(null);o().useEffect((()=>{const t=e.getWidth(),s=e.getHeight(),o=e.get("fitViewPadding"),a=[(t-2*o)/(s-2*o)*120,120],r=Object.assign(Object.assign(Object.assign({container:n.current},nt),{size:a}),i),l=new(j().Minimap)(r);return e.addPlugin(l),()=>{l&&!l.destroyed&&e.removePlugin(l)}}),[i]);const a=Object.assign(Object.assign({},at),s);return o().createElement("div",{ref:n,style:a})},FishEye:t=>{const{graph:e}=o().useContext(r),{options:i,visible:s,handleEscListener:n}=t;return o().useEffect((()=>{const t=Object.assign(Object.assign({},E),i);t.showLabel&&e.getNodes().forEach((t=>{t.getContainer().getChildren().forEach((t=>{"text"===t.get("type")&&t.hide()}))}));const o=new(j().Fisheye)(t),a=t=>{27===t.keyCode&&n&&(n(),e.get("canvas").setCursor("default"))};return s&&(e.addPlugin(o),e.get("canvas").setCursor("zoom-in")),n&&window.addEventListener("keydown",a),()=>{e&&!e.destroyed&&(e.get("canvas").setCursor("default"),e.removePlugin(o)),n&&window.removeEventListener("keydown",a)}}),[e,i,s,n]),null},SnapLine:t=>{const{graph:e}=o().useContext(r),{options:i,visible:s}=t;return o().useEffect((()=>{const t=Object.assign(Object.assign({},rt),i),o=new(j().SnapLine)(t);return s&&e.addPlugin(o),()=>{e&&!e.destroyed&&e.removePlugin(o)}}),[e,i,s]),null},Tooltip:t=>{const{children:e,bindType:i="node",style:s,placement:n="top",hasArrow:a,delay:l={show:0,hide:200}}=t,{x:d,y:c,visible:h,item:p}=lt({bindType:i,container:ct,delay:l}),{graph:u}=o().useContext(r);let g=40;try{if(p){const{type:t}=p.getModel();if("graphin-cirle"===t){const{style:t}=p.getModel();t&&(g=t.keyshape.size)}}}catch(t){console.log(t)}const y=(({graph:t,placement:e,nodeSize:i,x:s,y:o,bindType:n="node",visible:a})=>"edge"===n?a?{left:s,top:o}:{visibility:"hidden",left:s,top:o}:("auto"===e&&(e=function(t,e,i){const s=t.get("canvas"),o=s.get("width"),n=s.get("height"),a=i<=n/4,r=i>=3*n/4,l=e<=o/4,d=e>=3*o/4;return l&&a?"bottom-right":d&&a?"bottom-left":l&&r?"top-right":d&&r?"top-left":a?"bottom":r?"top":l?"right":d?"left":"center"}(t,s,o)),"top"===e?a?{left:s,top:o-i/2,opacity:1,transform:"translate(-50%,calc(-100% - 6px))",transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:0,top:0,opacity:0,transform:"translate(-50%,-100%)",transition:"opacity 0.5s,transform 0.5s"}:"bottom"===e?a?{left:s,top:o+i/2,opacity:1,transform:"translate(-50%,6px)",transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:s,top:o+i/2,opacity:0,transform:"translate(-50%,0px)",transition:"opacity 0.5s,transform 0.5s"}:"left"===e?a?{left:s-i/2,top:o,transform:"translate(calc(-100% - 6px),-50%)",opacity:1,transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",opacity:0,left:s-i/2,top:o,transform:"translate(-100%,-50%)",transition:"opacity 0.5s,transform 0.5s"}:"right"===e?a?{left:s+i/2,top:o,transform:"translate(6px,-50%)",opacity:1,transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:s+i/2,top:o,transform:"translate(0,-50%)",opacity:0,transition:"opacity 0.5s,transform 0.5s"}:"top-left"===e?a?{left:s-i/2,top:o-i/2,opacity:1,transform:"translate(calc(-100% - 6px),calc(-100% - 6px))",transition:"opacity 0.5s,transform 0.5s"}:{left:s-i/2,top:o-i/2,opacity:0,transform:"translate(-100%,-100%)",transition:"opacity 0.5s,transform 0.5s"}:"top-right"===e?a?{left:s+i/2,top:o-i/2,opacity:1,transform:"translate(6px,calc(-100% - 6px))",transition:"opacity 0.5s,transform 0.5s"}:{left:s+i/2,top:o-i/2,opacity:0,transform:"translate(0,-100%)",transition:"opacity 0.5s,transform 0.5s"}:"bottom-left"===e?a?{left:s-i/2,top:o+i/2,opacity:1,transform:"translate(calc(-100% - 6px),6px)",transition:"opacity 0.5s,transform 0.5s"}:{left:s-i/2,top:o+i/2,opacity:0,transform:"translate(-100%,0px)",transition:"opacity 0.5s,transform 0.5s"}:"bottom-right"===e?a?{left:s+i/2,top:o+i/2,opacity:1,transform:"translate(6px,6px)",transition:"opacity 0.5s,transform 0.5s"}:{left:s+i/2,top:o+i/2,opacity:0,transform:"translate(0,0)",transition:"opacity 0.5s,transform 0.5s"}:"center"===e?a?{left:s,top:o,opacity:1,transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:s,top:o,opacity:0,transition:"opacity 0.5s,transform 0.5s"}:{left:s,top:o}))({graph:u,placement:n,nodeSize:g+12,x:d,y:c,bindType:i,visible:h}),f=Object.assign({position:"absolute"},y);if("function"!=typeof e)return console.error("<Tooltip /> children should be a function"),null;const m=p&&!p.destroyed&&p.getModel&&p.getModel()||{},v=m.id||"";return o().createElement(o().Fragment,null,o().createElement("div",{ref:ct,className:`graphin-components-tooltip ${n}`,style:Object.assign(Object.assign(Object.assign({},dt),f),s)},h&&o().createElement("div",null,a&&o().createElement("div",{className:`tooltip-arrow ${n}`}),e({item:p,bindType:i,model:m,id:v}))))},Legend:ot,useLegend:et,useTooltip:lt,useContextMenu:x},pt=t=>()=>{if(!t||t.destroyed)return;const e=t.getZoom(),i=t.get("canvas"),s=i.getPointByClient(i.get("width")/2,i.get("height")/2),o=i.get("pixelRatio")||1,n=1.25;return n*e>5?void 0:(t.zoom(n,{x:s.x/o,y:s.y/o},!0,{easing:"easeCubic",duration:150}),{text:`${Math.round(n*e*100)}%`,ratio:n*e})},ut=t=>()=>{if(!t||t.destroyed)return;const e=t.getZoom(),i=t.get("canvas"),s=i.getPointByClient(i.get("width")/2,i.get("height")/2),o=i.get("pixelRatio")||1,n=.75;return n*e<.3?void 0:(t.zoom(n,{x:s.x/o,y:s.y/o},!0,{easing:"easeCubic",duration:150}),{text:`${Math.round(n*e*100)}%`,ratio:n*e})},gt=t=>({text:e,ratio:i})=>{if(!t||t.destroyed)return;const s=t.get("canvas"),o=s.getPointByClient(s.get("width")/2,s.get("height")/2),n=s.get("pixelRatio")||1;return t.zoomTo(i,{x:o.x/n,y:o.y/n},!0,{easing:"easeCubic",duration:150}),{text:e,ratio:i}},yt=t=>()=>{if(!t||t.destroyed)return;const e=t.getZoom();return t.zoom(1/e),t.fitCenter(),{text:"100%",ratio:1}},ft=t=>()=>{if(!t||t.destroyed)return;t.getNodes().length>0&&t.fitView([20,20],{},!0);const e=t.getZoom();return{text:`${Math.round(100*e)}%`,ratio:e}},mt=t=>e=>{t.getNodes().forEach((i=>{t.clearItemStates(i,["active","inactive"]),-1!==e.indexOf(i.get("id"))?t.setItemState(i,"active",!0):t.setItemState(i,"active",!1)}))},vt=t=>e=>{if(!t||"string"!=typeof e)return;const i=t.findById(e);i?(t.focusItem(e,!0,{duration:200,easing:"easeCubic"}),t.setItemState(i,"selected",!0),i.toFront()):console.warn(`The node ${e} does not exist!`)},bt=Object.assign(Object.assign({},t),e),xt=t=>Object.keys(bt).reduce(((e,i)=>Object.assign(Object.assign({},e),{[i]:bt[i](t)})),{}),Ot={type:"compactBox",direction:"LR",getId:function(t){return t.id},getHeight:function(){return 16},getWidth:function(){return 16},getVGap:function(){return 80},getHGap:function(){return 20}},wt=["dendrogram","compactBox","mindmap","indented"],St={type:"force2"},jt=()=>Math.round(80*(Math.random()-.5)),Et=t=>!t||!t.nodes||0===t.nodes.length,Ct=["force","graphin-force","g6force","gForce","comboForce"],kt=class{constructor(t){this.updateOptions=()=>{const t={type:"concentric"},{width:e,height:i,props:s}=this.graphin,{layout:o=t}=s,{type:n="concentric",preset:a}=o,r={width:e,height:i,center:[e/2,i/2]};if(this.options=Object.assign(Object.assign(Object.assign({},r),D[n]||{}),o),Et(this.graphin.data))this.prevOptions={};else if(-1!==Ct.indexOf(n)){let t=this.prevOptions.type||"grid";(null==a?void 0:a.type)&&(t=a.type),Et(this.graphin.data)&&(t=a.type||"grid"),this.options.preset=Object.assign(Object.assign(Object.assign({type:t},r),D[t]||{}),a)}},this.processForce=()=>{const t=this,{options:e,graphin:i}=t,{graph:s}=i,{type:o,animation:n,animate:a}=e;if("graphin-force"===o&&(t.options.graph=s),"force"===o||"g6force"===o||"gForce"===o||"comboCombined"===o){const{onTick:e}=t.options,i=()=>{e&&e(),(n||a)&&t.refreshPosition()};t.options.tick=i;const{onLayoutEnd:o}=t.options;t.options.onLayoutEnd=()=>{t.refreshPosition(),null==o||o(),s.emit("afterlayout")}}"comboForce"!==o&&"comboCombined"!==o||(t.options.comboTrees=s.get("comboTrees"));const r=-1!==Ct.indexOf(t.prevOptions.type),l=-1!==Ct.indexOf(t.options.type),d=t.options.type===t.prevOptions.type;if(!Et(i.data)){if(l&&!d){const{preset:e}=t.options;t.presetLayout=new(j().Layout[e.type])(Object.assign({},e)||{}),t.presetLayout.init(i.data),t.presetLayout.execute(),t.presetLayout.data=Object.assign({},i.data)}if(l&&r&&!t.hasPosition()){let e=t.graph.save();const{preset:s}=t.options;Et(e)&&(t.presetLayout=new(j().Layout[s.type])(Object.assign({},s)||{}),t.presetLayout.init(i.data),t.presetLayout.execute(),e=i.data),i.data=((t,e)=>{const{nodes:i,edges:s}=t,{nodes:o}=e,n=new Map;o.forEach((t=>{const{id:e,x:i,y:s}=t;n.set(e,{x:i,y:s})}));const a=new Map;i.forEach((t=>{const{id:e}=t,{x:i,y:s}=n.get(e);window.isNaN(i)||window.isNaN(s)?a.set(e,t):(t.x=i,t.y=s)}));const r=new Map;return s.forEach((t=>{const{source:e,target:i}=t,s=a.get(e),o=a.get(i),l=n.get(e),d=!window.isNaN(l.x)&&!window.isNaN(l.y),c=n.get(i),h=!window.isNaN(c.x)&&!window.isNaN(c.y);s&&h&&r.set(e,{x:c.x+jt(),y:c.y+jt()}),o&&d&&r.set(i,{x:l.x+jt(),y:l.y+jt()})})),i.forEach((t=>{const{id:e}=t;let i=n.get(e);(window.isNaN(i.x)||window.isNaN(i.y))&&(i=r.get(e)||{}),window.isNaN(i.x)||window.isNaN(i.y)?(t.x=250+Math.round(500*Math.random()),t.y=150+Math.round(300*Math.random())):(t.x=i.x,t.y=i.y)})),Object.assign(Object.assign({},t),{nodes:i,edges:s})})(i.data,e)}}},this.refreshPosition=()=>{const{graphin:t}=this,{animate:e,layoutAnimate:i}=t.options,{type:s}=this.options;!e||i||this.options.animation?this.graph.refreshPositions("comboCombined"===s):this.graph.positionsAnimate("comboCombined"===s)},this.destroy=()=>{this.presetLayout&&this.presetLayout.destroy&&this.presetLayout.destroy(),this.instance&&this.instance.destroy&&this.instance.destroy(),this.presetLayout=null,this.instance=null},this.getDataFromGraph=()=>{const t=[],e=[],i=[],s=[],o=this.graph.getNodes(),n=this.graph.getEdges(),a=this.graph.getCombos(),r=o.length;for(let e=0;e<r;e++){const i=o[e];if(i&&i.isVisible()){const e=i.getModel();t.push(e)}}const l=n.length;for(let t=0;t<l;t++){const i=n[t];if(i&&i.isVisible()){const t=i.getModel();t.isComboEdge?s.push(t):e.push(t)}}const d=a.length;for(let t=0;t<d;t++){const e=a[t];if(e&&e.isVisible()){const t=e.getModel();i.push(t)}}return{nodes:t,edges:e,combos:i,comboEdges:s}},this.graphin=t,this.graph=this.graphin.graph,this.presetLayout=null,this.prevOptions={},this.init()}hasPosition(){const{graphin:t}=this,{data:e={}}=t;return!!e.nodes&&0!==e.nodes.length&&e.nodes.every((t=>!window.isNaN(Number(t.x))&&!window.isNaN(Number(t.y))))}init(){this.updateOptions();const{options:t,graphin:e}=this,{data:i}=e,{type:s}=t;this.processForce(),j().Layout[s]||console.warn(`${s} layout not found, current layout is grid`);const o=j().Layout[s]||j().Layout.grid;this.graph.emit("beforelayout"),this.instance=new o(this.options),this.instance.init(i)}start(){const{type:t}=this.options;this.instance.execute(),"force"!==t&&"g6force"!==t&&"gForce"!==t&&"comboCombined"!==t&&"force2"!==t&&(this.refreshPosition(),this.graph.emit("afterlayout"))}changeLayout(){const{graph:t,data:e,isTree:i,layoutCache:s}=this.graphin;if(!t||t.destroyed||!e||!e.nodes||!e.nodes.length||s&&this.hasPosition()||i)return!1;-1!==Ct.indexOf(this.options.type)&&this.destroy(),this.prevOptions=Object.assign({},this.options),this.init(),this.start()}},Nt={mode:"light",primaryColor:"#873bf4",nodeSize:26,edgeSize:1,primaryEdgeColor:"#ddd"},Mt=t=>{const e=Object.assign(Object.assign({},Nt),t),{primaryColor:i,primaryEdgeColor:s,nodeSize:o,edgeSize:n,mode:a,background:r}=e,l=A({primaryColor:i,nodeSize:o,mode:a}),d=T({primaryEdgeColor:s,edgeSize:n,mode:a}),c={type:"circle",style:{labelCfg:{position:"top"}},status:{}};return Object.assign(Object.assign({},e),{mode:a,background:r||{light:"#fff",dark:"#1f1f1f"}[a],defaultNodeStyle:{type:l.type,style:l.style},defaultNodeStatusStyle:{status:l.status},defaultEdgeStyle:{type:d.type,style:d.style},defaultEdgeStatusStyle:{status:d.status},defaultComboStyle:{type:c.type,style:c.style},defaultComboStatusStyle:{status:c.status}})},Pt={animation:"animate",minDistanceThreshold:"minMovement",maxIterations:"maxIterations"},Dt=(t,e)=>{if(!t)return t;const i={};if(Object.keys(t).forEach((s=>{var o;if("preset"===s&&(null===(o=t.preset)||void 0===o?void 0:o.type))return void(i.preset=Dt(t.preset,e));const n=Pt[s];n?i[n]=t[s]:i[s]=t[s]})),t.done&&(t.onLayoutEnd?i.onLayoutEnd=i=>{t.onLayoutEnd(e,i),t.done(e,i)}:i.onLayoutEnd=i=>{t.done(e,i)}),"concentric"===i.type){const{minNodeSpacing:t=60,preventOverlap:e=!0,nodeSize:s=60}=i;i.minNodeSpacing=t,i.preventOverlap=e,i.nodeSize=s}return i};var Lt=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};const{DragCanvas:_t,ZoomCanvas:Tt,DragNode:It,DragCombo:At,ClickSelect:$t,BrushSelect:zt,ResizeCanvas:Ft}=b;class Bt extends o().PureComponent{constructor(t){super(t),this.graphDOM=null,this.initData=t=>{t.children&&(this.isTree=!0),this.data=(0,i.cloneDeep)(t)},this.initGraphInstance=()=>{const t=this.props,{theme:e,data:i,layout:s,width:o,height:n,defaultCombo:a={style:{},type:"graphin-combo"},defaultEdge:r={style:{},type:"graphin-line"},defaultNode:l={style:{},type:"graphin-circle"},nodeStateStyles:d,edgeStateStyles:c,comboStateStyles:h,modes:p={default:[]},animate:u,handleAfterLayout:g}=t,y=Lt(t,["theme","data","layout","width","height","defaultCombo","defaultEdge","defaultNode","nodeStateStyles","edgeStateStyles","comboStateStyles","modes","animate","handleAfterLayout"]);p.default.length>0&&console.info("%c suggestion: you can use @antv/graphin Behaviors components","color:lightgreen");const{clientWidth:f,clientHeight:m}=this.graphDOM;this.initData(i),this.width=Number(o)||f||500,this.height=Number(n)||m||500;const v=Mt(e),{defaultNodeStyle:b,defaultEdgeStyle:x,defaultComboStyle:O,defaultNodeStatusStyle:w,defaultEdgeStatusStyle:S,defaultComboStatusStyle:E}=v,C=Lt(v,["defaultNodeStyle","defaultEdgeStyle","defaultComboStyle","defaultNodeStatusStyle","defaultEdgeStatusStyle","defaultComboStatusStyle"]);this.isTree=Boolean(i.children)||-1!==wt.indexOf(String(s&&s.type));const k={defaultNode:{style:Object.assign(Object.assign({},l.style),{_theme:e}),type:l.type||"graphin-circle"},defaultEdge:{style:Object.assign(Object.assign({},r.style),{_theme:e}),type:r.type||"graphin-line"},defaultCombo:{style:Object.assign(Object.assign({},a.style),{_theme:e}),type:a.type||"combo",labelCfg:a.labelCfg},nodeStateStyles:d,edgeStateStyles:c,comboStateStyles:h};this.theme=Object.assign(Object.assign({},k),C),this.options=Object.assign(Object.assign(Object.assign({container:this.graphDOM,renderer:"canvas",width:this.width,height:this.height,animate:!1!==u},k),{modes:p}),y),this.isTree?(this.options.layout=s||Ot,this.graph=new(j().TreeGraph)(this.options)):(this.useGraphinLayoutController||(this.options.layout=Dt(s,this.graph)||St),this.graph=new(j().Graph)(this.options)),this.graph.on("afterlayout",(()=>{g&&g(this.graph)})),this.graph.data(this.data),this.setTextDirection(),this.graph.render(),!this.isTree&&this.useGraphinLayoutController&&(this.layout=new kt(this),this.layout.start()),this.initStatus(),this.apis=xt(this.graph),this.setState({isReady:!0,context:{graph:this.graph,apis:this.apis,theme:this.theme,layout:this.layout,dragNodes:this.dragNodes,updateContext:this.updateContext}})},this.updateLayout=()=>{this.useGraphinLayoutController&&this.layout.changeLayout()},this.updateOptions=()=>Lt(this.props,[]),this.initStatus=()=>{if(!this.isTree){const{data:t}=this.props,{nodes:e=[],edges:i=[]}=t;e.forEach((t=>{const{status:e}=t;e&&Object.keys(e).forEach((i=>{this.graph.setItemState(t.id,i,Boolean(e[i]))}))})),i.forEach((t=>{const{status:e}=t;e&&Object.keys(e).forEach((i=>{this.graph.setItemState(t.id,i,Boolean(e[i]))}))}))}},this.updateContext=t=>{this.setState((e=>({context:Object.assign(Object.assign({},e.context),t)})))},this.clear=()=>{this.layout&&this.layout.destroy&&this.layout.destroy(),this.layout={},this.graph.clear(),this.data={nodes:[],edges:[],combos:[]},this.graph.destroy()};const{data:e,layout:s,width:o,height:n,layoutCache:a}=t,r=Lt(t,["data","layout","width","height","layoutCache"]);this.data=e,this.isTree=Boolean(t.data&&t.data.children)||-1!==wt.indexOf(String(s&&s.type)),this.graph={},this.height=Number(n),this.width=Number(o),this.theme={},this.apis={},this.layoutCache=a,this.layout={},this.dragNodes=[],this.useGraphinLayoutController="graphin-force"===(null==s?void 0:s.type),this.options=Object.assign({},r),this.state={isReady:!1,context:{graph:this.graph,apis:this.apis,theme:this.theme,layout:this.layout,dragNodes:this.dragNodes,updateContext:this.updateContext}}}static registerBehavior(t,e){j().registerBehavior(t,e)}static registerFontFamily(t){const e=t(),{glyphs:i,fontFamily:s}=e,o=i.map((t=>({name:t.name,unicode:String.fromCodePoint(t.unicode_decimal)})));return new Proxy(o,{get:(t,e)=>{const i=t.find((t=>t.name===e));return i?null==i?void 0:i.unicode:(console.error(`%c fontFamily:${s},does not found ${e} icon`),"")}})}static registerLayout(t,e){j().registerLayout(t,e)}setTextDirection(){const{dir:t="ltr"}=this.props;this.graph.get("canvas").get("el").setAttribute("dir",t)}componentDidMount(){this.initGraphInstance()}componentDidUpdate(t){var e,s;const o=this.shouldUpdate(t,"data"),n=this.shouldUpdate(t,"layout"),a=this.shouldUpdate(t,"options"),{data:r,layoutCache:l,rtl:d,layout:c}=(this.shouldUpdate(t,"theme"),this.props),h=(0,i.cloneDeep)(c);let p;if(this.layoutCache=l,a&&t.rtl!==d&&(this.setTextDirection(),this.graph.render()),o){if(this.initData(r),this.isTree)this.graph.changeData(this.data);else{const{context:{dragNodes:t}}=this.state;if(p=t.filter((t=>{var e;return(null===(e=this.data)||void 0===e?void 0:e.nodes)&&this.data.nodes.find((e=>e.id===t.id))})),null===(s=null===(e=this.data)||void 0===e?void 0:e.nodes)||void 0===s||s.forEach((t=>{var e,i,s,o;const n=p.find((e=>e.id===t.id));n&&(t.mass=null===(i=null===(e=n.layout)||void 0===e?void 0:e.force)||void 0===i?void 0:i.mass,t.layout=Object.assign(Object.assign({},t.layout),{force:{mass:null===(o=null===(s=n.layout)||void 0===s?void 0:s.force)||void 0===o?void 0:o.mass}}))})),this.useGraphinLayoutController)this.graph.data(this.data),this.graph.set("layoutController",null),this.graph.changeData(this.data),this.data=this.layout.getDataFromGraph(),this.layout.changeLayout();else{h&&(h.disableTriggerLayout=!0);const t=Dt(h,this.graph);this.graph.updateLayout(t),this.graph.data(this.data),this.graph.changeData(this.data),this.data=this.graph.get("data")}}return this.initStatus(),this.apis=xt(this.graph),void this.setState((t=>Object.assign(Object.assign({},t),{context:{graph:this.graph,apis:this.apis,theme:this.theme,layout:this.layout,dragNodes:p||t.context.dragNodes,updateContext:this.updateContext}})),(()=>{this.graph.emit("graphin:datachange"),n&&this.graph.emit("graphin:layoutchange",{prevLayout:t.layout,layout:h})}))}if(n){if(this.useGraphinLayoutController="graphin-force"===(null==h?void 0:h.type),this.isTree)return void this.graph.updateLayout(h);if(this.useGraphinLayoutController)0===Object.keys(this.layout).length&&(this.layout=new kt(this)),this.data=this.layout.getDataFromGraph(),this.layout.changeLayout();else{this.graph.get("layoutController")||this.graph.initLayoutController();const t=Dt(h,this.graph);t&&(t.disableTriggerLayout=!1),this.graph.updateLayout(t),this.data=this.graph.get("data")}this.graph.emit("graphin:layoutchange",{prevLayout:t.layout,layout:h})}}componentWillUnmount(){const{willUnmount:t}=this.props;t?(t(),this.layout&&this.layout.destroy&&this.layout.destroy(),this.layout={},this.graph.destroyLayout()):this.clear()}componentDidCatch(t,e){console.error("Catch component error: ",t,e)}shouldUpdate(t,e){const s=t[e],o=this.props[e];return!(0,i.isEqual)(s,o)}render(){var t;const{isReady:e}=this.state,{modes:i,style:s,containerId:n,containerStyle:a}=this.props;return o().createElement(r.Provider,{value:this.state.context},o().createElement("div",{id:n||"graphin-container",style:Object.assign({height:"100%",width:"100%",position:"relative"},a)},o().createElement("div",{"data-testid":"custom-element",className:"graphin-core",ref:t=>{this.graphDOM=t},style:Object.assign({height:"100%",width:" 100%",minHeight:"500px",background:(null===(t=this.theme)||void 0===t?void 0:t.background)||"#fff"},s)}),o().createElement("div",{className:"graphin-components"},e&&o().createElement(o().Fragment,null,!i&&o().createElement(o().Fragment,null,o().createElement(_t,null),o().createElement(Tt,null),o().createElement(It,null),o().createElement(At,null),o().createElement($t,null),o().createElement(zt,null)),o().createElement(Ft,{graphDOM:this.graphDOM}),this.props.children))))}}Bt.registerNode=(t,e,i)=>{j().registerNode(t,e,i)},Bt.registerEdge=(t,e,i)=>{j().registerEdge(t,e,i)},Bt.registerCombo=(t,e,i)=>{j().registerCombo(t,e,i)};const Rt=Bt,Wt=(t,e,i)=>{var s,o;return"source"===t?(null===(s=null==i?void 0:i.find((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.id)===e.id})))||void 0===s?void 0:s.source)||{}:(null===(o=null==i?void 0:i.find((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.id)===e.id})))||void 0===o?void 0:o.target)||{}},Gt=(t,e,i,s)=>{var o;const n=(null===(o=null==i?void 0:i.data)||void 0===o?void 0:o[e])||"";let a=(null==s?void 0:s.filter((t=>{var i;return(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i[e])===n})))||[];return"leaf"===t&&(a=a.filter((t=>{var e,i,s,o;return 0===(null===(i=null===(e=t.data)||void 0===e?void 0:e.layout)||void 0===i?void 0:i.sDegree)||0===(null===(o=null===(s=t.data)||void 0===s?void 0:s.layout)||void 0===o?void 0:o.tDegree)}))),a},qt=(t,e,s)=>{let o=[];switch(t){case"source":o=null==s?void 0:s.filter((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.id)===e.id})).map((t=>t.target));break;case"target":o=null==s?void 0:s.filter((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.id)===e.id})).map((t=>t.source));break;case"both":o=null==s?void 0:s.filter((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.id)===e.id})).map((t=>t.target)).concat(null==s?void 0:s.filter((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.id)===e.id})).map((t=>t.source)))}return o=(0,i.uniqBy)(o,"id"),o},Ht={getDegree:(t,e)=>{const i=t.data.id;let s=0,o=0,n=0;return e.forEach((t=>{t.source.id===i&&(o+=1,s+=1),t.target.id===i&&(n+=1,s+=1)})),{degree:s,sDegree:o,tDegree:n}},getRelativeNodesType:(t,e)=>[...new Set(null==t?void 0:t.map((t=>{var i;return null===(i=null==t?void 0:t.data)||void 0===i?void 0:i[e]})))]||[],getCoreNodeAndRelativeLeafNodes:(t,e,i,s)=>{var o;const{sDegree:n,tDegree:a}=(null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.layout)||{};let r=e,l=[];return 0===n?(r=Wt("source",e,i),l=qt("both",r,i)):0===a&&(r=Wt("target",e,i),l=qt("both",r,i)),l=l.filter((t=>{var e;return(null===(e=t.data)||void 0===e?void 0:e.layout)&&(0===t.data.layout.sDegree||0===t.data.layout.tDegree)})),{coreNode:r,relativeLeafNodes:l,sameTypeLeafNodes:Gt(t,s,e,l)}},getCoreNode:Wt,getSameTypeNodes:Gt,getMinDistanceNode:t=>{const e=t.map((t=>t.x)),i=t.map((t=>t.y)),s=(Math.max.apply(null,e)+Math.min.apply(null,e))/2,o=(Math.max.apply(null,i)+Math.min.apply(null,i))/2,n=t.map((t=>{return e=t.x||0,i=t.y||0,Math.sqrt((e-s)*(e-s)+(i-o)*(i-o));var e,i}));return t[n.findIndex((t=>t===Math.min.apply(null,n)))]},getAvgNodePosition:t=>{const e={x:0,y:0};t.forEach((t=>{e.x+=t.x||0,e.y+=t.y||0}));const i=t.length||1;return{x:e.x/i,y:e.y/i}}};class Zt{constructor(t){this.id=t.id,this.data=t||{},this.x=t.x||0,this.y=t.y||0}}class Vt{constructor(t,e,i,s){this.id=t,this.source=e,this.target=i,this.data=s||{}}}function Ut(t,e,i,s){if(isNaN(e)||isNaN(i))return t;var o,n,a,r,l,d,c,h,p,u=t._root,g={data:s},y=t._x0,f=t._y0,m=t._x1,v=t._y1;if(!u)return t._root=g,t;for(;u.length;)if((d=e>=(n=(y+m)/2))?y=n:m=n,(c=i>=(a=(f+v)/2))?f=a:v=a,o=u,!(u=u[h=c<<1|d]))return o[h]=g,t;if(r=+t._x.call(null,u.data),l=+t._y.call(null,u.data),e===r&&i===l)return g.next=u,o?o[h]=g:t._root=g,t;do{o=o?o[h]=new Array(4):t._root=new Array(4),(d=e>=(n=(y+m)/2))?y=n:m=n,(c=i>=(a=(f+v)/2))?f=a:v=a}while((h=c<<1|d)==(p=(l>=a)<<1|r>=n));return o[p]=u,o[h]=g,t}function Xt(t,e,i,s,o){this.node=t,this.x0=e,this.y0=i,this.x1=s,this.y1=o}function Yt(t){return t[0]}function Kt(t){return t[1]}function Qt(t,e,i){var s=new Jt(null==e?Yt:e,null==i?Kt:i,NaN,NaN,NaN,NaN);return null==t?s:s.addAll(t)}function Jt(t,e,i,s,o,n){this._x=t,this._y=e,this._x0=i,this._y0=s,this._x1=o,this._y1=n,this._root=void 0}function te(t){for(var e={data:t.data},i=e;t=t.next;)i=i.next={data:t.data};return e}var ee=Qt.prototype=Jt.prototype;ee.copy=function(){var t,e,i=new Jt(this._x,this._y,this._x0,this._y0,this._x1,this._y1),s=this._root;if(!s)return i;if(!s.length)return i._root=te(s),i;for(t=[{source:s,target:i._root=new Array(4)}];s=t.pop();)for(var o=0;o<4;++o)(e=s.source[o])&&(e.length?t.push({source:e,target:s.target[o]=new Array(4)}):s.target[o]=te(e));return i},ee.add=function(t){const e=+this._x.call(null,t),i=+this._y.call(null,t);return Ut(this.cover(e,i),e,i,t)},ee.addAll=function(t){var e,i,s,o,n=t.length,a=new Array(n),r=new Array(n),l=1/0,d=1/0,c=-1/0,h=-1/0;for(i=0;i<n;++i)isNaN(s=+this._x.call(null,e=t[i]))||isNaN(o=+this._y.call(null,e))||(a[i]=s,r[i]=o,s<l&&(l=s),s>c&&(c=s),o<d&&(d=o),o>h&&(h=o));if(l>c||d>h)return this;for(this.cover(l,d).cover(c,h),i=0;i<n;++i)Ut(this,a[i],r[i],t[i]);return this},ee.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var i=this._x0,s=this._y0,o=this._x1,n=this._y1;if(isNaN(i))o=(i=Math.floor(t))+1,n=(s=Math.floor(e))+1;else{for(var a,r,l=o-i||1,d=this._root;i>t||t>=o||s>e||e>=n;)switch(r=(e<s)<<1|t<i,(a=new Array(4))[r]=d,d=a,l*=2,r){case 0:o=i+l,n=s+l;break;case 1:i=o-l,n=s+l;break;case 2:o=i+l,s=n-l;break;case 3:i=o-l,s=n-l}this._root&&this._root.length&&(this._root=d)}return this._x0=i,this._y0=s,this._x1=o,this._y1=n,this},ee.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},ee.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},ee.find=function(t,e,i){var s,o,n,a,r,l,d,c=this._x0,h=this._y0,p=this._x1,u=this._y1,g=[],y=this._root;for(y&&g.push(new Xt(y,c,h,p,u)),null==i?i=1/0:(c=t-i,h=e-i,p=t+i,u=e+i,i*=i);l=g.pop();)if(!(!(y=l.node)||(o=l.x0)>p||(n=l.y0)>u||(a=l.x1)<c||(r=l.y1)<h))if(y.length){var f=(o+a)/2,m=(n+r)/2;g.push(new Xt(y[3],f,m,a,r),new Xt(y[2],o,m,f,r),new Xt(y[1],f,n,a,m),new Xt(y[0],o,n,f,m)),(d=(e>=m)<<1|t>=f)&&(l=g[g.length-1],g[g.length-1]=g[g.length-1-d],g[g.length-1-d]=l)}else{var v=t-+this._x.call(null,y.data),b=e-+this._y.call(null,y.data),x=v*v+b*b;if(x<i){var O=Math.sqrt(i=x);c=t-O,h=e-O,p=t+O,u=e+O,s=y.data}}return s},ee.remove=function(t){if(isNaN(n=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,i,s,o,n,a,r,l,d,c,h,p,u=this._root,g=this._x0,y=this._y0,f=this._x1,m=this._y1;if(!u)return this;if(u.length)for(;;){if((d=n>=(r=(g+f)/2))?g=r:f=r,(c=a>=(l=(y+m)/2))?y=l:m=l,e=u,!(u=u[h=c<<1|d]))return this;if(!u.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(i=e,p=h)}for(;u.data!==t;)if(s=u,!(u=u.next))return this;return(o=u.next)&&delete u.next,s?(o?s.next=o:delete s.next,this):e?(o?e[h]=o:delete e[h],(u=e[0]||e[1]||e[2]||e[3])&&u===(e[3]||e[2]||e[1]||e[0])&&!u.length&&(i?i[p]=u:this._root=u),this):(this._root=o,this)},ee.removeAll=function(t){for(var e=0,i=t.length;e<i;++e)this.remove(t[e]);return this},ee.root=function(){return this._root},ee.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},ee.visit=function(t){var e,i,s,o,n,a,r=[],l=this._root;for(l&&r.push(new Xt(l,this._x0,this._y0,this._x1,this._y1));e=r.pop();)if(!t(l=e.node,s=e.x0,o=e.y0,n=e.x1,a=e.y1)&&l.length){var d=(s+n)/2,c=(o+a)/2;(i=l[3])&&r.push(new Xt(i,d,c,n,a)),(i=l[2])&&r.push(new Xt(i,s,c,d,a)),(i=l[1])&&r.push(new Xt(i,d,o,n,c)),(i=l[0])&&r.push(new Xt(i,s,o,d,c))}return this},ee.visitAfter=function(t){var e,i=[],s=[];for(this._root&&i.push(new Xt(this._root,this._x0,this._y0,this._x1,this._y1));e=i.pop();){var o=e.node;if(o.length){var n,a=e.x0,r=e.y0,l=e.x1,d=e.y1,c=(a+l)/2,h=(r+d)/2;(n=o[0])&&i.push(new Xt(n,a,r,c,h)),(n=o[1])&&i.push(new Xt(n,c,r,l,h)),(n=o[2])&&i.push(new Xt(n,a,h,c,d)),(n=o[3])&&i.push(new Xt(n,c,h,l,d))}s.push(e)}for(;e=s.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},ee.x=function(t){return arguments.length?(this._x=t,this):this._x},ee.y=function(t){return arguments.length?(this._y=t,this):this._y};function ie(t){let e=0,i=0,s=0;if(t.length){for(let o=0;o<4;o++){const n=t[o];n&&n.weight&&(e+=n.weight,i+=n.x*n.weight,s+=n.y*n.weight)}t.x=i/e,t.y=s/e,t.weight=e}else{const e=t;t.x=e.data.x,t.y=e.data.y,t.weight=e.data.weight}}class se{constructor(t,e){this.getvec=()=>this,this.add=t=>new se(this.x+t.x,this.y+t.y),this.subtract=t=>new se(this.x-t.x,this.y-t.y),this.magnitude=()=>Math.sqrt(this.x*this.x+this.y*this.y),this.normalise=()=>this.divide(this.magnitude()),this.divide=t=>new se(this.x/t||0,this.y/t||0),this.scalarMultip=t=>new se(this.x*t,this.y*t),this.x=t,this.y=e}}const oe=se,ne=class{constructor(t,e,i,s=1){this.updateAcc=t=>{this.a=this.a.add(t.divide(this.m))},this.p=t,this.m=s,this.v=new oe(0,0),this.a=new oe(0,0),this.id=e,this.data=i}},ae=class{constructor(t,e,i){this.source=t,this.target=e,this.length=i}},re=class{constructor(t){this.updateOptions=t=>{t&&Object.keys(t).forEach((e=>{this.props[e]=t[e]}))},this.setData=t=>{this.nodes=[],this.edges=[],this.nodeSet={},this.edgeSet={},this.nodePoints=new Map,this.edgeSprings=new Map,this.sourceData=t,this.judgingDistance=0,("nodes"in t||"edges"in t)&&(this.addNodes(t.nodes),this.addEdges(t.edges))},this.getMass=t=>{var e;const{degree:i=(null===(e=Ht.getDegree(t,this.edges))||void 0===e?void 0:e.degree),force:s}=t.layout||{};return s&&s.mass?s.mass:i<5?1:5*i},this.init=()=>{const{width:t,height:e}=this.props;let{centripetalOptions:i}=this.props;const{leafCluster:s,clustering:o,nodeClusterBy:n,clusterNodeStrength:a}=this.props,r=t=>"function"==typeof a?a(t):a;let l;if(this.nodes.forEach((i=>{const s=i.data.x||t/2,o=i.data.y||e/2,n=new oe(s,o);i.data.layout||(i.data.layout={});const a=Ht.getDegree(i,this.edges);i.data.layout=Object.assign(Object.assign({},i.data.layout),a);const r=this.getMass(i.data);this.nodePoints.set(i.id,new ne(n,String(i.id),i.data,r))})),this.edges.forEach((t=>{const e=this.nodePoints.get(t.source.id),i=this.nodePoints.get(t.target.id),s=this.props.defSpringLen(t,e,i);this.edgeSprings.set(t.id,new ae(e,i,s))})),s){l=this.getSameTypeLeafMap();const t=Ht.getRelativeNodesType(this.nodes,n);i={single:100,leaf:(e,i,s)=>{const{relativeLeafNodes:o,sameTypeLeafNodes:n}=l[e.id]||{};return(null==n?void 0:n.length)===(null==o?void 0:o.length)||1===(null==t?void 0:t.length)?1:r(e)},others:1,center:(t,e,i)=>{var s;const{degree:o}=(null===(s=t.data)||void 0===s?void 0:s.layout)||{};if(!o)return{x:100,y:100};let n;if(1===o){const{sameTypeLeafNodes:e=[]}=l[t.id]||{};1===e.length?n=void 0:e.length>1&&(n=Ht.getAvgNodePosition(e))}else n=void 0;return{x:null==n?void 0:n.x,y:null==n?void 0:n.y}}}}if(o){l||(l=this.getSameTypeLeafMap());const t=Array.from(new Set(this.nodes.map((t=>{var e;return null===(e=t.data)||void 0===e?void 0:e[n]})))).filter((t=>void 0!==t)),e={};t.forEach((t=>{const i=this.nodes.filter((e=>{var i;return(null===(i=e.data)||void 0===i?void 0:i[n])===t}));e[t]=Ht.getAvgNodePosition(i)})),i={single:t=>r(t),leaf:t=>r(t),others:t=>r(t),center:(t,i,s)=>{var o;const a=e[null===(o=t.data)||void 0===o?void 0:o[n]];return{x:null==a?void 0:a.x,y:null==a?void 0:a.y}}}}this.centripetalOptions=Object.assign(Object.assign({},this.centripetalOptions),i);const{size:d}=this.nodePoints,c=Math.pow(10,2);this.props.minEnergyThreshold=.5*Math.pow(1,2)*1*d*c},this.start=()=>{this.init(),this.props.animation?this.animation():this.slienceForce()},this.calTotalEnergy=()=>{let t=0;return this.nodes.forEach((e=>{const i=this.nodePoints.get(e.id),s=i.v.magnitude(),{m:o}=i;t+=o*Math.pow(s,2)*.5})),t},this.slienceForce=()=>{const{done:t,maxIterations:e,minDistanceThreshold:i}=this.props;for(let t=0;(this.judgingDistance>i||t<1)&&t<e;t++)this.tick(this.props.tickInterval),this.iterations++;this.render(),t&&t(this.renderNodes)},this.requestAnimationFrame=t=>{const{enableWorker:e}=this.props;return e?setInterval((()=>{t()}),16):window.requestAnimationFrame(t)},this.cancelAnimationFrame=t=>{const{enableWorker:e}=this.props;e?clearInterval(t):window.cancelAnimationFrame(t)},this.animation=()=>{const{enableWorker:t,maxIterations:e,minDistanceThreshold:i,done:s,tickInterval:o}=this.props;if(t){let t=(new Date).valueOf();const o=.22,n=t=>t>10?2e3:20*t*t;for(let a=0;a<e;a++){const e=Math.max(.02,o-.002*a);this.tick(e),(new Date).valueOf()-t>=n(a)&&(this.render(),t=(new Date).valueOf());const r=this.calTotalEnergy(),l=this.registers.get("monitor");if(l&&l(this.reportMointor(r)),this.judgingDistance<i)return this.render(),void(s&&s(this.renderNodes))}return}const n=()=>{this.tick(o),this.render(),this.iterations++;const t=this.calTotalEnergy(),e=this.registers.get("monitor");e&&e(this.reportMointor(t)),this.judgingDistance<i||this.iterations>this.props.maxIterations?(this.cancelAnimationFrame(this.timer),this.iterations=0,this.done=!0,s&&s(this.renderNodes)):this.timer=this.requestAnimationFrame(n)};this.timer=this.requestAnimationFrame(n)},this.render=()=>{const t=this.registers.get("render");this.renderNodes=[],this.nodePoints.forEach((t=>{this.renderNodes.push(Object.assign(Object.assign({},this.nodeSet[t.id]&&this.nodeSet[t.id].data),{x:t.p.x,y:t.p.y}))})),t?t({nodes:this.renderNodes,edges:this.sourceData.edges}):console.error("need a render function")},this.reportMointor=t=>({energy:t,iterations:this.iterations,nodes:this.nodes,edges:this.edges}),this.tick=t=>{this.updateCoulombsLawOptimized(),this.updateHookesLaw(),this.attractToCentre(),this.attractToSide(),this.updateVelocity(t),this.updatePosition(t)},this.updateCoulombsLawOptimized=()=>{const{coulombDisScale:t}=this.props,{repulsion:e}=this.props,i=function(t,e,i){const s=i/(e*e),o=t.map(((t,e)=>Object.assign(Object.assign({index:e},t),{vx:0,vy:0,weight:s}))),n=Qt(o,(t=>t.x),(t=>t.y)).visitAfter(ie);return o.forEach((t=>{!function(t,e){e.visit(((e,i,s,o,n)=>{const a=t.x-e.x||.001,r=t.y-e.y||.001,l=o-i,d=a*a+r*r+.1,c=Math.sqrt(d)+.1;return l*l/.81<d?(t.vx+=a/c*e.weight/d,t.vy+=r/c*e.weight/d,!0):!e.length&&void(e.data!==t&&(t.vx+=a/c*e.data.weight/d,t.vy+=r/c*e.data.weight/d))}))}(t,n)})),o.map((t=>({vx:t.vx,vy:t.vy})))}(this.nodes.map((t=>{const e=this.nodePoints.get(t.id).p;return{x:e.x,y:e.y}})),t,e);this.nodes.forEach(((t,e)=>{this.nodePoints.get(t.id).updateAcc(new oe(i[e].vx,i[e].vy))}))},this.updateCoulombsLaw=()=>{const t=this.nodes.length;for(let e=0;e<t;e++)for(let i=e+1;i<t;i++){if(e===i)continue;const t=this.nodes[e],s=this.nodes[i],{coulombDisScale:o}=this.props,{repulsion:n}=this.props,a=this.nodePoints.get(t.id).p.subtract(this.nodePoints.get(s.id).p),r=(a.magnitude()+.1)*o,l=a.normalise(),d=1;this.nodePoints.get(t.id).updateAcc(l.scalarMultip(n*d).divide(Math.pow(r,2))),this.nodePoints.get(s.id).updateAcc(l.scalarMultip(n*d).divide(-Math.pow(r,2)))}},this.updateHookesLaw=()=>{this.edges.forEach((t=>{const e=this.edgeSprings.get(t.id),i=e.target.p.subtract(e.source.p),s=e.length-i.magnitude(),o=i.normalise();e.source.updateAcc(o.scalarMultip(-this.props.stiffness*s)),e.target.updateAcc(o.scalarMultip(this.props.stiffness*s))}))},this.implementForce=(t,e,i=2)=>{const s=this.nodePoints.get(t.id),o=s.p.subtract(e);s.updateAcc(o.scalarMultip(-i))},this.attractToCentre=()=>{this.nodes.forEach((t=>{var e;const{degree:i,sDegree:s,tDegree:o}=null===(e=t.data)||void 0===e?void 0:e.layout,{leaf:n,single:a,others:r,center:l}=this.centripetalOptions,{width:d,height:c}=this.props;if(void 0===l)return;const{x:h,y:p,centerStrength:u}=l(t,this.nodes,this.edges,d,c);if(void 0===h||void 0===p)return;const g=new oe(h,p);if(u)return void this.implementForce(t,g,u);const y="function"==typeof n?n(t,this.nodes,this.edges):n,f="function"==typeof a?a(t):a,m="function"==typeof r?r(t):r,v=0===o||0===s;0!==y&&0!==f&&0!==m&&(0===i?this.implementForce(t,g,f):v?this.implementForce(t,g,y):this.implementForce(t,g,m))}))},this.attractToSide=()=>{if(!this.props.defSideCoe||"function"!=typeof this.props.defSideCoe)return;const{height:t}=this.props;this.nodes.forEach((e=>{const i=this.props.defSideCoe(e);if(0===i)return;const s=this.nodePoints.get(e.id),{x:o}=s.p,n=new oe(o,i>0?0:t);this.implementForce(e,n,Math.abs(i))}))},this.updateVelocity=t=>{this.nodes.forEach((e=>{const i=this.nodePoints.get(e.id);i.v=i.v.add(i.a.scalarMultip(t)).scalarMultip(this.props.damping),i.v.magnitude()>this.props.maxSpeed&&(i.v=i.v.normalise().scalarMultip(this.props.maxSpeed)),i.a=new oe(0,0)}))},this.updatePosition=t=>{var e;if(!(null===(e=this.nodes)||void 0===e?void 0:e.length))return void(this.judgingDistance=0);const{distanceThresholdMode:i}=this.props;let s=0;"max"===i?this.judgingDistance=-1/0:"min"===i&&(this.judgingDistance=1/0),this.nodes.forEach((e=>{const o=this.nodePoints.get(e.id);o.p=o.p.add(o.v.scalarMultip(t));const n=o.v.scalarMultip(t).magnitude();switch(i){case"max":this.judgingDistance<n&&(this.judgingDistance=n);break;case"min":this.judgingDistance>n&&(this.judgingDistance=n);break;default:s+=n}})),i&&"mean"!==i||(this.judgingDistance=s/this.nodes.length)},this.addNode=t=>{const{ignore:e}=this.props;e&&e(t)||(t.id in this.nodeSet||this.nodes.push(t),this.nodeSet[t.id]=t)},this.addNodes=t=>{t.forEach((t=>{this.addNode(new Zt(t))}))},this.addEdge=t=>(t.id in this.edgeSet||this.edges.push(t),this.edgeSet[t.id]=t,t),this.addEdges=t=>{try{const e=t.length;for(let i=0;i<e;i++){const e=t[i],s=e.source,o=e.target,n=this.nodeSet[s];if(void 0===n)throw new TypeError(`invalid node name: ${e.source}`);const a=this.nodeSet[o];if(void 0===a)throw new TypeError(`invalid node name: ${e.target}`);const r=e.data,l=new Vt(String(this.nextEdgeId++),n,a,r);this.addEdge(l)}}catch(t){console.error(t)}},this.register=(t,e)=>{this.registers.set(t,e)},this.restart=(t,e)=>{const{ignore:i}=this.props;e.getNodes().forEach((t=>{const e=t.get("model");if(i&&i(e))return;const s=new oe(e.x,e.y),o=this.nodePoints.get(e.id);o&&(o.p=s,this.nodePoints.set(e.id,o))})),t.forEach((t=>{const e=new oe(t.x,t.y),i=this.getMass(t);this.nodePoints.set(t.id,new ne(e,t.id,t.data,i)),this.edges.forEach((e=>{const i=this.nodePoints.get(e.source.id),s=this.nodePoints.get(e.target.id);if(i.id===t.id||s.id===t.id){const t=this.edgeSprings.get(e.id).length||100;this.edgeSprings.set(e.id,new ae(i,s,t))}}))})),this.props.restartAnimation?this.animation():this.slienceForce()},this.stop=()=>{window.cancelAnimationFrame(this.timer),this.done=!0},this.getSameTypeLeafMap=()=>{const{nodeClusterBy:t}=this.props,e={};return this.nodes.forEach((i=>{var s;const{degree:o}=(null===(s=i.data)||void 0===s?void 0:s.layout)||{};1===o&&(e[i.id]=Ht.getCoreNodeAndRelativeLeafNodes("leaf",i,this.edges,t))})),e},this.props={stiffness:200,enableWorker:!1,defSpringLen:t=>t.data.spring||200,repulsion:1e3,centripetalOptions:{leaf:2,single:2},leafCluster:!1,clustering:!1,nodeClusterBy:"cluster",clusterNodeStrength:20,damping:.9,minEnergyThreshold:.1,maxSpeed:1e3,coulombDisScale:.005,tickInterval:.02,groupFactor:4,maxIterations:7440,minDistanceThreshold:.4,distanceThresholdMode:"mean",animation:!0,restartAnimation:!0,width:200,height:200},this.updateOptions(t),this.sourceData={nodes:[],edges:[],combos:[]},this.nodes=[],this.edges=[],this.nodeSet={},this.edgeSet={},this.renderNodes=[],this.nodePoints=new Map,this.edgeSprings=new Map,this.registers=new Map,this.done=!1,this.judgingDistance=0,this.iterations=0,this.nextEdgeId=0,this.timer=0,this.center=new oe(0,0),this.centripetalOptions={leaf:2,single:2,others:1,center:t=>({x:this.props.width/2,y:this.props.height/2})},this.dragNodes=[]}};var le=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i},de=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};const ce=(t,e,i)=>{if(e)try{t.forEach((t=>{const s=t.cfg.name;if(e[s]){const o=i(e,s),{animate:n,visible:a}=o,r=de(o,["animate","visible"]);if(t.attrs.img)void 0!==r.opacity&&t.attr({opacity:r.opacity});else if(t.attr(r),t.cfg.visible=!1!==a,n){const{attrs:e}=n,i=de(n,["attrs"]);t.animate(e,i)}}}))}catch(t){console.error(t)}};function he(t){return Object.keys(t).forEach((e=>{void 0===t[e]&&delete t[e]})),t}const pe=t=>{if(!t)return[0,0];let e=0,i=0;if("number"==typeof t)e=t,i=t;else if(Array.isArray(t))if(1===t.length){const[s]=t;e=s,i=s}else if(2===t.length){const[s,o]=t;e=s,i=o}return[e,i]};var ue=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};function ge(t){let e;return"number"==typeof t?e=t/2:Array.isArray(t)&&(e=t[0]/2),e}const ye=t=>{const{halo:e,keyshape:i}=t,{size:s,visible:o,fill:n,fillOpacity:a}=e,r=ue(e,["size","visible","fill","fillOpacity"]),l=ge(s);let d,c,h;return i&&i.size&&(d=ge(i.size)+15),i&&i.fill&&(c=i.fill),i&&i.stroke&&(h=i.stroke),{name:"halo",visible:!1!==o,attrs:he(Object.assign({x:0,y:0,r:l||d,fill:n||c||h,fillOpacity:a||.1,visible:!1!==o},r))}},fe=t=>{const{keyshape:e}=t,{size:i,visible:s,stroke:o,fill:n,fillOpacity:a,strokeOpacity:r}=e,l=ue(e,["size","visible","stroke","fill","fillOpacity","strokeOpacity"]),d=ge(i);return{name:"keyshape",visible:!1!==s,attrs:he(Object.assign({x:0,y:0,r:d,cursor:"pointer",visible:!1!==s,stroke:o,strokeOpacity:r||1,fill:n||o,fillOpacity:a||.2},l))}},me=t=>{const{label:e}=t,{value:i,fill:s,fontSize:o,visible:n}=e,a=ue(e,["value","fill","fontSize","visible"]),r=(t=>{const{label:e,keyshape:i}=t;if(!(null==i?void 0:i.size)&&!(null==e?void 0:e.offset))return{x:void 0,y:void 0,textBaseline:null==e?void 0:e.textBaseline};!(null==i?void 0:i.size)&&(null==e?void 0:e.offset)&&(i.size=26,console.info("you should set keyshape.size when you update label position,the default keyshape size value is  26"));const{size:s}=i;let o=[0,0];const{position:n,offset:a=o}=e;"number"!=typeof a&&"string"!=typeof a||(o=[Number(a),Number(a)]),a.length>0&&(o=a);const[r,l]=o;if("center"===n)return{x:0+r,y:0+l};const d=pe(s),c=d[0],h=d[1];let p;switch(n){case"top":p={x:0+r,y:-h/2-l,textBaseline:"bottom"};break;case"bottom":default:p={x:0+r,y:h/2+l,textBaseline:"top"};break;case"left":p={x:0-c-r,y:0+l,textAlign:"right"};break;case"right":p={x:0+c+r,y:0+l,textAlign:"left"}}return p})(t);return{name:"label",visible:!1!==n,attrs:he(Object.assign({x:r.x,y:r.y,fontSize:o,text:i,textAlign:"center",fill:s,textBaseline:r.textBaseline,visible:!1!==n},a))}},ve=t=>{const{icon:e}=t,{value:i="",type:s,fontFamily:o,textAlign:n="center",textBaseline:a="middle",fill:r,size:l,visible:d,clip:c}=e,h=ue(e,["value","type","fontFamily","textAlign","textBaseline","fill","size","visible","clip"]),[p,u]=pe(l),g={name:"icon",visible:!1!==d,capture:!1};return"text"===s||"font"===s?Object.assign(Object.assign({},g),{attrs:Object.assign({x:0,y:0,textAlign:n,textBaseline:a,text:i,fontSize:p,fontFamily:o,fill:r,visible:!1!==d},h)}):Object.assign(Object.assign({},g),{attrs:Object.assign({x:-p/2,y:-u/2,img:i,width:p,height:u,visible:!1!==d},h)})},be=(t,e)=>"keyshape"===e?fe(t).attrs:"halo"===e?ye(t).attrs:"label"===e?me(t).attrs:"icon"===e?ve(t).attrs:t[e]||{},xe=(t,e,i)=>{const{type:s,position:o,value:n="",size:a,fill:r,stroke:l,color:d,fontSize:c,fontFamily:h,padding:p=0,offset:u=[0,0],id:g}=t,y=pe(u),[f,m]=pe(a),{x:v,y:b}=((t="RT",e)=>{let i=0,s=0;return"LT"===t?(i=e*Math.cos(3*Math.PI/4),s=-e*Math.sin(3*Math.PI/4)):"LB"===t?(i=e*Math.cos(5*Math.PI/4),s=-e*Math.sin(5*Math.PI/4)):"RT"===t?(i=e*Math.cos(1*Math.PI/4),s=-e*Math.sin(1*Math.PI/4)):"RB"===t&&(i=e*Math.cos(7*Math.PI/4),s=-e*Math.sin(7*Math.PI/4)),{x:i,y:s}})(o,i);let x=v,O=b;if(f===m){x+=y[0],O+=y[1];const t={attrs:{r:f/2+p,fill:r,stroke:l,x,y:O},name:"badges-circle"};g&&(t.id=g),e.addShape("circle",t)}else{x=v-f-2*p,O=b-m-2*p,"LB"===o?O=b:"RT"===o?(x=v,O=b-m-2*p):"RB"===o&&(x=v,O=b),x+=y[0],O+=y[1];const t={attrs:{width:f+2*p,height:m+2*p,fill:r,stroke:l,x,y:O,radius:(m+2*p)/3},name:"badges-rect"};g&&(t.id=g),e.addShape("rect",t)}"font"===s||"text"===s?e.addShape("text",{attrs:{x:f!==m?x+f/2+p:x,y:f!==m?O+m/2+p:O,text:n,fontSize:c,textAlign:"center",textBaseline:"middle",fontFamily:h,fill:d},capture:!1,name:"badges-text"}):"image"===s&&e.addShape("image",{attrs:{x:x-f/2,y:x-m/2,width:f,height:m,img:n},capture:!1,name:"badges-image"})};var Oe,we=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};function Se(t){return Object.keys(t).forEach((e=>{void 0===t[e]&&delete t[e]})),t}!function(t){t.NORMAL="normal",t.SELECTED="selected",t.HOVERED="hovered",t.DISABLED="disabled"}(Oe||(Oe={}));const je=(t,e)=>{return"keyshape"===e?function(t){const e=we(t,[]);return Se(Object.assign({id:"keyshape"},e))}(t.keyshape||{}):"halo"===e?function(t){const e=we(t,[]);return Se(Object.assign({id:"halo"},e))}(t.halo||{}):"label"===e?function(t){const{value:e}=t,i=we(t,["value"]);return Se(Object.assign({id:"label",text:e},i))}(t.label||{}):"label-background"===e?(i=t[e]||{},Object.assign({id:"label-background"},i)):t[e]||{};var i},Ee=(t,e,i)=>{const s=(e.x+t.x)/2,o=(e.y+t.y)/2,n=e.x-t.x,a=e.y-t.y,r=Math.sqrt(Math.pow(n,2)+Math.pow(a,2));return{x:s+a*i/r||0,y:o-n*i/r||0}};j().registerLayout("graphin-force",{getDefaultCfg:()=>({preset:{name:"grid",options:{}},stiffness:200,repulsion:1e3,centripetalOptions:{leaf:1.6,single:1.6},damping:.9,minEnergyThreshold:.1,maxSpeed:1e3,MaxIterations:1e4,animation:!0}),init(t){this.nodes=t.nodes,this.edges=t.edges;const{graph:e}=this,i=le(this,["graph"]),s=Object.assign(Object.assign({},this.getDefaultCfg()),i),{width:o,height:n,animation:a,done:r=(()=>{})}=s,l=le(s,["width","height","animation","done"]);this.simulation=new re(Object.assign(Object.assign(Object.assign({width:o,height:n,animation:a},l),i),{done:t=>{r(e,t)}})),this.simulation.setData(t),this.simulation.register("render",(i=>{if(!a&&t&&t.nodes&&t.nodes.length>0){const{nodes:e}=i;return t.nodes.forEach(((t,i)=>{const s=e[i];if(s&&s.id===t.id)t.x=e[i].x,t.y=e[i].y;else{const i=e.find((e=>e.id===t.id));i&&(t.x=i.x,t.y=i.y)}})),Object.assign({},i)}try{if(!e||e.destroyed)return;let t=!1;i.nodes.forEach((i=>{const s=e.findById(i.id);if(s){const e=s.get("model");e.x=i.x,e.y=i.y,"combo"===s.getType()&&(t=!0)}})),e.refreshPositions(t)}catch(t){console.error(t)}}))},execute(){this.simulation.start()},layout(t){this.init(t),this.execute()},updateCfg(t){this.cfg=Object.assign(Object.assign({},this.cfg),t)},destroy(){this.destroyed=!0,this.simulation.stop(),this.simulation=null},getType:()=>"graphin-force"}),j().registerLayout("preset",{init(){},execute(){},destroy(){this.destroyed=!0}}),j().registerNode("graphin-circle",{options:{style:{},status:{}},draw(t,e){const{_theme:s}=t.style;this.options=((t={})=>{const e=Mt(t),{defaultNodeStyle:i,defaultNodeStatusStyle:s}=e;return{style:i.style,status:s.status}})(s);const o=(0,i.merge)({},this.options.style,t.style);t._initialStyle=Object.assign({},o);const{icon:n,badges:a=[],keyshape:r}=o,l=ge(r.size);e.addShape("circle",ye(o));const d=e.addShape("circle",fe(o));e.addShape("text",me(o));const{type:c}=n;if("text"!==c&&"font"!==c||e.addShape("text",ve(o)),"image"===c){const t=ve(o),i=e.addShape("image",t),{clip:s}=o.icon;if(s){const{r:t}=s,e=ue(s,["r"]);i.setClip({type:"circle",attrs:Object.assign({x:0,y:0,r:t},e)})}}return a.forEach((t=>{xe(t,e,l)})),d},setState(t,e,s){var o;if(!t)return;const n=s.getModel(),a=s.getContainer().get("children"),r=(0,i.merge)({},this.options.status,n.style.status),l=s.getModel()._initialStyle,d=(null===(o=s._cfg)||void 0===o?void 0:o.states)||[];try{Object.keys(r).forEach((i=>{t===i&&(e?ce(a,r[i],be):(ce(a,l,be),d.forEach((t=>{ce(a,r[t],be)}))))}))}catch(t){console.error(t)}},update(t,e){if(t.style)try{const s=(0,i.merge)({},t._initialStyle,t.style);t._initialStyle=Object.assign({},s);const{badges:o,keyshape:n}=s,a=ge(n.size),r=e.getContainer(),l=r.get("children");ce(l,s,be);const d=[...l];if(o){let t=0;d.forEach((e=>{e.cfg.name.startsWith("badges")?l.splice(t,1):t+=1})),o.forEach((t=>{xe(t,r,a)}))}}catch(t){console.error("error")}}}),j().registerEdge("graphin-line",{draw(t,e){var s,o,n,a,r,l,d;const{_theme:c}=t.style;this.options=((t={})=>{const e=Mt(t),{defaultEdgeStyle:i,defaultEdgeStatusStyle:s}=e;return{style:i.style,status:s.status}})(c);const h=(0,i.merge)({},this.options.style,t.style);t&&(t._initialStyle=Object.assign({},h));const{startPoint:p={x:0,y:0},endPoint:u={x:0,y:0},sourceNode:g,targetNode:y}=t,{label:f,halo:m,keyshape:v}=h,b=g.get("model"),x=(null===(s=y)||void 0===s?void 0:s.get("model"))||{id:"temp"},O=(null===(n=null===(o=b.style)||void 0===o?void 0:o.keyshape)||void 0===n?void 0:n.size)||28,w="loop"===(null==v?void 0:v.type)||b.id===x.id,S=f.value,j="poly"===(null==v?void 0:v.type),E=Ee(p,u,(null===(a=null==v?void 0:v.poly)||void 0===a?void 0:a.distance)||0),C=(null==v?void 0:v.lineWidth)||1,k=C+5,N=((t,e)=>{var i,s,o;const{startPoint:n={x:0,y:0},endPoint:a={x:0,y:0},sourceNode:r,targetNode:l}=t,{keyshape:d}=e,{type:c="line",poly:h={distance:0},loop:p={}}=d,u=r.get("model"),g=(null===(i=l)||void 0===i?void 0:i.get("model"))||{id:"temp"};if("loop"===c||u.id===g.id){const t=(null===(o=null===(s=u.style)||void 0===s?void 0:s.keyshape)||void 0===o?void 0:o.size)||26,{distance:e,dx:i,rx:a,ry:r}=Object.assign({distance:0,dx:8,rx:void 0,ry:void 0},p),l=t/2,d=Math.sqrt(Math.max(Math.pow(l,2)-Math.pow(i,2),0)),c=a||2*l*.5,h=r||2*l*.6;return[["M",n.x-i,n.y-d],["A",c+e,h+e,0,1,1,n.x+i,n.y-d]]}if("poly"===c){const t=Ee(n,a,(null==h?void 0:h.distance)||0);return[["M",n.x,n.y],["Q",t.x,t.y,a.x,a.y]]}return[["M",n.x,n.y],["L",a.x,a.y]]})(t,h);e.addShape("path",{attrs:Object.assign({id:"halo",path:N,lineWidth:C+10,stroke:m.stroke||v.stroke,strokeOpacity:m.strokeOpacity||.4},m),draggable:!0,name:"halo",visible:!1!==m.visible});const M=e.addShape("path",{attrs:Object.assign({id:"keyshape",path:N,endArrow:w?void 0:{d:0,path:`M 0,0 L ${k},${k/2} L ${k},-${k/2} Z`,fill:v.stroke},startArrow:w?{d:0,path:`M 0,0 L ${k},${k/2} L ${k},-${k/2} Z`,fill:v.stroke}:void 0},v),draggable:!0,name:"keyshape"});if(S){const{value:t,fontSize:i=8,offset:s=[0,0],background:o}=f,n=we(f,["value","fontSize","offset","background"]),a=Boolean(o),[c,h]=s;let g=Math.atan((u.y-p.y)/(u.x-p.x)),y=[(p.x+u.x)/2,(p.y+u.y)/2];if(j&&(y=[(E.x+y[0])/2,(E.y+y[1])/2]),u.x-p.x==0&&(g=Math.PI/2),w&&(g=2*Math.PI),a){const s={fill:"#fff",width:$(t)*i*.6,height:1.8*i,stroke:v.stroke,lineWidth:1,radius:6},n=Object.assign(Object.assign({},s),o),{fill:a,width:l,height:d,stroke:p}=n,u=we(n,["fill","width","height","stroke"]);let f=-d/2+h;w&&(f=-(d/2+h+i+1*O+2*((null===(r=null==v?void 0:v.loop)||void 0===r?void 0:r.distance)||0)));const m=e.addShape("rect",{attrs:Object.assign({id:"label-background",x:-l/2+c,y:f,width:l,height:d,fill:a,stroke:p},u),draggable:!0,name:"label-background"});m.rotate(g),m.translate(y[0],y[1])}let m=h-i/2;a&&(m=h+i/2),w&&(m=a?-(h+i/2+1*O+2*((null===(l=null==v?void 0:v.loop)||void 0===l?void 0:l.distance)||0)):-(h+i+1*O+2*((null===(d=null==v?void 0:v.loop)||void 0===d?void 0:d.distance)||0)));const b=e.addShape("text",{attrs:Object.assign({id:"label",x:c,y:m,text:t,fontSize:i},n),draggable:!0,name:"label"});b.rotate(g),b.translate(y[0],y[1])}return M},setState(t,e,s){var o;if(!t)return;const n=s.getModel(),a=s.getContainer().get("children"),r=(0,i.merge)({},this.options.status,n.style.status),l=s.getModel()._initialStyle,d=(null===(o=s._cfg)||void 0===o?void 0:o.states)||[];try{Object.keys(r).forEach((i=>{var s;t===i&&(e?ce(a,r[i],je):(ce(a,Object.assign(Object.assign({},l),{"label-background":null===(s=l.label)||void 0===s?void 0:s.background}),je),d.forEach((t=>{ce(a,r[t],je)}))))}))}catch(t){console.error(t)}},afterDraw(t,e){const s=(0,i.merge)({},this.options.style,t.style),{animate:o,keyshape:n}=s;if(!o||!o.type||!1===o.visible)return;const a=e.get("children").find((t=>"keyshape"===t.get("name"))),{color:r,type:l,repeat:d=!0,duration:c=3e3}=o;if("circle-running"===l){const t=a.getPoint(0);e.addShape("circle",{attrs:{x:t.x,y:t.y,fill:r||n.stroke,r:1.5*n.lineWidth+2},name:"circle-shape"}).animate((t=>{const e=a.getPoint(t);return{x:e.x,y:e.y}}),{repeat:d,duration:c})}if("line-dash"===l){let t=0;const e=o.lineDash||n.lineDash||[4,2,1,2];a.animate((()=>(t++,t>9&&(t=0),{lineDash:e,lineDashOffset:-t})),{repeat:d,duration:c})}if("line-growth"===l){const t=a.getTotalLength();a.animate((e=>{const i=e*t;return{lineDash:[i,t-i]}}),{repeat:d,duration:c})}}});const{registerFontFamily:Ce}=Rt,ke=Rt})(),a})()}));