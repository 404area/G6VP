!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("G6"),require("React"),require("_")):"function"==typeof define&&define.amd?define(["G6","React","_"],e):"object"==typeof exports?exports.Graphin=e(require("G6"),require("React"),require("_")):t.Graphin=e(t.G6,t.React,t._)}(self,((t,e,i)=>(()=>{"use strict";var s={835:e=>{e.exports=t},24:t=>{t.exports=e},479:t=>{t.exports=i}},o={};function n(t){var e=o[t];if(void 0!==e)return e.exports;var i=o[t]={exports:{}};return s[t](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{n.r(a),n.d(a,{Behaviors:()=>x,Components:()=>pt,G6:()=>E(),GraphinContext:()=>o,Utils:()=>J,default:()=>Ne,registerFontFamily:()=>ke,useBehaviorHook:()=>r});var t={};n.r(t),n.d(t,{handleAutoZoom:()=>mt,handleChangeZoom:()=>yt,handleRealZoom:()=>ft,handleZoomIn:()=>gt,handleZoomOut:()=>ut});var e={};n.r(e),n.d(e,{focusNodeById:()=>bt,highlightNodeById:()=>vt});var i=n(24),s=n.n(i);const o=s().createContext({graph:{},apis:{},theme:{},layout:{}});const r=t=>{const{type:e,defaultConfig:i,userProps:n,mode:a="default"}=t,{graph:r}=s().useContext(o),{disabled:l}=n,d=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i}(n,["disabled"]);s().useEffect((()=>{if(r&&!r.destroyed&&(r.removeBehaviors(e,a),!l))return r.addBehaviors(Object.assign(Object.assign({type:e},i),d),a),()=>{r.destroyed||r.removeBehaviors(e,a)}}),[])},l={disabled:!1,trigger:"mouseenter",activeState:"active",inactiveState:"inactive",resetSelected:!1},d={disabled:!1,brushStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},onSelect:()=>{},onDeselect:()=>{},selectedState:"selected",trigger:"shift",includeEdges:!0,includeCombos:!1},c={disabled:!1,multiple:!0,trigger:"shift",selectedState:"selected",selectNode:!0,selectEdge:!1,selectCombo:!0},h={direction:"both",enableOptimize:!1,scalableRange:0,shouldBegin:()=>!0,disabled:!1},p={disabled:!1,enableDelegate:!1,delegateStyle:{},onlyChangeComboSize:!1,activeState:"",selectedState:"selected"},u={disabled:!1,updateEdge:!0,delegateStyle:{},enableDelegate:!1,onlyChangeComboSize:!1,comboActiveState:"",selectedState:"selected"},g=t=>{const{graph:e,layout:n,dragNodes:a,updateContext:r}=s().useContext(o),{autoPin:l,pinAction:d,dragNodeMass:c=1e10}=t,{instance:h}=n;return(0,i.useEffect)((()=>{var t;const{simulation:i,type:s}=h||{type:null===(t=e.get("layout"))||void 0===t?void 0:t.type},o=()=>{var t;i?i.stop():((null===(t=e.get("layoutController"))||void 0===t?void 0:t.layoutMethods)||[]).forEach((t=>{var e;return null===(e=t.stop)||void 0===e?void 0:e.call(t)}))},n=t=>{if(("graphin-force"===s||"force2"===s)&&t.item){const i=t.item.get("model");i.layout=Object.assign(Object.assign({},i.layout),{force:{mass:l?c:null}});const s=[];e.getNodes().forEach((t=>{if(t.hasState("selected")){const e=t.get("model");e.layout||(e.layout={}),e.layout.force={mass:l?c:null},s.push(e)}}));let o=a.concat([i]);s.length>1&&(o=o.concat(s)),r({dragNodes:o})}};return e.on("node:dragstart",o),e.on("node:dragend",n),()=>{e.off("node:dragstart",o),e.off("node:dragend",n)}}),[e,l,h,a,r]),(0,i.useEffect)((()=>{const{id:t,pinned:i}=d||{};if(!t)return;let s=a;if(i){const i=e.findById(t);if(!i)return;const o=i.get("model");o.layout||(o.layout={}),o.layout.force={mass:l?c:null},s.push(o)}else s=a.filter((e=>e.id!==t));r({dragNodes:s})}),[d]),null};g.defaultProps={autoPin:!1,dragNodeMass:1e10,pinAction:void 0};const y=g,f={disabled:!1,delegateStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},onSelect:()=>{},onDeselect:()=>{},selectedState:"selected",trigger:"shift",includeEdges:!0};var m=n(479);const v={trigger:"click"},b={sensitivity:2,minZoom:void 0,maxZoom:void 0,enableOptimize:!1,optimizeZoom:.1,fixSelectedItems:{fixAll:!1,fixLineWidth:!1,fixLabel:!1,fixState:"selected"},disabled:!1,animate:!1,animateCfg:{duration:500}},x={DragCanvas:t=>(r({type:"drag-canvas",userProps:t,defaultConfig:h}),null),ZoomCanvas:t=>(r({type:"zoom-canvas",userProps:t,defaultConfig:b}),null),ClickSelect:t=>(r({type:"click-select",userProps:t,defaultConfig:c}),null),BrushSelect:t=>(r({type:"brush-select",userProps:t,defaultConfig:d}),null),DragNode:t=>(r({type:"drag-node",userProps:t,defaultConfig:u}),null),ResizeCanvas:t=>{const{graphDOM:e}=t,s=i.useContext(o);return i.useEffect((()=>{const{graph:t}=s,i=(0,m.debounce)((()=>{const{clientWidth:i,clientHeight:s}=e;t.set("width",i),t.set("height",s);const o=t.get("canvas");o&&(o.changeSize(i,s),t.autoPaint())}),200);return window.addEventListener("resize",i,!1),()=>{window.removeEventListener("resize",i,!1)}}),[]),null},LassoSelect:t=>(r({type:"lasso-select",userProps:t,defaultConfig:f}),null),DragCombo:t=>(r({type:"drag-combo",userProps:t,defaultConfig:p}),null),ActivateRelations:t=>(r({type:"activate-relations",userProps:t,defaultConfig:l}),null),TreeCollapse:t=>{const{onChange:e}=t,s=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i}(t,["onChange"]),{graph:n}=i.useContext(o);return r({defaultConfig:v,userProps:s,type:"collapse-expand"}),i.useEffect((()=>{const t=t=>{const{item:i,collapsed:s}=t;i.get("model").collapsed=s,e&&e(i,s)};return n.on("itemcollapsed",t),()=>{n.off("itemcollapsed",t)}}),[]),null},FitView:t=>{const{padding:e,isBindLayoutChange:n}=t,{graph:a}=s().useContext(o);return(0,i.useEffect)((()=>{const t=()=>{a.fitView(e)};return t(),n&&a.on("afterlayout",t),()=>{n&&a.off("afterlayout",t)}}),[]),null},FontPaint:()=>{const{graph:t}=s().useContext(o);return s().useEffect((()=>{const e=setTimeout((()=>{t.getNodes().forEach((e=>{t.setItemState(e,"normal",!0)})),t.paint()}),1600);return()=>{clearTimeout(e)}}),[]),null},DragNodeWithForce:y,Hoverable:t=>{const e=i.useContext(o),{bindType:s="node",disabled:n}=t,{graph:a}=e;return i.useEffect((()=>{if(n)return;const t=t=>{a.setItemState(t.item,"hover",!0)},e=t=>{a.setItemState(t.item,"hover",!1)},i=t=>{a.setItemState(t.item,"hover",!0)},o=t=>{a.setItemState(t.item,"hover",!1)};return"node"===s&&(a.on("node:mouseenter",t),a.on("node:mouseleave",e)),"edge"===s&&(a.on("edge:mouseenter",i),a.on("edge:mouseleave",o)),()=>{"node"===s&&(a.off("node:mouseenter",t),a.off("node:mouseleave",e)),"edge"===s&&(a.off("edge:mouseenter",i),a.off("edge:mouseleave",o))}}),[a,n]),null}},O=t=>{const{bindType:e="node",container:n,disableAutoAdjust:a}=t,{graph:r}=s().useContext(o),[l,d]=s().useState({visible:!1,x:0,y:0,item:null,selectedItems:[]}),c=t=>{t.preventDefault(),t.stopPropagation();const i=r.get("width"),s=r.get("height");if(!n.current)return;const o=n.current.getBoundingClientRect(),l=r.get("offsetX")||0,c=r.get("offsetY")||0,h=r.getContainer().offsetTop,p=r.getContainer().offsetLeft;let u=t.canvasX+p+l,g=t.canvasY+h+c;if(a||(u+o.width>i&&(u=t.canvasX-o.width-l+p),g+o.height>s&&(g=t.canvasY-o.height-c+h)),"node"===e){const{x:e,y:i}=t.item&&t.item.getModel(),s=r.getCanvasByPoint(e,i),o=t.canvasX-s.x,n=t.canvasY-s.y;u-=o,g-=n}d((e=>Object.assign(Object.assign({},e),{visible:!0,x:u,y:g,item:t.item})))},h=()=>{d((t=>t.visible?Object.assign(Object.assign({},t),{visible:!1,x:0,y:0}):t))};(0,i.useEffect)((()=>{const t=t=>{d((e=>Object.assign(Object.assign({},e),{selectedItems:t.selectedItems})))};return r.on(`${e}:contextmenu`,c),r.on("canvas:click",h),r.on("canvas:drag",h),r.on("wheelzoom",h),"canvas"===e&&r.on("nodeselectchange",t),()=>{r.off(`${e}:contextmenu`,c),r.off("canvas:click",h),r.off("canvas:drag",h),r.off("wheelzoom",h),r.off("nodeselectchange",t)}}),[r,e]);const{x:p,y:u,visible:g,item:y,selectedItems:f}=l;return{oneShow:c,onClose:h,item:y,selectedItems:f,visible:g,x:p,y:u}},w={width:"120px",boxShadow:"0 4px 12px rgb(0 0 0 / 15%)"},S=s().createRef();var j=n(835),E=n.n(j);const C={r:249,scaleRByWheel:!0,minR:100,maxR:500,delegateStyle:{stroke:"#000",strokeOpacity:.8,lineWidth:2,fillOpacity:.1,fill:"#ccc"},showLabel:!1};var k=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};const N={members:[],type:"round-convex",nonMembers:[],style:{fill:"lightblue",stroke:"blue",opacity:.2},padding:10},M=(t,e)=>{const{style:i={}}=t,s=k(t,["style"]),{style:o={}}=e,n=k(e,["style"]);return Object.assign(Object.assign(Object.assign({},s),n),{style:Object.assign(Object.assign({},i),o)})};let P;const D=[{type:"graphin-force",options:{},title:"渐进力导"},{type:"force",title:"D3力导",options:{preventOverlap:!0,linkDistance:250,nodeStrength:30,edgeStrength:.1,collideStrength:.8,nodeSize:30,alpha:.3,alphaDecay:.028,alphaMin:.01,forceSimulation:null,clustering:!1}},{type:"concentric",title:"同心圆布局",options:{minNodeSpacing:60,preventOverlap:!0,nodeSize:60}},{type:"grid",options:{},title:"网格布局"},{type:"radial",options:{},title:"辐射布局"},{type:"dagre",title:"层次布局",options:{}},{type:"circular",options:{},title:"环形布局"},{type:"gForce",options:{linkDistance:()=>200,preventOverlap:!0},title:"G6力导"},{type:"mds",options:{},title:"降维布局"},{type:"random",options:{},title:"随机布局"}],L=D.map((t=>{const{type:e,options:i}=t;return Object.assign({type:e},i)})).reduce(((t,e)=>Object.assign(Object.assign({},t),{[e.type]:e})),{}),_=()=>({type:"circle",style:{labelCfg:{position:"top"}},status:{}}),T={primaryEdgeColor:"#ddd",edgeSize:1,mode:"light"},I=t=>{const{edgeSize:e,primaryEdgeColor:i,mode:s}=Object.assign(Object.assign({},T),t),o={light:{stroke:i,label:i,disabled:"#ddd"},dark:{stroke:i,label:i,disabled:"#ddd3"}}[s];return{type:"graphin-line",style:{keyshape:{type:"line",lineWidth:e,stroke:o.stroke,strokeOpacity:1,lineAppendWidth:9,cursor:"pointer"},halo:{visible:!1,cursor:"pointer",strokeOpacity:.4},label:{value:"",position:"top",fill:o.label,fontSize:12,textAlign:"center"},animate:{}},status:{hover:{halo:{visible:!0}},selected:{halo:{visible:!0},keyshape:{lineWidth:2},label:{visible:!0}},active:{halo:{visible:!0},keyshape:{lineWidth:2},label:{visible:!0}},inactive:{halo:{visible:!1},keyshape:{strokeOpacity:.1},label:{visible:!1}},disabled:{halo:{visible:!1},keyshape:{lineWidth:.5,stroke:o.disabled},label:{visible:!1}}}}},A={primaryColor:"#FF6A00",nodeSize:26,mode:"light"},$=t=>{const{nodeSize:e,primaryColor:i,mode:s}=Object.assign(Object.assign({},A),t),o={light:{fill:i,fillOpacity:.1,stroke:i,strokeOpacity:1,icon:i,badge:{fill:i,stroke:i,font:"#fff"},label:"#000",disabled:"#ddd"},dark:{fill:i,fillOpacity:.3,stroke:i,strokeOpacity:1,icon:"#fff",badge:{fill:i,stroke:i,font:"#fff"},label:"#fff",disabled:"#ddd3"}}[s];return{type:"graphin-circle",style:{keyshape:{size:e,fill:o.fill,fillOpacity:o.fillOpacity,stroke:o.stroke,strokeOpacity:o.strokeOpacity,lineWidth:1,opacity:1,type:"circle"},label:{position:"bottom",value:"",fill:o.label,fontSize:12,offset:0,background:void 0,fillOpacity:1},icon:{type:"text",value:"",size:e/2,fill:o.icon,fillOpacity:1,offset:[0,0]},badges:[],halo:{visible:!1,fillOpacity:.1}},status:{normal:{},selected:{halo:{visible:!0},keyshape:{lineWidth:5}},hover:{halo:{visible:!0}},active:{},inactive:{keyshape:{fillOpacity:.04,strokeOpacity:.04},icon:{fillOpacity:.04},label:{fillOpacity:.04}},disabled:{halo:{visible:!1},keyshape:{fill:o.disabled,stroke:o.disabled},icon:{fill:o.disabled},label:{fill:o.disabled}}}}},z=t=>Array.from(String(t)).reduce(((t,e)=>e.charCodeAt(0)>255?t+2:t+1),0),F=t=>Math.floor(Math.random()*t),B={},R=t=>"#"===t.charAt(0)?t.slice(1):t,W=t=>{const e=3===t.length||4===t.length;return{r:e?`${t.slice(0,1)}${t.slice(0,1)}`:t.slice(0,2),g:e?`${t.slice(1,2)}${t.slice(1,2)}`:t.slice(2,4),b:e?`${t.slice(2,3)}${t.slice(2,3)}`:t.slice(4,6),a:(e?`${t.slice(3,4)}${t.slice(3,4)}`:t.slice(6,8))||"ff"}},G=t=>parseInt(t,16),q=({r:t,g:e,b:i,a:s})=>({r:G(t),g:G(e),b:G(i),a:+(G(s)/255).toFixed(2)});class H{constructor(t){this.nodeIds=[],this.bfs=t=>{var e;if(!this.root)return;const i=[];for(i.push(this.root);i.length;){const s=i.shift();if(t(s))return s;(null===(e=null==s?void 0:s.children)||void 0===e?void 0:e.length)&&i.push(...s.children)}},this.getRoot=()=>this.root,this.getNode=t=>this.bfs((e=>e.id===t)),this.addRoot=(t,e)=>{this.root={id:t,children:[]},this.nodeIds.push(t)},this.addNode=t=>{const{parentId:e,id:i,data:s}=t;if(!this.root)return void this.addRoot(i,s);let o;if(e)o=this.getNode(e);else{const t=Math.floor(Math.random()*this.nodeIds.length);o=this.getNode(this.nodeIds[t])}o?(this.nodeIds.push(i),o.children.push({id:i,parent:o,children:[]})):console.error("Parent node doesn't exist!")},t&&(this.root=t)}}const Z=(t,e)=>{e(t),t.children&&t.children.length>0&&t.children.forEach((t=>{Z(t,e)}))},V=Z,U={nodeCount:10,nodeType:"company"};class X{constructor(t){this.initNodes=()=>{const{nodeCount:t,nodeType:e}=this.options,i=Array.from({length:t});this.nodes=i.map(((t,i)=>({id:`node-${i}`,label:`node-${i}`,type:e})));for(let e=0;e<t;e+=1)for(let i=0;i<t-1;i+=1)this.edges.push({source:`node-${e}`,target:`node-${i}`});this.nodeIds=this.nodes.map((t=>t.id))},this.expand=t=>(this.edges=[],this.nodes=[],t.forEach((t=>{for(let e=0;e<this.options.nodeCount;e+=1)this.nodes.push({id:`${t.id}-${e}`,type:t.type}),this.edges.push({source:`${t.id}-${e}`,target:t.id})})),this),this.type=t=>(this.nodes=this.nodes.map((e=>Object.assign(Object.assign({},e),{type:t}))),this),this.circle=(t="")=>{let e=t;return-1===this.nodeIds.indexOf(e)&&(e="node-0"),this.edges=this.edges.filter((t=>t.source===e||t.target===e)),this},this.random=(t=.5)=>{const{nodeCount:e}=this.options,i=parseInt(String(e*t)),s=this.nodeIds.sort((()=>Math.random()-.5)).slice(0,i);return this.edges=this.edges.filter((t=>-1!==s.indexOf(t.target))),this.edges=this.edges.sort((()=>Math.random()-.5)).slice(0,i),this},this.tree=()=>{this.edges=[],this.treeData=new H;const t=this.nodeIds[0];return this.nodeIds.forEach((t=>{this.treeData.addNode({id:t,style:{label:{value:t}}})})),this.treeData.bfs((e=>{var i;return e.id!==t&&this.edges.push({source:null===(i=null==e?void 0:e.parent)||void 0===i?void 0:i.id,target:e.id,properties:[]}),!1})),this},this.value=()=>({nodes:this.nodes,edges:this.edges}),this.combos=t=>{const e=new Set;return this.nodes=this.nodes.map(((i,s)=>{const o=`combo-${Math.ceil((s+1)/t)}`;return e.add(o),Object.assign(Object.assign({},i),{comboId:o})})),this.combosData=[...e].map((t=>({id:t,label:t}))),this},this.graphin=()=>({nodes:this.nodes.map((t=>Object.assign(Object.assign({},t),{id:t.id,type:"graphin-circle",comboId:t.comboId,style:{label:{value:`${t.id}`}}}))),edges:this.edges.map((t=>({source:t.source,target:t.target}))),combos:this.combosData}),this.graphinTree=()=>{const t=this.treeData.getRoot();return V(t,(t=>{delete t.parent})),t},this.options=U,this.options.nodeCount=t,this.nodes=[],this.edges=[],this.nodeIds=[],this.treeData=new H,this.initNodes()}}function Y(t){return t%2==0}const K=(t,e)=>e.split(".").reduce(((t,e,i,s)=>{const o=t[e];return o||i===s.length-1?o:{}}),t),Q=t=>()=>{console.error(`⚠️ @antv/graphin Utils 不再提供 ${t} 方法，请从 lodash 中引入！`),console.error(`⚠️ @antv/graphin Utils no longer provides ${t} methods, please use lodash instead!`)},J={hexToRgba:(t,e)=>{const i=R(t),s=W(i);return((t,e)=>{const{r:i,g:s,b:o,a:n}=t;var a;return`rgba(${i}, ${s}, ${o}, ${a=e,!isNaN(parseFloat(String(a)))&&isFinite(Number(a))?e:n})`})(q(s),e)},debug:t=>(B[t]||(B[t]=((t=1)=>`rgba(${F(255)},${F(255)},${F(255)},${t})`)()),B[t],(...t)=>{}),mock:t=>new X(t),shallowEqual:(t,e)=>{let i=!0;const s=Object.keys(t),o=Object.keys(e);if(s.length!==o.length)return!1;for(let o=0;o<s.length;o++){const n=s[o];if(t[n]!==e[n]){i=!1;break}}return i},hexToRgbaToHex:(t,e=1)=>{const i=R(t),s=W(i),o=q(s),{r:n,g:a,b:r}=o;let l=n.toString(16),d=a.toString(16),c=r.toString(16),h=Math.round(255*Number(e)).toString(16);return 1===l.length&&(l=`0${l}`),1===d.length&&(d=`0${d}`),1===c.length&&(c=`0${c}`),1===h.length&&(h=`0${h}`),`#${l}${d}${c}${h}`},getNodeStyleByTheme:$,getEdgeStyleByTheme:I,getComboStyleByTheme:_,deepMix:Q("deepMix"),cloneDeep:Q("cloneDeep"),uuid:()=>{function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return`${t()+t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`},walk:V,processEdges:(t,{poly:e=30,loop:i=10,loopLabelPosition:s=1}={poly:30,loop:10,loopLabelPosition:1})=>{const o={};t.forEach(((t,e)=>{const i=Object.assign({},t),{source:s,target:n}=i,a=`${s}-${n}`;i.id=i.id||`${s}-${n}-${e}`;const r=`${n}-${s}`;o[a]?o[a].push(i):o[r]?(i.revert=!0,o[r].push(i)):o[a]=[i]}));const n=Object.values(o),a=[];return n.forEach((t=>{if(t.length>1){const o=Y(t.length);t.forEach(((t,n)=>{var r;const{source:l,target:d}=t,c=l===d,h=n;let p;if(o){const t=Math.ceil((h+1)/2);p=e*t}else{const t=Y(h)?h:h+1,i=Math.ceil(t/2);p=e*i}let u,g=Y(h)?p:-p;if(t.revert&&(g=-g,delete t.revert),c){const e=h*i;if(u={type:"loop",loop:{distance:e}},null===(r=t.style)||void 0===r?void 0:r.label){const i=0,o=-(30*s+2*e);t.style.label.offset=[i,o]}}else u={type:"poly",poly:{distance:g}};(0,m.merge)(t,{style:{keyshape:u}}),t.isMultiple=!0,a.push(t)}))}else a.push(t[0])})),a},calcByteLength:z,layouts:D,uniqBy:Q("uniqBy"),getEnumDataMap:(t,e)=>{const i=new Map;return t.forEach((t=>{const s=K(t,e),o=i.get(s);o?i.set(s,[...o,t]):i.set(s,[t])})),i},getEnumValue:K},{getEnumValue:tt,getEnumDataMap:et}=J,it=({bindType:t="node",sortKey:e})=>{const i=s().useContext(o),{graph:n}=i,a=n.save();if(a.children)return console.error("not support tree graph"),{dataMap:new Map,options:{}};const r=et(a[`${t}s`],e),l=[...r.keys()].map((t=>{const e=(r.get(t)||[{}])[0],i=tt(e,"style.keyshape.fill"),s=tt(e,"style.color");return{color:i||s,value:t,label:t,checked:!0}}));return{dataMap:r,options:l}},st={position:"absolute",top:"0px",right:"0px"},ot=t=>{const{bindType:e="node",sortKey:i,children:o,style:n}=t,{dataMap:a,options:r}=it({bindType:e,sortKey:i});return s().createElement("div",{className:"graphin-components-legend",style:Object.assign(Object.assign({},st),n)},o({bindType:e,sortKey:i,dataMap:a,options:r}))};ot.Node=t=>{const{graph:e,theme:n}=s().useContext(o),{options:a,dataMap:r,onChange:l}=t,{mode:d}=n,[c,h]=s().useState({options:a});(0,i.useEffect)((()=>{h({options:a})}),[a]);const{options:p}=c,u=t=>{const i=Object.assign(Object.assign({},t),{checked:!t.checked}),s=p.map((e=>e.value===t.value?i:e));h({options:s}),r.get(i.value).forEach((t=>{e.setItemState(t.id,"active",i.checked),e.setItemState(t.id,"inactive",!i.checked);const{id:s}=t;e.findById(s).getEdges().forEach((t=>{e.setItemState(t,"normal",i.checked),e.setItemState(t,"inactive",!i.checked)}))})),l(i,s)};return s().createElement("ul",{className:"graphin-components-legend-content"},p.map((t=>{const{label:e,checked:i,color:o}=t,n={light:{active:o,inactive:"#ddd"},dark:{active:o,inactive:"#2f2f2f"}},a=i?"active":"inactive";return s().createElement("li",{key:t.value,className:"item",onClick:()=>{u(t)},onKeyDown:()=>{u(t)}},s().createElement("span",{className:"dot",style:{background:n[d][a]}}),s().createElement("span",{className:"label",style:{color:{light:{active:"#000",inactive:"#ddd"},dark:{active:"#fff",inactive:"#2f2f2f"}}[d][a]}},e))})))};const nt=ot,at={className:"graphin-minimap",viewportClassName:"graphin-minimap-viewport",type:"default",padding:50,size:[200,120],delegateStyle:{fill:"#40a9ff",stroke:"#096dd9"},refresh:!0},rt={position:"absolute",bottom:0,left:0,background:"#fff",boxShadow:"0px 8px 10px -5px rgba(0,0,0,0.2), 0px 16px 24px 2px rgba(0,0,0,0.14), 0px 6px 30px 5px rgba(0,0,0,0.12)"},lt={line:{stroke:"#FA8C16",lineWidth:.5},itemAlignType:"center"},dt=t=>{const{bindType:e="node",container:n}=t,a=s().useContext(o),{graph:r}=a,l=(0,i.useRef)(),[d,c]=s().useState({visible:!1,x:0,y:0,item:null}),h=i=>{i.preventDefault(),i.stopPropagation(),l.current&&window.clearTimeout(l.current);const s=r.getPointByClient(i.clientX,i.clientY);let{x:o,y:n}=r.getCanvasByPoint(s.x,s.y);if("node"===e&&i.item){const{x:t=0,y:e=0}=i.item.getModel(),s=r.getCanvasByPoint(t,e),a=i.canvasX-s.x,l=i.canvasY-s.y;o-=a,n-=l}l.current=window.setTimeout((()=>{c((t=>Object.assign(Object.assign({},t),{visible:!0,item:i.item,x:o,y:n})))}),t.delay.show)},p=()=>{l.current&&window.clearTimeout(l.current),l.current=window.setTimeout((()=>{c((t=>Object.assign(Object.assign({},t),{visible:!1,item:null,x:0,y:0})))}),t.delay.hide)},u=()=>{c(Object.assign(Object.assign({},d),{visible:!1,x:0,y:0,item:null}))},g=t=>{const i=r.getPointByClient(t.clientX,t.clientY);let{x:s,y:o}=r.getCanvasByPoint(i.x,i.y);if("node"===e){if(t.item){const{x:e=0,y:i=0}=t.item.getModel(),n=r.getCanvasByPoint(e,i);s-=t.canvasX-n.x,o-=t.canvasY-n.y}c(Object.assign(Object.assign({},d),{visible:!0,x:s,y:o,item:t.item}))}},y=()=>{clearTimeout(l.current)};return(0,i.useEffect)((()=>{var t,i;return r.on(`${e}:mouseenter`,h),r.on(`${e}:mouseleave`,p),r.on("afterremoveitem",p),r.on("node:dragstart",u),r.on("node:dragend",g),null===(t=n.current)||void 0===t||t.addEventListener("mouseenter",y),null===(i=n.current)||void 0===i||i.addEventListener("mouseleave",p),()=>{var t,i;console.log("effect..remove...."),r.off(`${e}:mouseenter`,h),r.off(`${e}:mouseleave`,p),r.off("afterremoveitem",p),r.off("node:dragstart",u),r.off("node:dragend",g),null===(t=n.current)||void 0===t||t.removeEventListener("mouseenter",y),null===(i=n.current)||void 0===i||i.removeEventListener("mouseleave",p)}}),[]),Object.assign({},d)},ct={width:"120px",boxShadow:"0 4px 12px rgb(0 0 0 / 15%)"},ht=s().createRef(),pt={ContextMenu:t=>{const{bindType:e,children:i,style:o,disableAutoAdjust:n}=t,a=O({bindType:e,container:S,disableAutoAdjust:n}),{visible:r,x:l,y:d,item:c}=a,h={position:"absolute",left:l,top:d};if("function"!=typeof i)return console.error("<ContextMenu /> children should be a function"),null;const p=c&&!c.destroyed&&c.getModel&&c.getModel().id||"";return s().createElement("div",{ref:S,className:"graphin-components-contextmenu",style:Object.assign(Object.assign(Object.assign({},w),o),h),key:p},r&&i(Object.assign(Object.assign({},a),{id:p})))},Hull:t=>{const e=s().useContext(o),{graph:i}=e,{options:n}=t;return s().useEffect((()=>{P&&P.length&&P.forEach((t=>i.removeHull(t))),P=n.map((t=>i.createHull(M(N,Object.assign({id:`${Math.random()}`},t)))));const t=(0,m.debounce)((()=>{P.forEach(((t,e)=>{t.group.destroyed?P[e]=i.createHull(M(N,Object.assign({id:`${Math.random()}`},n[e]))):t.updateData(t.members)}))}));return i.on("afterupdateitem",t),i.on("aftergraphrefreshposition",t),()=>{i.off("afterupdateitem",t),i.off("aftergraphrefreshposition",t)}}),[i,n]),null},MiniMap:t=>{const{graph:e}=s().useContext(o),{options:i,style:n={}}=t,a=s().useRef(null);s().useEffect((()=>{const t=e.getWidth(),s=e.getHeight(),o=e.get("fitViewPadding"),n=[(t-2*o)/(s-2*o)*120,120],r=Object.assign(Object.assign(Object.assign({container:a.current},at),{size:n}),i),l=new(E().Minimap)(r);return e.addPlugin(l),()=>{l&&!l.destroyed&&e.removePlugin(l)}}),[i]);const r=Object.assign(Object.assign({},rt),n);return s().createElement("div",{ref:a,style:r})},FishEye:t=>{const{graph:e}=s().useContext(o),{options:i,visible:n,handleEscListener:a}=t;return s().useEffect((()=>{const t=Object.assign(Object.assign({},C),i);t.showLabel&&e.getNodes().forEach((t=>{t.getContainer().getChildren().forEach((t=>{"text"===t.get("type")&&t.hide()}))}));const s=new(E().Fisheye)(t),o=t=>{27===t.keyCode&&a&&(a(),e.get("canvas").setCursor("default"))};return n&&(e.addPlugin(s),e.get("canvas").setCursor("zoom-in")),a&&window.addEventListener("keydown",o),()=>{e&&!e.destroyed&&(e.get("canvas").setCursor("default"),e.removePlugin(s)),a&&window.removeEventListener("keydown",o)}}),[e,i,n,a]),null},SnapLine:t=>{const{graph:e}=s().useContext(o),{options:i,visible:n}=t;return s().useEffect((()=>{const t=Object.assign(Object.assign({},lt),i),s=new(E().SnapLine)(t);return n&&e.addPlugin(s),()=>{e&&!e.destroyed&&e.removePlugin(s)}}),[e,i,n]),null},Tooltip:t=>{const{children:e,bindType:i="node",style:n,placement:a="top",hasArrow:r,delay:l={show:0,hide:200}}=t,{x:d,y:c,visible:h,item:p}=dt({bindType:i,container:ht,delay:l}),{graph:u}=s().useContext(o);let g=40;try{if(p){const{type:t}=p.getModel();if("graphin-cirle"===t){const{style:t}=p.getModel();t&&(g=t.keyshape.size)}}}catch(t){console.log(t)}const y=(({graph:t,placement:e,nodeSize:i,x:s,y:o,bindType:n="node",visible:a})=>"edge"===n?a?{left:s,top:o}:{visibility:"hidden",left:s,top:o}:("auto"===e&&(e=function(t,e,i){const s=t.get("canvas"),o=s.get("width"),n=s.get("height"),a=i<=n/4,r=i>=3*n/4,l=e<=o/4,d=e>=3*o/4;return l&&a?"bottom-right":d&&a?"bottom-left":l&&r?"top-right":d&&r?"top-left":a?"bottom":r?"top":l?"right":d?"left":"center"}(t,s,o)),"top"===e?a?{left:s,top:o-i/2,opacity:1,transform:"translate(-50%,calc(-100% - 6px))",transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:0,top:0,opacity:0,transform:"translate(-50%,-100%)",transition:"opacity 0.5s,transform 0.5s"}:"bottom"===e?a?{left:s,top:o+i/2,opacity:1,transform:"translate(-50%,6px)",transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:s,top:o+i/2,opacity:0,transform:"translate(-50%,0px)",transition:"opacity 0.5s,transform 0.5s"}:"left"===e?a?{left:s-i/2,top:o,transform:"translate(calc(-100% - 6px),-50%)",opacity:1,transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",opacity:0,left:s-i/2,top:o,transform:"translate(-100%,-50%)",transition:"opacity 0.5s,transform 0.5s"}:"right"===e?a?{left:s+i/2,top:o,transform:"translate(6px,-50%)",opacity:1,transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:s+i/2,top:o,transform:"translate(0,-50%)",opacity:0,transition:"opacity 0.5s,transform 0.5s"}:"top-left"===e?a?{left:s-i/2,top:o-i/2,opacity:1,transform:"translate(calc(-100% - 6px),calc(-100% - 6px))",transition:"opacity 0.5s,transform 0.5s"}:{left:s-i/2,top:o-i/2,opacity:0,transform:"translate(-100%,-100%)",transition:"opacity 0.5s,transform 0.5s"}:"top-right"===e?a?{left:s+i/2,top:o-i/2,opacity:1,transform:"translate(6px,calc(-100% - 6px))",transition:"opacity 0.5s,transform 0.5s"}:{left:s+i/2,top:o-i/2,opacity:0,transform:"translate(0,-100%)",transition:"opacity 0.5s,transform 0.5s"}:"bottom-left"===e?a?{left:s-i/2,top:o+i/2,opacity:1,transform:"translate(calc(-100% - 6px),6px)",transition:"opacity 0.5s,transform 0.5s"}:{left:s-i/2,top:o+i/2,opacity:0,transform:"translate(-100%,0px)",transition:"opacity 0.5s,transform 0.5s"}:"bottom-right"===e?a?{left:s+i/2,top:o+i/2,opacity:1,transform:"translate(6px,6px)",transition:"opacity 0.5s,transform 0.5s"}:{left:s+i/2,top:o+i/2,opacity:0,transform:"translate(0,0)",transition:"opacity 0.5s,transform 0.5s"}:"center"===e?a?{left:s,top:o,opacity:1,transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:s,top:o,opacity:0,transition:"opacity 0.5s,transform 0.5s"}:{left:s,top:o}))({graph:u,placement:a,nodeSize:g+12,x:d,y:c,bindType:i,visible:h}),f=Object.assign({position:"absolute"},y);if("function"!=typeof e)return console.error("<Tooltip /> children should be a function"),null;const m=p&&!p.destroyed&&p.getModel&&p.getModel()||{},v=m.id||"";return s().createElement(s().Fragment,null,s().createElement("div",{ref:ht,className:`graphin-components-tooltip ${a}`,style:Object.assign(Object.assign(Object.assign({},ct),f),n)},h&&s().createElement("div",null,r&&s().createElement("div",{className:`tooltip-arrow ${a}`}),e({item:p,bindType:i,model:m,id:v}))))},Legend:nt,useLegend:it,useTooltip:dt,useContextMenu:O},ut=t=>()=>{if(!t||t.destroyed)return;const e=t.getZoom(),i=t.get("canvas"),s=i.getPointByClient(i.get("width")/2,i.get("height")/2),o=i.get("pixelRatio")||1,n=1.25;return n*e>5?void 0:(t.zoom(n,{x:s.x/o,y:s.y/o},!0,{easing:"easeCubic",duration:150}),{text:`${Math.round(n*e*100)}%`,ratio:n*e})},gt=t=>()=>{if(!t||t.destroyed)return;const e=t.getZoom(),i=t.get("canvas"),s=i.getPointByClient(i.get("width")/2,i.get("height")/2),o=i.get("pixelRatio")||1,n=.75;return n*e<.3?void 0:(t.zoom(n,{x:s.x/o,y:s.y/o},!0,{easing:"easeCubic",duration:150}),{text:`${Math.round(n*e*100)}%`,ratio:n*e})},yt=t=>({text:e,ratio:i})=>{if(!t||t.destroyed)return;const s=t.get("canvas"),o=s.getPointByClient(s.get("width")/2,s.get("height")/2),n=s.get("pixelRatio")||1;return t.zoomTo(i,{x:o.x/n,y:o.y/n},!0,{easing:"easeCubic",duration:150}),{text:e,ratio:i}},ft=t=>()=>{if(!t||t.destroyed)return;const e=t.getZoom();return t.zoom(1/e),t.fitCenter(),{text:"100%",ratio:1}},mt=t=>()=>{if(!t||t.destroyed)return;t.getNodes().length>0&&t.fitView([20,20],{},!0);const e=t.getZoom();return{text:`${Math.round(100*e)}%`,ratio:e}},vt=t=>e=>{t.getNodes().forEach((i=>{t.clearItemStates(i,["active","inactive"]),-1!==e.indexOf(i.get("id"))?t.setItemState(i,"active",!0):t.setItemState(i,"active",!1)}))},bt=t=>e=>{if(!t||"string"!=typeof e)return;const i=t.findById(e);i?(t.focusItem(e,!0,{duration:200,easing:"easeCubic"}),t.setItemState(i,"selected",!0),i.toFront()):console.warn(`The node ${e} does not exist!`)},xt=Object.assign(Object.assign({},t),e),Ot=t=>Object.keys(xt).reduce(((e,i)=>Object.assign(Object.assign({},e),{[i]:xt[i](t)})),{}),wt={type:"compactBox",direction:"LR",getId:function(t){return t.id},getHeight:function(){return 16},getWidth:function(){return 16},getVGap:function(){return 80},getHGap:function(){return 20}},St=["dendrogram","compactBox","mindmap","indented"],jt={type:"force2"},Et=()=>Math.round(80*(Math.random()-.5)),Ct=t=>!t||!t.nodes||0===t.nodes.length,kt=["force","graphin-force","g6force","gForce","comboForce"],Nt=class{constructor(t){this.updateOptions=()=>{const t={type:"concentric"},{width:e,height:i,props:s}=this.graphin,{layout:o=t}=s,{type:n="concentric",preset:a}=o,r={width:e,height:i,center:[e/2,i/2]};if(this.options=Object.assign(Object.assign(Object.assign({},r),L[n]||{}),o),Ct(this.graphin.data))this.prevOptions={};else if(-1!==kt.indexOf(n)){let t=this.prevOptions.type||"grid";(null==a?void 0:a.type)&&(t=a.type),Ct(this.graphin.data)&&(t=a.type||"grid"),this.options.preset=Object.assign(Object.assign(Object.assign({type:t},r),L[t]||{}),a)}},this.processForce=()=>{const t=this,{options:e,graphin:i}=t,{graph:s}=i,{type:o,animation:n,animate:a}=e;if("graphin-force"===o&&(t.options.graph=s),"force"===o||"g6force"===o||"gForce"===o||"comboCombined"===o){const{onTick:e}=t.options,i=()=>{e&&e(),(n||a)&&t.refreshPosition()};t.options.tick=i;const{onLayoutEnd:o}=t.options;t.options.onLayoutEnd=()=>{t.refreshPosition(),null==o||o(),s.emit("afterlayout")}}"comboForce"!==o&&"comboCombined"!==o||(t.options.comboTrees=s.get("comboTrees"));const r=-1!==kt.indexOf(t.prevOptions.type),l=-1!==kt.indexOf(t.options.type),d=t.options.type===t.prevOptions.type;if(!Ct(i.data)){if(l&&!d){const{preset:e}=t.options;t.presetLayout=new(E().Layout[e.type])(Object.assign({},e)||{}),t.presetLayout.init(i.data),t.presetLayout.execute(),t.presetLayout.data=Object.assign({},i.data)}if(l&&r&&!t.hasPosition()){let e=t.graph.save();const{preset:s}=t.options;Ct(e)&&(t.presetLayout=new(E().Layout[s.type])(Object.assign({},s)||{}),t.presetLayout.init(i.data),t.presetLayout.execute(),e=i.data),i.data=((t,e)=>{const{nodes:i,edges:s}=t,{nodes:o}=e,n=new Map;o.forEach((t=>{const{id:e,x:i,y:s}=t;n.set(e,{x:i,y:s})}));const a=new Map;i.forEach((t=>{const{id:e}=t,{x:i,y:s}=n.get(e);window.isNaN(i)||window.isNaN(s)?a.set(e,t):(t.x=i,t.y=s)}));const r=new Map;return s.forEach((t=>{const{source:e,target:i}=t,s=a.get(e),o=a.get(i),l=n.get(e),d=!window.isNaN(l.x)&&!window.isNaN(l.y),c=n.get(i),h=!window.isNaN(c.x)&&!window.isNaN(c.y);s&&h&&r.set(e,{x:c.x+Et(),y:c.y+Et()}),o&&d&&r.set(i,{x:l.x+Et(),y:l.y+Et()})})),i.forEach((t=>{const{id:e}=t;let i=n.get(e);(window.isNaN(i.x)||window.isNaN(i.y))&&(i=r.get(e)||{}),window.isNaN(i.x)||window.isNaN(i.y)?(t.x=250+Math.round(500*Math.random()),t.y=150+Math.round(300*Math.random())):(t.x=i.x,t.y=i.y)})),Object.assign(Object.assign({},t),{nodes:i,edges:s})})(i.data,e)}}},this.refreshPosition=()=>{const{graphin:t}=this,{animate:e,layoutAnimate:i}=t.options,{type:s}=this.options;!e||i||this.options.animation?this.graph.refreshPositions("comboCombined"===s):this.graph.positionsAnimate("comboCombined"===s)},this.destroy=()=>{this.presetLayout&&this.presetLayout.destroy&&this.presetLayout.destroy(),this.instance&&this.instance.destroy&&this.instance.destroy(),this.presetLayout=null,this.instance=null},this.getDataFromGraph=()=>{const t=[],e=[],i=[],s=[],o=this.graph.getNodes(),n=this.graph.getEdges(),a=this.graph.getCombos(),r=o.length;for(let e=0;e<r;e++){const i=o[e];if(i&&i.isVisible()){const e=i.getModel();t.push(e)}}const l=n.length;for(let t=0;t<l;t++){const i=n[t];if(i&&i.isVisible()){const t=i.getModel();t.isComboEdge?s.push(t):e.push(t)}}const d=a.length;for(let t=0;t<d;t++){const e=a[t];if(e&&e.isVisible()){const t=e.getModel();i.push(t)}}return{nodes:t,edges:e,combos:i,comboEdges:s}},this.graphin=t,this.graph=this.graphin.graph,this.presetLayout=null,this.prevOptions={},this.init()}hasPosition(){const{graphin:t}=this,{data:e={}}=t;return!!e.nodes&&0!==e.nodes.length&&e.nodes.every((t=>!window.isNaN(Number(t.x))&&!window.isNaN(Number(t.y))))}init(){this.updateOptions();const{options:t,graphin:e}=this,{data:i}=e,{type:s}=t;this.processForce(),E().Layout[s]||console.warn(`${s} layout not found, current layout is grid`);const o=E().Layout[s]||E().Layout.grid;this.graph.emit("beforelayout"),this.instance=new o(this.options),this.instance.init(i)}start(){const{type:t}=this.options;this.instance.execute(),"force"!==t&&"g6force"!==t&&"gForce"!==t&&"comboCombined"!==t&&"force2"!==t&&(this.refreshPosition(),this.graph.emit("afterlayout"))}changeLayout(){const{graph:t,data:e,isTree:i,layoutCache:s}=this.graphin;if(!t||t.destroyed||!e||!e.nodes||!e.nodes.length||s&&this.hasPosition()||i)return!1;-1!==kt.indexOf(this.options.type)&&this.destroy(),this.prevOptions=Object.assign({},this.options),this.init(),this.start()}},Mt={mode:"light",primaryColor:"#873bf4",nodeSize:26,edgeSize:1,primaryEdgeColor:"#ddd"},Pt=t=>{const e=Object.assign(Object.assign({},Mt),t),{primaryColor:i,primaryEdgeColor:s,nodeSize:o,edgeSize:n,mode:a,background:r}=e,l=$({primaryColor:i,nodeSize:o,mode:a}),d=I({primaryEdgeColor:s,edgeSize:n,mode:a}),c={type:"circle",style:{labelCfg:{position:"top"}},status:{}};return Object.assign(Object.assign({},e),{mode:a,background:r||{light:"#fff",dark:"#1f1f1f"}[a],defaultNodeStyle:{type:l.type,style:l.style},defaultNodeStatusStyle:{status:l.status},defaultEdgeStyle:{type:d.type,style:d.style},defaultEdgeStatusStyle:{status:d.status},defaultComboStyle:{type:c.type,style:c.style},defaultComboStatusStyle:{status:c.status}})},Dt={animation:"animate",minDistanceThreshold:"minMovement",maxIterations:"maxIterations"},Lt=(t,e)=>{if(!t)return t;const i={};if(Object.keys(t).forEach((s=>{var o;if("preset"===s&&(null===(o=t.preset)||void 0===o?void 0:o.type))return void(i.preset=Lt(t.preset,e));const n=Dt[s];n?i[n]=t[s]:i[s]=t[s]})),t.done&&(t.onLayoutEnd?i.onLayoutEnd=i=>{t.onLayoutEnd(e,i),t.done(e,i)}:i.onLayoutEnd=i=>{t.done(e,i)}),"concentric"===i.type){const{minNodeSpacing:t=60,preventOverlap:e=!0,nodeSize:s=60}=i;i.minNodeSpacing=t,i.preventOverlap=e,i.nodeSize=s}return i};var _t=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};const{DragCanvas:Tt,ZoomCanvas:It,DragNode:At,DragCombo:$t,ClickSelect:zt,BrushSelect:Ft,ResizeCanvas:Bt}=x;class Rt extends s().PureComponent{static registerBehavior(t,e){E().registerBehavior(t,e)}static registerFontFamily(t){const e=t(),{glyphs:i,fontFamily:s}=e,o=i.map((t=>({name:t.name,unicode:String.fromCodePoint(t.unicode_decimal)})));return new Proxy(o,{get:(t,e)=>{const i=t.find((t=>t.name===e));return i?null==i?void 0:i.unicode:(console.error(`%c fontFamily:${s},does not found ${e} icon`),"")}})}static registerLayout(t,e){E().registerLayout(t,e)}constructor(t){super(t),this.graphDOM=null,this.initData=t=>{t.children&&(this.isTree=!0),this.data=(0,m.cloneDeep)(t)},this.initGraphInstance=()=>{const t=this.props,{theme:e,data:i,layout:s,width:o,height:n,defaultCombo:a={style:{},type:"graphin-combo"},defaultEdge:r={style:{},type:"graphin-line"},defaultNode:l={style:{},type:"graphin-circle"},nodeStateStyles:d,edgeStateStyles:c,comboStateStyles:h,modes:p={default:[]},animate:u,handleAfterLayout:g}=t,y=_t(t,["theme","data","layout","width","height","defaultCombo","defaultEdge","defaultNode","nodeStateStyles","edgeStateStyles","comboStateStyles","modes","animate","handleAfterLayout"]);p.default.length>0&&console.info("%c suggestion: you can use @antv/graphin Behaviors components","color:lightgreen");const{clientWidth:f,clientHeight:m}=this.graphDOM;this.initData(i),this.width=Number(o)||f||500,this.height=Number(n)||m||500;const v=Pt(e),{defaultNodeStyle:b,defaultEdgeStyle:x,defaultComboStyle:O,defaultNodeStatusStyle:w,defaultEdgeStatusStyle:S,defaultComboStatusStyle:j}=v,C=_t(v,["defaultNodeStyle","defaultEdgeStyle","defaultComboStyle","defaultNodeStatusStyle","defaultEdgeStatusStyle","defaultComboStatusStyle"]);this.isTree=Boolean(i.children)||-1!==St.indexOf(String(s&&s.type));const k={defaultNode:{style:Object.assign(Object.assign({},l.style),{_theme:e}),type:l.type||"graphin-circle"},defaultEdge:{style:Object.assign(Object.assign({},r.style),{_theme:e}),type:r.type||"graphin-line"},defaultCombo:{style:Object.assign(Object.assign({},a.style),{_theme:e}),type:a.type||"combo",labelCfg:a.labelCfg},nodeStateStyles:d,edgeStateStyles:c,comboStateStyles:h};this.theme=Object.assign(Object.assign({},k),C),this.options=Object.assign(Object.assign(Object.assign({container:this.graphDOM,renderer:"canvas",width:this.width,height:this.height,animate:!1!==u},k),{modes:p}),y),this.isTree?(this.options.layout=s||wt,this.graph=new(E().TreeGraph)(this.options)):(this.useGraphinLayoutController||(this.options.layout=Lt(s,this.graph)||jt),this.graph=new(E().Graph)(this.options)),this.graph.on("afterlayout",(()=>{g&&g(this.graph)})),this.graph.data(this.data),this.setTextDirection(),this.graph.render(),!this.isTree&&this.useGraphinLayoutController&&(this.layout=new Nt(this),this.layout.start()),this.initStatus(),this.apis=Ot(this.graph),this.setState({isReady:!0,context:{graph:this.graph,apis:this.apis,theme:this.theme,layout:this.layout,dragNodes:this.dragNodes,updateContext:this.updateContext}})},this.updateLayout=()=>{this.useGraphinLayoutController&&this.layout.changeLayout()},this.updateOptions=()=>_t(this.props,[]),this.initStatus=()=>{if(!this.isTree){const{data:t}=this.props,{nodes:e=[],edges:i=[]}=t;e.forEach((t=>{const{status:e}=t;e&&Object.keys(e).forEach((i=>{this.graph.setItemState(t.id,i,Boolean(e[i]))}))})),i.forEach((t=>{const{status:e}=t;e&&Object.keys(e).forEach((i=>{this.graph.setItemState(t.id,i,Boolean(e[i]))}))}))}},this.updateContext=t=>{this.setState((e=>({context:Object.assign(Object.assign({},e.context),t)})))},this.clear=()=>{this.layout&&this.layout.destroy&&this.layout.destroy(),this.layout={},this.graph.clear(),this.data={nodes:[],edges:[],combos:[]},this.graph.destroy()};const{data:e,layout:i,width:s,height:o,layoutCache:n}=t,a=_t(t,["data","layout","width","height","layoutCache"]);this.data=e,this.isTree=Boolean(t.data&&t.data.children)||-1!==St.indexOf(String(i&&i.type)),this.graph={},this.height=Number(o),this.width=Number(s),this.theme={},this.apis={},this.layoutCache=n,this.layout={},this.dragNodes=[],this.useGraphinLayoutController="graphin-force"===(null==i?void 0:i.type),this.options=Object.assign({},a),this.state={isReady:!1,context:{graph:this.graph,apis:this.apis,theme:this.theme,layout:this.layout,dragNodes:this.dragNodes,updateContext:this.updateContext}}}setTextDirection(){const{dir:t="ltr"}=this.props;this.graph.get("canvas").get("el").setAttribute("dir",t)}componentDidMount(){this.initGraphInstance()}componentDidUpdate(t){var e,i;const s=this.shouldUpdate(t,"data"),o=this.shouldUpdate(t,"layout"),n=this.shouldUpdate(t,"options"),{data:a,layoutCache:r,rtl:l,layout:d}=(this.shouldUpdate(t,"theme"),this.props),c=(0,m.cloneDeep)(d);let h;if(this.layoutCache=r,n&&t.rtl!==l&&(this.setTextDirection(),this.graph.render()),s){if(this.initData(a),this.isTree)this.graph.changeData(this.data);else{const{context:{dragNodes:t}}=this.state;if(h=t.filter((t=>{var e;return(null===(e=this.data)||void 0===e?void 0:e.nodes)&&this.data.nodes.find((e=>e.id===t.id))})),null===(i=null===(e=this.data)||void 0===e?void 0:e.nodes)||void 0===i||i.forEach((t=>{var e,i,s,o;const n=h.find((e=>e.id===t.id));n&&(t.mass=null===(i=null===(e=n.layout)||void 0===e?void 0:e.force)||void 0===i?void 0:i.mass,t.layout=Object.assign(Object.assign({},t.layout),{force:{mass:null===(o=null===(s=n.layout)||void 0===s?void 0:s.force)||void 0===o?void 0:o.mass}}))})),this.useGraphinLayoutController)this.graph.data(this.data),this.graph.set("layoutController",null),this.graph.changeData(this.data),this.data=this.layout.getDataFromGraph(),this.layout.changeLayout();else{c&&(c.disableTriggerLayout=!0);const t=Lt(c,this.graph);this.graph.updateLayout(t),this.graph.data(this.data),this.graph.changeData(this.data),this.data=this.graph.get("data")}}return this.initStatus(),this.apis=Ot(this.graph),void this.setState((t=>Object.assign(Object.assign({},t),{context:{graph:this.graph,apis:this.apis,theme:this.theme,layout:this.layout,dragNodes:h||t.context.dragNodes,updateContext:this.updateContext}})),(()=>{this.graph.emit("graphin:datachange"),o&&this.graph.emit("graphin:layoutchange",{prevLayout:t.layout,layout:c})}))}if(o){if(this.useGraphinLayoutController="graphin-force"===(null==c?void 0:c.type),this.isTree)return void this.graph.updateLayout(c);if(this.useGraphinLayoutController)0===Object.keys(this.layout).length&&(this.layout=new Nt(this)),this.data=this.layout.getDataFromGraph(),this.layout.changeLayout();else{this.graph.get("layoutController")||this.graph.initLayoutController();const t=Lt(c,this.graph);t&&(t.disableTriggerLayout=!1),this.graph.updateLayout(t),this.data=this.graph.get("data")}this.graph.emit("graphin:layoutchange",{prevLayout:t.layout,layout:c})}}componentWillUnmount(){const{willUnmount:t}=this.props;t?(t(),this.layout&&this.layout.destroy&&this.layout.destroy(),this.layout={},this.graph.destroyLayout()):this.clear()}componentDidCatch(t,e){console.error("Catch component error: ",t,e)}shouldUpdate(t,e){const i=t[e],s=this.props[e];return!(0,m.isEqual)(i,s)}render(){var t;const{isReady:e}=this.state,{modes:i,style:n,containerId:a,containerStyle:r}=this.props;return s().createElement(o.Provider,{value:this.state.context},s().createElement("div",{id:a||"graphin-container",style:Object.assign({height:"100%",width:"100%",position:"relative"},r)},s().createElement("div",{"data-testid":"custom-element",className:"graphin-core",ref:t=>{this.graphDOM=t},style:Object.assign({height:"100%",width:" 100%",minHeight:"500px",background:(null===(t=this.theme)||void 0===t?void 0:t.background)||"#fff"},n)}),s().createElement("div",{className:"graphin-components"},e&&s().createElement(s().Fragment,null,!i&&s().createElement(s().Fragment,null,s().createElement(Tt,null),s().createElement(It,null),s().createElement(At,null),s().createElement($t,null),s().createElement(zt,null),s().createElement(Ft,null)),s().createElement(Bt,{graphDOM:this.graphDOM}),this.props.children))))}}Rt.registerNode=(t,e,i)=>{E().registerNode(t,e,i)},Rt.registerEdge=(t,e,i)=>{E().registerEdge(t,e,i)},Rt.registerCombo=(t,e,i)=>{E().registerCombo(t,e,i)};const Wt=Rt,Gt=(t,e,i)=>{var s,o;return"source"===t?(null===(s=null==i?void 0:i.find((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.id)===e.id})))||void 0===s?void 0:s.source)||{}:(null===(o=null==i?void 0:i.find((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.id)===e.id})))||void 0===o?void 0:o.target)||{}},qt=(t,e,i,s)=>{var o;const n=(null===(o=null==i?void 0:i.data)||void 0===o?void 0:o[e])||"";let a=(null==s?void 0:s.filter((t=>{var i;return(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i[e])===n})))||[];return"leaf"===t&&(a=a.filter((t=>{var e,i,s,o;return 0===(null===(i=null===(e=t.data)||void 0===e?void 0:e.layout)||void 0===i?void 0:i.sDegree)||0===(null===(o=null===(s=t.data)||void 0===s?void 0:s.layout)||void 0===o?void 0:o.tDegree)}))),a},Ht=(t,e,i)=>{let s=[];switch(t){case"source":s=null==i?void 0:i.filter((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.id)===e.id})).map((t=>t.target));break;case"target":s=null==i?void 0:i.filter((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.id)===e.id})).map((t=>t.source));break;case"both":s=null==i?void 0:i.filter((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.id)===e.id})).map((t=>t.target)).concat(null==i?void 0:i.filter((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.id)===e.id})).map((t=>t.source)))}return s=(0,m.uniqBy)(s,((t,e)=>t.id===e.id)),s},Zt={getDegree:(t,e)=>{const i=t.data.id;let s=0,o=0,n=0;return e.forEach((t=>{t.source.id===i&&(o+=1,s+=1),t.target.id===i&&(n+=1,s+=1)})),{degree:s,sDegree:o,tDegree:n}},getRelativeNodesType:(t,e)=>[...new Set(null==t?void 0:t.map((t=>{var i;return null===(i=null==t?void 0:t.data)||void 0===i?void 0:i[e]})))]||[],getCoreNodeAndRelativeLeafNodes:(t,e,i,s)=>{var o;const{sDegree:n,tDegree:a}=(null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.layout)||{};let r=e,l=[];return 0===n?(r=Gt("source",e,i),l=Ht("both",r,i)):0===a&&(r=Gt("target",e,i),l=Ht("both",r,i)),l=l.filter((t=>{var e;return(null===(e=t.data)||void 0===e?void 0:e.layout)&&(0===t.data.layout.sDegree||0===t.data.layout.tDegree)})),{coreNode:r,relativeLeafNodes:l,sameTypeLeafNodes:qt(t,s,e,l)}},getCoreNode:Gt,getSameTypeNodes:qt,getMinDistanceNode:t=>{const e=t.map((t=>t.x)),i=t.map((t=>t.y)),s=(Math.max.apply(null,e)+Math.min.apply(null,e))/2,o=(Math.max.apply(null,i)+Math.min.apply(null,i))/2,n=t.map((t=>{return e=t.x||0,i=t.y||0,Math.sqrt((e-s)*(e-s)+(i-o)*(i-o));var e,i}));return t[n.findIndex((t=>t===Math.min.apply(null,n)))]},getAvgNodePosition:t=>{const e={x:0,y:0};t.forEach((t=>{e.x+=t.x||0,e.y+=t.y||0}));const i=t.length||1;return{x:e.x/i,y:e.y/i}}};class Vt{constructor(t){this.id=t.id,this.data=t||{},this.x=t.x||0,this.y=t.y||0}}class Ut{constructor(t,e,i,s){this.id=t,this.source=e,this.target=i,this.data=s||{}}}function Xt(t,e,i,s){if(isNaN(e)||isNaN(i))return t;var o,n,a,r,l,d,c,h,p,u=t._root,g={data:s},y=t._x0,f=t._y0,m=t._x1,v=t._y1;if(!u)return t._root=g,t;for(;u.length;)if((d=e>=(n=(y+m)/2))?y=n:m=n,(c=i>=(a=(f+v)/2))?f=a:v=a,o=u,!(u=u[h=c<<1|d]))return o[h]=g,t;if(r=+t._x.call(null,u.data),l=+t._y.call(null,u.data),e===r&&i===l)return g.next=u,o?o[h]=g:t._root=g,t;do{o=o?o[h]=new Array(4):t._root=new Array(4),(d=e>=(n=(y+m)/2))?y=n:m=n,(c=i>=(a=(f+v)/2))?f=a:v=a}while((h=c<<1|d)==(p=(l>=a)<<1|r>=n));return o[p]=u,o[h]=g,t}function Yt(t,e,i,s,o){this.node=t,this.x0=e,this.y0=i,this.x1=s,this.y1=o}function Kt(t){return t[0]}function Qt(t){return t[1]}function Jt(t,e,i){var s=new te(null==e?Kt:e,null==i?Qt:i,NaN,NaN,NaN,NaN);return null==t?s:s.addAll(t)}function te(t,e,i,s,o,n){this._x=t,this._y=e,this._x0=i,this._y0=s,this._x1=o,this._y1=n,this._root=void 0}function ee(t){for(var e={data:t.data},i=e;t=t.next;)i=i.next={data:t.data};return e}var ie=Jt.prototype=te.prototype;ie.copy=function(){var t,e,i=new te(this._x,this._y,this._x0,this._y0,this._x1,this._y1),s=this._root;if(!s)return i;if(!s.length)return i._root=ee(s),i;for(t=[{source:s,target:i._root=new Array(4)}];s=t.pop();)for(var o=0;o<4;++o)(e=s.source[o])&&(e.length?t.push({source:e,target:s.target[o]=new Array(4)}):s.target[o]=ee(e));return i},ie.add=function(t){const e=+this._x.call(null,t),i=+this._y.call(null,t);return Xt(this.cover(e,i),e,i,t)},ie.addAll=function(t){var e,i,s,o,n=t.length,a=new Array(n),r=new Array(n),l=1/0,d=1/0,c=-1/0,h=-1/0;for(i=0;i<n;++i)isNaN(s=+this._x.call(null,e=t[i]))||isNaN(o=+this._y.call(null,e))||(a[i]=s,r[i]=o,s<l&&(l=s),s>c&&(c=s),o<d&&(d=o),o>h&&(h=o));if(l>c||d>h)return this;for(this.cover(l,d).cover(c,h),i=0;i<n;++i)Xt(this,a[i],r[i],t[i]);return this},ie.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var i=this._x0,s=this._y0,o=this._x1,n=this._y1;if(isNaN(i))o=(i=Math.floor(t))+1,n=(s=Math.floor(e))+1;else{for(var a,r,l=o-i||1,d=this._root;i>t||t>=o||s>e||e>=n;)switch(r=(e<s)<<1|t<i,(a=new Array(4))[r]=d,d=a,l*=2,r){case 0:o=i+l,n=s+l;break;case 1:i=o-l,n=s+l;break;case 2:o=i+l,s=n-l;break;case 3:i=o-l,s=n-l}this._root&&this._root.length&&(this._root=d)}return this._x0=i,this._y0=s,this._x1=o,this._y1=n,this},ie.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},ie.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},ie.find=function(t,e,i){var s,o,n,a,r,l,d,c=this._x0,h=this._y0,p=this._x1,u=this._y1,g=[],y=this._root;for(y&&g.push(new Yt(y,c,h,p,u)),null==i?i=1/0:(c=t-i,h=e-i,p=t+i,u=e+i,i*=i);l=g.pop();)if(!(!(y=l.node)||(o=l.x0)>p||(n=l.y0)>u||(a=l.x1)<c||(r=l.y1)<h))if(y.length){var f=(o+a)/2,m=(n+r)/2;g.push(new Yt(y[3],f,m,a,r),new Yt(y[2],o,m,f,r),new Yt(y[1],f,n,a,m),new Yt(y[0],o,n,f,m)),(d=(e>=m)<<1|t>=f)&&(l=g[g.length-1],g[g.length-1]=g[g.length-1-d],g[g.length-1-d]=l)}else{var v=t-+this._x.call(null,y.data),b=e-+this._y.call(null,y.data),x=v*v+b*b;if(x<i){var O=Math.sqrt(i=x);c=t-O,h=e-O,p=t+O,u=e+O,s=y.data}}return s},ie.remove=function(t){if(isNaN(n=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,i,s,o,n,a,r,l,d,c,h,p,u=this._root,g=this._x0,y=this._y0,f=this._x1,m=this._y1;if(!u)return this;if(u.length)for(;;){if((d=n>=(r=(g+f)/2))?g=r:f=r,(c=a>=(l=(y+m)/2))?y=l:m=l,e=u,!(u=u[h=c<<1|d]))return this;if(!u.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(i=e,p=h)}for(;u.data!==t;)if(s=u,!(u=u.next))return this;return(o=u.next)&&delete u.next,s?(o?s.next=o:delete s.next,this):e?(o?e[h]=o:delete e[h],(u=e[0]||e[1]||e[2]||e[3])&&u===(e[3]||e[2]||e[1]||e[0])&&!u.length&&(i?i[p]=u:this._root=u),this):(this._root=o,this)},ie.removeAll=function(t){for(var e=0,i=t.length;e<i;++e)this.remove(t[e]);return this},ie.root=function(){return this._root},ie.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},ie.visit=function(t){var e,i,s,o,n,a,r=[],l=this._root;for(l&&r.push(new Yt(l,this._x0,this._y0,this._x1,this._y1));e=r.pop();)if(!t(l=e.node,s=e.x0,o=e.y0,n=e.x1,a=e.y1)&&l.length){var d=(s+n)/2,c=(o+a)/2;(i=l[3])&&r.push(new Yt(i,d,c,n,a)),(i=l[2])&&r.push(new Yt(i,s,c,d,a)),(i=l[1])&&r.push(new Yt(i,d,o,n,c)),(i=l[0])&&r.push(new Yt(i,s,o,d,c))}return this},ie.visitAfter=function(t){var e,i=[],s=[];for(this._root&&i.push(new Yt(this._root,this._x0,this._y0,this._x1,this._y1));e=i.pop();){var o=e.node;if(o.length){var n,a=e.x0,r=e.y0,l=e.x1,d=e.y1,c=(a+l)/2,h=(r+d)/2;(n=o[0])&&i.push(new Yt(n,a,r,c,h)),(n=o[1])&&i.push(new Yt(n,c,r,l,h)),(n=o[2])&&i.push(new Yt(n,a,h,c,d)),(n=o[3])&&i.push(new Yt(n,c,h,l,d))}s.push(e)}for(;e=s.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},ie.x=function(t){return arguments.length?(this._x=t,this):this._x},ie.y=function(t){return arguments.length?(this._y=t,this):this._y};function se(t){let e=0,i=0,s=0;if(t.length){for(let o=0;o<4;o++){const n=t[o];n&&n.weight&&(e+=n.weight,i+=n.x*n.weight,s+=n.y*n.weight)}t.x=i/e,t.y=s/e,t.weight=e}else{const e=t;t.x=e.data.x,t.y=e.data.y,t.weight=e.data.weight}}class oe{constructor(t,e){this.getvec=()=>this,this.add=t=>new oe(this.x+t.x,this.y+t.y),this.subtract=t=>new oe(this.x-t.x,this.y-t.y),this.magnitude=()=>Math.sqrt(this.x*this.x+this.y*this.y),this.normalise=()=>this.divide(this.magnitude()),this.divide=t=>new oe(this.x/t||0,this.y/t||0),this.scalarMultip=t=>new oe(this.x*t,this.y*t),this.x=t,this.y=e}}const ne=oe,ae=class{constructor(t,e,i,s=1){this.updateAcc=t=>{this.a=this.a.add(t.divide(this.m))},this.p=t,this.m=s,this.v=new ne(0,0),this.a=new ne(0,0),this.id=e,this.data=i}},re=class{constructor(t,e,i){this.source=t,this.target=e,this.length=i}},le=class{constructor(t){this.updateOptions=t=>{t&&Object.keys(t).forEach((e=>{this.props[e]=t[e]}))},this.setData=t=>{this.nodes=[],this.edges=[],this.nodeSet={},this.edgeSet={},this.nodePoints=new Map,this.edgeSprings=new Map,this.sourceData=t,this.judgingDistance=0,("nodes"in t||"edges"in t)&&(this.addNodes(t.nodes),this.addEdges(t.edges))},this.getMass=t=>{var e;const{degree:i=(null===(e=Zt.getDegree(t,this.edges))||void 0===e?void 0:e.degree),force:s}=t.layout||{};return s&&s.mass?s.mass:i<5?1:5*i},this.init=()=>{const{width:t,height:e}=this.props;let{centripetalOptions:i}=this.props;const{leafCluster:s,clustering:o,nodeClusterBy:n,clusterNodeStrength:a}=this.props,r=t=>"function"==typeof a?a(t):a;let l;if(this.nodes.forEach((i=>{const s=i.data.x||t/2,o=i.data.y||e/2,n=new ne(s,o);i.data.layout||(i.data.layout={});const a=Zt.getDegree(i,this.edges);i.data.layout=Object.assign(Object.assign({},i.data.layout),a);const r=this.getMass(i.data);this.nodePoints.set(i.id,new ae(n,String(i.id),i.data,r))})),this.edges.forEach((t=>{const e=this.nodePoints.get(t.source.id),i=this.nodePoints.get(t.target.id),s=this.props.defSpringLen(t,e,i);this.edgeSprings.set(t.id,new re(e,i,s))})),s){l=this.getSameTypeLeafMap();const t=Zt.getRelativeNodesType(this.nodes,n);i={single:100,leaf:(e,i,s)=>{const{relativeLeafNodes:o,sameTypeLeafNodes:n}=l[e.id]||{};return(null==n?void 0:n.length)===(null==o?void 0:o.length)||1===(null==t?void 0:t.length)?1:r(e)},others:1,center:(t,e,i)=>{var s;const{degree:o}=(null===(s=t.data)||void 0===s?void 0:s.layout)||{};if(!o)return{x:100,y:100};let n;if(1===o){const{sameTypeLeafNodes:e=[]}=l[t.id]||{};1===e.length?n=void 0:e.length>1&&(n=Zt.getAvgNodePosition(e))}else n=void 0;return{x:null==n?void 0:n.x,y:null==n?void 0:n.y}}}}if(o){l||(l=this.getSameTypeLeafMap());const t=Array.from(new Set(this.nodes.map((t=>{var e;return null===(e=t.data)||void 0===e?void 0:e[n]})))).filter((t=>void 0!==t)),e={};t.forEach((t=>{const i=this.nodes.filter((e=>{var i;return(null===(i=e.data)||void 0===i?void 0:i[n])===t}));e[t]=Zt.getAvgNodePosition(i)})),i={single:t=>r(t),leaf:t=>r(t),others:t=>r(t),center:(t,i,s)=>{var o;const a=e[null===(o=t.data)||void 0===o?void 0:o[n]];return{x:null==a?void 0:a.x,y:null==a?void 0:a.y}}}}this.centripetalOptions=Object.assign(Object.assign({},this.centripetalOptions),i);const{size:d}=this.nodePoints,c=Math.pow(10,2);this.props.minEnergyThreshold=.5*Math.pow(1,2)*1*d*c},this.start=()=>{this.init(),this.props.animation?this.animation():this.slienceForce()},this.calTotalEnergy=()=>{let t=0;return this.nodes.forEach((e=>{const i=this.nodePoints.get(e.id),s=i.v.magnitude(),{m:o}=i;t+=o*Math.pow(s,2)*.5})),t},this.slienceForce=()=>{const{done:t,maxIterations:e,minDistanceThreshold:i}=this.props;for(let t=0;(this.judgingDistance>i||t<1)&&t<e;t++)this.tick(this.props.tickInterval),this.iterations++;this.render(),t&&t(this.renderNodes)},this.requestAnimationFrame=t=>{const{enableWorker:e}=this.props;return e?setInterval((()=>{t()}),16):window.requestAnimationFrame(t)},this.cancelAnimationFrame=t=>{const{enableWorker:e}=this.props;e?clearInterval(t):window.cancelAnimationFrame(t)},this.animation=()=>{const{enableWorker:t,maxIterations:e,minDistanceThreshold:i,done:s,tickInterval:o}=this.props;if(t){let t=(new Date).valueOf();const o=.22,n=t=>t>10?2e3:20*t*t;for(let a=0;a<e;a++){const e=Math.max(.02,o-.002*a);this.tick(e),(new Date).valueOf()-t>=n(a)&&(this.render(),t=(new Date).valueOf());const r=this.calTotalEnergy(),l=this.registers.get("monitor");if(l&&l(this.reportMointor(r)),this.judgingDistance<i)return this.render(),void(s&&s(this.renderNodes))}return}const n=()=>{this.tick(o),this.render(),this.iterations++;const t=this.calTotalEnergy(),e=this.registers.get("monitor");e&&e(this.reportMointor(t)),this.judgingDistance<i||this.iterations>this.props.maxIterations?(this.cancelAnimationFrame(this.timer),this.iterations=0,this.done=!0,s&&s(this.renderNodes)):this.timer=this.requestAnimationFrame(n)};this.timer=this.requestAnimationFrame(n)},this.render=()=>{const t=this.registers.get("render");this.renderNodes=[],this.nodePoints.forEach((t=>{this.renderNodes.push(Object.assign(Object.assign({},this.nodeSet[t.id]&&this.nodeSet[t.id].data),{x:t.p.x,y:t.p.y}))})),t?t({nodes:this.renderNodes,edges:this.sourceData.edges}):console.error("need a render function")},this.reportMointor=t=>({energy:t,iterations:this.iterations,nodes:this.nodes,edges:this.edges}),this.tick=t=>{this.updateCoulombsLawOptimized(),this.updateHookesLaw(),this.attractToCentre(),this.attractToSide(),this.updateVelocity(t),this.updatePosition(t)},this.updateCoulombsLawOptimized=()=>{const{coulombDisScale:t}=this.props,{repulsion:e}=this.props,i=function(t,e,i){const s=i/(e*e),o=t.map(((t,e)=>Object.assign(Object.assign({index:e},t),{vx:0,vy:0,weight:s}))),n=Jt(o,(t=>t.x),(t=>t.y)).visitAfter(se);return o.forEach((t=>{!function(t,e){e.visit(((e,i,s,o,n)=>{const a=t.x-e.x||.001,r=t.y-e.y||.001,l=o-i,d=a*a+r*r+.1,c=Math.sqrt(d)+.1;return l*l/.81<d?(t.vx+=a/c*e.weight/d,t.vy+=r/c*e.weight/d,!0):!e.length&&void(e.data!==t&&(t.vx+=a/c*e.data.weight/d,t.vy+=r/c*e.data.weight/d))}))}(t,n)})),o.map((t=>({vx:t.vx,vy:t.vy})))}(this.nodes.map((t=>{const e=this.nodePoints.get(t.id).p;return{x:e.x,y:e.y}})),t,e);this.nodes.forEach(((t,e)=>{this.nodePoints.get(t.id).updateAcc(new ne(i[e].vx,i[e].vy))}))},this.updateCoulombsLaw=()=>{const t=this.nodes.length;for(let e=0;e<t;e++)for(let i=e+1;i<t;i++){if(e===i)continue;const t=this.nodes[e],s=this.nodes[i],{coulombDisScale:o}=this.props,{repulsion:n}=this.props,a=this.nodePoints.get(t.id).p.subtract(this.nodePoints.get(s.id).p),r=(a.magnitude()+.1)*o,l=a.normalise(),d=1;this.nodePoints.get(t.id).updateAcc(l.scalarMultip(n*d).divide(Math.pow(r,2))),this.nodePoints.get(s.id).updateAcc(l.scalarMultip(n*d).divide(-Math.pow(r,2)))}},this.updateHookesLaw=()=>{this.edges.forEach((t=>{const e=this.edgeSprings.get(t.id),i=e.target.p.subtract(e.source.p),s=e.length-i.magnitude(),o=i.normalise();e.source.updateAcc(o.scalarMultip(-this.props.stiffness*s)),e.target.updateAcc(o.scalarMultip(this.props.stiffness*s))}))},this.implementForce=(t,e,i=2)=>{const s=this.nodePoints.get(t.id),o=s.p.subtract(e);s.updateAcc(o.scalarMultip(-i))},this.attractToCentre=()=>{this.nodes.forEach((t=>{var e;const{degree:i,sDegree:s,tDegree:o}=null===(e=t.data)||void 0===e?void 0:e.layout,{leaf:n,single:a,others:r,center:l}=this.centripetalOptions,{width:d,height:c}=this.props;if(void 0===l)return;const{x:h,y:p,centerStrength:u}=l(t,this.nodes,this.edges,d,c);if(void 0===h||void 0===p)return;const g=new ne(h,p);if(u)return void this.implementForce(t,g,u);const y="function"==typeof n?n(t,this.nodes,this.edges):n,f="function"==typeof a?a(t):a,m="function"==typeof r?r(t):r,v=0===o||0===s;0!==y&&0!==f&&0!==m&&(0===i?this.implementForce(t,g,f):v?this.implementForce(t,g,y):this.implementForce(t,g,m))}))},this.attractToSide=()=>{if(!this.props.defSideCoe||"function"!=typeof this.props.defSideCoe)return;const{height:t}=this.props;this.nodes.forEach((e=>{const i=this.props.defSideCoe(e);if(0===i)return;const s=this.nodePoints.get(e.id),{x:o}=s.p,n=new ne(o,i>0?0:t);this.implementForce(e,n,Math.abs(i))}))},this.updateVelocity=t=>{this.nodes.forEach((e=>{const i=this.nodePoints.get(e.id);i.v=i.v.add(i.a.scalarMultip(t)).scalarMultip(this.props.damping),i.v.magnitude()>this.props.maxSpeed&&(i.v=i.v.normalise().scalarMultip(this.props.maxSpeed)),i.a=new ne(0,0)}))},this.updatePosition=t=>{var e;if(!(null===(e=this.nodes)||void 0===e?void 0:e.length))return void(this.judgingDistance=0);const{distanceThresholdMode:i}=this.props;let s=0;"max"===i?this.judgingDistance=-1/0:"min"===i&&(this.judgingDistance=1/0),this.nodes.forEach((e=>{const o=this.nodePoints.get(e.id);o.p=o.p.add(o.v.scalarMultip(t));const n=o.v.scalarMultip(t).magnitude();switch(i){case"max":this.judgingDistance<n&&(this.judgingDistance=n);break;case"min":this.judgingDistance>n&&(this.judgingDistance=n);break;default:s+=n}})),i&&"mean"!==i||(this.judgingDistance=s/this.nodes.length)},this.addNode=t=>{const{ignore:e}=this.props;e&&e(t)||(t.id in this.nodeSet||this.nodes.push(t),this.nodeSet[t.id]=t)},this.addNodes=t=>{t.forEach((t=>{this.addNode(new Vt(t))}))},this.addEdge=t=>(t.id in this.edgeSet||this.edges.push(t),this.edgeSet[t.id]=t,t),this.addEdges=t=>{try{const e=t.length;for(let i=0;i<e;i++){const e=t[i],s=e.source,o=e.target,n=this.nodeSet[s];if(void 0===n)throw new TypeError(`invalid node name: ${e.source}`);const a=this.nodeSet[o];if(void 0===a)throw new TypeError(`invalid node name: ${e.target}`);const r=e.data,l=new Ut(String(this.nextEdgeId++),n,a,r);this.addEdge(l)}}catch(t){console.error(t)}},this.register=(t,e)=>{this.registers.set(t,e)},this.restart=(t,e)=>{const{ignore:i}=this.props;e.getNodes().forEach((t=>{const e=t.get("model");if(i&&i(e))return;const s=new ne(e.x,e.y),o=this.nodePoints.get(e.id);o&&(o.p=s,this.nodePoints.set(e.id,o))})),t.forEach((t=>{const e=new ne(t.x,t.y),i=this.getMass(t);this.nodePoints.set(t.id,new ae(e,t.id,t.data,i)),this.edges.forEach((e=>{const i=this.nodePoints.get(e.source.id),s=this.nodePoints.get(e.target.id);if(i.id===t.id||s.id===t.id){const t=this.edgeSprings.get(e.id).length||100;this.edgeSprings.set(e.id,new re(i,s,t))}}))})),this.props.restartAnimation?this.animation():this.slienceForce()},this.stop=()=>{window.cancelAnimationFrame(this.timer),this.done=!0},this.getSameTypeLeafMap=()=>{const{nodeClusterBy:t}=this.props,e={};return this.nodes.forEach((i=>{var s;const{degree:o}=(null===(s=i.data)||void 0===s?void 0:s.layout)||{};1===o&&(e[i.id]=Zt.getCoreNodeAndRelativeLeafNodes("leaf",i,this.edges,t))})),e},this.props={stiffness:200,enableWorker:!1,defSpringLen:t=>t.data.spring||200,repulsion:1e3,centripetalOptions:{leaf:2,single:2},leafCluster:!1,clustering:!1,nodeClusterBy:"cluster",clusterNodeStrength:20,damping:.9,minEnergyThreshold:.1,maxSpeed:1e3,coulombDisScale:.005,tickInterval:.02,groupFactor:4,maxIterations:7440,minDistanceThreshold:.4,distanceThresholdMode:"mean",animation:!0,restartAnimation:!0,width:200,height:200},this.updateOptions(t),this.sourceData={nodes:[],edges:[],combos:[]},this.nodes=[],this.edges=[],this.nodeSet={},this.edgeSet={},this.renderNodes=[],this.nodePoints=new Map,this.edgeSprings=new Map,this.registers=new Map,this.done=!1,this.judgingDistance=0,this.iterations=0,this.nextEdgeId=0,this.timer=0,this.center=new ne(0,0),this.centripetalOptions={leaf:2,single:2,others:1,center:t=>({x:this.props.width/2,y:this.props.height/2})},this.dragNodes=[]}};var de=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i},ce=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};const he=(t,e,i)=>{if(e)try{t.forEach((t=>{const s=t.cfg.name;if(e[s]){const o=i(e,s),{animate:n,visible:a}=o,r=ce(o,["animate","visible"]);if(t.attrs.img)void 0!==r.opacity&&t.attr({opacity:r.opacity});else if(t.attr(r),t.cfg.visible=!1!==a,n){const{attrs:e}=n,i=ce(n,["attrs"]);t.animate(e,i)}}}))}catch(t){console.error(t)}};function pe(t){return Object.keys(t).forEach((e=>{void 0===t[e]&&delete t[e]})),t}const ue=t=>{if(!t)return[0,0];let e=0,i=0;if("number"==typeof t)e=t,i=t;else if(Array.isArray(t))if(1===t.length){const[s]=t;e=s,i=s}else if(2===t.length){const[s,o]=t;e=s,i=o}return[e,i]};var ge=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};function ye(t){let e;return"number"==typeof t?e=t/2:Array.isArray(t)&&(e=t[0]/2),e}const fe=t=>{const{halo:e,keyshape:i}=t,{size:s,visible:o,fill:n,fillOpacity:a}=e,r=ge(e,["size","visible","fill","fillOpacity"]),l=ye(s);let d,c,h;return i&&i.size&&(d=ye(i.size)+15),i&&i.fill&&(c=i.fill),i&&i.stroke&&(h=i.stroke),{name:"halo",visible:!1!==o,attrs:pe(Object.assign({x:0,y:0,r:l||d,fill:n||c||h,fillOpacity:a||.1,visible:!1!==o},r))}},me=t=>{const{keyshape:e}=t,{size:i,visible:s,stroke:o,fill:n,fillOpacity:a,strokeOpacity:r}=e,l=ge(e,["size","visible","stroke","fill","fillOpacity","strokeOpacity"]),d=ye(i);return{name:"keyshape",visible:!1!==s,attrs:pe(Object.assign({x:0,y:0,r:d,cursor:"pointer",visible:!1!==s,stroke:o,strokeOpacity:r||1,fill:n||o,fillOpacity:a||.2},l))}},ve=t=>{const{label:e}=t,{value:i,fill:s,fontSize:o,visible:n}=e,a=ge(e,["value","fill","fontSize","visible"]),r=(t=>{const{label:e,keyshape:i}=t;if(!(null==i?void 0:i.size)&&!(null==e?void 0:e.offset))return{x:void 0,y:void 0,textBaseline:null==e?void 0:e.textBaseline};!(null==i?void 0:i.size)&&(null==e?void 0:e.offset)&&(i.size=26,console.info("you should set keyshape.size when you update label position,the default keyshape size value is  26"));const{size:s}=i;let o=[0,0];const{position:n,offset:a=o}=e;"number"!=typeof a&&"string"!=typeof a||(o=[Number(a),Number(a)]),a.length>0&&(o=a);const[r,l]=o;if("center"===n)return{x:0+r,y:0+l};const d=ue(s),c=d[0],h=d[1];let p;switch(n){case"top":p={x:0+r,y:-h/2-l,textBaseline:"bottom"};break;case"bottom":default:p={x:0+r,y:h/2+l,textBaseline:"top"};break;case"left":p={x:0-c-r,y:0+l,textAlign:"right"};break;case"right":p={x:0+c+r,y:0+l,textAlign:"left"}}return p})(t);return{name:"label",visible:!1!==n,attrs:pe(Object.assign({x:r.x,y:r.y,fontSize:o,text:i,textAlign:"center",fill:s,textBaseline:r.textBaseline,visible:!1!==n},a))}},be=t=>{const{icon:e}=t,{value:i="",type:s,fontFamily:o,textAlign:n="center",textBaseline:a="middle",fill:r,size:l,visible:d,clip:c}=e,h=ge(e,["value","type","fontFamily","textAlign","textBaseline","fill","size","visible","clip"]),[p,u]=ue(l),g={name:"icon",visible:!1!==d,capture:!1};return"text"===s||"font"===s?Object.assign(Object.assign({},g),{attrs:Object.assign({x:0,y:0,textAlign:n,textBaseline:a,text:i,fontSize:p,fontFamily:o,fill:r,visible:!1!==d},h)}):Object.assign(Object.assign({},g),{attrs:Object.assign({x:-p/2,y:-u/2,img:i,width:p,height:u,visible:!1!==d},h)})},xe=(t,e)=>"keyshape"===e?me(t).attrs:"halo"===e?fe(t).attrs:"label"===e?ve(t).attrs:"icon"===e?be(t).attrs:t[e]||{},Oe=(t,e,i)=>{const{type:s,position:o,value:n="",size:a,fill:r,stroke:l,color:d,fontSize:c,fontFamily:h,padding:p=0,offset:u=[0,0],id:g}=t,y=ue(u),[f,m]=ue(a),{x:v,y:b}=((t="RT",e)=>{let i=0,s=0;return"LT"===t?(i=e*Math.cos(3*Math.PI/4),s=-e*Math.sin(3*Math.PI/4)):"LB"===t?(i=e*Math.cos(5*Math.PI/4),s=-e*Math.sin(5*Math.PI/4)):"RT"===t?(i=e*Math.cos(1*Math.PI/4),s=-e*Math.sin(1*Math.PI/4)):"RB"===t&&(i=e*Math.cos(7*Math.PI/4),s=-e*Math.sin(7*Math.PI/4)),{x:i,y:s}})(o,i);let x=v,O=b;if(f===m){x+=y[0],O+=y[1];const t={attrs:{r:f/2+p,fill:r,stroke:l,x,y:O},name:"badges-circle"};g&&(t.id=g),e.addShape("circle",t)}else{x=v-f-2*p,O=b-m-2*p,"LB"===o?O=b:"RT"===o?(x=v,O=b-m-2*p):"RB"===o&&(x=v,O=b),x+=y[0],O+=y[1];const t={attrs:{width:f+2*p,height:m+2*p,fill:r,stroke:l,x,y:O,radius:(m+2*p)/3},name:"badges-rect"};g&&(t.id=g),e.addShape("rect",t)}"font"===s||"text"===s?e.addShape("text",{attrs:{x:f!==m?x+f/2+p:x,y:f!==m?O+m/2+p:O,text:n,fontSize:c,textAlign:"center",textBaseline:"middle",fontFamily:h,fill:d},capture:!1,name:"badges-text"}):"image"===s&&e.addShape("image",{attrs:{x:x-f/2,y:x-m/2,width:f,height:m,img:n},capture:!1,name:"badges-image"})};var we,Se=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};function je(t){return Object.keys(t).forEach((e=>{void 0===t[e]&&delete t[e]})),t}!function(t){t.NORMAL="normal",t.SELECTED="selected",t.HOVERED="hovered",t.DISABLED="disabled"}(we||(we={}));const Ee=(t,e)=>{return"keyshape"===e?function(t){const e=Se(t,[]);return je(Object.assign({id:"keyshape"},e))}(t.keyshape||{}):"halo"===e?function(t){const e=Se(t,[]);return je(Object.assign({id:"halo"},e))}(t.halo||{}):"label"===e?function(t){const{value:e}=t,i=Se(t,["value"]);return je(Object.assign({id:"label",text:e},i))}(t.label||{}):"label-background"===e?(i=t[e]||{},Object.assign({id:"label-background"},i)):{};var i},Ce=(t,e,i)=>{const s=(e.x+t.x)/2,o=(e.y+t.y)/2,n=e.x-t.x,a=e.y-t.y,r=Math.sqrt(Math.pow(n,2)+Math.pow(a,2));return{x:s+a*i/r||0,y:o-n*i/r||0}};E().registerLayout("graphin-force",{getDefaultCfg:()=>({preset:{name:"grid",options:{}},stiffness:200,repulsion:1e3,centripetalOptions:{leaf:1.6,single:1.6},damping:.9,minEnergyThreshold:.1,maxSpeed:1e3,MaxIterations:1e4,animation:!0}),init(t){this.nodes=t.nodes,this.edges=t.edges;const{graph:e}=this,i=de(this,["graph"]),s=Object.assign(Object.assign({},this.getDefaultCfg()),i),{width:o,height:n,animation:a,done:r=(()=>{})}=s,l=de(s,["width","height","animation","done"]);this.simulation=new le(Object.assign(Object.assign(Object.assign({width:o,height:n,animation:a},l),i),{done:t=>{r(e,t)}})),this.simulation.setData(t),this.simulation.register("render",(i=>{if(!a&&t&&t.nodes&&t.nodes.length>0){const{nodes:e}=i;return t.nodes.forEach(((t,i)=>{const s=e[i];if(s&&s.id===t.id)t.x=e[i].x,t.y=e[i].y;else{const i=e.find((e=>e.id===t.id));i&&(t.x=i.x,t.y=i.y)}})),Object.assign({},i)}try{if(!e||e.destroyed)return;let t=!1;i.nodes.forEach((i=>{const s=e.findById(i.id);if(s){const e=s.get("model");e.x=i.x,e.y=i.y,"combo"===s.getType()&&(t=!0)}})),e.refreshPositions(t)}catch(t){console.error(t)}}))},execute(){this.simulation.start()},layout(t){this.init(t),this.execute()},updateCfg(t){this.cfg=Object.assign(Object.assign({},this.cfg),t)},destroy(){this.destroyed=!0,this.simulation.stop(),this.simulation=null},getType:()=>"graphin-force"}),E().registerLayout("preset",{init(){},execute(){},destroy(){this.destroyed=!0}}),E().registerNode("graphin-circle",{options:{style:{},status:{}},draw(t,e){const{_theme:i}=t.style;this.options=((t={})=>{const e=Pt(t),{defaultNodeStyle:i,defaultNodeStatusStyle:s}=e;return{style:i.style,status:s.status}})(i);const s=(0,m.merge)({},this.options.style,t.style);t._initialStyle=Object.assign({},s);const{icon:o,badges:n=[],keyshape:a}=s,r=ye(a.size);e.addShape("circle",fe(s));const l=e.addShape("circle",me(s));e.addShape("text",ve(s));const{type:d}=o;if("text"!==d&&"font"!==d||e.addShape("text",be(s)),"image"===d){const t=be(s),i=e.addShape("image",t),{clip:o}=s.icon;if(o){const{r:t}=o,e=ge(o,["r"]);i.setClip({type:"circle",attrs:Object.assign({x:0,y:0,r:t},e)})}}return n.forEach((t=>{Oe(t,e,r)})),l},setState(t,e,i){var s;if(!t)return;const o=i.getModel(),n=i.getContainer().get("children"),a=(0,m.merge)({},this.options.status,o.style.status),r=i.getModel()._initialStyle,l=(null===(s=i._cfg)||void 0===s?void 0:s.states)||[];try{Object.keys(a).forEach((i=>{t===i&&(e?he(n,a[i],xe):(he(n,r,xe),l.forEach((t=>{he(n,a[t],xe)}))))}))}catch(t){console.error(t)}},update(t,e){if(t.style)try{const i=(0,m.merge)({},t._initialStyle,t.style);t._initialStyle=Object.assign({},i);const{badges:s,keyshape:o}=i,n=ye(o.size),a=e.getContainer(),r=a.get("children");he(r,i,xe);const l=[...r];if(s){let t=0;l.forEach((e=>{e.cfg.name.startsWith("badges")?r.splice(t,1):t+=1})),s.forEach((t=>{Oe(t,a,n)}))}}catch(t){console.error("error")}}}),E().registerEdge("graphin-line",{draw(t,e){var i,s,o,n,a,r;const{_theme:l}=t.style;this.options=((t={})=>{const e=Pt(t),{defaultEdgeStyle:i,defaultEdgeStatusStyle:s}=e;return{style:i.style,status:s.status}})(l);const d=(0,m.merge)({},this.options.style,t.style);t&&(t._initialStyle=Object.assign({},d));const{startPoint:c={x:0,y:0},endPoint:h={x:0,y:0},sourceNode:p,targetNode:u}=t,{label:g,halo:y,keyshape:f}=d,v=p.get("model"),b=(null==u?void 0:u.get("model"))||{id:"temp"},x=(null===(s=null===(i=v.style)||void 0===i?void 0:i.keyshape)||void 0===s?void 0:s.size)||28,O="loop"===(null==f?void 0:f.type)||v.id===b.id,w=g.value,S="poly"===(null==f?void 0:f.type),j=Ce(c,h,(null===(o=null==f?void 0:f.poly)||void 0===o?void 0:o.distance)||0),E=(null==f?void 0:f.lineWidth)||1,C=E+5,k=((t,e)=>{var i,s;const{startPoint:o={x:0,y:0},endPoint:n={x:0,y:0},sourceNode:a,targetNode:r}=t,{keyshape:l}=e,{type:d="line",poly:c={distance:0},loop:h={}}=l,p=a.get("model"),u=(null==r?void 0:r.get("model"))||{id:"temp"};if("loop"===d||p.id===u.id){const t=(null===(s=null===(i=p.style)||void 0===i?void 0:i.keyshape)||void 0===s?void 0:s.size)||26,{distance:e,dx:n,rx:a,ry:r}=Object.assign({distance:0,dx:8,rx:void 0,ry:void 0},h),l=t/2,d=Math.sqrt(Math.max(Math.pow(l,2)-Math.pow(n,2),0)),c=a||2*l*.5,u=r||2*l*.6;return[["M",o.x-n,o.y-d],["A",c+e,u+e,0,1,1,o.x+n,o.y-d]]}if("poly"===d){const t=Ce(o,n,(null==c?void 0:c.distance)||0);return[["M",o.x,o.y],["Q",t.x,t.y,n.x,n.y]]}return[["M",o.x,o.y],["L",n.x,n.y]]})(t,d);e.addShape("path",{attrs:Object.assign({id:"halo",path:k,lineWidth:E+10,stroke:y.stroke||f.stroke,strokeOpacity:y.strokeOpacity||.4},y),draggable:!0,name:"halo",visible:!1!==y.visible});const N=e.addShape("path",{attrs:Object.assign({id:"keyshape",path:k,endArrow:O?void 0:{d:0,path:`M 0,0 L ${C},${C/2} L ${C},-${C/2} Z`,fill:f.stroke},startArrow:O?{d:0,path:`M 0,0 L ${C},${C/2} L ${C},-${C/2} Z`,fill:f.stroke}:void 0},f),draggable:!0,name:"keyshape"});if(w){const{value:t,fontSize:i=8,offset:s=[0,0],background:o}=g,l=Se(g,["value","fontSize","offset","background"]),d=Boolean(o),[p,u]=s;let y=Math.atan((h.y-c.y)/(h.x-c.x)),m=[(c.x+h.x)/2,(c.y+h.y)/2];if(S&&(m=[(j.x+m[0])/2,(j.y+m[1])/2]),h.x-c.x==0&&(y=Math.PI/2),O&&(y=2*Math.PI),d){const s={fill:"#fff",width:z(t)*i*.6,height:1.8*i,stroke:f.stroke,lineWidth:1,radius:6},a=Object.assign(Object.assign({},s),o),{fill:r,width:l,height:d,stroke:c}=a,h=Se(a,["fill","width","height","stroke"]);let g=-d/2+u;O&&(g=-(d/2+u+i+1*x+2*((null===(n=null==f?void 0:f.loop)||void 0===n?void 0:n.distance)||0)));const v=e.addShape("rect",{attrs:Object.assign({id:"label-background",x:-l/2+p,y:g,width:l,height:d,fill:r,stroke:c},h),draggable:!0,name:"label-background"});v.rotate(y),v.translate(m[0],m[1])}let v=u-i/2;d&&(v=u+i/2),O&&(v=d?-(u+i/2+1*x+2*((null===(a=null==f?void 0:f.loop)||void 0===a?void 0:a.distance)||0)):-(u+i+1*x+2*((null===(r=null==f?void 0:f.loop)||void 0===r?void 0:r.distance)||0)));const b=e.addShape("text",{attrs:Object.assign({id:"label",x:p,y:v,text:t,fontSize:i},l),draggable:!0,name:"label"});b.rotate(y),b.translate(m[0],m[1])}return N},setState(t,e,i){var s;if(!t)return;const o=i.getModel(),n=i.getContainer().get("children"),a=(0,m.merge)({},this.options.status,o.style.status),r=i.getModel()._initialStyle,l=(null===(s=i._cfg)||void 0===s?void 0:s.states)||[];try{Object.keys(a).forEach((i=>{var s;t===i&&(e?he(n,a[i],Ee):(he(n,Object.assign(Object.assign({},r),{"label-background":null===(s=r.label)||void 0===s?void 0:s.background}),Ee),l.forEach((t=>{he(n,a[t],Ee)}))))}))}catch(t){console.error(t)}},afterDraw(t,e){const i=(0,m.merge)({},this.options.style,t.style),{animate:s,keyshape:o}=i;if(!s||!s.type||!1===s.visible)return;const n=e.get("children").find((t=>"keyshape"===t.get("name"))),{color:a,type:r,repeat:l=!0,duration:d=3e3}=s;if("circle-running"===r){const t=n.getPoint(0);e.addShape("circle",{attrs:{x:t.x,y:t.y,fill:a||o.stroke,r:1.5*o.lineWidth+2},name:"circle-shape"}).animate((t=>{const e=n.getPoint(t);return{x:e.x,y:e.y}}),{repeat:l,duration:d})}if("line-dash"===r){let t=0;const e=s.lineDash||o.lineDash||[4,2,1,2];n.animate((()=>(t++,t>9&&(t=0),{lineDash:e,lineDashOffset:-t})),{repeat:l,duration:d})}if("line-growth"===r){const t=n.getTotalLength();n.animate((e=>{const i=e*t;return{lineDash:[i,t-i]}}),{repeat:l,duration:d})}}});const{registerFontFamily:ke}=Wt,Ne=Wt})(),a})()));