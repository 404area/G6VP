/*! For license information please see index.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("GISDK"),require("React"),require("ReactDOM"),require("_"),require("antd")):"function"==typeof define&&define.amd?define(["GISDK","React","ReactDOM","_","antd"],e):"object"==typeof exports?exports.GI_ASSETS_SCENE=e(require("GISDK"),require("React"),require("ReactDOM"),require("_"),require("antd")):t.GI_ASSETS_SCENE=e(t.GISDK,t.React,t.ReactDOM,t._,t.antd)}(self,((t,e,n,r,i)=>(()=>{var o={5011:function(t){"use strict";t.exports=function(){function t(t){var r=[];return t.AMapUI&&r.push(e(t.AMapUI)),t.Loca&&r.push(n(t.Loca)),Promise.all(r)}function e(t){return new Promise((function(e,n){var i=[];if(t.plugins)for(var u=0;u<t.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(t.plugins[u])&&i.push(t.plugins[u]);if(a.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=t.version||o.AMapUI.version,u=o.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+u+"/main.js",c.onerror=function(t){a.AMapUI=r.failed,n("请求 AMapUI 失败")},c.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}for(e();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(e();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else a.AMapUI===r.loaded?t.version&&t.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}e()})):e():t.version&&t.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(t){t?n(t):i.length?window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}e()})):e()}))}))}function n(t){return new Promise((function(e,n){if(o.AMap.version.startsWith("2.0"))n("Loca 暂不适配 JSAPI 2.0,请使用 1.4.15");else if(a.Loca===r.failed)n("前次请求 Loca 失败");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=t.version||o.Loca.version;var i=o.Loca.version,u=o.key,l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+u,c.onerror=function(t){a.Loca=r.failed,n("请求 AMapUI 失败")},c.onload=function(){for(a.Loca=r.loaded,e();s.Loca.length;)s.Loca.splice(0,1)[0]()},l.appendChild(c)}else a.Loca===r.loaded?t.version&&t.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):e():t.version&&t.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(t){t?n(t):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[];return{load:function(e){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=e.key,l=e.version,c=e.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),o.key=s,o.AMap.version=l||o.AMap.version,o.AMap.plugins=c||o.AMap.plugins,a.AMap=r.loading,l=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,t(e).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(c=document.createElement("script")).type="text/javascript",c.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),c.onerror=function(t){a.AMap=r.failed,i(t)},l.appendChild(c)):i("请填写key")}else if(a.AMap==r.loaded)if(e.key&&e.key!==o.key)i("多个不一致的 key");else if(e.version&&e.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],e.plugins)for(l=0;l<e.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(e.plugins[l])&&s.push(e.plugins[l]);s.length?window.AMap.plugin(s,(function(){t(e).then((function(){n(window.AMap)})).catch(i)})):t(e).then((function(){n(window.AMap)})).catch(i)}else if(e.key&&e.key!==o.key)i("多个不一致的 key");else if(e.version&&e.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{var h=[];if(e.plugins)for(l=0;l<e.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(e.plugins[l])&&h.push(e.plugins[l]);!function(t){"function"==typeof t&&(a.AMap===r.loaded?t(window.AMap):u.push(t))}((function(){h.length?window.AMap.plugin(h,(function(){t(e).then((function(){n(window.AMap)})).catch(i)})):t(e).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}()},5048:(t,e,n)=>{"use strict";function r(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function a(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function s(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}n.d(e,{gg:()=>U,ni:()=>D,oI:()=>Z,sX:()=>V});var u={exports:{}},l={exports:{}},c={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t&&"number"==typeof t.length&&t.length>=0&&t.length%1==0},t.exports=e.default}(c,c.exports);var h={},p={exports:{}},f={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e.pop();return t.call(this,e,r)}},t.exports=e.default}(f,f.exports);var d={};Object.defineProperty(d,"__esModule",{value:!0}),d.fallback=_,d.wrap=x;var m,g=d.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,y=d.hasSetImmediate="function"==typeof setImmediate&&setImmediate,v=d.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function _(t){setTimeout(t,0)}function x(t){return function(e){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return t((function(){return e.apply(void 0,n)}))}}m=g?queueMicrotask:y?setImmediate:v?process.nextTick:_,d.default=x(m),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return(0,i.isAsync)(t)?function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e.pop(),i=t.apply(this,e);return a(i,r)}:(0,n.default)((function(e,n){var r;try{r=t.apply(this,e)}catch(t){return n(t)}if(r&&"function"==typeof r.then)return a(r,n);n(null,r)}))};var n=o(f.exports),r=o(d),i=h;function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e){return t.then((function(t){s(e,null,t)}),(function(t){s(e,t&&t.message?t:new Error(t))}))}function s(t,e,n){try{t(e,n)}catch(t){(0,r.default)((function(t){throw t}),t)}}t.exports=e.default}(p,p.exports),Object.defineProperty(h,"__esModule",{value:!0}),h.isAsyncIterable=h.isAsyncGenerator=h.isAsync=void 0;var b,w=(b=p.exports)&&b.__esModule?b:{default:b};function S(t){return"AsyncFunction"===t[Symbol.toStringTag]}h.default=function(t){if("function"!=typeof t)throw new Error("expected a function");return S(t)?(0,w.default)(t):t},h.isAsync=S,h.isAsyncGenerator=function(t){return"AsyncGenerator"===t[Symbol.toStringTag]},h.isAsyncIterable=function(t){return"function"==typeof t[Symbol.asyncIterator]};var E={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(void 0===e&&(e=t.length),!e)throw new Error("arity is undefined");return function(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[e-1]?t.apply(this,r):new Promise((function(i,o){r[e-1]=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(t)return o(t);i(e.length>1?e:e[0])},t.apply(n,r)}))}},t.exports=e.default}(E,E.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=o(c.exports),r=o(h),i=o(E.exports);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)((function(t,e,i){var o=(0,n.default)(e)?[]:{};t(e,(function(t,e,n){(0,r.default)(t)((function(t){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[e]=r,n(t)}))}),(function(t){return i(t,o)}))}),3),t.exports=e.default}(l,l.exports);var C={exports:{}},M={exports:{}},T={exports:{}},A={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(null!==t){var r=t;t=null,r.apply(this,e)}}return Object.assign(e,t),e},t.exports=e.default}(A,A.exports);var P={exports:{}},L={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},t.exports=e.default}(L,L.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if((0,n.default)(t))return function(t){var e=-1,n=t.length;return function(){return++e<n?{value:t[e],key:e}:null}}(t);var e=(0,r.default)(t);return e?function(t){var e=-1;return function(){var n=t.next();return n.done?null:(e++,{value:n.value,key:e})}}(e):function(t){var e=t?Object.keys(t):[],n=-1,r=e.length;return function i(){var o=e[++n];return"__proto__"===o?i():n<r?{value:t[o],key:o}:null}}(t)};var n=i(c.exports),r=i(L.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(P,P.exports);var I={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(null===t)throw new Error("Callback was already called.");var r=t;t=null,r.apply(this,e)}},t.exports=e.default}(I,I.exports);var k={exports:{}},O={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default={},t.exports=e.default}(O,O.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,r,i){var o=!1,a=!1,s=!1,u=0,l=0;function c(){u>=e||s||o||(s=!0,t.next().then((function(t){var e=t.value,n=t.done;if(!a&&!o){if(s=!1,n)return o=!0,void(u<=0&&i(null));u++,r(e,l,h),l++,c()}})).catch(p))}function h(t,e){if(u-=1,!a)return t?p(t):!1===t?(o=!0,void(a=!0)):e===n.default||o&&u<=0?(o=!0,i(null)):void c()}function p(t){a||(s=!1,o=!0,i(t))}c()};var n=function(t){return t&&t.__esModule?t:{default:t}}(O.exports);t.exports=e.default}(k,k.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=u(A.exports),r=u(P.exports),i=u(I.exports),o=h,a=u(k.exports),s=u(O.exports);function u(t){return t&&t.__esModule?t:{default:t}}e.default=function(t){return function(e,u,l){if(l=(0,n.default)(l),t<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!e)return l(null);if((0,o.isAsyncGenerator)(e))return(0,a.default)(e,t,u,l);if((0,o.isAsyncIterable)(e))return(0,a.default)(e[Symbol.asyncIterator](),t,u,l);var c=(0,r.default)(e),h=!1,p=!1,f=0,d=!1;function m(t,e){if(!p)if(f-=1,t)h=!0,l(t);else if(!1===t)h=!0,p=!0;else{if(e===s.default||h&&f<=0)return h=!0,l(null);d||g()}}function g(){for(d=!0;f<t&&!h;){var e=c();if(null===e)return h=!0,void(f<=0&&l(null));f+=1,u(e.value,e.key,(0,i.default)(m))}d=!1}g()}},t.exports=e.default}(T,T.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=o(T.exports),r=o(h),i=o(E.exports);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)((function(t,e,i,o){return(0,n.default)(e)(t,(0,r.default)(i),o)}),4),t.exports=e.default}(M,M.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=i(M.exports),r=i(E.exports);function i(t){return t&&t.__esModule?t:{default:t}}e.default=(0,r.default)((function(t,e,r){return(0,n.default)(t,1,e,r)}),3),t.exports=e.default}(C,C.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,n.default)(r.default,t,e)};var n=i(l.exports),r=i(C.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(u,u.exports);var R=s(u.exports),D=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,R(this.tasks)},t.prototype.tap=function(t,e){var n=this;this.tasks.push((function(r){e.apply(void 0,a([],o(n.args),!1)),r(null,t)}))},t}(),N={exports:{}},F={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=l(c.exports),r=l(O.exports),i=l(M.exports),o=l(A.exports),a=l(I.exports),s=l(h),u=l(E.exports);function l(t){return t&&t.__esModule?t:{default:t}}function p(t,e,n){n=(0,o.default)(n);var i=0,s=0,u=t.length,l=!1;function c(t,e){!1===t&&(l=!0),!0!==l&&(t?n(t):++s!==u&&e!==r.default||n(null))}for(0===u&&n(null);i<u;i++)e(t[i],i,(0,a.default)(c))}function f(t,e,n){return(0,i.default)(t,1/0,e,n)}e.default=(0,u.default)((function(t,e,r){return((0,n.default)(t)?p:f)(t,(0,s.default)(e),r)}),3),t.exports=e.default}(F,F.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,r.default)(n.default,t,e)};var n=i(F.exports),r=i(l.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(N,N.exports);var z=s(N.exports),B=(function(){function t(){this.tasks=[]}t.prototype.promise=function(){return z(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push((function(o){return r(n,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,e()];case 1:return n.sent(),o(null,t),[2]}}))}))}))}}(),{exports:{}});!function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=a(A.exports),r=a(I.exports),i=a(h),o=a(E.exports);function a(t){return t&&t.__esModule?t:{default:t}}e.default=(0,o.default)((function(t,e){if(e=(0,n.default)(e),!Array.isArray(t))return e(new Error("First argument to waterfall must be an array of functions"));if(!t.length)return e();var o=0;function a(e){(0,i.default)(t[o++]).apply(void 0,e.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===t.length?e.apply(void 0,[n].concat(r)):void a(r)}a([])})),t.exports=e.default}(B,B.exports);var j=s(B.exports),U=function(){function t(){this.tasks=[]}return t.prototype.call=function(){return j(this.tasks)},t.prototype.tap=function(t,e){0===this.tasks.length?this.tasks.push((function(t){var n=e();t(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!e.apply(void 0,a([],o(n),!1))&&null,t)}))},t}(),Z=function(){function t(){this.tasks=[]}return t.prototype.call=function(){return R(this.tasks)},t.prototype.tap=function(t,e){this.tasks.push((function(n){n(e(),t)}))},t}(),V=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,R(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push((function(s){return r(n,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,e.apply(void 0,a([],o(this.args),!1))];case 1:return n.sent(),s(null,t),[2]}}))}))}))},t}();(function(){function t(){this.args=[],this.tasks=[]}t.prototype.promise=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,R(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push((function(s){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,e.apply(void 0,a([],o(this.args),!1))];case 1:return n=r.sent(),s(n,t),[2]}}))}))}))}})(),function(){function t(){this.tasks=[]}t.prototype.promise=function(){return j(this.tasks)},t.prototype.tapPromise=function(t,e){0===this.tasks.length?this.tasks.push((function(t){e().then((function(e){t(null,e)}))})):this.tasks.push((function(t,n){e(t).then((function(t){n(null,t)}))}))}}()},3275:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});const r=function(){function t(){this._events={}}return t.prototype.on=function(t,e,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!n}),this},t.prototype.once=function(t,e){return this.on(t,e,!0)},t.prototype.emit=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this._events[t]||[],o=this._events["*"]||[],a=function(r){for(var i=r.length,o=0;o<i;o++)if(r[o]){var a=r[o],s=a.callback;a.once&&(r.splice(o,1),0===r.length&&delete e._events[t],i--,o--),s.apply(e,n)}};a(i),a(o)},t.prototype.off=function(t,e){if(t)if(e){for(var n=this._events[t]||[],r=n.length,i=0;i<r;i++)n[i].callback===e&&(n.splice(i,1),r--,i--);0===n.length&&delete this._events[t]}else delete this._events[t];else this._events={};return this},t.prototype.getEvents=function(){return this._events},t}()},5298:()=>{window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(t){try{var e,n=(e=(e=document.getElementsByTagName("script"))[e.length-1]).getAttribute("data-injectcss");if(!(e=e.getAttribute("data-disable-injectsvg"))){var r,i,o,a,s;if(n&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(e){console&&console.log(e)}}r=function(){var e,n=document.createElement("div");n.innerHTML=t._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",(e=document.body).firstChild?function(t,e){e.parentNode.insertBefore(t,e)}(n,e.firstChild):e.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),r()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=r,a=t.document,s=!1,function t(){try{a.documentElement.doScroll("left")}catch(e){return void setTimeout(t,50)}u()}(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,u())})}function u(){s||(s=!0,o())}}catch(l){}}(window)},5803:(t,e,n)=>{"use strict";n.r(e),n.d(e,{ButtonControl:()=>S,Control:()=>b,ExportImage:()=>V,Fullscreen:()=>Z,GeoLocate:()=>G,LayerPopup:()=>$,LayerSwitch:()=>X,Logo:()=>L,MapTheme:()=>q,Marker:()=>m,MarkerLayer:()=>_,MouseLocation:()=>Y,PopperControl:()=>T,Popup:()=>J,PositionType:()=>h.PositionType,Scale:()=>Q,SelectControl:()=>P,Zoom:()=>K});var r=n(1517),i=n(5683),o=n(89),a=n(3058),s=n(3285),u=n(5963),l=n(78),c=n(537),h=n(4534),p=n(9470),f=n(1883),d=n.n(f);var m=function(t){(0,s.Z)(d,t);var e,n,f=(e=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function d(t){var e;return(0,i.Z)(this,d),e=f.call(this),(0,c.Z)((0,a.Z)(e),"added",!1),(0,c.Z)((0,a.Z)(e),"eventHandle",(function(t){e.emit(t.type,{target:t,data:e.markerOption.extData,lngLat:e.lngLat})})),e.markerOption=(0,r.Z)((0,r.Z)({},e.getDefault()),t),(0,p.bindAll)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,a.Z)(e)),e.init(),e}return(0,o.Z)(d,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:p.anchorType.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(h.TYPES.IMapService),this.sceneSerive=t.get(h.TYPES.ISceneService);var e=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&p.DOM.remove(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var e=this;if(!this.added)return this.once("added",(function(){e.setElement(t)})),this;var n=this.markerOption.element;return n&&p.DOM.remove(n),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",(function(){t.openPopup()})),this;var e=this.popup;return e?(e.isOpen()||e.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",(function(){t.closePopup()}));var e=this.popup;return e&&e.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;return t?(t.isOpen()?t.remove():t.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.anchor;this.updatePosition(),p.DOM.setTransform(e,"".concat(p.anchorTranslate[n]))}}},{key:"onMapClick",value:function(t){var e=this.markerOption.element;this.popup&&e&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(null==t?void 0:t.scrollHeight)||0,containerWidth:(null==t?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(e){e.style.display="block",e.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,l=s.containerWidth,c=s.bounds;if(!c)return;if(Math.abs(c[0][0])>180||Math.abs(c[1][0])>180){if(a.x>l){var h=this.mapsService.lngLatToContainer([i-360,o]);a.x=h.x}if(a.x<0){var p=this.mapsService.lngLatToContainer([i+360,o]);a.x=p.x}}(a.x>l||a.x<0||a.y>u||a.y<0)&&(e.style.display="none"),e.style.left=a.x+n[0]+"px",e.style.top=a.y-n[1]+"px"}}}},{key:"init",value:function(){var t=this,e=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!e){this.defaultMarker=!0,e=p.DOM.create("div"),this.markerOption.element=e;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),e.appendChild(o)}p.DOM.addClass(e,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=t.markerOption)||void 0===r?void 0:r.style)&&(null===(i=t.markerOption)||void 0===i?void 0:i.style[n]);e&&(e.style[n]=o)})),e.addEventListener("click",(function(e){t.onMapClick(e)})),e.addEventListener("click",this.eventHandle),(0,p.applyAnchorClass)(e,i,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(t){throw new Error("Method not implemented.")}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),d}(f.EventEmitter),g=n(9479),y=n(1469),v=n.n(y);var _=function(t){(0,s.Z)(d,t);var e,n,f=(e=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function d(t){var e,n;return(0,i.Z)(this,d),n=f.call(this),(0,c.Z)((0,a.Z)(n),"markers",[]),(0,c.Z)((0,a.Z)(n),"points",[]),(0,c.Z)((0,a.Z)(n),"clusterMarkers",[]),n.markerLayerOption=(0,g.merge)(n.getDefault(),t),(0,p.bindAll)(["update"],(0,a.Z)(n)),n.zoom=(null===(e=n.markerLayerOption.clusterOption)||void 0===e?void 0:e.zoom)||-99,n}return(0,o.Z)(d,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(h.TYPES.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this}},{key:"setContainerSize",value:function(){if(this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(null==t?void 0:t.scrollWidth)||0,containerHeight:(null==t?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var e=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),e&&(this.addPoint(t,this.markers.length),this.mapsService)){var n=this.mapsService.getZoom(),r=this.mapsService.getBounds();this.bbox=(0,p.padBounds)(r,.5),this.zoom=Math.floor(n),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"hide",value:function(){this.markers.map((function(t){t.getElement().style.opacity="0"})),this.clusterMarkers.map((function(t){t.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(t){t.getElement().style.opacity="1"})),this.clusterMarkers.map((function(t){t.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach((function(e){e.addTo(t.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(t){t.remove()})),this.clusterMarkers.forEach((function(t){t.remove()})),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,e){var n=t.getLnglat(),i={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:(0,r.Z)((0,r.Z)({},t.getExtData()),{},{marker_id:e})};this.points.push(i),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,e=t.radius,n=t.minZoom,r=void 0===n?0:n,i=t.maxZoom;this.clusterIndex=new(v())({radius:e,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,e){var n=this,r=t[0].concat(t[1]),i=this.clusterIndex.getClusters(r,e);this.clusterMarkers.forEach((function(t){t.remove()})),this.clusterMarkers=[],i.forEach((function(t){var e,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(null!==(e=t.properties)&&void 0!==e&&e.cluster_id){var a,s=n.getLeaves(null===(a=t.properties)||void 0===a?void 0:a.cluster_id);if(t.properties.clusterData=s,i&&o){var u=null==s?void 0:s.map((function(t){return(0,c.Z)({},i,t.properties[i])})),l=p.Satistics.getColumn(u,i),h=p.Satistics.getSatByColumn(o,l),f="point_"+o;t.properties[f]=h.toFixed(2)}}var d=n.clusterMarker(t);n.clusterMarkers.push(d),d.addTo(n.scene)}))}},{key:"getLeaves",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,e,n):null}},{key:"clusterMarker",value:function(t){var e=this.markerLayerOption.clusterOption.element,n=void 0===e?this.generateElement.bind(this):e;return new m({element:n(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]})}},{key:"normalMarker",value:function(t){var e=t.properties.marker_id;return this.markers[e]}},{key:"update",value:function(){if(this.mapsService&&0!==this.markers.length){var t=this.mapsService.getZoom(),e=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!(0,p.boundsContains)(this.bbox,e))&&(this.bbox=(0,p.padBounds)(e,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var e=p.DOM.create("div","l7-marker-cluster"),n=p.DOM.create("div","",e),r=p.DOM.create("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;t.properties.point_count=t.properties.point_count||1;var s=o&&a?t.properties["point_"+a]||t.properties[o]:t.properties.point_count;return r.textContent=s,e}}]),d}(f.EventEmitter),x=(n(5298),n(596));var b=function(t){(0,s.Z)(c,t);var e,n,a=(e=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function c(t){var e;return(0,i.Z)(this,c),e=a.call(this),c.controlCount++,e.controlOption=(0,r.Z)((0,r.Z)({},e.getDefault(t)),t||{}),e}return(0,o.Z)(c,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var e=this.getDefault(t);Object.entries(t).forEach((function(n){var r=(0,x.Z)(n,2),i=r[0];void 0===r[1]&&(t[i]=e[i])})),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,r.Z)((0,r.Z)({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(h.TYPES.IMapService),this.renderService=t.get(h.TYPES.IRendererService),this.layerService=t.get(h.TYPES.ILayerService),this.controlService=t.get(h.TYPES.IControlService),this.configService=t.get(h.TYPES.IGlobalConfigService),this.scene=t.get(h.TYPES.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),p.DOM.addClass(this.container,"l7-control");var e=this.controlOption,n=e.className,r=e.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;p.DOM.remove(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return p.DOM.create("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var t=this.container;p.DOM.removeClass(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var t=this.container;p.DOM.addClass(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:h.PositionType.TOPRIGHT,name:"".concat(c.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var e=this.mapsService.getContainer();null!==e&&e.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.PositionType.TOPLEFT,e=this.controlService;return e&&e.removeControl(this),this.controlOption.position=t,e&&e.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var e=this.container,n=this.controlOption.className;n&&p.DOM.removeClass(e,n),t&&p.DOM.addClass(e,t)}},{key:"setStyle",value:function(t){var e=this.container;t?e.setAttribute("style",t):e.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.controlOption.position,e=this.container;if(t instanceof Element)t.appendChild(e);else{var n=this.controlService.controlCorners[t];-1!==t.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e)}}},{key:"checkUpdateOption",value:function(t,e){return e.some((function(e){return e in t}))}}]),c}(d());(0,c.Z)(b,"controlCount",0);var w=n(3080);var S=function(t){(0,s.Z)(h,t);var e,n,r=(e=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function h(){var t;(0,i.Z)(this,h);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,c.Z)((0,a.Z)(t),"isDisable",!1),t}return(0,o.Z)(h,[{key:"setIsDisable",value:function(t){var e,n;this.isDisable=t,t?null===(e=this.button)||void 0===e||e.setAttribute("disabled","true"):null===(n=this.button)||void 0===n||n.removeAttribute("disabled")}},{key:"createButton",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return p.DOM.create("button","l7-button-control ".concat(t))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var t=this.controlOption,e=t.title,n=t.btnText,r=t.btnIcon;return this.setBtnTitle(e),this.setBtnText(n),this.setBtnIcon(r),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(t){var e=t.title,n=t.btnText,r=t.btnIcon;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(e),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(r),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(n),(0,w.Z)((0,l.Z)(h.prototype),"setOptions",this).call(this,t)}},{key:"setBtnTitle",value:function(t){var e;null===(e=this.button)||void 0===e||e.setAttribute("title",null!=t?t:"")}},{key:"setBtnIcon",value:function(t){if(this.buttonIcon&&p.DOM.remove(this.buttonIcon),t){var e,n,r,i=null===(e=this.button)||void 0===e?void 0:e.firstChild;i?null===(n=this.button)||void 0===n||n.insertBefore(t,i):null===(r=this.button)||void 0===r||r.appendChild(t),this.buttonIcon=t}}},{key:"setBtnText",value:function(t){if(this.button)if(p.DOM.removeClass(this.button,"l7-button-control--row"),p.DOM.removeClass(this.button,"l7-button-control--column"),t){var e,n=this.buttonText;n||(n=p.DOM.create("div","l7-button-control__text"),null===(e=this.button)||void 0===e||e.appendChild(n),this.buttonText=n),n.innerText=t,p.DOM.addClass(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(p.DOM.remove(this.buttonText),this.buttonText=void 0)}}]),h}(b);var E=function(t){(0,s.Z)(h,t);var e,n,r=(e=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function h(t,e){var n;return(0,i.Z)(this,h),n=r.call(this),(0,c.Z)((0,a.Z)(n),"isShow",!1),(0,c.Z)((0,a.Z)(n),"timeout",null),(0,c.Z)((0,a.Z)(n),"show",(function(){return n.isShow||!n.contentDOM.innerHTML||(n.resetPopperPosition(),p.DOM.removeClass(n.popperDOM,"l7-popper-hide"),n.isShow=!0,n.option.unique&&h.conflictPopperList.forEach((function(t){t!==(0,a.Z)(n)&&t.isShow&&t.hide()})),n.emit("show")),(0,a.Z)(n)})),(0,c.Z)((0,a.Z)(n),"hide",(function(){return n.isShow?(p.DOM.addClass(n.popperDOM,"l7-popper-hide"),n.isShow=!1,n.emit("hide"),(0,a.Z)(n)):(0,a.Z)(n)})),(0,c.Z)((0,a.Z)(n),"setHideTimeout",(function(){n.timeout||(n.timeout=window.setTimeout((function(){n.isShow&&(n.hide(),n.timeout=null)}),300))})),(0,c.Z)((0,a.Z)(n),"clearHideTimeout",(function(){n.timeout&&(window.clearTimeout(n.timeout),n.timeout=null)})),(0,c.Z)((0,a.Z)(n),"onBtnClick",(function(){n.isShow?n.hide():n.show()})),(0,c.Z)((0,a.Z)(n),"onBtnMouseLeave",(function(){n.setHideTimeout()})),(0,c.Z)((0,a.Z)(n),"onBtnMouseMove",(function(){n.clearHideTimeout(),n.isShow||n.show()})),n.button=t,n.option=e,n.init(),e.unique&&h.conflictPopperList.push((0,a.Z)(n)),n}return(0,o.Z)(h,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){"string"==typeof t?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(p.DOM.clearChildren(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),"click"===t?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),p.DOM.remove(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t={},e=this.option,n=e.container,r=e.offset,i=void 0===r?[0,0]:r,o=e.placement,a=(0,x.Z)(i,2),s=a[0],u=a[1],l=this.button.getBoundingClientRect(),c=n.getBoundingClientRect(),h=p.DOM.getDiffRect(l,c),f=h.left,d=h.right,m=h.top,g=h.bottom,y=!1,v=!1;/^(left|right)/.test(o)?(o.includes("left")?t.right="".concat(l.width+d,"px"):o.includes("right")&&(t.left="".concat(l.width+f,"px")),o.includes("start")?t.top="".concat(m,"px"):o.includes("end")?t.bottom="".concat(g,"px"):(t.top="".concat(m+l.height/2,"px"),v=!0,t.transform="translate(".concat(s,"px, calc(").concat(u,"px - 50%))"))):/^(top|bottom)/.test(o)&&(o.includes("top")?t.bottom="".concat(l.height+g,"px"):o.includes("bottom")&&(t.top="".concat(l.height+m,"px")),o.includes("start")?t.left="".concat(f,"px"):o.includes("end")?t.right="".concat(d,"px"):(t.left="".concat(f+l.width/2,"px"),y=!0,t.transform="translate(calc(".concat(s,"px - 50%), ").concat(u,"px)"))),t.transform="translate(calc(".concat(s,"px - ").concat(y?"50%":"0%","), calc(").concat(u,"px - ").concat(v?"50%":"0%",")");var _=o.split("-");_.length&&p.DOM.addClass(this.popperDOM,_.map((function(t){return"l7-popper-".concat(t)})).join(" ")),p.DOM.addStyle(this.popperDOM,p.DOM.css2Style(t))}},{key:"createPopper",value:function(){var t=this.option,e=t.container,n=t.className,r=void 0===n?"":n,i=t.content,o=p.DOM.create("div","l7-popper l7-popper-hide ".concat(r)),a=p.DOM.create("div","l7-popper-content"),s=p.DOM.create("div","l7-popper-arrow");return o.appendChild(a),o.appendChild(s),e.appendChild(o),this.popperDOM=o,this.contentDOM=a,i&&this.setContent(i),o}}]),h}(f.EventEmitter);(0,c.Z)(E,"conflictPopperList",[]);var C,M={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},T=function(t){(0,s.Z)(c,t);var e,n,a=(e=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function c(){return(0,i.Z)(this,c),a.apply(this,arguments)}return(0,o.Z)(c,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,w.Z)((0,l.Z)(c.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(t){var e,n=(0,w.Z)((0,l.Z)(c.prototype),"getDefault",this).call(this,t),i=null!==(e=null==t?void 0:t.position)&&void 0!==e?e:n.position;return(0,r.Z)((0,r.Z)({},(0,w.Z)((0,l.Z)(c.prototype),"getDefault",this).call(this,t)),{},{popperPlacement:i instanceof Element?"bottom":M[i],popperTrigger:"click"})}},{key:"onAdd",value:function(){var t=(0,w.Z)((0,l.Z)(c.prototype),"onAdd",this).call(this);return this.initPopper(),t}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var t=this,e=this.controlOption,n=e.popperClassName,r=e.popperPlacement,i=e.popperTrigger,o=this.mapsService.getMapContainer();return this.popper=new E(this.button,{className:n,placement:r,trigger:i,container:o,unique:!0}),this.popper.on("show",(function(){t.emit("popperShow",t)})).on("hide",(function(){t.emit("popperHide",t)})),this.popper}},{key:"setOptions",value:function(t){if((0,w.Z)((0,l.Z)(c.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){var e=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(e)}}}]),c}(S),A=n(92);!function(t){t.ActiveOptionClassName="l7-select-control-item-active",t.OptionValueAttrKey="data-option-value",t.OptionIndexAttrKey="data-option-index"}(C||(C={}));var P=function(t){(0,s.Z)(h,t);var e,n,r=(e=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function h(){var t;(0,i.Z)(this,h);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,c.Z)((0,a.Z)(t),"selectValue",[]),(0,c.Z)((0,a.Z)(t),"createNormalOption",(function(e){var n=t.selectValue.includes(e.value),r=p.DOM.create("div","l7-select-control-item ".concat(n?C.ActiveOptionClassName:""));t.getIsMultiple()&&r.appendChild(t.createCheckbox(n)),e.icon&&r.appendChild(e.icon);var i=p.DOM.create("span");return i.innerText=e.text,r.appendChild(i),r})),(0,c.Z)((0,a.Z)(t),"onItemClick",(function(e){if(t.getIsMultiple()){var n=t.selectValue.findIndex((function(t){return t===e.value}));n>-1?t.selectValue.splice(n,1):t.selectValue=[].concat((0,A.Z)(t.selectValue),[e.value])}else t.selectValue=[e.value];t.setSelectValue(t.selectValue)})),t}return(0,o.Z)(h,[{key:"setOptions",value:function(t){(0,w.Z)((0,l.Z)(h.prototype),"setOptions",this).call(this,t);var e=t.options;e&&this.popper.setContent(this.getPopperContent(e))}},{key:"onAdd",value:function(){var t=(0,w.Z)((0,l.Z)(h.prototype),"onAdd",this).call(this),e=this.controlOption.defaultValue;return e&&(this.selectValue=this.transSelectValue(e)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.transSelectValue(t);this.optionDOMList.forEach((function(t){var n=t.getAttribute(C.OptionValueAttrKey),i=e.getIsMultiple()?t.querySelector("input[type=checkbox]"):void 0;r.includes(n)?(p.DOM.addClass(t,C.ActiveOptionClassName),i&&p.DOM.setChecked(i,!0)):(p.DOM.removeClass(t,C.ActiveOptionClassName),i&&p.DOM.setChecked(i,!1))})),this.selectValue=r,n&&this.emit("selectChange",this.getIsMultiple()?r:r[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(t){var e=this,n=this.isImageOptions(),r=p.DOM.create("div",n?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&p.DOM.addClass(r,"l7-select-control--multiple");var i=t.map((function(t,r){var i=n?e.createImageOption(t):e.createNormalOption(t);return i.setAttribute(C.OptionValueAttrKey,t.value),i.setAttribute(C.OptionIndexAttrKey,window.String(r)),i.addEventListener("click",e.onItemClick.bind(e,t)),i}));return r.append.apply(r,(0,A.Z)(i)),this.optionDOMList=i,r}},{key:"createImageOption",value:function(t){var e=this.selectValue.includes(t.value),n=p.DOM.create("div","l7-select-control-item ".concat(e?C.ActiveOptionClassName:"")),r=p.DOM.create("img");r.setAttribute("src",t.img),p.DOM.setUnDraggable(r),n.appendChild(r);var i=p.DOM.create("div","l7-select-control-item-row");this.getIsMultiple()&&n.appendChild(this.createCheckbox(e));var o=p.DOM.create("span");return o.innerText=t.text,i.appendChild(o),n.appendChild(i),n}},{key:"createCheckbox",value:function(t){var e=p.DOM.create("input");return e.setAttribute("type","checkbox"),t&&p.DOM.setChecked(e,!0),e}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find((function(t){return t.img}))}},{key:"transSelectValue",value:function(t){return Array.isArray(t)?t:[t]}}]),h}(T);var L=function(t){(0,s.Z)(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function a(){return(0,i.Z)(this,a),r.apply(this,arguments)}return(0,o.Z)(a,[{key:"getDefault",value:function(){return{position:h.PositionType.BOTTOMLEFT,name:"logo",href:"https://l7.antv.vision/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=p.DOM.create("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){(0,w.Z)((0,l.Z)(a.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(p.DOM.clearChildren(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var e=this.controlOption,n=e.href,r=e.img,i=p.DOM.create("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),p.DOM.setUnDraggable(i),n){var o=p.DOM.create("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),t.appendChild(o)}else t.appendChild(i)}}]),a}(b),I=n(7012),k=n(5814),O=n.n(k),R=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("l7-iconfont"),e.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(t)),e.appendChild(n),e};function D(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return N(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var F=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],z=function(){if("undefined"==typeof document)return!1;var t,e=F[0],n={},r=D(F);try{for(r.s();!(t=r.n()).done;){var i=t.value;if((null==i?void 0:i[1])in document){var o,a=D(i.entries());try{for(a.s();!(o=a.n()).done;){var s=(0,x.Z)(o.value,2),u=s[0],l=s[1];n[e[u]]=l}}catch(t){a.e(t)}finally{a.f()}return n}}}catch(t){r.e(t)}finally{r.f()}return!1}(),B={change:z.fullscreenchange,error:z.fullscreenerror},j={request:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,e=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function t(){j.off("change",t),n()};j.on("change",i);var o=t[z.requestFullscreen](e);o instanceof Promise&&o.then(i).catch(r)}))},exit:function(){return new Promise((function(t,e){if(j.isFullscreen){var n=function e(){j.off("change",e),t()};j.on("change",n);var r=document[z.exitFullscreen]();r instanceof Promise&&r.then(n).catch(e)}else t()}))},toggle:function(t,e){return j.isFullscreen?j.exit():j.request(t,e)},onchange:function(t){j.on("change",t)},onerror:function(t){j.on("error",t)},on:function(t,e){var n=B[t];n&&document.addEventListener(n,e,!1)},off:function(t,e){var n=B[t];n&&document.removeEventListener(n,e,!1)},raw:z};Object.defineProperties(j,{isFullscreen:{get:function(){return Boolean(document[z.fullscreenElement])}},element:{enumerable:!0,get:function(){var t;return null!==(t=document[z.fullscreenElement])&&void 0!==t?t:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[z.fullscreenEnabled])}}}),z||(j={isEnabled:!1});const U=j;var Z=function(t){(0,s.Z)(f,t);var e,n,h=(e=f,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function f(t){var e;return(0,i.Z)(this,f),e=h.call(this,t),(0,c.Z)((0,a.Z)(e),"isFullscreen",!1),(0,c.Z)((0,a.Z)(e),"toggleFullscreen",(0,I.Z)(O().mark((function t(){return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!U.isEnabled){t.next=3;break}return t.next=3,U.toggle(e.mapContainer);case 3:case"end":return t.stop()}}),t)})))),(0,c.Z)((0,a.Z)(e),"onClick",(function(){e.toggleFullscreen()})),(0,c.Z)((0,a.Z)(e),"onFullscreenChange",(function(){e.isFullscreen=!!document.fullscreenElement;var t=e.controlOption,n=t.btnText,r=t.btnIcon,i=t.title,o=t.exitBtnText,a=t.exitBtnIcon,s=t.exitTitle;e.isFullscreen?(e.setBtnTitle(s),e.setBtnText(o),e.setBtnIcon(a)):(e.setBtnTitle(i),e.setBtnText(n),e.setBtnIcon(r)),e.emit("fullscreenChange",e.isFullscreen)})),U.isEnabled||console.warn("当前浏览器环境不支持对地图全屏化"),e}return(0,o.Z)(f,[{key:"setOptions",value:function(t){var e=t.exitBtnText,n=t.exitBtnIcon,r=t.exitTitle;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(n),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(e),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(r)),(0,w.Z)((0,l.Z)(f.prototype),"setOptions",this).call(this,t)}},{key:"onAdd",value:function(){var t=(0,w.Z)((0,l.Z)(f.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),this.mapContainer=p.DOM.getContainer(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}},{key:"onRemove",value:function(){(0,w.Z)((0,l.Z)(f.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(t){return(0,r.Z)((0,r.Z)({},(0,w.Z)((0,l.Z)(f.prototype),"getDefault",this).call(this,t)),{},{title:"全屏",btnIcon:R("l7-icon-fullscreen"),exitTitle:"退出全屏",exitBtnIcon:R("l7-icon-exit-fullscreen")})}}]),f}(S);var V=function(t){(0,s.Z)(p,t);var e,n,h=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function p(){var t;(0,i.Z)(this,p);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=h.call.apply(h,[this].concat(n)),(0,c.Z)((0,a.Z)(t),"onClick",(0,I.Z)(O().mark((function e(){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=t.controlOption.onExport)){e.next=5;break}e.next=10;break;case 5:return e.t0=n,e.next=8,t.getImage();case 8:e.t1=e.sent,(0,e.t0)(e.t1);case 10:case"end":return e.stop()}}),e)})))),(0,c.Z)((0,a.Z)(t),"mergeImage",(0,I.Z)(O().mark((function e(){var n,r,i,o,a,s,u,l,c,h,p,f,d,m=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=t.controlOption.imageType,o=null!==(n=null===(r=t.mapsService.getContainer())||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},a=o.width,s=void 0===a?0:a,u=o.height,l=void 0===u?0:u,(c=document.createElement("canvas")).width=s,c.height=l,h=c.getContext("2d"),p=m.length,f=new Array(p),d=0;d<p;d++)f[d]=m[d];return e.next=9,Promise.all(f.map((function(t){return new Promise((function(e){var n=new Image;n.onload=function(){e(n)},n.src=t}))})));case 9:return e.sent.forEach((function(t){null==h||h.drawImage(t,0,0,s,l)})),e.abrupt("return",c.toDataURL("image/".concat(i)));case 12:case"end":return e.stop()}}),e)})))),t}return(0,o.Z)(p,[{key:"onAdd",value:function(){var t=(0,w.Z)((0,l.Z)(p.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}},{key:"getDefault",value:function(t){return(0,r.Z)((0,r.Z)({},(0,w.Z)((0,l.Z)(p.prototype),"getDefault",this).call(this,t)),{},{title:"导出图片",btnIcon:R("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var t=this.mapsService.exportMap("png"),e=this.scene.exportPng("png");return this.mergeImage(t,e)}}]),p}(S);var G=function(t){(0,s.Z)(p,t);var e,n,h=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function p(t){var e;return(0,i.Z)(this,p),e=h.call(this,t),(0,c.Z)((0,a.Z)(e),"getGeoLocation",(function(){return new Promise((function(t,e){window.navigator.geolocation.getCurrentPosition((function(n){var r=n.coords,i=null!=r?r:{},o=i.longitude,a=i.latitude;(0,g.isNaN)(o)||(0,g.isNaN)(a)?e():t([o,a])}),(function(t){e(t)}))}))})),(0,c.Z)((0,a.Z)(e),"onClick",(0,I.Z)(O().mark((function t(){var n,r,i;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(window.navigator.geolocation){t.next=2;break}return t.abrupt("return");case 2:return n=e.controlOption.transform,t.next=5,e.getGeoLocation();case 5:if(r=t.sent,i=e.mapsService.getZoom(),t.t0=e.mapsService,t.t1=i>15?i:15,!n){t.next=15;break}return t.next=12,n(r);case 12:t.t2=t.sent,t.next=16;break;case 15:t.t2=r;case 16:t.t3=t.t2,t.t0.setZoomAndCenter.call(t.t0,t.t1,t.t3);case 18:case"end":return t.stop()}}),t)})))),window.navigator.geolocation||console.warn("当前浏览器环境不支持获取地理定位"),e}return(0,o.Z)(p,[{key:"getDefault",value:function(t){return(0,r.Z)((0,r.Z)({},(0,w.Z)((0,l.Z)(p.prototype),"getDefault",this).call(this,t)),{},{title:"定位",btnIcon:R("l7-icon-reposition")})}},{key:"onAdd",value:function(){var t=(0,w.Z)((0,l.Z)(p.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}}]),p}(S),H={normal:{text:"标准",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-nqiT6Vu948AAAAAAAAAAAAAARQnAQ"},light:{text:"月光银",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*J_wYQL_PaUEAAAAAAAAAAAAAARQnAQ"},dark:{text:"幻影黑",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*U7M9QI1yat4AAAAAAAAAAAAAARQnAQ"},fresh:{text:"草色青",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*T-oBT4hB5ucAAAAAAAAAAAAAARQnAQ"},grey:{text:"雅士灰",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OREXQ4vgQRIAAAAAAAAAAAAAARQnAQ"},graffiti:{text:"涂鸦",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*4UApTKmeiy4AAAAAAAAAAAAAARQnAQ"},macaron:{text:"马卡龙",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*0GrCQLtDjNcAAAAAAAAAAAAAARQnAQ"},darkblue:{text:"极夜蓝",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*uWxqSZQlPkkAAAAAAAAAAAAAARQnAQ"},wine:{text:"酱籽",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OFPrTbg3an0AAAAAAAAAAAAAARQnAQ"}},W={normal:{text:"标准",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*AnfJTbIBJOkAAAAAAAAAAAAAARQnAQ"},light:{text:"亮",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gnuiQIok9qIAAAAAAAAAAAAAARQnAQ"},dark:{text:"暗",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*NwG-TbOlBH0AAAAAAAAAAAAAARQnAQ"},satellite:{text:"卫星",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*2X5EQLKul3IAAAAAAAAAAAAAARQnAQ"},outdoors:{text:"户外",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gXFLRIaBUI0AAAAAAAAAAAAAARQnAQ"}};var q=function(t){(0,s.Z)(p,t);var e,n,h=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function p(){var t;(0,i.Z)(this,p);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=h.call.apply(h,[this].concat(n)),(0,c.Z)((0,a.Z)(t),"onMapThemeChange",(function(){t.mapsService.setMapStyle(t.selectValue[0])})),t}return(0,o.Z)(p,[{key:"getDefault",value:function(t){return(0,r.Z)((0,r.Z)({},(0,w.Z)((0,l.Z)(p.prototype),"getDefault",this).call(this,t)),{},{title:"地图样式",btnIcon:R("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var t="mapbox"===this.mapsService.getType()?W:H;return Object.entries(this.mapsService.getMapStyleConfig()).filter((function(t){var e=(0,x.Z)(t,2),n=e[0];return"string"==typeof e[1]&&"blank"!==n})).map((function(e){var n,r=(0,x.Z)(e,2),i=r[0],o=r[1],a=null!==(n=t[i])&&void 0!==n?n:{},s=a.text;return{text:null!=s?s:i,value:o,img:a.img,key:i}}))}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var t,e=this;if(null!==(t=this.controlOption.options)&&void 0!==t&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var n,r,i=this.controlOption.defaultValue;this.controlOption.defaultValue=null!==(n=null===(r=this.controlOption.options.find((function(t){return t.key===i})))||void 0===r?void 0:r.value)&&void 0!==n?n:i}else{var o=this.getMapStyle();o?this.controlOption.defaultValue=o:this.mapsService.map.once("styledata",(function(){var t=e.mapsService.getMapStyle();e.controlOption.defaultValue=t,e.setSelectValue(t,!1)}))}return this.on("selectChange",this.onMapThemeChange),(0,w.Z)((0,l.Z)(p.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),p}(P);var X=function(t){(0,s.Z)(p,t);var e,n,h=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function p(){var t;(0,i.Z)(this,p);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=h.call.apply(h,[this].concat(n)),(0,c.Z)((0,a.Z)(t),"onLayerChange",(function(){var e;null!==(e=t.controlOption.layers)&&void 0!==e&&e.length||(t.selectValue=t.getLayerVisible(),t.setOptions({options:t.getLayerOptions()}))})),(0,c.Z)((0,a.Z)(t),"onLayerVisibleChane",(function(){t.setSelectValue(t.getLayerVisible())})),(0,c.Z)((0,a.Z)(t),"onSelectChange",(function(){t.layers.forEach((function(e){var n=t.selectValue.includes(e.name),r=e.isVisible();n&&!r&&e.show(),!n&&r&&e.hide()}))})),t}return(0,o.Z)(p,[{key:"layers",get:function(){var t=this.layerService,e=this.controlOption.layers;if(Array.isArray(e)&&e.length){var n=[];return e.forEach((function(e){if(e instanceof Object&&n.push(e),"string"==typeof e){var r=t.getLayer(e)||t.getLayerByName(e);r&&n.push(r)}})),n}return t.getLayers()||[]}},{key:"getDefault",value:function(t){return(0,r.Z)((0,r.Z)({},(0,w.Z)((0,l.Z)(p.prototype),"getDefault",this).call(this,t)),{},{title:"图层控制",btnIcon:R("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter((function(t){return t.isVisible()})).map((function(t){return t.name}))}},{key:"getLayerOptions",value:function(){return this.layers.map((function(t){return{text:t.name,value:t.name}}))}},{key:"setOptions",value:function(t){var e=this.checkUpdateOption(t,["layers"]);(0,w.Z)((0,l.Z)(p.prototype),"setOptions",this).call(this,t),e&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var t;return null!==(t=this.controlOption.options)&&void 0!==t&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,w.Z)((0,l.Z)(p.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),p}(P);var Y=function(t){(0,s.Z)(d,t);var e,n,f=(e=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function d(){var t;(0,i.Z)(this,d);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=f.call.apply(f,[this].concat(n)),(0,c.Z)((0,a.Z)(t),"location",[0,0]),(0,c.Z)((0,a.Z)(t),"onMouseMove",(function(e){var n=t.location,r=e.lngLat||e.lnglat,i=t.controlOption.transform;r&&(n=[r.lng,r.lat]),t.location=n,i&&(n=i(n)),t.insertLocation2HTML(n),t.emit("locationChange",n)})),t}return(0,o.Z)(d,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return(0,r.Z)((0,r.Z)({},(0,w.Z)((0,l.Z)(d.prototype),"getDefault",this).call(this,t)),{},{position:h.PositionType.BOTTOMLEFT,transform:function(t){var e=(0,x.Z)(t,2),n=e[0],r=e[1];return[+(+n).toFixed(6),+(+r).toFixed(6)]}})}},{key:"onAdd",value:function(){var t=p.DOM.create("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(t){this.container.innerText=t.join(", ")}}]),d}(b);var K=function(t){(0,s.Z)(d,t);var e,n,f=(e=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function d(){var t;(0,i.Z)(this,d);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=f.call.apply(f,[this].concat(n)),(0,c.Z)((0,a.Z)(t),"zoomIn",(function(){!t.disabled&&t.mapsService.getZoom()<t.mapsService.getMaxZoom()&&t.mapsService.zoomIn()})),(0,c.Z)((0,a.Z)(t),"zoomOut",(function(){!t.disabled&&t.mapsService.getZoom()>t.mapsService.getMinZoom()&&t.mapsService.zoomOut()})),(0,c.Z)((0,a.Z)(t),"updateDisabled",(function(){var e=t.mapsService;t.zoomInButton.removeAttribute("disabled"),t.zoomOutButton.removeAttribute("disabled"),(t.disabled||e.getZoom()<=e.getMinZoom())&&t.zoomOutButton.setAttribute("disabled","true"),(t.disabled||e.getZoom()>=e.getMaxZoom())&&t.zoomInButton.setAttribute("disabled","true")})),t}return(0,o.Z)(d,[{key:"getDefault",value:function(t){return(0,r.Z)((0,r.Z)({},(0,w.Z)((0,l.Z)(d.prototype),"getDefault",this).call(this,t)),{},{position:h.PositionType.BOTTOMRIGHT,name:"zoom",zoomInText:R("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:R("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(t){(0,w.Z)((0,l.Z)(d.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=p.DOM.create("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){p.DOM.clearChildren(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,e,n,r,i){var o=p.DOM.create("button",n,r);return"string"==typeof t?o.innerHTML=t:o.append(t),o.title=e,o.addEventListener("click",i),o}}]),d}(b);var Q=function(t){(0,s.Z)(d,t);var e,n,f=(e=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function d(){var t;(0,i.Z)(this,d);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=f.call.apply(f,[this].concat(n)),(0,c.Z)((0,a.Z)(t),"update",(function(){var e=t.mapsService,n=t.controlOption.maxWidth,r=e.getSize()[1]/2,i=e.containerToLngLat([0,r]),o=e.containerToLngLat([n,r]),a=(0,p.lnglatDistance)([i.lng,i.lat],[o.lng,o.lat]);t.updateScales(a)})),t}return(0,o.Z)(d,[{key:"getDefault",value:function(t){return(0,r.Z)((0,r.Z)({},(0,w.Z)((0,l.Z)(d.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:h.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t=p.DOM.create("div","l7-control-scale");this.resetScaleLines(t);var e=this.controlOption.updateWhenIdle;return this.mapsService.on(e?"moveend":"mapmove",this.update),this.mapsService.on(e?"zoomend":"zoomchange",this.update),t}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){(0,w.Z)((0,l.Z)(d.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var e=this.controlOption,n=e.metric,r=e.imperial;n&&t&&this.updateMetric(t),r&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){p.DOM.clearChildren(t);var e=this.controlOption,n=e.metric,r=e.imperial,i=e.maxWidth;e.lockWidth&&p.DOM.addStyle(t,"width: ".concat(i,"px")),n&&(this.mScale=p.DOM.create("div","l7-control-scale-line",t)),r&&(this.iScale=p.DOM.create("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,e,n){var r=this.controlOption.maxWidth;t.style.width=Math.round(r*n)+"px",t.innerHTML=e}},{key:"getRoundNum",value:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"updateMetric",value:function(t){var e=this.getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this.updateScale(this.mScale,n,e/t)}},{key:"updateImperial",value:function(t){var e,n,r,i=3.2808399*t;i>5280?(e=i/5280,n=this.getRoundNum(e),this.updateScale(this.iScale,n+" mi",n/e)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),d}(b);var J=function(t){(0,s.Z)(d,t);var e,n,f=(e=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function d(t){var e;(0,i.Z)(this,d),e=f.call(this),(0,c.Z)((0,a.Z)(e),"isShow",!0),(0,c.Z)((0,a.Z)(e),"onMouseMove",(function(t){var n,r=e.mapsService.getMapContainer(),i=null!==(n=null==r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},o=i.left,a=void 0===o?0:o,s=i.top,u=void 0===s?0:s;e.setPopupPosition(t.clientX-a,t.clientY-u)})),(0,c.Z)((0,a.Z)(e),"updateLngLatPosition",(function(){if(e.mapsService&&!e.popupOption.followCursor){var t=e.lngLat,n=t.lng,r=t.lat,i=e.mapsService.lngLatToContainer([n,r]),o=i.x,a=i.y;e.setPopupPosition(o,a)}})),(0,c.Z)((0,a.Z)(e),"onKeyDown",(function(t){27===t.keyCode&&e.remove()})),(0,c.Z)((0,a.Z)(e),"onCloseButtonClick",(function(t){t.stopPropagation&&t.stopPropagation(),e.remove()})),(0,c.Z)((0,a.Z)(e),"update",(function(){var t=!!e.lngLat,n=e.popupOption,r=n.className,i=n.style,o=n.maxWidth,a=n.anchor,s=n.stopPropagation;if(e.mapsService&&t&&e.content){var u=e.mapsService.getMarkerContainer();!e.container&&u&&(e.container=p.DOM.create("div","l7-popup ".concat(null!=r?r:""," ").concat(e.isShow?"":"l7-popup-hide"),u),i&&e.container.setAttribute("style",i),e.tip=p.DOM.create("div","l7-popup-tip",e.container),e.container.appendChild(e.content),s&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(t){e.container.addEventListener(t,(function(t){t.stopPropagation()}))})),e.container.style.whiteSpace="nowrap"),o&&e.container.style.maxWidth!==o&&(e.container.style.maxWidth=o),e.updateLngLatPosition(),p.DOM.setTransform(e.container,"".concat(p.anchorTranslate[a])),(0,p.applyAnchorClass)(e.container,a,"popup")}})),e.popupOption=(0,r.Z)((0,r.Z)({},e.getDefault(null!=t?t:{})),t);var n=e.popupOption.lngLat;return n&&(e.lngLat=n),e}return(0,o.Z)(d,[{key:"lngLat",get:function(){var t;return null!==(t=this.popupOption.lngLat)&&void 0!==t?t:{lng:0,lat:0}},set:function(t){this.popupOption.lngLat=t}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(t){this.mapsService=t.get(h.TYPES.IMapService),this.sceneService=t.get(h.TYPES.ISceneService),this.layerService=t.get(h.TYPES.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var e=this.popupOption,n=e.html,r=e.text;return n?this.setHTML(n):r&&this.setText(r),this.emit("open"),this}},{key:"remove",value:function(){if(this.isOpen())return this.content&&p.DOM.remove(this.content),this.container&&(p.DOM.remove(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(t){return this.popupOption=(0,r.Z)((0,r.Z)({},this.popupOption),t),this.checkUpdateOption(t,["closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets","title"])&&(this.container&&(p.DOM.remove(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&p.DOM.removeClass(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&p.DOM.addClass(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(t){return this.popupOption.html=t,this.setDOMContent(this.getPopupHTMLFragment(t))}},{key:"setText",value:function(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}},{key:"panToPopup",value:function(){var t=this.lngLat,e=t.lng,n=t.lat;return this.popupOption.autoPan&&this.mapsService.panTo([e,n]),this}},{key:"setLngLat",value:function(t){return this.setLnglat(t)}},{key:"setLnglat",value:function(t){var e=this;return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout((function(){e.panToPopup()}),0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:p.anchorType.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(t){return this.createContent(),this.contentPanel.appendChild(t),this.update(),this}},{key:"updateCloseOnClick",value:function(t){this.mapsService.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&this.mapsService.on("click",this.onCloseButtonClick)}},{key:"updateCloseOnEsc",value:function(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(t){var e=this.mapsService.getContainer();e.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&e.addEventListener("mousemove",this.onMouseMove)}},{key:"createContent",value:function(){var t;if(this.content&&p.DOM.remove(this.content),this.content=p.DOM.create("div","l7-popup-content",this.container),this.popupOption.title?(this.contentTitle=p.DOM.create("div","l7-popup-content__title",this.content),null===(t=this.contentTitle)||void 0===t||t.append(this.getPopupHTMLFragment(this.popupOption.title))):this.contentTitle=void 0,this.popupOption.closeButton){var e=R("l7-icon-guanbi");p.DOM.addClass(e,"l7-popup-close-button"),this.content.appendChild(e),this.popupOption.closeButtonOffsets&&(e.style.right=this.popupOption.closeButtonOffsets[0]+"px",e.style.top=this.popupOption.closeButtonOffsets[1]+"px"),e.setAttribute("aria-label","Close popup"),e.addEventListener("click",this.onCloseButtonClick),this.closeButton=e}else this.closeButton=void 0;this.contentPanel=p.DOM.create("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(t,e){if(this.container){var n=this.popupOption.offsets;this.container.style.left=t+n[0]+"px",this.container.style.top=e-n[1]+"px"}}},{key:"checkUpdateOption",value:function(t,e){return e.some((function(e){return e in t}))}},{key:"getPopupHTMLFragment",value:function(t){var e,n=window.document.createDocumentFragment(),r=window.document.createElement("body");for("string"==typeof t?r.innerHTML=t:Array.isArray(t)?r.append.apply(r,(0,A.Z)(t)):t instanceof HTMLElement&&r.append(t);e=r.firstChild;)n.appendChild(e);return n}}]),d}(f.EventEmitter);var $=function(t){(0,s.Z)(f,t);var e,n,h=(e=f,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,l.Z)(e);if(n){var i=(0,l.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,u.Z)(this,t)});function f(){var t;(0,i.Z)(this,f);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=h.call.apply(h,[this].concat(n)),(0,c.Z)((0,a.Z)(t),"layerConfigMap",new WeakMap),t}return(0,o.Z)(f,[{key:"layerConfigItems",get:function(){var t,e=this.popupOption,n=e.config,r=e.items;return null!==(t=null!=n?n:r)&&void 0!==t?t:[]}},{key:"addTo",value:function(t){return(0,w.Z)((0,l.Z)(f.prototype),"addTo",this).call(this,t),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,w.Z)((0,l.Z)(f.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(t){return this.unbindLayerEvent(),(0,w.Z)((0,l.Z)(f.prototype),"setOptions",this).call(this,t),this.bindLayerEvent(),this}},{key:"getDefault",value:function(t){var e="click"===t.trigger;return(0,r.Z)((0,r.Z)({},(0,w.Z)((0,l.Z)(f.prototype),"getDefault",this).call(this,t)),{},{trigger:"hover",followCursor:!e,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var t=this,e=this.popupOption.trigger;this.layerConfigItems.forEach((function(n){var i,o=t.getLayerByConfig(n);if(o){var a=(0,r.Z)({},n);if("hover"===e){var s=t.onLayerMouseMove.bind(t,o),u=t.onLayerMouseOut.bind(t,o);a.onMouseMove=s,a.onMouseOut=u,null==o||o.on("mousemove",s),null==o||o.on("mouseout",u)}else{var l=t.onLayerClick.bind(t,o);a.onClick=l,null==o||o.on("click",l)}var c=null==o||null===(i=o.getSource)||void 0===i?void 0:i.call(o),h=t.onSourceUpdate.bind(t,o);null==c||c.on("update",h),a.onSourceUpdate=h,t.layerConfigMap.set(o,a)}}))}},{key:"unbindLayerEvent",value:function(){var t=this;this.layerConfigItems.forEach((function(e){var n=t.getLayerByConfig(e),r=n&&t.layerConfigMap.get(n);if(r){var i,o=r.onMouseMove,a=r.onMouseOut,s=r.onClick,u=r.onSourceUpdate;o&&n.off("mousemove",o),a&&n.off("mouseout",a),s&&n.off("click",s),u&&(null==n||null===(i=n.getSource())||void 0===i||i.off("update",u))}}))}},{key:"onLayerMouseMove",value:function(t,e){if(!this.isSameFeature(t,e.featureId)){var n=this.getLayerInfoFrag(t,e);this.setDOMContent(n),this.displayFeatureInfo={layer:t,featureId:e.featureId}}this.isShow||this.show()}},{key:"onLayerMouseOut",value:function(t,e){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(t,e){if(this.isShow&&this.isSameFeature(t,e.featureId))this.hide();else{var n=this.getLayerInfoFrag(t,e);this.setDOMContent(n),this.setLnglat(e.lngLat),this.show(),this.displayFeatureInfo={layer:t,featureId:e.featureId}}}},{key:"onSourceUpdate",value:function(t){var e;(null===(e=this.displayFeatureInfo)||void 0===e?void 0:e.layer)===t&&(this.hide(),this.displayFeatureInfo=void 0)}},{key:"getLayerInfoFrag",value:function(t,e){var n=this.layerConfigMap.get(t),r=document.createDocumentFragment();if(n){var i=e.feature;"Feature"===i.type&&"properties"in i&&"geometry"in i&&(i=i.properties);var o=n.fields;null==o||o.forEach((function(t){var n,o,a="string"==typeof t?{field:t}:t,s=a.field,u=a.formatField,l=a.formatValue,c=a.getValue,h=p.DOM.create("div","l7-layer-popup__row"),f=c?c(e.feature):(0,g.get)(i,s),d=null!==(n=u instanceof Function?u(s):u)&&void 0!==n?n:s,m=null!==(o=l instanceof Function?l(f):l)&&void 0!==o?o:f;h.innerHTML='<span class="l7-layer-popup__key">'.concat(d,'</span>: <span class="l7-layer-popup__value">').concat(m,"</span>"),r.appendChild(h)}))}return r}},{key:"getLayerByConfig",value:function(t){var e=t.layer;return e instanceof Object?e:"string"==typeof e?this.layerService.getLayer(e)||this.layerService.getLayerByName(e):void 0}},{key:"isSameFeature",value:function(t,e){var n=this.displayFeatureInfo;return n&&t===n.layer&&e===n.featureId}}]),f}(J);!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  -webkit-box-shadow: none;\n          box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 1000;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 800;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  -webkit-transition: all 0.2s;\n  transition: all 0.2s;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 6px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  -webkit-transform: scale(0.83333);\n          transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  height: 24px;\n  line-height: 24px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 16px;\n  font-size: 12px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  height: 14px;\n  width: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  padding: 12px 12px 0 12px;\n  width: 474px;\n  height: 320px;\n  overflow: auto;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-select-control--image .l7-select-control-item {\n  margin-right: 12px;\n  border-radius: 2px;\n  overflow: hidden;\n  border: 1px solid #fff;\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box;\n  width: calc((100% - 36px) / 3);\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  margin-bottom: 12px;\n  position: relative;\n  font-size: 12px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 142px;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control--image .l7-select-control-item:nth-child(3n) {\n  margin-right: 0;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.l7-control-zoom .l7-button-control {\n  -webkit-box-shadow: 0 0 0;\n          box-shadow: 0 0 0;\n  border-radius: 0;\n  font-size: 16px;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:first-child {\n  border-bottom: 1px solid #f0f0f0;\n}\n.l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  -webkit-transition: width 0.1s;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  pointer-events: none;\n  will-change: transform;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  pointer-events: auto;\n  font-size: 14px;\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  font-weight: bold;\n  margin-bottom: 8px;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  line-height: 18px;\n  text-align: center;\n  padding: 0;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n  font-size: 14px;\n}\n.l7-popup .l7-popup-tip {\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n")},4534:(t,e,n)=>{"use strict";n.r(e),n.d(e,{AttributeType:()=>wr,BasePostProcessingPass:()=>Tn,BlendType:()=>_r,CameraUniform:()=>Mr,CoordinateSystem:()=>Y,CoordinateUniform:()=>gt,InteractionEvent:()=>ct,MapServiceEvent:()=>Cr,PassType:()=>tn,PositionType:()=>k,ScaleTypes:()=>xr,SceneEventList:()=>Tr,StyleScaleType:()=>br,TYPES:()=>u,container:()=>fr,createLayerContainer:()=>gr,createSceneContainer:()=>mr,gl:()=>bt,lazyInject:()=>hr,lazyMultiInject:()=>pr,packCircleVertex:()=>Er}),n(171);var r,i=n(1883),o=n.n(i),a=n(7745),s=n(719),u={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},l=n(1517),c=n(5683),h=n(89),p=n(3058),f=n(3285),d=n(5963),m=n(78),g=n(537),y=n(9470),v=n(8298),_=n.n(v);function x(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function w(t,e,n){var r,i=x(e);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;t[a.id]=(0,l.Z)((0,l.Z)({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(t){i.e(t)}finally{i.f()}}function S(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function E(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var M=function(){for(var t=[],e=32;e<128;e++)t.push(String.fromCharCode(e));return t}();function T(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="black",t.textBaseline="middle"}function A(t,e){for(var n=0;n<t.length;n++)e.data[4*n+3]=t[n]}var P,L=(0,a.b2)()(r=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){var t;(0,c.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,g.Z)((0,p.Z)(t),"fontAtlas",void 0),(0,g.Z)((0,p.Z)(t),"iconFontMap",void 0),(0,g.Z)((0,p.Z)(t),"iconFontGlyphs",{}),(0,g.Z)((0,p.Z)(t),"fontOptions",void 0),(0,g.Z)((0,p.Z)(t),"key",void 0),(0,g.Z)((0,p.Z)(t),"cache",new y.LRUCache(3)),t}return(0,h.Z)(i,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:M,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var e=this;t.forEach((function(t){e.iconFontGlyphs[t.name]=t.unicode}))}},{key:"addIconFont",value:function(t,e){this.iconFontMap.set(t,e)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,l.Z)((0,l.Z)({},this.fontOptions),t),this.key=this.getKey();var e=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==e.length){var r=this.generateFontAtlas(this.key,e,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(t,e){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(t,"';\n            src: url('").concat(e,"') format('woff2'),\n            url('").concat(e,"') format('woff'),\n            url('").concat(e,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then((function(){n.emit("fontloaded",{fontFamily:t})}))}catch(t){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(t)}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,e,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,c=r.radius,h=r.cutoff,p=r.iconfont,f=n&&n.data;f||((f=y.$window.document.createElement("canvas")).width=1024);var d=f.getContext("2d");T(d,i,a,o);var m=function(t){var e=t.characterSet,n=t.getFontWidth,r=t.fontHeight,i=t.buffer,o=t.maxCanvasWidth,a=t.mapping,s=void 0===a?{}:a,u=t.xOffset,l=void 0===u?0:u,c=t.yOffset,h=void 0===c?0:c,p=0,f=l;Array.from(e).forEach((function(t,e){if(!s[t]){var r=n(t,e);f+30>o&&(f=0,p++),s[t]={x:f,y:h+30*p,width:30,height:30,advance:r},f+=30}}));var d=r+2*i;return{mapping:s,xOffset:f,yOffset:h+p*d,canvasHeight:S(h+(p+1)*d)}}((0,l.Z)({getFontWidth:function(t){return d.measureText(t).width},fontHeight:1*a,buffer:s,characterSet:e,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),g=m.mapping,v=m.canvasHeight,x=m.xOffset,b=m.yOffset,w=d.getImageData(0,0,f.width,f.height);if(f.height=v,d.putImageData(w,0,0),T(d,i,a,o),u){var C,M=new(_())(a,s,c,h,i,o),P=d.getImageData(0,0,M.size,M.size),L=E(e);try{for(L.s();!(C=L.n()).done;){var I=C.value;if(p){var k=String.fromCharCode(parseInt(I.replace("&#x","").replace(";",""),16));A(M.draw(k),P)}else A(M.draw(I),P);d.putImageData(P,g[I].x,g[I].y)}}catch(t){L.e(t)}finally{L.f()}}else{var O,R=E(e);try{for(R.s();!(O=R.n()).done;){var D=O.value;d.fillText(D,g[D].x,g[D].y+1*a)}}catch(t){R.e(t)}finally{R.f()}}return{xOffset:x,yOffset:b,mapping:g,data:f,width:f.width,height:f.height}}},{key:"getKey",value:function(){return"key"}},{key:"getNewChars",value:function(t,e){var n=this.cache.get(t);if(!n)return e;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(e).forEach((function(t){o.has(t)||r.push(t)})),r}}]),i}(i.EventEmitter))||r;var I,k,O,R=(0,a.b2)()(P=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){var t;(0,c.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,g.Z)((0,p.Z)(t),"canvasHeight",128),(0,g.Z)((0,p.Z)(t),"texture",void 0),(0,g.Z)((0,p.Z)(t),"canvas",void 0),(0,g.Z)((0,p.Z)(t),"iconData",void 0),(0,g.Z)((0,p.Z)(t),"iconMap",void 0),(0,g.Z)((0,p.Z)(t),"ctx",void 0),(0,g.Z)((0,p.Z)(t),"loadingImageCount",0),t}return(0,h.Z)(i,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=y.$window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(t,e){var n=this,r=new Image;if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:64}),this.updateIconMap(),this.loadImage(e).then((function(e){r=e;var i=n.iconData.find((function(e){return e.id===t}));i&&(i.image=r,i.width=r.width,i.height=r.height),n.update()}))}},{key:"addImageMini",value:function(t,e,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:64}),this.updateIconMap(),this.loadImageMini(e,i).then((function(e){o=e;var n=r.iconData.find((function(e){return e.id===t}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter((function(e){return e.id!==t})),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise((function(e,n){if(t instanceof HTMLImageElement)e(t);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e(r)},r.onerror=function(){n(new Error("Could not load image at "+t))},r.src=t instanceof File?URL.createObjectURL(t):t}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(e){var n=t.iconMap[e],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,l=void 0===u?64:u,c=Math.max(s,l)/64,h=l/c,p=s/c;o&&t.ctx.drawImage(o,r+(64-p)/2,i+(64-h)/2,p,h)}))}},{key:"updateIconMap",value:function(){var t=function(t,e,n){var r,i=0,o=0,a=0,s=[],u={},l=x(t);try{for(l.s();!(r=l.n()).done;){var c=r.value;if(!u[c.id]){var h=c.size;i+h+3>1024&&(w(u,s,o),i=0,o=a+o+3,a=0,s=[]),s.push({icon:c,xOffset:i}),i=i+h+3,a=Math.max(a,h)}}}catch(t){l.e(t)}finally{l.f()}return s.length>0&&w(u,s,o),{mapping:u,canvasHeight:S(a+o+3)}}(this.iconData),e=t.mapping,n=t.canvasHeight;this.iconMap=e,this.canvasHeight=n}},{key:"loadImageMini",value:function(t,e){return new Promise((function(n,r){var i=e.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+t))},i.src=t}))}}]),i}(i.EventEmitter))||P,D=n(596),N=n(2401),F=(0,a.b2)()(I=function(){function t(){(0,c.Z)(this,t),(0,g.Z)(this,"viewport",void 0),(0,g.Z)(this,"overridedViewProjectionMatrix",void 0),(0,g.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,g.Z)(this,"jitteredProjectionMatrix",void 0),(0,g.Z)(this,"viewMatrixInverse",void 0),(0,g.Z)(this,"cameraPosition",void 0)}return(0,h.Z)(t,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=N.create(),N.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),e=(0,D.Z)(t,2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,e){var n=N.fromTranslation(N.create(),[t,e,0]);this.jitteredProjectionMatrix=N.multiply(N.create(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=N.multiply(N.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),t}())||I,z=n(92);function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(t){t.TOPRIGHT="topright",t.TOPLEFT="topleft",t.BOTTOMRIGHT="bottomright",t.BOTTOMLEFT="bottomleft",t.TOPCENTER="topcenter",t.BOTTOMCENTER="bottomcenter",t.LEFTCENTER="leftcenter",t.RIGHTCENTER="rightcenter",t.LEFTTOP="lefttop",t.RIGHTTOP="righttop",t.LEFTBOTTOM="leftbottom",t.RIGHTBOTTOM="rightbottom"}(k||(k={}));var j,U,Z={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},V=(0,a.b2)()(O=function(){function t(){(0,c.Z)(this,t),(0,g.Z)(this,"container",void 0),(0,g.Z)(this,"controlCorners",void 0),(0,g.Z)(this,"controlContainer",void 0),(0,g.Z)(this,"scene",void 0),(0,g.Z)(this,"mapsService",void 0),(0,g.Z)(this,"controls",[]),(0,g.Z)(this,"unAddControls",[])}return(0,h.Z)(t,[{key:"init",value:function(t,e){this.container=t.container,this.scene=e,this.mapsService=e.get(u.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,e){e.get(u.IMapService).map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find((function(e){return e.controlOption.name===t}))}},{key:"removeControl",value:function(t){var e=this.controls.indexOf(t);return e>-1&&this.controls.splice(e,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach((function(e){e.addTo(t.scene),t.controls.push(e)})),this.unAddControls=[]}},{key:"destroy",value:function(){var t,e=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return B(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.controls);try{for(e.s();!(t=e.n()).done;)t.value.remove()}catch(t){e.e(t)}finally{e.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},e="l7-",n=this.controlContainer=y.DOM.create("div",e+"control-container",this.container);Object.values(k).forEach((function(r){var i,o;!function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=r.map((function(t){return e+t})).join(" ");t[r.filter((function(t){return!["row","column"].includes(t)})).join("")]=y.DOM.create("div",i,n)}((i=r,o=i.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),[].concat((0,z.Z)(o),[Z[i]])))}))}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&y.DOM.remove(this.controlCorners[t]);this.controlContainer&&y.DOM.remove(this.controlContainer)}}]),t}())||O,G=(0,a.b2)()(j=function(){function t(){(0,c.Z)(this,t),(0,g.Z)(this,"container",void 0),(0,g.Z)(this,"scene",void 0),(0,g.Z)(this,"mapsService",void 0),(0,g.Z)(this,"markers",[]),(0,g.Z)(this,"markerLayers",[]),(0,g.Z)(this,"unAddMarkers",[]),(0,g.Z)(this,"unAddMarkerLayers",[])}return(0,h.Z)(t,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var e=this.markerLayers.indexOf(t);e>-1&&this.markerLayers.splice(e,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach((function(e){e.addTo(t.scene),t.markers.push(e)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach((function(e){t.markerLayers.push(e),e.addTo(t.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(u.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(t){t.remove()})),this.markers=[],this.markerLayers.forEach((function(t){t.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),t}())||j,H=(0,a.b2)()(U=function(){function t(){(0,c.Z)(this,t),(0,g.Z)(this,"scene",void 0),(0,g.Z)(this,"mapsService",void 0),(0,g.Z)(this,"popups",[]),(0,g.Z)(this,"unAddPopups",[])}return(0,h.Z)(t,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t.isOpen()&&t.remove();var e=this.popups.indexOf(t);e>-1&&this.popups.splice(e,1);var n=this.unAddPopups.indexOf(t);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach((function(t){return t.remove()}))}},{key:"addPopup",value:function(t){var e=this;t&&t.getOptions().autoClose&&[].concat((0,z.Z)(this.popups),(0,z.Z)(this.unAddPopups)).forEach((function(t){t.getOptions().autoClose&&e.removePopup(t)})),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",(function(){e.removePopup(t)}))}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach((function(e){t.addPopup(e),t.unAddPopups=[]}))}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(u.IMapService)}}]),t}())||U,W=n(9479);const q={MapToken:"您正在使用 Demo测试地图token，如果生产环境中使用去对应地图请注册Token",SDK:"请确认引入了mapbox-gl api且在L7之前引入"};var X,Y,K={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Q={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},J=(0,a.b2)()(X=function(){function t(){(0,c.Z)(this,t),(0,g.Z)(this,"sceneConfigCache",{}),(0,g.Z)(this,"layerConfigCache",{})}return(0,h.Z)(t,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return q[t]}},{key:"setSceneConfig",value:function(t,e){this.sceneConfigCache[t]=(0,l.Z)((0,l.Z)({},K),e)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,e,n){this.layerConfigCache[e]=(0,l.Z)({},(0,W.merge)({},this.sceneConfigCache[t],Q,n))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),t}())||X,$=n(6368),tt=n(5495),et=n(5512),nt=Math.PI/180,rt=4003e4;function it(t){var e=t.latitude,n=void 0===e?0:e,r=t.zoom,i=void 0===r?0:r,o=t.scale,a=t.highPrecision,s=void 0!==a&&a,u=t.flipY,l=void 0!==u&&u,c={},h=512*(o=void 0!==o?o:Math.pow(2,i)),p=Math.cos(n*nt),f=h/360,d=f/p,m=h/rt/p;if(c.pixelsPerMeter=[m,-m,m],c.metersPerPixel=[1/m,-1/m,1/m],c.pixelsPerDegree=[f,-d,m],c.degreesPerPixel=[1/f,-1/d,1/m],s){var g=nt*Math.tan(n*nt)/p,y=f*g/2,v=h/rt*g,_=v/d*m;c.pixelsPerDegree2=[0,-y,v],c.pixelsPerMeter2=[_,0,_],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}!function(t){t[t.LNGLAT=1]="LNGLAT",t[t.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",t[t.VECTOR_TILE=3]="VECTOR_TILE",t[t.IDENTITY=4]="IDENTITY",t[t.P20=5]="P20",t[t.P20_OFFSET=6]="P20_OFFSET",t[t.METER_OFFSET=7]="METER_OFFSET",t[t.P20_2=8]="P20_2"}(Y||(Y={}));var ot,at,st,ut,lt,ct,ht,pt,ft,dt,mt,gt={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},yt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],vt=(ot=(0,a.b2)(),at=(0,a.f3)(u.ICameraService),ot((ut=function(){function t(){(0,c.Z)(this,t),(0,g.Z)(this,"needRefresh",!0),(0,$.Z)(this,"cameraService",lt,this),(0,g.Z)(this,"coordinateSystem",void 0),(0,g.Z)(this,"viewportCenter",void 0),(0,g.Z)(this,"viewportCenterProjection",void 0),(0,g.Z)(this,"pixelsPerDegree",void 0),(0,g.Z)(this,"pixelsPerDegree2",void 0),(0,g.Z)(this,"pixelsPerMeter",void 0)}return(0,h.Z)(t,[{key:"refresh",value:function(t){var e=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=t||this.cameraService.getCenter(),i=it({latitude:r[1],zoom:e}),o=i.pixelsPerMeter,a=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Y.LNGLAT||this.coordinateSystem===Y.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Y.LNGLAT_OFFSET?this.calculateLnglatOffset(r,e):this.coordinateSystem===Y.P20_OFFSET&&this.calculateLnglatOffset(r,e,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,e,n,r){var i=it({latitude:t[1],zoom:e,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),c=N.multiply([],l,u),h=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,e));this.viewportCenterProjection=et.fF([],[h[0],h[1],0,1],c),u=this.cameraService.getViewMatrixUncentered()||u,c=N.multiply([],l,u),c=N.multiply([],c,yt),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),t}(),lt=(0,tt.Z)(ut.prototype,"cameraService",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st=ut))||st),_t=n(9315),xt=n.n(_t);!function(t){t.Hover="hover",t.Click="click",t.Select="select",t.Active="active",t.Drag="drag"}(ct||(ct={}));var bt,wt,St,Et,Ct,Mt,Tt,At,Pt,Lt,It,kt,Ot,Rt,Dt={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Nt=(ht=(0,a.b2)(),pt=(0,a.f3)(u.IMapService),ht((dt=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){var t;(0,c.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,g.Z)((0,p.Z)(t),"indragging",!1),(0,$.Z)((0,p.Z)(t),"mapService",mt,(0,p.Z)(t)),(0,g.Z)((0,p.Z)(t),"hammertime",void 0),(0,g.Z)((0,p.Z)(t),"lastClickTime",0),(0,g.Z)((0,p.Z)(t),"lastClickXY",[-1,-1]),(0,g.Z)((0,p.Z)(t),"clickTimer",void 0),(0,g.Z)((0,p.Z)(t),"$containter",void 0),(0,g.Z)((0,p.Z)(t),"onDrag",(function(e){var n=t.interactionEvent(e);n.type=Dt[n.type],"dragging"===n.type?t.indragging=!0:t.indragging=!1,t.emit(ct.Drag,n)})),(0,g.Z)((0,p.Z)(t),"onHammer",(function(e){e.srcEvent.stopPropagation();var n=t.interactionEvent(e);t.emit(ct.Hover,n)})),(0,g.Z)((0,p.Z)(t),"onTouch",(function(e){var n=e.touches[0];t.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),(0,g.Z)((0,p.Z)(t),"onHover",(function(e){var n=e.clientX,r=e.clientY,i=e.type,o=t.mapService.getMapContainer();if(o)if(y.isMini)n=n-o.left-0,r=r-o.top-0;else{var a=o.getBoundingClientRect(),s=a.top;n=n-a.left-o.clientLeft,r=r-s-o.clientTop}var u=t.mapService.containerToLngLat([n,r]);if("click"!==i)"touch"!==i?"click"!==i&&"dblclick"!==i&&t.emit(ct.Hover,{x:n,y:r,lngLat:u,type:i,target:e}):t.isDoubleTap(n,r,u);else{if(!y.isMini&&"ontouchstart"in document.documentElement==1)return;t.isDoubleTap(n,r,u)}})),t}return(0,h.Z)(i,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ct.Hover)}},{key:"triggerHover",value:function(t){var e=t.x,n=t.y;this.emit(ct.Hover,{x:e,y:n})}},{key:"triggerSelect",value:function(t){this.emit(ct.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(ct.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t)if(y.isMini)y.$window.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=new(xt().Manager)(t);e.add(new(xt().Tap)({event:"dblclick",taps:2})),e.add(new(xt().Tap)({event:"click"})),e.add(new(xt().Pan)({threshold:0,pointers:0})),e.add(new(xt().Press)({})),e.on("dblclick click",this.onHammer),e.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=e}}},{key:"removeEventListenerOnMap",value:function(){if(y.isMini)y.$window.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(t){var e,n,r=t.type;"touch"===t.pointerType?(n=Math.floor(t.pointers[0].clientY),e=Math.floor(t.pointers[0].clientX)):(n=Math.floor(t.srcEvent.y),e=Math.floor(t.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;e-=o.left,n-=a}return{x:e,y:n,lngLat:this.mapService.containerToLngLat([e,n]),type:r,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,e,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-e)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(ct.Hover,{x:t,y:e,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[t,e],this.clickTimer=setTimeout((function(){o="click",r.emit(ct.Hover,{x:t,y:e,lngLat:n,type:o})}),400))}}]),i}(o()),mt=(0,tt.Z)(dt.prototype,"mapService",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ft=dt))||ft),Ft=n(7012),zt=n(5814),Bt=n.n(zt),jt=0;function Ut(t){if(y.isMini)return null;var e=t;if("string"==typeof t&&(e=document.getElementById(t)),e){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(jt++),n.classList.add("l7-scene"),e.appendChild(n),n}return null}!function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.CULL_FACE=2884]="CULL_FACE",t[t.BLEND=3042]="BLEND",t[t.DITHER=3024]="DITHER",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.TEXTURE1=33985]="TEXTURE1",t[t.TEXTURE2=33986]="TEXTURE2",t[t.TEXTURE3=33987]="TEXTURE3",t[t.TEXTURE4=33988]="TEXTURE4",t[t.TEXTURE5=33989]="TEXTURE5",t[t.TEXTURE6=33990]="TEXTURE6",t[t.TEXTURE7=33991]="TEXTURE7",t[t.TEXTURE8=33992]="TEXTURE8",t[t.TEXTURE9=33993]="TEXTURE9",t[t.TEXTURE10=33994]="TEXTURE10",t[t.TEXTURE11=33995]="TEXTURE11",t[t.TEXTURE12=33996]="TEXTURE12",t[t.TEXTURE13=33997]="TEXTURE13",t[t.TEXTURE14=33998]="TEXTURE14",t[t.TEXTURE15=33999]="TEXTURE15",t[t.TEXTURE16=34e3]="TEXTURE16",t[t.TEXTURE17=34001]="TEXTURE17",t[t.TEXTURE18=34002]="TEXTURE18",t[t.TEXTURE19=34003]="TEXTURE19",t[t.TEXTURE20=34004]="TEXTURE20",t[t.TEXTURE21=34005]="TEXTURE21",t[t.TEXTURE22=34006]="TEXTURE22",t[t.TEXTURE23=34007]="TEXTURE23",t[t.TEXTURE24=34008]="TEXTURE24",t[t.TEXTURE25=34009]="TEXTURE25",t[t.TEXTURE26=34010]="TEXTURE26",t[t.TEXTURE27=34011]="TEXTURE27",t[t.TEXTURE28=34012]="TEXTURE28",t[t.TEXTURE29=34013]="TEXTURE29",t[t.TEXTURE30=34014]="TEXTURE30",t[t.TEXTURE31=34015]="TEXTURE31",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"}(bt||(bt={}));var Zt,Vt,Gt,Ht,Wt,qt,Xt,Yt=(wt=(0,a.b2)(),St=(0,a.f3)(u.IMapService),Et=(0,a.f3)(u.IRendererService),Ct=(0,a.f3)(u.IGlobalConfigService),Mt=(0,a.f3)(u.IInteractionService),Tt=(0,a.f3)(u.ILayerService),wt((Pt=function(){function t(){var e=this;(0,c.Z)(this,t),(0,g.Z)(this,"pickedColors",void 0),(0,g.Z)(this,"pickedTileLayers",[]),(0,$.Z)(this,"mapService",Lt,this),(0,$.Z)(this,"rendererService",It,this),(0,$.Z)(this,"configService",kt,this),(0,$.Z)(this,"interactionService",Ot,this),(0,$.Z)(this,"layerService",Rt,this),(0,g.Z)(this,"pickingFBO",void 0),(0,g.Z)(this,"width",0),(0,g.Z)(this,"height",0),(0,g.Z)(this,"alreadyInPicking",!1),(0,g.Z)(this,"pickBufferScale",1),(0,g.Z)(this,"pickFromPickingFBO",(function(t,n){var r=n.x,i=n.y,o=n.lngLat,a=n.type,s=n.target,u=!1,c=e.rendererService,h=c.readPixels,p=c.getContainer,f=e.getContainerSize(p()),d=f.width,m=f.height;d*=y.DOM.DPR,m*=y.DOM.DPR;var g=t.getLayerConfig(),v=g.enableHighlight,_=g.enableSelect,x=r*y.DOM.DPR,b=i*y.DOM.DPR;if(x>d-1*y.DOM.DPR||x<0||b>m-1*y.DOM.DPR||b<0)return!1;var w=h({x:Math.floor(x/e.pickBufferScale),y:Math.floor((m-(i+1)*y.DOM.DPR)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO});if(e.pickedColors=w,0!==w[0]||0!==w[1]||0!==w[2]){var S=(0,y.decodePickingColor)(w),E=t.getSource().getFeatureById(S);S!==t.getCurrentPickId()&&"mousemove"===a&&(a="mouseenter");var C={x:r,y:i,type:a,lngLat:o,featureId:S,feature:E,target:s};E&&(u=!0,t.setCurrentPickId(S),e.triggerHoverOnLayer(t,C))}else{var M={x:r,y:i,lngLat:o,type:null!==t.getCurrentPickId()&&"mousemove"===a?"mouseout":"un"+a,featureId:null,target:s,feature:null};e.triggerHoverOnLayer(t,(0,l.Z)((0,l.Z)({},M),{},{type:"unpick"})),e.triggerHoverOnLayer(t,M),t.setCurrentPickId(null)}if(v&&e.highlightPickedFeature(t,w),_&&"click"===a&&(null==w?void 0:w.toString())!==[0,0,0,0].toString()){var T=(0,y.decodePickingColor)(w);null===t.getCurrentSelectedId()||T!==t.getCurrentSelectedId()?(e.selectFeature(t,w),t.setCurrentSelectedId(T)):(e.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)),t.isVector||e.layerService.getLayers().filter((function(t){return t.tileLayer})).map((function(t){t.tileLayer.clearPickState()}))}return u}))}var e,n,r;return(0,h.Z)(t,[{key:"init",value:function(t){var e=this.rendererService,n=e.createTexture2D,r=e.createFramebuffer,i=e.getContainer,o=this.getContainerSize(i()),a=o.width,s=o.height;a*=y.DOM.DPR,s*=y.DOM.DPR,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=r({color:n({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale),wrapS:bt.CLAMP_TO_EDGE,wrapT:bt.CLAMP_TO_EDGE})}),this.interactionService.on(ct.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(r=(0,Ft.Z)(Bt().mark((function t(e,n,r){var i,o,a,s=this;return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.hooks.beforePickingEncode.call(),e.renderModels(),e.hooks.afterPickingEncode.call();var t=s.pickBox(e,n);r(t)}));case 3:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return r.apply(this,arguments)})},{key:"pickBox",value:function(t,e){var n=this,r=e.map((function(t){var e=t<0?0:t;return Math.floor(e*y.DOM.DPR/n.pickBufferScale)})),i=(0,D.Z)(r,4),o=i[0],a=i[1],s=i[2],u=i[3],c=this.rendererService,h=c.readPixels,p=c.getContainer,f=this.getContainerSize(p()),d=f.width,m=f.height;if(d*=y.DOM.DPR,m*=y.DOM.DPR,o>(d-1)*y.DOM.DPR/this.pickBufferScale||s<0||a>(m-1)*y.DOM.DPR/this.pickBufferScale||u<0)return[];for(var g=Math.min(d/this.pickBufferScale,s)-o,v=Math.min(m/this.pickBufferScale,u)-a,_=h({x:o,y:Math.floor(m/this.pickBufferScale-(u+1)),width:g,height:v,data:new Uint8Array(g*v*4),framebuffer:this.pickingFBO}),x=[],b={},w=0;w<_.length/4;w+=1){var S=_.slice(4*w,4*w+4),E=(0,y.decodePickingColor)(S);if(-1!==E&&!b[E]){var C=t.getSource().getFeatureById(E);x.push((0,l.Z)((0,l.Z)({},C),{},{pickedFeatureIdx:E})),b[E]=!0}}return x}},{key:"handleCursor",value:function(t,e){var n=t.getLayerConfig(),r=n.cursor,i=void 0===r?"":r;if(n.cursorEnabled){var o="GAODE2.x"===this.mapService.version?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),a=null==o?void 0:o.style.getPropertyValue("cursor");"unmousemove"===e&&""!==a?null==o||o.style.setProperty("cursor",""):"mousemove"===e&&(null==o||o.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/y.DOM.DPR,height:t.height/y.DOM.DPR}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:(n=(0,Ft.Z)(Bt().mark((function t(e){return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isPickingAllLayer()){t.next=2;break}return t.abrupt("return");case 2:return this.alreadyInPicking=!0,t.next=5,this.pickingLayers(e);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,e=this.getContainerSize(t()),n=e.width,r=e.height;n*=y.DOM.DPR,r*=y.DOM.DPR,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:(e=(0,Ft.Z)(Bt().mark((function t(e){var n,r,i,o=this;return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.rendererService,r=n.useFramebuffer,i=n.clear,this.resizePickingFBO(),r(this.pickingFBO,(function(){o.layerService.getRenderList().filter((function(t){return t.needPick(e.type)})).reverse().some((function(t){if(i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.pickedTileLayers.map((function(t){var n;return null===(n=t.tileLayer)||void 0===n?void 0:n.clearPick(e.type)})),t.tileLayer&&t.tileLayer.pickLayers)return t.tileLayer.pickLayers(e);t.hooks.beforePickingEncode.call(),t.masks.length>0&&t.masks.map((function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.render(),t.hooks.afterRender.call()})),t.renderModels(!0),t.hooks.afterPickingEncode.call();var n=o.pickFromPickingFBO(t,e);return o.layerService.pickedLayerId=n?+t.id:-1,n&&!t.getLayerConfig().enablePropagation}))}));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(t,e){var n,r,i,o;o=!0,null==(n=e)||null===(r=n.target)||void 0===r||null===(i=r.path)||void 0===i||i.map((function(t){var e;null!=t&&t.classList&&(null==t||null===(e=t.classList)||void 0===e||e.forEach((function(t){"l7-marker"!==t&&"l7-popup"!==t||(o=!1)})))})),o&&(this.handleCursor(t,e.type),t.emit(e.type,e))}},{key:"highlightPickedFeature",value:function(t,e){var n=(0,D.Z)(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeHighlight.call([r,i,o])}},{key:"selectFeature",value:function(t,e){var n=(0,D.Z)(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeSelect.call([r,i,o])}}]),t}(),Lt=(0,tt.Z)(Pt.prototype,"mapService",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),It=(0,tt.Z)(Pt.prototype,"rendererService",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kt=(0,tt.Z)(Pt.prototype,"configService",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ot=(0,tt.Z)(Pt.prototype,"interactionService",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rt=(0,tt.Z)(Pt.prototype,"layerService",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),At=Pt))||At),Kt=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,c.Z)(this,t),(0,g.Z)(this,"autoStart",void 0),(0,g.Z)(this,"startTime",0),(0,g.Z)(this,"oldTime",0),(0,g.Z)(this,"running",!1),(0,g.Z)(this,"elapsedTime",0),this.autoStart=e}return(0,h.Z)(t,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}]),t}();function Qt(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Jt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Jt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var $t,te,ee,ne,re,ie,oe,ae,se,ue,le,ce,he,pe,fe,de,me,ge,ye,ve,_e,xe,be,we,Se,Ee,Ce,Me,Te,Ae,Pe,Le,Ie,ke,Oe,Re,De,Ne,Fe,ze=(Zt=(0,a.b2)(),Vt=(0,a.f3)(u.IRendererService),Gt=(0,a.f3)(u.IMapService),Zt((Wt=function(t){(0,f.Z)(o,t);var e,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,m.Z)(n);if(r){var i=(0,m.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,d.Z)(this,t)});function o(){var t;(0,c.Z)(this,o);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,g.Z)((0,p.Z)(t),"pickedLayerId",-1),(0,g.Z)((0,p.Z)(t),"clock",new Kt),(0,g.Z)((0,p.Z)(t),"alreadyInRendering",!1),(0,g.Z)((0,p.Z)(t),"layers",[]),(0,g.Z)((0,p.Z)(t),"layerList",[]),(0,g.Z)((0,p.Z)(t),"layerRenderID",void 0),(0,g.Z)((0,p.Z)(t),"sceneInited",!1),(0,g.Z)((0,p.Z)(t),"animateInstanceCount",0),(0,g.Z)((0,p.Z)(t),"shaderPicking",!0),(0,g.Z)((0,p.Z)(t),"enableRender",!0),(0,$.Z)((0,p.Z)(t),"renderService",qt,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"mapService",Xt,(0,p.Z)(t)),(0,g.Z)((0,p.Z)(t),"reRender",(0,W.throttle)((function(){t.updateLayerRenderList(),t.renderLayers()}),32)),(0,g.Z)((0,p.Z)(t),"throttleRenderLayers",(0,W.throttle)((function(){t.renderLayers()}),16)),t}return(0,h.Z)(o,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList(),this.emit("layerChange",this.layers)}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach((function(t){t.inited||t.init()})),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find((function(e){return e.id===t}))}},{key:"getLayerByName",value:function(t){return this.layers.find((function(e){return e.name===t}))}},{key:"cleanRemove",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.layers.indexOf(t);n>-1&&this.layers.splice(n,1),e&&this.throttleRenderLayers()}},{key:"remove",value:function(t,e){if(e){var n=e.layerChildren.indexOf(t);n>-1&&e.layerChildren.splice(n,1)}else{var r=this.layers.indexOf(t);r>-1&&this.layers.splice(r,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers(),this.emit("layerChange",this.layers)}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:(e=(0,Ft.Z)(Bt().mark((function t(){var e,n,r;return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.alreadyInRendering&&this.enableRender){t.next=2;break}return t.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),e=Qt(this.layerList),t.prev=5,e.s();case 7:if((n=e.n()).done){t.next=21;break}if((r=n.value).hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map((function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.render(),t.hooks.afterRender.call()}))),!r.getLayerConfig().enableMultiPassRenderer){t.next=17;break}return t.next=15,r.renderMultiPass();case 15:t.next=18;break;case 17:r.render();case 18:r.hooks.afterRender.call();case 19:t.next=7;break;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(5),e.e(t.t0);case 26:return t.prev=26,e.f(),t.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return t.stop()}}),t,this,[[5,23,26,29]])}))),function(){return e.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter((function(t){return t.inited})).filter((function(t){return t.isVisible()})).sort((function(t,e){return t.zIndex-e.zIndex})).forEach((function(e){t.layerList.push(e)}))}},{key:"destroy",value:function(){this.layers.forEach((function(t){t.destroy()})),this.layers=[],this.layerList=[],this.renderLayers(),this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=(0,y.rgb2arr)(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=y.$window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){y.$window.cancelAnimationFrame(this.layerRenderID)}}]),o}(i.EventEmitter),qt=(0,tt.Z)(Wt.prototype,"renderService",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt=(0,tt.Z)(Wt.prototype,"mapService",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ht=Wt))||Ht),Be=n(3321),je=function(){function t(e){var n=this;(0,c.Z)(this,t),(0,g.Z)(this,"name",void 0),(0,g.Z)(this,"type",void 0),(0,g.Z)(this,"scale",void 0),(0,g.Z)(this,"descriptor",void 0),(0,g.Z)(this,"featureBufferLayout",[]),(0,g.Z)(this,"needRescale",!1),(0,g.Z)(this,"needRemapping",!1),(0,g.Z)(this,"needRegenerateVertices",!1),(0,g.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,g.Z)(this,"vertexAttribute",void 0),(0,g.Z)(this,"defaultCallback",(function(t){var e;return 0===t.length?(null===(e=n.scale)||void 0===e?void 0:e.defaultValues)||[]:t.map((function(t,e){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[e].func)(t)}))})),this.setProps(e)}return(0,h.Z)(t,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var e;if(null!==(e=this.scale)&&void 0!==e&&e.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,(0,z.Z)(t));if(!(0,W.isNil)(r))return[r]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),t}(),Ue=["modelType"],Ze=["buffer","update","name"],Ve=["buffer","update","name"],Ge=["buffer","update","name"],He=($t={},(0,g.Z)($t,bt.FLOAT,4),(0,g.Z)($t,bt.UNSIGNED_BYTE,1),(0,g.Z)($t,bt.UNSIGNED_SHORT,2),$t),We=(te=(0,a.b2)(),ee=(0,a.f3)(u.IRendererService),te((re=function(){function t(){(0,c.Z)(this,t),(0,g.Z)(this,"attributesAndIndices",void 0),(0,$.Z)(this,"rendererService",ie,this),(0,g.Z)(this,"attributes",[]),(0,g.Z)(this,"triangulation",void 0),(0,g.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,h.Z)(t,[{key:"registerStyleAttribute",value:function(t){var e=this.getLayerStyleAttribute(t.name||"");return e?e.setProps(t):(e=new je(t),this.attributes.push(e)),e}},{key:"updateStyleAttribute",value:function(t,e,n){var r=this.getLayerStyleAttribute(t);r||(r=this.registerStyleAttribute((0,l.Z)((0,l.Z)({},e),{},{name:t})));var i=e.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find((function(e){return e.name===t}))}},{key:"getLayerAttributeScale",value:function(t){var e,n=this.getLayerStyleAttribute(t),r=null==n||null===(e=n.scale)||void 0===e?void 0:e.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.attributes.find((function(e){return e.name===t}));if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,l=a.size,c=void 0===l?0:l,h=He[u.type||bt.FLOAT];if(s){var p=this.featureLayout,f=p.elements,d=p.sizePerElement,m=f.slice(n,r);if(!m.length)return;var g=m[0].offset,y=g*c*h,v=m.map((function(t,n){for(var r=t.featureIdx,i=t.vertices,o=t.normals,a=i.length/d,u=[],l=0;l<a;l++){var c=o?o.slice(3*l,3*l+3):[];u.push.apply(u,(0,z.Z)(s(e[r],r,i.slice(l*d,l*d+d),n,c)))}return u})).reduce((function(t,e){return t.push.apply(t,(0,z.Z)(e)),t}),[]);o.vertexAttribute.updateBuffer({data:v,offset:y}),null==i||i.emit("legend:".concat(t),{type:t,attr:o})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,e,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]};var i=this.attributes.map((function(t){return t.resetDescriptor(),t.descriptor})).filter((function(t){return t})),o=n.modelType,a=(0,Be.Z)(n,Ue),s=this.rendererService,u=s.createAttribute,c=s.createBuffer,h=s.createElements,p={};return new Promise((function(n,s){(0,y.executeWorkerTask)(o,(0,l.Z)({descriptors:r.getDescriptorsWithOutFunc(i),features:t,segmentNumber:e},a)).then((function(t){t.descriptors.forEach((function(t,e){if(t){var n=t.buffer,i=(t.update,t.name,(0,Be.Z)(t,Ze)),o=u((0,l.Z)({buffer:c(n)},i));p[t.name||""]=o,r.attributes[e].vertexAttribute=o}})),r.featureLayout=t.featureLayout;var e=h({data:t.indices,type:bt.UNSIGNED_INT,count:t.indices.length});r.attributesAndIndices={attributes:p,elements:e,count:null},n(r.attributesAndIndices)})).catch((function(t){console.warn(t),s(t)}))}))}},{key:"createAttributesAndIndices",value:function(t,e,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var i=this.attributes.map((function(t){return t.resetDescriptor(),t.descriptor})),o=0,a=0,s=[],u=3;t.forEach((function(t,e){var l=r.triangulation(t,n),c=l.indices,h=l.vertices,p=l.normals,f=l.size,d=l.indexes,m=l.count;"number"==typeof m&&(a+=m),c.forEach((function(t){s.push(t+o)})),u=f;var g=h.length/f;r.featureLayout.sizePerElement=u,r.featureLayout.elements.push({featureIdx:e,vertices:h,normals:p,offset:o}),o+=g;for(var y=function(n){var r=(null==p?void 0:p.slice(3*n,3*n+3))||[],o=h.slice(n*f,n*f+f),a=0;d&&void 0!==d[n]&&(a=d[n]),i.forEach((function(i,s){var u;i&&i.update&&(u=i.buffer.data).push.apply(u,(0,z.Z)(i.update(t,e,o,n,r,a)))}))},v=0;v<g;v++)y(v)}));var c=this.rendererService,h=c.createAttribute,p=c.createBuffer,f=c.createElements,d={};i.forEach((function(t,e){if(t){var n=t.buffer,i=(t.update,t.name,(0,Be.Z)(t,Ve)),o=h((0,l.Z)({buffer:p(n)},i));d[t.name||""]=o,r.attributes[e].vertexAttribute=o}}));var m=f({data:s,type:bt.UNSIGNED_INT,count:s.length});return this.attributesAndIndices={attributes:d,elements:m,count:a},this.attributesAndIndices}},{key:"createAttributes",value:function(t,e){var n=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var r=this.attributes.map((function(t){return t.resetDescriptor(),t.descriptor})),i=0,o=[],a=3;t.forEach((function(t,e){var s=n.triangulation(t),u=s.indices,l=s.vertices,c=s.normals,h=s.size,p=s.indexes;u.forEach((function(t){o.push(t+i)})),a=h;var f=l.length/h;n.featureLayout.sizePerElement=a,n.featureLayout.elements.push({featureIdx:e,vertices:l,normals:c,offset:i}),i+=f;for(var d=function(n){var i=(null==c?void 0:c.slice(3*n,3*n+3))||[],o=l.slice(n*h,n*h+h),a=0;p&&void 0!==p[n]&&(a=p[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,(0,z.Z)(r.update(t,e,o,n,i,a)))}))},m=0;m<f;m++)d(m)}));var s=this.rendererService,u=s.createAttribute,c=s.createBuffer,h={};return r.forEach((function(t,e){if(t){var r=t.buffer,i=(t.update,t.name,(0,Be.Z)(t,Ge)),o=u((0,l.Z)({buffer:c(r)},i));h[t.name||""]=o,n.attributes[e].vertexAttribute=o}})),{attributes:h}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach((function(t){t.vertexAttribute&&t.vertexAttribute.destroy()})),null===(t=this.attributesAndIndices)||void 0===t||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map((function(t){return{buffer:t.buffer,name:t.name,size:t.size}}))}}]),t}(),ie=(0,tt.Z)(re.prototype,"rendererService",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ne=re))||ne),qe=n(5048),Xe=n(1154),Ye=n.n(Xe);var Ke,Qe=(oe=(0,a.b2)(),ae=(0,a.f3)(u.SceneID),se=(0,a.f3)(u.IIconService),ue=(0,a.f3)(u.IFontService),le=(0,a.f3)(u.IControlService),ce=(0,a.f3)(u.IGlobalConfigService),he=(0,a.f3)(u.IMapService),pe=(0,a.f3)(u.ICoordinateSystemService),fe=(0,a.f3)(u.IRendererService),de=(0,a.f3)(u.ILayerService),me=(0,a.f3)(u.ICameraService),ge=(0,a.f3)(u.IInteractionService),ye=(0,a.f3)(u.IPickingService),ve=(0,a.f3)(u.IShaderModuleService),_e=(0,a.f3)(u.IMarkerService),xe=(0,a.f3)(u.IPopupService),oe((we=function(t){(0,f.Z)(o,t);var e,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,m.Z)(n);if(r){var i=(0,m.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,d.Z)(this,t)});function o(){var t;return(0,c.Z)(this,o),t=i.call(this),(0,g.Z)((0,p.Z)(t),"destroyed",!1),(0,g.Z)((0,p.Z)(t),"loaded",!1),(0,$.Z)((0,p.Z)(t),"id",Se,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"iconService",Ee,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"fontService",Ce,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"controlService",Me,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"configService",Te,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"map",Ae,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"coordinateSystemService",Pe,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"rendererService",Le,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"layerService",Ie,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"cameraService",ke,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"interactionService",Oe,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"pickingService",Re,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"shaderModuleService",De,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"markerService",Ne,(0,p.Z)(t)),(0,$.Z)((0,p.Z)(t),"popupService",Fe,(0,p.Z)(t)),(0,g.Z)((0,p.Z)(t),"inited",!1),(0,g.Z)((0,p.Z)(t),"initPromise",void 0),(0,g.Z)((0,p.Z)(t),"rendering",!1),(0,g.Z)((0,p.Z)(t),"$container",void 0),(0,g.Z)((0,p.Z)(t),"canvas",void 0),(0,g.Z)((0,p.Z)(t),"markerContainer",void 0),(0,g.Z)((0,p.Z)(t),"hooks",void 0),(0,g.Z)((0,p.Z)(t),"handleWindowResized",(function(){t.emit("resize"),t.$container&&(t.initContainer(),y.DOM.triggerResize(),t.coordinateSystemService.needRefresh=!0,t.render())})),(0,g.Z)((0,p.Z)(t),"handleMapCameraChanged",(function(e){t.cameraService.update(e),t.render()})),t.hooks={init:new qe.sX},t}return(0,h.Z)(o,[{key:"init",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return e.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ft.Z)(Bt().mark((function t(){return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){e.map.onCameraChanged((function(n){e.cameraService.init(),e.cameraService.update(n),t()})),e.map.init()}));case 2:e.map.onCameraChanged(e.handleMapCameraChanged),e.map.addMarkerContainer(),e.markerService.addMarkers(),e.markerService.addMarkerLayers(),e.popupService.initPopup(),e.interactionService.init(),e.interactionService.on(ct.Drag,e.addSceneEvent.bind(e));case 9:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",(0,Ft.Z)(Bt().mark((function n(){var r,i;return Bt().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.map.getOverlayContainer(),e.$container=r||Ut(e.configService.getSceneConfig(e.id).id||""),!e.$container){n.next=12;break}return e.canvas=y.DOM.create("canvas","",e.$container),e.setCanvas(),n.next=7,e.rendererService.init(e.canvas,e.configService.getSceneConfig(e.id),t.gl);case 7:e.initContainer(),Ye()(e.$container,e.handleWindowResized),y.$window.matchMedia&&(null===(i=y.$window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===i||i.addListener(e.handleWindowResized)),n.next=13;break;case 12:console.error("容器 id 不存在");case 13:e.pickingService.init(e.id);case 14:case"end":return n.stop()}}),n)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return e.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ft.Z)(Bt().mark((function t(){return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){e.map.onCameraChanged((function(n){e.cameraService.init(),e.cameraService.update(n),"GAODE2.x"!==e.map.version&&t()})),e.map.initMiniMap()}));case 2:e.map.onCameraChanged(e.handleMapCameraChanged),e.interactionService.init(),e.interactionService.on(ct.Drag,e.addSceneEvent.bind(e));case 5:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",(0,Ft.Z)(Bt().mark((function n(){var r;return Bt().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.canvas,e.$container=r||null,!e.$container){n.next=7;break}return n.next=5,e.rendererService.init(t.canvas,e.configService.getSceneConfig(e.id),void 0);case 5:n.next=8;break;case 7:console.error("容器 id 不存在");case 8:e.pickingService.init(e.id);case 9:case"end":return n.stop()}}),n)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:(e=(0,Ft.Z)(Bt().mark((function t(){return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.rendering&&!this.destroyed){t.next=2;break}return t.abrupt("return");case 2:if(this.rendering=!0,this.inited){t.next=12;break}return t.next=6,this.initPromise;case 6:this.destroyed&&this.destroy(),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 12:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 15:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"addFontFace",value:function(t,e){this.fontService.addFontFace(t,e)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(t){var e,n=null===(e=this.$container)||void 0===e?void 0:e.getElementsByTagName("canvas")[0];return this.render(),"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;null!==t&&(this.markerContainer=y.DOM.create("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t,e,n,r=this;this.inited?(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout((function(){var t;null===(t=r.$container)||void 0===t||t.removeChild(r.canvas),r.canvas=null,r.rendererService.destroy()})),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),null===(t=this.$container)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Xe.unbind)(this.$container,this.handleWindowResized),y.$window.matchMedia&&(null===(n=y.$window.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===n||n.removeListener(this.handleWindowResized))):this.destroyed=!0}},{key:"initContainer",value:function(){var t,e,n=y.DOM.DPR,r=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var t,e,n=y.DOM.DPR,r=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),o}(i.EventEmitter),Se=(0,tt.Z)(we.prototype,"id",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ee=(0,tt.Z)(we.prototype,"iconService",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ce=(0,tt.Z)(we.prototype,"fontService",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Me=(0,tt.Z)(we.prototype,"controlService",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te=(0,tt.Z)(we.prototype,"configService",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ae=(0,tt.Z)(we.prototype,"map",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pe=(0,tt.Z)(we.prototype,"coordinateSystemService",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Le=(0,tt.Z)(we.prototype,"rendererService",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ie=(0,tt.Z)(we.prototype,"layerService",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ke=(0,tt.Z)(we.prototype,"cameraService",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oe=(0,tt.Z)(we.prototype,"interactionService",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Re=(0,tt.Z)(we.prototype,"pickingService",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),De=(0,tt.Z)(we.prototype,"shaderModuleService",[ve],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ne=(0,tt.Z)(we.prototype,"markerService",[_e],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fe=(0,tt.Z)(we.prototype,"popupService",[xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),be=we))||be),Je=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function $e(t){var e={};return{content:t=t.replace(Je,(function(t,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(t,e){return t.push(Number(e.trim())),t}),[]):new Array(function(t){var e=0;switch(t){case"vec2":case"ivec2":e=2;break;case"vec3":case"ivec3":e=3;break;case"vec4":case"ivec4":case"mat2":e=4;break;case"mat3":e=9;break;case"mat4":e=16}return e}(n)).fill(0)}return e[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:e}}var tn,en,nn="#define PI 3.14159265359",rn=/precision\s+(high|low|medium)p\s+float/,on=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,an=(0,a.b2)()(Ke=function(){function t(){(0,c.Z)(this,t),(0,g.Z)(this,"moduleCache",{}),(0,g.Z)(this,"rawContentCache",{})}return(0,h.Z)(t,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:nn,fs:nn}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n\n#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0           // amap\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0\n\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\n\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\n\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\n\n// uniform mat4 u_Mvp;\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01\n// reverse Y\nvec3 reverse_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\n    return vector * vec3(1.0, -1.0, 1.0);\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return vector;\n  }\n  return vector;\n}\n\nvec4 project_mvt_offset_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return project_offset(vec4(0.0, 0.0, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  return position;\n}\n\nvec4 project_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(vec4(X, Y, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return vec4(\n      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // return vec4(\n    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), \n    //   project_scale(position.z), \n    //   position.w);\n\n     return vec4(\n      position.xy, \n      project_scale(position.z), \n      position.w);\n  }\n  return position;\n\n  // TODO: 瓦片坐标系 & 常规世界坐标系\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\nfloat project_pixel_allmap(float pixel) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    return pixel * pow(2.0, u_Zoom);\n  }\n  return pixel;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom);\n  }\n\n  // amap2 zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n\n  // amap zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return pixel * pow(0.5, u_Zoom);\n  }\n  \n  // amap zoom < 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return pixel * pow(2.0, (20.0 - u_Zoom));\n  }\n  return pixel * 2.0;\n}\n\n// 在不论什么底图下需要统一处理的时候使用\nfloat project_float_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // mapbox P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n  return pixel;\n}\n\nfloat project_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n  return pixel;\n}\nvec2 project_pixel(vec2 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n  return pixel * -1.;\n}\nvec3 project_pixel(vec3 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n  return pixel * -1.;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n     pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\n\nbool isEqual( float a,  float b) {\n    return  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {\n//   vec3 lightDir = normalize(light.position - fragPos);\n//   // diffuse shading\n//   float diff = max(dot(normal, lightDir), 0.0);\n//   // specular shading\n//   vec3 reflectDir = reflect(-lightDir, normal);\n//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);\n//   // attenuation\n//   float distance = length(light.position - fragPos);\n//   float attenuation = 1.0 / (light.constant + light.linear * distance +\n//           light.quadratic * (distance * distance));\n\n//   vec3 ambient = light.ambient * u_Ambient;\n//   vec3 diffuse = light.diffuse * diff * u_Diffuse;\n//   vec3 specular = light.specular * spec * u_Specular;\n\n//   float spotEffect = dot(normalize(light.direction), -lightDir);\n//   float spotCosCutoff = cos(light.angle / 180.0 * PI);\n//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);\n//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);\n//   if (spotEffect > spotCosCutoff) {\n//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);\n//   } else {\n//     spotEffect = 0.0;\n//   }\n\n//   return ambient + attenuation * (spotEffect * diffuse + specular);\n// }\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {\n  //   if (i >= u_NumOfSpotLights) {\n  //     break;\n  //   }\n  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);\n  // }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\n\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec3 u_CurrentSelectedId : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\nuniform float u_shaderPick;\nuniform float u_EnableSelect: 0.0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\n\n// 判断当前点是否已经被 select 选中\nbool isVertexSelected(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {\n  //   // 选中态\n  //   v_PickingResult.a = SELECT;\n  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {\n  //   // 高亮态\n  //   v_PickingResult.a = HIGHLIGHT;\n  // } else {\n  //   v_PickingResult.a = NORMAL;\n  // }\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_shaderPick;\n\nuniform float u_activeMix: 0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  // float selected = v_PickingResult.a;\n  bool selected = bool(v_PickingResult.a);\n\n  // if (selected == SELECT) {\n  if (selected) {\n  //   // 点击选中状态\n  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;\n  //   return selectColor;\n  // } else if (selected == HIGHLIGHT) {\n  //   // hover 高亮状态\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n"}),this.registerModule("styleMapping",{vs:"attribute float a_vertexId;\n\nuniform mat4 u_cellTypeLayout;      // 描述数据纹理 cell 结构的矩阵\nuniform sampler2D u_dataTexture;    // 数据纹理\n\nbool hasOpacity() { // 判断 cell 中是否存在 opacity 的数据\n  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasStrokeOpacity() { // 判断 cell 中是否存在 strokeOpacity 的数据\n  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasStrokeWidth() { // 判断 cell 中是否存在 strokeWidth 的数据\n  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasStroke() { // 判断 cell 中是否存在 stroke 的数据\n  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasOffsets() { // 判断 cell 中是否存在 offsets 的数据\n  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasThetaOffset() { // 判断 cell 中是否存在 thetaOffset 的数据\n  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\n// 根据坐标位置先是计算 uv ，然后根据 uv 从数据纹理中取值\nfloat pos2value(vec2 pos, float columnWidth, float rowHeight) {\n  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;\n  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);\n  return texture2D(u_dataTexture, vec2(u, v)).r;\n}\n\n/*\n  currentRow 当前行\n  currentColumn 当前列\n  columnCount 有多少列\n  nextStep 需要计算当前 cell 后的第几个 cell （当前 cell 则 nextStep = 0）\n*/\nvec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {\n  float nextColumn = currentColumn;\n  float nextRow = currentRow;\n  if(currentColumn + nextStep <= columnCount){\n    nextColumn = currentColumn + nextStep;\n  } else {\n    nextColumn = mod(currentColumn + nextStep, columnCount); // 不会出现跨两行\n    nextRow = currentRow + 1.0;\n  }\n  return vec2(nextColumn, nextRow);\n}\n\n// 计算当前单个 cell 的大小\nfloat calCellCount() { \n  //   u_cellTypeLayout\n  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - 几行几列\n  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 表示有数据映射、0.0 表示没有\n  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset\n  //   0.0, 0.0, 0.0, 0.0\n  \n  return  u_cellTypeLayout[1][0] +        // opacity\n          u_cellTypeLayout[1][1] +        // strokeOpacity\n          u_cellTypeLayout[1][2] +        // strokeWidth\n          u_cellTypeLayout[1][3] * 4.0 +  // stroke\n          u_cellTypeLayout[2][0] * 2.0 +  // offsets\n          u_cellTypeLayout[2][1];         // thetaOffset\n}",fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:"\n// 计算 thetaOffset 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasThetaOffset()) { // 数据纹理中不存在 thetaOffset 的时候取默认值（用户在 style 中传入的是常量）\n    return vec2(u_thetaOffset, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureThetaOffset, textureOffset + 1.0);\n  }\n}\n",fs:""}),this.registerModule("styleMappingCalOpacity",{vs:"\n// 计算 opacity 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasOpacity()) { // 数据纹理中不存在 opacity 的时候取默认值（用户在 style 中传入的是常量）\n    return vec2(u_opacity, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureOpacity, textureOffset + 1.0);\n  }\n}\n",fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:"\n// 计算 strokeOpaicty 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasStrokeOpacity()) {\n    return vec2(u_stroke_opacity, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureStrokeOpacity, textureOffset + 1.0);\n  }\n}\n",fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:"\n// 计算 strokeWidth 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasStrokeWidth()) {\n    return vec2(u_stroke_width, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureStrokeWidth, textureOffset + 1.0);\n  }\n}\n",fs:""})}},{key:"registerModule",value:function(t,e){if(!this.rawContentCache[t]){var n=e.vs,r=e.fs,i=e.uniforms,o=$e(n),a=o.content,s=o.uniforms,u=$e(r),c=u.content,h=u.uniforms;this.rawContentCache[t]={fs:c,uniforms:(0,l.Z)((0,l.Z)((0,l.Z)({},s),h),i),vs:a}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var e=this;if(this.moduleCache[t])return this.moduleCache[t];var n=this.rawContentCache[t].vs,r=this.rawContentCache[t].fs,i=this.processModule(n,[],"vs"),o=i.content,a=i.includeList,s=this.processModule(r,[],"fs"),u=s.content,c=s.includeList,h=u,p=(0,W.uniq)(a.concat(c).concat(t)).reduce((function(t,n){return(0,l.Z)((0,l.Z)({},t),e.rawContentCache[n].uniforms)}),{});return rn.test(u)||(h="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"+u),this.moduleCache[t]={fs:h.trim(),uniforms:p,vs:o.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,e,n){var r=this;return{content:t.replace(on,(function(t,i){var o=i.split(" ")[0].replace(/"/g,"");if(e.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return e.push(o),r.processModule(a,e,n).content})),includeList:e}}}]),t}())||Ke,sn=n(3080);!function(t){t.Normal="normal",t.PostProcessing="post-processing"}(tn||(tn={}));var un,ln=(0,a.b2)()(en=function(){function t(){(0,c.Z)(this,t),(0,g.Z)(this,"shaderModuleService",void 0),(0,g.Z)(this,"rendererService",void 0),(0,g.Z)(this,"cameraService",void 0),(0,g.Z)(this,"mapService",void 0),(0,g.Z)(this,"interactionService",void 0),(0,g.Z)(this,"layerService",void 0),(0,g.Z)(this,"config",void 0)}return(0,h.Z)(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return tn.Normal}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(u.IRendererService),this.cameraService=t.getContainer().get(u.ICameraService),this.mapService=t.getContainer().get(u.IMapService),this.interactionService=t.getContainer().get(u.IInteractionService),this.layerService=t.getContainer().get(u.ILayerService),this.shaderModuleService=t.getContainer().get(u.IShaderModuleService)}},{key:"render",value:function(t){}}]),t}())||en;var cn,hn,pn,fn,dn,mn=(0,a.b2)()(un=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,e){(0,sn.Z)((0,m.Z)(i.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),i}(ln))||un;function gn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return yn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function yn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var vn,_n=(cn=(0,a.b2)(),hn=(0,a.f3)(u.IPostProcessor),cn((fn=function(){function t(){(0,c.Z)(this,t),(0,g.Z)(this,"passes",[]),(0,$.Z)(this,"postProcessor",dn,this),(0,g.Z)(this,"layer",void 0),(0,g.Z)(this,"renderFlag",void 0),(0,g.Z)(this,"width",0),(0,g.Z)(this,"height",0)}var e;return(0,h.Z)(t,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(e=(0,Ft.Z)(Bt().mark((function t(){var e,n,r;return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=gn(this.passes),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=9;break}return r=n.value,t.next=7,r.render(this.layer);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.e(t.t0);case 14:return t.prev=14,e.f(),t.finish(14);case 17:return t.next=19,this.postProcessor.render(this.layer);case 19:case"end":return t.stop()}}),t,this,[[1,11,14,17]])}))),function(){return e.apply(this,arguments)})},{key:"resize",value:function(t,e){this.width===t&&this.height===e||(this.postProcessor.resize(t,e),this.width=t,this.height=e)}},{key:"add",value:function(t,e){t.getType()===tn.PostProcessing?this.postProcessor.add(t,this.layer,e):(t.init(this.layer,e),this.passes.push(t))}},{key:"insert",value:function(t,e,n){t.init(this.layer,e),this.passes.splice(n,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),t}(),dn=(0,tt.Z)(fn.prototype,"postProcessor",[hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pn=fn))||pn);var xn,bn,wn,Sn,En,Cn,Mn=(0,a.b2)()(vn=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){var t;(0,c.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,g.Z)((0,p.Z)(t),"pickingFBO",void 0),(0,g.Z)((0,p.Z)(t),"layer",void 0),(0,g.Z)((0,p.Z)(t),"width",0),(0,g.Z)((0,p.Z)(t),"height",0),(0,g.Z)((0,p.Z)(t),"alreadyInRendering",!1),(0,g.Z)((0,p.Z)(t),"pickFromPickingFBO",(function(e){var n=e.x,r=e.y,i=e.lngLat,o=e.type;if(t.layer.isVisible()&&t.layer.needPick(o)){var a,s=t.rendererService,u=s.getViewportSize,c=s.readPixels,h=s.useFramebuffer,p=u(),f=p.width,d=p.height,m=t.layer.getLayerConfig(),g=m.enableHighlight,v=m.enableSelect,_=n*y.DOM.DPR,x=r*y.DOM.DPR;_>f||_<0||x>d||x<0||h(t.pickingFBO,(function(){var e;if(0!==(a=c({x:Math.round(_),y:Math.round(d-(r+1)*y.DOM.DPR),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO}))[0]||0!==a[1]||0!==a[2]){var s=(0,y.decodePickingColor)(a),u=t.layer.getSource().getFeatureById(s),h={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(t.layer.setCurrentPickId(s),t.triggerHoverOnLayer(h))}else{var p={x:n,y:r,lngLat:i,type:null===t.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};t.triggerHoverOnLayer((0,l.Z)((0,l.Z)({},p),{},{type:"unpick"})),t.triggerHoverOnLayer(p),t.layer.setCurrentPickId(null)}g&&t.highlightPickedFeature(a),v&&"click"===o&&(null===(e=a)||void 0===e?void 0:e.toString())!==[0,0,0,0].toString()&&t.selectFeature(a)}))}})),t}return(0,h.Z)(i,[{key:"getType",value:function(){return tn.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,e){(0,sn.Z)((0,m.Z)(i.prototype),"init",this).call(this,t,e),this.layer=t;var n=this.rendererService,r=n.createTexture2D,o=n.createFramebuffer,a=(0,n.getViewportSize)(),s=a.width,u=a.height;this.pickingFBO=o({color:r({width:s,height:u,wrapS:bt.CLAMP_TO_EDGE,wrapT:bt.CLAMP_TO_EDGE})}),this.interactionService.on(ct.Hover,this.pickFromPickingFBO),this.interactionService.on(ct.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ct.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var e=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=e.layer.multiPassRenderer.getRenderFlag();e.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),e.layer.multiPassRenderer.setRenderFlag(n),e.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var e=(0,D.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var e=(0,D.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var e=t.featureId,n=(0,y.encodePickingColor)(e);this.selectFeature(new Uint8Array(n))}},{key:"highlightFeatureHandle",value:function(t){var e=t.featureId,n=(0,y.encodePickingColor)(e);this.highlightPickedFeature(new Uint8Array(n))}}]),i}(ln))||vn,Tn=(xn=(0,a.b2)(),bn=(0,a.f3)(u.IShaderModuleService),xn((Sn=function(){function t(){(0,c.Z)(this,t),(0,$.Z)(this,"shaderModuleService",En,this),(0,g.Z)(this,"rendererService",void 0),(0,g.Z)(this,"config",void 0),(0,g.Z)(this,"quad","attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}"),(0,g.Z)(this,"enabled",!0),(0,g.Z)(this,"renderToScreen",!1),(0,g.Z)(this,"model",void 0),(0,g.Z)(this,"name",void 0),(0,g.Z)(this,"optionsToUpdate",{})}return(0,h.Z)(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return tn.PostProcessing}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(u.IRendererService),this.shaderModuleService=t.getContainer().get(u.IShaderModuleService);var n=this.rendererService,r=n.createAttribute,i=n.createBuffer,o=n.createModel,a=this.setupShaders(),s=a.vs,c=a.fs,h=a.uniforms;this.model=o({vs:s,fs:c,attributes:{a_Position:r({buffer:i({data:[-4,-4,4,-4,0,4],type:bt.FLOAT}),size:2})},uniforms:(0,l.Z)((0,l.Z)({u_Texture:null},h),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(t,e){var n=this,r=t.multiPassRenderer.getPostProcessor(),i=this.rendererService,o=i.useFramebuffer,a=i.getViewportSize,s=i.clear,u=a(),c=u.width,h=u.height;o(this.renderToScreen?null:r.getWriteFBO(),(function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var t=(0,l.Z)({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[c,h]},n.convertOptionsToUniforms(n.optionsToUpdate));e&&(t.u_BloomFinal=1,t.u_Texture2=e),n.model.draw({uniforms:t})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,l.Z)((0,l.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var e={};return Object.keys(t).forEach((function(n){(0,W.isNil)(t[n])||(e["u_".concat((0,W.upperFirst)((0,W.camelCase)(n)))]=t[n])})),e}}]),t}(),En=(0,tt.Z)(Sn.prototype,"shaderModuleService",[bn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wn=Sn))||wn);var An,Pn=(0,a.b2)()(Cn=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,l.Z)((0,l.Z)({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return(0,W.isNil)(t.bloomRadius)||(e.u_radius=t.bloomRadius),(0,W.isNil)(t.bloomIntensity)||(e.u_intensity=t.bloomIntensity),(0,W.isNil)(t.bloomBaseRadio)||(e.u_baseRadio=t.bloomBaseRadio),e}}]),i}(Tn))||Cn;var Ln,In=(0,a.b2)()(An=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,l.Z)((0,l.Z)({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return(0,W.isNil)(t.blurRadius)||(e.u_BlurDir=[t.blurRadius,0]),e}}]),i}(Tn))||An;var kn,On=(0,a.b2)()(Ln=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,l.Z)((0,l.Z)({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return(0,W.isNil)(t.blurRadius)||(e.u_BlurDir=[0,t.blurRadius]),e}}]),i}(Tn))||Ln;var Rn,Dn=(0,a.b2)()(kn=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var t=this.shaderModuleService.getModule("colorhalftone-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,l.Z)((0,l.Z)({},r),{},{u_ViewportSize:[o,a]})}}}]),i}(Tn))||kn;var Nn,Fn=(0,a.b2)()(Rn=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}"}),this.shaderModuleService.getModule("copy-pass")}}]),i}(Tn))||Rn;var zn,Bn=(0,a.b2)()(Nn=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,l.Z)((0,l.Z)({},r),{},{u_ViewportSize:[o,a]})}}}]),i}(Tn))||Nn;var jn,Un=(0,a.b2)()(zn=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var t=this.shaderModuleService.getModule("ink-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,l.Z)((0,l.Z)({},r),{},{u_ViewportSize:[o,a]})}}}]),i}(Tn))||zn;var Zn,Vn=(0,a.b2)()(jn=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),i}(Tn))||jn;var Gn,Hn,Wn,qn,Xn,Yn,Kn,Qn=(0,a.b2)()(Zn=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),i}(Tn))||Zn,Jn=(Gn=(0,a.b2)(),Hn=(0,a.f3)(u.IRendererService),Wn=(0,a.zY)(),Gn((Xn=function(){function t(){(0,c.Z)(this,t),(0,$.Z)(this,"rendererService",Yn,this),(0,g.Z)(this,"passes",[]),(0,g.Z)(this,"readFBO",void 0),(0,g.Z)(this,"writeFBO",void 0)}var e,n;return(0,h.Z)(t,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,e=t.getViewportSize,n=t.createTexture2D,r=e();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,e=this.rendererService.useFramebuffer;return new Promise((function(n){e(t.readFBO,(0,Ft.Z)(Bt().mark((function e(){return Bt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(t.getCurrentFBOTex());case 1:case"end":return e.stop()}}),e)}))))}))}},{key:"renderBloomPass",value:(n=(0,Ft.Z)(Bt().mark((function t(e,n){var r,i;return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getReadFBOTex();case 2:r=t.sent,i=0;case 4:if(!(i<4)){t.next=11;break}return t.next=7,n.render(e,r);case 7:this.swap(),i++,t.next=4;break;case 11:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"render",value:(e=(0,Ft.Z)(Bt().mark((function t(e){var n,r;return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<this.passes.length)){t.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){t.next=9;break}return t.next=7,this.renderBloomPass(e,r);case 7:t.next=12;break;case 9:return t.next=11,r.render(e);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,t.next=1;break;case 15:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"resize",value:function(t,e){this.readFBO.resize({width:t,height:e}),this.writeFBO.resize({width:t,height:e})}},{key:"add",value:function(t,e,n){t.init(e,n),this.passes.push(t)}},{key:"insert",value:function(t,e,n,r){t.init(n,r),this.passes.splice(e,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find((function(e){return e.getName()===t}))}},{key:"init",value:function(){var t=this.rendererService,e=t.createFramebuffer,n=t.createTexture2D;this.readFBO=e({color:n({width:1,height:1,wrapS:bt.CLAMP_TO_EDGE,wrapT:bt.CLAMP_TO_EDGE})}),this.writeFBO=e({color:n({width:1,height:1,wrapS:bt.CLAMP_TO_EDGE,wrapT:bt.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),t}(),Yn=(0,tt.Z)(Xn.prototype,"rendererService",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,tt.Z)(Xn.prototype,"init",[Wn],Object.getOwnPropertyDescriptor(Xn.prototype,"init"),Xn.prototype),qn=Xn))||qn);var $n,tr,er,nr,rr,ir=(0,a.b2)()(Kn=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){return(0,c.Z)(this,i),r.apply(this,arguments)}return(0,h.Z)(i,[{key:"getType",value:function(){return tn.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,e){(0,sn.Z)((0,m.Z)(i.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(t){var e=this.rendererService,n=e.useFramebuffer,r=e.clear,i=t.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach((function(e){e.draw({uniforms:t.layerModel.getUninforms()})})),t.multiPassRenderer.setRenderFlag(!0)}))}}]),i}(ln))||Kn;var or="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}";function ar(t,e){for(var n=0,r=1/e,i=t;i>0;)n+=r*(i%e),i=Math.floor(i/e),r/=e;return n}var sr=1,ur=($n=(0,a.b2)(),tr=(0,a.f3)(u.IShaderModuleService),$n((nr=function(t){(0,f.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,m.Z)(e);if(n){var i=(0,m.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,d.Z)(this,t)});function i(){var t;(0,c.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,$.Z)((0,p.Z)(t),"shaderModuleService",rr,(0,p.Z)(t)),(0,g.Z)((0,p.Z)(t),"haltonSequence",[]),(0,g.Z)((0,p.Z)(t),"accumulatingId",0),(0,g.Z)((0,p.Z)(t),"frame",0),(0,g.Z)((0,p.Z)(t),"timer",void 0),(0,g.Z)((0,p.Z)(t),"sampleRenderTarget",void 0),(0,g.Z)((0,p.Z)(t),"prevRenderTarget",void 0),(0,g.Z)((0,p.Z)(t),"outputRenderTarget",void 0),(0,g.Z)((0,p.Z)(t),"copyRenderTarget",void 0),(0,g.Z)((0,p.Z)(t),"blendModel",void 0),(0,g.Z)((0,p.Z)(t),"outputModel",void 0),(0,g.Z)((0,p.Z)(t),"copyModel",void 0),t}return(0,h.Z)(i,[{key:"getType",value:function(){return tn.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,e){(0,sn.Z)((0,m.Z)(i.prototype),"init",this).call(this,t,e);var n=this.rendererService,r=n.createFramebuffer,o=n.createTexture2D;this.sampleRenderTarget=r({color:o({width:1,height:1,wrapS:bt.CLAMP_TO_EDGE,wrapT:bt.CLAMP_TO_EDGE})}),this.prevRenderTarget=r({color:o({width:1,height:1,wrapS:bt.CLAMP_TO_EDGE,wrapT:bt.CLAMP_TO_EDGE})}),this.outputRenderTarget=r({color:o({width:1,height:1,wrapS:bt.CLAMP_TO_EDGE,wrapT:bt.CLAMP_TO_EDGE})}),this.copyRenderTarget=r({color:o({width:1,height:1,wrapS:bt.CLAMP_TO_EDGE,wrapT:bt.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([ar(a,2),ar(a,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\n\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  vec4 texel1 = texture2D(u_Diffuse1, v_UV);\n  vec4 texel2 = texture2D(u_Diffuse2, v_UV);\n  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}\n"),this.outputModel=this.createTriangleModel("copy-pass",or,{blend:{enable:!0,func:{srcRGB:bt.ONE,dstRGB:bt.ONE_MINUS_SRC_ALPHA,srcAlpha:bt.ONE,dstAlpha:bt.ONE_MINUS_SRC_ALPHA},equation:{rgb:bt.FUNC_ADD,alpha:bt.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",or)}},{key:"render",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var l=t.multiPassRenderer.getPostProcessor().getReadFBO();o(l,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)}));var c=function n(r){e.accumulatingId&&r===e.accumulatingId&&(e.isFinished()||(e.doRender(t),y.$window.requestAnimationFrame((function(){n(r)}))))};this.accumulatingId=sr++,this.timer=y.$window.setTimeout((function(){c(e.accumulatingId)}),50)}},{key:"doRender",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,l=t.getLayerConfig().jitterScale,c=void 0===l?1:l,h=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*h[0]-1)/s*c,(2*h[1]-1)/u*c),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.sampleRenderTarget}),t.render()})),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var p=t.getLayerConfig();o(this.outputRenderTarget,(function(){e.blendModel.draw({uniforms:{u_opacity:p.opacity||1,u_MixRatio:0===e.frame?1:.9,u_Diffuse1:e.sampleRenderTarget,u_Diffuse2:0===e.frame?t.multiPassRenderer.getPostProcessor().getReadFBO():e.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){e.outputModel.draw({uniforms:{u_Texture:e.outputRenderTarget}})})),o(t.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){e.copyModel.draw({uniforms:{u_Texture:e.copyRenderTarget}})})),t.multiPassRenderer.getPostProcessor().render(t));var f=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=f,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,y.$window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,e,n){this.shaderModuleService.registerModule(t,{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:e});var r=this.shaderModuleService.getModule(t),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,c=s.createBuffer;return(0,s.createModel)((0,l.Z)({vs:i,fs:o,attributes:{a_Position:u({buffer:c({data:[-4,-4,4,-4,0,4],type:bt.FLOAT}),size:2})},uniforms:(0,l.Z)({},a),depth:{enable:!1},count:3},n))}}]),i}(ln),rr=(0,tt.Z)(nr.prototype,"shaderModuleService",[tr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),er=nr))||er),lr=new a.W2;lr.bind(u.IGlobalConfigService).to(J).inSingletonScope(),(0,a.GW)((0,a.b2)(),i.EventEmitter),lr.bind(u.IEventEmitter).to(i.EventEmitter);var cr=(0,s.Z)(lr,!1),hr=function(t){var e=cr.lazyInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}},pr=function(t){var e=cr.lazyMultiInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}};const fr=lr;var dr=0;function mr(){var t=new a.W2;return t.parent=lr,t.bind(u.SceneID).toConstantValue("".concat(dr++)),t.bind(u.IShaderModuleService).to(an).inSingletonScope(),t.bind(u.ILayerService).to(ze).inSingletonScope(),t.bind(u.ISceneService).to(Qe).inSingletonScope(),t.bind(u.ICameraService).to(F).inSingletonScope(),t.bind(u.ICoordinateSystemService).to(vt).inSingletonScope(),t.bind(u.IInteractionService).to(Nt).inSingletonScope(),t.bind(u.IPickingService).to(Yt).inSingletonScope(),t.bind(u.IControlService).to(V).inSingletonScope(),t.bind(u.IMarkerService).to(G).inSingletonScope(),t.bind(u.IIconService).to(R).inSingletonScope(),t.bind(u.IFontService).to(L).inSingletonScope(),t.bind(u.IPopupService).to(H).inSingletonScope(),t.bind(u.INormalPass).to(mn).whenTargetNamed("clear"),t.bind(u.INormalPass).to(Mn).whenTargetNamed("pixelPicking"),t.bind(u.INormalPass).to(ir).whenTargetNamed("render"),t.bind(u.INormalPass).to(ur).whenTargetNamed("taa"),t.bind(u.IFactoryNormalPass).toFactory((function(t){return function(e){return t.container.getNamed(u.INormalPass,e)}})),t.bind(u.IPostProcessingPass).to(Fn).whenTargetNamed("copy"),t.bind(u.IPostProcessingPass).to(Pn).whenTargetNamed("bloom"),t.bind(u.IPostProcessingPass).to(In).whenTargetNamed("blurH"),t.bind(u.IPostProcessingPass).to(On).whenTargetNamed("blurV"),t.bind(u.IPostProcessingPass).to(Vn).whenTargetNamed("noise"),t.bind(u.IPostProcessingPass).to(Qn).whenTargetNamed("sepia"),t.bind(u.IPostProcessingPass).to(Dn).whenTargetNamed("colorHalftone"),t.bind(u.IPostProcessingPass).to(Bn).whenTargetNamed("hexagonalPixelate"),t.bind(u.IPostProcessingPass).to(Un).whenTargetNamed("ink"),t.bind(u.IFactoryPostProcessingPass).toFactory((function(t){return function(e){var n=t.container.getNamed(u.IPostProcessingPass,e);return n.setName(e),n}})),t}function gr(t){var e=new a.W2;return e.parent=t,e.bind(u.IStyleAttributeService).to(We).inSingletonScope(),e.bind(u.IMultiPassRenderer).to(_n).inSingletonScope(),e.bind(u.IPostProcessor).to(Jn).inSingletonScope(),e}var yr=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function vr(t){return yr.indexOf(t)}var _r,xr,br,wr;function Sr(t,e){return 256*(t=(0,W.clamp)(Math.floor(t),0,255))+(0,W.clamp)(Math.floor(e),0,255)}function Er(t){var e=t.color,n=t.radius,r=t.tileX,i=t.tileY,o=t.shape,a=t.opacity,s=t.stroke,u=t.strokeWidth,l=t.strokeOpacity,c=[],h=[],p=[],f=[Sr(e[0],e[1]),Sr(e[2],e[3])],d=[Sr(s[0],s[1]),Sr(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(t){var e=(0,D.Z)(t,2),s=e[0],m=e[1];c.push([].concat(f,[8388608*(s+1)+2097152*(m+1)+131072*vr(o)+n,524288*(r+512)+64*(i+512)])),h.push([].concat(d,[u,l])),p.push([a,0,0,0])})),{packedBuffer:c,packedBuffer2:h,packedBuffer3:p}}!function(t){t.normal="normal",t.additive="additive",t.subtractive="subtractive",t.min="min",t.max="max",t.none="none"}(_r||(_r={})),function(t){t.LINEAR="linear",t.SEQUENTIAL="sequential",t.POWER="power",t.LOG="log",t.IDENTITY="identity",t.TIME="time",t.QUANTILE="quantile",t.QUANTIZE="quantize",t.THRESHOLD="threshold",t.CAT="cat",t.DIVERGING="diverging"}(xr||(xr={})),function(t){t.CONSTANT="constant",t.VARIABLE="variable"}(br||(br={})),function(t){t[t.Attribute=0]="Attribute",t[t.InstancedAttribute=1]="InstancedAttribute",t[t.Uniform=2]="Uniform"}(wr||(wr={}));var Cr=["mapload","mapchange","mapAfterFrameChange"],Mr={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Tr=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},137:(t,e,n)=>{"use strict";n.r(e),n.d(e,{BaseLayer:()=>H,BaseModel:()=>$,CanvasLayer:()=>et,CanvasUpdateType:()=>J,CityBuildingLayer:()=>te,EarthLayer:()=>Lr,GeometryLayer:()=>oe,HeatmapLayer:()=>pe,ImageLayer:()=>ye,LineLayer:()=>Jn,LinearDir:()=>K,MaskLayer:()=>Or,PointLayer:()=>vr,PolygonLayer:()=>Sr,RasterLayer:()=>Mr,TextureBlend:()=>Q,TileDebugLayer:()=>ti,WindLayer:()=>Hr,lineStyleType:()=>Y});var r,i=n(4534),o=n(5683),a=n(89),s=n(3058),u=n(3285),l=n(5963),c=n(78),h=n(537),p=n(7012),f=n(3321),d=n(1517),m=n(6368),g=n(5495),y=n(5814),v=n.n(y),_=n(5048),x=n(4793),b=n(9470),w=n(1883),S=n.n(w),E=n(9479),C=(r={},(0,h.Z)(r,i.BlendType.additive,{enable:!0,func:{srcRGB:i.gl.ONE,dstRGB:i.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,h.Z)(r,i.BlendType.none,{enable:!1}),(0,h.Z)(r,i.BlendType.normal,{enable:!0,func:{srcRGB:i.gl.SRC_ALPHA,dstRGB:i.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,h.Z)(r,i.BlendType.subtractive,{enable:!0,func:{srcRGB:i.gl.ONE,dstRGB:i.gl.ONE,srcAlpha:i.gl.ZERO,dstAlpha:i.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:i.gl.FUNC_SUBTRACT,alpha:i.gl.FUNC_SUBTRACT}}),(0,h.Z)(r,i.BlendType.max,{enable:!0,func:{srcRGB:i.gl.ONE,dstRGB:i.gl.ONE},equation:{rgb:i.gl.MAX_EXT}}),(0,h.Z)(r,i.BlendType.min,{enable:!0,func:{srcRGB:i.gl.ONE,dstRGB:i.gl.ONE},equation:{rgb:i.gl.MIN_EXT}}),r);function M(t,e,n,r,i){e.updateStyleAttribute(t,n,r,i)}function T(t,e,n){(0,E.isString)(n)?M(t,e,n,(function(t){return t})):(0,E.isNumber)(n)?M(t,e,[n],void 0):Array.isArray(n)&&2===n.length&&((0,E.isString)(n[0])&&(0,E.isFunction)(n[1])||(0,E.isString)(n[0])&&Array.isArray(n[1])&&(0,E.isNumber)(n[1][0])&&(0,E.isNumber)(n[1][1]))?M(t,e,n[0],n[1]):M(t,e,[1],void 0)}function A(t,e,n){(0,E.isString)(n)?M(t,e,n,(function(t){return t})):Array.isArray(n)&&2===n.length&&(0,E.isString)(n[0])&&(0,E.isFunction)(n[1])?M(t,e,n[0],n[1]):Array.isArray(n)&&2===n.length&&(0,E.isNumber)(n[0])&&(0,E.isNumber)(n[1])?M(t,e,n,void 0):M(t,e,[0,0],void 0)}var P=n(5691);function L(t,e,n,r,i,o){var a=(null==o?void 0:o.getLayerConfig()).arrow,s=void 0===a?{enable:!1}:a,u=e.map((function(e){var r,o,a,u,l={id:e._id,coordinates:e.coordinates};if(t.filter((function(t){return void 0!==t.scale})).forEach((function(t){var r=function(t,e,n){var r;if(!t.scale)return[];var i=(null==t||null===(r=t.scale)||void 0===r?void 0:r.scalers)||[],o=[];i.forEach((function(n){var r,i=n.field;(e.hasOwnProperty(i)||"variable"===(null===(r=t.scale)||void 0===r?void 0:r.type))&&o.push(e[i])}));var a=t.mapping?t.mapping(o):[];return"color"!==t.name||(0,b.isColor)(a[0])?a:[n]}(t,e,i);t.needRemapping=!1,"color"===t.name&&(r=r.map((function(t){return(0,b.rgb2arr)(t)}))),l[t.name]=Array.isArray(r)&&1===r.length?r[0]:r,"shape"===t.name&&(l.shape=n.getIconFontKey(l[t.name]))})),"line"===l.shape&&s.enable){var c=l.coordinates,h=(r=c[0],a=[(o=c[1])[0]-r[0],o[1]-r[1]],u=(0,b.normalize)(a),[r[0]+1e-4*u[0],r[1]+1e-4*u[1]]);l.coordinates.splice(1,0,h,h)}return l}));return function(t,e,n){if(t.length>0&&e.version===P.G["GAODE2.x"]){var r=n.coordCenter;"number"==typeof t[0].coordinates[0]?t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=P.G["GAODE2.x"],t.originCoordinates=(0,E.cloneDeep)(t.coordinates),t.coordinates=e.lngLatToCoordByLayer(t.coordinates,r)})):t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=P.G["GAODE2.x"],t.originCoordinates=(0,E.cloneDeep)(t.coordinates),t.coordinates=e.lngLatToCoordsByLayer(t.coordinates,r)}))}}(u,r,o),function(t,e){t.length>0&&e.version===P.G.SIMPLE&&t.map((function(t){t.simpleCoordinate||(t.coordinates=function(t,e){if("number"==typeof t[0])return e.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var n=[];return t.map((function(t){var r=[];t.map((function(t){r.push(e.simpleMapCoord.unproject(t))})),n.push(r)})),n}var r=[];return t.map((function(t){r.push(e.simpleMapCoord.unproject(t))})),r}(t.coordinates,e),t.simpleCoordinate=!0)}))}(u,r),u}var I=n(596);function k(t){return t.map((function(t){return"string"==typeof t&&(t=[t,{}]),t}))}function O(t,e,n,r){var i=t.multiPassRenderer;return t.getLayerConfig().enableTAA?i.add(r("taa")):i.add(r("render")),k(e).forEach((function(t){var e=(0,I.Z)(t,2),r=e[0],o=e[1];i.add(n(r),o)})),i.add(n("copy")),i}var R,D,N,F=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]],z=["passes"],B=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"];function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var U,Z,V,G=0,H=(R=(0,i.lazyInject)(i.TYPES.IGlobalConfigService),D=function(t){(0,u.Z)(w,t);var e,n,r,g,y=(r=w,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(r);if(g){var n=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function w(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Z)(this,w),t=y.call(this),(0,h.Z)((0,s.Z)(t),"id","".concat(G++)),(0,h.Z)((0,s.Z)(t),"name","".concat(G)),(0,h.Z)((0,s.Z)(t),"visible",!0),(0,h.Z)((0,s.Z)(t),"zIndex",0),(0,h.Z)((0,s.Z)(t),"inited",!1),(0,h.Z)((0,s.Z)(t),"layerModelNeedUpdate",!1),(0,h.Z)((0,s.Z)(t),"pickedFeatureID",null),(0,h.Z)((0,s.Z)(t),"selectedFeatureID",null),(0,h.Z)((0,s.Z)(t),"styleNeedUpdate",!1),(0,h.Z)((0,s.Z)(t),"forceRender",!1),(0,h.Z)((0,s.Z)(t),"clusterZoom",0),(0,h.Z)((0,s.Z)(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,h.Z)((0,s.Z)(t),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,h.Z)((0,s.Z)(t),"hooks",{init:new _.oI,afterInit:new _.oI,beforeRender:new _.oI,beforeRenderData:new _.gg,afterRender:new _.ni,beforePickingEncode:new _.ni,afterPickingEncode:new _.ni,beforeHighlight:new _.ni(["pickedColor"]),afterHighlight:new _.ni,beforeSelect:new _.ni(["pickedColor"]),afterSelect:new _.ni,beforeDestroy:new _.ni,afterDestroy:new _.ni}),(0,h.Z)((0,s.Z)(t),"models",[]),(0,h.Z)((0,s.Z)(t),"modelLoaded",!1),(0,h.Z)((0,s.Z)(t),"layerChildren",[]),(0,h.Z)((0,s.Z)(t),"masks",[]),(0,h.Z)((0,s.Z)(t),"isVector",!1),(0,m.Z)((0,s.Z)(t),"configService",N,(0,s.Z)(t)),(0,h.Z)((0,s.Z)(t),"animateOptions",{enable:!1}),(0,h.Z)((0,s.Z)(t),"currentPickId",null),(0,h.Z)((0,s.Z)(t),"pendingStyleAttributes",[]),(0,h.Z)((0,s.Z)(t),"scaleOptions",{}),(0,h.Z)((0,s.Z)(t),"animateStatus",!1),(0,h.Z)((0,s.Z)(t),"bottomColor","rgba(0, 0, 0, 0)"),(0,h.Z)((0,s.Z)(t),"isDestroyed",!1),(0,h.Z)((0,s.Z)(t),"encodeDataLength",0),(0,h.Z)((0,s.Z)(t),"sourceEvent",(function(){t.dataState.dataSourceNeedUpdate=!0;var e=t.getLayerConfig();e&&e.autoFit&&t.fitBounds(e.fitBoundsOptions),t.reRender()})),t.name=e.name||t.id,t.zIndex=e.zIndex||0,t.rawConfig=e,t}return(0,a.Z)(w,[{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var e=this;if(Object.keys(t).map((function(n){n in e.rawConfig&&(e.rawConfig[n]=t[n])})),this.inited){var n=this.container.get(i.TYPES.SceneID);(function(t,e){e.tileLayer||e.isTileLayer||(t.opacity&&T("opacity",e,t.opacity),t.strokeWidth&&T("strokeWidth",e,t.strokeWidth),t.strokeOpacity&&T("strokeOpacity",e,t.strokeOpacity),t.stroke&&function(t,e,n){(0,E.isString)(n)?M(t,e,n,void 0):Array.isArray(n)&&2===n.length&&((0,E.isString)(n[0])&&(0,E.isFunction)(n[1])||(0,E.isString)(n[0])&&Array.isArray(n[1])&&n[1].length>0)?M(t,e,n[0],n[1]):M(t,e,"#fff",void 0)}("stroke",e,t.stroke),t.offsets&&A("offsets",e,t.offsets),t.textOffset&&A("textOffset",e,t.textOffset),t.thetaOffset&&T("thetaOffset",e,t.thetaOffset))})(t,this),this.configService.setLayerConfig(n,this.id,(0,d.Z)((0,d.Z)((0,d.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}else this.needUpdateConfig=(0,d.Z)((0,d.Z)({},this.needUpdateConfig),t)}},{key:"setContainer",value:function(t,e){this.container=t,this.sceneContainer=e}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(t){this.bottomColor=t}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var t=this,e=this.container.get(i.TYPES.SceneID);this.configService.setLayerConfig(e,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(i.TYPES.IIconService),this.fontService=this.container.get(i.TYPES.IFontService),this.rendererService=this.container.get(i.TYPES.IRendererService),this.layerService=this.container.get(i.TYPES.ILayerService),this.interactionService=this.container.get(i.TYPES.IInteractionService),this.pickingService=this.container.get(i.TYPES.IPickingService),this.mapService=this.container.get(i.TYPES.IMapService);var n=this.getLayerConfig(),r=n.enableMultiPassRenderer,o=n.passes;r&&null!=o&&o.length&&o.length>0&&this.mapService.on("mapAfterFrameChange",(function(){t.renderLayers()})),this.cameraService=this.container.get(i.TYPES.ICameraService),this.coordinateService=this.container.get(i.TYPES.ICoordinateSystemService),this.shaderModuleService=this.container.get(i.TYPES.IShaderModuleService),this.postProcessingPassFactory=this.container.get(i.TYPES.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(i.TYPES.IFactoryNormalPass),this.styleAttributeService=this.container.get(i.TYPES.IStyleAttributeService),this.multiPassRenderer=this.container.get(i.TYPES.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach((function(e){var n=e.attributeName,r=e.attributeField,i=e.attributeValues,o=e.updateOptions;t.styleAttributeService.updateStyleAttribute(n,{scale:(0,d.Z)({field:r},t.splitValuesAndCallbackInAttribute(i,t.getLayerConfig()[n]))},o)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(i.TYPES.ILayerPlugin);var a,s=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.plugins);try{for(s.s();!(a=s.n()).done;)a.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(t){s.e(t)}finally{s.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map((function(e){e.updateAttributesAndElements(t.attributes,t.elements)})):console.warn("data error")}},{key:"createModelData",value:function(t,e){var n;if(null!==(n=this.layerModel)&&void 0!==n&&n.createModelData)return this.layerModel.createModelData(e);var r=this.calculateEncodeData(t,e),i=this.triangulation;return r&&i?this.styleAttributeService.createAttributesAndIndices(r,i):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(t,e){return this.inited?function(t,e,n,r,i,o){var a=new x.default(i,o),s=t.getBottomColor(),u=L(r.getLayerStyleAttributes()||[],a.data.dataArray,e,n,s,t);return a.destroy(),u}(this,this.fontService,this.mapService,this.styleAttributeService,t,e):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig((0,d.Z)((0,d.Z)({},this.getDefaultConfig()),this.rawConfig));var t=this.getLayerConfig().animateOption;null!=t&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,e,n){return this.updateStyleAttribute("color",t,e,n),this}},{key:"texture",value:function(t,e,n){return this.updateStyleAttribute("texture",t,e,n),this}},{key:"rotate",value:function(t,e,n){return this.updateStyleAttribute("rotate",t,e,n),this}},{key:"size",value:function(t,e,n){return this.updateStyleAttribute("size",t,e,n),this}},{key:"filter",value:function(t,e,n){return this.updateStyleAttribute("filter",t,e,n),this}},{key:"shape",value:function(t,e,n){var r,i,o,a=null===(r=this.styleAttributeService)||void 0===r||null===(i=r.getLayerStyleAttribute("shape"))||void 0===i||null===(o=i.scale)||void 0===o?void 0:o.field,s=t;return this.shapeOption={field:t,values:e},this.updateStyleAttribute("shape",t,e,n),this.tileLayer||function(t,e,n){if("string"==typeof e&&"string"==typeof n&&e!==n){if("PointLayer"===t.type)return void(t.dataState.dataSourceNeedUpdate=!0);F.map((function(r){r.includes(e)&&r.includes(n)&&(t.dataState.dataSourceNeedUpdate=!0)}))}}(this,a,s),this}},{key:"label",value:function(t,e,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:e,updateOptions:n}),this}},{key:"animate",value:function(t){var e={};return(0,E.isObject)(t)?(e.enable=!0,e=(0,d.Z)((0,d.Z)({},e),t)):e.enable=t,this.updateLayerConfig({animateOption:e}),this}},{key:"source",value:function(t,e){return"source"===(null==t?void 0:t.type)?(this.setSource(t),this):(this.sourceOption={data:t,options:e},this.clusterZoom=0,this)}},{key:"setData",value:function(t,e){var n=this;return this.inited?this.layerSource.setData(t,e):this.on("inited",(function(){n.getSource()?n.layerSource.setData(t,e):(n.source(new x.default(t,e)),n.sourceEvent())})),this}},{key:"style",value:function(t){var e=this,n=this.getLayerConfig(),r=t.passes,i=(0,f.Z)(t,z);return r&&k(r).forEach((function(t){var n=e.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(t[0]);n&&n.updateOptions(t[1])})),this.rawConfig=(0,d.Z)((0,d.Z)({},this.rawConfig),i),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),n&&!0===n.mask&&!1===t.mask&&(this.clearModels(),this.layerModel.buildModels((function(t){e.models=t}))),this}},{key:"scale",value:function(t,e){return(0,E.isObject)(t)?this.scaleOptions=(0,d.Z)((0,d.Z)({},this.scaleOptions),t):this.scaleOptions[t]=e,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer?(this.tileLayer.render(),this):(this.encodeDataLength<=0&&!this.forceRender||this.renderModels(),this)}},{key:"renderMultiPass",value:(n=(0,p.Z)(v().mark((function t(){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){t.next=2;break}return t.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){t.next=7;break}return t.next=5,this.multiPassRenderer.render();case 5:t.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"active",value:function(t){var e={};return e.enableHighlight=!!(0,E.isObject)(t)||t,(0,E.isObject)(t)?(e.enableHighlight=!0,t.color&&(e.highlightColor=t.color),t.mix&&(e.activeMix=t.mix)):e.enableHighlight=!!t,this.updateLayerConfig(e),this}},{key:"setActive",value:function(t,e){var n=this;if((0,E.isObject)(t)){var r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:(0,E.isObject)(e)?e.color:this.getLayerConfig().highlightColor,activeMix:(0,E.isObject)(e)?e.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:(0,E.isObject)(e)?e.color:this.getLayerConfig().highlightColor,activeMix:(0,E.isObject)(e)?e.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call((0,b.encodePickingColor)(t)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(t){var e={};return e.enableSelect=!!(0,E.isObject)(t)||t,(0,E.isObject)(t)?(e.enableSelect=!0,t.color&&(e.selectColor=t.color),t.mix&&(e.selectMix=t.mix)):e.enableSelect=!!t,this.updateLayerConfig(e),this}},{key:"setSelect",value:function(t,e){var n=this;if((0,E.isObject)(t)){var r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:(0,E.isObject)(e)?e.color:this.getLayerConfig().selectColor,selectMix:(0,E.isObject)(e)?e.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:(0,E.isObject)(e)?e.color:this.getLayerConfig().selectColor,selectMix:(0,E.isObject)(e)?e.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call((0,b.encodePickingColor)(t)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),e=this.getLayerConfig(),n=e.visible,r=e.minZoom,i=void 0===r?-1/0:r,o=e.maxZoom;return!!n&&t>=i&&t<=(void 0===o?1/0:o)}},{key:"setMultiPass",value:function(t,e){if(this.updateLayerConfig({enableMultiPassRenderer:t}),e&&this.updateLayerConfig({passes:e}),t){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=O(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),o=i.width,a=i.height;this.multiPassRenderer.resize(o,a)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(t){return this.getLayerConfig()[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var e=this.getSource().extent;return e.some((function(t){return Math.abs(t)===1/0}))||this.mapService.fitBounds([[e[0],e[1]],[e[2],e[3]]],t),this}},{key:"destroy",value:function(){var t,e,n,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isDestroyed||(this.layerChildren.map((function(t){return t.destroy(!1)})),this.layerChildren=[],this.masks.map((function(t){return t.destroy(!1)})),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(t=this.multiPassRenderer)||void 0===t||t.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(e=this.layerModel)||void 0===e||e.clearModels(r),null===(n=this.tileLayer)||void 0===n||n.destroy(),this.models=[],this.layerService.cleanRemove(this,r),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach((function(t){return t.destroy()})),null===(t=this.layerModel)||void 0===t||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices})).length}},{key:"setSource",value:function(t){var e=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(){if(void 0===e.coordCenter){var t,n=e.layerSource.center;e.coordCenter=n,null!==(t=e.mapService)&&void 0!==t&&t.setCoordCenter&&e.mapService.setCoordCenter(n)}e.sourceEvent()}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var e,n,r,i=this.styleAttributeService.getLayerStyleAttribute(t);return{type:null===(n=((null==i||null===(e=i.scale)||void 0===e?void 0:e.scalers)||[])[0].option)||void 0===n?void 0:n.type,field:null==i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var e=this.styleAttributeService.getLayerAttributeScale(t);return e?e.invertExtent?e.range().map((function(n){return(0,h.Z)({value:e.invertExtent(n)},t,n)})):e.ticks?e.ticks().map((function(n){return(0,h.Z)({value:n},t,e(n))})):null!=e&&e.domain?e.domain().filter((function(t){return!(0,E.isUndefined)(t)})).map((function(n){return(0,h.Z)({value:n},t,e(n))})):[]:[]}},{key:"pick",value:function(t){var e=t.x,n=t.y;this.interactionService.triggerHover({x:e,y:n})}},{key:"boxSelect",value:function(t,e){this.pickingService.boxPickLayer(this,t,e)}},{key:"buildLayerModel",value:function(t){var e=this,n=t.moduleName,r=t.vertexShader,o=t.fragmentShader,a=t.triangulation,s=t.segmentNumber,u=t.workerEnabled,l=void 0!==u&&u,c=t.workerOptions,h=(0,f.Z)(t,B);this.shaderModuleService.registerModule(n,{vs:r,fs:o});var p=this.shaderModuleService.getModule(n),m=p.vs,g=p.fs,y=p.uniforms,v=this.rendererService.createModel;return new Promise((function(t,n){setTimeout((function(){if(c&&c.modelType in b.WorkerSourceMap&&l)e.styleAttributeService.createAttributesAndIndicesAscy(e.encodedData,s,c).then((function(e){var n=e.attributes,r=e.elements,o=v((0,d.Z)({attributes:n,uniforms:y,fs:g,vs:m,elements:r,blend:C[i.BlendType.normal]},h));t(o)})).catch((function(t){return n(t)}));else{var r=e.styleAttributeService.createAttributesAndIndices(e.encodedData,a,s),o=r.attributes,u=r.elements,p=r.count,f=(0,d.Z)({attributes:o,uniforms:y,fs:g,vs:m,elements:u,blend:C[i.BlendType.normal]},h);p&&(f.count=p);var _=v(f);t(_)}}))}))}},{key:"createAttributes",value:function(t){var e=t.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,e).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){if("basemap"===this.rawConfig.usage)return!1;var e=this.getLayerConfig(),n=e.enableHighlight,r=void 0===n||n,i=e.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(t)||-1!==this.eventNames().indexOf("un"+t);return"click"!==t&&"dblclick"!==t||!o||(a=!0),"mousemove"!==t||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:(e=(0,p.Z)(v().mark((function t(e){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.render();case 2:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})},{key:"renderModels",value:function(t){var e=this;return this.encodeDataLength<=0&&!this.forceRender||(this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels((function(t){e.models=t,e.hooks.beforeRender.call(),e.layerModelNeedUpdate=!1})),this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms()},t)}))),this}},{key:"updateStyleAttribute",value:function(t,e,n,r){this.inited?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,d.Z)({field:e},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[e]))},r):this.pendingStyleAttributes.push({attributeName:t,attributeField:e,attributeValues:n,updateOptions:r})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"dispatchModelLoad",value:function(t){var e=this;this.models.forEach((function(t){return t.destroy()})),this.models=[],this.models=t,this.emit("modelLoaded",null),this.modelLoaded=!0,setTimeout((function(){e.layerService.renderLayers()}),32)}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t,e){return{values:(0,E.isFunction)(t)?void 0:t||e,callback:(0,E.isFunction)(t)?t:void 0}}}]),w}(w.EventEmitter),N=(0,g.Z)(D.prototype,"configService",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D),W=n(92),q=n(4537);function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Y,K,Q,J,$=(U=(0,i.lazyInject)(i.TYPES.IGlobalConfigService),Z=function(){function t(e){(0,o.Z)(this,t),(0,m.Z)(this,"configService",V,this),this.layer=e,this.rendererService=e.getContainer().get(i.TYPES.IRendererService),this.pickingService=e.getContainer().get(i.TYPES.IPickingService),this.shaderModuleService=e.getContainer().get(i.TYPES.IShaderModuleService),this.styleAttributeService=e.getContainer().get(i.TYPES.IStyleAttributeService),this.mapService=e.getContainer().get(i.TYPES.IMapService),this.iconService=e.getContainer().get(i.TYPES.IIconService),this.fontService=e.getContainer().get(i.TYPES.IFontService),this.cameraService=e.getContainer().get(i.TYPES.ICameraService),this.layerService=e.getContainer().get(i.TYPES.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:i.gl.NEAREST,min:i.gl.NEAREST,width:1,height:1}))}return(0,a.Z)(t,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var e=!1;return(0,E.isEqual)(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(e=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),(0,E.isEqual)(t.opacity,this.cacheStyleProperties.opacity)||(e=!0,this.cacheStyleProperties.opacity=t.opacity),(0,E.isEqual)(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(e=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),(0,E.isEqual)(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(e=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),(0,E.isEqual)(t.stroke,this.cacheStyleProperties.stroke)||(e=!0,this.cacheStyleProperties.stroke=t.stroke),(0,E.isEqual)(t.offsets,this.cacheStyleProperties.offsets)||(e=!0,this.cacheStyleProperties.offsets=t.offsets),void 0===this.dataTexture&&(e=!0),e}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),void 0===t.opacity||(0,E.isNumber)(t.opacity)||(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),void 0===t.strokeOpacity||(0,E.isNumber)(t.strokeOpacity)||(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),void 0===t.strokeWidth||(0,E.isNumber)(t.strokeWidth)||(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),void 0===t.stroke||this.isStaticColor(t.stroke)||(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),void 0===t.offsets||this.isOffsetStatic(t.offsets)||(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),void 0===t.thetaOffset||(0,E.isNumber)(t.thetaOffset)||(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return!!(0,E.isString)(t)&&!!(0,q.ZP)(t)}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var e=(0,b.rgb2arr)(t);return e[0]=e[0]?e[0]:0,e[1]=e[1]?e[1]:0,e[2]=e[2]?e[2]:0,e[3]=e[3]?e[3]:0,e}return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&2===t.length&&(0,E.isNumber)(t[0])&&(0,E.isNumber)(t[1]))}},{key:"patchMod",value:function(t,e){for(var n=0;n<e;n++)t.push(-1)}},{key:"patchData",value:function(t,e,n){var r,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(n);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.attr,s=o.count,u=e[a];void 0!==u?"stroke"===a?t.push.apply(t,(0,W.Z)((0,b.rgb2arr)(u))):"offsets"===a?this.isOffsetStatic(u)?t.push(-u[0],u[1]):t.push(0,0):t.push((0,E.isNumber)(u)?u:1):this.patchMod(t,s)}}catch(t){i.e(t)}finally{i.f()}}},{key:"calDataFrame",value:function(t,e,n){for(var r=e.length,i=Math.ceil(r*t/this.DATA_TEXTURE_WIDTH),o=i*this.DATA_TEXTURE_WIDTH,a=[],s=0;s<r;s++){var u=e[s];this.patchData(a,u,n)}for(var l=a.length;l<o;l++)a.push(-1);return{data:a,width:this.DATA_TEXTURE_WIDTH,height:i}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig().blend,e=void 0===t?"normal":t;return C[i.BlendType[e]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(t){throw new Error("Method not implemented.")}},{key:"initModels",value:function(t){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}}]),t}(),V=(0,g.Z)(Z.prototype,"configService",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z);!function(t){t[t.solid=0]="solid",t[t.dash=1]="dash"}(Y||(Y={})),function(t){t.VERTICAL="vertical",t.HORIZONTAL="horizontal"}(K||(K={})),function(t){t.NORMAL="normal",t.REPLACE="replace"}(Q||(Q={})),function(t){t.ALWAYS="always",t.DRAGEND="dragend"}(J||(J={}));const tt={canvas:function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"updateMode",J.ALWAYS),(0,h.Z)((0,s.Z)(t),"renderUpdate",(function(){var e=t.layer.getLayerConfig(),n=e.zIndex,r=void 0===n?10:n,i=e.update,o=void 0===i?J.ALWAYS:i,a=e.animateOption,s=void 0===a?{enable:!1,duration:20}:a;+t.canvas.style.zIndex===r&&(t.canvas.style.zIndex=r+""),t.updateMode!==o&&(t.updateMode=o,t.unBindListener(),t.bindListener()),t.updateMode===J.ALWAYS&&s.enable&&t.renderCanvas()})),(0,h.Z)((0,s.Z)(t),"unBindListener",(function(){t.mapService.off("mapchange",t.renderCanvas),t.mapService.off("zoomstart",t.clearCanvas),t.mapService.off("zoomend",t.renderCanvas),t.mapService.off("movestart",t.clearCanvas),t.mapService.off("moveend",t.renderCanvas)})),(0,h.Z)((0,s.Z)(t),"bindListener",(function(){t.updateMode===J.ALWAYS?t.mapService.on("mapchange",t.renderCanvas):(t.mapService.on("zoomstart",t.clearCanvas),t.mapService.on("zoomend",t.renderCanvas),t.mapService.on("movestart",t.clearCanvas),t.mapService.on("moveend",t.renderCanvas))})),(0,h.Z)((0,s.Z)(t),"clearCanvas",(function(){if(t.ctx){var e=t.rendererService.getViewportSize(),n=e.width,r=e.height;t.ctx.clearRect(0,0,n,r)}})),(0,h.Z)((0,s.Z)(t),"renderCanvas",(function(){var e=t.rendererService.getViewportSize(),n=e.width,r=e.height;if(t.prevSize[0]!==n||t.prevSize[1]!==r){t.prevSize=[n,r];var i=t.mapService.getSize(),o=(0,I.Z)(i,2),a=o[0],s=o[1];t.canvas.width=n,t.canvas.height=r,t.canvas.style.width=a+"px",t.canvas.style.height=s+"px"}var u=t.layer.getLayerConfig().drawingOnCanvas;t.ctx&&u({canvas:t.canvas,ctx:t.ctx,mapService:t.mapService,size:[n,r]})})),t}return(0,a.Z)(i,[{key:"clearModels",value:function(){var t;this.canvas&&(null===(t=this.mapService.getContainer())||void 0===t||t.removeChild(this.canvas),this.canvas=null),this.unBindListener()}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig().update,e=void 0===t?J.ALWAYS:t;return this.updateMode=e,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),[]}},{key:"initCanvas",value:function(){var t,e=this.layer.getLayerConfig().zIndex,n=this.mapService.getSize(),r=(0,I.Z)(n,2),i=r[0],o=r[1],a=this.rendererService.getViewportSize(),s=a.width,u=a.height;this.prevSize=[s,u];var l=document.createElement("canvas");this.canvas=l,l.width=s,l.height=u,l.style.pointerEvents="none",l.style.width=i+"px",l.style.height=o+"px",l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.zIndex=e+"",null===(t=this.mapService.getContainer())||void 0===t||t.appendChild(l);var c=l.getContext("2d");this.ctx=c}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){}}]),i}($)};var et=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","CanvasLayer"),(0,h.Z)((0,s.Z)(t),"forceRender",!0),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new tt[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"hide",value:function(){return this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"renderModels",value:function(){var t,e=this;return null!=this&&null!==(t=this.layerModel)&&void 0!==t&&t.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()},!1)})),this}},{key:"getDefaultConfig",value:function(){return{canvas:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"canvas"}}]),i}(H),nt=n(6319),rt=n.n(nt),it=n(2401),ot=n(2329),at=100;function st(t){return t/180*Math.acos(-1)}function ut(t){var e=st(t[0])+Math.PI/2,n=st(t[1]),r=at+.4*Math.random(),i=r*Math.cos(n)*Math.cos(e);return[r*Math.cos(n)*Math.sin(e),r*Math.sin(n),i]}function lt(t,e){var n=it.create(),r=it.create(),i=ot.fromValues(0,1,0),o=ot.fromValues(0,0,0);t=void 0!==t?t:1;for(var a=2+(void 0!==(e=e||{}).segments?e.segments:32),s=2*a,u=[],l=[],c=[],h=[],p=[],f=[],d=0;d<=a;d++){for(var m=d/a,g=m*Math.PI,y=0;y<=s;y++){var v=y/s,_=v*Math.PI*2;it.identity(r),it.rotateZ(r,r,-g),it.identity(n),it.rotateY(n,n,_),ot.transformMat4(o,i,r),ot.transformMat4(o,o,n),ot.scale(o,o,-t),c.push(o.slice()),h.push.apply(h,(0,W.Z)(o.slice())),ot.normalize(o,o),p.push.apply(p,(0,W.Z)(o.slice())),f.push([v,1-m]),h.push(v,1-m)}if(d>0)for(var x=c.length,b=x-2*(s+1);b+s+2<x;b++)u.push([b,b+1,b+s+1]),l.push(b,b+1,b+s+1),u.push([b+s+1,b+1,b+s+2]),l.push(b+s+1,b+1,b+s+2)}return{cells:u,positions:c,uvs:f,positionsArr:h,indicesArr:l,normalArr:p}}var ct=n(9341),ht=ct.Ue(),pt=(ct.Ue(),ct.Ue()),ft=ct.Ue(),dt=ct.Ue();function mt(t,e,n,r,i){ct.IH(t,n,r),ct.Fv(t,t),e=ct.al(-t[1],t[0]);var o=ct.al(-n[1],n[0]);return[i/ct.AK(e,o),e]}function gt(t,e){return ct.t8(t,-e[1],e[0])}function yt(t,e,n){return ct.lu(t,e,n),ct.Fv(t,t),t}function vt(t,e){return t[0]===e[0]&&t[1]===e[1]}var _t,xt,bt,wt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o.Z)(this,t),(0,h.Z)(this,"lastFlip",-1),(0,h.Z)(this,"miter",ct.al(0,0)),(0,h.Z)(this,"started",!1),(0,h.Z)(this,"dash",!1),(0,h.Z)(this,"totalDistance",0),(0,h.Z)(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,a.Z)(t,[{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.simpleSegment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=t[o-1];l.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var c=e[o-1],h=t[o];h.push(null!==(s=e[o][2])&&void 0!==s?s:0);var p=e[o],f=o<t.length-1?[].concat((0,W.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null;i+=this.simpleSegment(n,i,l,h,f,c,p,d)}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=t[o-1];l.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var c=e[o-1],h=t[o];h.push(null!==(s=e[o][2])&&void 0!==s?s:0);var p=e[o],f=o<t.length-1?[].concat((0,W.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null;i+=this.segment_gaode2(n,i,l,h,f,c,p,d)}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.segment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleSegment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,l=(0,b.aProjectFlat)([r[0],r[1]]),c=(0,b.aProjectFlat)([n[0],n[1]]);yt(pt,l,c);var h=0;if(this.dash&&(h=this.lineSegmentDistance(l,c),this.totalDistance+=h),this.normal||(this.normal=ct.Ue(),gt(this.normal,pt)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(e+0,e+1,e+2),i){var p=(0,b.aProjectFlat)([i[0],i[1]]);vt(l,p)&&ct.IH(p,l,ct.Fv(p,ct.$X(p,l,c))),yt(ft,p,l);var f=mt(dt,ct.Ue(),pt,ft,this.thickness),d=(0,I.Z)(f,2),m=d[0],g=d[1];ct.AK(dt,this.normal),this.extrusions(s,u,r,g,m,this.totalDistance),a.push.apply(a,(0,W.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),ct.JG(this.normal,g),o+=2,this.lastFlip=-1}else gt(this.normal,pt),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,(0,W.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2;return o}},{key:"segment_gaode2",value:function(t,e,n,r,i,o,a,s){var u=0,l=t.indices,c=t.positions,h=t.normals,p="square"===this.cap,f="bevel"===this.join,d=(0,b.aProjectFlat)([a[0],a[1]]),m=(0,b.aProjectFlat)([o[0],o[1]]);yt(pt,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,m),this.totalDistance+=g),this.normal||(this.normal=ct.Ue(),gt(this.normal,pt)),!this.started)if(this.started=!0,p){var y=ct.Ue(),v=ct.Ue();ct.IH(y,this.normal,pt),ct.IH(v,this.normal,pt),h.push(v[0],v[1],0),h.push(y[0],y[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-g);if(l.push(e+0,e+1,e+2),i){vt(r,i)&&ct.IH(i,r,ct.Fv(i,ct.$X(i,r,n))),yt(ft,i,r);var _=mt(dt,ct.Ue(),pt,ft,this.thickness),x=(0,I.Z)(_,2),w=x[0],S=x[1],E=ct.AK(dt,this.normal)<0?-1:1,C=f;C||"miter"!==this.join||w>this.miterLimit&&(C=!0),C?(h.push(this.normal[0],this.normal[1],0),h.push(S[0],S[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,(0,W.Z)(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),l.push(e+2,e+3,e+4),gt(ht,ft),ct.JG(this.normal,ht),h.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,h,r,S,w,this.totalDistance),l.push.apply(l,(0,W.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,ct.JG(this.normal,S),u+=2),this.lastFlip=E}else{if(gt(this.normal,pt),p){var M=ct.Ue(),T=ct.Ue();ct.lu(T,pt,this.normal),ct.IH(M,pt,this.normal),h.push(T[0],T[1],0),h.push(M[0],M[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,(0,W.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),u+=2}return u}},{key:"segment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,l="square"===this.cap,c="bevel"===this.join,h=(0,b.aProjectFlat)([r[0],r[1]]),p=(0,b.aProjectFlat)([n[0],n[1]]);yt(pt,h,p);var f=0;if(this.dash&&(f=this.lineSegmentDistance(h,p),this.totalDistance+=f),this.normal||(this.normal=ct.Ue(),gt(this.normal,pt)),!this.started)if(this.started=!0,l){var d=ct.Ue(),m=ct.Ue();ct.IH(d,this.normal,pt),ct.IH(m,this.normal,pt),u.push(m[0],m[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-f,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-f,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-f);if(a.push(e+0,e+1,e+2),i){var g=(0,b.aProjectFlat)([i[0],i[1]]);vt(h,g)&&ct.IH(g,h,ct.Fv(g,ct.$X(g,h,p))),yt(ft,g,h);var y=mt(dt,ct.Ue(),pt,ft,this.thickness),v=(0,I.Z)(y,2),_=v[0],x=v[1],w=ct.AK(dt,this.normal)<0?-1:1,S=c;S||"miter"!==this.join||_>this.miterLimit&&(S=!0),S?(u.push(this.normal[0],this.normal[1],0),u.push(x[0],x[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,(0,W.Z)(this.lastFlip!==-w?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),gt(ht,ft),ct.JG(this.normal,ht),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,x,_,this.totalDistance),a.push.apply(a,(0,W.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),w=-1,ct.JG(this.normal,x),o+=2),this.lastFlip=w}else{if(gt(this.normal,pt),l){var E=ct.Ue(),C=ct.Ue();ct.lu(C,pt,this.normal),ct.IH(E,pt,this.normal),u.push(C[0],C[1],0),u.push(E[0],E[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,(0,W.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2}return o}},{key:"extrusions",value:function(t,e,n,r,i,o){e.push(r[0],r[1],0),e.push(r[0],r[1],0),t.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}}]),t}();function St(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t[0][0],r=t[0][t[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var i=t[0].length,o=rt().flatten(t),a=o.vertices,s=o.dimensions,u=[],l=[],c=[],h=0;h<a.length/s;h++)2===s?u.push(a[2*h],a[2*h+1],1,-1,-1):u.push(a[3*h],a[3*h+1],1,-1,-1),c.push(0,0,1);var p=rt()(o.vertices,o.holes,o.dimensions);l.push.apply(l,(0,W.Z)(p));for(var f=function(t){var n=o.vertices.slice(t*s,(t+1)*s),r=o.vertices.slice((t+1)*s,(t+2)*s);0===r.length&&(r=o.vertices.slice(0,s));var i=u.length/5;u.push(n[0],n[1],1,0,0,r[0],r[1],1,.1,0,n[0],n[1],0,0,.8,r[0],r[1],0,.1,.8);var a=Et([r[0],r[1],1],[n[0],n[1],0],[n[0],n[1],1],e);c.push.apply(c,(0,W.Z)(a).concat((0,W.Z)(a),(0,W.Z)(a),(0,W.Z)(a))),l.push.apply(l,(0,W.Z)([1,2,0,3,2,1].map((function(t){return t+i}))))},d=0;d<i;d++)f(d);return{positions:u,index:l,normals:c}}function Et(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=ot.create(),o=ot.create(),a=ot.create();r&&(t=(0,b.lngLatToMeters)(t),e=(0,b.lngLatToMeters)(e),n=(0,b.lngLatToMeters)(n));var s=ot.fromValues.apply(ot,(0,W.Z)(t)),u=ot.fromValues.apply(ot,(0,W.Z)(e)),l=ot.fromValues.apply(ot,(0,W.Z)(n));ot.sub(i,l,u),ot.sub(o,s,u),ot.cross(a,i,o);var c=ot.create();return ot.normalize(c,a),c}function Ct(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/t,r=[],i=0;i<t;i++)r.push(n*i+e*Math.PI/12);var o=r.map((function(t){return[Math.sin(t+Math.PI/4),Math.cos(t+Math.PI/4),0]}));return o}function Mt(){return Ct(30)}function Tt(){return Ct(4)}function At(){return Ct(3)}function Pt(){return Ct(6,1)}function Lt(){return Ct(5)}!function(t){t.CYLINDER="cylinder",t.SQUARECOLUMN="squareColumn",t.TRIANGLECOLUMN="triangleColumn",t.HEXAGONCOLUMN="hexagonColumn",t.PENTAGONCOLUMN="pentagonColumn"}(xt||(xt={})),function(t){t.CIRCLE="circle",t.SQUARE="square",t.TRIANGLE="triangle",t.HEXAGON="hexagon",t.PENTAGON="pentagon"}(bt||(bt={}));var It=(_t={},(0,h.Z)(_t,bt.CIRCLE,Mt),(0,h.Z)(_t,bt.HEXAGON,Pt),(0,h.Z)(_t,bt.TRIANGLE,At),(0,h.Z)(_t,bt.SQUARE,Tt),(0,h.Z)(_t,bt.PENTAGON,Lt),(0,h.Z)(_t,xt.CYLINDER,Mt),(0,h.Z)(_t,xt.HEXAGONCOLUMN,Pt),(0,h.Z)(_t,xt.TRIANGLECOLUMN,At),(0,h.Z)(_t,xt.SQUARECOLUMN,Tt),(0,h.Z)(_t,xt.PENTAGONCOLUMN,Lt),_t),kt={};function Ot(t){var e=(0,b.calculateCentroid)(t.coordinates);return{vertices:[].concat((0,W.Z)(e),(0,W.Z)(e),(0,W.Z)(e),(0,W.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function Rt(t){var e=ut((0,b.calculateCentroid)(t.coordinates));return{vertices:[].concat((0,W.Z)(e),(0,W.Z)(e),(0,W.Z)(e),(0,W.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function Dt(t){var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(kt&&kt[t])return kt[t];var n=St([It[t]?It[t]():It.cylinder()],e);return kt[t]=n,n}(t.shape,!1);return{vertices:e.positions,indices:e.index,normals:e.normals,size:5}}function Nt(t){var e=(0,b.calculateCentroid)(t.coordinates);return{vertices:(0,W.Z)(e),indices:[0],size:e.length}}function Ft(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new wt({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=e;c[0]&&!Array.isArray(c[0][0])&&(c=[e]),c.forEach((function(t){i.extrude(t)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function zt(t){var e=t.coordinates,n=[];if(!Array.isArray(e[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=function(t){var e=0;if(t.length<2)return{results:t,totalDistance:0};var n=[],r=Ut(t[0],e);n.push(r);for(var i=1;i<t.length-1;i++){e+=jt(t[i-1],t[i]);var o=Ut(t[i],e);n.push(o),n.push(o)}return e+=jt(t[t.length-2],t[t.length-1]),n.push(Ut(t[t.length-1],e)),{results:n,totalDistance:e}}(e),i=r.results,o=r.totalDistance;return i.map((function(t){n.push(t[0],t[1],t[2],t[3],0,o)})),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function Bt(t){var e=t.coordinates,n=[];if(!Array.isArray(e[0]))return{vertices:[],indices:[],size:4,count:0};var r=function(t){if(t.length<2)return{results:t};var e=[],n=Ut(t[0]);e.push(n);for(var r=1;r<t.length-1;r++){var i=Ut(t[r]);e.push(i),e.push(i)}return e.push(Ut(t[t.length-1])),{results:e}}(e),i=r.results;return i.map((function(t){n.push(t[0],t[1],t[2],t[3])})),{vertices:n,indices:[],size:4,count:i.length}}function jt(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}function Ut(t,e){return t.length<3&&t.push(0),void 0!==e&&t.push(e),t}function Zt(t){var e=t.coordinates,n=rt().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:rt()(r,o,i),vertices:r,size:i}}function Vt(t){var e=t.coordinates,n=rt().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:rt()(r,o,i),vertices:Gt(r),size:i+4}}function Gt(t){for(var e=[],n=(0,b.calculatePointsCenterAndRadius)(t),r=n.center,i=n.radius,o=0;o<t.length;o+=2){var a=t[o],s=t[o+1];e.push.apply(e,[a,s,0].concat((0,W.Z)(r),[i]))}return e}function Ht(t){var e=St(t.coordinates,!0);return{vertices:e.positions,indices:e.index,normals:e.normals,size:5}}function Wt(t){var e,n,r,i,o,a=(e=t.shape,o=It[e]?It[e]():It.circle(),-1===["cylinder","triangleColumn","hexagonColumn","squareColumn"].indexOf(e)?(n=[o],r=rt().flatten(n),i=rt()(r.vertices,r.holes,r.dimensions),{positions:r.vertices,index:i}):function(t){var e=t[0][0],n=t[0][t[0].length-1];e[0]===n[0]&&e[1]===n[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var r=t[0].length,i=rt().flatten(t),o=i.vertices,a=i.dimensions,s=[],u=[],l=0;l<o.length/a;l++)2===a?s.push(o[2*l],o[2*l+1],1):s.push(o[3*l],o[3*l+1],1);var c=rt()(i.vertices,i.holes,i.dimensions);u.push.apply(u,(0,W.Z)(c));for(var h=function(t){var e=i.vertices.slice(t*a,(t+1)*a),n=i.vertices.slice((t+1)*a,(t+2)*a);0===n.length&&(n=i.vertices.slice(0,a));var r=s.length/3;s.push(e[0],e[1],1,n[0],n[1],1,e[0],e[1],0,n[0],n[1],0),u.push.apply(u,(0,W.Z)([0,2,1,2,3,1].map((function(t){return t+r}))))},p=0;p<r;p++)h(p);return{positions:s,index:u}}([o]));return{vertices:a.positions,indices:a.index,size:3}}function qt(t){var e=t.coordinates;return{vertices:[].concat((0,W.Z)(e[0]),[0,0,1,e[1][0],e[0][1],0,1,1],(0,W.Z)(e[1]),[0,1,0],(0,W.Z)(e[0]),[0,0,1],(0,W.Z)(e[1]),[0,1,0,e[0][0],e[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function Xt(t,e){for(var n=e||30,r=t.coordinates,i=[],o=[],a=function(t){i.push(t,1,t,r[0][0],r[0][1],r[1][0],r[1][1],t,-1,t,r[0][0],r[0][1],r[1][0],r[1][1]),t!==n-1&&o.push.apply(o,(0,W.Z)([0,1,2,1,3,2].map((function(e){return 2*t+e}))))},s=0;s<n;s++)a(s);return{vertices:i,indices:o,size:7}}function Yt(t){var e=t.coordinates;2===e.length&&e.push(0);var n=Kt(-1,1),r=Kt(1,1),i=Kt(-1,-1),o=Kt(1,-1);return{vertices:[].concat((0,W.Z)(e),(0,W.Z)(n),(0,W.Z)(e),(0,W.Z)(i),(0,W.Z)(e),(0,W.Z)(o),(0,W.Z)(e),(0,W.Z)(r)),indices:[0,1,2,3,0,2],size:5}}function Kt(t,e){return[(t+1)/2,(e+1)/2]}function Qt(){var t=lt(at,{segments:36});return{vertices:t.positionsArr,indices:t.indicesArr,size:5,normals:t.normalArr}}function Jt(){var t=lt(140,{segments:36});return{vertices:t.positionsArr,indices:t.indicesArr,size:5,normals:t.normalArr}}var $t=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=t.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=t.windowColor,u=void 0===s?"rgb(30,60,89)":s,l=t.time,c=void 0===l?0:l,h=t.sweep,p=void 0===h?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:h;return{u_cityCenter:p.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*p.sweepRadius,u_circleSweep:p.enable?1:0,u_circleSweepColor:(0,b.rgb2arr)(p.sweepColor).slice(0,3),u_circleSweepSpeed:p.sweepSpeed,u_opacity:n,u_baseColor:(0,b.rgb2arr)(i),u_brightColor:(0,b.rgb2arr)(a),u_windowColor:(0,b.rgb2arr)(u),u_time:this.layer.getLayerAnimateTime()||c}}},{key:"calCityGeo",value:function(){var t=(0,I.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+e)/2,(i+n)/2]);var o=this.mapService.lngLatToCoord([r,i]),a=this.mapService.lngLatToCoord([e,n]);this.cityMinSize=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2))/4}else{var s=r-e,u=i-n;this.cityCenter=[(r+e)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:function(t){this.calCityGeo(),this.startModelAnimate(),this.buildModels(t)}},{key:"buildModels",value:function(t){this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\n\nuniform float u_circleSweep;\nuniform vec2 u_cityCenter;\n\nvarying float v_worldDis;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n   v_texCoord = a_Uv;\n\n  if(u_circleSweep > 0.0) {\n     vec2 lnglatscale = vec2(0.0);\n    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\n      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n    }\n    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n  }\n \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\n\nuniform float u_circleSweep;\nuniform float u_cityMinSize;\nuniform vec3 u_circleSweepColor;\nuniform float u_circleSweepSpeed;\n\nvarying float v_worldDis;\n\n#pragma include "picking"\n\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\n    float s = step(hot, n);\n    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\n\n    return mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat LinearizeDepth()\n{\n    float z = gl_FragCoord.z * 2.0 - 1.0;\n    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\n\nvec3 fog(vec3 color, vec3 fogColor, float depth){\n    float fogFactor=clamp(depth,0.0,1.0);\n    vec3 output_color=mix(fogColor,color,fogFactor);\n    return output_color;\n}\n\nfloat sdRect(vec2 p, vec2 sz) {\n  vec2 d = abs(p) - sz;\n  float outside = length(max(d, 0.));\n  float inside = min(max(d.x, d.y), 0.);\n  return outside + inside;\n}\n\nvoid main() {\n  gl_FragColor = v_Color;\n  vec3 baseColor = u_baseColor.xyz;\n  vec3 brightColor = u_brightColor.xyz;\n  vec3 windowColor = u_windowColor.xyz;\n  float targetColId = 5.;\n  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\n  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\n  if(v_texCoord.x < 0.) { //顶部颜色\n       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\n       gl_FragColor = vec4( foggedColor, v_Color.w);\n  }else { // 侧面颜色\n        vec2 st = v_texCoord;\n        vec2  UvScale = v_texCoord;\n        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\n        float tStart = 0.25 * tStep;\n        float tEnd = 0.75 * tStep;\n        float u = mod(UvScale.x, tStep);\n        float v = mod(UvScale.y, tStep);\n        float ux = floor(UvScale.x/tStep);\n        float uy = floor(UvScale.y/tStep);\n        float n = random(vec2(ux,uy));\n        float lightP = u_time;\n        float head = 1.0- step(0.005,st.y);\n        /*step3*/\n        // 将窗户颜色和墙面颜色区别开来\n        float sU = step(tStart, u) - step(tEnd, u);\n        float sV = step(tStart, v) - step(tEnd, v);\n        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\n        float dist = sdRect(vec2(u,v), windowSize);\n        float s = sU * sV;\n\n        float curColId = floor(UvScale.x / tStep);\n        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\n\n        float mLightP = mod(lightP, 2.);\n        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\n        if(ux == targetColId){\n            n =0.;\n        }\n        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );\n        float hot = smoothstep(1.0,0.0,timeP);\n        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\n        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);\n        float sFinal = s * sCol * sRow;\n        color += mix(baseColor, brightColor, sFinal*n);\n        if (st.y<0.01){\n        color = baseColor;\n         }\n        if(head ==1.0) { // 顶部亮线\n            color = brightColor;\n        }\n        color = color * v_Color.rgb;\n\n        vec3 foggedColor = fog(color,fogColor,depth);\n\n        gl_FragColor = vec4(foggedColor,1.0);\n  }\n\n\n  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\n    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\n    gl_FragColor.rgb += r * r * u_circleSweepColor;\n  }\n   \n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Ht,depth:{enable:!0},cull:{enable:!0,face:i.gl.BACK}}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?10:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),s}($);var te=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","CityBuildingLayer"),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this;this.layerModel=new $t(this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),i}(H);var ee=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"radian",0),(0,h.Z)((0,s.Z)(t),"planeGeometryTriangulation",(function(){var e=t.layer.getLayerConfig().center,n=void 0===e?[120,30]:e;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat((0,W.Z)(n),[1,1],(0,W.Z)(n),[0,1],(0,W.Z)(n),[0,0],(0,W.Z)(n),[1,0])}})),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.width,r=void 0===n?1:n,i=t.height,o=void 0===i?1:i,a=t.raisingHeight,s=void 0===a?0:a,u=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(u=-1),this.radian=u*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_opacity:e||1,u_texture:this.texture,u_size:[r,o]}}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"initModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o,s=e.drawCanvas,u=this.rendererService.createTexture2D;this.texture=u({height:0,width:0}),s&&this.updateTexture(s),this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform float u_raisingHeight: 0.0;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform vec2 u_size: [1.0, 1.0];\nuniform mat2 u_RotateMatrix;\n\nattribute vec3 a_Extrude;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   vec3 extrude = a_Extrude;\n   v_Color = a_Color;\n   v_uv = a_Uv;\n\n   float raiseHeight = u_raisingHeight;\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raiseHeight = u_raisingHeight * mapboxZoomScale;\n   }\n\n   // 计算经纬度点位坐标\n   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n   // 计算绕 z 轴旋转后的偏移\n   vec2 offsetXY = project_pixel(u_RotateMatrix * vec2(extrude.x * u_size.x, 0.0));\n   // 绕 z 轴旋转\n   float x = project_pos.x + offsetXY.x;\n   float y = project_pos.y + offsetXY.y;\n   // z 轴不参与旋转\n   float z = project_pixel(extrude.y * u_size.y + raiseHeight);\n\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      // gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n      gl_Position = u_Mvp * (vec4(x, y, z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(x , y, z , 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "picking"\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:this.planeGeometryTriangulation,primitive:i.gl.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:(0,b.getMask)(r,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"updateTexture",value:function(t){var e=this.rendererService.createTexture2D,n=this.layer.getLayerConfig(),r=n.canvasWidth,o=void 0===r?1:r,a=n.canvasHeight,s=void 0===a?1:a,u=document.createElement("canvas");u.width=o,u.height=s,u.getContext("2d")&&(t(u),this.texture=e({data:u,width:u.width,height:u.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[2],n[3]]}}})}}]),p}($);var ne,re=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"terrainImageLoaded",!1),(0,h.Z)((0,s.Z)(t),"planeGeometryTriangulation",(function(){var e,n=t.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,o=n.height,a=void 0===o?1:o,s=n.widthSegments,u=void 0===s?1:s,l=n.heightSegments,c=void 0===l?1:l,h=n.center,p=void 0===h?[120,30]:h,f=n.terrainTexture,d=(e=t).initPlane.apply(e,[i,a,u,c].concat((0,W.Z)(p))),m=d.indices,g=d.positions;return f&&t.loadTerrainTexture(g,m),{vertices:g,indices:m,size:5}})),t}return(0,a.Z)(p,[{key:"initPlane",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=t/2,s=e/2,u=Math.floor(n),l=Math.floor(r),c=u+1,h=l+1,p=t/u,f=e/l,d=[],m=[],g=0;g<h;g++)for(var y=g*f-s,v=0;v<c;v++){var _=v*p-a;if(this.mapService.version===P.G["GAODE2.x"]){var x=this.mapService.lngLatToCoord([_+i,-y+o]),b=(0,I.Z)(x,2),w=b[0],S=b[1];m.push(w,S,0)}else m.push(_+i,-y+o,0);m.push(v/u),m.push(1-g/l)}for(var E=0;E<l;E++)for(var C=0;C<u;C++){var M=C+c*E,T=C+c*(E+1),A=C+1+c*(E+1),L=C+1+c*E;d.push(M,T,L),d.push(T,A,L)}return{indices:d,positions:m}}},{key:"getUninforms",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.mapTexture,i=e.terrainClipHeight,o=void 0===i?0:i,a=e.terrainTexture;return this.mapTexture!==r&&(this.mapTexture=r,null===(t=this.texture)||void 0===t||t.destroy(),this.updateTexture(r)),{u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:a?o:-1,u_texture:this.texture}}},{key:"clearModels",value:function(){var t;this.terrainImage=null,null===(t=this.texture)||void 0===t||t.destroy()}},{key:"initModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o,s=e.mapTexture;this.mapTexture=s;var u=this.rendererService.createTexture2D;this.texture=u({height:0,width:0}),this.updateTexture(s),this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_terrainClipHeight;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   v_Color = a_Color;\n   v_uv = a_Uv;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_clip = 1.0;\n   if(a_Position.z < u_terrainClipHeight) {\n      v_clip = 0.0;\n   }\n  \n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n\n   // float x = 1.0;\n   // float y = 0.0;\n   // float z = 0.0;\n   // mat3 translateMatrix = mat3(\n   //    1.0, 0.0, 0.0 \n   //    0.0, 1.0, 0.0\n   //    -project_pos.x,    -project_pos.y,  1.0\n   // );\n   //  mat4 translateMatrix = mat4(\n   //    1.0, 0.0, 0.0, 0.0 ,\n   //    0.0, 1.0, 0.0, 0.0,\n   //    0.0, 0.0, 1.0, 0.0,\n   //    1.0, 0.0, 0.0, 1.0\n   // );\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "picking"\nvoid main() {\n  // gl_FragColor = vec4(v_Color, u_opacity);\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n    gl_FragColor.a *= u_opacity;\n  } else {\n    // gl_FragColor = vec4(v_uv, 0.0, u_opacity);\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n  gl_FragColor.a *= v_clip;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:this.planeGeometryTriangulation,primitive:i.gl.TRIANGLES,depth:{enable:!0},stencil:(0,b.getMask)(r,a),blend:this.getBlend(),cull:{enable:!0,face:i.gl.BACK}}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"createModelData",value:function(t){if(t){var e=this.layer.getLayerConfig(),n=e.widthSegments,r=e.heightSegments,i=e.width,o=e.height,a=t,s=a.widthSegments,u=a.heightSegments,l=a.width,c=a.height;this.layer.style({widthSegments:void 0!==s?s:n,heightSegments:void 0!==u?u:r,width:void 0!==l?l:i,height:void 0!==c?c:o})}var h=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(h,this.planeGeometryTriangulation)}},{key:"updateTexture",value:function(t){var e=this,n=this.rendererService.createTexture2D;if(t){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE}),e.layerService.reRender()},r.src=t}else this.texture=n({width:0,height:0})}},{key:"getImageData",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r=t.width,i=t.height;return e.width=r,e.height=i,n.drawImage(t,0,0,r,i),n.getImageData(0,0,r,i)}},{key:"translateVertex",value:function(t,e,n,r,i,o){for(var a=n.width,s=n.height,u=this.getImageData(n).data,l=Math.floor(r),c=Math.floor(i),h=l+1,p=c+1,f=a/l,d=s/c,m=0;m<p;m++)for(var g=Math.floor(m*d)*a,y=0;y<h;y++){var v=4*(g+Math.floor(y*f)),_=u[v],x=u[v+1],b=u[v+2];t[5*(m*h+y)+2]=o(_,x,b)}var w=this.layer.getEncodedData(),S=this.styleAttributeService.createAttributesAndIndices(w,(function(){return{vertices:t,indices:e,size:5}}));this.layer.updateModelData(S),this.layerService.throttleRenderLayers()}},{key:"loadTerrainTexture",value:function(t,e){var n=this,r=this.layer.getLayerConfig(),i=r.widthSegments,o=void 0===i?1:i,a=r.heightSegments,s=void 0===a?1:a,u=r.terrainTexture,l=r.rgb2height,c=void 0===l?function(t,e,n){return t+e+n}:l;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(t,e,this.terrainImage,o,s,c):this.terrainImage.onload=function(){n.translateVertex(t,e,n.terrainImage,o,s,c)};else{var h=new Image;this.terrainImage=h,h.crossOrigin="anonymous",h.onload=function(){n.terrainImageLoaded=!0,setTimeout((function(){return n.layer.emit("terrainImageLoaded",null)})),n.translateVertex(t,e,h,o,s,c)},h.src=u}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),p}($);!function(t){t.UP="up",t.DOWN="down"}(ne||(ne={}));const ie={plane:re,sprite:function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"planeGeometryUpdateTriangulation",(function(){for(var e=t.layer.getLayerConfig().spriteBottom,n=void 0===e?-1e5:e,r=t.spriteUpdate,i=n,o=t.spriteTop,a=0;a<t.positions.length;a+=5)t.spriteAnimate===ne.UP?(t.positions[a+2]+=r,t.positions[a+2]>o&&(t.positions[a+2]=i)):(t.positions[a+2]-=r,t.positions[a+2]<i&&(t.positions[a+2]=o));return{vertices:t.positions,indices:t.indices,size:5}})),(0,h.Z)((0,s.Z)(t),"updateModel",(function(){var e=t.layer.createAttributes({triangulation:t.planeGeometryUpdateTriangulation});t.layer.models.map((function(t){t.updateAttributes(e)})),t.layerService.throttleRenderLayers(),t.timer=requestAnimationFrame(t.updateModel)})),(0,h.Z)((0,s.Z)(t),"planeGeometryTriangulation",(function(){var e,n=t.layer.getLayerConfig(),r=n.center,i=void 0===r?[120,30]:r,o=n.spriteCount,a=void 0===o?100:o,s=n.spriteRadius,u=void 0===s?10:s,l=(e=t).initSprite.apply(e,[u,a].concat((0,W.Z)(i))),c=l.indices,h=l.positions;return t.positions=h,t.indices=c,{vertices:h,indices:c,size:5}})),t}return(0,a.Z)(p,[{key:"initSprite",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,i=[],o=[],a=this.mapService,s=this.spriteAnimate===ne.UP?-this.spriteTop:this.spriteTop,u=0;u<e;u++){var l=Math.random()*s;o.push.apply(o,(0,W.Z)(h(l)))}for(var c=0;c<e;c++)i.push(c);function h(e){var i=t*Math.random(),o=t*Math.random(),s=-t/2+i,u=-t/2+o;if(a.version===P.G["GAODE2.x"]){var l=a.lngLatToCoord([s+n,-u+r]),c=(0,I.Z)(l,2);return[c[0],c[1],e,0,0]}return[s+n,-u+r,e,0,0]}return{indices:i,positions:o}}},{key:"getUninforms",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.mapTexture,i=e.spriteScale,o=void 0===i?1:i;return this.mapTexture!==r&&(this.mapTexture=r,null===(t=this.texture)||void 0===t||t.destroy(),this.updateTexture(r)),{u_opacity:n||1,u_mapFlag:r?1:0,u_texture:this.texture,u_Scale:o}}},{key:"clearModels",value:function(){var t;cancelAnimationFrame(this.timer),null===(t=this.texture)||void 0===t||t.destroy()}},{key:"initModels",value:function(t){var e=this,n=this.layer.getLayerConfig(),r=n.mapTexture,o=n.spriteTop,a=void 0===o?5e6:o,s=n.spriteUpdate,u=void 0===s?1e4:s,l=n.spriteAnimate,c=void 0===l?ne.DOWN:l;this.mapTexture=r,this.spriteTop=a,this.spriteUpdate=u,this.spriteAnimate="up"===c?ne.UP:ne.DOWN;var h=this.rendererService.createTexture2D;this.texture=h({height:0,width:0}),this.updateTexture(r),setTimeout((function(){e.updateModel()}),100),this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:'precision highp float;\n\nattribute vec3 a_Position;\nattribute vec3 a_Color;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_Scale;\nvarying vec3 v_Color;\nvarying float v_d;\n\n#pragma include "projection"\nvoid main() {\n   v_Color = a_Color;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_d = a_Position.z;\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   gl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;\n}\n',fragmentShader:"\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying float v_d;\n\nvoid main() {\n\n  if(v_d < 0.0) {\n    discard;\n  }\n\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, gl_PointCoord);\n    gl_FragColor.a *= u_opacity;\n  } else {\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n}\n",triangulation:this.planeGeometryTriangulation,primitive:i.gl.POINTS,depth:{enable:!1},blend:this.getBlend()}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"updateTexture",value:function(t){var e=this,n=this.rendererService.createTexture2D;if(t){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE}),e.layerService.reRender()},r.src=t}else this.texture=n({width:0,height:0})}},{key:"registerBuiltinAttributes",value:function(){return""}}]),p}($),billboard:ee};var oe=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","GeometryLayer"),(0,h.Z)((0,s.Z)(t),"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new ie[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"getDefaultConfig",value:function(){return{plane:{},sprite:{},billboard:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==e||null===(t=e.scale)||void 0===t?void 0:t.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]),i}(H);var ae=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||.9,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'precision highp float;\r\n// 多边形顶点坐标\r\nattribute vec3 a_Position;\r\n// 多边形经纬度坐标\r\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\n\r\nuniform vec2 u_SceneCenterMKT;\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // 将经纬度转换为高德2.0需要的平面坐标\r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Wt,primitive:i.gl.TRIANGLES,depth:{enable:!1},stencil:(0,b.getMask)(r,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),s}($);var se,ue=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||1,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\n\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_SceneCenterMKT;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n  // vec2 lnglat = (a_Pos.xy + offset); \n  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n  // gl_Position = project_common_position_to_clipspace(project_pos);\n  // float lightWeight = calc_lighting(project_pos);\n  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // vec2 lnglat = (a_Pos.xy + offset); \n    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n\n    // float lightWeight = calc_lighting(project_pos);\n    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 经纬度\n    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // 将经纬度转换为高德2.0需要的平面坐标\n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Dt,primitive:i.gl.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:(0,b.getMask)(r,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),s}($),le=n(7745);n(171);var ce=(0,le.b2)()(se=function(t){(0,u.Z)(f,t);var e,n,r,s,h=(r=f,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(r);if(s){var n=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function f(){return(0,o.Z)(this,f),h.apply(this,arguments)}return(0,a.Z)(f,[{key:"render",value:function(){var t=this,e=this.rendererService,n=e.clear;(0,e.useFramebuffer)(this.heatmapFramerBuffer,(function(){n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()})),this.layer.styleNeedUpdate&&this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(n=(0,p.Z)(v().mark((function t(e){var n,r,o,a,s,u,l,c,h,p;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.rendererService,o=r.createFramebuffer,a=r.getViewportSize,s=r.createTexture2D,u=this.styleAttributeService.getLayerStyleAttribute("shape"),l=(null==u||null===(n=u.scale)||void 0===n?void 0:n.field)||"heatmap",this.shapeType=l,t.next=6,this.buildHeatMapIntensity();case 6:this.intensityModel=t.sent,this.colorModel="heatmap"===l?this.buildHeatmapColor():this.build3dHeatMap(),c=a(),h=c.width,p=c.height,this.heatmapFramerBuffer=o({color:s({width:Math.floor(h/4),height:Math.floor(p/4),wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.LINEAR,mag:i.gl.LINEAR}),depth:!1}),this.updateColorTexture(),e([this.intensityModel,this.colorModel]);case 12:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:i.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size;return[void 0===e?1:e]}}})}},{key:"buildHeatMapIntensity",value:(e=(0,p.Z)(v().mark((function t(){var e;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.triangulation=Yt,t.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n\nvoid main(){\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    gl_FragColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:Yt,depth:{enable:!1},cull:{enable:!0,face:(0,b.getCullFace)(this.mapService.version)},blend:{enable:!0,func:{srcRGB:i.gl.ONE,srcAlpha:1,dstRGB:i.gl.ONE,dstAlpha:1}}});case 3:return e=t.sent,t.abrupt("return",e);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"buildHeatmapColor",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r;this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n",fs:"uniform sampler2D u_texture;        // 热力强度图\nuniform sampler2D u_colorTexture;   // 根据强度分布的色带\nuniform float u_opacity;\nvarying vec2 v_texCoord;\n\nuniform vec2 u_ViewportSize;\n\nfloat getBlurIndusty() {\n    float vW = 2.0/u_ViewportSize.x;\n    float vH = 2.0/u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture2D(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\n\n    gl_FragColor =color;\n    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n\n}\n"});var a=this.shaderModuleService.getModule("heatmapColor"),s=a.vs,u=a.fs,l=a.uniforms,c=this.rendererService,h=c.createAttribute,p=c.createElements,f=c.createBuffer;return(0,c.createModel)({vs:s,fs:u,attributes:{a_Position:h({buffer:f({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:i.gl.FLOAT}),size:3}),a_Uv:h({buffer:f({data:[0,1,1,1,0,0,1,0],type:i.gl.FLOAT}),size:2})},uniforms:(0,d.Z)({},l),depth:{enable:!1},blend:this.getBlend(),elements:p({data:[0,2,1,2,3,1],type:i.gl.UNSIGNED_INT,count:6}),stencil:(0,b.getMask)(n,o)})}},{key:"drawIntensityMode",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.intensity,i=void 0===r?10:r,o=e.radius,a=void 0===o?5:o;null===(t=this.intensityModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_radius:a,u_intensity:i}})}},{key:"drawColorMode",value:function(){var t,e=this.layer.getLayerConfig().opacity;null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:e||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var t,e=this.layer.getLayerConfig().opacity,n=it.create();it.invert(n,this.cameraService.getViewProjectionMatrixUncentered()),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:e||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,W.Z)(n)}})}},{key:"build3dHeatMap",value:function(){var t=this.layer.getLayerConfig(),e=t.mask,n=void 0!==e&&e,r=t.maskInside,o=void 0===r||r,a=(0,this.rendererService.getViewportSize)(),s=function(t,e){for(var n=[],r=[],i=[],o=t+1,a=e+1,s=t/2,u=e/2,l=0;l<a;l++)for(var c=l-u,h=0;h<o;h++){var p=h-s;r.push(p/s,-c/u,0),i.push(h/t),i.push(1-l/e)}for(var f=0;f<e;f++)for(var d=0;d<t;d++){var m=d+o*f,g=d+o*(f+1),y=d+1+o*(f+1),v=d+1+o*f;n.push(m,g,v),n.push(g,y,v)}return{vertices:r,indices:n,uvs:i}}(a.width/4,a.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\n\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n\tvec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n\tvec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n\tvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n\tinverseP2 = inverseP2 / inverseP2.w;\n\n\tfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n\tvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture2D(u_texture, v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\n\nvoid main(){\n   \n     float intensity = texture2D(u_texture, v_texCoord).r;\n    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\n    gl_FragColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"});var u=this.shaderModuleService.getModule("heatmap3dColor"),l=u.vs,c=u.fs,h=u.uniforms,p=this.rendererService,f=p.createAttribute,m=p.createElements,g=p.createBuffer;return(0,p.createModel)({vs:l,fs:c,attributes:{a_Position:f({buffer:g({data:s.vertices,type:i.gl.FLOAT}),size:3}),a_Uv:f({buffer:g({data:s.uvs,type:i.gl.FLOAT}),size:2})},primitive:i.gl.TRIANGLES,uniforms:(0,d.Z)({},h),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:i.gl.SRC_ALPHA,srcAlpha:1,dstRGB:i.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:m({data:s.indices,type:i.gl.UNSIGNED_INT,count:s.indices.length}),stencil:(0,b.getMask)(n,o)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var e=this.layer.getLayerConfig().rampColors,n=(0,b.generateColorRamp)(e);this.colorTexture=t({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.NEAREST,mag:i.gl.NEAREST,flipY:!1})}}]),f}($))||se;const he={heatmap:ce,heatmap3d:ce,grid:ae,grid3d:ue,hexagon:function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||.9,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_SceneCenterMKT;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Wt,depth:{enable:!1},primitive:i.gl.TRIANGLES,blend:this.getBlend(),stencil:(0,b.getMask)(r,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),s}($)};var pe=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","HeatMapLayer"),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new he[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"renderModels",value:function(){var t=this;return"heatmap"===this.getModelType()?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.layerModel.buildModels((function(e){return t.models=e})),this.layerModelNeedUpdate=!1),this.models.forEach((function(e){return e.draw({uniforms:t.layerModel.getUninforms()})})),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),i}(H);var fe=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.clampLow,r=void 0===n||n,i=t.clampHigh,o=void 0===i||i,a=t.noDataValue,s=void 0===a?-9999999:a,u=t.domain,l=void 0===u?[0,1]:u,c=t.rampColors,h=t.pixelConstant,p=void 0===h?0:h,f=t.pixelConstantR,d=void 0===f?65536:f,m=t.pixelConstantG,g=void 0===m?256:m,y=t.pixelConstantB,v=void 0===y?1:y,_=t.pixelConstantRGB,x=void 0===_?.1:_;return(0,E.isEqual)(this.rampColors,c)||(this.updateColorTexture(),this.rampColors=c),{u_opacity:e||1,u_texture:this.texture,u_pixelConstant:p,u_pixelConstantR:d,u_pixelConstantG:g,u_pixelConstantB:v,u_pixelConstantRGB:x,u_domain:l,u_clampLow:r,u_clampHigh:void 0!==o?o:r,u_noDataValue:s,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(t){var e=this,n=this.layer.getLayerConfig(),r=n.mask,o=void 0!==r&&r,a=n.maskInside,s=void 0===a||a,u=n.rampColorsData,l=n.rampColors,c=this.layer.getSource(),h=this.rendererService.createTexture2D;this.texture=h({height:0,width:0}),c.data.images.then((function(t){e.texture=h({data:t[0],width:t[0].width,height:t[0].height}),e.layerService.reRender()}));var p=u||(0,b.generateColorRamp)(l);this.colorTexture=h({data:p.data,width:p.width,height:p.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nvarying vec2 v_texCoord;\n\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\n\nuniform float u_pixelConstant;\nuniform float u_pixelConstantR;\nuniform float u_pixelConstantG;\nuniform float u_pixelConstantB;\nuniform float u_pixelConstantRGB;\n\nvoid main() {\n  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));\n\n  float r = baseColor.r;\n  float g = baseColor.g;\n  float b = baseColor.b;\n\n  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);\n  if (value == u_noDataValue) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {\n    gl_FragColor = vec4(0, 0, 0, 0);\n  } else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));\n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n  }\n}\n",triangulation:qt,primitive:i.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(o,s)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.layer.getLayerConfig().rampColors,n=(0,b.generateColorRamp)(e);this.colorTexture=t({data:n.data,width:n.width,height:n.height,flipY:!1})}}]),s}($);var de=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:function(t){var e=this,n=this.layer.getLayerConfig(),r=n.mask,o=void 0!==r&&r,a=n.maskInside,s=void 0===a||a,u=this.layer.getSource(),l=this.rendererService.createTexture2D;if(this.texture=l({height:0,width:0}),b.isMini){var c=this.layerService.sceneService.getSceneConfig().canvas.createImage();c.crossOrigin="anonymous",c.src=u.data.originData,c.onload=function(){e.texture=l({data:c,width:c.width,height:c.height}),e.layerService.reRender()}}else u.data.images.then((function(t){e.texture=l({data:t[0],width:t[0].width,height:t[0].height,mag:i.gl.LINEAR,min:i.gl.LINEAR}),e.layerService.reRender()}));this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:qt,primitive:i.gl.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:(0,b.getMask)(o,s)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),s}($);var me=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.rendererService.createTexture2D,e=this.layer.getLayerConfig(),n=e.opacity,r=e.clampLow,i=void 0===r||r,o=e.clampHigh,a=void 0===o||o,s=e.noDataValue,u=void 0===s?-9999999:s,l=e.domain,c=void 0===l?[0,1]:l,h=e.colorTexture,p=void 0===h?t({height:0,width:0}):h,f=e.pixelConstant,d=void 0===f?0:f,m=e.pixelConstantR,g=void 0===m?65536:m,y=e.pixelConstantG,v=void 0===y?256:y,_=e.pixelConstantB,x=void 0===_?1:_,b=e.pixelConstantRGB,w=void 0===b?.1:b;return{u_opacity:n||1,u_texture:this.texture,u_pixelConstant:d,u_pixelConstantR:g,u_pixelConstantG:v,u_pixelConstantB:x,u_pixelConstantRGB:w,u_domain:c,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:p}}},{key:"initModels",value:function(t){var e=this,n=this.layer.getLayerConfig(),r=n.mask,o=void 0!==r&&r,a=n.maskInside,s=void 0===a||a,u=this.layer.getSource(),l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0}),u.data.images.then((function(t){e.texture=l({data:t[0],width:t[0].width,height:t[0].height}),e.layerService.reRender()})),this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nvarying vec2 v_texCoord;\n\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\n\nuniform float u_pixelConstant;\nuniform float u_pixelConstantR;\nuniform float u_pixelConstantG;\nuniform float u_pixelConstantB;\nuniform float u_pixelConstantRGB;\n\nvoid main() {\n  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));\n\n  float r = baseColor.r;\n  float g = baseColor.g;\n  float b = baseColor.b;\n\n  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);\n  if (value == u_noDataValue) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {\n    gl_FragColor = vec4(0, 0, 0, 0);\n  } else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));\n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n  }\n}\n",triangulation:qt,primitive:i.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(o,s)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),s}($);const ge={image:de,dataImage:fe,tileDataImage:me};var ye=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","ImageLayer"),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new ge[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"getDefaultConfig",value:function(){return{image:{},dataImage:{},tileDataImage:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==e||null===(t=e.scale)||void 0===t?void 0:t.field;return"dataImage"===n?"dataImage":"image"===n?"image":"tileDataImage"===n?"tileDataImage":"image"}}]),i}(H);function ve(t,e,n){t.map((function(t){"mask"===e?t.style({mask:n}):t.updateLayerConfig((0,h.Z)({},e,n))}))}function _e(t,e,n,r){if(Array.isArray(r))t[n].apply(t,(0,W.Z)(r));else if("string"!=typeof r){var i=function(t,e,n){switch(n){case"size":return 1;case"color":return"#fff";case"shape":return function(t,e){var n,r,i=e.getAttribute("shape");if(i&&null!==(n=i.scale)&&void 0!==n&&n.field)return"text"===(null===(r=i.scale)||void 0===r?void 0:r.values)?[i.scale.field,i.scale.values]:i.scale.field;switch(t){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}(e,t);default:return""}}(t,e.type,n);if(!r)return t[n](i),t;var o=function(t,e){if("shape"===e)return"string"==typeof t?[t]:null!=t&&t.field?[null==t?void 0:t.field]:[];var n=t,r=n.field,i=n.values,o=n.callback;return r&&i&&Array.isArray(i)?[r,i]:r&&o?[r,o]:r?[r]:[]}(r,n);0===o.length?t[n](i):t[n].apply(t,(0,W.Z)(o))}else t[n](r)}var xe=["mvt","geojsonvt","testTile"];function be(t){return xe.indexOf(t)>=0}function we(t,e){e.map((function(e){var n=(0,i.createLayerContainer)(t.sceneContainer);e.setContainer(n,t.sceneContainer),e.init()}))}function Se(t,e){var n,r,i=e.getAttribute("shape");if(i&&null!==(n=i.scale)&&void 0!==n&&n.field)return"text"===(null===(r=i.scale)||void 0===r?void 0:r.values)?[i.scale.field,i.scale.values]:i.scale.field;switch(t){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function Ee(t,e){switch(t){case"PolygonLayer":case"LineLayer":return!0;case"PointLayer":return!1;default:return e}}function Ce(t){return t.layerIDList.length===t.loadedLayers}function Me(t,e,n){if(0!==e.length)return function(t){var e=!0;return t.map((function(t){"PointLayer"!==t.type&&(e=!1)})),e}(e)?(ve(e,"visible",t.isVisible),void n.reRender()):void function(t,e){t.isVisible?e():function(t,e){var n=window.setInterval((function(){var r=Ce(t),i=function(t){var e=t.children;return e.filter((function(t){return Ce(t)})).length===e.length}(t),o=function(t){var e=t.parent;return!e||Ce(e)}(t);r&&i&&o&&(e(),window.clearInterval(n))}),36)}(t,(function(){e()}))}(t,(function(){ve(e,"visible",t.isVisible),n.reRender()}))}var Te=function(t){(0,u.Z)(h,t);var e,n,r,s=(n=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function h(){return(0,o.Z)(this,h),s.apply(this,arguments)}return(0,a.Z)(h,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.usage,i=t.color,o=void 0===i?"#fff":i,a=t.size,s=void 0===a?1:a;return{u_opacity:Number(n),u_color:"basemap"===r?(0,b.rgb2arr)(o):[0,0,0,0],u_size:"basemap"===r?s:1}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:(e=(0,p.Z)(v().mark((function t(e){var n,r,i,o,a,s,u,l;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=n.depth,u=void 0!==s&&s,l=n.usage,this.layer.triangulation=Ft,this.layer.buildLayerModel({moduleName:"lineTile_"+l,vertexShader:"basemap"===l?'attribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_size;\n\n#pragma include "projection"\n\nvoid main() {\n\n  vec3 size = a_Miter * u_size * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n  }\n}\n':'attribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\n// uniform vec2 u_tileOrigin;\n// uniform float u_coord;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\n\nvoid main() {\n  v_color = a_Color;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // if(u_coord > 0.0) { // 使用经纬度坐标\n      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n  // } else { // 使用偏移坐标\n  //   vec2 pointPos = a_Position.xy;\n  //   vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // 瓦片起始点的世界坐标\n\n  //   vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // 瓦片内的点的偏移坐标\n    \n  //   tileWorld.xy += pointOffset;\n\n  //   tileWorld.xy += offset;\n\n  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n  //     // Needs to be divided with project_uCommonUnitsPerMeter\n  //     tileWorld.w *= u_PixelsPerMeter.z;\n  //   }\n  //   gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;\n  // }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:"basemap"===l?"uniform float u_opacity : 1.0;\nuniform vec4 u_color;\n\nvoid main() {\n  gl_FragColor = u_color;\n  gl_FragColor.a *= u_opacity;\n}\n":'uniform float u_opacity : 1.0;\nvarying vec4 v_color;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Ft,blend:this.getBlend(),depth:{enable:u},stencil:(0,b.getMask)(i,a),pick:"basemap"!==l}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){"basemap"!==this.layer.getLayerConfig().usage&&this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}})}}]),h}($);var Ae=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.usage,i=t.color,o=void 0===i?"#fff":i;return{u_opacity:(0,E.isNumber)(n)?n:1,u_color:"basemap"===r?(0,b.rgb2arr)(o):[0,0,0,0]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o,s=e.usage;this.layer.buildLayerModel({moduleName:"lineTileSimpleNormal_"+s,vertexShader:"basemap"===s?'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n  }\n}':'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n\nvarying vec4 v_color;\n\nvoid main() {\n  v_color = a_Color; \n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n  }\n}\n',fragmentShader:"uniform float u_opacity : 1.0;\nuniform vec4 u_color;\n\nvoid main() {\n  gl_FragColor = u_color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:Bt,primitive:i.gl.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(r,a),pick:!1}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){}}]),s}($),Pe=n(5512);function Le(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const Ie=function(){function t(e,n,r){(0,o.Z)(this,t),(0,h.Z)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(n/r);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0}return(0,a.Z)(t,[{key:"insert",value:function(t,e,n,r,i){this.forEachCell(e,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!1,i)}},{key:"hitTest",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!0,i)}},{key:"insertBoxCell",value:function(t,e,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(t,e,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(t,e,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l){var c,h=this.bboxes,p=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Le(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Le(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(l);try{for(p.s();!(c=p.n()).done;){var f=c.value;if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=h[d+2]&&e<=h[d+3]&&n>=h[d+0]&&r>=h[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}}catch(t){p.e(t)}finally{p.f()}}return!1}},{key:"forEachCell",value:function(t,e,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(t),l=this.convertToYCellCoord(e),c=this.convertToXCellCoord(n),h=this.convertToYCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.xCellCount*f+p;if(i.call(this,t,e,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),t}();var ke=function(){function t(e,n){(0,o.Z)(this,t),(0,h.Z)(this,"viewportPadding",100),this.width=e,this.height=n,this.viewportPadding=Math.max(e,n),this.grid=new Ie(e+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=e+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=e+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return(0,a.Z)(t,[{key:"placeCollisionBox",value:function(t){var e=t.x1+t.anchorPointX+this.viewportPadding,n=t.y1+t.anchorPointY+this.viewportPadding,r=t.x2+t.anchorPointX+this.viewportPadding,i=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(e,n,r,i)||this.grid.hitTest(e,n,r,i)?{box:[]}:{box:[e,n,r,i]}}},{key:"insertCollisionBox",value:function(t,e){var n={featureIndex:e};this.grid.insert(n,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,e,n){var r=Pe.al(e,n,0,1),i=Pe.Ue(),o=it.fromValues.apply(it,(0,W.Z)(t));return Pe.fF(i,r,o),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}}]),t}();function Oe(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Re(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Re(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Re(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function De(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;break;default:e=.5}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:e,verticalAlign:n}}function Ne(t,e,n,r,i){if(i){var o=t[r],a=o.glyph;if(a)for(var s=e[a].advance*o.scale,u=(t[r].x+s)*i,l=n;l<=r;l++)t[l].x-=u}}function Fe(t,e,n,r,i,o,a){var s,u=(e-n)*i,l=(-r*a+.5)*o,c=Oe(t);try{for(c.s();!(s=c.n()).done;){var h=s.value;h.x+=u,h.y+=l}}catch(t){c.e(t)}finally{c.f()}}function ze(t,e,n,r,i,o,a){var s=0,u=-8,l=0,c=t.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,p=c.length;n.forEach((function(t){if(t.split("").forEach((function(t){var n=e[t];n&&(c.push({glyph:t,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),c.length!==p){var n=s-a;l=Math.max(n,l),Ne(c,e,p,c.length-1,h)}s=0,u-=r+5}));var f=De(i),d=f.horizontalAlign,m=f.verticalAlign;Fe(c,h,d,m,l,r,n.length);var g=u- -8;t.top+=-m*g,t.bottom=t.top-g,t.left+=-d*l,t.right=t.left+l}function Be(t,e,n,r,i,o,a){var s=0,u=-8,l=0,c=t.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,p=c.length;n.forEach((function(t){var n=e[t];if(n&&(c.push({glyph:t,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),c.length!==p){var i=s-a;l=Math.max(i,l),Ne(c,e,p,c.length-1,h)}s=0,u-=r+5}));var f=De(i),d=f.horizontalAlign,m=f.verticalAlign;Fe(c,h,d,m,l,r,n.length);var g=u- -8;t.top+=-m*g,t.bottom=t.top-g,t.left+=-d*l,t.right=t.left+l}function je(t,e,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=t.split("\n"),l=[],c={positionedGlyphs:l,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:t};return s?Be(c,e,u,n,r,i,o):ze(c,e,u,n,r,i,o),!!l.length&&c}function Ue(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=t.positionedGlyphs,o=void 0===i?[]:i,a=[],s=Oe(o);try{for(s.s();!(e=s.n()).done;){var u=e.value,l=u.metrics,c=4,h=l.advance*u.scale/2,p=r?[u.x+h,u.y]:[0,0],f=r?[0,0]:[u.x+h+n[0],u.y+n[1]],d=(0-c)*u.scale-h+f[0],m=(0-c)*u.scale+f[1],g=d+l.width*u.scale,y=m+l.height*u.scale,v={x:d,y:m},_={x:g,y:m},x={x:d,y},b={x:g,y};a.push({tl:v,tr:_,bl:x,br:b,tex:l,glyphOffset:p})}}catch(t){s.e(t)}finally{s.f()}return a}function Ze(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ve='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\n// uniform float u_font_size : 24.0;\nuniform float u_opacity : 1.0;\nuniform vec4 u_stroke_color : [0, 0, 0, 1];\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\n#pragma include "picking"\nvoid main() {\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n  \n  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));\n  gl_FragColor.a= gl_FragColor.a * alpha;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',Ge='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying float v_fontScale;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n  v_uv = a_tex / u_sdf_map_size;\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  vec4 projected_position;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));\n  } else { // else\n   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n',He="#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\n\nuniform float u_opacity : 1.0;\nuniform vec4 u_stroke_color : [0, 0, 0, 1];\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\nuniform vec4 u_color;\n\nvoid main() {\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n  \n  gl_FragColor = mix(vec4(u_color.rgb, u_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));\n  gl_FragColor.a= gl_FragColor.a * alpha;\n}\n",We='#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_size;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_tex / u_sdf_map_size;\n\n  // 文本缩放比例\n  float fontScale = u_size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  vec4 projected_position;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));\n  } else { // else\n   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n\n}\n';function qe(t){var e=this,n=t.id,r=[],i=[];if(!e.glyphInfoMap||!e.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var o=e.glyphInfoMap[n].centroid,a=2===o.length?[o[0],o[1],0]:o;return e.glyphInfoMap[n].glyphQuads.forEach((function(t,e){r.push.apply(r,(0,W.Z)(a).concat([t.tex.x,t.tex.y+t.tex.height,t.tl.x,t.tl.y],(0,W.Z)(a),[t.tex.x+t.tex.width,t.tex.y+t.tex.height,t.tr.x,t.tr.y],(0,W.Z)(a),[t.tex.x+t.tex.width,t.tex.y,t.br.x,t.br.y],(0,W.Z)(a),[t.tex.x,t.tex.y,t.bl.x,t.bl.y])),i.push(0+4*e,1+4*e,2+4*e,2+4*e,3+4*e,0+4*e)})),{vertices:r,indices:i,size:7}}var Xe=function(t){(0,u.Z)(f,t);var e,n,r=(e=f,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function f(){var t;(0,o.Z)(this,f);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"glyphInfoMap",{}),(0,h.Z)((0,s.Z)(t),"currentZoom",-1),(0,h.Z)((0,s.Z)(t),"textureHeight",0),(0,h.Z)((0,s.Z)(t),"textCount",0),(0,h.Z)((0,s.Z)(t),"preTextStyle",{}),(0,h.Z)((0,s.Z)(t),"buildModels",function(){var e=(0,p.Z)(v().mark((function e(n){var r,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.mapping(),r=t.layer.getLayerConfig(),i=r.usage,t.layer.buildLayerModel({moduleName:"pointTileText_"+i,vertexShader:"basemap"===i?We:Ge,fragmentShader:"basemap"===i?He:Ve,triangulation:qe.bind((0,s.Z)(t)),depth:{enable:!1},blend:t.getBlend(),pick:"basemap"!==i}).then((function(t){n([t])})).catch((function(t){console.warn(t),n([])}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,h.Z)((0,s.Z)(t),"mapping",(function(){t.initGlyph(),t.updateTexture(),t.filterGlyphs(),t.reBuildModel()})),t}return(0,a.Z)(f,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.stroke,i=void 0===r?"#fff":r,o=t.strokeWidth,a=void 0===o?0:o,s=t.textAnchor,u=void 0===s?"center":s,l=t.textAllowOverlap,c=void 0!==l&&l,h=t.halo,p=void 0===h?.5:h,f=t.gamma,d=void 0===f?2:f,m=t.usage,g=t.color,y=void 0===g?"#fff":g,v=t.size,_=void 0===v?1:v,x=this.fontService,w=x.canvas,S=x.mapping;return Object.keys(S).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(S).length),this.preTextStyle={textAnchor:u,textAllowOverlap:c},{u_opacity:(0,E.isNumber)(n)?n:1,u_stroke_width:(0,E.isNumber)(a)?a:1,u_stroke_color:this.getStrokeColor(i),u_sdf_map:this.texture,u_halo_blur:p,u_gamma_scale:d,u_sdf_map_size:[w.width,w.height],u_color:"basemap"===m?(0,b.rgb2arr)(y):[0,0,0,0],u_size:"basemap"===m?_:1}}},{key:"initModels",value:function(t){this.extent=this.textExtent();var e=this.layer.getLayerConfig(),n=e.textAnchor,r=void 0===n?"center":n,i=e.textAllowOverlap,o=void 0===i||i;this.preTextStyle={textAnchor:r,textAllowOverlap:o},this.buildModels(t)}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().usage;this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:i.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[5],n[6]]}}}),"basemap"!==t&&this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?12:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:i.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return(0,b.padBounds)(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(t){var e,n=t.shape,r=void 0===n?"":n,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ze(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ze(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(r=r.toString());try{for(i.s();!(e=i.n()).done;){var o=e.value;-1===a.indexOf(o)&&a.push(o)}}catch(t){i.e(t)}finally{i.f()}})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!1})}},{key:"generateGlyphLayout",value:function(){var t=this,e=this.fontService.mapping,n=this.layer.getLayerConfig(),r=n.spacing,i=void 0===r?2:r,o=n.textAnchor,a=void 0===o?"center":o,s=this.layer.getEncodedData();this.glyphInfo=s.map((function(n){var r=n.shape,o=void 0===r?"":r,s=n.id,u=n.size,l=void 0===u?1:u,c=n.textOffset,h=void 0===c?[0,0]:c,p=je(o.toString(),e,l,a,"left",i,h,!1),f=Ue(p,h,!1);return n.shaping=p,n.glyphQuads=f,n.centroid=(0,b.calculateCentroid)(n.coordinates),n.originCentroid="GAODE2.x"===n.version?(0,b.calculateCentroid)(n.originCoordinates):n.originCentroid=n.centroid,t.glyphInfoMap[s]={shaping:p,glyphQuads:f,centroid:(0,b.calculateCentroid)(n.coordinates)},n}))}},{key:"filterGlyphs",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.padding,r=void 0===n?[4,4]:n,i=e.textAllowOverlap;if(void 0===i||!i){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new ke(a,s);this.glyphInfo.filter((function(e){var n=e.shaping,i=e.id,o=void 0===i?0:i,a="GAODE2.x"===e.version?e.originCentroid:e.centroid,s=e.size/24,l=t.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length||(u.insertCollisionBox(c,o),0))})).forEach((function(e){t.glyphInfoMap[e.id]=e}))}}},{key:"initGlyph",value:function(){this.initTextFont(),this.generateGlyphLayout()}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.fontService.canvas;this.textureHeight=e.height,this.texture&&this.texture.destroy(),this.texture=t({data:e,mag:i.gl.LINEAR,min:i.gl.LINEAR,width:e.width,height:e.height})}},{key:"reBuildModel",value:function(){var t=this,e=this.layer.getLayerConfig().usage;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointTileText_"+e,vertexShader:"basemap"===e?We:Ge,fragmentShader:"basemap"===e?He:Ve,triangulation:qe.bind(this),depth:{enable:!1},blend:this.getBlend(),pick:"basemap"!==e}).then((function(e){t.layer.models=[e],t.layerService.throttleRenderLayers()})).catch((function(e){console.warn(e),t.layer.models=[]}))}}]),f}($);var Ye=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.strokeOpacity,i=void 0===r?1:r,o=t.strokeWidth,a=void 0===o?0:o,s=t.stroke,u=void 0===s?"rgba(0,0,0,0)":s;return{u_additive:"additive"===t.blend?1:0,u_opacity:Number(n),u_stroke_opacity:Number(i),u_stroke_width:Number(a),u_stroke_color:this.getStrokeColor(u)}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ot)}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.workerEnabled,r=void 0!==n&&n,i=e.usage;this.layer.triangulation=Ot,this.layer.buildLayerModel({moduleName:"pointTile_"+i,vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n// uniform vec2 u_tileOrigin;\n// uniform float u_coord;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  float newSize = setPickingSize(a_Size);\n\n  // cal style mapping\n\n  v_color = a_Color;\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, 0.0);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width));\n  offset = project_pixel(offset);\n\n  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n  }\n\n// if(u_coord > 0.0) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n  }\n// } else {\n\n  // vec2 pointPos = a_Position.xy;\n  // vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // 瓦片起始点的世界坐标\n\n  // vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // 瓦片内的点的偏移坐标\n  \n  // world.xy += offset;\n  // world.xy += pointOffset;\n\n  // if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n  //   // Needs to be divided with project_uCommonUnitsPerMeter\n  //   world.w *= u_PixelsPerMeter.z;\n  // }\n\n  // gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;\n// }\n\n \n  setPickingColor(a_PickingColor);\n\n\n}\n',fragmentShader:"uniform float u_additive;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",triangulation:Ot,depth:{enable:!1},cull:{enable:!0,face:(0,b.getCullFace)(this.mapService.version)},blend:this.getBlend(),workerEnabled:r,workerOptions:{modelType:"pointTile"},pick:"basemap"!==i}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:i.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var n=e.shape,r=void 0===n?2:n;return[t.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]),s}($);var Ke=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,o.Z)(this,i),r.apply(this,arguments)}return(0,a.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.usage,i=t.color,o=void 0===i?"#fff":i;return{u_opacity:n,u_color:"basemap"===r?(0,b.rgb2arr)(o):[0,0,0,0]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i,a=e.usage;this.layer.triangulation=Zt,this.layer.buildLayerModel({moduleName:"polygonTile_"+a,vertexShader:"basemap"===a?'attribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}':'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n// uniform vec2 u_tileOrigin;\n// uniform float u_coord;\n\nvarying vec4 v_color;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  // if(u_coord > 0.0) {\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n    } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n    }\n  // } else {\n  //   vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // 瓦片起始点的世界坐标\n\n  //   vec2 pointOffset = a_Position.xy *  pow(2.0, u_Zoom); // 瓦片内的点的偏移坐标\n    \n  //   world.xy += pointOffset;\n\n  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n  //     // Needs to be divided with project_uCommonUnitsPerMeter\n  //     world.w *= u_PixelsPerMeter.z;\n  //   }\n\n  //   gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;\n  // }\n\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:"basemap"===a?"uniform float u_opacity : 1.0;\nuniform vec4 u_color;\n\nvoid main() {\n  gl_FragColor = u_color;\n  gl_FragColor.a *= u_opacity;\n}\n":'uniform float u_opacity : 1.0;\nvarying vec4 v_color;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Zt,depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(r,o),pick:"basemap"!==a}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){}}]),i}($);var Qe=function(t){(0,u.Z)(h,t);var e,n,r,s=(n=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function h(){return(0,o.Z)(this,h),s.apply(this,arguments)}return(0,a.Z)(h,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?0:e,r=t.color,i=void 0===r?"#000":r;return{u_opacity:(0,E.isNumber)(n)?n:0,u_color:(0,b.rgb2arr)(i)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:(e=(0,p.Z)(v().mark((function t(e){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform float u_opacity : 1.0;\nuniform vec4 u_color;\n\nvoid main() {\n  gl_FragColor = u_color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:Zt,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:i.gl.ALWAYS,ref:1,mask:255},opFront:{fail:i.gl.REPLACE,zfail:i.gl.REPLACE,zpass:i.gl.REPLACE}},pick:!1}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"clearModels",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),h}($);function Je(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var $e=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"needListen",!0),(0,h.Z)((0,s.Z)(t),"isVector",!0),(0,h.Z)((0,s.Z)(t),"isTileLayer",!0),(0,h.Z)((0,s.Z)(t),"type",t.layerType||"vectorLayer"),(0,h.Z)((0,s.Z)(t),"pickedID",null),(0,h.Z)((0,s.Z)(t),"sourceEvent",(function(){t.dataState.dataSourceNeedUpdate=!0,t.reRender()})),t}return(0,a.Z)(p,[{key:"init",value:function(){var t=this,e=this.container.get(i.TYPES.SceneID);this.configService.setLayerConfig(e,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,"PointLayer"===this.type&&(this.iconService=this.container.get(i.TYPES.IIconService),this.fontService=this.container.get(i.TYPES.IFontService)),this.rendererService=this.container.get(i.TYPES.IRendererService),this.layerService=this.container.get(i.TYPES.ILayerService),this.mapService=this.container.get(i.TYPES.IMapService),this.cameraService=this.container.get(i.TYPES.ICameraService),this.coordinateService=this.container.get(i.TYPES.ICoordinateSystemService),this.shaderModuleService=this.container.get(i.TYPES.IShaderModuleService),this.postProcessingPassFactory=this.container.get(i.TYPES.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(i.TYPES.IFactoryNormalPass),this.styleAttributeService=this.container.get(i.TYPES.IStyleAttributeService),this.pendingStyleAttributes.forEach((function(e){var n=e.attributeName,r=e.attributeField,i=e.attributeValues,o=e.updateOptions;t.styleAttributeService.updateStyleAttribute(n,{scale:(0,d.Z)({field:r},t.splitValuesAndCallbackInAttribute(i,t.getLayerConfig()[n]))},o)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(i.TYPES.ILayerPlugin);var n,r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Je(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Je(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.plugins);try{for(r.s();!(n=r.n()).done;)n.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(t){r.e(t)}finally{r.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"renderModels",value:function(t){var e=this;return this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms()},t)})),this}},{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new e(this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return Ke;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();case"MaskLayer":return Qe;default:return Ye}}},{key:"getLineModel",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape");switch(null==e||null===(t=e.scale)||void 0===t?void 0:t.field){case"tileline":case"line":default:return Te;case"simple":return Ae}}},{key:"getPointModel",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig().shape2d,n=t.find((function(t){return t.hasOwnProperty("shape")}));if(n){var r=n.shape;return-1!==(null==e?void 0:e.indexOf(r))?Ye:Xe}return Ye}},{key:"getDefaultConfig",value:function(){return{}}}]),p}(H),tn=n(3959),en=n(9349);function nn(t){var e={type:"Feature"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}})),e.properties=rn(t.properties),e.geometry=on(t.geometry),e}function rn(t){var e={};return t?(Object.keys(t).forEach((function(n){var r=t[n];"object"==typeof r?null===r?e[n]=null:Array.isArray(r)?e[n]=r.map((function(t){return t})):e[n]=rn(r):e[n]=r})),e):e}function on(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map((function(t){return on(t)})),e):(e.coordinates=an(t.coordinates),e)}function an(t){var e=t;return"object"!=typeof e[0]?e.slice():e.map((function(t){return an(t)}))}const sn=function(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return nn(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}})),e.features=t.features.map((function(t){return nn(t)})),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return on(t);default:throw new Error("unknown GeoJSON type")}};var un=n(1691),ln={features:[],featureId:null,vectorTileLayer:null,source:null},cn=function(){function t(e){(0,o.Z)(this,t),(0,h.Z)(this,"outSideEventTimer",null),(0,h.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=e.parent,this.mapService=e.mapService,this.rendererService=e.rendererService;var n=this.parentLayer.getSource();this.zoomOffset=n.parser.zoomOffset||0,this.tilesetManager=n.tileset}return(0,a.Z)(t,[{key:"createTile",value:function(t,e){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(t,e){var n=e.sourceLayer,r=e.featureId,i=e.transforms,o=void 0===i?[]:i,a=e.layerType,s=e.shape;if(!n)return ln;var u=t.data.layers[n],l=null==u?void 0:u.features;if(Array.isArray(l)&&l.length>0){var c=[];"LineLayer"===a&&"simple"===s?l.map((function(t){var e=sn(t);if("MultiPolygon"===e.geometry.type){var n,r=(0,un.ZP)(e).features;(n=c).push.apply(n,(0,W.Z)(r))}else"Polygon"===e.geometry.type?(e.geometry.type="MultiLineString",c.push(e)):c.push(e)})):c=l;var h=new x.default({type:"FeatureCollection",features:c},{parser:{type:"geojson",featureId:r,cancelExtent:!0},transforms:o});return{features:c,featureId:r,vectorTileLayer:u,source:h}}return ln}},{key:"createLayer",value:function(t){var e=t.L7Layer,n=t.tile,r=t.initOptions,i=t.vectorTileLayer,o=t.source,a=t.needListen,s=void 0===a||a,u=r.mask,l=r.color,c=r.layerType,h=r.size,p=r.shape,f=r.usage,m=r.basemapColor,g=r.basemapSize,y=new(e||$e)((0,d.Z)({visible:n.isVisible,tileOrigin:null==i?void 0:i.l7TileOrigin,coord:null==i?void 0:i.l7TileCoord,needListen:s},this.getLayerInitOption(r)));if(c&&(y.type=c),y.isTileLayer=!0,y.isVector&&"basemap"!==f&&(this.emitEvent([y]),y.select(!0)),y.source(o),_e(y,this.parentLayer,"shape",p),"basemap"!==f?(function(t,e){var n=e.tileLayer.scaleField;Object.keys(n).map((function(e){t.scale(e,n[e])}))}(y,this.parentLayer),_e(y,this.parentLayer,"color",l),_e(y,this.parentLayer,"size",h)):y.style({color:m,size:g}),u&&y.isVector){var v=new $e({layerType:"MaskLayer"}).source({type:"FeatureCollection",features:[n.bboxPolygon]},{parser:{type:"geojson",cancelExtent:!0}});we(this.parentLayer,[v]),y.addMaskLayer(v)}return this.layers=[y],y}},{key:"updateStyle",value:function(t){return""}},{key:"getTile",value:function(t,e){var n=this.mapService.getZoom();return this.tilesetManager.getTileByLngLat(t,e,n)}},{key:"bindVectorEvent",value:function(t){var e=this;t.on("click",(function(t){e.eventCache.click=1,e.getFeatureAndEmitEvent("subLayerClick",t)})),t.on("mousemove",(function(t){e.eventCache.mousemove=1,e.getFeatureAndEmitEvent("subLayerMouseMove",t)})),t.on("mouseenter",(function(t){e.getFeatureAndEmitEvent("subLayerMouseEnter",t)}))}},{key:"readRasterTile",value:function(t,e){var n=t.lngLat,r=n.lng,i=n.lat,o=this.getTile(r,i);if(o){var a=function(t,e,n,r){var i,o,a,s,u=(null==t||null===(i=t.bboxPolygon)||void 0===i?void 0:i.bbox)||[0,0,10,-10],l=(0,I.Z)(u,4),c=l[0],h=void 0===c?0:c,p=l[1],f=void 0===p?0:p,d=l[2],m=void 0===d?10:d,g=l[3],y=void 0===g?-10:g,v=e.lngLatToContainer([h,f]),_=e.lngLatToContainer([m,y]),x=_.x-v.x,b=v.y-_.y,w=[(n-v.x)/x,(r-_.y)/b],S=(null==t||null===(o=t.data)||void 0===o?void 0:o.width)||1,E=(null==t||null===(a=t.data)||void 0===a?void 0:a.height)||1,C=Math.floor(w[0]*S),M=Math.floor(w[1]*E),T=Math.max(0,M-1)*S+C;return null==t||null===(s=t.data)||void 0===s?void 0:s.data[T]}(o,this.mapService,t.x,t.y);t.value=a,this.parentLayer.emit(e,t)}}},{key:"bindRasterEvent",value:function(t){var e=this;t.on("click",(function(t){e.eventCache.click=1,e.readRasterTile(t,"subLayerClick")})),t.on("mousemove",(function(t){e.eventCache.mousemove=1,e.readRasterTile(t,"subLayerMouseMove")})),t.on("mouseenter",(function(t){e.readRasterTile(t,"subLayerMouseMove")}))}},{key:"bindCommonEvent",value:function(t){var e=this;t.on("mouseup",(function(t){e.eventCache.mouseup=1,e.getFeatureAndEmitEvent("subLayerMouseUp",t)})),t.on("mouseout",(function(t){e.getFeatureAndEmitEvent("subLayerMouseOut",t)})),t.on("mousedown",(function(t){e.eventCache.mousedown=1,e.getFeatureAndEmitEvent("subLayerMouseDown",t)})),t.on("contextmenu",(function(t){e.eventCache.contextmenu=1,e.getFeatureAndEmitEvent("subLayerContextmenu",t)})),t.on("unclick",(function(n){return e.handleOutsideEvent("click","subLayerUnClick",t,n)})),t.on("unmouseup",(function(n){return e.handleOutsideEvent("mouseup","subLayerUnMouseUp",t,n)})),t.on("unmousedown",(function(n){return e.handleOutsideEvent("mousedown","subLayerUnMouseDown",t,n)})),t.on("uncontextmenu",(function(n){return e.handleOutsideEvent("contextmenu","subLayerUnContextmenu",t,n)}))}},{key:"emitEvent",value:function(t){var e=this;t.map((function(t){t.once("modelLoaded",(function(){e.bindVectorEvent(t),e.bindCommonEvent(t)}))}))}},{key:"emitRasterEvent",value:function(t){var e=this;t.map((function(t){t.once("modelLoaded",(function(){e.bindRasterEvent(t),e.bindCommonEvent(t)}))}))}},{key:"getCombineFeature",value:function(t){var e=null,n=t[0];return t.map((function(t){var n=tn.yu(t.coordinates);null===e&&(e=n),e=(0,en.Z)(e,n)})),n&&(e.properties=(0,d.Z)({},n)),e}},{key:"getFeatureAndEmitEvent",value:function(t,e){var n=e.featureId,r=this.getAllFeatures(n);try{e.feature=this.getCombineFeature(r)}catch(t){console.warn("Combine Featuer Err! Return First Feature!"),e.feature=r[0]}this.parentLayer.emit(t,e)}},{key:"getAllFeatures",value:function(t){var e=this.parentLayer.tileLayer.children,n=[];return e.map((function(e){e.getSource().data.dataArray.map((function(e){e._id===t&&n.push(e)}))})),n}},{key:"getLayerInitOption",value:function(t){var e=(0,d.Z)({},t);return delete e.color,delete e.shape,delete e.size,delete e.coords,delete e.sourceLayer,delete e.coords,e}},{key:"handleOutsideEvent",value:function(t,e,n,r){var i=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout((function(){i.eventCache[t]>0?i.eventCache[t]=0:i.getFeatureAndEmitEvent(e,r)}),64)}}]),t}();var hn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e;return(0,o.Z)(this,i),(e=r.call(this,t)).parentLayer=t.parent,e}return(0,a.Z)(i,[{key:"createTile",value:function(t,e){var n=this.getFeatureData(t,e),r=n.features,i=n.vectorTileLayer,o=n.source;if(0===r.length)return{layers:[],layerIDList:[]};var a=this.createLayer({tile:t,initOptions:e,vectorTileLayer:i,source:o});return{layers:[a],layerIDList:[a.id]}}}]),i}(cn);var pn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e;return(0,o.Z)(this,i),(e=r.call(this,t)).parentLayer=t.parent,e}return(0,a.Z)(i,[{key:"createTile",value:function(t,e){var n=this.getFeatureData(t,e),r=n.features,i=n.vectorTileLayer,o=n.source;if(0===r.length)return{layers:[],layerIDList:[]};var a=this.createLayer({tile:t,initOptions:e,vectorTileLayer:i,source:o,needListen:!1});return{layers:[a],layerIDList:[a.id]}}}]),i}(cn);var fn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e;return(0,o.Z)(this,i),(e=r.call(this,t)).parentLayer=t.parent,e}return(0,a.Z)(i,[{key:"createTile",value:function(t,e){var n=this.getFeatureData(t,e),r=n.features,i=n.vectorTileLayer,o=n.source;if(0===r.length)return{layers:[],layerIDList:[]};var a=this.createLayer({tile:t,initOptions:e,vectorTileLayer:i,source:o});return{layers:[a],layerIDList:[a.id]}}}]),i}(cn);var dn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e;return(0,o.Z)(this,i),(e=r.call(this,t)).parentLayer=t.parent,e}return(0,a.Z)(i,[{key:"createTile",value:function(t,e){var n=this.getFeatureData(t,e),r=n.features,i=n.vectorTileLayer,o=n.source;if(0===r.length)return{layers:[],layerIDList:[]};var a=this.createLayer({tile:t,initOptions:e,vectorTileLayer:i,source:o,needListen:!1});return{layers:[a],layerIDList:[a.id]}}}]),i}(cn);var mn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e;return(0,o.Z)(this,i),(e=r.call(this,t)).parentLayer=t.parent,e}return(0,a.Z)(i,[{key:"createTile",value:function(t,e){var n=new x.default(t.data,{parser:{type:"image",extent:t.bounds}}),r=this.createLayer({L7Layer:ye,tile:t,initOptions:e,source:n});return{layers:[r],layerIDList:[r.id]}}}]),i}(cn);var gn=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.rendererService.createTexture2D,e=this.layer.getLayerConfig(),n=e.colorTexture,r=void 0===n?t({data:[],width:0,height:0,flipY:!1}):n,i=e.opacity,o=void 0===i?1:i,a=e.clampLow,s=void 0===a||a,u=e.clampHigh,l=void 0===u||u,c=e.noDataValue,h=void 0===c?-9999999:c,p=e.domain,f=void 0===p?[0,1]:p;return{u_opacity:o||1,u_texture:this.texture,u_domain:f,u_clampLow:s,u_clampHigh:void 0!==l?l:s,u_noDataValue:h,u_colorTexture:r}}},{key:"initModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o,s=this.layer.getSource(),u=this.rendererService.createTexture2D,l=s.data.dataArray[0];this.texture=u({data:l.data,width:l.width,height:l.height,format:i.gl.LUMINANCE,type:i.gl.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterTileImageData",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\n\n\n\n// float getBlurIndusty() {\n//   vec2 u_ViewportSize = vec2(1024);\n\n//     float vW = 2.0/u_ViewportSize.x;\n//     float vH = 2.0/u_ViewportSize.y;\n//     vec2 vUv = v_texCoord;\n//     float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n//     float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n//     float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n//     float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n//     float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\n//     float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n//     float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n//     float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n//     float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n//     return(\n//         i11 + \n//         i12 + \n//         i13 + \n//         i21 + \n//         i21 + \n//         i22 + \n//         i23 + \n//         i31 + \n//         i32 + \n//         i33\n//         )/9.0;\n// }\n\nvoid main() {\n\n  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\n\n  // float value = getBlurIndusty();\n\n\n  if (value == u_noDataValue)\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n    gl_FragColor = vec4(0, 0, 0, 0);\n  else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\n    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n  }\n}\n",triangulation:qt,depth:{enable:!1},stencil:(0,b.getMask)(r,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),s}($);var yn=function(t){(0,u.Z)(m,t);var e,n,r,f,d=(r=m,f=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(r);if(f){var n=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function m(){var t;(0,o.Z)(this,m);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=d.call.apply(d,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"channelRMax",256),(0,h.Z)((0,s.Z)(t),"channelGMax",256),(0,h.Z)((0,s.Z)(t),"channelBMax",256),t}return(0,a.Z)(m,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.channelRMax,i=t.channelGMax,o=t.channelBMax;return{u_opacity:n||1,u_texture:this.texture,u_channelRMax:void 0!==r?r:this.channelRMax,u_channelGMax:void 0!==i?i:this.channelGMax,u_channelBMax:void 0!==o?o:this.channelBMax}}},{key:"getRasterData",value:(n=(0,p.Z)(v().mark((function t(e){var n,r,i,o,a,s,u;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Array.isArray(e.data)){t.next=4;break}return t.abrupt("return",{data:e.data,width:e.width,height:e.height});case 4:return t.next=6,e.data;case 6:return n=t.sent,r=n.rasterData,i=n.width,o=n.height,a=n.channelR,s=n.channelG,u=n.channelB,this.channelRMax=a,this.channelGMax=s,this.channelBMax=u,t.abrupt("return",{data:Array.from(r),width:i,height:o});case 17:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"initModels",value:(e=(0,p.Z)(v().mark((function t(e){var n,r,o,a,s,u,l,c,h,p,f,d;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.layer.getLayerConfig(),r=n.mask,o=void 0!==r&&r,a=n.maskInside,s=void 0===a||a,u=this.layer.getSource(),l=this.rendererService.createTexture2D,c=u.data.dataArray[0],t.next=6,this.getRasterData(c);case 6:h=t.sent,p=h.data,f=h.width,d=h.height,this.texture=l({data:p,width:f,height:d,format:i.gl.RGB,type:i.gl.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform float u_channelRMax: 256.;\nuniform float u_channelGMax: 256.;\nuniform float u_channelBMax: 256.;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;\n  gl_FragColor = vec4(rgb.r/u_channelRMax, rgb.g/u_channelGMax, rgb.b/u_channelBMax, u_opacity);\n}",triangulation:qt,primitive:i.gl.TRIANGLES,depth:{enable:!1},stencil:(0,b.getMask)(o,s)}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}));case 12:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),m}($);var vn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type",t.layerType),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new e(this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"getModelType",value:function(){return"rasterRgb"===this.layerSource.parser.type?yn:gn}},{key:"getDefaultConfig",value:function(){return{}}}]),i}(H);var _n=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e;return(0,o.Z)(this,i),(e=r.call(this,t)).parentLayer=t.parent,e}return(0,a.Z)(i,[{key:"createTile",value:function(t,e){var n,r,i,o=e.colorTexture,a=e.opacity,s=e.domain,u=e.clampHigh,l=e.clampLow,c=e.mask,h=t.data;if(!h.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var p=null===(n=this.parentLayer)||void 0===n||null===(r=n.getSource())||void 0===r||null===(i=r.parser)||void 0===i?void 0:i.dataType,f=new vn({visible:t.isVisible,mask:c}).source(h.data,{parser:{type:"rgb"===p?"rasterRgb":"raster",width:h.width,height:h.height,extent:t.bboxPolygon.bbox}}).style({colorTexture:o,opacity:a,domain:s,clampHigh:u,clampLow:l});return this.emitRasterEvent([f]),{layers:[f],layerIDList:[f.id]}}}]),i}(cn);var xn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e;return(0,o.Z)(this,i),(e=r.call(this,t)).parentLayer=t.parent,e}return(0,a.Z)(i,[{key:"createTile",value:function(t,e){var n=e.sourceLayer;if(!n)return{layers:[],layerIDList:[]};var r=t.data.layers[n],i=null==r?void 0:r.features;if(0===i.length)return{layers:[],layerIDList:[]};var o=i[0].properties,a=new $e({layerType:"PointLayer",usage:"basemap",needListen:!1}).source([o],{parser:{type:"json",x:"textLng",y:"textLat",cancelExtent:!0}}).shape("key","text").style({size:20,color:"#000",stroke:"#fff",strokeWidth:2}),s=new $e({layerType:"LineLayer",usage:"basemap",needListen:!1}).source({type:"FeatureCollection",features:i},{parser:{type:"geojson",cancelExtent:!0}}).shape("simple").style({color:"#000"});return{layers:[s,a],layerIDList:[s.id,a.id]}}}]),i}(cn),bn=function(){function t(){(0,o.Z)(this,t),(0,h.Z)(this,"tileCache",new Map)}return(0,a.Z)(t,[{key:"hasTile",value:function(t){return!!this.tileCache.has(t.key)}},{key:"addTile",value:function(t){var e;if(this.hasTile(t))return{layers:[],layerIDList:[]};this.tileCache.set(t.key,t);var n=this.tileFactory.createTile(t,this.initOptions);return we(this.parent,n.layers),(e=t.layerIDList).push.apply(e,(0,W.Z)(n.layerIDList)),this.addChildren(n.layers),n.layers.map((function(e){e.once("modelLoaded",(function(){t.layerLoad()}))})),n}},{key:"removeTile",value:function(t){this.tileCache.delete(t.key),this.removeChildren(t.layerIDList,!1)}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"addChildren",value:function(t){var e;(e=this.children).push.apply(e,(0,W.Z)(t))}},{key:"removeChildren",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=[];this.children.filter((function(e){t.includes(e.id)?n.push(e):r.push(e)})),n.map((function(t){return t.destroy(e)})),this.children=r}},{key:"removeChild",value:function(t){var e=this.children.indexOf(t);e>-1&&this.children.splice(e,1),t.destroy()}},{key:"getChildren",value:function(t){return this.children.filter((function(e){return t.includes(e.id)}))}},{key:"getChild",value:function(t){return this.children.filter((function(e){return e.id===t}))[0]}},{key:"clearChild",value:function(){this.children.forEach((function(t){t.destroy()})),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(t){return this.children.includes(t)}},{key:"initTileFactory",value:function(){var t=this.parent.getSource(),e=function(t,e){switch(t){case"PolygonLayer":return fn;case"LineLayer":return hn;case"PointLayer":return pn;case"MaskLayer":return dn;case"TileDebugLayer":return xn;case"RasterLayer":return x.rasterDataTypes.includes(e.dataType)?_n:mn;default:return console.warn("Current Tile Not Exist!"),mn}}(this.parent.type,t.parser);this.tileFactory=new e({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}},{key:"getSourceLayer",value:function(t,e){return"geojsonvt"===t?"geojsonvt":"testTile"===t?"testTile":e}},{key:"destroy",value:function(){}}]),t}();var wn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;return(0,o.Z)(this,i),t=r.call(this),(0,h.Z)((0,s.Z)(t),"checkConfigList",[]),t.cacheConfig=new Map,t}return(0,a.Z)(i,[{key:"setConfig",value:function(t,e){this.checkConfigList.includes(t)||this.checkConfigList.push(t),this.cacheConfig.set(t,e)}},{key:"removeConfig",value:function(t){var e=this.checkConfigList.indexOf(t);e>-1&&(this.cacheConfig.delete(t),this.checkConfigList.splice(e,1))}},{key:"checkConfig",value:function(t){var e=this;if(t.inited){var n=t.getLayerConfig(),r=[];this.checkConfigList.map((function(i){var o,a=e.cacheConfig.get(i);if(["color","size","shape"].includes(i)){var s;o=null===(s=t.getAttribute(i))||void 0===s?void 0:s.scale}else{if(!(i in n))return;o=n[i]}(0,E.isEqual)(a,o)||(r.push(i),e.setConfig(i,o))})),r.length>0&&(console.warn("tile config cache update!",r),this.emit("updateConfig",r))}}},{key:"getAttributeScale",value:function(t,e){var n=t.getAttribute(e),r={field:void 0,values:void 0,callback:void 0};if(n&&n.scale){var i=n.scale,o=i.field,a=i.values,s=i.callback;r.field=o,r.values=a,r.callback=s}return r}}]),i}(S());var Sn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t,e,n,a,u){var l;return(0,o.Z)(this,i),l=r.call(this),(0,h.Z)((0,s.Z)(l),"isLastPicked",!1),l.parent=t,l.rendererService=e,l.pickingService=n,l.children=a,l.tileRenderService=u,l}return(0,a.Z)(i,[{key:"pick",value:function(t,e){var n=this;this.tileRenderService.renderMask(this.parent);var r=t.filter((function(t){return n.parent.needPick(e.type)&&t.inited&&t.isVisible()})).some((function(t){t.hooks.beforePickingEncode.call(),t.masks.length>0&&(n.rendererService.clear({stencil:0,depth:1,framebuffer:null}),t.masks.map((function(t){t.hooks.beforeRender.call(),t.render(),t.hooks.afterRender.call()}))),t.renderModels(!0),t.hooks.afterPickingEncode.call();var r=n.pickingService.pickFromPickingFBO(t,e);return r&&"RasterLayer"!==n.parent.type&&(n.emit("pick",{type:e.type,pickedColors:n.pickingService.pickedColors,layer:t}),n.pickingService.pickedTileLayers=[n.parent]),r}));return"RasterLayer"!==this.parent.type&&!r&&this.isLastPicked&&"click"!==e.type&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=r,r}},{key:"clearPick",value:function(){this.children.filter((function(t){return t.inited&&t.isVisible()})).map((function(t){t.hooks.beforeSelect.call([0,0,0])})),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(t){this.children.filter((function(t){return t.inited&&t.isVisible()})).map((function(e){e.hooks.beforeHighlight.call(t)}))}},{key:"beforeSelect",value:function(t){this.children.filter((function(t){return t.inited&&t.isVisible()})).map((function(e){e.hooks.beforeSelect.call(t)}))}},{key:"destroy",value:function(){this.removeAllListeners()}}]),i}(w.EventEmitter),En=function(){function t(e){(0,o.Z)(this,t),this.rendererService=e}return(0,a.Z)(t,[{key:"render",value:function(t){var e=this;t.filter((function(t){return t.inited})).filter((function(t){return t.isVisible()})).map((function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.masks.length>0&&(e.rendererService.clear({stencil:0,depth:1,framebuffer:null}),t.masks.map((function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.render(),t.hooks.afterRender.call()}))),t.render(),t.hooks.afterRender.call()}))}},{key:"renderMask",value:function(t){t.inited&&t.isVisible()&&t.masks.length>0&&(t.hooks.beforeRender.call(),this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),t.masks.map((function(t){t.hooks.beforeRender.call(),t.render(),t.hooks.afterRender.call()})),t.hooks.afterRender.call())}}]),t}(),Cn=["size","color","shape"],Mn=["opacity","zIndex"],Tn=["mask","rampColors","domain","clampHigh","clampLow","pixelConstant","pixelConstantR","pixelConstantG","pixelConstantB","pixelConstantRGB"].concat(Mn),An={PointLayer:["stroke","strokeWidth","strokeOpacity","color","shape","size"].concat(Mn),LineLayer:["stroke","strokeWidth","strokeOpacity","color","shape","size"].concat(Mn),PolygonLayer:["color","shape"].concat(Mn),RasterLayer:Tn,MaskLayer:[],TileDebugLayer:[]};var Pn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t,e,n,a,s){var u;return(0,o.Z)(this,i),(u=r.call(this)).parent=t,u.children=t.layerChildren,u.mapService=e,u.rendererService=n,u.transforms=s,u.tileRenderService=new En(n),u.tilePickService=new Sn(t,n,a,u.children,u.tileRenderService),u.tileStyleService=new wn,u.setSubLayerInitOption(),u.setConfigListener(),u.initTileFactory(),u}return(0,a.Z)(i,[{key:"render",value:function(){this.tileStyleService.checkConfig(this.parent),this.tileRenderService.render(this.children)}},{key:"pickLayers",value:function(t){return this.tilePickService.pick(this.children,t)}},{key:"setSubLayerInitOption",value:function(){var t,e=this.parent.getLayerConfig(),n=e.zIndex,r=void 0===n?0:n,i=e.opacity,o=void 0===i?1:i,a=e.mask,s=void 0!==a&&a,u=e.stroke,l=void 0===u?"#fff":u,c=e.strokeWidth,h=void 0===c?0:c,p=e.strokeOpacity,f=void 0===p?1:p,d=e.clampLow,m=void 0===d||d,g=e.clampHigh,y=void 0===g||g,v=e.domain,_=void 0===v?[0,1]:v,x=e.rampColors,w=void 0===x?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:x,S=e.featureId,E=void 0===S?"id":S,C=e.workerEnabled,M=void 0!==C&&C,T=e.sourceLayer,A=e.pixelConstant,P=void 0===A?0:A,L=e.pixelConstantR,I=void 0===L?65536:L,k=e.pixelConstantG,O=void 0===k?256:k,R=e.pixelConstantB,D=void 0===R?1:R,N=e.pixelConstantRGB,F=void 0===N?.1:N,z=this.tileStyleService.getAttributeScale(this.parent,"color"),B=this.tileStyleService.getAttributeScale(this.parent,"size"),j=this.parent.getSource(),U=((null==j||null===(t=j.data)||void 0===t?void 0:t.tilesetOptions)||{}).coords,Z=j.getParserType(),V=Se(this.parent.type,this.parent);if(this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:V,zIndex:r,opacity:o,sourceLayer:this.getSourceLayer(Z,T),coords:U,featureId:E,color:z,size:B,mask:Ee(this.parent.type,s),stroke:l,strokeWidth:h,strokeOpacity:f,clampLow:m,clampHigh:y,domain:_,rampColors:w,workerEnabled:M,pixelConstant:P,pixelConstantR:I,pixelConstantG:O,pixelConstantB:D,pixelConstantRGB:F},w){var G=this.rendererService.createTexture2D,H=(0,b.generateColorRamp)(w),W=G({data:H.data,width:H.width,height:H.height,flipY:!1});this.initOptions.colorTexture=W}}},{key:"getInitOptionValue",value:function(t){var e,n,r;switch(t){case"color":return null===(e=this.parent.getAttribute("color"))||void 0===e?void 0:e.scale;case"shape":return null===(n=this.parent.getAttribute("shape"))||void 0===n?void 0:n.scale;case"size":return null===(r=this.parent.getAttribute("size"))||void 0===r?void 0:r.scale;default:return this.initOptions[t]}}},{key:"setInitOptionValue",value:function(t,e){this.initOptions[t]=e}},{key:"setConfigListener",value:function(){var t=this;(An[this.parent.type]||[]).map((function(e){t.tileStyleService.setConfig(e,t.getInitOptionValue(e))})),this.tileStyleService.on("updateConfig",(function(e){e.map((function(e){return t.updateStyle(e)}))}))}},{key:"updateAttribute",value:function(t){var e=this;if(Cn.includes(t)){var n,r=null===(n=this.parent.getAttribute(t))||void 0===n?void 0:n.scale;if(!r)return;this.children.map((function(n){return _e(n,e.parent,t,r)}))}}},{key:"updateStyle",value:function(t){var e=null;if(Cn.includes(t))this.updateAttribute(t);else{var n=this.parent.getLayerConfig();if(!(t in n))return;var r=n[t];if(e=r,"rampColors"===t){var i=function(t,e,n){var r=n.createTexture2D,i=(0,b.generateColorRamp)(t),o=r({data:i.data,width:i.width,height:i.height,flipY:!1});return e.map((function(t){t.updateLayerConfig({colorTexture:o})})),o}(r,this.children,this.rendererService);this.initOptions.colorTexture=i}else ve(this.children,t,r)}this.setInitOptionValue(t,e)}},{key:"destroy",value:function(){this.tilePickService.destroy()}}]),i}(bn),Ln=function(){function t(){(0,o.Z)(this,t),(0,h.Z)(this,"initedTileset",!1),(0,h.Z)(this,"viewchange",(0,E.debounce)(this.mapchange,200))}return(0,a.Z)(t,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"mapchange",value:function(){var t,e=this.getCurrentView(),n=e.latLonBounds,r=e.zoom;if("GAODE1.x"===this.mapService.version){var i=this.parent.getLayerConfig().visible;r<3&&i?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):r>=3&&!i&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===r&&this.lastViewStates.latLonBounds.toString()===n.toString()||(this.lastViewStates={zoom:r,latLonBounds:n},null===(t=this.tilesetManager)||void 0===t||t.throttleUpdate(r,n))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds();return{latLonBounds:[t[0][0],t[0][1],t[1][0],t[1][1]],zoom:this.mapService.getZoom()}}},{key:"initTileSetManager",value:function(){var t,e=this.parent.getSource();this.tilesetManager=e.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(t=this.tilesetManager)||void 0===t||t.update(i,r)}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager&&(this.tilesetManager.on("tile-loaded",(function(t){})),this.tilesetManager.on("tile-unload",(function(e){t.tileUnLoad(e)})),this.tilesetManager.on("tile-error",(function(e,n){t.tileError(e)})),this.tilesetManager.on("tile-update",(function(){t.tileUpdate()})),this.mapService.on("zoomend",(function(){return t.viewchange()})),this.mapService.on("moveend",(function(){return t.viewchange()})))}},{key:"render",value:function(){this.tileLayerManager.render()}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;null===(t=this.tilesetManager)||void 0===t||t.destroy(),this.tileLayerManager.destroy()}},{key:"tileUnLoad",value:function(t){this.tileLayerManager.removeTile(t)}},{key:"tileUpdate",value:function(){var t=this;this.tilesetManager&&(this.tilesetManager.tiles.filter((function(t){return t.isLoaded})).map((function(e){if(t.isTileReady(e))if(t.tileLayerManager.hasTile(e)){if(!e.isVisibleChange)return;var n=t.tileLayerManager.getChildren(e.layerIDList);Me(e,n,t.layerService),t.setPickState(n)}else{var r=t.tileLayerManager.addTile(e).layers;t.setPickState(r)}})),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"isTileReady",value:function(t){var e;if(null!==(e=t.data)&&void 0!==e&&e.layers&&this.sourceLayer){var n=t.data.layers[this.sourceLayer],r=null==n?void 0:n.features;if(!(Array.isArray(r)&&r.length>0))return!1}return!0}},{key:"setPickState",value:function(t){}}]),t}();function In(t,e){var n=(0,I.Z)(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeSelect.call([r,i,o])}var kn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e,n,a=t.parent,u=t.rendererService,l=t.mapService,c=t.layerService,p=t.pickingService,f=t.transforms;(0,o.Z)(this,i),n=r.call(this),(0,h.Z)((0,s.Z)(n),"pickColors",{select:null,active:null});var d=a.getSource(),m=((null==d||null===(e=d.data)||void 0===e?void 0:e.tilesetOptions)||{}).sourceLayer;return n.sourceLayer=m,n.parent=a,n.mapService=l,n.layerService=c,n.tileLayerManager=new Pn(a,l,u,p,f),n.initTileSetManager(),n.bindSubLayerEvent(),n.bindSubLayerPick(),n.scaleField=n.parent.getScaleOptions(),n}return(0,a.Z)(i,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"clearPick",value:function(t){"mousemove"===t&&this.tileLayerManager.tilePickService.clearPick()}},{key:"clearPickState",value:function(){this.children.filter((function(t){return t.inited&&t.isVisible()})).filter((function(t){return null!==t.getCurrentSelectedId()})).map((function(t){In(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)}))}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"setPickState",value:function(t){!function(t,e){e.select&&t.map((function(t){In(t,e.select)})),e.active&&t.filter((function(t){return t.inited&&t.isVisible()})).map((function(t){t.hooks.beforeHighlight.call(e.active)}))}(t,this.pickColors)}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickService.on("pick",(function(e){var n,r,i,o=(0,I.Z)(e.pickedColors,3),a=o[0],s=o[1],u=o[2];if("click"===e.type){var l=function(t,e,n){var r,i=(0,b.decodePickingColor)(e);return t.map((function(t){null===t.getCurrentSelectedId()||i!==t.getCurrentSelectedId()?(In(t,e),t.setCurrentSelectedId(i),r=e):(In(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null),r=null)})),n.filter((function(t){return t.inited&&!t.isVector&&t.isVisible()&&t.needPick("click")})).filter((function(t){return null!==t.getCurrentSelectedId()})).map((function(t){In(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)})),r}(t.children.filter((function(t){return t.inited&&t.isVisible()&&t.isVector})).filter((function(t){return t!==e.layer})),[a,s,u],t.layerService.getRenderList());t.pickColors.select=l}else n=t.children,r=[a,s,u],i=(0,b.decodePickingColor)(r),n.filter((function(t){return t.inited&&t.isVisible()&&t.isVector})).filter((function(t){return t.getPickID()!==i})).map((function(t){t.setPickID(i),t.hooks.beforeHighlight.call(r)})),t.pickColors.active=[a,s,u]})),this.tileLayerManager.tilePickService.on("unpick",(function(){t.pickColors.active=null}))}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",(function(e){t.parent.emit("click",(0,d.Z)({},e))})),this.parent.on("subLayerMouseMove",(function(e){return t.parent.emit("mousemove",(0,d.Z)({},e))})),this.parent.on("subLayerMouseUp",(function(e){return t.parent.emit("mouseup",(0,d.Z)({},e))})),this.parent.on("subLayerMouseEnter",(function(e){return t.parent.emit("mouseenter",(0,d.Z)({},e))})),this.parent.on("subLayerMouseOut",(function(e){return t.parent.emit("mouseout",(0,d.Z)({},e))})),this.parent.on("subLayerMouseDown",(function(e){return t.parent.emit("mousedown",(0,d.Z)({},e))})),this.parent.on("subLayerContextmenu",(function(e){return t.parent.emit("contextmenu",(0,d.Z)({},e))})),this.parent.on("subLayerUnClick",(function(e){return t.parent.emit("unclick",(0,d.Z)({},e))})),this.parent.on("subLayerUnMouseMove",(function(e){return t.parent.emit("unmousemove",(0,d.Z)({},e))})),this.parent.on("subLayerUnMouseUp",(function(e){return t.parent.emit("unmouseup",(0,d.Z)({},e))})),this.parent.on("subLayerUnMouseDown",(function(e){return t.parent.emit("unmousedown",(0,d.Z)({},e))})),this.parent.on("subLayerUnContextmenu",(function(e){return t.parent.emit("uncontextmenu",(0,d.Z)({},e))}))}}]),i}(Ln);var On=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t,e,n){var a;return(0,o.Z)(this,i),(a=r.call(this)).parent=t,a.children=t.layerChildren,a.mapService=e,a.rendererService=n,a.setSubLayerInitOption(),a.initTileFactory(),a}return(0,a.Z)(i,[{key:"render",value:function(){var t=this;this.children.filter((function(t){return t.inited})).filter((function(t){return t.isVisible()})).map((function(e){e.hooks.beforeRenderData.call(),e.hooks.beforeRender.call(),e.masks.length>0&&(t.rendererService.clear({stencil:0,depth:1,framebuffer:null}),e.masks.map((function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.render(),t.hooks.afterRender.call()}))),e.render(),e.hooks.afterRender.call()}))}},{key:"setSubLayerInitOption",value:function(){var t,e,n=this.parent.getLayerConfig(),r=n.zIndex,i=void 0===r?0:r,o=n.opacity,a=void 0===o?1:o,s=n.mask,u=void 0!==s&&s,l=n.stroke,c=void 0===l?"#fff":l,h=n.strokeWidth,p=void 0===h?0:h,f=n.strokeOpacity,d=void 0===f?1:f,m=n.workerEnabled,g=void 0!==m&&m,y=n.sourceLayer,v=this.parent.getSource().getParserType(),_=this.parent.getAttribute("color"),x=(null==_||null===(t=_.scale)||void 0===t?void 0:t.field)||"#fff",b=this.parent.getAttribute("size"),w=(null==b||null===(e=b.scale)||void 0===e?void 0:e.field)||1,S=Se(this.parent.type,this.parent);this.initOptions={usage:"basemap",layerType:this.parent.type,shape:S,zIndex:i,opacity:a,sourceLayer:this.getSourceLayer(v,y),basemapColor:x,basemapSize:w,mask:Ee(this.parent.type,u),stroke:c,strokeWidth:p,strokeOpacity:d,workerEnabled:g}}}]),i}(bn);var Rn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e,n,a=t.parent,s=t.rendererService,u=t.mapService,l=t.layerService;(0,o.Z)(this,i),n=r.call(this);var c=a.getSource(),h=((null==c||null===(e=c.data)||void 0===e?void 0:e.tilesetOptions)||{}).sourceLayer;return n.sourceLayer=h,n.parent=a,n.mapService=u,n.layerService=l,n.tileLayerManager=new On(a,u,s),n.initTileSetManager(),n}return(0,a.Z)(i)}(Ln);var Dn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,o.Z)(this,i),r.apply(this,arguments)}return(0,a.Z)(i,[{key:"getUninforms",value:function(){return{}}},{key:"getTileLayer",value:function(t){return"basemap"===t?Rn:kn}},{key:"initModels",value:function(){var t=this.layer.getSource(),e=this.layer.getLayerConfig().usage;if(null!=t&&t.data.isTile&&!this.layer.tileLayer){var n=this.getTileLayer(e);this.layer.tileLayer=new n({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:t.transforms})}return this.buildModels()}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),i}($);var Nn={solid:0,dash:1},Fn=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,h=void 0===c?[10,5]:c,p=t.forward,f=void 0===p||p,d=t.lineTexture,m=void 0!==d&&d,g=t.iconStep,y=void 0===g?100:g,v=t.segmentNumber,_=void 0===v?30:v,x=t.thetaOffset,w=void 0===x?.314:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,thetaOffset:w})){this.judgeStyleAttributes({opacity:n,thetaOffset:w});var S=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,S,this.cellProperties),M=C.data,T=C.width,A=C.height;this.rowCount=A,this.dataTexture=this.cellLength>0&&M.length>0?this.createTexture2D({flipY:!0,data:M,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:T,height:A}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}2===h.length&&h.push(0,0);var P=0,L=[0,0,0,0],I=[0,0,0,0];return r&&o&&(L=(0,b.rgb2arr)(r),I=(0,b.rgb2arr)(o),P=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,E.isNumber)(w)?w:0,u_opacity:(0,E.isNumber)(n)?n:1,u_textureBlend:"normal"===s?0:1,segmentNumber:_,u_line_type:Nn[l||"solid"],u_dash_array:h,u_blur:.9,u_lineDir:f?1:-1,u_texture:this.texture,u_line_texture:m?1:0,u_icon_step:y,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:P,u_sourceColor:L,u_targetColor:I}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return"dash"===t.lineType?{frag:'\nuniform float u_opacity;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float segmentNumber;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_distance_ratio = styleMappingMat[3].b; // 当前顶点在弧线中所处的分段比例\n\n  gl_FragColor = v_color;\n  gl_FragColor.a *= opacity;\n\n  float flag = 0.;\n  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    flag = 1.;\n  };\n  gl_FragColor.a *=flag;\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\n\n\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\n\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n  // dash: index / (segmentNumber - 1.);\n  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = thetaOffsetAndOffset.r;\n  textureOffset = thetaOffsetAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 s = source;\n  vec2 t = target;\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    s = unProjCustomCoord(source);\n    t = unProjCustomCoord(target);\n  }\n  float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n\n  styleMappingMat[3].b = segmentIndex / segmentNumber;\n\n  // styleMappingMat[0][1] - arcThetaOffset\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  gl_PointSize = 5.0;\n  setPickingColor(a_PickingColor);\n}\n',type:"Dash"}:e&&n?{frag:'#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_segmentIndex = styleMappingMat[3].r;   // 当前顶点在弧线中所处的分段位置\n\n  // 设置弧线的底色\n  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = thetaOffsetAndOffset.r;\n  textureOffset = thetaOffsetAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n\n   styleMappingMat[3].b = d_distance_ratio;\n\n  // styleMappingMat[0][1] - arcThetaOffset\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n  styleMappingMat[3].r = d_segmentIndex;\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_segmentIndex = styleMappingMat[3].r;   // 当前顶点在弧线中所处的分段位置\n  float d_distance_ratio = styleMappingMat[3].b; // 当前顶点在弧线中所处的分段比例\n\n  gl_FragColor = v_color;\n  \n  gl_FragColor.a *= opacity;\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = styleMappingMat[3].g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = styleMappingMat[3].a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n    \n  } else {\n     gl_FragColor = filterColor(gl_FragColor);\n  }\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    // dash: index / (segmentNumber - 1.);\n    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = thetaOffsetAndOffset.r;\n  textureOffset = thetaOffsetAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  \n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n   styleMappingMat[3].b = d_distance_ratio;\n\n  // styleMappingMat[0][1] - arcThetaOffset\n  float arcThetaOffset = styleMappingMat[0][1];\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n  styleMappingMat[3].r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n     styleMappingMat[3].g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.segmentNumber,r=void 0===n?30:n,i=e.mask,o=void 0!==i&&i,a=e.maskInside,s=void 0===a||a,u=this.getShaders(),l=u.frag,c=u.vert,h=u.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+h,vertexShader:c,fragmentShader:l,triangulation:Xt,depth:{enable:!1},blend:this.getBlend(),segmentNumber:r,stencil:(0,b.getMask)(o,s)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),p}($);var zn={solid:0,dash:1},Bn=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,h=void 0===c?[10,5]:c,p=t.lineTexture,f=void 0!==p&&p,d=t.iconStep,m=void 0===d?100:d,g=t.segmentNumber,y=void 0===g?30:g,v=t.globalArcHeight,_=void 0===v?10:v;2===h.length&&h.push(0,0);var x=0,w=[0,0,0,0],S=[0,0,0,0];if(r&&o&&(w=(0,b.rgb2arr)(r),S=(0,b.rgb2arr)(o),x=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var C=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,C,this.cellProperties),T=M.data,A=M.width,P=M.height;this.rowCount=P,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:A,height:P}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:at,u_global_height:_,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(n)?n:1,u_textureBlend:"normal"===s?0:1,segmentNumber:y,u_line_type:zn[l]||0,u_dash_array:h,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:x,u_sourceColor:w,u_targetColor:S}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:'\n#define Animate 0.0\n\nuniform float u_opacity;\nuniform float u_blur : 0.9;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nvarying mat4 styleMappingMat;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].g; // 当前点位距离占线总长的比例\n\n  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);\n\n  gl_FragColor.a *= opacity;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying float v_segmentIndex;\nvarying vec2 v_iconMapUV;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  styleMappingMat[3].g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nvarying mat4 styleMappingMat;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = styleMappingMat[3].b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = styleMappingMat[3].a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  styleMappingMat[3].g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.segmentNumber,r=void 0===n?30:n,i=e.mask,o=void 0!==i&&i,a=e.maskInside,s=void 0===a||a,u=this.getShaders(),l=u.frag,c=u.vert,h=u.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+h,vertexShader:c,fragmentShader:l,triangulation:Xt,blend:this.getBlend(),segmentNumber:r,stencil:(0,b.getMask)(o,s)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),p}($);var jn={solid:0,dash:1},Un=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,h=void 0===c?[10,5]:c,p=t.lineTexture,f=void 0!==p&&p,d=t.iconStep,m=void 0===d?100:d,g=t.segmentNumber,y=void 0===g?30:g,v=t.globalArcHeight,_=void 0===v?10:v;2===h.length&&h.push(0,0);var x=0,w=[0,0,0,0],S=[0,0,0,0];if(r&&o&&(w=(0,b.rgb2arr)(r),S=(0,b.rgb2arr)(o),x=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var C=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,C,this.cellProperties),T=M.data,A=M.width,P=M.height;this.rowCount=P,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:A,height:P}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:at,u_global_height:_,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(n)?n:1,u_textureBlend:"normal"===s?0:1,segmentNumber:y,u_line_type:jn[l]||0,u_dash_array:h,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:x,u_sourceColor:w,u_targetColor:S}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:'\n#define Animate 0.0\n\nuniform float u_opacity;\nuniform float u_blur : 0.9;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nvarying mat4 styleMappingMat;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].g; // 当前点位距离占线总长的比例\n\n  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);\n\n  gl_FragColor.a *= opacity;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying float v_segmentIndex;\nvarying vec2 v_iconMapUV;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  styleMappingMat[3].g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nvarying mat4 styleMappingMat;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = styleMappingMat[3].b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = styleMappingMat[3].a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  styleMappingMat[3].g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.segmentNumber,r=void 0===n?30:n,i=e.mask,o=void 0!==i&&i,a=e.maskInside,s=void 0===a||a,u=this.getShaders(),l=u.frag,c=u.vert,h=u.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+h,vertexShader:c,fragmentShader:l,triangulation:Xt,depth:{enable:!0},blend:this.getBlend(),segmentNumber:r,stencil:(0,b.getMask)(o,s)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),p}($);var Zn={solid:0,dash:1},Vn=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,h=void 0===c?[10,5]:c,p=t.lineTexture,f=void 0!==p&&p,d=t.iconStep,m=void 0===d?100:d,g=t.segmentNumber,y=void 0===g?30:g;2===h.length&&h.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var v=0,_=[0,0,0,0],x=[0,0,0,0];if(r&&o&&(_=(0,b.rgb2arr)(r),x=(0,b.rgb2arr)(o),v=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var w=this.layer.getEncodedData(),S=this.calDataFrame(this.cellLength,w,this.cellProperties),C=S.data,M=S.width,T=S.height;this.rowCount=T,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:M,height:T}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(n)?n:1,u_textureBlend:"normal"===s?0:1,segmentNumber:y,u_line_type:Zn[l]||0,u_dash_array:h,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:_,u_targetColor:x}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n    return index / (segmentNumber - 1.);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n    vec2 x = mix(source, target, ratio);\n    vec2 center = mix(source, target, 0.5);\n    float dSourceCenter = distance(source, center);\n    float dXCenter = distance(x, center);\n    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n     float vertex_height = paraboloid(source, target, segmentRatio);\n\n    return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n    );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*16.0; // total_Distance*16.0 调整默认的效果\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\n  styleMappingMat[3].g = a_Position.x; // 该顶点在弧线上的分段排序\n  if(LineTexture == u_line_texture) { // 开启贴图模式  \n    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;\n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\n    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nvarying mat4 styleMappingMat;\n\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0;\n  float d_segmentIndex = styleMappingMat[3].g;\n  \n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // 实线部分\n    } else {\n      // 虚线部分\n      discard;\n    };\n  }\n\n  // 设置弧线的动画模式\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = styleMappingMat[3].b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = gl_FragColor.a/opacity;\n    }\n\n    float v = styleMappingMat[3].a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n    \n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',triangulation:Xt,depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(r,o)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),p}($);var Gn=function(t){(0,u.Z)(h,t);var e,n,r,s=(n=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function h(){return(0,o.Z)(this,h),s.apply(this,arguments)}return(0,a.Z)(h,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.arrow,s=void 0===a?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:a,u=0,l=[0,0,0,0],c=[0,0,0,0];if(r&&o&&(l=(0,b.rgb2arr)(r),c=(0,b.rgb2arr)(o),u=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var h=this.layer.getEncodedData(),p=this.calDataFrame(this.cellLength,h,this.cellProperties),f=p.data,d=p.width,m=p.height;this.rowCount=m,this.dataTexture=this.cellLength>0&&f.length>0?this.createTexture2D({flipY:!0,data:f,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:d,height:m}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(n)?n:1,u_linearColor:u,u_sourceColor:l,u_targetColor:c,u_arrow:Number(s.enable),u_arrowHeight:s.arrowHeight||3,u_arrowWidth:s.arrowWidth||2,u_tailWidth:void 0===s.tailWidth?1:s.tailWidth}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"buildModels",value:(e=(0,p.Z)(v().mark((function t(e){var n,r,i,o,a,s,u,l,c,h;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=n.depth,u=void 0!==s&&s,l=this.getShaders(),c=l.frag,h=l.vert,this.layer.triangulation=Ft,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:h,fragmentShader:c,triangulation:Ft,depth:{enable:u},blend:this.getBlend(),stencil:(0,b.getMask)(i,a)}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:'#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0           // amap\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0\nuniform float u_CoordinateSystem;\nvarying vec4 v_color;\nuniform float u_arrow: 0.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\nvarying mat4 styleMappingMat;\nvoid main() {\n  float distanceAndIndex = styleMappingMat[0][3];\n  float miter = styleMappingMat[0][2];\n\n  float opacity = styleMappingMat[0][0];\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n\n\n  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { \n      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap\n        discard;\n      }\n    } else { // amap2 mapbox map\n      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { \n        discard;\n      }\n    }\n  } else { // line body\n    if(miter < 0.0) {\n      discard;\n    }\n  }\n\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\n  } else { // 使用 color 方法传入的颜色\n    gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\n// dash line\nattribute vec4 a_dirPoints;\nattribute vec3 a_DistanceAndIndex;\n\nuniform vec4 u_lineDir;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\n\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\nvec2 calculateArrow(vec2 offset) {\n  /*\n  * 在支持箭头的时候，第二、第三组顶点是额外插入用于构建顶点的\n  */\n  float arrowFlag = -1.0;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // 高德 2.0 的旋转角度不同\n    arrowFlag = 1.0;\n  }\n  float pi = arrowFlag * 3.1415926/2.;\n  if(a_Miter < 0.) {\n    // 根据线的两侧偏移不同、旋转的方向相反\n    pi = -pi;\n  }\n  highp float angle_sin = sin(pi);\n  highp float angle_cos = cos(pi);\n  // 计算垂直与线方向的旋转矩阵\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float arrowWidth = u_arrowWidth;\n  float arrowHeight = u_arrowHeight;\n\n  vec2 arrowOffset = vec2(0.0);\n  /*\n  * a_DistanceAndIndex.y 用于标记当前顶点属于哪一组（两个顶点一组，构成线的其实是矩形，最简需要四个顶点、两组顶点构成）\n  */\n  if(a_DistanceAndIndex.y == 0.0) {\n    // 箭头尖部\n    offset = vec2(0.0);\n  } else if(a_DistanceAndIndex.y == 1.0) {\n    // 箭头两侧\n    arrowOffset = rotation_matrix*(offset * arrowHeight);\n    offset += arrowOffset; // 沿线偏移\n    offset = offset * arrowWidth; // 垂直线向外偏移（是构建箭头两侧的顶点）\n  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\n    // 偏移其余的点位（将长度让位给箭头）\n    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\n    offset += arrowOffset;// 沿线偏移\n  }\n\n  return offset;\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex\n    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n  styleMappingMat[0][3] = a_DistanceAndIndex.y;\n  styleMappingMat[0][2] = a_Miter;\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n\n  v_color = a_Color;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  // styleMappingMat[1].rg = a_Position.xy + offset;\n\n  vec2 copyOffset = vec2(offset.x, offset.y);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float total_Distance = a_DistanceAndIndex.z;\n  float currentLinePointRatio = lineDistance / total_Distance;\n \n  if(u_arrow > 0.0) {\n      //  计算箭头\n    offset = calculateArrow(offset);\n\n    if(a_DistanceAndIndex.y > 4.0) {\n      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n    }\n  }\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n\n  // 设置数据集的参数\n  styleMappingMat[3][0] = currentLinePointRatio; // 当前点位距离占线总长的比例\n  styleMappingMat[3][1] = lineDistance;       // 当前顶点的距离\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z); // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n  }\n  \n  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {\n    vec2 startPoint = a_dirPoints.rg;\n    vec2 endPoint = a_dirPoints.ba;\n    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));\n    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));\n    // TODO： 后续优化可以把位置计算放在 cpu 中完成\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;\n      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;\n      styleMappingMat[1].rg = normalize(p1 - p2);\n      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);\n    } else {\n      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;\n      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;\n      styleMappingMat[1].rg = normalize(p1 - p2);\n      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);\n    }\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:i.AttributeType.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i,o){return void 0===o?[n[3],10,n[5]]:[n[3],o,n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:i.AttributeType.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t){var e=t.coordinates[0]||[0,0],n=t.coordinates[3]||[0,0];return[e[0],e[1],n[0],n[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}})}}]),h}($);var Hn='\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\n\n\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\nvec2 calculateArrow(vec2 offset) {\n  /*\n  * 在支持箭头的时候，第二、第三组顶点是额外插入用于构建顶点的\n  */\n  float arrowFlag = -1.0;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // 高德 2.0 的旋转角度不同\n    arrowFlag = 1.0;\n  }\n  float pi = arrowFlag * 3.1415926/2.;\n  if(a_Miter < 0.) {\n    // 根据线的两侧偏移不同、旋转的方向相反\n    pi = -pi;\n  }\n  highp float angle_sin = sin(pi);\n  highp float angle_cos = cos(pi);\n  // 计算垂直与线方向的旋转矩阵\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float arrowWidth = u_arrowWidth;\n  float arrowHeight = u_arrowHeight;\n\n  vec2 arrowOffset = vec2(0.0);\n  /*\n  * a_DistanceAndIndex.y 用于标记当前顶点属于哪一组（两个顶点一组，构成线的其实是矩形，最简需要四个顶点、两组顶点构成）\n  */\n  if(a_DistanceAndIndex.y == 0.0) {\n    // 箭头尖部\n    offset = vec2(0.0);\n  } else if(a_DistanceAndIndex.y == 1.0) {\n    // 箭头两侧\n    arrowOffset = rotation_matrix*(offset * arrowHeight);\n    offset += arrowOffset; // 沿线偏移\n    offset = offset * arrowWidth; // 垂直线向外偏移（是构建箭头两侧的顶点）\n  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\n    // 偏移其余的点位（将长度让位给箭头）\n    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\n    offset += arrowOffset;// 沿线偏移\n  }\n\n  return offset;\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  v_color = a_Color;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n  if(u_arrow > 0.0) {\n      //  计算箭头\n    offset = calculateArrow(offset);\n\n    if(a_DistanceAndIndex.y > 4.0) {\n      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n    }\n  }\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  // 设置数据集的参数\n  styleMappingMat[3][0] = currentLinePointRatio; // 当前点位距离占线总长的比例\n  styleMappingMat[3][1] = lineDistance;       // 当前顶点的距离\n  styleMappingMat[3][2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  styleMappingMat[3][3] = texV;             // 线图层贴图部分的 v 坐标值\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',Wn={solid:0,dash:1},qn=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.textureBlend,s=void 0===a?"normal":a,u=t.lineType,l=void 0===u?"solid":u,c=t.dashArray,h=void 0===c?[10,5,0,0]:c,p=t.lineTexture,f=void 0!==p&&p,d=t.iconStep,m=void 0===d?100:d,g=t.vertexHeightScale,y=void 0===g?20:g,v=t.borderWidth,_=void 0===v?0:v,x=t.borderColor,w=void 0===x?"#ccc":x,S=t.raisingHeight,C=void 0===S?0:S,M=t.heightfixed,T=void 0!==M&&M,A=t.linearDir,P=void 0===A?K.VERTICAL:A,L=t.blur,I=void 0===L?[1,1,1]:L,k=t.arrow,O=void 0===k?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:k;2===h.length&&h.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var R=0,D=[0,0,0,0],N=[0,0,0,0];if(r&&o&&(D=(0,b.rgb2arr)(r),N=(0,b.rgb2arr)(o),R=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var F=this.layer.getEncodedData(),z=this.calDataFrame(this.cellLength,F,this.cellProperties),B=z.data,j=z.width,U=z.height;this.rowCount=U,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:j,height:U}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(n)?n:1,u_textureBlend:s===Q.NORMAL?0:1,u_line_type:Wn[l],u_dash_array:h,u_blur:I,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:_,u_borderColor:(0,b.rgb2arr)(w),u_linearDir:P===K.VERTICAL?1:0,u_linearColor:R,u_sourceColor:D,u_targetColor:N,u_heightfixed:Number(T),u_vertexScale:y,u_raisingHeight:Number(C),u_arrow:Number(O.enable),u_arrowHeight:O.arrowHeight||3,u_arrowWidth:O.arrowWidth||2,u_tailWidth:void 0===O.tailWidth?1:O.tailWidth}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i,a=e.depth,s=void 0!==a&&a,u=e.workerEnabled,l=void 0!==u&&u,c=e.enablePicking,h=this.getShaders(),p=h.frag,f=h.vert,d=h.type;this.layer.triangulation=b.LineTriangulation,this.layer.buildLayerModel({moduleName:"line"+d,vertexShader:f,fragmentShader:p,triangulation:b.LineTriangulation,depth:{enable:s},blend:this.getBlend(),stencil:(0,b.getMask)(r,o),workerEnabled:l,workerOptions:{modelType:"line"+d,enablePicking:c,iconMap:this.iconService.getIconMap()}}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return"dash"===t.lineType?{frag:'#define LineTypeSolid 0.0\nuniform float u_opacity : 1.0;\n\nvarying vec4 v_color;\n\n// dash\nvarying vec4 v_dash_array;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动\n\nvarying mat4 styleMappingMat;\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n  gl_FragColor.a *= opacity; // 全局透明度\n \n  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    // 实线部分\n  } else {\n    // 虚线部分\n    discard;\n  };\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\n\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_color = a_Color;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  vec2 offset = project_pixel(size.xy);\n\n  // 设置数据集的参数\n  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // 当前点位距离占线总长的比例\n  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // 当前顶点的距离\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n \n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:"Dash"}:e&&n?{frag:'varying vec4 v_color;\nuniform float u_linearDir: 1.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\n\nvarying mat4 styleMappingMat;\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float linearRadio = styleMappingMat[3][0]; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    linearRadio = styleMappingMat[3][3];\n  }\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:Hn,type:"Linear"}:{frag:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\n\nuniform float u_borderWidth: 0.0;\n\nuniform vec3 u_blur;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nvarying vec2 v_iconMapUV;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // 控制运动\n\nvarying mat4 styleMappingMat;\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  gl_FragColor.a *= opacity; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = styleMappingMat[3].g;      // 当前顶点的距离\n    float d_texPixelLen = styleMappingMat[3].b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = styleMappingMat[3].a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    \n    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));\n    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));\n     vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor += pattern;\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = pattern;\n    }\n  } \n\n  float v = styleMappingMat[3].a;\n  float borderWidth = min(0.5, u_borderWidth);\n  // 绘制 border\n  if(borderWidth > 0.01) {\n    float borderOuterWidth = borderWidth/2.0;\n\n    if(v >= 1.0 - borderWidth || v <= borderWidth) {\n      if(v > borderWidth) {\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n      } else if(v <= borderWidth) {\n        float linear = smoothstep(0.0, 1.0, v/borderWidth);\n        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = styleMappingMat[3][3];\n  if(blurV < 0.5) {\n    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:Hn,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:i.AttributeType.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),p}($);var Xn=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;t.colorTexture&&t.colorTexture.destroy();var n=t.layer.getLayerConfig().rampColors,r=(0,b.generateColorRamp)(n);t.colorTexture=e({data:new Uint8Array(r.data),width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.NEAREST,mag:i.gl.NEAREST,flipY:!1})})),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.vertexHeightScale,o=void 0===r?20:r,a=t.raisingHeight,s=void 0===a?0:a,u=t.heightfixed,l=void 0!==u&&u,c=t.linearDir,h=void 0===c?K.VERTICAL:c;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var p=this.layer.getEncodedData(),f=this.calDataFrame(this.cellLength,p,this.cellProperties),d=f.data,m=f.width,g=f.height;this.rowCount=g,this.dataTexture=this.cellLength>0&&d.length>0?this.createTexture2D({flipY:!0,data:d,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:m,height:g}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:h===K.VERTICAL?1:0,u_opacity:(0,E.isNumber)(n)?n:1,u_texture:this.colorTexture,u_heightfixed:Number(l),u_vertexScale:o,u_raisingHeight:Number(s)}}},{key:"initModels",value:function(t){this.updateTexture(),this.buildModels(t)}},{key:"clearModels",value:function(){var t,e;null===(t=this.colorTexture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i,a=e.depth,s=void 0!==a&&a;this.layer.triangulation=Ft,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:'\nattribute float a_Miter;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n\nuniform float u_opacity: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  // 设置数据集的参数\n  styleMappingMat[3][0] = currentLinePointRatio; // 当前点位距离占线总长的比例\n  styleMappingMat[3][3] = texV;             // 线图层贴图部分的 v 坐标值\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform float u_opacity : 1.0;\nuniform sampler2D u_texture;\nuniform float u_linearDir: 1.0;\n\n#pragma include "picking"\n\nvarying mat4 styleMappingMat;\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float linearRadio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    linearRadio = styleMappingMat[3][3];\n  }\n\n  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Ft,depth:{enable:s},blend:this.getBlend(),stencil:(0,b.getMask)(r,o)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:i.AttributeType.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}})}}]),p}($);var Yn='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\n\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_opacity: 1.0;\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n\nvarying vec4 v_color;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  \n  v_color = a_Color; \n  styleMappingMat[3][0] = a_Distance / a_Total_Distance;\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // 保持高度相对不变\n      h *= 2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n\n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n    gl_PointSize = 10.0;\n  }\n}\n',Kn=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,o=t.targetColor,a=t.vertexHeightScale,s=void 0===a?20:a,u=0,l=[0,0,0,0],c=[0,0,0,0];if(r&&o&&(l=(0,b.rgb2arr)(r),c=(0,b.rgb2arr)(o),u=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var h=this.layer.getEncodedData(),p=this.calDataFrame(this.cellLength,h,this.cellProperties),f=p.data,d=p.width,m=p.height;this.rowCount=m,this.dataTexture=this.cellLength>0&&f.length>0?this.createTexture2D({flipY:!0,data:f,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:d,height:m}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(n)?n:1,u_linearColor:u,u_sourceColor:l,u_targetColor:c,u_vertexScale:s}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:"uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nvarying mat4 styleMappingMat;\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n\n  // styleMappingMat[3][0] 当前点位距离占线总长的比例\n  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);\n  gl_FragColor.a *= opacity; // 全局透明度\n}\n",vert:Yn,type:"lineSimpleLinear"}:{frag:"\nvarying vec4 v_color;\nvarying mat4 styleMappingMat;\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n\n  gl_FragColor = v_color;\n  gl_FragColor.a *= opacity; // 全局透明度\n}\n",vert:Yn,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o,s=this.getShaders(),u=s.frag,l=s.vert,c=s.type;this.layer.buildLayerModel({moduleName:c,vertexShader:l,fragmentShader:u,triangulation:zt,primitive:i.gl.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(r,a),pick:!1}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}})}}]),s}($);const Qn={arc:Fn,arc3d:Bn,greatcircle:Vn,wall:function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.heightfixed,u=void 0!==s&&s,l=t.lineTexture,c=void 0!==l&&l,h=t.iconStep,p=void 0===h?100:h,f=t.iconStepCount,d=void 0===f?1:f;this.rendererService.getDirty()&&this.texture.bind();var m=0,g=[0,0,0,0],y=[0,0,0,0];return r&&i&&(g=(0,b.rgb2arr)(r),y=(0,b.rgb2arr)(i),m=1),{u_heightfixed:Number(u),u_opacity:(0,E.isNumber)(n)?n:1,u_textureBlend:"normal"===a?0:1,u_texture:this.texture,u_line_texture:c?1:0,u_iconStepCount:d,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:m,u_sourceColor:g,u_targetColor:y}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\nuniform float u_linearColor: 0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_dataset;\n\nvoid main() {\n\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_animate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // 设置数据集的参数\n  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  v_dataset[1] = a_Distance;       // 当前顶点的距离\n  v_dataset[2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  v_dataset[3] = miter;          // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // 固定高度\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    originSize = project_float_pixel(a_Size.x);\n  }\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动\n\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_color;\nvarying vec4 v_dataset;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // 当前顶点的距离\n    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Ft,depth:{enable:!1},blend:this.getBlend()}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),p}($),line:qn,halfLine:Gn,simple:Kn,linearline:Xn,vectorline:Dn,tileLine:Te,earthArc3d:Un};var Jn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","LineLayer"),(0,h.Z)((0,s.Z)(t),"arrowInsertCount",0),(0,h.Z)((0,s.Z)(t),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new Qn[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"getDefaultConfig",value:function(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;if(be(this.layerSource.getParserType()))return"vectorline";var e=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"line"}}]),i}(H);var $n=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"raiseCount",0),(0,h.Z)((0,s.Z)(t),"raiseRepeat",0),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1,speed:.01,repeat:!1}:e,r=t.opacity,o=void 0===r?1:r,a=t.sourceColor,s=t.targetColor,u=t.pickLight,l=void 0!==u&&u,c=t.heightfixed,h=void 0!==c&&c,p=t.opacityLinear,f=void 0===p?{enable:!1,dir:"up"}:p,d=t.lightEnable,m=void 0===d||d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var g=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,g,this.cellProperties),v=y.data,_=y.width,x=y.height;this.rowCount=x,this.dataTexture=this.cellLength>0&&v.length>0?this.createTexture2D({flipY:!0,data:v,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:_,height:x}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}var w=0,S=[0,0,0,0],C=[0,0,0,0];if(a&&s&&(S=(0,b.rgb2arr)(a),C=(0,b.rgb2arr)(s),w=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var M=n.speed,T=void 0===M?.01:M;this.raiseCount+=T,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(l),u_heightfixed:Number(h),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(o)?o:1,u_linearColor:w,u_sourceColor:S,u_targetColor:C,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:"up"===f.dir?1:0,u_lightEnable:Number(m)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig().animateOption.repeat,n=void 0===e?1:e;this.raiseRepeat=n,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(垂直方向 0 - 1 的值)\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  styleMappingMat[2][3] =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  styleMappingMat[1][3] = lightWeight;\n\n  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  \n  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n  //旋转矩阵mx，创建绕x轴旋转矩阵\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//求解旋转角度余弦值\n  float xsin = sin(xRadian);//求解旋转角度正弦值\n  mat4 mx = mat4(\n    1,0,0,0,  \n    0,xcos,-xsin,0,  \n    0,xsin,xcos,0,  \n    0,0,0,1);\n\n  //旋转矩阵my，创建绕y轴旋转矩阵\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//求解旋转角度余弦值\n  float ysin = sin(yRadian);//求解旋转角度正弦值\n  mat4 my = mat4(\n    ycos,0,-ysin,0,  \n    0,1,0,0,  \n    ysin,0,ycos,0,  \n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  \n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\n\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float lightWeight = styleMappingMat[1][3];\n  float barLinearZ = styleMappingMat[2][3];\n\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);\n    gl_FragColor.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // 应用透明度\n  gl_FragColor.a *= opacity;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:Dt,depth:{enable:!0},cull:{enable:!0,face:(0,b.getCullFace)(this.mapService.version)},blend:this.getBlend()}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t){var e=t.size;if(e){var n=[];return Array.isArray(e)&&(n=2===e.length?[e[0],e[0],e[1]]:e),Array.isArray(e)||(n=[e,e,e]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t){var e=(0,b.calculateCentroid)(t.coordinates);return ut([e[0],e[1]])}}})}}]),p}($);var tr=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.strokeOpacity,o=void 0===r?1:r,a=t.strokeWidth,s=void 0===a?0:a,u=t.stroke,l=void 0===u?"rgba(0,0,0,0)":u,c=t.offsets,h=void 0===c?[0,0]:c,p=t.blend,f=t.blur,d=void 0===f?0:f;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,strokeOpacity:o,strokeWidth:s,stroke:l,offsets:h})){this.judgeStyleAttributes({opacity:n,strokeOpacity:o,strokeWidth:s,stroke:l,offsets:h});var m=this.layer.getEncodedData(),g=this.calDataFrame(this.cellLength,m,this.cellProperties),y=g.data,v=g.width,_=g.height;this.rowCount=_,this.dataTexture=this.cellLength>0&&y.length>0?this.createTexture2D({flipY:!0,data:y,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:v,height:_}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_blur:d,u_additive:"additive"===p?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(n)?n:1,u_stroke_opacity:(0,E.isNumber)(o)?o:1,u_stroke_width:(0,E.isNumber)(s)?s:1,u_stroke_color:this.getStrokeColor(l),u_offsets:this.isOffsetStatic(h)?h:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption,e=void 0===t?{enable:!1}:t;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){this.layer.triangulation=Rt,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n\nuniform float u_blur : 0.0;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = strokeOpacityAndOffset.r;\n  textureOffset = strokeOpacityAndOffset.g;\n\n  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][2] = strokeWidthAndOffset.r;\n  textureOffset = strokeWidthAndOffset.g;\n\n  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\n  if(hasStroke()) {\n    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R\n    textureOffset += 1.0;\n\n    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G\n    textureOffset += 1.0;\n\n    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B\n    textureOffset += 1.0;\n\n    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A\n    textureOffset += 1.0;\n  } else {\n    if(u_stroke_color == vec4(0.0)) {\n      styleMappingMat[1][0] = v_color.r;\n      styleMappingMat[1][1] = v_color.g;\n      styleMappingMat[1][2] = v_color.b;\n      styleMappingMat[1][3] = v_color.a;\n    } else {\n      styleMappingMat[1][0] = u_stroke_color.r;\n      styleMappingMat[1][1] = u_stroke_color.g;\n      styleMappingMat[1][2] = u_stroke_color.b;\n      styleMappingMat[1][3] = u_stroke_color.a;\n    }\n  }\n\n  // cal style mapping\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:"uniform float u_additive;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 textrueStroke = vec4(\n    styleMappingMat[1][0],\n    styleMappingMat[1][1],\n    styleMappingMat[1][2],\n    styleMappingMat[1][3]\n  );\n\n  float opacity = styleMappingMat[0][0];\n  float stroke_opacity = styleMappingMat[0][1];\n  float strokeWidth = styleMappingMat[0][2];\n  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + strokeWidth);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(strokeWidth < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",triangulation:Rt,depth:{enable:!0},blend:this.getBlend()}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r){var i=(0,I.Z)(n,3),o=i[0],a=i[1],s=i[2],u=ot.fromValues(0,0,1),l=ot.fromValues(o,0,s),c=o>=0?ot.angle(u,l):2*Math.PI-ot.angle(u,l),h=2*Math.PI-Math.asin(a/100),p=it.create();it.rotateY(p,p,c),it.rotateX(p,p,h);var f=ot.fromValues(1,1,0);ot.transformMat4(f,f,p),ot.normalize(f,f);var d=ot.fromValues(-1,1,0);ot.transformMat4(d,d,p),ot.normalize(d,d);var m=ot.fromValues(-1,-1,0);ot.transformMat4(m,m,p),ot.normalize(m,m);var g=ot.fromValues(1,-1,0);ot.transformMat4(g,g,p),ot.normalize(g,g);var y=[].concat((0,W.Z)(f),(0,W.Z)(d),(0,W.Z)(m),(0,W.Z)(g)),v=r%4*3;return[y[v],y[v+1],y[v+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:i.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var n=e.shape,r=void 0===n?2:n;return[t.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]),s}($);var er=function(t){(0,u.Z)(d,t);var e,n,r,f=(n=d,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function d(){var t;(0,o.Z)(this,d);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=f.call.apply(f,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"raiseCount",0),(0,h.Z)((0,s.Z)(t),"raiseRepeat",0),t}return(0,a.Z)(d,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1,speed:.01,repeat:!1}:e,r=t.opacity,o=void 0===r?1:r,a=t.sourceColor,s=t.targetColor,u=t.pickLight,l=void 0!==u&&u,c=t.heightfixed,h=void 0!==c&&c,p=t.opacityLinear,f=void 0===p?{enable:!1,dir:"up"}:p,d=t.lightEnable,m=void 0===d||d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var g=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,g,this.cellProperties),v=y.data,_=y.width,x=y.height;this.rowCount=x,this.dataTexture=this.cellLength>0&&v.length>0?this.createTexture2D({flipY:!0,data:v,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:_,height:x}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}var w=0,S=[0,0,0,0],C=[0,0,0,0];if(a&&s&&(S=(0,b.rgb2arr)(a),C=(0,b.rgb2arr)(s),w=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var M=n.speed,T=void 0===M?.01:M;this.raiseCount+=T,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(l),u_heightfixed:Number(h),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(o)?o:1,u_linearColor:w,u_sourceColor:S,u_targetColor:C,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:"up"===f.dir?1:0,u_lightEnable:Number(m)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:(e=(0,p.Z)(v().mark((function t(e){var n,r,i,o,a;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.layer.getLayerConfig(),r=n.depth,i=void 0===r||r,o=n.animateOption.repeat,a=void 0===o?1:o,this.raiseRepeat=a,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(垂直方向 0 - 1 的值)\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  styleMappingMat[2][3] =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  styleMappingMat[1][3] = lightWeight;\n\n  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  // gl_Position = project_common_position_to_clipspace(pos);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * pos;\n  } else {\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\n\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float lightWeight = styleMappingMat[1][3];\n  float barLinearZ = styleMappingMat[2][3];\n\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);\n    gl_FragColor.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // 应用透明度\n  gl_FragColor.a *= opacity;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:Dt,blend:this.getBlend(),cull:{enable:!0,face:(0,b.getCullFace)(this.mapService.version)},depth:{enable:i}}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t){var e=t.size;if(e){var n=[];return Array.isArray(e)&&(n=2===e.length?[e[0],e[0],e[1]]:e),Array.isArray(e)||(n=[e,e,e]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t){var e=(0,b.calculateCentroid)(t.coordinates);return[e[0],e[1],0]}}})}}]),d}($);var nr='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_meter2coord;\nuniform float u_meteryScale;\nuniform float u_isMeter;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n\nuniform float u_blur : 0.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  *  u_meter2coord 在等面积大小的时候设置单位\n  */\n  float newSize = setPickingSize(a_Size) * u_meter2coord;\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = strokeOpacityAndOffset.r;\n  textureOffset = strokeOpacityAndOffset.g;\n\n  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][2] = strokeWidthAndOffset.r;\n  textureOffset = strokeWidthAndOffset.g;\n\n  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\n  if(hasStroke()) {\n    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R\n    textureOffset += 1.0;\n\n    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G\n    textureOffset += 1.0;\n\n    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B\n    textureOffset += 1.0;\n\n    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A\n    textureOffset += 1.0;\n  } else {\n    if(u_stroke_color == vec4(0.0)) {\n      styleMappingMat[1][0] = v_color.r;\n      styleMappingMat[1][1] = v_color.g;\n      styleMappingMat[1][2] = v_color.b;\n      styleMappingMat[1][3] = v_color.a;\n    } else {\n      styleMappingMat[1][0] = u_stroke_color.r;\n      styleMappingMat[1][1] = u_stroke_color.g;\n      styleMappingMat[1][2] = u_stroke_color.b;\n      styleMappingMat[1][3] = u_stroke_color.a;\n    }\n  }\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);\n  vec3 aPosition = a_Position;\n  if(u_isMeter < 1.0) {\n    // 不以米为实际单位\n    offset = project_pixel(offset);\n  } else {\n    // 以米为实际单位\n    if(newSize * pow(2.0, u_Zoom) < 48.0) {\n      antialiasblur = max(antialiasblur, -0.05);\n    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {\n      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));\n    } else {\n      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));\n    }\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      aPosition.x += offset.x / u_meteryScale;\n      aPosition.y += offset.y;\n      offset = vec2(0.0);\n    }\n  }\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_raisingHeight;\n\n  if(u_heightfixed < 1.0) { // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n \n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',rr=function(t){(0,u.Z)(d,t);var e,n,r,f=(n=d,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function d(){var t;(0,o.Z)(this,d);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=f.call.apply(f,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"meter2coord",1),(0,h.Z)((0,s.Z)(t),"meterYScale",1),(0,h.Z)((0,s.Z)(t),"isMeter",!1),(0,h.Z)((0,s.Z)(t),"unit","l7size"),t}return(0,a.Z)(d,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.strokeOpacity,o=void 0===r?1:r,a=t.strokeWidth,s=void 0===a?0:a,u=t.stroke,l=void 0===u?"rgba(0,0,0,0)":u,c=t.offsets,h=void 0===c?[0,0]:c,p=t.blend,f=t.blur,d=void 0===f?0:f,m=t.raisingHeight,g=void 0===m?0:m,y=t.heightfixed,v=void 0!==y&&y,_=t.unit,x=void 0===_?"l7size":_;if(this.updateUnit(x),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,strokeOpacity:o,strokeWidth:s,stroke:l,offsets:h})){this.judgeStyleAttributes({opacity:n,strokeOpacity:o,strokeWidth:s,stroke:l,offsets:h});var b=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,b,this.cellProperties),S=w.data,C=w.width,M=w.height;this.rowCount=M,this.dataTexture=this.cellLength>0&&S.length>0?this.createTexture2D({flipY:!0,data:S,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:C,height:M}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(g),u_heightfixed:Number(v),u_meter2coord:this.meter2coord,u_meteryScale:this.meterYScale,u_isMeter:Number(this.isMeter),u_blur:d,u_additive:"additive"===p?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(n)?n:1,u_stroke_opacity:(0,E.isNumber)(o)?o:1,u_stroke_width:(0,E.isNumber)(s)?s:1,u_stroke_color:this.getStrokeColor(l),u_offsets:this.isOffsetStatic(h)?h:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption,e=void 0===t?{enable:!1}:t;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),b.PointFillTriangulation)}},{key:"initModels",value:function(t){this.updateUnit("l7size"),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=(0,I.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3],o=[(e+r)/2,(n+i)/2],a=this.mapService.version,s=null===b.$window||void 0===b.$window?void 0:b.$window.mapboxgl;if(a===P.G.MAPBOX&&null!=s&&s.MercatorCoordinate){var u=s.MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]},0),l=u.meterInMercatorCoordinateUnits(),c=new s.MercatorCoordinate(u.x-l,u.y,u.z).toLngLat(),h=new s.MercatorCoordinate(u.x,u.y-l,u.z).toLngLat();return this.meter2coord=o[0]-c.lng,void(this.meterYScale=(h.lat-o[1])/this.meter2coord)}var p=this.mapService.meterToCoord(o,[e,n]),f=this.mapService.meterToCoord(o,[r===e?r+.1:r,i===n?n+.1:i]);this.meter2coord=(p+f)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:(e=(0,p.Z)(v().mark((function t(e){var n,r,i,o,a,s,u,l,c,h,p,f,d,m,g;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,o=n.maskInside,a=void 0===o||o,s=n.animateOption,u=void 0===s?{enable:!1}:s,l=n.workerEnabled,c=void 0!==l&&l,h=n.enablePicking,p=n.shape2d,f=this.getShaders(u),d=f.frag,m=f.vert,g=f.type,this.layer.triangulation=b.PointFillTriangulation,this.layer.buildLayerModel({moduleName:g,vertexShader:m,fragmentShader:d,triangulation:b.PointFillTriangulation,depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(i,a),workerEnabled:c,workerOptions:{modelType:g,enablePicking:h,shape2d:p}}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"getShaders",value:function(t){return t.enable?(t.type,{frag:"\nuniform float u_additive;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nvoid main() {\n\n  vec4 textrueStroke = vec4(\n    styleMappingMat[1][0],\n    styleMappingMat[1][1],\n    styleMappingMat[1][2],\n    styleMappingMat[1][3]\n  );\n\n  float opacity = styleMappingMat[0][0];\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  \n  outer_df = sdCircle(v_data.xy, 1.0);\n  inner_df = sdCircle(v_data.xy, r);\n\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\n\n  float d = length(v_data.xy);\n  if(d > 0.5) {\n    discard;\n  }\n  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  \n  // 根据叠加模式选择效果\n  if(u_additive > 0.0) {\n    gl_FragColor *= intensity;\n    // 优化水波点 blend additive 模式下有的拾取效果 \n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",vert:nr,type:"pointWave"}):{frag:"uniform float u_additive;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 textrueStroke = vec4(\n    styleMappingMat[1][0],\n    styleMappingMat[1][1],\n    styleMappingMat[1][2],\n    styleMappingMat[1][3]\n  );\n\n  float opacity = styleMappingMat[0][0];\n  float stroke_opacity = styleMappingMat[0][1];\n  float strokeWidth = styleMappingMat[0][2];\n  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + strokeWidth);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(strokeWidth < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",vert:nr,type:"pointFill"}}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:i.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var n=e.shape,r=void 0===n?2:n;return[t.indexOf(r)]}}})}},{key:"updateUnit",value:function(t){var e=this.mapService.version;this.unit!==t&&("meter"!==this.unit&&"meter"===t&&e!==P.G.L7MAP&&e!==P.G.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):"meter"===this.unit&&"meter"!==t&&(this.isMeter=!1,this.meter2coord=1),this.unit=t)}}]),d}($);var ir=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"meter2coord",1),(0,h.Z)((0,s.Z)(t),"isMeter",!1),(0,h.Z)((0,s.Z)(t),"radian",0),(0,h.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layerService.throttleRenderLayers();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.LINEAR,min:i.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,o=void 0===r?[0,0]:r,a=t.rotation,s=t.raisingHeight,u=void 0===s?0:s,l=t.heightfixed,c=void 0!==l&&l;this.rendererService.getDirty()&&this.texture.bind();var h=1;if("GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(h=-1),this.radian=void 0!==a?h*Math.PI*a/180:h*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:o})){this.judgeStyleAttributes({opacity:n,offsets:o});var p=this.layer.getEncodedData(),f=this.calDataFrame(this.cellLength,p,this.cellProperties),d=f.data,m=f.width,g=f.height;this.rowCount=g,this.dataTexture=this.cellLength>0&&d.length>0?this.createTexture2D({flipY:!0,data:d,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:m,height:g}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(u),u_heightfixed:Number(c),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,E.isNumber)(n)?n:1,u_offsets:this.isOffsetStatic(o)?o:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ot)}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var e=this.layer.getLayerConfig().unit,n=void 0===e?"l7size":e,r=this.mapService.version;"meter"===n&&r!==P.G.L7MAP&&r!==P.G.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=(0,I.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3],o=[(e+r)/2,(n+i)/2];if(this.mapService.version===P.G.MAPBOX&&window.mapboxgl.MercatorCoordinate){var a=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]},0),s=1*a.meterInMercatorCoordinateUnits(),u=new window.mapboxgl.MercatorCoordinate(a.x-s,a.y,a.z).toLngLat();this.meter2coord=o[0]-u.lng}else{var l=this.mapService.meterToCoord(o,[e,n]),c=this.mapService.meterToCoord(o,[r===e?r+.1:r,i===n?n+.1:i]);this.meter2coord=(l+c)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\nattribute float a_Rotate;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform mat2 u_RotateMatrix;\nuniform float u_isMeter;\n\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv; // icon 贴图的 uv 坐标\n\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n\n  v_uv = (a_Extrude.xy + 1.0)/2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty\n    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec3 aPosition = a_Position;\n  if(u_isMeter < 1.0) {\n    // 不以米为实际单位\n    offset = project_pixel(offset);\n  } else {\n    // 以米为实际单位\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      aPosition.xy += offset;\n      offset.x = 0.0;\n      offset.y = 0.0;\n    }\n  }\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // height fixed\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv;\n\nvoid main() {\n\n  float opacity = styleMappingMat[0][0];\n\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  gl_FragColor = texture2D(u_texture, pos);\n  gl_FragColor.a *= opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Ot,depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(r,o),cull:{enable:!0,face:(0,b.getCullFace)(this.mapService.version)}}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t,e;this.iconService.off("imageUpdate",this.updateTexture),null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:i.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.rotate,n=void 0===e?0:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var n=e.size,r=void 0===n?5:n;return Array.isArray(r)?[r[0]*t.meter2coord]:[r*t.meter2coord]}}})}}]),p}($);var or=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layerService.throttleRenderLayers();t.texture=e({data:t.iconService.getCanvas(),mag:i.gl.LINEAR,min:i.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,o=void 0===r?[0,0]:r,a=t.raisingHeight,s=void 0===a?0:a,u=t.heightfixed,l=void 0!==u&&u;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:o})){this.judgeStyleAttributes({opacity:n,offsets:o});var c=this.layer.getEncodedData(),h=this.calDataFrame(this.cellLength,c,this.cellProperties),p=h.data,f=h.width,d=h.height;this.rowCount=d,this.dataTexture=this.cellLength>0&&p.length>0?this.createTexture2D({flipY:!0,data:p,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:f,height:d}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(s),u_heightfixed:Number(l),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,E.isNumber)(n)?n:1,u_offsets:this.isOffsetStatic(o)?o:[0,0]}}},{key:"initModels",value:function(t){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec2 u_offsets;\n\nuniform float u_opacity : 1;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  styleMappingMat[1][0] = a_Size;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping - 数据纹理映射部分的计算\n  v_color = a_Color;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  vec2 offset = project_pixel(textrueOffsets);\n\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main(){\n      float opacity = styleMappingMat[0][0];\n      float size = styleMappingMat[1][0];\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: 去除边缘部分 mipmap 导致的混合变暗\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n\n      gl_FragColor.a = gl_FragColor.a * opacity;\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Nt,depth:{enable:!1},primitive:i.gl.POINTS,blend:this.getBlend(),stencil:(0,b.getMask)(r,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[n.x,n.y]}}})}}]),p}($);function ar(t){var e=t.coordinates;return{vertices:(0,W.Z)(e),indices:[0],size:e.length}}var sr=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t;return{u_opacity:(0,E.isNumber)(e)?e:1}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o;this.layer.triangulation=ar,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\n\nvarying vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = a_Color;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n}\n',fragmentShader:"uniform float u_opacity : 1;\nvarying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:ar,depth:{enable:!1},primitive:i.gl.POINTS,blend:this.getBlend(),stencil:(0,b.getMask)(r,a),pick:!1}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),s}($);var ur=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"meter2coord",1),(0,h.Z)((0,s.Z)(t),"isMeter",!1),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.blend,i=t.speed,o=void 0===i?1:i;return{u_isMeter:Number(this.isMeter),u_speed:o,u_additive:"additive"===r?1:0,u_opacity:(0,E.isNumber)(n)?n:1}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption,e=void 0===t?{enable:!1}:t;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ot)}},{key:"initModels",value:function(t){var e=this.layer.getLayerConfig().unit,n=void 0===e?"l7size":e,r=this.mapService.version;"meter"===n&&r!==P.G.L7MAP&&r!==P.G.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=(0,I.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3],o=[(e+r)/2,(n+i)/2];if(this.mapService.version===P.G.MAPBOX&&window.mapboxgl.MercatorCoordinate){var a=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]},0),s=1*a.meterInMercatorCoordinateUnits(),u=new window.mapboxgl.MercatorCoordinate(a.x-s,a.y,a.z).toLngLat();this.meter2coord=o[0]-u.lng}else{var l=this.mapService.meterToCoord(o,[e,n]),c=this.mapService.meterToCoord(o,[r===e?r+.1:r,i===n?n+.1:i]);this.meter2coord=(l+c)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nuniform float u_speed: 1.0;\nuniform float u_time;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_isMeter;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2( \n    cos(time), sin(time), \n    -sin(time), cos(time)\n  );\n  v_exteude = rotateMatrix * a_Extrude.xy;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  vec2 offset = (extrude.xy * (newSize));\n  vec3 aPosition = a_Position;\n  if(u_isMeter < 1.0) {\n    // 不以米为实际单位\n    offset = project_pixel(offset);\n  } else {\n    // 以米为实际单位\n    antialiasblur *= pow(19.0 - u_Zoom, 2.0);\n    antialiasblur = max(antialiasblur, -0.01);\n    // offset *= 0.5;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      aPosition.xy += offset;\n      offset.x = 0.0;\n      offset.y = 0.0;\n    }\n  }\n\n  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_additive;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n  } else {\n    gl_FragColor.a *= opacity_t;\n  }\n\n  if(gl_FragColor.a > 0.0) {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  vec2 extrude =  v_exteude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  // full circle\n  // float rades = dot(dir, baseDir);\n  // float flag = sign(dir.y);\n  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;\n  \n  // half circle\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  gl_FragColor.a *= radar_v;\n}\n',triangulation:Ot,depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(r,o)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var n=e.size,r=void 0===n?5:n;return Array.isArray(r)?[r[0]*t.meter2coord]:[r*t.meter2coord]}}})}}]),p}($);function lr(t){var e=t.coordinates;return{vertices:(0,W.Z)(e),indices:[0],size:e.length}}var cr=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,o=void 0===r?[0,0]:r,a=t.blend,s=t.strokeOpacity,u=void 0===s?1:s,l=t.strokeWidth,c=void 0===l?0:l,h=t.stroke,p=void 0===h?"#fff":h;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:o})){this.judgeStyleAttributes({opacity:n,offsets:o});var f=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,f,this.cellProperties),m=d.data,g=d.width,y=d.height;this.rowCount=y,this.dataTexture=this.cellLength>0&&m.length>0?this.createTexture2D({flipY:!0,data:m,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:g,height:y}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_additive:"additive"===a?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.isNumber)(n)?n:1,u_offsets:this.isOffsetStatic(o)?o:[0,0],u_stroke_opacity:(0,E.isNumber)(u)?u:1,u_stroke_width:(0,E.isNumber)(c)?c:1,u_stroke_color:this.getStrokeColor(p)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o;this.layer.triangulation=lr,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = a_Color;\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n\n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n  \n  vec2 offset = project_pixel(textrueOffsets);\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_additive;\n\nuniform float u_stroke_opacity : 1;\n\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\nvarying vec4 v_color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  float opacity = styleMappingMat[0][0];\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      gl_FragColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      gl_FragColor = mix(v_color, stroke, mixR);\n    } else {\n      gl_FragColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n  \n  if(u_additive > 0.0) {\n    gl_FragColor *= circleClipOpacity;\n  } else {\n    gl_FragColor.a *= circleClipOpacity;\n  }\n\n}\n',triangulation:lr,depth:{enable:!1},primitive:i.gl.POINTS,blend:this.getBlend(),stencil:(0,b.getMask)(r,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),s}($);function hr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var pr='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\n// uniform float u_font_size : 24.0;\nuniform float u_opacity : 1.0;\nuniform vec4 u_stroke_color : [0, 0, 0, 1];\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n  float opacity = styleMappingMat[0][0];\n  float strokeWidth = styleMappingMat[0][2];\n  vec4 textrueStroke = vec4(\n    styleMappingMat[1][0],\n    styleMappingMat[1][1],\n    styleMappingMat[1][2],\n    styleMappingMat[1][3]\n  );\n\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  // float fontScale = u_font_size / FONT_SIZE;\n\n  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));\n  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));\n  gl_FragColor.a= gl_FragColor.a * alpha;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',fr='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying float v_fontScale;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nuniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n   styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][2] = strokeWidthAndOffset.r;\n  textureOffset = strokeWidthAndOffset.g;\n\n  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\n  if(hasStroke()) {\n    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R\n    textureOffset += 1.0;\n\n    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G\n    textureOffset += 1.0;\n\n    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B\n    textureOffset += 1.0;\n\n    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A\n    textureOffset += 1.0;\n  } else {\n    if(u_stroke_color == vec4(0.0)) {\n      styleMappingMat[1][0] = v_color.r;\n      styleMappingMat[1][1] = v_color.g;\n      styleMappingMat[1][2] = v_color.b;\n      styleMappingMat[1][3] = v_color.a;\n    } else {\n      styleMappingMat[1][0] = u_stroke_color.r;\n      styleMappingMat[1][1] = u_stroke_color.g;\n      styleMappingMat[1][2] = u_stroke_color.b;\n      styleMappingMat[1][3] = u_stroke_color.a;\n    }\n  }\n  \n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  v_uv = a_tex / u_sdf_map_size;\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  } else { // else\n   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  }\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n';function dr(t){var e=this,n=t.id,r=[],i=[];if(!e.glyphInfoMap||!e.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var o=e.glyphInfoMap[n].centroid,a=2===o.length?[o[0],o[1],0]:o;return e.glyphInfoMap[n].glyphQuads.forEach((function(t,e){r.push.apply(r,(0,W.Z)(a).concat([t.tex.x,t.tex.y+t.tex.height,t.tl.x,t.tl.y],(0,W.Z)(a),[t.tex.x+t.tex.width,t.tex.y+t.tex.height,t.tr.x,t.tr.y],(0,W.Z)(a),[t.tex.x+t.tex.width,t.tex.y,t.br.x,t.br.y],(0,W.Z)(a),[t.tex.x,t.tex.y,t.bl.x,t.bl.y])),i.push(0+4*e,1+4*e,2+4*e,2+4*e,3+4*e,0+4*e)})),{vertices:r,indices:i,size:7}}var mr=function(t){(0,u.Z)(f,t);var e,n,r=(e=f,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function f(){var t;(0,o.Z)(this,f);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"glyphInfoMap",{}),(0,h.Z)((0,s.Z)(t),"currentZoom",-1),(0,h.Z)((0,s.Z)(t),"textureHeight",0),(0,h.Z)((0,s.Z)(t),"textCount",0),(0,h.Z)((0,s.Z)(t),"preTextStyle",{}),(0,h.Z)((0,s.Z)(t),"buildModels",function(){var e=(0,p.Z)(v().mark((function e(n){var r,i,o,a,u;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.layer.getLayerConfig(),i=r.mask,o=void 0!==i&&i,a=r.maskInside,u=void 0===a||a,t.mapping(),t.layer.buildLayerModel({moduleName:"pointText",vertexShader:fr,fragmentShader:pr,triangulation:dr.bind((0,s.Z)(t)),depth:{enable:!1},blend:t.getBlend(),stencil:(0,b.getMask)(o,u)}).then((function(t){n([t])})).catch((function(t){console.warn(t),n([])}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,h.Z)((0,s.Z)(t),"mapping",(function(){t.initGlyph(),t.updateTexture(),t.filterGlyphs(),t.reBuildModel()})),t}return(0,a.Z)(f,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.stroke,o=void 0===r?"#fff":r,a=t.strokeWidth,s=void 0===a?0:a,u=t.textAnchor,l=void 0===u?"center":u,c=t.textAllowOverlap,h=void 0!==c&&c,p=t.halo,f=void 0===p?.5:p,d=t.gamma,m=void 0===d?2:d,g=t.raisingHeight,y=void 0===g?0:g,v=this.fontService,_=v.canvas,x=v.mapping;if(Object.keys(x).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(x).length),this.preTextStyle={textAnchor:l,textAllowOverlap:h},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,strokeWidth:s,stroke:o})){this.judgeStyleAttributes({opacity:n,strokeWidth:s,stroke:o});var b=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,b,this.cellProperties),S=w.data,C=w.width,M=w.height;this.rowCount=M,this.dataTexture=this.cellLength>0&&S.length>0?this.createTexture2D({flipY:!0,data:S,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:C,height:M}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(y),u_opacity:(0,E.isNumber)(n)?n:1,u_stroke_width:(0,E.isNumber)(s)?s:1,u_stroke_color:this.getStrokeColor(o),u_sdf_map:this.texture,u_halo_blur:f,u_gamma_scale:m,u_sdf_map_size:[_.width,_.height]}}},{key:"initModels",value:function(t){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var e=this.layer.getLayerConfig(),n=e.textAnchor,r=void 0===n?"center":n,i=e.textAllowOverlap,o=void 0===i||i;this.preTextStyle={textAnchor:r,textAllowOverlap:o},this.buildModels(t)}},{key:"needUpdate",value:function(){var t=this.layer.getLayerConfig().textAllowOverlap,e=void 0!==t&&t,n=this.mapService.getZoom(),r=this.mapService.getBounds(),i=(0,b.boundsContains)(this.extent,r);return(!e&&(Math.abs(this.currentZoom-n)>1||!i)||e!==this.preTextStyle.textAllowOverlap)&&(this.reBuildModel(),!0)}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:i.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.rotate,n=void 0===e?0:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:i.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?12:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:i.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return(0,b.padBounds)(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(t){var e,n=t.shape,r=void 0===n?"":n,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return hr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(r=r.toString());try{for(i.s();!(e=i.n()).done;){var o=e.value;-1===a.indexOf(o)&&a.push(o)}}catch(t){i.e(t)}finally{i.f()}})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(t){var e=t.shape,n=void 0===e?"":e;n="".concat(n),-1===a.indexOf(n)&&a.push(n)})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!0})}},{key:"generateGlyphLayout",value:function(t){var e=this,n=this.fontService.mapping,r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=this.layer.getEncodedData();this.glyphInfo=u.map((function(r){var i=r.shape,a=void 0===i?"":i,u=r.id,l=r.size,c=void 0===l?1:l,h=r.textOffset,p=void 0===h?[0,0]:h,f=je(a.toString(),n,c,s,"left",o,p,t),d=Ue(f,p,!1);return r.shaping=f,r.glyphQuads=d,r.centroid=(0,b.calculateCentroid)(r.coordinates),r.originCentroid="GAODE2.x"===r.version?(0,b.calculateCentroid)(r.originCoordinates):r.originCentroid=r.centroid,e.glyphInfoMap[u]={shaping:f,glyphQuads:d,centroid:(0,b.calculateCentroid)(r.coordinates)},r}))}},{key:"filterGlyphs",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.padding,r=void 0===n?[4,4]:n,i=e.textAllowOverlap;if(void 0===i||!i){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new ke(a,s);this.glyphInfo.filter((function(e){var n=e.shaping,i=e.id,o=void 0===i?0:i,a="GAODE2.x"===e.version?e.originCentroid:e.centroid,s=e.size/24,l=t.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length||(u.insertCollisionBox(c,o),0))})).forEach((function(e){t.glyphInfoMap[e.id]=e}))}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig().iconfont,e=void 0!==t&&t;e?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(e)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.fontService.canvas;this.textureHeight=e.height,this.texture&&this.texture.destroy(),this.texture=t({data:e,mag:i.gl.LINEAR,min:i.gl.LINEAR,width:e.width,height:e.height})}},{key:"reBuildModel",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:fr,fragmentShader:pr,triangulation:dr.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(r,o)}).then((function(e){t.layer.models=[e],t.layerService.throttleRenderLayers()})).catch((function(e){console.warn(e),t.layer.models=[]}))}}]),f}($);const gr={fillImage:ir,fill:rr,radar:ur,image:or,normal:sr,simplePoint:cr,extrude:er,text:mr,vectorPoint:Dn,tile:Ye,tileText:Xe,earthFill:tr,earthExtrude:$n};function yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var vr=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","PointLayer"),(0,h.Z)((0,s.Z)(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new gr[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,e=t.field,n=t.values,r=this.getLayerConfig().shape2d,i=this.iconService.getIconMap();if(e&&-1!==(null==r?void 0:r.indexOf(e)))return"fill";if(n&&n instanceof Array){var o,a=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return yr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;if("string"==typeof s&&i.hasOwnProperty(s))return"image"}}catch(t){a.e(t)}finally{a.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorPoint:{},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}},{key:"getModelType",value:function(){if(be(this.layerSource.getParserType()))return"vectorPoint";var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find((function(t){return t.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":"simple"===a?"simplePoint":"radar"===a?"radar":"fillImage"===this.layerType?"fillImage":-1!==(null==n?void 0:n.indexOf(a))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null==r?void 0:r.indexOf(a))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":i.hasOwnProperty(a)?"image":"text"}return this.getModelTypeWillEmptyData()}}]),i}(H);var _r=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.heightfixed,o=void 0!==r&&r,a=t.raisingHeight,s=void 0===a?0:a,u=t.topsurface,l=void 0===u||u,c=t.sidesurface,h=void 0===c||c,p=t.sourceColor,f=t.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var d=this.layer.getEncodedData(),m=this.calDataFrame(this.cellLength,d,this.cellProperties),g=m.data,y=m.width,v=m.height;this.rowCount=v,this.dataTexture=this.cellLength>0&&g.length>0?this.createTexture2D({flipY:!0,data:g,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:y,height:v}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}var _=0,x=[1,1,1,1],w=[1,1,1,1];return p&&f&&(x=(0,b.rgb2arr)(p),w=(0,b.rgb2arr)(f),_=1),{u_topsurface:Number(l),u_sidesurface:Number(h),u_heightfixed:Number(o),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(s),u_opacity:(0,E.isNumber)(n)?n:1,u_linearColor:_,u_sourceColor:x,u_targetColor:w,u_texture:this.texture}}},{key:"initModels",value:function(t){this.loadTexture(),this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i,a=this.getShaders(),s=a.frag,u=a.vert,l=a.type;this.layer.buildLayerModel({moduleName:l,vertexShader:u,fragmentShader:s,triangulation:Ht,stencil:(0,b.getMask)(r,o)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.pickLight;return t.mapTexture?{frag:'uniform sampler2D u_texture;\nuniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float isSide = styleMappingMat[0][3];\n  float lightWeight = styleMappingMat[3][1];\n  float topU = styleMappingMat[2][2];\n  float topV = styleMappingMat[2][3];\n\n  float sidey = styleMappingMat[3][0];\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      gl_FragColor = v_Color;\n    }\n  } else {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = texture2D(u_texture, vec2(topU, topV));\n  }\n  \n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  v_Color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v\n    0.0, 0.0, 0.0, 0.0  // sidey\n  );\n  \n  styleMappingMat[0][3] = a_Position.z;\n  styleMappingMat[2][2] = a_uvs[0];\n  styleMappingMat[2][3] = 1.0 - a_uvs[1];\n  styleMappingMat[3][0] = a_uvs[2];\n\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // project_pos.z += 500000.0; // amap1\n\n  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  styleMappingMat[3][1] = lightWeight;\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudeTexture"}:e?{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float isSide = styleMappingMat[0][3];\n  float sidey = styleMappingMat[3][0];\n  float lightWeight = styleMappingMat[3][1];\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      // side notuse linear\n       gl_FragColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    gl_FragColor = v_Color;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // sidey\n  );\n  styleMappingMat[0][3] = a_Position.z;\n  styleMappingMat[3][0] = a_uvs[2];\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  styleMappingMat[3][1] = lightWeight;\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudePickLight"}:{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];  \n  float isSide = styleMappingMat[0][3];\n  float sidey = styleMappingMat[3][0];\n  float lightWeight = styleMappingMat[3][1];\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      gl_FragColor = v_Color;\n    }\n\n  } else {\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = v_Color;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // sidey\n  );\n  styleMappingMat[0][3] = a_Position.z;\n  styleMappingMat[3][0] = a_uvs[2];\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // project_pos.z += 500000.0; // amap1\n\n  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  styleMappingMat[3][1] = lightWeight;\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t,e;null===(t=this.dataTexture)||void 0===t||t.destroy(),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=(0,I.Z)(t,4),n=e[0],r=e[1],o=e[2],a=e[3],s=o-n,u=a-r;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:i.AttributeType.Attribute,descriptor:{name:"a_uvs",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,i){var o=i[0],a=i[1];return[(o-n)/s,(a-r)/u,i[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?10:e;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:function(){var t=this,e=this.layer.getLayerConfig().mapTexture,n=this.rendererService.createTexture2D;if(this.texture=n({height:0,width:0}),e){var r=new Image;r.crossOrigin="",r.src=e,r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.LINEAR,mag:i.gl.LINEAR}),t.layerService.reRender()}}}}]),s}($);var xr=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.raisingHeight,n=void 0===e?0:e,r=t.opacity,o=void 0===r?1:r,a=t.opacityLinear,s=void 0===a?{enable:!1,dir:"in"}:a;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var u=this.layer.getEncodedData(),l=this.calDataFrame(this.cellLength,u,this.cellProperties),c=l.data,h=l.width,p=l.height;this.rowCount=p,this.dataTexture=this.cellLength>0&&c.length>0?this.createTexture2D({flipY:!0,data:c,format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:h,height:p}):this.createTexture2D({flipY:!0,data:[1],format:i.gl.LUMINANCE,type:i.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(n),u_opacity:(0,E.isNumber)(o)?o:1,u_opacitylinear:Number(s.enable),u_dir:"in"===s.dir?1:0}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.getModelParams(),n=e.frag,r=e.vert,o=e.triangulation,a=e.type,s=this.layer.getLayerConfig(),u=s.mask,l=void 0!==u&&u,c=s.maskInside,h=void 0===c||c,p=s.workerEnabled,f=void 0!==p&&p,d=s.enablePicking;this.layer.triangulation=o,this.layer.buildLayerModel({moduleName:a,vertexShader:r,fragmentShader:n,triangulation:o,primitive:i.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:(0,b.getMask)(l,h),workerEnabled:f,workerOptions:{modelType:a,enablePicking:d}}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().opacityLinear;(void 0===t?{enable:!1,dir:"in"}:t).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:i.AttributeType.Attribute,descriptor:{name:"a_linear",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig().opacityLinear;return(void 0===t?{enable:!1}:t).enable?{frag:'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  gl_FragColor = v_Color;\n  \n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity: 1.0;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nuniform float u_opacitylinear: 0.0;\n\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\nvoid main() {\n  if(u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  \n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}',type:"polygonLinear",triangulation:Vt}:{frag:'uniform float u_opacity: 1.0;\nvarying vec4 v_color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  gl_FragColor = v_color;\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_opacity: 1.0;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_color;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n\n',type:"polygonFill",triangulation:b.polygonFillTriangulation}}}]),s}($);var br=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.watercolor,i=void 0===r?"#6D99A8":r,o=t.watercolor2,a=void 0===o?"#0F121C":o;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:(0,b.rgb2arr)(i),u_watercolor2:(0,b.rgb2arr)(a),u_opacity:(0,E.isNumber)(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.loadTexture(),this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'attribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec2 v_uv;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"\nuniform float u_time: 0.0;\nuniform float u_opacity: 1.0;\n\nvarying vec2 v_uv;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)\n// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture2D(u_texture2,p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture2D(u_texture1,fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n\n  float opacity = u_opacity;\n  gl_FragColor = vec4(col, opacity);  \n}\n",triangulation:Zt,primitive:i.gl.TRIANGLES,depth:{enable:!1},stencil:(0,b.getMask)(r,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t,e,n;null===(t=this.texture1)||void 0===t||t.destroy(),null===(e=this.texture2)||void 0===e||e.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=(0,I.Z)(t,4),n=e[0],r=e[1],o=e[2],a=e[3],s=o-n,u=a-r;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:i.AttributeType.Attribute,descriptor:{name:"a_uv",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,i,o){var a=t.version===P.G["GAODE2.x"]?t.originCoordinates[0][o]:i,l=(0,I.Z)(a,2),c=l[0],h=l[1];return[(c-n)/s,(h-r)/u]}}})}},{key:"loadTexture",value:function(){var t,e,n,r=this,o=this.rendererService.createTexture2D,a={height:0,width:0};function s(t){return o({data:t,width:t.width,height:t.height,wrapS:i.gl.MIRRORED_REPEAT,wrapT:i.gl.MIRRORED_REPEAT,min:i.gl.LINEAR,mag:i.gl.LINEAR})}this.texture1=o(a),this.texture2=o(a),this.texture3=o(a),t=function(t){r.texture1=s(t[0]),r.texture2=s(t[1]),r.texture3=s(t[2]),r.layerService.reRender()},e=0,n=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){3==++e&&t(n)}}))}}]),s}($);const wr={fill:xr,line:qn,extrude:_r,text:mr,point_fill:rr,point_image:or,point_normal:sr,point_extrude:er,water:function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.speed,i=void 0===r?.5:r;return{u_texture:this.texture,u_speed:i,u_opacity:(0,E.isNumber)(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.loadTexture(),this.buildModels(t)}},{key:"buildModels",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,o=e.maskInside,a=void 0===o||o;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform sampler2D u_texture;\nuniform float u_time: 0.0;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n  float opacity = u_opacity;\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= opacity;\n\n  float spc = calSpc();\n  gl_FragColor += spc * 0.4;\n}\n",triangulation:Zt,primitive:i.gl.TRIANGLES,depth:{enable:!1},stencil:(0,b.getMask)(r,a)}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=(0,I.Z)(t,4),n=e[0],r=e[1],o=e[2],a=e[3],s=o-n,u=a-r;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:i.AttributeType.Attribute,descriptor:{name:"a_uv",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,i,o){var a=t.version===P.G["GAODE2.x"]?t.originCoordinates[0][o]:i,l=(0,I.Z)(a,2),c=l[0],h=l[1];return[(c-n)/s,(h-r)/u]}}})}},{key:"loadTexture",value:function(){var t=this,e=this.layer.getLayerConfig().waterTexture,n=this.rendererService.createTexture2D;this.texture=n({height:0,width:0});var r=new Image;r.crossOrigin="",e?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=e):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.MIRRORED_REPEAT,wrapT:i.gl.MIRRORED_REPEAT,min:i.gl.LINEAR,mag:i.gl.LINEAR}),t.layerService.reRender()}}}]),s}($),ocean:br,vectorpolygon:Dn,tile:Ke};var Sr=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","PolygonLayer"),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new wr[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"getModelType",value:function(){var t;if(be(this.layerSource.getParserType()))return"vectorpolygon";var e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==e||null===(t=e.scale)||void 0===t?void 0:t.field;return"fill"===n?"fill":"extrude"===n?"extrude":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":"tile"===n?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find((function(t){return t.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),i}(H);var Er=function(t){(0,u.Z)(f,t);var e,n,r,s,h=(r=f,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(r);if(s){var n=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function f(){return(0,o.Z)(this,f),h.apply(this,arguments)}return(0,a.Z)(f,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.clampLow,i=void 0===r||r,o=t.clampHigh,a=void 0===o||o,s=t.noDataValue,u=void 0===s?-9999999:s,l=t.domain,c=void 0===l?[0,1]:l,h=t.rampColors;return(0,E.isEqual)(this.rampColors,h)||(this.updateColorTexture(),this.rampColors=h),{u_opacity:n||1,u_texture:this.texture,u_domain:c,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:(n=(0,p.Z)(v().mark((function t(e){var n,r,i,o;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Array.isArray(e.data)){t.next=4;break}return t.abrupt("return",{data:e.data,width:e.width,height:e.height});case 4:return t.next=6,e.data;case 6:return n=t.sent,r=n.rasterData,i=n.width,o=n.height,t.abrupt("return",{data:Array.from(r),width:i,height:o});case 11:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})},{key:"initModels",value:(e=(0,p.Z)(v().mark((function t(e){var n,r,o,a,s,u,l,c,h,p,f,d,m,g,y;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.layer.getLayerConfig(),r=n.mask,o=void 0!==r&&r,a=n.maskInside,s=void 0===a||a,u=n.rampColorsData,l=n.rampColors,c=this.layer.getSource(),h=this.rendererService.createTexture2D,p=c.data.dataArray[0],t.next=6,this.getRasterData(p);case 6:f=t.sent,d=f.data,m=f.width,g=f.height,this.texture=h({data:d,width:m,height:g,format:i.gl.LUMINANCE,type:i.gl.FLOAT}),y=u||(0,b.generateColorRamp)(l),this.colorTexture=h({data:y.data,width:y.width,height:y.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\n\n\n\n// float getBlurIndusty() {\n//   vec2 u_ViewportSize = vec2(1024);\n\n//     float vW = 2.0/u_ViewportSize.x;\n//     float vH = 2.0/u_ViewportSize.y;\n//     vec2 vUv = v_texCoord;\n//     float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n//     float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n//     float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n//     float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n//     float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\n//     float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n//     float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n//     float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n//     float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n//     return(\n//         i11 + \n//         i12 + \n//         i13 + \n//         i21 + \n//         i21 + \n//         i22 + \n//         i23 + \n//         i31 + \n//         i32 + \n//         i33\n//         )/9.0;\n// }\n\nvoid main() {\n\n  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\n\n  // float value = getBlurIndusty();\n\n\n  if (value == u_noDataValue)\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n    gl_FragColor = vec4(0, 0, 0, 0);\n  else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\n    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n  }\n}\n",triangulation:qt,primitive:i.gl.TRIANGLES,depth:{enable:!1},stencil:(0,b.getMask)(o,s)}).then((function(t){e([t])})).catch((function(t){console.warn(t),e([])}));case 14:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.layer.getLayerConfig().rampColors,n=(0,b.generateColorRamp)(e);this.colorTexture=t({data:n.data,width:n.width,height:n.height,flipY:!1})}}]),f}($);const Cr={raster:Er,rasterRgb:yn,raster3d:Er,rasterTile:Dn};var Mr=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","RasterLayer"),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new Cr[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"getDefaultConfig",value:function(){return{raster:{},rasterRgb:{},raster3d:{},rasterTile:{}}[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.getParserType()){case"raster":default:return"raster";case"rasterRgb":return"rasterRgb";case"rasterTile":return"rasterTile"}}}]),i}(H);var Tr=function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t;return{u_opacity:(0,E.isNumber)(e)?e:1}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(t){this.layer.zIndex=-997,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nvarying float v_CamreaDistance;\n\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvarying float v_offset;\n\nvoid main() {\n    float EARTH_RADIUS = 100.0;\n    \n    v_Color = a_Color;\n\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\n\nvarying vec3 vVertexNormal;\nvarying float v_offset;\nvarying vec4 v_Color;\nvoid main() {\n    \n    \n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",triangulation:Qt,depth:{enable:!1},blend:this.getBlend()}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),s}($);var Ar={base:function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"earthTime",3.4),(0,h.Z)((0,s.Z)(t),"sunX",1e3),(0,h.Z)((0,s.Z)(t),"sunY",1e3),(0,h.Z)((0,s.Z)(t),"sunZ",1e3),(0,h.Z)((0,s.Z)(t),"sunRadius",Math.sqrt(t.sunX*t.sunX+t.sunY*t.sunY+t.sunZ*t.sunZ)),t}return(0,a.Z)(p,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=t.globalOptions;return null!=e&&e.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(t){this.earthTime=t,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:function(t){var e=this,n=this.layer.getLayerConfig().globalOptions;void 0!==(null==n?void 0:n.earthTime)&&this.setEarthTime(n.earthTime);var r=this.layer.getSource(),i=this.rendererService.createTexture2D;this.texture=i({height:0,width:0}),r.data.images.then((function(t){e.texture=i({data:t[0],width:t[0].width,height:t[0].height}),e.layerService.reRender()})),this.buildModels(t)}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(t){this.layer.zIndex=-998,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:"// attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\n// attribute vec2 a_Extrude;\n// attribute float a_Size;\n// attribute float a_Shape;\n\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform float u_ambientRatio : 0.5;\nuniform float u_diffuseRatio : 0.3;\nuniform float u_specularRatio : 0.2;\nuniform vec3 u_sunLight: [1.0, -10.5, 12.0];\n\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n\n    // cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(u_sunLight);\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n    // lambert\n    float lambert = dot(worldNormal, lightDir);\n    // specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n    //sum to light weight\n    float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\n\n    return lightWeight;\n}\n\nvarying float v_lightWeight;\nvoid main() {\n\n    v_texCoord = a_Uv;\n\n    float lightWeight = calc_lighting(vec4(a_Position, 1.0));\n    v_lightWeight = lightWeight;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform sampler2D u_texture;\n\nvarying vec2 v_texCoord;\nvarying float v_lightWeight;\n\n\nvoid main() {\n\n    vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n    color.xyz = color.xyz * v_lightWeight;\n    gl_FragColor = color;\n}\n",triangulation:Qt,depth:{enable:!0},blend:this.getBlend()}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),p}($),atomSphere:Tr,bloomSphere:function(t){(0,u.Z)(s,t);var e,n,r=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function s(){return(0,o.Z)(this,s),r.apply(this,arguments)}return(0,a.Z)(s,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t;return{u_opacity:(0,E.isNumber)(e)?e:1}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(t){this.layer.zIndex=-999,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\n\nvoid main() {\n    v_Color = a_Color;\n\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\n\nvarying vec4 v_Color;\nvoid main() {\n\n\n    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",triangulation:Jt,depth:{enable:!1},blend:this.getBlend()}).then((function(e){t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),s}($)},Pr=["base","atomSphere","bloomSphere"],Lr=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","EarthLayer"),(0,h.Z)((0,s.Z)(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new Ar[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"setEarthTime",value:function(t){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(t):console.warn("请在 scene loaded 之后执行该方法！")}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"base";return Pr.indexOf(n)<0&&(n="base"),n}}]),i}(H);const Ir={fill:Qe,vectorMask:Dn};function kr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Or=function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","MaskLayer"),t}return(0,a.Z)(p,[{key:"init",value:function(){var t=this,e=this.container.get(i.TYPES.SceneID);this.configService.setLayerConfig(e,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.rendererService=this.container.get(i.TYPES.IRendererService),this.layerService=this.container.get(i.TYPES.ILayerService),this.mapService=this.container.get(i.TYPES.IMapService),this.cameraService=this.container.get(i.TYPES.ICameraService),this.coordinateService=this.container.get(i.TYPES.ICoordinateSystemService),this.shaderModuleService=this.container.get(i.TYPES.IShaderModuleService),this.postProcessingPassFactory=this.container.get(i.TYPES.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(i.TYPES.IFactoryNormalPass),this.styleAttributeService=this.container.get(i.TYPES.IStyleAttributeService),this.pendingStyleAttributes.forEach((function(e){var n=e.attributeName,r=e.attributeField,i=e.attributeValues,o=e.updateOptions;t.styleAttributeService.updateStyleAttribute(n,{scale:(0,d.Z)({field:r},t.splitValuesAndCallbackInAttribute(i,t.getLayerConfig()[n]))},o)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(i.TYPES.ILayerPlugin);var n,r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return kr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.plugins);try{for(r.s();!(n=r.n()).done;)n.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(t){r.e(t)}finally{r.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new Ir[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"getModelType",value:function(){return be(this.layerSource.getParserType())?"vectorMask":"fill"}}]),p}(H);function Rr(t,e,n){var r=Dr(t,t.VERTEX_SHADER,e),i=Dr(t,t.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=t.createProgram();if(!o)return null;if(t.attachShader(o,r),t.attachShader(o,i),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){var a=t.getProgramInfoLog(o);return console.warn("Failed to link program: "+a),t.deleteProgram(o),t.deleteShader(i),t.deleteShader(r),null}for(var s=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var l=t.getActiveAttrib(o,u);o[l.name]=t.getAttribLocation(o,l.name)}for(var c=t.getProgramParameter(o,t.ACTIVE_UNIFORMS),h=0;h<c;h++){var p=t.getActiveUniform(o,h);o[p.name]=t.getUniformLocation(o,p.name)}return o.vertexShader=r,o.fragmentShader=i,o}function Dr(t,e,n){var r=t.createShader(e);if(null==r)return console.warn("unable to create shader"),null;if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(r);return console.warn("Failed to compile shader: "+i),t.deleteShader(r),null}return r}function Nr(t,e,n,r,i){var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,i,0,t.RGBA,t.UNSIGNED_BYTE,n),t.bindTexture(t.TEXTURE_2D,null),o}function Fr(t,e,n){t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,e)}function zr(t,e){var n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),n}function Br(t){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];r.addColorStop(+a,t[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),e=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function jr(t,e,n,r){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,r,t.FLOAT,!1,0,0)}function Ur(t,e,n){t.bindFramebuffer(t.FRAMEBUFFER,e),n&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}var Zr=function(){function t(e){(0,o.Z)(this,t),(0,h.Z)(this,"width",512),(0,h.Z)(this,"height",512),(0,h.Z)(this,"numParticles",65536),this.gl=e.glContext,this.width=e.imageWidth,this.height=e.imageHeight,this.fadeOpacity=e.fadeOpacity,this.speedFactor=e.speedFactor,this.dropRate=e.dropRate,this.dropRateBump=e.dropRateBump,this.rampColors=e.rampColors,this.init()}return(0,a.Z)(t,[{key:"init",value:function(){var t=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=Rr(t,"\n precision mediump float;\n\n attribute float a_index;\n\n uniform sampler2D u_particles;\n uniform float u_particles_res;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n\n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n\n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // color ramp is encoded in a 16x16 texture\n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=Rr(t,"\n     precision mediump float;\n\n     attribute vec2 a_pos;\n\n     varying vec2 v_tex_pos;\n\n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n\n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n\n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=Rr(t,"\n precision mediump float;\n\n attribute vec2 a_pos;\n\n varying vec2 v_tex_pos;\n\n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer 始终用铺满屏幕的 texture\n }","\n precision highp float;\n\n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n\n varying vec2 v_tex_pos;\n\n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n\n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n\n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n\n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n\n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n\n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=zr(t,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=t.createFramebuffer(),this.colorRampTexture=Nr(this.gl,this.gl.LINEAR,Br(this.rampColors),16,16);var e=new Uint8Array(this.width*this.height*4);this.backgroundTexture=Nr(t,t.NEAREST,e,this.width,this.height),this.screenTexture=Nr(t,t.NEAREST,e,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=Nr(t,t.NEAREST,r,n,n),this.particleStateTexture1=Nr(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=zr(t,o)}},{key:"setWind",value:function(t){var e,n,r,i;this.windData=t,this.windTexture=(e=this.gl,n=this.gl.LINEAR,r=t.image,i=e.createTexture(),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.bindTexture(e.TEXTURE_2D,null),i)}},{key:"updateParticelNum",value:function(t){var e=this.gl;if(t!==this.numParticles){this.numParticles=t;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=Nr(e,e.NEAREST,r,n,n),this.particleStateTexture1=Nr(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=zr(e,o)}}},{key:"updateWindDir",value:function(t,e,n,r){this.windData.uMin=t,this.windData.uMax=e,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(t){if(this.isColorChanged(t)){this.rampColors=t;var e=this.gl;e.deleteTexture(this.colorRampTexture),this.colorRampTexture=Nr(e,e.LINEAR,Br(t),16,16)}}},{key:"isColorChanged",value:function(t){for(var e=0,n=Object.keys(t);e<n.length;e++){var r=n[e],i=Number(r);if(!this.rampColors[i])return!0;if(this.rampColors[i]&&this.rampColors[i]!==t[i])return!0}return!1}},{key:"reSize",value:function(t,e){if(t!==this.width||e!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=t,this.height=e;var r=new Uint8Array(t*e*4);this.backgroundTexture=Nr(n,n.NEAREST,r,t,e),this.screenTexture=Nr(n,n.NEAREST,r,t,e)}}},{key:"draw",value:function(){var t;if(null!==(t=this.windData)&&void 0!==t&&t.image){var e=this.gl;return Fr(e,this.windTexture,0),Fr(e,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var t=this.gl;Ur(t,this.framebuffer,this.screenTexture),t.viewport(0,0,this.width,this.height),t.disable(t.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.pixels),Ur(t,null,null),t.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var e=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=e}},{key:"drawFullTexture",value:function(t,e){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),Fr(n,t,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,e),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var t=this.gl,e=this.drawProgram;t.useProgram(e),jr(t,this.particleIndexBuffer,e.a_index,1),Fr(t,this.colorRampTexture,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1i(e.u_color_ramp,2),t.uniform1f(e.u_particles_res,this.particleStateResolution),t.uniform2f(e.u_wind_min,this.windData.uMin,this.windData.vMin),t.uniform2f(e.u_wind_max,this.windData.uMax,this.windData.vMax),t.drawArrays(t.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var t=this.gl;Ur(t,this.framebuffer,this.particleStateTexture1),t.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var e=this.updateProgram;t.useProgram(e),jr(t,this.quadBuffer,e.a_pos,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1f(e.u_rand_seed,Math.random()),t.uniform2f(e.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),t.uniform2f(e.u_wind_min,this.windData.uMin,this.windData.vMin),t.uniform2f(e.u_wind_max,this.windData.uMax,this.windData.vMax),t.uniform1f(e.u_speed_factor,this.speedFactor),t.uniform1f(e.u_drop_rate,this.dropRate),t.uniform1f(e.u_drop_rate_bump,this.dropRateBump),t.drawArrays(t.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,Ur(t,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),t}();var Vr={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"};const Gr={wind:function(t){(0,u.Z)(p,t);var e,n,r=(e=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,o.Z)(this,p);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"sizeScale",.5),(0,h.Z)((0,s.Z)(t),"frequency",new b.FrequencyController(7.2)),t}return(0,a.Z)(p,[{key:"render",value:function(){var t=this;this.frequency.run((function(){t.drawWind()})),this.drawColorMode()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(t){var e,n,r,o=this,a=this.layer.getLayerConfig(),s=a.uMin,u=void 0===s?-21.32:s,l=a.uMax,c=void 0===l?26.8:l,h=a.vMin,p=void 0===h?-21.57:h,f=a.vMax,d=void 0===f?21.42:f,m=a.fadeOpacity,g=void 0===m?.996:m,y=a.speedFactor,v=void 0===y?.25:y,_=a.dropRate,x=void 0===_?.003:_,w=a.dropRateBump,S=void 0===w?.01:w,E=a.rampColors,C=void 0===E?Vr:E,M=a.sizeScale,T=void 0===M?.5:M,A=a.mask,P=void 0!==A&&A,L=a.maskInside,I=void 0===L||L,k=this.rendererService.createTexture2D,O=this.layer.getSource();this.texture=k({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom());var R=this.rendererService.getGLContext();this.imageCoords=null===(e=O.data)||void 0===e?void 0:e.dataArray[0].coordinates,null===(n=O.data)||void 0===n||null===(r=n.images)||void 0===r||r.then((function(t){var e;o.sizeScale=T*o.getZoomScale();var n=o.getWindSize(),r=n.imageWidth,i=n.imageHeight,a={glContext:R,imageWidth:r,imageHeight:i,fadeOpacity:g,speedFactor:v,dropRate:x,dropRateBump:S,rampColors:C};o.wind=new Zr(a),o.wind.setWind({uMin:u,uMax:c,vMin:p,vMax:d,image:t[0]}),null===(e=o.texture)||void 0===e||e.destroy(),o.texture=k({width:r,height:i}),o.layerService.reRender()})),this.layer.buildLayerModel({moduleName:"wind",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:qt,primitive:i.gl.TRIANGLES,depth:{enable:!1},stencil:(0,b.getMask)(P,I),blend:this.getBlend()}).then((function(e){o.colorModel=e,t([e])})).catch((function(e){console.warn(e),t([])}))}},{key:"getWindSize",value:function(){var t=this.mapService.lngLatToPixel(this.imageCoords[0]),e=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.min(Math.floor((e.x-t.x)*this.sizeScale),2048),imageHeight:Math.min(Math.floor((t.y-e.y)*this.sizeScale),2048)}}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.wind)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var t=this.layer.getLayerConfig(),e=t.uMin,n=void 0===e?-21.32:e,r=t.uMax,i=void 0===r?26.8:r,o=t.vMin,a=void 0===o?-21.57:o,s=t.vMax,u=void 0===s?21.42:s,l=t.numParticles,c=void 0===l?65535:l,h=t.fadeOpacity,p=void 0===h?.996:h,f=t.speedFactor,d=void 0===f?.25:f,m=t.dropRate,g=void 0===m?.003:m,y=t.dropRateBump,v=void 0===y?.01:y,_=t.rampColors,x=void 0===_?Vr:_,b=t.sizeScale,w=void 0===b?.5:b,S=c,E=Math.floor(this.mapService.getZoom());if("number"==typeof w&&w!==this.sizeScale||E!==this.cacheZoom){var C=this.getZoomScale();this.sizeScale=w,S*=C;var M=this.getWindSize(),T=M.imageWidth,A=M.imageHeight;this.wind.reSize(T,A),this.cacheZoom=E}this.wind.updateWindDir(n,i,a,u),this.wind.updateParticelNum(S),this.wind.updateColorRampTexture(x),this.wind.fadeOpacity=p,this.wind.speedFactor=d,this.wind.dropRate=g,this.wind.dropRateBump=v;var P=this.wind.draw(),L=P.d,I=P.w,k=P.h;this.rendererService.setBaseState(),this.texture.update({data:L,width:I,height:k})}}},{key:"drawColorMode",value:function(){var t,e=this.layer.getLayerConfig().opacity;this.layer.masks.map((function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.render(),t.hooks.afterRender.call()})),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:e||1,u_texture:this.texture}})}}]),p}($)};var Hr=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","WindLayer"),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this,e=this.getModelType();this.layerModel=new Gr[e](this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels((function(e){t.dispatchModelLoad(e)}))}},{key:"renderModels",value:function(){return this.layerModel&&this.layerModel.render(),this}},{key:"getDefaultConfig",value:function(){return{wind:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]),i}(H);var Wr,qr,Xr,Yr,Kr,Qr,Jr,$r,ti=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,o.Z)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n)),(0,h.Z)((0,s.Z)(t),"type","TileDebugLayer"),(0,h.Z)((0,s.Z)(t),"defaultSourceConfig",{data:[],options:{parser:{type:"testTile",cancelExtent:!0}}}),t}return(0,a.Z)(i,[{key:"buildModels",value:function(){var t=this;this.layerModel=new Dn(this),this.layerModel.initModels((function(e){t.dispatchModelLoad(e)}))}}]),i}(H),ei=(Wr=(0,le.b2)(),qr=(0,le.f3)(i.TYPES.IMapService),Xr=(0,le.f3)(i.TYPES.IFontService),Wr((Kr=function(){function t(){(0,o.Z)(this,t),(0,m.Z)(this,"mapService",Qr,this),(0,m.Z)(this,"fontService",Jr,this)}return(0,a.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",(function(){var e=t.getSource();e.inited?n.generateMaping(t,{styleAttributeService:r}):e.once("update",(function(){n.generateMaping(t,{styleAttributeService:r})}))})),t.hooks.beforeRenderData.tap("DataMappingPlugin",(function(){t.dataState.dataMappingNeedUpdate=!1;var e=t.getSource();return e.inited?n.generateMaping(t,{styleAttributeService:r}):e.once("update",(function(){n.generateMaping(t,{styleAttributeService:r})})),!0})),t.hooks.beforeRender.tap("DataMappingPlugin",(function(){if("basemap"!==t.getLayerConfig().usage){var e=t.getSource();if(!t.layerModelNeedUpdate&&e&&e.inited){var i=t.getBottomColor(),o=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),s=e.data.dataArray,u=o.filter((function(t){return t.needRemapping})),l=s;if(null!=a&&a.needRemapping&&null!=a&&a.scale&&(l=s.filter((function(t){return n.applyAttributeMapping(a,t,i)[0]}))),u.length){if(null!=a&&a.needRemapping){var c=n.mapping(t,o,l,void 0,i);t.setEncodedData(c),a.needRemapping=!1}else{var h=n.mapping(t,u,l,t.getEncodedData(),i);t.setEncodedData(h)}t.emit("remapping",null)}}}}))}},{key:"generateMaping",value:function(t,e){var n=this,r=e.styleAttributeService,i=t.getBottomColor(),o=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),s=t.getSource().data.dataArray,u=s;null!=a&&a.scale&&(u=s.filter((function(t){return n.applyAttributeMapping(a,t,i)[0]})));var l=this.mapping(t,o,u,void 0,i);t.setEncodedData(l),t.emit("dataUpdate",null)}},{key:"mapping",value:function(t,e,n,r,i){var o=this,a=t.getLayerConfig(),s=a.arrow,u=void 0===s?{enable:!1}:s;if("basemap"===a.usage)return this.mapLayerMapping(t,e,n,r);var l=e.filter((function(t){return void 0!==t.scale})),c=n.map((function(e,n){var a=r?r[n]:{},s=(0,d.Z)({id:e._id,coordinates:e.coordinates},a);if(l.forEach((function(t){var n=o.applyAttributeMapping(t,e,i);t.needRemapping=!1,"color"===t.name&&(n=n.map((function(t){return(0,b.rgb2arr)(t)}))),s[t.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===t.name&&(s.shape=o.fontService.getIconFontKey(s[t.name]))})),u.enable&&("line"===s.shape||"halfLine"===s.shape)){var c=s.coordinates;if(t.arrowInsertCount<t.encodeDataLength){var h=o.getArrowPoints(c[0],c[1]);s.coordinates.splice(1,0,h,h),t.arrowInsertCount++}}return s}));return this.adjustData2Amap2Coordinates(c,t),this.adjustData2SimpleCoordinates(c),c}},{key:"mapLayerMapping",value:function(t,e,n,r){var i=this,o=e.filter((function(t){return void 0!==t.scale})),a=n.map((function(e,n){var a=r?r[n]:{},s=(0,d.Z)({id:e._id,coordinates:e.coordinates},a);return o.forEach((function(n){var r;if("shape"===n.name&&"simple"===(null===(r=t.shapeOption)||void 0===r?void 0:r.field))s[n.name]="simple",n.needRemapping=!1;else{var o=i.applyMapLayerAttributeMapping(n,e);n.needRemapping=!1,s[n.name]=Array.isArray(o)&&1===o.length?o[0]:o,"shape"===n.name&&(s.shape=i.fontService.getIconFontKey(s[n.name]))}})),void 0===s.size&&(s.size=1),s}));return this.adjustData2Amap2Coordinates(a,t),a}},{key:"adjustData2Amap2Coordinates",value:function(t,e){var n=this;if(t.length>0&&this.mapService.version===P.G["GAODE2.x"]){var r=e.coordCenter||e.getSource().center;"number"==typeof t[0].coordinates[0]?t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=P.G["GAODE2.x"],t.originCoordinates=(0,E.cloneDeep)(t.coordinates),t.coordinates=n.mapService.lngLatToCoordByLayer(t.coordinates,r)})):t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=P.G["GAODE2.x"],t.originCoordinates=(0,E.cloneDeep)(t.coordinates),t.coordinates=n.mapService.lngLatToCoordsByLayer(t.coordinates,r)}))}}},{key:"adjustData2SimpleCoordinates",value:function(t){var e=this;t.length>0&&this.mapService.version===P.G.SIMPLE&&t.map((function(t){t.simpleCoordinate||(t.coordinates=e.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(t){var e=this;if("number"==typeof t[0])return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var n=[];return t.map((function(t){var r=[];t.map((function(t){r.push(e.mapService.simpleMapCoord.unproject(t))})),n.push(r)})),n}var r=[];return t.map((function(t){r.push(e.mapService.simpleMapCoord.unproject(t))})),r}},{key:"applyAttributeMapping",value:function(t,e,n){var r;if(!t.scale)return[];var i=(null==t||null===(r=t.scale)||void 0===r?void 0:r.scalers)||[],o=[];i.forEach((function(n){var r,i=n.field;(e.hasOwnProperty(i)||"variable"===(null===(r=t.scale)||void 0===r?void 0:r.type))&&o.push(e[i])}));var a=t.mapping?t.mapping(o):[];return"color"!==t.name||(0,b.isColor)(a[0])?a:[n]}},{key:"applyMapLayerAttributeMapping",value:function(t,e){var n;if(!t.scale)return[];var r=(null==t||null===(n=t.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(e.hasOwnProperty(o)||"variable"===(null===(r=t.scale)||void 0===r?void 0:r.type))&&i.push(e[o])})),t.mapping?t.mapping(i):[]}},{key:"getArrowPoints",value:function(t,e){var n=[e[0]-t[0],e[1]-t[1]],r=(0,b.normalize)(n);return[t[0]+1e-4*r[0],t[1]+1e-4*r[1]]}}]),t}(),Qr=(0,g.Z)(Kr.prototype,"mapService",[qr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jr=(0,g.Z)(Kr.prototype,"fontService",[Xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yr=Kr))||Yr),ni=(0,le.b2)()($r=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t){var e=this;this.mapService=t.getContainer().get(i.TYPES.IMapService),t.hooks.init.tap("DataSourcePlugin",(function(){var n=t.getSource();if(!n){var r=t.sourceOption||t.defaultSourceConfig,i=r.data,o=r.options;n=new x.default(i,o),t.setSource(n)}n.inited?e.updateClusterData(t):n.once("update",(function(){e.updateClusterData(t)}))})),t.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){var n=e.updateClusterData(t),r=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,n||r}))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer)return!1;var e=t.getSource(),n=e.cluster,r=e.clusterOptions.zoom,i=void 0===r?0:r,o=this.mapService.getZoom()-1,a=t.dataState.dataSourceNeedUpdate;return n&&a&&e.updateClusterData(Math.floor(o)),!!(n&&Math.abs(t.clusterZoom-o)>=1)&&(i!==Math.floor(o)&&e.updateClusterData(Math.floor(o)),t.clusterZoom=o,!0)}}]),t}())||$r,ri=n(937);function ii(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}function oi(t){return function(){return t}}function ai(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):oi(isNaN(t)?e:t)}const si=function t(e){var n=function(t){return 1==(t=+t)?ai:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):oi(isNaN(e)?n:e)}}(e);function r(t,e){var r=n((t=(0,q.B8)(t)).r,(e=(0,q.B8)(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=ai(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function ui(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=(0,q.B8)(e[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=t(o),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=s(t),r+""}}}var li=ui((function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return ii((n-r/e)*e,a,i,o,s)}})),ci=(ui((function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return ii((n-r/e)*e,i,o,a,s)}})),"$");function hi(){}function pi(t,e){var n=new hi;if(t instanceof hi)t.each((function(t,e){n.set(e,t)}));else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}hi.prototype=pi.prototype={constructor:hi,has:function(t){return ci+t in this},get:function(t){return this[ci+t]},set:function(t,e){return this[ci+t]=e,this},remove:function(t){var e=ci+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===ci&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===ci&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===ci&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===ci&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===ci&&++t;return t},empty:function(){for(var t in this)if(t[0]===ci)return!1;return!0},each:function(t){for(var e in this)e[0]===ci&&t(this[e],e.slice(1),this)}};const fi=pi;function di(){}var mi=fi.prototype;di.prototype=function(t,e){var n=new di;if(t instanceof di)t.each((function(t){n.add(t)}));else if(t){var r=-1,i=t.length;if(null==e)for(;++r<i;)n.add(t[r]);else for(;++r<i;)n.add(e(t[r],r,t))}return n}.prototype={constructor:di,has:mi.has,add:function(t){return this[ci+(t+="")]=t,this},remove:mi.remove,clear:mi.clear,values:mi.keys,size:mi.size,empty:mi.empty,each:mi.each};var gi=Array.prototype,yi=gi.map,vi=gi.slice;function _i(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function xi(t,e){switch(arguments.length){case 0:break;case 1:this.interpolator(t);break;default:this.interpolator(e).domain(t)}return this}var bi={name:"implicit"};function wi(){var t=fi(),e=[],n=[],r=bi;function i(i){var o=i+"",a=t.get(o);if(!a){if(r!==bi)return r;t.set(o,a=e.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=fi();for(var r,o,a=-1,s=n.length;++a<s;)t.has(o=(r=n[a])+"")||t.set(o,e.push(r));return i},i.range=function(t){return arguments.length?(n=vi.call(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return wi(e,n).unknown(r)},_i.apply(i,arguments),i}function Si(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=Ii(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}}function Ei(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Ci(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Mi(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=Ii(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var Ti=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ai=new RegExp(Ti.source,"g");function Pi(t,e){var n,r,i,o=Ti.lastIndex=Ai.lastIndex=0,a=-1,s=[],u=[];for(t+="",e+="";(n=Ti.exec(t))&&(r=Ai.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Ci(n,r)})),o=Ai.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function Li(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function Ii(t,e){var n,r,i=typeof e;return null==e||"boolean"===i?oi(e):("number"===i?Ci:"string"===i?(n=(0,q.ZP)(e))?(e=n,si):Pi:e instanceof q.ZP?si:e instanceof Date?Ei:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?Si:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Mi:Ci:Li))(t,e)}function ki(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Oi(t){return+t}var Ri=[0,1];function Di(t){return t}function Ni(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Fi(t){var e,n=t[0],r=t[t.length-1];return n>r&&(e=n,n=r,r=e),function(t){return Math.max(n,Math.min(r,t))}}function zi(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=Ni(i,r),o=n(a,o)):(r=Ni(r,i),o=n(o,a)),function(t){return o(r(t))}}function Bi(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=Ni(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=(0,ri.b4)(t,e,1,r)-1;return o[n](i[n](e))}}function ji(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ui(){var t,e,n,r,i,o,a=Ri,s=Ri,u=Ii,l=Di;function c(){return r=Math.min(a.length,s.length)>2?Bi:zi,i=o=null,h}function h(e){return isNaN(e=+e)?n:(i||(i=r(a.map(t),s,u)))(t(l(e)))}return h.invert=function(n){return l(e((o||(o=r(s,a.map(t),Ci)))(n)))},h.domain=function(t){return arguments.length?(a=yi.call(t,Oi),l===Di||(l=Fi(a)),c()):a.slice()},h.range=function(t){return arguments.length?(s=vi.call(t),c()):s.slice()},h.rangeRound=function(t){return s=vi.call(t),u=ki,c()},h.clamp=function(t){return arguments.length?(l=t?Fi(a):Di,h):l!==Di},h.interpolate=function(t){return arguments.length?(u=t,c()):u},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,c()}}function Zi(t,e){return Ui()(t,e)}var Vi,Gi=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Hi(t){if(!(e=Gi.exec(t)))throw new Error("invalid format: "+t);var e;return new Wi({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Wi(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function qi(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Xi(t){return(t=qi(Math.abs(t)))?t[1]:NaN}function Yi(t,e){var n=qi(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Hi.prototype=Wi.prototype,Wi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Ki={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return Yi(100*t,e)},r:Yi,s:function(t,e){var n=qi(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(Vi=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+qi(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function Qi(t){return t}var Ji,$i,to,eo=Array.prototype.map,no=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ro(t){var e=t.domain;return t.ticks=function(t){var n=e();return(0,ri.sd)(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return function(t,e,n,r){var i,o=(0,ri.ly)(t,e,n);switch((r=Hi(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Xi(e)/3)))-Xi(Math.abs(t)))}(o,a))||(r.precision=i),to(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Xi(e)-Xi(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-Xi(Math.abs(t)))}(o))||(r.precision=i-2*("%"===r.type))}return $i(r)}(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i=e(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=(0,ri.G9)(s,u,n))>0?(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,r=(0,ri.G9)(s,u,n)):r<0&&(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,r=(0,ri.G9)(s,u,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,e(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,e(i)),t},t}function io(t,e){var n,r=0,i=(t=t.slice()).length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}function oo(t){return Math.log(t)}function ao(t){return Math.exp(t)}function so(t){return-Math.log(-t)}function uo(t){return-Math.exp(-t)}function lo(t){return isFinite(t)?+("1e"+t):t<0?0:t}function co(t){return function(e){return-t(-e)}}function ho(t){var e,n,r=t(oo,ao),i=r.domain,o=10;function a(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(o),n=function(t){return 10===t?lo:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(o),i()[0]<0?(e=co(e),n=co(n),t(so,uo)):t(oo,ao),r}return r.base=function(t){return arguments.length?(o=+t,a()):o},r.domain=function(t){return arguments.length?(i(t),a()):i()},r.ticks=function(t){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(p=s,s=u,u=p);var l,c,h,p=e(s),f=e(u),d=null==t?10:+t,m=[];if(!(o%1)&&f-p<d){if(p=Math.round(p)-1,f=Math.round(f)+1,s>0){for(;p<f;++p)for(c=1,l=n(p);c<o;++c)if(!((h=l*c)<s)){if(h>u)break;m.push(h)}}else for(;p<f;++p)for(c=o-1,l=n(p);c>=1;--c)if(!((h=l*c)<s)){if(h>u)break;m.push(h)}}else m=(0,ri.sd)(p,f,Math.min(f-p,d)).map(n);return r?m.reverse():m},r.tickFormat=function(t,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=$i(i)),t===1/0)return i;null==t&&(t=10);var a=Math.max(1,o*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*o<o-.5&&(r*=o),r<=a?i(t):""}},r.nice=function(){return i(io(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r}function po(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function fo(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function mo(t){return t<0?-t*t:t*t}function go(t){var e=t(Di,Di),n=1;function r(){return 1===n?t(Di,Di):.5===n?t(fo,mo):t(po(n),po(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,r()):n},ro(e)}Ji=function(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Qi:(e=eo.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?Qi:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(eo.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"-":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=Hi(t)).fill,n=t.align,h=t.sign,p=t.symbol,f=t.zero,d=t.width,m=t.comma,g=t.precision,y=t.trim,v=t.type;"n"===v?(m=!0,v="g"):Ki[v]||(void 0===g&&(g=12),y=!0,v="g"),(f||"0"===e&&"="===n)&&(f=!0,e="0",n="=");var _="$"===p?i:"#"===p&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===p?o:/[%p]/.test(v)?u:"",b=Ki[v],w=/[defgprs%]/.test(v);function S(t){var i,o,u,p=_,S=x;if("c"===v)S=b(t)+S,t="";else{var E=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:b(Math.abs(t),g),y&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),E&&0==+t&&"+"!==h&&(E=!1),p=(E?"("===h?h:l:"-"===h||"("===h?"":h)+p,S=("s"===v?no[8+Vi/3]:"")+S+(E&&"("===h?")":""),w)for(i=-1,o=t.length;++i<o;)if(48>(u=t.charCodeAt(i))||u>57){S=(46===u?a+t.slice(i+1):t.slice(i))+S,t=t.slice(0,i);break}}m&&!f&&(t=r(t,1/0));var C=p.length+t.length+S.length,M=C<d?new Array(d-C+1).join(e):"";switch(m&&f&&(t=r(M+t,M.length?d-S.length:1/0),M=""),n){case"<":t=p+t+S+M;break;case"=":t=p+M+t+S;break;case"^":t=M.slice(0,C=M.length>>1)+p+t+S+M.slice(C);break;default:t=M+p+t+S}return s(t)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),S.toString=function(){return t+""},S}return{format:h,formatPrefix:function(t,e){var n=h(((t=Hi(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Xi(e)/3))),i=Math.pow(10,-r),o=no[8+r/3];return function(t){return n(i*t)+o}}}}({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),$i=Ji.format,to=Ji.formatPrefix;var yo=new Date,vo=new Date;function _o(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<r);return s},i.filter=function(n){return _o((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}))},n&&(i.count=function(e,r){return yo.setTime(+e),vo.setTime(+r),t(yo),t(vo),Math.floor(n(yo,vo))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var xo=_o((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));xo.every=function(t){return isFinite(t=Math.floor(t))&&t>0?_o((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};const bo=xo;xo.range;var wo=_o((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}));const So=wo;wo.range;var Eo=1e3,Co=6e4,Mo=36e5,To=864e5,Ao=6048e5;function Po(t){return _o((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Co)/Ao}))}var Lo=Po(0),Io=Po(1),ko=Po(2),Oo=Po(3),Ro=Po(4),Do=Po(5),No=Po(6),Fo=(Lo.range,Io.range,ko.range,Oo.range,Ro.range,Do.range,No.range,_o((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Co)/To}),(function(t){return t.getDate()-1})));const zo=Fo;Fo.range;var Bo=_o((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*Eo-t.getMinutes()*Co)}),(function(t,e){t.setTime(+t+e*Mo)}),(function(t,e){return(e-t)/Mo}),(function(t){return t.getHours()}));const jo=Bo;Bo.range;var Uo=_o((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*Eo)}),(function(t,e){t.setTime(+t+e*Co)}),(function(t,e){return(e-t)/Co}),(function(t){return t.getMinutes()}));const Zo=Uo;Uo.range;var Vo=_o((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*Eo)}),(function(t,e){return(e-t)/Eo}),(function(t){return t.getUTCSeconds()}));const Go=Vo;Vo.range;var Ho=_o((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));Ho.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?_o((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):Ho:null};const Wo=Ho;function qo(t){return _o((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/Ao}))}Ho.range;var Xo=qo(0),Yo=qo(1),Ko=qo(2),Qo=qo(3),Jo=qo(4),$o=qo(5),ta=qo(6),ea=(Xo.range,Yo.range,Ko.range,Qo.range,Jo.range,$o.range,ta.range,_o((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/To}),(function(t){return t.getUTCDate()-1})));const na=ea;ea.range;var ra=_o((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));ra.every=function(t){return isFinite(t=Math.floor(t))&&t>0?_o((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};const ia=ra;function oa(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function aa(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function sa(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}ra.range;var ua,la,ca={"-":"",_:" ",0:"0"},ha=/^\s*\d+/,pa=/^%/,fa=/[\\^$*+?|[\]().{}]/g;function da(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function ma(t){return t.replace(fa,"\\$&")}function ga(t){return new RegExp("^(?:"+t.map(ma).join("|")+")","i")}function ya(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function va(t,e,n){var r=ha.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function _a(t,e,n){var r=ha.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function xa(t,e,n){var r=ha.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function ba(t,e,n){var r=ha.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function wa(t,e,n){var r=ha.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function Sa(t,e,n){var r=ha.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Ea(t,e,n){var r=ha.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Ca(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Ma(t,e,n){var r=ha.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function Ta(t,e,n){var r=ha.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Aa(t,e,n){var r=ha.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function Pa(t,e,n){var r=ha.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function La(t,e,n){var r=ha.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Ia(t,e,n){var r=ha.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function ka(t,e,n){var r=ha.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Oa(t,e,n){var r=ha.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function Ra(t,e,n){var r=ha.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Da(t,e,n){var r=pa.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function Na(t,e,n){var r=ha.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function Fa(t,e,n){var r=ha.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function za(t,e){return da(t.getDate(),e,2)}function Ba(t,e){return da(t.getHours(),e,2)}function ja(t,e){return da(t.getHours()%12||12,e,2)}function Ua(t,e){return da(1+zo.count(bo(t),t),e,3)}function Za(t,e){return da(t.getMilliseconds(),e,3)}function Va(t,e){return Za(t,e)+"000"}function Ga(t,e){return da(t.getMonth()+1,e,2)}function Ha(t,e){return da(t.getMinutes(),e,2)}function Wa(t,e){return da(t.getSeconds(),e,2)}function qa(t){var e=t.getDay();return 0===e?7:e}function Xa(t,e){return da(Lo.count(bo(t)-1,t),e,2)}function Ya(t){var e=t.getDay();return e>=4||0===e?Ro(t):Ro.ceil(t)}function Ka(t,e){return t=Ya(t),da(Ro.count(bo(t),t)+(4===bo(t).getDay()),e,2)}function Qa(t){return t.getDay()}function Ja(t,e){return da(Io.count(bo(t)-1,t),e,2)}function $a(t,e){return da(t.getFullYear()%100,e,2)}function ts(t,e){return da((t=Ya(t)).getFullYear()%100,e,2)}function es(t,e){return da(t.getFullYear()%1e4,e,4)}function ns(t,e){var n=t.getDay();return da((t=n>=4||0===n?Ro(t):Ro.ceil(t)).getFullYear()%1e4,e,4)}function rs(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+da(e/60|0,"0",2)+da(e%60,"0",2)}function is(t,e){return da(t.getUTCDate(),e,2)}function os(t,e){return da(t.getUTCHours(),e,2)}function as(t,e){return da(t.getUTCHours()%12||12,e,2)}function ss(t,e){return da(1+na.count(ia(t),t),e,3)}function us(t,e){return da(t.getUTCMilliseconds(),e,3)}function ls(t,e){return us(t,e)+"000"}function cs(t,e){return da(t.getUTCMonth()+1,e,2)}function hs(t,e){return da(t.getUTCMinutes(),e,2)}function ps(t,e){return da(t.getUTCSeconds(),e,2)}function fs(t){var e=t.getUTCDay();return 0===e?7:e}function ds(t,e){return da(Xo.count(ia(t)-1,t),e,2)}function ms(t){var e=t.getUTCDay();return e>=4||0===e?Jo(t):Jo.ceil(t)}function gs(t,e){return t=ms(t),da(Jo.count(ia(t),t)+(4===ia(t).getUTCDay()),e,2)}function ys(t){return t.getUTCDay()}function vs(t,e){return da(Yo.count(ia(t)-1,t),e,2)}function _s(t,e){return da(t.getUTCFullYear()%100,e,2)}function xs(t,e){return da((t=ms(t)).getUTCFullYear()%100,e,2)}function bs(t,e){return da(t.getUTCFullYear()%1e4,e,4)}function ws(t,e){var n=t.getUTCDay();return da((t=n>=4||0===n?Jo(t):Jo.ceil(t)).getUTCFullYear()%1e4,e,4)}function Ss(){return"+0000"}function Es(){return"%"}function Cs(t){return+t}function Ms(t){return Math.floor(+t/1e3)}ua=function(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,u=t.shortMonths,l=ga(i),c=ya(i),h=ga(o),p=ya(o),f=ga(a),d=ya(a),m=ga(s),g=ya(s),y=ga(u),v=ya(u),_={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:za,e:za,f:Va,g:ts,G:ns,H:Ba,I:ja,j:Ua,L:Za,m:Ga,M:Ha,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:Cs,s:Ms,S:Wa,u:qa,U:Xa,V:Ka,w:Qa,W:Ja,x:null,X:null,y:$a,Y:es,Z:rs,"%":Es},x={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return u[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:is,e:is,f:ls,g:xs,G:ws,H:os,I:as,j:ss,L:us,m:cs,M:hs,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:Cs,s:Ms,S:ps,u:fs,U:ds,V:gs,w:ys,W:vs,x:null,X:null,y:_s,Y:bs,Z:Ss,"%":Es},b={a:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=h.exec(e.slice(n));return r?(t.w=p[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=y.exec(e.slice(n));return r?(t.m=v[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=m.exec(e.slice(n));return r?(t.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return E(t,e,n,r)},d:Aa,e:Aa,f:Ra,g:Ea,G:Sa,H:La,I:La,j:Pa,L:Oa,m:Ta,M:Ia,p:function(t,e,n){var r=l.exec(e.slice(n));return r?(t.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:Ma,Q:Na,s:Fa,S:ka,u:_a,U:xa,V:ba,w:va,W:wa,x:function(t,e,r){return E(t,n,e,r)},X:function(t,e,n){return E(t,r,e,n)},y:Ea,Y:Sa,Z:Ca,"%":Da};function w(t,e){return function(n){var r,i,o,a=[],s=-1,u=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===t.charCodeAt(s)&&(a.push(t.slice(u,s)),null!=(i=ca[r=t.charAt(++s)])?r=t.charAt(++s):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(t.slice(u,s)),a.join("")}}function S(t,e){return function(n){var r,i,o=sa(1900,void 0,1);if(E(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=aa(sa(o.y,0,1))).getUTCDay(),r=i>4||0===i?Yo.ceil(r):Yo(r),r=na.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=oa(sa(o.y,0,1))).getDay(),r=i>4||0===i?Io.ceil(r):Io(r),r=zo.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?aa(sa(o.y,0,1)).getUTCDay():oa(sa(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,aa(o)):oa(o)}}function E(t,e,n,r){for(var i,o,a=0,s=e.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=e.charCodeAt(a++))){if(i=e.charAt(a++),!(o=b[i in ca?e.charAt(a++):i])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=w(n,_),_.X=w(r,_),_.c=w(e,_),x.x=w(n,x),x.X=w(r,x),x.c=w(e,x),{format:function(t){var e=w(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=S(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=S(t+="",!0);return e.toString=function(){return t},e}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),la=ua.format,ua.parse,ua.utcFormat,ua.utcParse;var Ts,As,Ps=31536e6;function Ls(t){return new Date(t)}function Is(t){return t instanceof Date?+t:+new Date(+t)}function ks(t,e,n,r,i,o,a,s,u){var l=Zi(Di,Di),c=l.invert,h=l.domain,p=u(".%L"),f=u(":%S"),d=u("%I:%M"),m=u("%I %p"),g=u("%a %d"),y=u("%b %d"),v=u("%B"),_=u("%Y"),x=[[a,1,1e3],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,6e4],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,Ps]];function b(s){return(a(s)<s?p:o(s)<s?f:i(s)<s?d:r(s)<s?m:e(s)<s?n(s)<s?g:y:t(s)<s?v:_)(s)}function w(e,n,r,i){if(null==e&&(e=10),"number"==typeof e){var o=Math.abs(r-n)/e,a=(0,ri.YF)((function(t){return t[2]})).right(x,o);a===x.length?(i=(0,ri.ly)(n/Ps,r/Ps,e),e=t):a?(i=(a=x[o/x[a-1][2]<x[a][2]/o?a-1:a])[1],e=a[0]):(i=Math.max((0,ri.ly)(n,r,e),1),e=s)}return null==i?e:e.every(i)}return l.invert=function(t){return new Date(c(t))},l.domain=function(t){return arguments.length?h(yi.call(t,Is)):h().map(Ls)},l.ticks=function(t,e){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=w(t,i,o,e))?n.range(i,o+1):[],a?n.reverse():n},l.tickFormat=function(t,e){return null==e?b:u(e)},l.nice=function(t,e){var n=h();return(t=w(t,n[0],n[n.length-1],e))?h(io(n,t)):l},l.copy=function(){return ji(l,ks(t,e,n,r,i,o,a,s,u))},l}function Os(){var t,e,n,r,i,o=0,a=1,s=Di,u=!1;function l(e){return isNaN(e=+e)?i:s(0===n?.5:(e=(r(e)-t)*n,u?Math.max(0,Math.min(1,e)):e))}return l.domain=function(i){return arguments.length?(t=r(o=+i[0]),e=r(a=+i[1]),n=t===e?0:1/(e-t),l):[o,a]},l.clamp=function(t){return arguments.length?(u=!!t,l):u},l.interpolator=function(t){return arguments.length?(s=t,l):s},l.unknown=function(t){return arguments.length?(i=t,l):i},function(i){return r=i,t=i(o),e=i(a),n=t===e?0:1/(e-t),l}}function Rs(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Ds(){var t,e,n,r,i,o,a,s=0,u=.5,l=1,c=Di,h=!1;function p(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-e)*(t<e?r:i),c(h?Math.max(0,Math.min(1,t)):t))}return p.domain=function(a){return arguments.length?(t=o(s=+a[0]),e=o(u=+a[1]),n=o(l=+a[2]),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),p):[s,u,l]},p.clamp=function(t){return arguments.length?(h=!!t,p):h},p.interpolator=function(t){return arguments.length?(c=t,p):c},p.unknown=function(t){return arguments.length?(a=t,p):a},function(a){return o=a,t=a(s),e=a(u),n=a(l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),p}}var Ns,Fs,zs,Bs,js,Us,Zs,Vs,Gs,Hs,Ws,qs,Xs,Ys,Ks,Qs,Js,$s,tu,eu,nu=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,ru=(Ts={},(0,h.Z)(Ts,i.ScaleTypes.LINEAR,(function t(){var e=Zi(Di,Di);return e.copy=function(){return ji(e,t())},_i.apply(e,arguments),ro(e)})),(0,h.Z)(Ts,i.ScaleTypes.POWER,(function t(){var e=go(Ui());return e.copy=function(){return ji(e,t()).exponent(e.exponent())},_i.apply(e,arguments),e})),(0,h.Z)(Ts,i.ScaleTypes.LOG,(function t(){var e=ho(Ui()).domain([1,10]);return e.copy=function(){return ji(e,t()).base(e.base())},_i.apply(e,arguments),e})),(0,h.Z)(Ts,i.ScaleTypes.IDENTITY,(function t(e){var n;function r(t){return isNaN(t=+t)?n:t}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=yi.call(t,Oi),r):e.slice()},r.unknown=function(t){return arguments.length?(n=t,r):n},r.copy=function(){return t(e).unknown(n)},e=arguments.length?yi.call(e,Oi):[0,1],ro(r)})),(0,h.Z)(Ts,i.ScaleTypes.SEQUENTIAL,(function t(){var e=ro(Os()(Di));return e.copy=function(){return Rs(e,t())},xi.apply(e,arguments)})),(0,h.Z)(Ts,i.ScaleTypes.TIME,(function(){return _i.apply(ks(bo,So,Lo,zo,jo,Zo,Go,Wo,la).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),(0,h.Z)(Ts,i.ScaleTypes.QUANTILE,(function t(){var e,n=[],r=[],i=[];function o(){var t=0,e=Math.max(1,r.length);for(i=new Array(e-1);++t<e;)i[t-1]=(0,ri.VR)(n,t/e);return a}function a(t){return isNaN(t=+t)?e:r[(0,ri.b4)(i,t)]}return a.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},a.domain=function(t){if(!arguments.length)return n.slice();n=[];for(var e,r=0,i=t.length;r<i;++r)null==(e=t[r])||isNaN(e=+e)||n.push(e);return n.sort(ri.j2),o()},a.range=function(t){return arguments.length?(r=vi.call(t),o()):r.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return i.slice()},a.copy=function(){return t().domain(n).range(r).unknown(e)},_i.apply(a,arguments)})),(0,h.Z)(Ts,i.ScaleTypes.QUANTIZE,(function t(){var e,n=0,r=1,i=1,o=[.5],a=[0,1];function s(t){return t<=t?a[(0,ri.b4)(o,t,0,i)]:e}function u(){var t=-1;for(o=new Array(i);++t<i;)o[t]=((t+1)*r-(t-i)*n)/(i+1);return s}return s.domain=function(t){return arguments.length?(n=+t[0],r=+t[1],u()):[n,r]},s.range=function(t){return arguments.length?(i=(a=vi.call(t)).length-1,u()):a.slice()},s.invertExtent=function(t){var e=a.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,o[0]]:e>=i?[o[i-1],r]:[o[e-1],o[e]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return t().domain([n,r]).range(a).unknown(e)},_i.apply(ro(s),arguments)})),(0,h.Z)(Ts,i.ScaleTypes.THRESHOLD,(function t(){var e,n=[.5],r=[0,1],i=1;function o(t){return t<=t?r[(0,ri.b4)(n,t,0,i)]:e}return o.domain=function(t){return arguments.length?(n=vi.call(t),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(t){return arguments.length?(r=vi.call(t),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(t){var e=r.indexOf(t);return[n[e-1],n[e]]},o.unknown=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return t().domain(n).range(r).unknown(e)},_i.apply(o,arguments)})),(0,h.Z)(Ts,i.ScaleTypes.CAT,wi),(0,h.Z)(Ts,i.ScaleTypes.DIVERGING,(function t(){var e=ro(Ds()(Di));return e.copy=function(){return Rs(e,t())},xi.apply(e,arguments)})),Ts),iu=(0,le.b2)()(As=function(){function t(){(0,o.Z)(this,t),(0,h.Z)(this,"scaleOptions",{})}return(0,a.Z)(t,[{key:"getSourceData",value:function(t,e){var n=t.getSource();n.inited?e(n.data):n.once("update",(function(){e(n.data)}))}},{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",(function(){n.scaleOptions=t.getScaleOptions();var e=r.getLayerStyleAttributes();n.getSourceData(t,(function(t){var r=t.dataArray;Array.isArray(r)&&0===r.length||n.caculateScalesForAttributes(e||[],r)}))})),t.hooks.beforeRenderData.tap("FeatureScalePlugin",(function(){n.scaleOptions=t.getScaleOptions();var e=r.getLayerStyleAttributes();return n.getSourceData(t,(function(r){var i=r.dataArray;Array.isArray(i)&&0===i.length||(n.caculateScalesForAttributes(e||[],i),t.layerModelNeedUpdate=!0)})),!0})),t.hooks.beforeRender.tap("FeatureScalePlugin",(function(){var e=t.getLayerConfig().usage;if(!t.layerModelNeedUpdate&&"basemap"!==e){n.scaleOptions=t.getScaleOptions();var i=r.getLayerStyleAttributes();i&&n.getSourceData(t,(function(t){var e=t.dataArray;if(0!==e.length){var r=i.filter((function(t){return t.needRescale}));r.length&&n.caculateScalesForAttributes(r,e)}}))}}))}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,e){var n=this;t.forEach((function(t){if(t.scale){var r=t.scale;r.names=n.parseFields(t.scale.field||[]);var o=[];r.names.forEach((function(r){var i;o.push(n.createScale(r,t.name,null===(i=t.scale)||void 0===i?void 0:i.values,e))})),o.some((function(t){return t.type===i.StyleScaleType.VARIABLE}))?(r.type=i.StyleScaleType.VARIABLE,o.forEach((function(t){var e,n;if(!r.callback&&"text"!==r.values)switch(null===(e=t.option)||void 0===e?void 0:e.type){case i.ScaleTypes.LOG:case i.ScaleTypes.LINEAR:case i.ScaleTypes.POWER:if(r.values&&r.values.length>2){var o=t.scale.ticks(r.values.length);t.scale.domain(o)}r.values?t.scale.range(r.values):t.scale.range(t.option.domain);break;case i.ScaleTypes.QUANTILE:case i.ScaleTypes.QUANTIZE:case i.ScaleTypes.THRESHOLD:t.scale.range(r.values);break;case i.ScaleTypes.CAT:r.values?t.scale.range(r.values):t.scale.range(t.option.domain);break;case i.ScaleTypes.DIVERGING:case i.ScaleTypes.SEQUENTIAL:t.scale.interpolator(li(r.values))}"text"===r.values&&t.scale.range(null===(n=t.option)||void 0===n?void 0:n.domain)}))):(r.type=i.StyleScaleType.CONSTANT,r.defaultValues=o.map((function(t,e){return t.scale(r.names[e])}))),r.scalers=o.map((function(t){return{field:t.field,func:t.scale,option:t.option}})),t.needRescale=!1}}))}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:(0,E.isString)(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,e,n,r){var o,a,s=this.scaleOptions[e]&&(null===(o=this.scaleOptions[e])||void 0===o?void 0:o.field)===t?this.scaleOptions[e]:this.scaleOptions[t],u={field:t,scale:void 0,type:i.StyleScaleType.VARIABLE,option:s};if(!r||!r.length)return s&&s.type?u.scale=this.createDefaultScale(s):(u.scale=wi([t]),u.type=i.StyleScaleType.CONSTANT),u;var l=null===(a=r.find((function(e){return!(0,E.isNil)(e[t])})))||void 0===a?void 0:a[t];if(this.isNumber(t)||(0,E.isNil)(l)&&!s)u.scale=wi([t]),u.type=i.StyleScaleType.CONSTANT;else{var c=s&&s.type||this.getDefaultType(l);"text"===n&&(c=i.ScaleTypes.CAT);var h=this.createScaleConfig(c,t,s,r);u.scale=this.createDefaultScale(h),u.option=h}return u}},{key:"getDefaultType",value:function(t){var e=i.ScaleTypes.LINEAR;return"string"==typeof t&&(e=nu.test(t)?i.ScaleTypes.TIME:i.ScaleTypes.CAT),e}},{key:"createScaleConfig",value:function(t,e,n,r){var o={type:t},a=(null==r?void 0:r.map((function(t){return t[e]})))||[];if(null!=n&&n.domain)o.domain=null==n?void 0:n.domain;else if(t!==i.ScaleTypes.CAT&&t!==i.ScaleTypes.QUANTILE&&t!==i.ScaleTypes.DIVERGING)o.domain=(0,ri.We)(a);else if(t===i.ScaleTypes.CAT)o.domain=(0,E.uniq)(a);else if(t===i.ScaleTypes.QUANTILE)o.domain=a;else if(t===i.ScaleTypes.DIVERGING){var s=(0,ri.We)(a),u=void 0!==(null==n?void 0:n.neutral)?null==n?void 0:n.neutral:(s[0]+s[1])/2;o.domain=[s[0],u,s[1]]}return(0,d.Z)((0,d.Z)({},o),n)}},{key:"createDefaultScale",value:function(t){var e=t.type,n=t.domain,r=t.unknown,i=t.clamp,o=t.nice,a=ru[e]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),t}())||As,ou=(0,le.b2)()(Ns=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){t.animateStatus&&t.models.forEach((function(e){e.addUniforms((0,d.Z)({},t.layerModel.getAnimateUniforms()))}))}))}}]),t}())||Ns,au=(0,le.b2)()(Fs=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"initLayerModel",value:function(t){t.prepareBuildModel(),t.buildModels(),t.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(t){var e;t.prepareBuildModel(),null===(e=t.layerModel)||void 0===e||e.clearModels(),t.buildModels(),t.layerModelNeedUpdate=!1}},{key:"apply",value:function(t){var e=this;t.hooks.init.tap("LayerModelPlugin",(function(){t.inited=!0,t.modelLoaded=!1,t.getSource().inited&&e.initLayerModel(t)})),t.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){var n=t.getSource();return t.modelLoaded=!1,n.inited?e.prepareLayerModel(t):n.once("update",(function(){e.prepareLayerModel(t)})),!1}))}}]),t}())||Fs,su=(0,le.b2)()(zs=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",(function(){t.updateLayerConfig({});var e=t.getLayerConfig(),n=e.autoFit,r=e.fitBoundsOptions;n&&setTimeout((function(){t.fitBounds(r)}),100)}))}}]),t}())||zs,uu=["type"],lu={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},cu={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},hu={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},pu={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},fu=(0,le.b2)()(Bs=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",(function(){t.getLayerConfig().enableLighting&&t.models.forEach((function(t){return t.addUniforms((0,d.Z)({},(n={u_DirectionalLights:new Array(3).fill((0,d.Z)({},hu)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,d.Z)({},pu)),u_NumOfSpotLights:0},e&&e.length||(e=[cu]),e.forEach((function(t){var e=t.type,r=void 0===e?"directional":e,i=(0,f.Z)(t,uu),o=lu[r].lights,a=lu[r].num,s=n[a];n[o][s]=(0,d.Z)((0,d.Z)({},n[o][s]),i),n[a]++})),n)));var e,n}))}))}}]),t}())||Bs,du=(0,le.b2)()(js=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.rendererService,i=e.postProcessingPassFactory,o=e.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",(function(){var e=t.getLayerConfig(),r=e.enableMultiPassRenderer,a=e.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==t.getLayerConfig().enableMultiPassRenderer,n.enabled&&(t.multiPassRenderer=O(t,s,i,o),t.multiPassRenderer.setRenderFlag(!0))})),t.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var e=r.getViewportSize(),i=e.width,o=e.height;t.multiPassRenderer.resize(i,o)}}))}}]),t}())||js,mu=(0,le.b2)()(Us=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t,e){var n=e.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",(function(){var e=t.getLayerConfig().enablePicking;n.registerStyleAttribute({name:"pickingColor",type:i.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:i.gl.FLOAT},size:3,update:function(t){var n=t.id;return e?(0,b.encodePickingColor)(n):[0,0,0]}}})})),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(t){return t.addUniforms({u_PickingStage:1})}))})),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(t){return t.addUniforms({u_PickingStage:2})}))})),t.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.highlightColor,i=n.activeMix,o=void 0===i?0:i,a="string"==typeof r?(0,b.rgb2arr)(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:(0,b.decodePickingColor)(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:2,u_PickingColor:e,u_HighlightColor:a.map((function(t){return 255*t})),u_activeMix:o})}))})),t.hooks.beforeSelect.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.selectColor,i=n.selectMix,o=void 0===i?0:i,a="string"==typeof r?(0,b.rgb2arr)(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:(0,b.decodePickingColor)(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:2,u_PickingColor:e,u_HighlightColor:a.map((function(t){return 255*t})),u_activeMix:o,u_CurrentSelectedId:e,u_SelectColor:a.map((function(t){return 255*t})),u_EnableSelect:1})}))}))}}]),t}())||Us,gu=(0,le.b2)()(Zs=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",(function(){(function(t){var e=t.getSource();return xe.includes(e.parser.type)})(t)||n.registerBuiltinAttributes(r,t)}))}},{key:"registerBuiltinAttributes",value:function(t,e){if("MaskLayer"!==e.type)if("basemap"!==e.getLayerConfig().usage){if(e.isTileLayer)return this.registerPositionAttribute(t),void this.registerColorAttribute(t);this.registerPositionAttribute(t),this.registerFilterAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}else this.registerPositionAttribute(t);else this.registerPositionAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:i.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:i.gl.FLOAT},size:3,update:function(t,e,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerFilterAttribute",value:function(t){t.registerStyleAttribute({name:"filter",type:i.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){return t.filter?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:i.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:i.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t,e){return[e]}}})}}]),t}())||Zs,yu=(Vs=(0,le.b2)(),Gs=(0,le.f3)(i.TYPES.ICameraService),Hs=(0,le.f3)(i.TYPES.ICoordinateSystemService),Ws=(0,le.f3)(i.TYPES.IRendererService),qs=(0,le.f3)(i.TYPES.IMapService),Vs((Ys=function(){function t(){(0,o.Z)(this,t),(0,m.Z)(this,"cameraService",Ks,this),(0,m.Z)(this,"coordinateSystemService",Qs,this),(0,m.Z)(this,"rendererService",Js,this),(0,m.Z)(this,"mapService",$s,this)}return(0,a.Z)(t,[{key:"apply",value:function(t){var e=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var a=t.getLayerConfig().tileOrigin;e.coordinateSystemService.refresh(a),"GAODE2.x"===n&&(e.setLayerCenter(t),r=e.mapService.map.customCoords.getMVPMatrix(),o=e.mapService.getCustomCoordCenter());var s=e.rendererService.getViewportSize(),u=s.width,l=s.height;t.models.forEach((function(n){var a;n.addUniforms((a={},(0,h.Z)(a,i.CameraUniform.ProjectionMatrix,e.cameraService.getProjectionMatrix()),(0,h.Z)(a,i.CameraUniform.ViewMatrix,e.cameraService.getViewMatrix()),(0,h.Z)(a,i.CameraUniform.ViewProjectionMatrix,e.cameraService.getViewProjectionMatrix()),(0,h.Z)(a,i.CameraUniform.Zoom,e.cameraService.getZoom()),(0,h.Z)(a,i.CameraUniform.ZoomScale,e.cameraService.getZoomScale()),(0,h.Z)(a,i.CameraUniform.FocalDistance,e.cameraService.getFocalDistance()),(0,h.Z)(a,i.CameraUniform.CameraPosition,e.cameraService.getCameraPosition()),(0,h.Z)(a,i.CoordinateUniform.CoordinateSystem,e.coordinateSystemService.getCoordinateSystem()),(0,h.Z)(a,i.CoordinateUniform.ViewportCenter,e.coordinateSystemService.getViewportCenter()),(0,h.Z)(a,i.CoordinateUniform.ViewportCenterProjection,e.coordinateSystemService.getViewportCenterProjection()),(0,h.Z)(a,i.CoordinateUniform.PixelsPerDegree,e.coordinateSystemService.getPixelsPerDegree()),(0,h.Z)(a,i.CoordinateUniform.PixelsPerDegree2,e.coordinateSystemService.getPixelsPerDegree2()),(0,h.Z)(a,i.CoordinateUniform.PixelsPerMeter,e.coordinateSystemService.getPixelsPerMeter()),(0,h.Z)(a,i.CoordinateUniform.Mvp,r),(0,h.Z)(a,"u_SceneCenterMKT",o),(0,h.Z)(a,"u_ViewportSize",[u,l]),(0,h.Z)(a,"u_ModelMatrix",e.cameraService.getModelMatrix()),(0,h.Z)(a,"u_DevicePixelRatio",b.$window.devicePixelRatio),(0,h.Z)(a,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,h.Z)(a,"u_shaderPick",Number(t.getShaderPickStat())),a))}))}))}},{key:"setLayerCenter",value:function(t){void 0===t.coordCenter&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}}]),t}(),Ks=(0,g.Z)(Ys.prototype,"cameraService",[Gs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qs=(0,g.Z)(Ys.prototype,"coordinateSystemService",[Hs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Js=(0,g.Z)(Ys.prototype,"rendererService",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$s=(0,g.Z)(Ys.prototype,"mapService",[qs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs=Ys))||Xs),vu=(0,le.b2)()(tu=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",(function(){t.layerModel&&t.layerModel.needUpdate()}))}}]),t}())||tu,_u=(0,le.b2)()(eu=function(){function t(){(0,o.Z)(this,t)}return(0,a.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(t,{styleAttributeService:r})})),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){var e=t.getLayerConfig().usage;t.layerModelNeedUpdate||t.tileLayer||"basemap"===e||t.modelLoaded&&n.updateStyleAttribute(t,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(t,e){var n=e.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return t.layerModelNeedUpdate=!0,void r.forEach((function(t){return t.needRegenerateVertices=!1}));r.filter((function(t){return t.needRegenerateVertices})).forEach((function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex,t),e.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(t,e){var n=e.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(t){return t.needRegenerateVertices})).forEach((function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex),e.needRegenerateVertices=!1}))}}]),t}())||eu;i.container.bind(i.TYPES.ILayerPlugin).to(ni).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(gu).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(iu).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(ei).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(su).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(_u).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(vu).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(du).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(yu).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(ou).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(fu).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(mu).inRequestScope(),i.container.bind(i.TYPES.ILayerPlugin).to(au).inRequestScope()},6564:(t,e,n)=>{"use strict";n.r(e),n.d(e,{BaseMapService:()=>ar,BaseMapWrapper:()=>m,Earth:()=>pr,GaodeMap:()=>At,GaodeMapV2:()=>Nt,Map:()=>yr,Mapbox:()=>Cr,Version:()=>L.G,Viewport:()=>ht});var r,i,o,a=n(5683),s=n(89),u=n(3285),l=n(5963),c=n(78),h=n(1517),p=n(6368),f=n(5495),d=n(4534),m=(r=(0,d.lazyInject)(d.TYPES.IGlobalConfigService),i=function(){function t(e){(0,a.Z)(this,t),(0,p.Z)(this,"configService",o,this),this.config=e}return(0,s.Z)(t,[{key:"setContainer",value:function(t,e,n,r){t.bind(d.TYPES.MapConfig).toConstantValue((0,h.Z)((0,h.Z)({},this.config),{},{id:e,canvas:n,hasBaseMap:r})),t.bind(d.TYPES.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),t}(),o=(0,f.Z)(i.prototype,"configService",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i),g=n(596),y=n(7016),v=n(92),_=n(3321),x=n(7012),b=n(3058),w=n(537),S=n(5814),E=n.n(S),C=n(5011),M=n.n(C),T=n(2401),A=n(2329),P=n(7745),L=(n(171),n(5691)),I=n(9470),k=function(){function t(e){(0,a.Z)(this,t),(0,w.Z)(this,"size",1e4),this.size=e||1e4}return(0,s.Z)(t,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var e=180-360*(1-t/this.size);return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}},{key:"project",value:function(t){return[this.mercatorXfromLng(t[0]),this.mercatorYfromLat(t[1])]}},{key:"unproject",value:function(t){return[this.lngFromMercatorX(t[0]),this.latFromMercatorY(t[1])]}}]),t}();function O(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={top:0,right:0,bottom:0,left:0};if("number"==typeof t)return{top:t,right:t,bottom:t,left:t};if(Array.isArray(t)){if(4===t.length)return{top:t[0],right:t[1],bottom:t[2],left:t[3]};if(2===t.length)return{top:t[0],right:t[1],bottom:t[0],left:t[1]}}return(0,h.Z)((0,h.Z)({},e),t)}var R=n(5512);function D(t,e){var n=R.fF([],e,t);return R.bA(n,n,1/n[3]),n}var N=n(9341);function F(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}var z=Math.PI,B=z/4,j=z/180,U=180/z,Z=4003e4;function V(t){return Math.pow(2,t)}function G(t,e){var n=(0,g.Z)(t,2),r=n[0],i=n[1];F(Number.isFinite(r)&&Number.isFinite(e)),F(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*j;return[(e*=512)*(r*j+z)/(2*z),e*(z-Math.log(Math.tan(B+.5*o)))/(2*z)]}function H(t,e){var n=(0,g.Z)(t,2),r=n[0],i=n[1],o=r/(e*=512)*(2*z)-z,a=2*(Math.atan(Math.exp(z-i/e*(2*z)))-B);return[o*U,a*U]}function W(t){var e=t.latitude,n=t.longitude,r=t.zoom,i=t.scale,o=t.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:V(r),F(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,l=Math.cos(e*j),c=u/360,h=c/l,p=u/Z/l;if(s.pixelsPerMeter=[p,-p,p],s.metersPerPixel=[1/p,-1/p,1/p],s.pixelsPerDegree=[c,-h,p],s.degreesPerPixel=[1/c,-1/h,1/p],a){var f=j*Math.tan(e*j)/l,d=c*f/2,m=u/Z*f,g=m/h*p;s.pixelsPerDegree2=[0,-d,m],s.pixelsPerMeter2=[g,0,g]}return s}function q(t){var e=t.height,n=t.pitch,r=t.bearing,i=t.altitude,o=t.center,a=void 0===o?null:o,s=t.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return T.translate(l,l,[0,0,-i]),T.scale(l,l,[1,1,1/e]),T.rotateX(l,l,-n*j),T.rotateZ(l,l,r*j),u&&T.scale(l,l,[1,-1,1]),a&&T.translate(l,l,A.negate([],a)),l}function X(t){var e=t.width,n=t.height,r=t.pitch,i=function(t){var e=t.width,n=t.height,r=t.altitude,i=void 0===r?1.5:r,o=t.pitch,a=t.nearZMultiplier,s=void 0===a?1:a,u=t.farZMultiplier,l=void 0===u?1:u,c=(void 0===o?0:o)*j,h=Math.atan(.5/i),p=Math.sin(h)*i/Math.sin(Math.PI/2-c-h),f=Math.cos(Math.PI/2-c)*p+i;return{fov:2*Math.atan(n/2/i),aspect:e/n,focalDistance:i,near:s,far:f*l}}({width:e,height:n,altitude:t.altitude,pitch:r,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return T.perspective([],o,a,s,u)}function Y(t,e){var n=(0,g.Z)(t,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return F(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),D(e,[r,i,a,1])}function K(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(0,g.Z)(t,3),i=r[0],o=r[1],a=r[2];if(F(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=D(e,[i,o,a,1]);return s}var u=D(e,[i,o,0,1]),l=D(e,[i,o,1,1]),c=u[2],h=l[2],p=c===h?0:((n||0)-c)/(h-c);return N.t7([],u,l,p)}var Q=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function J(t){var e=t.width,n=t.height,r=t.bounds,i=t.minExtent,o=void 0===i?0:i,a=t.maxZoom,s=void 0===a?24:a,u=t.padding,l=void 0===u?0:u,c=t.offset,h=void 0===c?[0,0]:c,p=(0,g.Z)(r,2),f=(0,g.Z)(p[0],2),d=f[0],m=f[1],y=(0,g.Z)(p[1],2),v=y[0],_=y[1];Number.isFinite(l)?l={top:l,bottom:l,left:l,right:l}:F(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var x=new ct({width:e,height:n,longitude:0,latitude:0,zoom:0}),b=x.project([d,_]),w=x.project([v,m]),S=[Math.max(Math.abs(w[0]-b[0]),o),Math.max(Math.abs(w[1]-b[1]),o)],E=[e-l.left-l.right-2*Math.abs(h[0]),n-l.top-l.bottom-2*Math.abs(h[1])];F(E[0]>0&&E[1]>0);var C=E[0]/S[0],M=E[1]/S[1],T=(l.right-l.left)/2/C,A=(l.bottom-l.top)/2/M,P=[(w[0]+b[0])/2+T,(w[1]+b[1])/2+A],L=x.unproject(P),I=x.zoom+Math.log2(Math.abs(Math.min(C,M)));return{longitude:L[0],latitude:L[1],zoom:Math.min(I,s)}}var $,tt,et,nt,rt,it,ot,at,st,ut,lt,ct=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,s=void 0===o?0:o,u=n.longitude,h=void 0===u?0:u,p=n.zoom,f=void 0===p?0:p,d=n.pitch,m=void 0===d?0:d,g=n.bearing,y=void 0===g?0:g,v=n.altitude,_=void 0===v?1.5:v,x=n.nearZMultiplier,w=n.farZMultiplier;(0,a.Z)(this,e),r=r||1,i=i||1;var S=V(f);_=Math.max(.75,_);var E=G([h,s],S);E[2]=0;var C=X({width:r,height:i,pitch:m,bearing:y,altitude:_,nearZMultiplier:x||1/i,farZMultiplier:w||1.01}),M=q({height:i,center:E,pitch:m,bearing:y,altitude:_,flipY:!0});return(t=(0,l.Z)(this,(0,c.Z)(e).call(this,{width:r,height:i,viewMatrix:M,projectionMatrix:C}))).latitude=s,t.longitude=h,t.zoom=f,t.pitch=m,t.bearing=y,t.altitude=_,t.scale=S,t.center=E,t.pixelsPerMeter=W((0,b.Z)((0,b.Z)(t))).pixelsPerMeter[2],Object.freeze((0,b.Z)((0,b.Z)(t))),t}return(0,u.Z)(e,t),(0,s.Z)(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return G(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return H(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=K(t.pos,this.pixelUnprojectionMatrix),r=G(e,this.scale),i=N.IH([],r,N.tk([],n));return H(N.IH([],this.center,i),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=J(Object.assign({width:r,height:i,bounds:t},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new e({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),e}(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=e.height,i=e.viewMatrix,o=void 0===i?Q:i,s=e.projectionMatrix,u=void 0===s?Q:s;(0,a.Z)(this,t),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];T.multiply(l,l,this.projectionMatrix),T.multiply(l,l,this.viewMatrix),this.viewProjectionMatrix=l;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];T.scale(c,c,[this.width/2,-this.height/2,1]),T.translate(c,c,[1,-1,0]),T.multiply(c,c,this.viewProjectionMatrix);var h=T.invert([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c);if(!h)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=c,this.pixelUnprojectionMatrix=h,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,s.Z)(t,[{key:"equals",value:function(e){return e instanceof t&&e.width===this.width&&e.height===this.height&&T.equals(e.projectionMatrix,this.projectionMatrix)&&T.equals(e.viewMatrix,this.viewMatrix)}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=this.projectPosition(t),o=Y(i,this.pixelProjectionMatrix),a=(0,g.Z)(o,2),s=a[0],u=a[1],l=r?u:this.height-u;return 2===t.length?[s,l]:[s,l,o[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=e.targetZ,o=(0,g.Z)(t,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=i&&i*this.pixelsPerMeter,h=K([a,l,u],this.pixelUnprojectionMatrix,c),p=this.unprojectPosition(h),f=(0,g.Z)(p,3),d=f[0],m=f[1],y=f[2];return Number.isFinite(u)?[d,m,y]:Number.isFinite(i)?[d,m,i]:[d,m]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=(0,g.Z)(e,2);return[n[0],n[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=(0,g.Z)(e,2);return[n[0],n[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]||this.scale,t}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]||this.scale,t}}]),t}()),ht=function(){function t(){(0,a.Z)(this,t)}return(0,s.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth,s=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new ct((0,h.Z)((0,h.Z)({},s),{},{width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),pt={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},ft=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var dt=0;window.forceWebGL=!0;var mt,gt="15cd8a57710d40c9b7c0e3cc120f1200",yt=!1,vt=[],_t=($=(0,P.b2)(),tt=(0,P.f3)(d.TYPES.IGlobalConfigService),et=(0,P.f3)(d.TYPES.MapConfig),nt=(0,P.f3)(d.TYPES.ICoordinateSystemService),rt=(0,P.f3)(d.TYPES.IEventEmitter),$((ot=function(){function t(){var e=this;(0,a.Z)(this,t),(0,w.Z)(this,"version",L.G["GAODE1.x"]),(0,w.Z)(this,"simpleMapCoord",new k),(0,w.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),(0,p.Z)(this,"configService",at,this),(0,p.Z)(this,"config",st,this),(0,p.Z)(this,"coordinateSystemService",ut,this),(0,p.Z)(this,"eventEmitter",lt,this),(0,w.Z)(this,"handleCameraChanged",(function(t){var n=t.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,h=e.getCenter(),p=h.lng,f=h.lat;if(e.emit("mapchange"),e.cameraChangedCallback){e.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:e.map.getZoom()-1,center:[p,f],offsetOrigin:[c.x,c.y]});var m=e.config.offsetZoom,g=void 0===m?12:m;e.viewport.getZoom()>g?e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.P20_OFFSET):e.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.P20),e.cameraChangedCallback(e.viewport)}}))}var e;return(0,s.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];this.markerContainer=I.DOM.create("div","l7-marker-container",e)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(t,e)}},{key:"off",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.off(t,e):this.map.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(null!=t&&t.padding){var e=this.getCenter(),n=O(t.padding),r=this.lngLatToPixel([e.lng,e.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"setCenter",value:function(t,e){if(null!=e&&e.padding){var n=O(e.padding),r=this.lngLatToPixel(t),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(t,e)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,e){this.map.setZoomAndCenter(t+1,e)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyleValue(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"getMapStyleConfig",value:function(){return pt}},{key:"getMapStyleValue",value:function(t){return this.getMapStyleConfig()[t]||t}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(t){var e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"containerToLngLat",value:function(t){var e=new AMap.Pixel(t[0],t[1]),n=this.map.containerToLngLat(e);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(t){var e=new AMap.LngLat(t[0],t[1]),n=this.map.lngLatToContainer(e);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(t){var e=this.map.lngLatToGeodeticCoord(t);return[e.x,-e.y]}},{key:"lngLatToMercator",value:function(t,e){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=T.create();return T.translate(o,o,A.fromValues(i[0],i[1],e)),T.scale(o,o,A.fromValues(r[0],r[1],r[2])),T.rotateX(o,o,n[0]),T.rotateY(o,o,n[1]),T.rotateZ(o,o,n[2]),o}},{key:"init",value:(e=(0,x.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,f,d,m,g=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,l=e.token,c=void 0===l?gt:l,p=e.mapInstance,f=e.plugin,d=void 0===f?[]:f,m=(0,_.Z)(e,ft),t.next=3,new Promise((function(t){var e=function(){if(p)g.map=p,g.$mapContainer=g.map.getContainer(),setTimeout((function(){g.map.on("camerachange",g.handleCameraChanged),t()}),30);else{g.$mapContainer=g.creatMapContainer(n);var e=(0,h.Z)({mapStyle:g.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},m);e.zoom&&(e.zoom+=1);var r=new AMap.Map(g.$mapContainer,e);r.on("camerachange",g.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return g.handleAfterMapChange()}))})),g.map=r,setTimeout((function(){t()}),10)}};yt||p?yt&&window.AMap||p?e():vt.push(e):(c===gt&&console.warn(g.configService.getSceneWarninfo("MapToken")),yt=!0,d.push("Map3D"),M().load({key:c,version:"1.4.15",plugins:d}).then((function(){e(),vt.length&&(vt.forEach((function(t){return t()})),vt=[])})).catch((function(t){throw new Error(t)})))}));case 3:this.viewport=new ht;case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance((0,y.Z)(AMap.LngLat,(0,v.Z)(t)),(0,y.Z)(AMap.LngLat,(0,v.Z)(e))),r=this.lngLatToCoord(t),i=(0,g.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,g.Z)(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"destroy",value:function(){var t,e;this.map.destroy(),null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",n.id="l7_amap_div"+dt++,e.appendChild(n),n}}]),t}(),at=(0,f.Z)(ot.prototype,"configService",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st=(0,f.Z)(ot.prototype,"config",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ut=(0,f.Z)(ot.prototype,"coordinateSystemService",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lt=(0,f.Z)(ot.prototype,"eventEmitter",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),it=ot))||it),xt=Math.PI/180,bt=function(){function t(){(0,a.Z)(this,t),(0,w.Z)(this,"projectionMatrix",T.create()),(0,w.Z)(this,"viewMatrix",T.create()),(0,w.Z)(this,"viewProjectionMatrix",T.create()),(0,w.Z)(this,"ViewProjectionMatrixUncentered",T.create()),(0,w.Z)(this,"viewUncenteredMatrix",T.create())}return(0,s.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=void 0===e?1:e,r=t.pitch,i=void 0===r?0:r,o=t.bearing,a=void 0===o?0:o,s=t.center,u=void 0===s?[0,0]:s,l=t.offsetOrigin,c=void 0===l?[0,0]:l,h=t.cameraHeight,p=void 0===h?1:h,f=t.aspect,d=void 0===f?1:f,m=t.near,g=void 0===m?.1:m,y=t.far,v=void 0===y?1e3:y,_=t.fov,x=void 0===_?0:_;this.zoom=n,this.center=u;var b=i*xt,w=(360-a)*xt;T.perspective(this.projectionMatrix,x,d,g,v);var S=A.fromValues(p*Math.sin(b)*Math.sin(w),-p*Math.sin(b)*Math.cos(w),p*Math.cos(b)),E=A.fromValues(-Math.cos(b)*Math.sin(w),Math.cos(b)*Math.cos(w),Math.sin(b));T.lookAt(this.viewMatrix,S,A.fromValues(0,0,0),E),this.viewUncenteredMatrix=T.clone(this.viewMatrix),T.translate(this.viewMatrix,this.viewMatrix,A.fromValues(-c[0],c[1],0)),T.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),T.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=(0,g.Z)(this.center,2);return[t[0],t[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;return a=Math.log(Math.tan(Math.PI/4+a/2)),[o=r*(.5/Math.PI*o+.5)-215440491,a=-(r*(-.5/Math.PI*a+(i=.5))-106744817)]}}]),t}(),wt=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];window.forceWebGL=!0;var St="15cd8a57710d40c9b7c0e3cc120f1200",Et=!1,Ct=[],Mt=(0,P.b2)()(mt=function(t){(0,u.Z)(o,t);var e,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function o(){var t;(0,a.Z)(this,o);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,w.Z)((0,b.Z)(t),"version",L.G["GAODE1.x"]),(0,w.Z)((0,b.Z)(t),"handleCameraChanged",(function(e){var n=e.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,h=t.getCenter(),p=h.lng,f=h.lat;if(t.emit("mapchange"),t.cameraChangedCallback){t.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:t.map.getZoom()-1,center:[p,f],offsetOrigin:[c.x,c.y]});var m=t.config.offsetZoom,g=void 0===m?12:m;t.viewport.getZoom()>g?t.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.P20_OFFSET):t.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.P20),t.cameraChangedCallback(t.viewport)}})),t}return(0,s.Z)(o,[{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=T.create();return T.translate(o,o,A.fromValues(i[0],i[1],e)),T.scale(o,o,A.fromValues(r[0],r[1],r[2])),T.rotateX(o,o,n[0]),T.rotateY(o,o,n[1]),T.rotateZ(o,o,n[2]),o}},{key:"init",value:(e=(0,x.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,f,d,m,g=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,l=e.token,c=void 0===l?St:l,p=e.mapInstance,f=e.plugin,d=void 0===f?[]:f,m=(0,_.Z)(e,wt),t.next=3,new Promise((function(t){var e=function(){if(p)g.map=p,g.$mapContainer=g.map.getContainer(),setTimeout((function(){g.map.on("camerachange",g.handleCameraChanged),t()}),30);else{g.$mapContainer=g.creatMapContainer(n);var e=(0,h.Z)({mapStyle:g.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},m);e.zoom&&(e.zoom+=1);var r=new AMap.Map(g.$mapContainer,e);r.on("camerachange",g.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return g.handleAfterMapChange()}))})),g.map=r,setTimeout((function(){t()}),10)}};Et||p?Et&&window.AMap||p?e():Ct.push(e):(c===St&&console.warn(g.configService.getSceneWarninfo("MapToken")),Et=!0,d.push("Map3D"),M().load({key:c,version:"1.4.15",plugins:d}).then((function(t){e(),Ct.length&&(Ct.forEach((function(t){return t()})),Ct=[])})).catch((function(t){throw new Error(t)})))}));case 3:this.viewport=new bt;case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance((0,y.Z)(AMap.LngLat,(0,v.Z)(t)),(0,y.Z)(AMap.LngLat,(0,v.Z)(e))),r=this.lngLatToCoord(t),i=(0,g.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,g.Z)(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}}]),o}(_t))||mt;var Tt,At=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"getServiceConstructor",value:function(){return Mt}}]),i}(m),Pt=function(){function t(){(0,a.Z)(this,t),(0,w.Z)(this,"projectionMatrix",T.create()),(0,w.Z)(this,"viewMatrix",T.create()),(0,w.Z)(this,"viewProjectionMatrix",T.create()),(0,w.Z)(this,"ViewProjectionMatrixUncentered",T.create()),(0,w.Z)(this,"viewUncenteredMatrix",T.create())}return(0,s.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=void 0===e?1:e,r=t.center,i=void 0===r?[0,0]:r,o=t.offsetOrigin,a=void 0===o?[0,0]:o,s=t.cameraPosition,u=void 0===s?[0,0,0]:s,l=t.up,c=void 0===l?[0,1,0]:l,h=t.lookAt,p=void 0===h?[0,0,0]:h,f=t.aspect,d=void 0===f?1:f,m=t.near,g=void 0===m?.1:m,y=t.far,_=void 0===y?1e3:y,x=t.fov,b=void 0===x?45:x;this.zoom=n,this.center=i,T.perspective(this.projectionMatrix,b/180*Math.PI,d,g,_);var w=A.fromValues.apply(A,(0,v.Z)(u)),S=A.fromValues.apply(A,(0,v.Z)(p)),E=A.fromValues.apply(A,(0,v.Z)(c));T.lookAt(this.viewMatrix,w,S,E),this.viewUncenteredMatrix=T.clone(this.viewMatrix),T.translate(this.viewMatrix,this.viewMatrix,A.fromValues(-a[0],a[1],0)),T.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),T.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var t=(0,g.Z)(this.center,2);return[t[0],t[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;return a=Math.log(Math.tan(Math.PI/4+a/2)),[o=r*(.5/Math.PI*o+.5)-215440491,a=-(r*(-.5/Math.PI*a+(i=.5))-106744817)]}}]),t}(),Lt=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n"),window.forceWebGL=!0;var It="ff533602d57df6f8ab3b0fea226ae52f",kt=!1,Ot=[],Rt=(0,P.b2)()(Tt=function(t){(0,u.Z)(o,t);var e,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function o(){var t;(0,a.Z)(this,o);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,w.Z)((0,b.Z)(t),"version",L.G["GAODE2.x"]),(0,w.Z)((0,b.Z)(t),"handleViewChanged",(function(e){var n=t.map.customCoords.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,l=n.up;t.emit("mapchange");var c=t.map.customCoords.getCenter();t.cameraChangedCallback&&(t.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,up:l,near:i,zoom:t.map.getZoom()-1,center:c,offsetOrigin:[s[0],s[1]]}),t.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.P20_2),t.cameraChangedCallback(t.viewport))})),t}return(0,s.Z)(o,[{key:"setCustomCoordCenter",value:function(t){this.sceneCenter=t,this.sceneCenterMKT=I.amap2Project.apply(void 0,(0,v.Z)(t))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoordByLayer",value:function(t,e){var n=e||this.sceneCenter,r=I.amap2Project.apply(void 0,(0,v.Z)(n));return this._sub((0,I.amap2Project)(t[0],t[1]),r)}},{key:"lngLatToCoordsByLayer",value:function(t,e){var n=this;return t.map((function(t){return"number"==typeof t[0]?n.lngLatToCoordByLayer(t,e):t.map((function(t){return n.lngLatToCoordByLayer(t,e)}))}))}},{key:"setCoordCenter",value:function(t){this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)}},{key:"lngLatToCoord",value:function(t){return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub((0,I.amap2Project)(t[0],t[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(t){var e=this;return t.map((function(t){return"number"==typeof t[0]?e.lngLatToCoord(t):t.map((function(t){return e.lngLatToCoord(t)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];e.style.zIndex="auto",this.markerContainer=I.DOM.create("div","l7-marker-container2",e)}}}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var t=this.map.getBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"lngLatToContainer",value:function(t){var e=this.map.lngLatToContainer(t);return{x:e.getX(),y:e.getY()}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(t),o=T.create();return T.translate(o,o,A.fromValues(i[0],i[1],e)),T.scale(o,o,A.fromValues(r[0],r[1],r[2])),T.rotateX(o,o,n[0]),T.rotateY(o,o,n[1]),T.rotateZ(o,o,n[2]),o}},{key:"init",value:(e=(0,x.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,f,d,m,g=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,l=e.token,c=void 0===l?It:l,p=e.mapInstance,f=e.plugin,d=void 0===f?[]:f,e.version,m=(0,_.Z)(e,Lt),t.next=3,new Promise((function(t){var e=function(){if(p){var e;g.map=p,g.$mapContainer=g.map.getContainer();var r=g.map.getCenter();null===(e=g.map.customCoords)||void 0===e||e.setCenter([r.lng,r.lat]),g.setCustomCoordCenter([r.lng,r.lat]),setTimeout((function(){g.map.on("viewchange",g.handleViewChanged),t()}),30)}else{g.$mapContainer=g.creatMapContainer(n);var o=(0,h.Z)({mapStyle:g.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},m);o.zoom&&(o.zoom+=1);var s=new AMap.Map(g.$mapContainer,o);g.map=s;var l=s.getCenter();s.customCoords.setCenter([l.lng,l.lat]),g.setCustomCoordCenter([l.lng,l.lat]),s.on("viewchange",g.handleViewChanged),setTimeout((function(){t()}),10)}};g.viewport=new Pt,kt||p?kt&&window.AMap||p?e():Ot.push(e):(c===It&&console.warn(g.configService.getSceneWarninfo("MapToken")),kt=!0,d.push("Map3D"),M().load({key:c,version:"2.0.5",plugins:d}).then((function(t){e(),Ot.length&&(Ot.forEach((function(t){return t()})),Ot=[])})).catch((function(t){throw new Error(t)})))}));case 3:this.initViewPort();case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"initViewPort",value:function(){var t,e=null===(t=this.map.customCoords)||void 0===t?void 0:t.getCameraParams(),n=e.fov,r=e.near,i=e.far,o=e.aspect,a=e.position,s=e.lookAt,u=e.up;this.emit("mapchange");var l=this.map.customCoords.getCenter(),c=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:n,cameraPosition:a,lookAt:s,near:r,up:u,zoom:c-1,center:l,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(t,e){var n=[0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n}}]),o}(_t))||Tt;var Dt,Nt=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"getServiceConstructor",value:function(){return Rt}}]),i}(m),Ft=n(9479),zt=n(1883),Bt=n(5063),jt=n(6922),Ut=n.n(jt);function Zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Vt(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function Gt(t,e,n){return Math.min(n,Math.max(e,t))}function Ht(t,e,n){return t*(1-n)+e*n}function Wt(t,e,n,r){var i=new(Ut())(t,e,n,r);return function(t){return i.solve(t)}}var qt=Wt(.25,.1,.25,1);function Xt(){return!(I.isMini||!I.$window.matchMedia)&&(null==Dt&&(Dt=I.$window.matchMedia("(prefers-reduced-motion: reduce)")),Dt.matches)}function Yt(t,e){var n,r={},i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Zt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in t&&(r[o]=t[o])}}catch(t){i.e(t)}finally{i.f()}return r}var Kt=I.isMini?Date.now.bind(Date):I.$window.performance&&I.$window.performance.now?I.$window.performance.now.bind(I.$window.performance):Date.now.bind(Date),Qt=I.$window.requestAnimationFrame||I.$window.mozRequestAnimationFrame||I.$window.webkitRequestAnimationFrame||I.$window.msRequestAnimationFrame,Jt=I.$window.cancelAnimationFrame||I.$window.mozCancelAnimationFrame||I.$window.webkitCancelAnimationFrame||I.$window.msCancelAnimationFrame;function $t(t){var e=Qt(t);return{cancel:function(){return Jt(e)}}}var te=6371008.8,ee=function(){function t(e,n){if((0,a.Z)(this,t),isNaN(e)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(n,")"));if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return(0,s.Z)(t,[{key:"wrap",value:function(){return new t(Vt(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return te*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(e){if(e instanceof t)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new t(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"===(0,Bt.Z)(e)&&null!==e){var n="lng"in e?e.lng:e.lon;return new t(Number(n),Number(e.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),t}(),ne=function(){function t(e,n){(0,a.Z)(this,t),e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}return(0,s.Z)(t,[{key:"setNorthEast",value:function(t){return this.ne=t instanceof ee?new ee(t.lng,t.lat):ee.convert(t),this}},{key:"setSouthWest",value:function(t){return this.sw=t instanceof ee?new ee(t.lng,t.lat):ee.convert(t),this}},{key:"extend",value:function(e){var n,r,i=this.sw,o=this.ne;if(e instanceof ee)n=e,r=e;else{if(!(e instanceof t)){if(Array.isArray(e)){if(4===e.length||e.every(Array.isArray)){var a=e;return this.extend(t.convert(a))}var s=e;return this.extend(ee.convert(s))}return this}if(n=e.sw,r=e.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new ee(n.lng,n.lat),this.ne=new ee(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new ee((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new ee(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new ee(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(t){var e=ee.convert(t),n=e.lng,r=e.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(e){return e instanceof t?e:new t(e)}}]),t}(),re=function(){function t(e,n){(0,a.Z)(this,t),this.x=e,this.y=n}return(0,s.Z)(t,[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"_add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"add",value:function(t){return this.clone()._add(t)}},{key:"_sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"sub",value:function(t){return this.clone()._sub(t)}},{key:"_multByPoint",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multByPoint",value:function(t){return this.clone()._multByPoint(t)}},{key:"_divByPoint",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divByPoint",value:function(t){return this.clone()._divByPoint(t)}},{key:"_mult",value:function(t){return this.x*=t,this.y*=t,this}},{key:"mult",value:function(t){return this.clone()._mult(t)}},{key:"_div",value:function(t){return this.x/=t,this.y/=t,this}},{key:"div",value:function(t){return this.clone()._div(t)}},{key:"_rotate",value:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(t){return this.clone()._rotate(t)}},{key:"_rotateAround",value:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(t,e){return this.clone()._rotateAround(t,e)}},{key:"_matMult",value:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this}},{key:"matMult",value:function(t){return this.clone()._matMult(t)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var t=this.y;return this.y=this.x,this.x=-t,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"dist",value:function(t){return Math.sqrt(this.distSqr(t))}},{key:"distSqr",value:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"angleWith",value:function(t){return this.angleWithSep(t.x,t.y)}},{key:"angleWithSep",value:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)}}],[{key:"convert",value:function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}}]),t}(),ie=n(4249),oe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if((0,a.Z)(this,t),isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=r,this.right=i}return(0,s.Z)(t,[{key:"interpolate",value:function(t,e,n){return null!=e.top&&null!=t.top&&(this.top=Ht(t.top,e.top,n)),null!=e.bottom&&null!=t.bottom&&(this.bottom=Ht(t.bottom,e.bottom,n)),null!=e.left&&null!=t.left&&(this.left=Ht(t.left,e.left,n)),null!=e.right&&null!=t.right&&(this.right=Ht(t.right,e.right,n)),this}},{key:"getCenter",value:function(t,e){var n=Gt((this.left+t-this.right)/2,0,t),r=Gt((this.top+e-this.bottom)/2,0,e);return new re(n,r)}},{key:"equals",value:function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}},{key:"clone",value:function(){return new t(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),t}(),ae=2*Math.PI*te;function se(t){return ae*Math.cos(t*Math.PI/180)}function ue(t){return(180+t)/360}function le(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ce(t,e){return t/se(e)}function he(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}var pe=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,a.Z)(this,t),this.x=+e,this.y=+n,this.z=+r}return(0,s.Z)(t,[{key:"toLngLat",value:function(){return new ee(360*this.x-180,he(this.y))}},{key:"toAltitude",value:function(){return this.z*se(he(this.y))}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/ae*(t=he(this.y),1/Math.cos(t*Math.PI/180));var t}}],[{key:"fromLngLat",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=ee.convert(e);return new t(ue(r.lng),le(r.lat),ce(n,r.lat))}}]),t}();function fe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var de=function(){function t(e,n,r,i,o){(0,a.Z)(this,t),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new ee(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new oe,this.posMatrixCache={},this.alignedPosMatrixCache={}}return(0,s.Z)(t,[{key:"minZoom",get:function(){return this._minZoom},set:function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}},{key:"minPitch",get:function(){return this._minPitch},set:function(t){this._minPitch!==t&&(this._minPitch=t,this._pitch=Math.max(this._pitch,t))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(t){this._maxPitch!==t&&(this._maxPitch=t,this._pitch=Math.min(this._pitch,t))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new re(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(t){var e,n=-Vt(t,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(e=new ie.WT(4),ie.WT!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e),function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var e=Gt(t,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==e&&(this.unmodified=!1,this._pitch=e,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this.unmodified=!1,this._fov=t/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(t){var e=Math.min(Math.max(t,this._minZoom),this._maxZoom);this._zoom!==e&&(this.unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this.unmodified=!1,this._center=t,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(t){this.edgeInsets.equals(t)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,t,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var e=new t(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e.center=this._center,e.zoom=this.zoom,e.angle=this.angle,e.fov=this._fov,e.pitch=this._pitch,e.unmodified=this.unmodified,e.edgeInsets=this.edgeInsets.clone(),e.calcMatrices(),e}},{key:"isPaddingEqual",value:function(t){return this.edgeInsets.equals(t)}},{key:"interpolatePadding",value:function(t,e,n){this.unmodified=!1,this.edgeInsets.interpolate(t,e,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(t){return Math.pow(2,t)}},{key:"scaleZoom",value:function(t){return Math.log(t)/Math.LN2}},{key:"project",value:function(t){var e=Gt(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new re(ue(t.lng)*this.worldSize,le(e)*this.worldSize)}},{key:"unproject",value:function(t){return new pe(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(t,e){var n=this.pointCoordinate(e),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(t),o=new pe(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(t){var e=new Float64Array([t.x,t.y,0,1]),n=new Float64Array([t.x,t.y,1,1]);R.fF(e,e,this.pixelMatrixInverse),R.fF(n,n,this.pixelMatrixInverse);var r=e[3],i=n[3],o=e[0]/r,a=n[0]/i,s=e[1]/r,u=n[1]/i,l=e[2]/r,c=n[2]/i,h=l===c?0:(0-l)/(c-l);return new pe(Ht(o,a,h)/this.worldSize,Ht(s,u,h)/this.worldSize)}},{key:"getBounds",value:function(){return(new ne).extend(this.pointLocation(new re(0,0))).extend(this.pointLocation(new re(this.width,0))).extend(this.pointLocation(new re(this.width,this.height))).extend(this.pointLocation(new re(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new ne([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new re(0,0)),e=new Float32Array([t.x*this.worldSize,t.y*this.worldSize,0,1]);return R.fF(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var t=this._pitch,e=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new re(0,e))}},{key:"getCameraQueryGeometry",value:function(t){var e=this.getCameraPoint();if(1===t.length)return[t[0],e];var n,r=e.x,i=e.y,o=e.x,a=e.y,s=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return fe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fe(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(t);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(t){s.e(t)}finally{s.f()}return[new re(r,i),new re(o,i),new re(o,a),new re(r,a),new re(r,i)]}},{key:"coordinatePoint",value:function(t){var e=R.al(t.x*this.worldSize,t.y*this.worldSize,0,1);return R.fF(e,e,this.pixelMatrix),new re(e[0]/e[3],e[1]/e[3])}},{key:"locationPoint",value:function(t){return this.coordinatePoint(this.locationCoordinate(t))}},{key:"pointLocation",value:function(t){return this.coordinateLocation(this.pointCoordinate(t))}},{key:"locationCoordinate",value:function(t){return pe.fromLngLat(t)}},{key:"coordinateLocation",value:function(t){return t.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var t,e,n,r,i=-90,o=90,a=-180,s=180,u=this.size,l=this.unmodified;if(this.latRange){var c=this.latRange;i=le(c[1])*this.worldSize,t=(o=le(c[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var h=this.lngRange;a=ue(h[0])*this.worldSize,e=(s=ue(h[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var p=this.point,f=Math.max(e||0,t||0);if(f)return this.center=this.unproject(new re(e?(s+a)/2:p.x,t?(o+i)/2:p.y)),I.isMini?this.zoom=Math.max(this.zoom,Math.max(-1,this.minZoom)):this.zoom+=this.scaleZoom(f),this.unmodified=l,void(this.constraining=!1);if(this.latRange){var d=p.y,m=u.y/2;d-m<i&&(r=i+m),d+m>o&&(r=o-m)}if(this.lngRange){var g=p.x,y=u.x/2;g-y<a&&(n=a+y),g+y>s&&(n=s-y)}void 0===n&&void 0===r||(this.center=this.unproject(new re(void 0!==n?n:p.x,void 0!==r?r:p.y))),this.unmodified=l,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var t=this._fov/2,e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(t)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(Gt(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);T.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,T.scale(c,c,[1,-1,1]),T.translate(c,c,[0,0,-this.cameraToCenterDistance]),T.rotateX(c,c,this._pitch),T.rotateZ(c,c,this.angle),T.translate(c,c,[-a,-s,0]),this.mercatorMatrix=T.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),T.scale(c,c,[1,1,ce(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=T.invert([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,f=Math.cos(this.angle),d=Math.sin(this.angle),m=a-Math.round(a)+f*h+d*p,g=s-Math.round(s)+f*p+d*h,y=new Float64Array(c);if(T.translate(y,y,[m>.5?m-1:m,g>.5?g-1:g,0]),this.alignedProjMatrix=y,c=T.create(),T.scale(c,c,[this.width/2,-this.height/2,1]),T.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=T.create(),T.scale(c,c,[1,-1,1]),T.translate(c,c,[-1,-1,0]),T.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=T.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=T.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),t}(),me=n(8469),ge=n.n(me),ye=(0,s.Z)((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.Z)(this,t),ge()(this,n),this.type=e}));var ve=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e;(0,a.Z)(this,i),e=r.call(this),(0,w.Z)((0,b.Z)(e),"renderFrameCallback",(function(){var t=Math.min((Kt()-e.easeStart)/e.easeOptions.duration,1);e.onEaseFrame(e.easeOptions.easing(t)),t<1?e.easeFrameId=e.requestRenderFrame(e.renderFrameCallback):e.stop()})),e.options=t;var n=t.minZoom,o=t.maxZoom,s=t.minPitch,u=t.maxPitch,l=t.renderWorldCopies;return e.moving=!1,e.zooming=!1,e.bearingSnap=t.bearingSnap,e.pitchEnabled=t.pitchEnabled,e.rotateEnabled=t.rotateEnabled,e.transform=new de(n,o,s,u,l),e}return(0,s.Z)(i,[{key:"requestRenderFrame",value:function(t){return 0}},{key:"cancelRenderFrame",value:function(t){}},{key:"getCenter",value:function(){var t=this.transform.center,e=t.lng,n=t.lat;return new ee(e,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(t,e){return this.jumpTo({center:t},e)}},{key:"setPitch",value:function(t,e){return this.jumpTo({pitch:t},e),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(t,e,n){return this.easeTo((0,Ft.merge)({center:t},e),n)}},{key:"zoomOut",value:function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}},{key:"setBearing",value:function(t,e){return this.jumpTo({bearing:t},e),this}},{key:"setZoom",value:function(t,e){return this.jumpTo({zoom:t},e),this}},{key:"zoomIn",value:function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}},{key:"zoomTo",value:function(t,e,n){return this.easeTo((0,Ft.merge)({zoom:t},e),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(t,e){return this.jumpTo({padding:t},e),this}},{key:"rotateTo",value:function(t,e,n){return this.easeTo((0,Ft.merge)({bearing:t},e),n)}},{key:"resetNorth",value:function(t,e){return this.rotateTo(0,(0,Ft.merge)({duration:1e3},t),e),this}},{key:"resetNorthPitch",value:function(t,e){return this.easeTo((0,Ft.merge)({bearing:0,pitch:0,duration:1e3},t),e),this}},{key:"fitBounds",value:function(t,e,n){return this.fitInternal(this.cameraForBounds(t,e),e,n)}},{key:"cameraForBounds",value:function(t,e){return t=ne.convert(t),this.cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,e)}},{key:"snapToNorth",value:function(t,e){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(t,e):this}},{key:"jumpTo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return t.zoom&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=ee.convert(t.center)),t.bearing&&n.bearing!==+t.bearing&&(i=!0,n.bearing=+t.bearing),t.pitch&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),null==t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),this.emit("movestart",new ye("movestart",e)),this.emit("move",new ye("move",e)),r&&(this.emit("zoomstart",new ye("zoomstart",e)),this.emit("zoom",new ye("zoom",e)),this.emit("zoomend",new ye("zoomend",e))),i&&(this.emit("rotatestart",new ye("rotatestart",e)),this.emit("rotate",new ye("rotate",e)),this.emit("rotateend",new ye("rotateend",e))),o&&(this.emit("pitchstart",new ye("pitchstart",e)),this.emit("pitch",new ye("pitch",e)),this.emit("pitchend",new ye("pitchend",e))),this.emit("moveend",new ye("moveend",e))}},{key:"easeTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(e=(0,Ft.merge)({offset:[0,0],duration:500,easing:qt},e)).animate||!e.essential&&Xt())&&(e.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=e.zoom?+e.zoom:i,l=e.bearing?this.normalizeBearing(e.bearing,o):o,c=e.pitch?+e.pitch:a,h=e.padding?e.padding:r.padding,p=re.convert(e.offset),f=r.centerPoint.add(p),d=r.pointLocation(f),m=ee.convert(e.center||d);this.normalizeCenter(m);var g,y,v=r.project(d),_=r.project(m).sub(v),x=r.zoomScale(u-i);e.around&&(g=ee.convert(e.around),y=r.locationPoint(g));var b={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==l,this.pitching=this.pitching||c!==a,this.padding=!r.isPaddingEqual(h),this.easeId=e.easeId,this.prepareEase(n,e.noMoveStart,b),clearTimeout(this.easeEndTimeoutID),this.ease((function(e){if(t.zooming&&(r.zoom=Ht(i,u,e)),t.rotating&&t.rotateEnabled&&(r.bearing=Ht(o,l,e)),t.pitching&&t.pitchEnabled&&(r.pitch=Ht(a,c,e)),t.padding&&(r.interpolatePadding(s,h,e),f=r.centerPoint.add(p)),g)r.setLocationAtPoint(g,y);else{var d=r.zoomScale(r.zoom-i),m=u>i?Math.min(2,x):Math.max(.5,x),b=Math.pow(m,1-e),w=r.unproject(v.add(_.mult(e*b)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?w.wrap():w,f)}t.fireMoveEvents(n)}),(function(e){t.afterEase(n,e)}),e),this}},{key:"flyTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!e.essential&&Xt()){var r=Yt(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),e=(0,Ft.merge)({offset:[0,0],speed:1.2,curve:1.42,easing:qt},e);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l=e.zoom?Gt(+e.zoom,i.minZoom,i.maxZoom):o,c=e.bearing?this.normalizeBearing(e.bearing,a):a,h=e.pitch?+e.pitch:s,p="padding"in e?e.padding:i.padding,f=i.zoomScale(l-o),d=re.convert(e.offset),m=i.centerPoint.add(d),g=i.pointLocation(m),y=ee.convert(e.center||g);this.normalizeCenter(y);var v=i.project(g),_=i.project(y).sub(v),x=e.curve,b=Math.max(i.width,i.height),w=b/f,S=_.mag();if("minZoom"in e){var E=Gt(Math.min(e.minZoom,o,l),i.minZoom,i.maxZoom),C=b/i.zoomScale(E-o);x=Math.sqrt(C/S*2)}var M=x*x;function T(t){var e=(w*w-b*b+(t?-1:1)*M*M*S*S)/(2*(t?w:b)*M*S);return Math.log(Math.sqrt(e*e+1)-e)}function A(t){return(Math.exp(t)-Math.exp(-t))/2}function P(t){return(Math.exp(t)+Math.exp(-t))/2}function L(t){return A(t)/P(t)}var I=T(0),k=function(t){return P(I)/P(I+x*t)},O=function(t){return b*((P(I)*L(I+x*t)-A(I))/M)/S},R=(T(1)-I)/x;if(Math.abs(S)<1e-6||!isFinite(R)){if(Math.abs(b-w)<1e-6)return this.easeTo(e,n);var D=w<b?-1:1;R=Math.abs(Math.log(w/b))/x,O=function(){return 0},k=function(t){return Math.exp(D*x*t)}}if("duration"in e)e.duration=+e.duration;else{var N="screenSpeed"in e?+e.screenSpeed/x:+e.speed;e.duration=1e3*R/N}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this.zooming=!0,this.rotating=a!==c,this.pitching=h!==s,this.padding=!i.isPaddingEqual(p),this.prepareEase(n,!1),this.ease((function(e){var r=e*R,f=1/k(r);i.zoom=1===e?l:o+i.scaleZoom(f),t.rotating&&(i.bearing=Ht(a,c,e)),t.pitching&&(i.pitch=Ht(s,h,e)),t.padding&&(i.interpolatePadding(u,p,e),m=i.centerPoint.add(d));var g=1===e?y:i.unproject(v.add(_.mult(O(r))).mult(f));i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,m),t.fireMoveEvents(n)}),(function(){return t.afterEase(n)}),e),this}},{key:"fitScreenCoordinates",value:function(t,e,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(re.convert(t)),this.transform.pointLocation(re.convert(e)),n,r),r,i)}},{key:"stop",value:function(t,e){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,e)}return this}},{key:"normalizeBearing",value:function(t,e){t=Vt(t,-180,180);var n=Math.abs(t-e);return Math.abs(t-360-e)<n&&(t-=360),Math.abs(t+360-e)<n&&(t+=360),t}},{key:"normalizeCenter",value:function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(t){this.emit("move",new ye("move",t)),this.zooming&&this.emit("zoom",new ye("zoom",t)),this.rotating&&this.emit("rotate",new ye("rotate",t)),this.pitching&&this.emit("rotate",new ye("pitch",t))}},{key:"prepareEase",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,e||n.moving||this.emit("movestart",new ye("movestart",t)),this.zooming&&!n.zooming&&this.emit("zoomstart",new ye("zoomstart",t)),this.rotating&&!n.rotating&&this.emit("rotatestart",new ye("rotatestart",t)),this.pitching&&!n.pitching&&this.emit("pitchstart",new ye("pitchstart",t))}},{key:"afterEase",value:function(t,e){if(!this.easeId||!e||this.easeId!==e){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new ye("zoomend",t)),r&&this.emit("rotateend",new ye("rotateend",t)),i&&this.emit("pitchend",new ye("pitchend",t)),this.emit("moveend",new ye("moveend",t))}}},{key:"ease",value:function(t,e,n){!1===n.animate||0===n.duration?(t(1),e()):(this.easeStart=Kt(),this.easeOptions=n,this.onEaseFrame=t,this.onEaseEnd=e,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(t,e,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=(0,Ft.merge)({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=(0,Ft.merge)(i,r.padding);var a=this.transform,s=a.padding,u=a.project(ee.convert(t)),l=a.project(ee.convert(e)),c=u.rotate(-n*Math.PI/180),h=l.rotate(-n*Math.PI/180),p=new re(Math.max(c.x,h.x),Math.max(c.y,h.y)),f=new re(Math.min(c.x,h.x),Math.min(c.y,h.y)),d=p.sub(f),m=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,g=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(g<0||m<0)){var y=Math.min(a.scaleZoom(a.scale*Math.min(m,g)),r.maxZoom),v=re.convert(r.offset),_=(r.padding.left-r.padding.right)/2,x=(r.padding.top-r.padding.bottom)/2,b=new re(v.x+_,v.y+x).mult(a.scale/a.zoomScale(y));return{center:a.unproject(u.add(l).div(2).sub(b)),zoom:y,bearing:n}}}},{key:"fitInternal",value:function(t,e,n){return t?(delete(e=(0,Ft.merge)(t,e)).padding,e.linear?this.easeTo(e,n):this.flyTo(e,n)):this}}]),i}(zt.EventEmitter);function _e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return xe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xe(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function xe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var be={};const we=be;be.create=function(t,e,n){var r=I.$window.document.createElement(t);return void 0!==e&&(r.className=e),n&&n.appendChild(r),r},be.createNS=function(t,e){return I.$window.document.createElementNS(t,e)};var Se=I.$window.document&&I.$window.document.documentElement.style;function Ee(t){if(!Se)return t[0];var e,n=_e(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r in Se)return r}}catch(t){n.e(t)}finally{n.f()}return t[0]}var Ce,Me=Ee(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);be.disableDrag=function(){Se&&Me&&(Ce=Se[Me],Se[Me]="none")},be.enableDrag=function(){Se&&Me&&(Se[Me]=Ce)};var Te=Ee(["transform","WebkitTransform"]);be.setTransform=function(t,e){t.style[Te]=e};var Ae=!1;try{var Pe=Object.defineProperty({},"passive",{get:function(){Ae=!0}});I.$window.addEventListener("test",Pe,Pe),I.$window.removeEventListener("test",Pe,Pe)}catch(t){Ae=!1}be.addEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&Ae?t.addEventListener(e,n,r):t.addEventListener(e,n,r.capture)},be.removeEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&Ae?t.removeEventListener(e,n,r):t.removeEventListener(e,n,r.capture)};var Le=function t(e){e.preventDefault(),e.stopPropagation(),I.$window.removeEventListener("click",t,!0)};be.suppressClick=function(){I.isMini||(I.$window.addEventListener("click",Le,!0),setTimeout((function(){I.$window.removeEventListener("click",Le,!0)}),0))},be.mousePos=function(t,e){if(I.isMini)return new re(e.clientX-t.left-0,e.clientY-t.top-0);var n=t.getBoundingClientRect();return new re(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},be.touchPos=function(t,e){if(I.isMini){var n,r=[],i=_e(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;r.push(new re(o.clientX-t.left,o.clientY-t.top))}}catch(t){i.e(t)}finally{i.f()}return r}var a,s=t.getBoundingClientRect(),u=[],l=_e(e);try{for(l.s();!(a=l.n()).done;){var c=a.value;u.push(new re(c.clientX-s.left-t.clientLeft,c.clientY-s.top-t.clientTop))}}catch(t){l.e(t)}finally{l.f()}return u},be.mouseButton=function(t){return I.isMini&&void 0!==I.$window.InstallTrigger&&2===t.button&&t.ctrlKey&&I.$window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},be.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var Ie=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t,e,n){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,a.Z)(this,i);var u=we.mousePos(e.getCanvasContainer(),n),l=e.unproject(u);return(o=r.call(this,t,ge()({point:u,lngLat:l,originalEvent:n},s))).defaultPrevented=!1,o.target=e,o}return(0,s.Z)(i,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),i}(ye);var ke=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t,e,n){var o;(0,a.Z)(this,i);var s="touchend"===t?n.changedTouches:n.touches,u=we.touchPos(e.getCanvasContainer(),s),l=u.map((function(t){return e.unproject(t)})),c=u.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new re(0,0)),h=e.unproject(c);return(o=r.call(this,t,{points:u,point:c,lngLats:l,lngLat:h,originalEvent:n})).defaultPrevented=!1,o}return(0,s.Z)(i,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),i}(ye);var Oe=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t,e,n){var o;return(0,a.Z)(this,i),(o=r.call(this,t,{originalEvent:n})).defaultPrevented=!1,o}return(0,s.Z)(i,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),i}(ye),Re=function(){function t(e){(0,a.Z)(this,t),this.map=e}return(0,s.Z)(t,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(t){this.map.emit(t.type,new Ie(t.type,this.map,t))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new Ie("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(t){this.delayContextMenu?this.contextMenuEvent=t:this.map.emit(t.type,new Ie(t.type,this.map,t)),this.map.listeners("contextmenu")&&t.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),t}(),De=function(){function t(e,n){(0,a.Z)(this,t),this.map=e,this.el=e.getCanvasContainer(),this.container=e.getContainer(),this.clickTolerance=n.clickTolerance||1}return(0,s.Z)(t,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(we.disableDrag(),this.startPos=this.lastPos=e,this.active=!0)}},{key:"mousemoveWindow",value:function(t,e){if(this.active){var n=e;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=we.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",t));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);we.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(t,e){var n=this;if(this.active&&0===t.button){var r=this.startPos,i=e;if(this.reset(),we.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new ye("boxzoomend",{originalEvent:t})),{cameraAnimation:function(t){return t.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",t)}}},{key:"keydown",value:function(t){this.active&&27===t.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",t))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(we.remove(this.box),this.box=null),we.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(t,e){return this.map.emit(t,new ye(t,{originalEvent:e}))}}]),t}();const Ne=De;var Fe=function(){function t(){(0,a.Z)(this,t),this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();var ze=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){var t;(0,a.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,w.Z)((0,b.Z)(t),"type","renderFrame"),t}return(0,s.Z)(i)}(ye);function Be(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var je={linearity:.3,easing:Wt(0,0,.3,1)},Ue=ge()({deceleration:2500,maxSpeed:1400},je),Ze=ge()({deceleration:20,maxSpeed:1400},je),Ve=ge()({deceleration:1e3,maxSpeed:360},je),Ge=ge()({deceleration:1e3,maxSpeed:90},je),He=function(){function t(e){(0,a.Z)(this,t),this.map=e,this.clear()}return(0,s.Z)(t,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(t){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:Kt(),settings:t})}},{key:"drainInertiaBuffer",value:function(){for(var t=this.inertiaBuffer,e=Kt();t.length>0&&e-t[0].time>160;)t.shift()}},{key:"onMoveEnd",value:function(t){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var e,n={zoom:0,bearing:0,pitch:0,pan:new re(0,0),pinchAround:void 0,around:void 0},r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Be(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Be(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.inertiaBuffer);try{for(r.s();!(e=r.n()).done;){var i=e.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(t){r.e(t)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=qe(n.pan.mag(),o,ge()({},Ue,t||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,We(a,s)}if(n.zoom){var u=qe(n.zoom,o,Ze);a.zoom=this.map.transform.zoom+u.amount,We(a,u)}if(n.bearing){var l=qe(n.bearing,o,Ve);a.bearing=this.map.transform.bearing+Gt(l.amount,-179,179),We(a,l)}if(n.pitch){var c=qe(n.pitch,o,Ge);a.pitch=this.map.transform.pitch+c.amount,We(a,c)}if(a.zoom||a.bearing){var h=void 0===n.pinchAround?n.around:n.pinchAround;a.around=h?this.map.unproject(h):this.map.getCenter()}return this.clear(),ge()(a,{noMoveStart:!0})}}}]),t}();function We(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function qe(t,e,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=Gt(t*i/(e/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var Xe={panStep:100,bearingStep:15,pitchStep:10};function Ye(t){return t*(2-t)}const Ke=function(){function t(){(0,a.Z)(this,t);var e=Xe;this.panStep=e.panStep,this.bearingStep=e.bearingStep,this.pitchStep=e.pitchStep}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Ye,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e.bearingStep,pitch:s.getPitch()+i*e.pitchStep,offset:[-o*e.panStep,-a*e.panStep],center:s.getCenter()},{originalEvent:t})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();var Qe,Je=function(){function t(e,n){(0,a.Z)(this,t),this.map=e,this.clickTolerance=n.clickTolerance}return(0,s.Z)(t,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(t){return this.firePreventable(new Oe(t.type,this.map,t))}},{key:"mousedown",value:function(t,e){return this.mousedownPos=e,this.firePreventable(new Ie(t.type,this.map,t))}},{key:"mouseup",value:function(t){this.map.emit(t.type,new Ie(t.type,this.map,t))}},{key:"click",value:function(t,e){this.mousedownPos&&this.mousedownPos.dist(e)>=this.clickTolerance||this.map.emit(t.type,new Ie(t.type,this.map,t))}},{key:"dblclick",value:function(t){return this.firePreventable(new Ie(t.type,this.map,t))}},{key:"mouseover",value:function(t){this.map.emit(t.type,new Ie(t.type,this.map,t))}},{key:"mouseout",value:function(t){this.map.emit(t.type,new Ie(t.type,this.map,t))}},{key:"touchstart",value:function(t){return this.firePreventable(new ke(t.type,this.map,t))}},{key:"touchmove",value:function(t){this.map.emit(t.type,new ke(t.type,this.map,t))}},{key:"touchend",value:function(t){this.map.emit(t.type,new ke(t.type,this.map,t))}},{key:"touchcancel",value:function(t){this.map.emit(t.type,new ke(t.type,this.map,t))}},{key:"firePreventable",value:function(t){if(this.map.emit(t.type,t),t.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),t}(),$e=n(3080),tn=(Qe={},(0,w.Z)(Qe,0,1),(0,w.Z)(Qe,2,2),Qe),en=function(){function t(e){(0,a.Z)(this,t),this.reset(),this.clickTolerance=e.clickTolerance||1}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(t,e){if(!this.lastPoint){var n=we.mouseButton(t);this.correctButton(t,n)&&(this.lastPoint=e,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(t,e){var n=this.lastPoint;if(n)if(t.preventDefault(),function(t,e){var n=tn[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this.eventButton))this.reset();else if(this.moved||!(e.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=e,this.move(n,e)}},{key:"mouseupWindow",value:function(t){this.lastPoint&&we.mouseButton(t)===this.eventButton&&(this.moved&&we.suppressClick(),this.reset())}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(t,e){return!1}},{key:"move",value:function(t,e){}}]),t}();var nn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"mousedown",value:function(t,e){(0,$e.Z)((0,c.Z)(i.prototype),"mousedown",this).call(this,t,e),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(t,e){return{around:e,panDelta:e.sub(t)}}},{key:"correctButton",value:function(t,e){return 0===e&&!t.ctrlKey}}]),i}(en);var rn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"correctButton",value:function(t,e){return 0===e&&t.ctrlKey||2===e}},{key:"move",value:function(t,e){var n=-.5*(e.y-t.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(t){t.preventDefault()}}]),i}(en);var on=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"contextmenu",value:function(t){t.preventDefault()}},{key:"correctButton",value:function(t,e){return 0===e&&t.ctrlKey||2===e}},{key:"move",value:function(t,e){var n=.8*(e.x-t.x);if(n)return this.active=!0,{bearingDelta:n}}}]),i}(en),an=4.000244140625,sn=function(){function t(e,n){var r=this;(0,a.Z)(this,t),(0,w.Z)(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var t=r.map.transform;if(0!==r.delta){var e="wheel"===r.type&&Math.abs(r.delta)>an?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*e)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?t.zoomScale(r.targetZoom):t.scale;r.targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=t.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:t.zoom,s=r.startZoom,u=r.easing,l=!1;if("wheel"===r.type&&s&&u){var c=Math.min((Kt()-r.lastWheelEventTime)/200,1);o=Ht(s,a,u(c)),c<1?r.frameId||(r.frameId=!0):l=!0}else o=a,l=!0;return r.active=!0,l&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:o-t.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=e,this.el=e.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=.0022222222222222222}return(0,s.Z)(t,[{key:"setZoomRate",value:function(t){this.defaultZoomRate=t}},{key:"setWheelZoomRate",value:function(t){this.wheelZoomRate=t}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(t){this.isEnabled()||(this.enabled=!0,this.aroundCenter=t&&"center"===t.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(t){if(this.isEnabled()){var e=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,n=Kt(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==e&&e%an==0?this.type="wheel":0!==e&&Math.abs(e)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=e,this.timeout=setTimeout(this.onTimeout,40,t)):this.type||(this.type=Math.abs(r*e)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,e+=this.lastValue)),t.shiftKey&&e&&(e/=4),this.type&&(this.lastWheelEvent=t,this.delta-=e,this.active||this.start(t)),t.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(t){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(t)}},{key:"start",value:function(t){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var e=we.mousePos(this.el,t);this.around=ee.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(e)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(t){var e=qt;if(this.prevEase){var n=this.prevEase,r=(Kt()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;e=Wt(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:Kt(),duration:t,easing:e},e}}]),t}();const un=sn;var ln=function(){function t(e,n){(0,a.Z)(this,t),this.clickZoom=e,this.tapZoom=n}return(0,s.Z)(t,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),t}(),cn=function(){function t(e,n,r){(0,a.Z)(this,t),this.el=e,this.mousePan=n,this.touchPan=r}return(0,s.Z)(t,[{key:"enable",value:function(t){this.inertiaOptions=t||{},this.mousePan.enable(),this.touchPan.enable(),I.isMini||this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),I.isMini||this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),t}(),hn=function(){function t(e,n,r){(0,a.Z)(this,t),this.pitchWithRotate=e.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return(0,s.Z)(t,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),t}(),pn=function(){function t(e,n,r,i){(0,a.Z)(this,t),this.el=e,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return(0,s.Z)(t,[{key:"enable",value:function(t){this.touchZoom.enable(t),this.rotationDisabled||this.touchRotate.enable(t),this.tapDragZoom.enable(),I.isMini||this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),I.isMini||this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),t}();function fn(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}function dn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var mn=function(){function t(e){(0,a.Z)(this,t),this.reset(),this.numTouches=e.numTouches}return(0,s.Z)(t,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(t,e,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){var e,n=new re(0,0),r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return dn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;n._add(i)}}catch(t){r.e(t)}finally{r.f()}return n.div(t.length)}(e),this.touches=fn(n,e)))}},{key:"touchmove",value:function(t,e,n){if(!this.aborted&&this.centroid){var r=fn(n,e);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),t}(),gn=function(){function t(e){(0,a.Z)(this,t),this.singleTap=new mn(e),this.numTaps=e.numTaps,this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(t,e,n){this.singleTap.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.singleTap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),t}(),yn=function(){function t(){(0,a.Z)(this,t),this.tap=new gn({numTouches:1,numTaps:1}),this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(t,e,n){this.swipePoint||(this.tapTime&&t.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=e[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(t,e,n))}},{key:"touchmove",value:function(t,e,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=e[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,t.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(t,e,n)&&(this.tapTime=t.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),vn=function(){function t(){(0,a.Z)(this,t),this.zoomIn=new gn({numTouches:1,numTaps:2}),this.zoomOut=new gn({numTouches:2,numTaps:1}),this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(t,e,n){this.zoomIn.touchstart(t,e,n),this.zoomOut.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.zoomIn.touchmove(t,e,n),this.zoomOut.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this,i=this.zoomIn.touchend(t,e,n),o=this.zoomOut.touchend(t,e,n);return i?(this.active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this.active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),_n=function(){function t(e){(0,a.Z)(this,t),this.minTouches=1,this.clickTolerance=e.clickTolerance||1,this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new re(0,0)}},{key:"touchstart",value:function(t,e,n){return this.calculateTransform(t,e,n)}},{key:"touchmove",value:function(t,e,n){if(this.active)return t.preventDefault(),this.calculateTransform(t,e,n)}},{key:"touchend",value:function(t,e,n){this.calculateTransform(t,e,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(t,e,n){n.length>0&&(this.active=!0);var r=fn(n,e),i=new re(0,0),o=new re(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],l=this.touches[s];l&&(i._add(u),o._add(u.sub(l)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var c=o.div(a);if(this.sum._add(c),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:c}}}}]),t}(),xn=function(){function t(){(0,a.Z)(this,t),this.reset()}return(0,s.Z)(t,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(t){}},{key:"move",value:function(t,e,n){}},{key:"touchstart",value:function(t,e,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([e[0],e[1]]))}},{key:"touchmove",value:function(t,e,n){if(this.firstTwoTouches){t.preventDefault();var r=(0,g.Z)(this.firstTwoTouches,2),i=r[0],o=r[1],a=bn(n,e,i),s=bn(n,e,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,t)}}}},{key:"touchend",value:function(t,e,n){if(this.firstTwoTouches){var r=(0,g.Z)(this.firstTwoTouches,2),i=r[0],o=r[1],a=bn(n,e,i),s=bn(n,e,o);a&&s||(this.active&&we.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(t){this.enabled=!0,this.aroundCenter=!!t&&"center"===t.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function bn(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function wn(t){return Math.abs(t.y)>Math.abs(t.x)}var Sn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"reset",value:function(){(0,$e.Z)((0,c.Z)(i.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(t){this.lastPoints=t,wn(t[0].sub(t[1]))&&(this.valid=!1)}},{key:"move",value:function(t,e,n){var r=t[0].sub(this.lastPoints[0]),i=t[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid)return this.lastPoints=t,this.active=!0,{pitchDelta:(r.y+i.y)/2*-.5}}},{key:"gestureBeginsVertically",value:function(t,e,n){if(void 0!==this.valid)return this.valid;var r=t.mag()>=2,i=e.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=t.y>0==e.y>0;return wn(t)&&wn(e)&&o}}}]),i}(xn);function En(t,e){return 180*t.angleWith(e)/Math.PI}var Cn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"reset",value:function(){(0,$e.Z)((0,c.Z)(i.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(t){this.startVector=this.vector=t[0].sub(t[1]),this.minDiameter=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.vector;if(this.vector=t[0].sub(t[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:En(this.vector,n),pinchAround:e}}},{key:"isBelowThreshold",value:function(t){this.minDiameter=Math.min(this.minDiameter,t.mag());var e=25/(Math.PI*this.minDiameter)*360,n=En(t,this.startVector);return Math.abs(n)<e}}]),i}(xn);function Mn(t,e){return Math.log(t/e)/Math.LN2}var Tn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"reset",value:function(){(0,$e.Z)((0,c.Z)(i.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(t){this.startDistance=this.distance=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.distance;if(this.distance=t[0].dist(t[1]),this.active||!(Math.abs(Mn(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:Mn(this.distance,n),pinchAround:e}}}]),i}(xn);function An(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Pn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Pn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ln=function(t){return t.zoom||t.drag||t.pitch||t.rotate};function In(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var kn=function(){function t(e,n){var r=this;(0,a.Z)(this,t),(0,w.Z)(this,"handleWindowEvent",(function(t){r.handleEvent(t,"".concat(t.type,"Window"))})),(0,w.Z)(this,"handleEvent",(function(t,e){if("blur"!==t.type){r.updatingCamera=!0;var n,i="renderFrame"===t.type?void 0:t,o={needsRenderFrame:!1},a={},s={},u=t.touches?r.getMapTouches(t.touches):void 0,l=u?we.touchPos(r.el,u):we.mousePos(r.el,t),c=An(r.handlers);try{for(c.s();!(n=c.n()).done;){var h=n.value,p=h.handlerName,f=h.handler,d=h.allowed;if(f.isEnabled()){var m=void 0;if(r.blockedByActive(s,d,p))f.reset();else{var g=e||t.type;f&&f[g]&&(m=f[g](t,l,u),r.mergeIHandlerResult(o,a,m,p,i),m&&m.needsRenderFrame&&r.triggerRenderFrame())}(m||f.isActive())&&(s[p]=f)}}}catch(t){c.e(t)}finally{c.f()}var y={};for(var v in r.previousActiveHandlers)s[v]||(y[v]=i);r.previousActiveHandlers=s,(Object.keys(y).length||In(o))&&(r.changes.push([o,a,y]),r.triggerRenderFrame()),(Object.keys(s).length||In(o))&&r.map.stop(!0),r.updatingCamera=!1;var _=o.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=e,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new He(e),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;if(this.listeners=[],I.isMini)I.$window.document.addEventListener("touchstart",(function(t){r.handleEvent(t)}),{}),I.$window.document.addEventListener("touchmove",(function(t){r.handleEvent(t)}),{}),I.$window.document.addEventListener("touchend",(function(t){r.handleEvent(t)}),{}),I.$window.document.addEventListener("touchcancel",(function(t){r.handleEvent(t)}),{});else{this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,s=An(this.listeners);try{for(s.s();!(o=s.n()).done;){var u=(0,g.Z)(o.value,3),l=u[0],c=u[1],h=u[2];we.addEventListener(l,c,l===window.document?this.handleWindowEvent:this.handleEvent,h)}}catch(t){s.e(t)}finally{s.f()}}}return(0,s.Z)(t,[{key:"destroy",value:function(){var t,e=An(this.listeners);try{for(e.s();!(t=e.n()).done;){var n=(0,g.Z)(t.value,3),r=n[0],i=n[1],o=n[2];we.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(t){e.e(t)}finally{e.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var t,e=An(this.handlers);try{for(e.s();!(t=e.n()).done;)t.value.handler.reset()}catch(t){e.e(t)}finally{e.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var t,e=An(this.handlers);try{for(e.s();!(t=e.n()).done;)if(t.value.handler.isActive())return!0}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(Ln(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(t,e,n,r,i){if(n){(0,Ft.merge)(t,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(e.zoom=o),void 0!==n.panDelta&&(e.drag=o),void 0!==n.pitchDelta&&(e.pitch=o),void 0!==n.bearingDelta&&(e.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var t=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(e){delete t.frameId,t.handleEvent(new ze("renderFrame",{timeStamp:e})),t.applyChanges()})))}},{key:"addDefaultHandlers",value:function(t){var e=this.map,n=e.getCanvasContainer();this.add("mapEvent",new Je(e,t));var r=e.boxZoom=new Ne(e,t);this.add("boxZoom",r);var i=new vn,o=new Fe;e.doubleClickZoom=new ln(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new yn;this.add("tapDragZoom",a);var s=e.touchPitch=new Sn;this.add("touchPitch",s);var u=new rn(t),l=new on(t);e.dragRotate=new hn(t,u,l),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",l,["mouseRotate"]);var c=new nn(t),h=new _n(t);e.dragPan=new cn(n,c,h),this.add("mousePan",c),this.add("touchPan",h,["touchZoom","touchRotate"]);var p=new Cn,f=new Tn;e.touchZoomRotate=new pn(n,f,p,a),this.add("touchRotate",p,["touchPan","touchZoom"]),this.add("touchZoom",f,["touchPan","touchRotate"]);var d=e.scrollZoom=new un(e,this);this.add("scrollZoom",d,["mousePan"]);var m=e.keyboard=new Ke;this.add("keyboard",m),this.add("blockableMapEvent",new Re(e));for(var g=0,y=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<y.length;g++){var v=y[g];t.interactive&&t[v]&&e[v].enable(t[v])}}},{key:"add",value:function(t,e,n){this.handlers.push({handlerName:t,handler:e,allowed:n}),this.handlersById[t]=e}},{key:"blockedByActive",value:function(t,e,n){for(var r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(t){var e,n=[],r=An(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,o=i.target;(I.isMini||this.el.contains(o))&&n.push(i)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var t,e={},n={},r={},i=An(this.changes);try{for(i.s();!(t=i.n()).done;){var o=(0,g.Z)(t.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(e.panDelta=(e.panDelta||new re(0,0))._add(a.panDelta)),a.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(e.around=a.around),void 0!==a.pinchAround&&(e.pinchAround=a.pinchAround),a.noInertia&&(e.noInertia=a.noInertia),(0,Ft.merge)(n,s),(0,Ft.merge)(r,u)}}catch(t){i.e(t)}finally{i.f()}this.updateMapTransform(e,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(t,e,n){var r=this.map,i=r.transform;if(!In(t))return this.fireEvents(e,n);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,l=t.pinchAround,c=t.around;void 0!==l&&(c=l),r.stop(!0),c=c||r.transform.centerPoint;var h=i.pointLocation(o?c.sub(o):c);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,c),this.map.update(),t.noInertia||this.inertia.record(t),this.fireEvents(e,n)}},{key:"fireEvents",value:function(t,e){var n=this,r=Ln(this.eventsInProgress),i=Ln(t),o={};for(var a in t)if(t[a]){var s=t[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=t[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var l in t.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),t)if(t[l]){var c=t[l].originalEvent;this.fireEvent(l,c)}var h,p={};for(var f in this.eventsInProgress)if(this.eventsInProgress[f]){var d=this.eventsInProgress[f],m=d.handlerName,g=d.originalEvent;this.handlersById[m].isActive()||(delete this.eventsInProgress[f],h=e[m]||g,p["".concat(f,"end")]=h)}for(var y in p)p[y]&&this.fireEvent(y,p[y]);var v=Ln(this.eventsInProgress);if((r||i)&&!v){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),x=function(t){return 0!==t&&-n.bearingSnap<t&&t<n.bearingSnap};_?(x(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:h})):(this.map.emit("moveend",new ye("moveend",{originalEvent:h})),x(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(t,e){this.map.emit(t,new ye(t,e?{originalEvent:e}:{}))}}]),t}();const On=kn;var Rn=function(){function t(e){var n=this;(0,a.Z)(this,t),(0,w.Z)(this,"onHashChange",(function(){var t=n.getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(+t)}))){var e=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(t[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1})),(0,w.Z)(this,"getCurrentHash",(function(){var t,e=window.location.hash.replace("#","");return n.hashName?(e.split("&").map((function(t){return t.split("=")})).forEach((function(e){e[0]===n.hashName&&(t=e)})),(t&&t[1]||"").split("/")):e.split("/")})),(0,w.Z)(this,"updateHashUnthrottled",(function(){var t=n.getHashString();try{window.history.replaceState(window.history.state,"",t)}catch(t){}})),this.hashName=e&&encodeURIComponent(e),this.updateHash=(0,Ft.throttle)(this.updateHashUnthrottled,300)}return(0,s.Z)(t,[{key:"addTo",value:function(t){return this.map=t,I.$window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return I.$window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(t){var e=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(e.lng*i)/i,a=Math.round(e.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),l="";if(l+=t?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(l+="/".concat(Math.round(10*s)/10)),u&&(l+="/".concat(Math.round(u))),this.hashName){var c=this.hashName,h=!1,p=window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===c?(h=!0,"".concat(e,"=").concat(l)):t})).filter((function(t){return t}));return h||p.push("".concat(c,"=").concat(l)),"#".concat(p.join("&"))}return"#".concat(l)}}]),t}();const Dn=Rn;var Nn=null,Fn=[],zn=(I.$window.performance,function(t){var e=t;if(null!=Nn){var n=e-Nn;Fn.push(n)}Nn=e});function Bn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return jn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function jn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const Un=function(){function t(){(0,a.Z)(this,t),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return(0,s.Z)(t,[{key:"add",value:function(t){var e=++this.id;return this.queue.push({callback:t,id:e,cancelled:!1}),e}},{key:"remove",value:function(t){var e,n=this.currentlyRunning,r=Bn(n?this.queue.concat(n):this.queue);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.id===t)return void(i.cancelled=!0)}}catch(t){r.e(t)}finally{r.f()}}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.currentlyRunning=this.queue;this.queue=[];var n,r=Bn(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(t),this.cleared))break}}catch(t){r.e(t)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),t}();!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var Zn={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},Vn=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e;if((0,a.Z)(this,i),e=r.call(this,(0,Ft.merge)({},Zn,t)),(0,w.Z)((0,b.Z)(e),"renderTaskQueue",new Un),(0,w.Z)((0,b.Z)(e),"trackResize",!0),(0,w.Z)((0,b.Z)(e),"onWindowOnline",(function(){e.update()})),(0,w.Z)((0,b.Z)(e),"onWindowResize",(function(t){e.trackResize&&e.resize({originalEvent:t}).update()})),I.isMini?e.initMiniContainer():e.initContainer(),e.resize(),e.handlers=new On((0,b.Z)(e),e.options),"undefined"!=typeof window&&(window.addEventListener("online",e.onWindowOnline,!1),window.addEventListener("resize",e.onWindowResize,!1),window.addEventListener("orientationchange",e.onWindowResize,!1)),!I.isMini){var n="string"==typeof t.hash&&t.hash||void 0;t.hash&&(e.hash=new Dn(n).addTo((0,b.Z)(e)))}return e.hash&&e.hash.onHashChange()||(e.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(e.resize(),e.fitBounds(t.bounds,(0,Ft.merge)({},t.fitBoundsOptions,{duration:0})))),e}return(0,s.Z)(i,[{key:"resize",value:function(t){var e=this.containerDimensions(),n=(0,g.Z)(e,2),r=n[0],i=n[1];if(this.transform.resize(r,i),I.isMini)return this;var o=!this.moving;return o&&(this.stop(),this.emit("movestart",new I.$window.Event("movestart",t)),this.emit("move",new I.$window.Event("move",t))),this.emit("resize",new I.$window.Event("resize",t)),o&&this.emit("moveend",new I.$window.Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(ee.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(re.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(ne.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=$t((function(e){zn(e),t.frame=null,t.update(e)})))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=$t((function(n){zn(n),e.frame=null,e.renderTaskQueue.run(t)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=I.DOM.create("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(I.isMini?(t=this.container.width/I.$window.devicePixelRatio,e=this.container.height/I.$window.devicePixelRatio):(t=0===(t=this.container.clientWidth)?400:t,e=0===(e=this.container.clientHeight)?300:e)),[t,e]}}]),i}(ve);!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var Gn,Hn,Wn,qn,Xn,Yn,Kn,Qn,Jn,$n,tr,er,nr={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},rr=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(t){var e;return(0,a.Z)(this,i),e=r.call(this,(0,Ft.merge)({},nr,t)),(0,w.Z)((0,b.Z)(e),"renderTaskQueue",new Un),(0,w.Z)((0,b.Z)(e),"trackResize",!0),(0,w.Z)((0,b.Z)(e),"onWindowOnline",(function(){e.update()})),(0,w.Z)((0,b.Z)(e),"onWindowResize",(function(t){e.trackResize&&e.resize({originalEvent:t}).update()})),e.initContainer(),e.resize(),e.handlers=new On((0,b.Z)(e),e.options),"undefined"!=typeof window&&(window.addEventListener("online",e.onWindowOnline,!1),window.addEventListener("resize",e.onWindowResize,!1),window.addEventListener("orientationchange",e.onWindowResize,!1)),e}return(0,s.Z)(i,[{key:"resize",value:function(t){var e=this.containerDimensions(),n=e[0],r=e[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",t)),this.emit("move",new Event("move",t))),this.emit("resize",new Event("resize",t)),i&&this.emit("moveend",new Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(ee.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(re.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(ne.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=$t((function(e){zn(e),t.frame=null,t.update(e)})))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=$t((function(n){zn(n),e.frame=null,e.renderTaskQueue.run(t)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=I.DOM.create("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(t=this.container.clientWidth||400,e=this.container.clientHeight||300),[t,e]}},{key:"resizeCanvas",value:function(t,e){var n=I.DOM.DPR||1;this.canvas.width=n*t,this.canvas.height=n*e,this.canvas.style.width="".concat(t,"px"),this.canvas.style.height="".concat(e,"px")}}]),i}(ve),ir={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},or={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},ar=(Gn=(0,P.b2)(),Hn=(0,P.f3)(d.TYPES.MapConfig),Wn=(0,P.f3)(d.TYPES.IGlobalConfigService),qn=(0,P.f3)(d.TYPES.ICoordinateSystemService),Xn=(0,P.f3)(d.TYPES.IEventEmitter),Gn((Kn=function(){function t(){var e=this;(0,a.Z)(this,t),(0,w.Z)(this,"version",L.G.L7MAP),(0,w.Z)(this,"simpleMapCoord",new k),(0,w.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,p.Z)(this,"config",Qn,this),(0,p.Z)(this,"configService",Jn,this),(0,p.Z)(this,"coordinateSystemService",$n,this),(0,p.Z)(this,"eventEmitter",tr,this),(0,w.Z)(this,"handleCameraChanged",(function(t){var n=e.map.getCenter(),r=n.lat,i=n.lng;e.emit("mapchange"),e.viewport.syncWithMapCamera({bearing:e.map.getBearing(),center:[i,r],viewportHeight:e.map.transform.height,pitch:e.map.getPitch(),viewportWidth:e.map.transform.width,zoom:e.map.getZoom(),cameraHeight:0}),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)}))}return(0,s.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=I.DOM.create("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(or[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(or[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===L.G.SIMPLE)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.panTo([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.dragEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,e){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,e=null!==(t=this.map.getStyle().sprite)&&void 0!==t?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(e)?null==e?void 0:e.replace(/\/\w+$/,"").replace(/sprites/,"styles"):e}catch(t){return""}}},{key:"getMapStyleConfig",value:function(){return ir}},{key:"getMapStyleValue",value:function(t){var e;return null!==(e=this.getMapStyleConfig()[t])&&void 0!==e?e:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var e=t;return"string"==typeof t&&(e=document.getElementById(t)),e}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,e=void 0===t||t;this.viewport.getZoom()>12&&e?this.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT)}}]),t}(),Qn=(0,f.Z)(Kn.prototype,"config",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jn=(0,f.Z)(Kn.prototype,"configService",[Wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$n=(0,f.Z)(Kn.prototype,"coordinateSystemService",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tr=(0,f.Z)(Kn.prototype,"eventEmitter",[Xn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yn=Kn))||Yn),sr=function(){function t(){(0,a.Z)(this,t),(0,w.Z)(this,"xzReg",.6*-Math.PI),(0,w.Z)(this,"yReg",.2*Math.PI),(0,w.Z)(this,"earthCameraRadius",200),(0,w.Z)(this,"earthCameraZoom",1),(0,w.Z)(this,"cameraPosition",A.create()),(0,w.Z)(this,"projectionMatrix",T.create()),(0,w.Z)(this,"modelMatrix",T.create()),(0,w.Z)(this,"viewMatrix",T.create()),(0,w.Z)(this,"viewProjectionMatrix",T.create()),(0,w.Z)(this,"ViewProjectionMatrixUncentered",T.create()),(0,w.Z)(this,"viewUncenteredMatrix",T.create())}return(0,s.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.viewportHeight,n=void 0===e?1:e,r=t.viewportWidth,i=(void 0===r?1:r)/n;T.perspective(this.projectionMatrix,20,i,.1,1e4);var o=this.earthCameraRadius*Math.cos(this.xzReg),a=this.earthCameraRadius*Math.sin(this.xzReg),s=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=A.fromValues(o,s,a),A.normalize(this.cameraPosition,this.cameraPosition),A.multiply(this.cameraPosition,this.cameraPosition,A.fromValues(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),A.scale(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var u=A.create();A.cross(u,this.cameraPosition,A.fromValues(0,1,0));var l=A.fromValues(0,1,0);A.cross(l,u,this.cameraPosition);var c=A.fromValues(0,0,0);T.lookAt(this.viewMatrix,this.cameraPosition,c,l),this.viewUncenteredMatrix=T.clone(this.viewMatrix),T.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),T.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(t){this.xzReg+=t*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(t){this.yReg+=t*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(t){this.earthCameraZoom+=t,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),ur=["id","style","rotation"];var lr={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},cr=(0,P.b2)()(er=function(t){(0,u.Z)(o,t);var e,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function o(){var t;(0,a.Z)(this,o);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,w.Z)((0,b.Z)(t),"version",L.G.GLOBEL),(0,w.Z)((0,b.Z)(t),"dragging",!1),(0,w.Z)((0,b.Z)(t),"handleCameraChanged",(function(e){t.emit("mapchange"),t.handleCameraChanging=!0,t.handleCameraTimer&&clearTimeout(t.handleCameraTimer),t.handleCameraTimer=setTimeout((function(){t.handleCameraChanging=!1}),2e3);e.type&&e.originalEvent&&("wheel"===e.originalEvent.type&&t.viewport.scaleZoom(.01*Math.sign(e.originalEvent.wheelDelta)*-1),Math.abs(e.originalEvent.movementX)>Math.abs(e.originalEvent.movementY)?e.originalEvent.movementX>0?t.viewport.rotateY(.02):e.originalEvent.movementX<0&&t.viewport.rotateY(-.02):e.originalEvent.movementY>0?t.viewport.rotateX(.02):e.originalEvent.movementY<0&&t.viewport.rotateX(-.02));var n=t.config.offsetCoordinate,r=void 0===n||n;t.viewport.syncWithMapCamera({viewportHeight:t.map.transform.height,viewportWidth:t.map.transform.width}),t.viewport.getZoom()>12&&r?t.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT_OFFSET):t.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT),t.cameraChangedCallback(t.viewport)})),t}return(0,s.Z)(o,[{key:"lngLatToMercator",value:function(t,e){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(t,e,n,r,i){throw new Error("Method not implemented.")}},{key:"on",value:function(t,e){-1!==d.MapServiceEvent.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(lr[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(lr[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"earth"}},{key:"init",value:(e=(0,x.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,i=e.style,o=void 0===i?"light":i,a=e.rotation,s=void 0===a?0:a,u=(0,_.Z)(e,ur),this.viewport=new sr,this.$mapContainer=this.creatMapContainer(r),this.map=new rr((0,h.Z)({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"rotateY",value:function(t){var e=t||{},n=e.force,r=void 0!==n&&n,i=e.reg,o=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(o),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}]),o}(ar))||er;var hr,pr=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"getServiceConstructor",value:function(){return cr}}]),i}(m),fr=["id","style","rotation","mapInstance","version","mapSize","interactive"],dr=["id","style","rotation","mapInstance","canvas","hasBaseMap"];var mr=(0,P.b2)()(hr=function(t){(0,u.Z)(p,t);var e,n,r,i,o=(r=p,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(r);if(i){var n=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function p(){var t;(0,a.Z)(this,p);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),(0,w.Z)((0,b.Z)(t),"version",L.G.L7MAP),(0,w.Z)((0,b.Z)(t),"handleMiniCameraChanged",(function(e,n,r,i,o){var a=t.config.offsetCoordinate,s=void 0===a||a;t.viewport.syncWithMapCamera({bearing:i,center:[e,n],viewportHeight:t.map.transform.height,pitch:o,viewportWidth:t.map.transform.width,zoom:r,cameraHeight:0}),t.viewport.getZoom()>12&&s?t.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT_OFFSET):t.coordinateSystemService.setCoordinateSystem(d.CoordinateSystem.LNGLAT),t.cameraChangedCallback(t.viewport)})),t}return(0,s.Z)(p,[{key:"lngLatToMercator",value:function(t,e){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(){throw new Error("Method not implemented.")}},{key:"init",value:(n=(0,x.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,f,d,m,g;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,i=e.style,o=void 0===i?"light":i,a=e.rotation,s=void 0===a?0:a,u=e.mapInstance,l=e.version,c=void 0===l?"L7MAP":l,p=e.mapSize,f=void 0===p?1e4:p,d=e.interactive,m=void 0===d||d,g=(0,_.Z)(e,fr),this.viewport=new ht,this.version=c,this.simpleMapCoord.setSize(f),c===L.G.SIMPLE&&g.center&&(g.center=this.simpleMapCoord.unproject(g.center)),u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new Vn((0,h.Z)({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},g))),this.map.on("load",this.handleCameraChanged),m&&this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"initMiniMap",value:(e=(0,x.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,f=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(e=this.config).id,n=e.style,r=void 0===n?"light":n,i=e.rotation,o=void 0===i?0:i,e.mapInstance,a=e.canvas,s=void 0===a?null:a,u=e.hasBaseMap,l=void 0!==u&&u,c=(0,_.Z)(e,dr),this.viewport=new ht,this.$mapContainer=s,this.map=new Vn((0,h.Z)({container:this.$mapContainer,style:this.getMapStyleValue(r),bearing:o,canvas:s},c)),l?(p=this.map.getCenter(),this.handleMiniCameraChanged(p.lng,p.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),I.$window.document.addEventListener("mapCameaParams",(function(t){var e=t.e,n=e.longitude,r=e.latitude,i=e.scale,o=e.bearing,a=e.pitch;f.handleMiniCameraChanged(n,r,i-1.25,o,a)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}}]),p}(ar))||hr;var gr,yr=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"getServiceConstructor",value:function(){return mr}}]),i}(m),vr=n(6172),_r=n.n(vr),xr=function(){function t(){(0,a.Z)(this,t)}return(0,s.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth;this.viewport=new ct({width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),br=["id","attributionControl","style","token","rotation","mapInstance"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=_r();var wr=0,Sr="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",Er=(0,P.b2)()(gr=function(t){(0,u.Z)(o,t);var e,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(n);if(r){var i=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,l.Z)(this,t)});function o(){var t;(0,a.Z)(this,o);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=i.call.apply(i,[this].concat(n)),(0,w.Z)((0,b.Z)(t),"version",L.G.MAPBOX),t}return(0,s.Z)(o,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(t,0),r=n.x,i=n.y;return[r-e.x,i-e.y]}},{key:"lngLatToMercator",value:function(t,e){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=T.create();return T.translate(s,s,A.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),T.scale(s,s,A.fromValues(a*r[0],-a*r[1],a*r[2])),T.rotateX(s,s,n[0]),T.rotateY(s,s,n[1]),T.rotateZ(s,s,n[2]),s}},{key:"init",value:(e=(0,x.Z)(E().mark((function t(){var e,n,r,i,o,a,s,u,l,c,p,f,d;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,i=e.attributionControl,o=void 0!==i&&i,a=e.style,s=void 0===a?"light":a,u=e.token,l=void 0===u?Sr:u,c=e.rotation,p=void 0===c?0:c,f=e.mapInstance,d=(0,_.Z)(e,br),this.viewport=new xr,f||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),l!==Sr||"blank"===s||window.mapboxgl.accessToken||f||console.warn(this.configService.getSceneWarninfo("MapToken")),f||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=l),f?(this.map=f,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.mapboxgl.Map((0,h.Z)({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:p},d))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,e){var n=new(_r().LngLat)(t[0],t[1]),r=new(_r().LngLat)(e[0],e[1]),i=n.distanceTo(r),o=_r().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),a=_r().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=o.x,u=o.y,l=a.x,c=a.y;return 4194304*Math.sqrt(Math.pow(s-l,2)+Math.pow(u-c,2))*2/i}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"creatMapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+wr++,e.appendChild(n),n}}]),o}(ar))||gr;!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-ctrl-logo {\n display: none !important;\n}\n");var Cr=function(t){(0,u.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,c.Z)(e);if(n){var i=(0,c.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,l.Z)(this,t)});function i(){return(0,a.Z)(this,i),r.apply(this,arguments)}return(0,s.Z)(i,[{key:"getServiceConstructor",value:function(){return Er}}]),i}(m)},5691:(t,e,n)=>{"use strict";var r;n.d(e,{G:()=>r}),function(t){t["GAODE1.x"]="GAODE1.x",t["GAODE2.x"]="GAODE2.x",t.MAPBOX="MAPBOX",t.L7MAP="L7MAP",t.SIMPLE="SIMPLE",t.GLOBEL="GLOBEL"}(r||(r={}))},7112:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Scene:()=>lt});var r,i,o,a,s,u,l,c,h,p,f,d,m,g,y,v=n(1517),_=n(596),x=n(5683),b=n(89),w=n(5803),S=n(4534),E=n(137),C=n(7012),M=n(537),T=n(5814),A=n.n(T),P=n(9470),L=n(7745),I=n(5499),k=n.n(I),O=(n(171),function(){function t(e,n){(0,x.Z)(this,t);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return(0,b.Z)(t,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}()),R=(r={},(0,M.Z)(r,S.gl.POINTS,"points"),(0,M.Z)(r,S.gl.LINES,"lines"),(0,M.Z)(r,S.gl.LINE_LOOP,"line loop"),(0,M.Z)(r,S.gl.LINE_STRIP,"line strip"),(0,M.Z)(r,S.gl.TRIANGLES,"triangles"),(0,M.Z)(r,S.gl.TRIANGLE_FAN,"triangle fan"),(0,M.Z)(r,S.gl.TRIANGLE_STRIP,"triangle strip"),r),D=(i={},(0,M.Z)(i,S.gl.STATIC_DRAW,"static"),(0,M.Z)(i,S.gl.DYNAMIC_DRAW,"dynamic"),(0,M.Z)(i,S.gl.STREAM_DRAW,"stream"),i),N=(o={},(0,M.Z)(o,S.gl.BYTE,"int8"),(0,M.Z)(o,S.gl.UNSIGNED_INT,"int16"),(0,M.Z)(o,S.gl.INT,"int32"),(0,M.Z)(o,S.gl.UNSIGNED_BYTE,"uint8"),(0,M.Z)(o,S.gl.UNSIGNED_SHORT,"uint16"),(0,M.Z)(o,S.gl.UNSIGNED_INT,"uint32"),(0,M.Z)(o,S.gl.FLOAT,"float"),o),F=(a={},(0,M.Z)(a,S.gl.ALPHA,"alpha"),(0,M.Z)(a,S.gl.LUMINANCE,"luminance"),(0,M.Z)(a,S.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,M.Z)(a,S.gl.RGB,"rgb"),(0,M.Z)(a,S.gl.RGBA,"rgba"),(0,M.Z)(a,S.gl.RGBA4,"rgba4"),(0,M.Z)(a,S.gl.RGB5_A1,"rgb5 a1"),(0,M.Z)(a,S.gl.RGB565,"rgb565"),(0,M.Z)(a,S.gl.DEPTH_COMPONENT,"depth"),(0,M.Z)(a,S.gl.DEPTH_STENCIL,"depth stencil"),a),z=(s={},(0,M.Z)(s,S.gl.DONT_CARE,"dont care"),(0,M.Z)(s,S.gl.NICEST,"nice"),(0,M.Z)(s,S.gl.FASTEST,"fast"),s),B=(u={},(0,M.Z)(u,S.gl.NEAREST,"nearest"),(0,M.Z)(u,S.gl.LINEAR,"linear"),(0,M.Z)(u,S.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,M.Z)(u,S.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,M.Z)(u,S.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,M.Z)(u,S.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),u),j=(l={},(0,M.Z)(l,S.gl.REPEAT,"repeat"),(0,M.Z)(l,S.gl.CLAMP_TO_EDGE,"clamp"),(0,M.Z)(l,S.gl.MIRRORED_REPEAT,"mirror"),l),U=(c={},(0,M.Z)(c,S.gl.NONE,"none"),(0,M.Z)(c,S.gl.BROWSER_DEFAULT_WEBGL,"browser"),c),Z=(h={},(0,M.Z)(h,S.gl.NEVER,"never"),(0,M.Z)(h,S.gl.ALWAYS,"always"),(0,M.Z)(h,S.gl.LESS,"less"),(0,M.Z)(h,S.gl.LEQUAL,"lequal"),(0,M.Z)(h,S.gl.GREATER,"greater"),(0,M.Z)(h,S.gl.GEQUAL,"gequal"),(0,M.Z)(h,S.gl.EQUAL,"equal"),(0,M.Z)(h,S.gl.NOTEQUAL,"notequal"),h),V=(p={},(0,M.Z)(p,S.gl.FUNC_ADD,"add"),(0,M.Z)(p,S.gl.MIN_EXT,"min"),(0,M.Z)(p,S.gl.MAX_EXT,"max"),(0,M.Z)(p,S.gl.FUNC_SUBTRACT,"subtract"),(0,M.Z)(p,S.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),p),G=(f={},(0,M.Z)(f,S.gl.ZERO,"zero"),(0,M.Z)(f,S.gl.ONE,"one"),(0,M.Z)(f,S.gl.SRC_COLOR,"src color"),(0,M.Z)(f,S.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,M.Z)(f,S.gl.SRC_ALPHA,"src alpha"),(0,M.Z)(f,S.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,M.Z)(f,S.gl.DST_COLOR,"dst color"),(0,M.Z)(f,S.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,M.Z)(f,S.gl.DST_ALPHA,"dst alpha"),(0,M.Z)(f,S.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,M.Z)(f,S.gl.CONSTANT_COLOR,"constant color"),(0,M.Z)(f,S.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,M.Z)(f,S.gl.CONSTANT_ALPHA,"constant alpha"),(0,M.Z)(f,S.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,M.Z)(f,S.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),f),H=(d={},(0,M.Z)(d,S.gl.NEVER,"never"),(0,M.Z)(d,S.gl.ALWAYS,"always"),(0,M.Z)(d,S.gl.LESS,"less"),(0,M.Z)(d,S.gl.LEQUAL,"lequal"),(0,M.Z)(d,S.gl.GREATER,"greater"),(0,M.Z)(d,S.gl.GEQUAL,"gequal"),(0,M.Z)(d,S.gl.EQUAL,"equal"),(0,M.Z)(d,S.gl.NOTEQUAL,"notequal"),d),W=(m={},(0,M.Z)(m,S.gl.ZERO,"zero"),(0,M.Z)(m,S.gl.KEEP,"keep"),(0,M.Z)(m,S.gl.REPLACE,"replace"),(0,M.Z)(m,S.gl.INVERT,"invert"),(0,M.Z)(m,S.gl.INCR,"increment"),(0,M.Z)(m,S.gl.DECR,"decrement"),(0,M.Z)(m,S.gl.INCR_WRAP,"increment wrap"),(0,M.Z)(m,S.gl.DECR_WRAP,"decrement wrap"),m),q=(g={},(0,M.Z)(g,S.gl.FRONT,"front"),(0,M.Z)(g,S.gl.BACK,"back"),g),X=function(){function t(e,n){(0,x.Z)(this,t);var r=n.data,i=n.usage,o=n.type;this.buffer=e.buffer({data:r,usage:D[i||S.gl.STATIC_DRAW],type:N[o||S.gl.UNSIGNED_BYTE]})}return(0,b.Z)(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var e=t.data,n=t.offset;this.buffer.subdata(e,n)}}]),t}(),Y=function(){function t(e,n){(0,x.Z)(this,t);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=e.elements({data:r,usage:D[i||S.gl.STATIC_DRAW],type:N[o||S.gl.UNSIGNED_BYTE],count:a})}return(0,b.Z)(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var e=t.data;this.elements.subdata(e)}},{key:"destroy",value:function(){}}]),t}(),K=function(){function t(e,n){(0,x.Z)(this,t);var r=n.width,i=n.height,o=n.color,a=n.colors,s={width:r,height:i};Array.isArray(a)&&(s.colors=a.map((function(t){return t.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=e.framebuffer(s)}return(0,b.Z)(t,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.framebuffer.resize(e,n)}}]),t}(),Q=n(5063),J=n(9479),$=function(){function t(e,n){(0,x.Z)(this,t),(0,M.Z)(this,"destroyed",!1),(0,M.Z)(this,"uniforms",{}),this.reGl=e;var r=n.pick,i=void 0===r||r,o=n.vs,a=n.fs,s=n.attributes,u=n.uniforms,l=n.primitive,c=n.count,h=n.elements,p=n.depth,f=n.blend,d=n.stencil,m=n.cull,g=n.instances,y={};this.options=n,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach((function(t){y[t]=e.prop(t)})));var _={};Object.keys(s).forEach((function(t){_[t]=s[t].get()}));var b={attributes:_,frag:a,uniforms:y,vert:o,blend:{},primitive:R[void 0===l?S.gl.TRIANGLES:l]};if(g&&(b.instances=g),c?b.count=c:h&&(b.elements=h.get()),this.initDepthDrawParams({depth:p},b),this.initBlendDrawParams({blend:f},b),this.initStencilDrawParams({stencil:d},b),this.initCullDrawParams({cull:m},b),this.drawCommand=e(b),i){var w=(0,J.cloneDeep)(b);w.blend=(0,v.Z)((0,v.Z)({},w.blend),{},{enable:!1}),this.drawPickCommand=e(w)}this.drawParams=b}return(0,b.Z)(t,[{key:"updateAttributesAndElements",value:function(t,e){var n={};if(Object.keys(t).forEach((function(e){n[e]=t[e].get()})),this.drawParams.attributes=n,this.drawParams.elements=e.get(),this.drawCommand=this.reGl(this.drawParams),this.options.pick){var r=(0,J.cloneDeep)(this.drawParams);r.blend=(0,v.Z)((0,v.Z)({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}}},{key:"updateAttributes",value:function(t){var e={};if(Object.keys(t).forEach((function(n){e[n]=t[n].get()})),this.drawParams.attributes=e,this.drawCommand=this.reGl(this.drawParams),this.options.pick){var n=(0,J.cloneDeep)(this.drawParams);n.blend=(0,v.Z)((0,v.Z)({},n.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(n)}}},{key:"addUniforms",value:function(t){this.uniforms=(0,v.Z)((0,v.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,e){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=(0,v.Z)((0,v.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),r={};Object.keys(n).forEach((function(t){var e=(0,Q.Z)(n[t]);"boolean"===e||"number"===e||Array.isArray(n[t])||n[t].BYTES_PER_ELEMENT?r[t]=n[t]:r[t]=n[t].get()})),e?this.drawPickCommand&&this.drawPickCommand(r):this.drawCommand(r)}}},{key:"destroy",value:function(){var t,e;null===(t=this.drawParams)||void 0===t||null===(e=t.elements)||void 0===e||e.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(t){null==t||t.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,e){var n=t.depth;n&&(e.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:Z[n.func||S.gl.LESS],range:n.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,e){var n=t.blend;if(n){var r=n.enable,i=n.func,o=n.equation,a=n.color,s=void 0===a?[0,0,0,0]:a;e.blend={enable:!!r,func:{srcRGB:G[i&&i.srcRGB||S.gl.SRC_ALPHA],srcAlpha:G[i&&i.srcAlpha||S.gl.SRC_ALPHA],dstRGB:G[i&&i.dstRGB||S.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:G[i&&i.dstAlpha||S.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:V[o&&o.rgb||S.gl.FUNC_ADD],alpha:V[o&&o.alpha||S.gl.FUNC_ADD]},color:s}}}},{key:"initStencilDrawParams",value:function(t,e){var n=t.stencil;if(n){var r=n.enable,i=n.mask,o=void 0===i?-1:i,a=n.func,s=void 0===a?{cmp:S.gl.ALWAYS,ref:0,mask:-1}:a,u=n.opFront,l=void 0===u?{fail:S.gl.KEEP,zfail:S.gl.KEEP,zpass:S.gl.KEEP}:u,c=n.opBack,h=void 0===c?{fail:S.gl.KEEP,zfail:S.gl.KEEP,zpass:S.gl.KEEP}:c;e.stencil={enable:!!r,mask:o,func:(0,v.Z)((0,v.Z)({},s),{},{cmp:H[s.cmp]}),opFront:{fail:W[l.fail],zfail:W[l.zfail],zpass:W[l.zpass]},opBack:{fail:W[h.fail],zfail:W[h.zfail],zpass:W[h.zpass]}}}}},{key:"initCullDrawParams",value:function(t,e){var n=t.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?S.gl.BACK:i;e.cull={enable:!!r,face:q[o]}}}},{key:"extractUniforms",value:function(t){var e=this,n={};return Object.keys(t).forEach((function(r){e.extractUniformsRecursively(r,t[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(t,e,n,r){var i=this;null===e||"number"==typeof e||"boolean"==typeof e||Array.isArray(e)&&"number"==typeof e[0]||(0,J.isTypedArray)(e)||""===e||"resize"in e?n["".concat(r&&r+".").concat(t)]=e:((0,J.isPlainObject)(e)&&Object.keys(e).forEach((function(o){i.extractUniformsRecursively(o,e[o],n,"".concat(r&&r+".").concat(t))})),Array.isArray(e)&&e.forEach((function(e,o){Object.keys(e).forEach((function(a){i.extractUniformsRecursively(a,e[a],n,"".concat(r&&r+".").concat(t,"[").concat(o,"]"))}))})))}}]),t}(),tt=function(){function t(e,n){(0,x.Z)(this,t),(0,M.Z)(this,"isDistroy",!1);var r=n.data,i=n.type,o=void 0===i?S.gl.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,h=void 0===c?S.gl.RGBA:c,p=n.mipmap,f=void 0!==p&&p,d=n.wrapS,m=void 0===d?S.gl.CLAMP_TO_EDGE:d,g=n.wrapT,y=void 0===g?S.gl.CLAMP_TO_EDGE:g,v=n.aniso,_=void 0===v?0:v,b=n.alignment,w=void 0===b?1:b,E=n.premultiplyAlpha,C=void 0!==E&&E,T=n.mag,A=void 0===T?S.gl.NEAREST:T,P=n.min,L=void 0===P?S.gl.NEAREST:P,I=n.colorSpace,k=void 0===I?S.gl.BROWSER_DEFAULT_WEBGL:I,O=n.x,R=void 0===O?0:O,D=n.y,Z=void 0===D?0:D,V=n.copy,G=void 0!==V&&V;this.width=a,this.height=s;var H={width:a,height:s,type:N[o],format:F[h],wrapS:j[m],wrapT:j[y],mag:B[A],min:B[L],alignment:w,flipY:l,colorSpace:U[k],premultiplyAlpha:C,aniso:_,x:R,y:Z,copy:G};r&&(H.data=r),"number"==typeof f?H.mipmap=z[f]:"boolean"==typeof f&&(H.mipmap=f),this.texture=e.texture(H)}return(0,b.Z)(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.texture.resize(e,n),this.width=e,this.height=n}},{key:"destroy",value:function(){var t;this.isDistroy||null===(t=this.texture)||void 0===t||t.destroy(),this.isDistroy=!0}}]),t}(),et=(0,L.b2)()(y=function(){function t(){var e=this;(0,x.Z)(this,t),(0,M.Z)(this,"createModel",(function(t){return new $(e.gl,t)})),(0,M.Z)(this,"createAttribute",(function(t){return new O(e.gl,t)})),(0,M.Z)(this,"createBuffer",(function(t){return new X(e.gl,t)})),(0,M.Z)(this,"createElements",(function(t){return new Y(e.gl,t)})),(0,M.Z)(this,"createTexture2D",(function(t){return new tt(e.gl,t)})),(0,M.Z)(this,"createFramebuffer",(function(t){return new K(e.gl,t)})),(0,M.Z)(this,"useFramebuffer",(function(t,n){e.gl({framebuffer:t?t.get():null})(n)})),(0,M.Z)(this,"clear",(function(t){var n,r=t.color,i=t.depth,o=t.stencil,a=t.framebuffer,s=void 0===a?null:a,u={color:r,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(n=e.gl)||void 0===n||n.clear(u)})),(0,M.Z)(this,"viewport",(function(t){var n=t.x,r=t.y,i=t.width,o=t.height;e.gl._gl.viewport(n,r,i,o),e.width=i,e.height=o,e.gl._refresh()})),(0,M.Z)(this,"readPixels",(function(t){var n=t.framebuffer,r={x:t.x,y:t.y,width:t.width,height:t.height};return n&&(r.framebuffer=n.get()),e.gl.read(r)})),(0,M.Z)(this,"getViewportSize",(function(){return{width:e.gl._gl.drawingBufferWidth,height:e.gl._gl.drawingBufferHeight}})),(0,M.Z)(this,"getContainer",(function(){return P.isMini?e.canvas:null===(t=e.canvas)||void 0===t?void 0:t.parentElement;var t})),(0,M.Z)(this,"getCanvas",(function(){return e.canvas})),(0,M.Z)(this,"getGLContext",(function(){return e.gl._gl})),(0,M.Z)(this,"destroy",(function(){var t,n,r;e.canvas=null,null===(t=e.gl)||void 0===t||null===(n=t._gl)||void 0===n||null===(r=n.getExtension("WEBGL_lose_context"))||void 0===r||r.loseContext(),e.gl.destroy(),e.gl=null}))}var e;return(0,b.Z)(t,[{key:"init",value:(e=(0,C.Z)(A().mark((function t(e,n,r){var i=this;return A().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.canvas=e,!r){t.next=5;break}this.gl=r,t.next=8;break;case 5:return t.next=7,new Promise((function(t,e){k()({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(n,r){!n&&r||e(n),t(r)}})}));case 7:this.gl=t.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return t.stop()}}),t,this)}))),function(t,n,r){return e.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),t}())||y,nt=n(3058),rt=n(3285),it=n(5963),ot=n(78),at=n(1883);var st=["selectstart","selecting","selectend"],ut=function(t){(0,rt.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,ot.Z)(e);if(n){var i=(0,ot.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,it.Z)(this,t)});function i(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,x.Z)(this,i),e=r.call(this),(0,M.Z)((0,nt.Z)(e),"isEnable",!1),(0,M.Z)((0,nt.Z)(e),"onDragStart",(function(t){e.box.style.display="block",e.startEvent=e.endEvent=t,e.syncBoxBound(),e.emit("selectstart",e.getLngLatBox(),e.startEvent,e.endEvent)})),(0,M.Z)((0,nt.Z)(e),"onDragging",(function(t){e.endEvent=t,e.syncBoxBound(),e.emit("selecting",e.getLngLatBox(),e.startEvent,e.endEvent)})),(0,M.Z)((0,nt.Z)(e),"onDragEnd",(function(t){e.endEvent=t,e.box.style.display="none",e.emit("selectend",e.getLngLatBox(),e.startEvent,e.endEvent)})),e.scene=t,e.options=n,e}return(0,b.Z)(i,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var e=P.DOM.create("div",void 0,this.container);e.classList.add("l7-select-box"),t&&e.classList.add(t),e.style.display="none",this.box=e}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,e=t.x,n=t.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(e,i),s=Math.min(n,o),u=Math.abs(e-i),l=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(l,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,e=t.lng,n=t.lat,r=this.endEvent.lngLat,i=r.lng,o=r.lat;return(0,P.getBBoxFromPoints)([[e,n],[i,o]])}}]),i}(at.EventEmitter),lt=function(){function t(e){(0,x.Z)(this,t);var n=e.id,r=e.map,i=e.canvas,o=e.hasBaseMap,a=(0,S.createSceneContainer)();this.container=a,r.setContainer(a,n,i,o),a.bind(S.TYPES.IRendererService).to(et).inSingletonScope(),this.sceneService=a.get(S.TYPES.ISceneService),this.mapService=a.get(S.TYPES.IMapService),this.iconService=a.get(S.TYPES.IIconService),this.fontService=a.get(S.TYPES.IFontService),this.controlService=a.get(S.TYPES.IControlService),this.layerService=a.get(S.TYPES.ILayerService),this.markerService=a.get(S.TYPES.IMarkerService),this.interactionService=a.get(S.TYPES.IInteractionService),this.popupService=a.get(S.TYPES.IPopupService),this.boxSelect=new ut(this,{}),P.isMini?this.sceneService.initMiniScene(e):(this.initComponent(n),this.sceneService.init(e),this.initControl())}return(0,b.Z)(t,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var e=this;this.sceneService.loaded?new t(this).init():this.on("loaded",(function(){new t(e).init()}))}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var e=this,n=(0,S.createLayerContainer)(this.container);if(t.setContainer(n,this.container),this.sceneService.addLayer(t),t.inited){var r=this.initMask(t);this.addMask(r,t.id)}else t.on("inited",(function(){var n=e.initMask(t);e.addMask(n,t.id)}))}},{key:"initMask",value:function(t){var e=t.getLayerConfig(),n=e.mask,r=e.maskfence,i=e.maskColor,o=void 0===i?"#000":i,a=e.maskOpacity,s=void 0===a?0:a;if(n)return(new E.MaskLayer).source(r).shape("fill").style({color:o,opacity:s})}},{key:"addMask",value:function(t,e){if(t){var n=this.getLayer(e);if(n){var r=(0,S.createLayerContainer)(this.container);t.setContainer(r,this.container),n.addMaskLayer(t),this.sceneService.addLayer(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,e){this.layerService.remove(t,e)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,e){this.fontService.addIconFont(t,e)}},{key:"addIconFonts",value:function(t){var e=this;t.forEach((function(t){var n=(0,_.Z)(t,2),r=n[0],i=n[1];e.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(t,e){var n=this;this.fontService.once("fontloaded",(function(t){n.emit("fontloaded",t)})),this.fontService.addFontFace(t,e)}},{key:"addImage",value:function(t,e){P.isMini?this.iconService.addImageMini(t,e,this.sceneService):this.iconService.addImage(t,e)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,e){this.fontService.addIconGlyphs(e)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,e){var n;st.includes(t)?null===(n=this.boxSelect)||void 0===n||n.on(t,e):S.SceneEventList.includes(t)?this.sceneService.on(t,e):this.mapService.on(t,e)}},{key:"once",value:function(t,e){var n;st.includes(t)?null===(n=this.boxSelect)||void 0===n||n.once(t,e):S.SceneEventList.includes(t)?this.sceneService.once(t,e):this.mapService.once(t,e)}},{key:"emit",value:function(t,e){-1===S.SceneEventList.indexOf(t)?this.mapService.on(t,e):this.sceneService.emit(t,e)}},{key:"off",value:function(t,e){var n;st.includes(t)?null===(n=this.boxSelect)||void 0===n||n.off(t,e):S.SceneEventList.includes(t)?this.sceneService.off(t,e):this.mapService.off(t,e)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,e){return this.mapService.setCenter(t,e)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,e){this.mapService.panBy(t,e)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,e){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(t,e||(0,v.Z)((0,v.Z)({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(t,e){this.mapService.setZoomAndCenter(t,e)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,e){this.container.bind(S.TYPES.IPostProcessingPass).to(t).whenTargetNamed(e)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),e&&this.boxSelect.once("selectend",(function(){t.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:P.DOM.getContainer(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),e=t.logoVisible,n=t.logoPosition;e&&this.addControl(new w.Logo({position:n}))}}]),t}()},4793:(t,e,n)=>{"use strict";n.r(e),n.d(e,{RasterTileType:()=>lt,default:()=>oe,getParser:()=>o,getTransform:()=>s,rasterDataTypes:()=>kt,registerParser:()=>a,registerTransform:()=>u});var r={},i={},o=function(t){return i[t]},a=function(t,e){i[t]=e},s=function(t){return r[t]},u=function(t,e){r[t]=e},l={},c={};function h(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function p(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function f(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}var d=function(t){var e=new RegExp('[",\n\r]'),n=t.charCodeAt(0);function r(t,e){var r,i=[],o=t.length,a=0,s=0,u=o<=0,h=!1;function p(){if(u)return c;if(h)return h=!1,l;var e,r,i=a;if(34===t.charCodeAt(i)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?u=!0:10===(r=t.charCodeAt(a++))?h=!0:13===r&&(h=!0,10===t.charCodeAt(a)&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=t.charCodeAt(e=a++)))h=!0;else if(13===r)h=!0,10===t.charCodeAt(a)&&++a;else if(r!==n)continue;return t.slice(i,e)}return u=!0,t.slice(i,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(r=p())!==c;){for(var f=[];r!==l&&r!==c;)f.push(r),r=p();e&&null==(f=e(f,s++))||i.push(f)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?(i=(n=t).getUTCHours(),o=n.getUTCMinutes(),a=n.getUTCSeconds(),s=n.getUTCMilliseconds(),isNaN(n)?"Invalid Date":((r=n.getUTCFullYear())<0?"-"+f(-r,6):r>9999?"+"+f(r,6):f(r,4))+"-"+f(n.getUTCMonth()+1,2)+"-"+f(n.getUTCDate(),2)+(s?"T"+f(i,2)+":"+f(o,2)+":"+f(a,2)+"."+f(s,3)+"Z":a?"T"+f(i,2)+":"+f(o,2)+":"+f(a,2)+"Z":o||i?"T"+f(i,2)+":"+f(o,2)+"Z":"")):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t;var n,r,i,o,a,s}return{parse:function(t,e){var n,i,o=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=h(t);return function(r,i){return e(n(r),i,t)}}(t,e):h(t)}));return o.columns=i||[],o},parseRows:r,format:function(e,n){return null==n&&(n=p(e)),[n.map(a).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=p(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}(","),m=d.parse,g=(d.parseRows,d.format,d.formatBody,d.formatRows,d.formatRow,d.formatValue,n(92)),y=n(1517),v=n(2576),_=n.n(v),x=n(601),b=n(8912);function w(t,e){var n=e.x,r=e.y,i=e.x1,o=e.y1,a=e.coordinates,s=e.geometry,u=[];if(!Array.isArray(t))return{dataArray:[]};if(s)return t.filter((function(t){return t[s]&&t[s].type&&t[s].coordinates&&t[s].coordinates.length>0})).forEach((function(t,e){var n=_()((0,y.Z)({},t[s]),!0);(0,b.nG)(n,(function(n){var r=(0,x.r7)(n),i=(0,y.Z)((0,y.Z)({},t),{},{_id:e,coordinates:r});u.push(i)}))})),{dataArray:u};for(var l=0;l<t.length;l++){var c=t[l],h=[];if(a){var p="Polygon";Array.isArray(a[0])||(p="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(p="LineString"),h=_()({type:p,coordinates:(0,g.Z)(c[a])},!0).coordinates}else n&&r&&i&&o?h=[[parseFloat(c[n]),parseFloat(c[r])],[parseFloat(c[i]),parseFloat(c[o])]]:n&&r&&(h=[parseFloat(c[n]),parseFloat(c[r])]);var f=(0,y.Z)((0,y.Z)({},c),{},{_id:l,coordinates:h});u.push(f)}return{dataArray:u}}var S=n(9470);var E=n(7012),C=n(5814),M=n.n(C),T=n(6672),A=n(997),P=n.n(A),L={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},I=function(){var t=(0,E.Z)(M().mark((function t(e,n,r){var i;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(0,S.getURLFromTemplate)(e,n),t.abrupt("return",new Promise((function(t){var e=(0,S.getArrayBuffer)({url:i},(function(e,r){if(e||!r)t({layers:{}});else{for(var i=new T.VectorTile(new(P())(r)),o=0,a=Object.keys(i.layers);o<a.length;o++){for(var s=a[o],u=[],l=i.layers[s],c=0;c<i.layers[s].length;c++){var h=i.layers[s].feature(c).toGeoJSON(n.x,n.y,n.z);u.push(h)}l.features=u}t(i)}}));r.xhrCancel=function(){return e.abort()}})));case 2:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}();function k(t,e,n,r){for(var i,o=r,a=n-e>>1,s=n-e,u=t[e],l=t[e+1],c=t[n],h=t[n+1],p=e+3;p<n;p+=3){var f=O(t[p],t[p+1],u,l,c,h);if(f>o)i=p,o=f;else if(f===o){var d=Math.abs(p-a);d<s&&(i=p,s=d)}}o>r&&(i-e>3&&k(t,e,i,r),t[i+2]=o,n-i>3&&k(t,i,n,r))}function O(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((t-n)*a+(e-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=t-n)*a+(s=e-r)*s}function R(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)D(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)D(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)D(t,e[r][i])}(i),i}function D(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function N(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)F(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)F(i[l],s);else if("LineString"===o)z(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],z(i[l],s,a,!1),t.push(R(u,"LineString",s,e.properties));return}B(i,s,a,!1)}else if("Polygon"===o)B(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)N(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];B(i[l],c,a,!0),s.push(c)}}t.push(R(u,o,s,e.properties))}}function F(t,e){e.push(j(t[0])),e.push(U(t[1])),e.push(0)}function z(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var u=j(t[s][0]),l=U(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=e.length-3;e[2]=1,k(e,0,c,n),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function B(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];z(t[i],o,n,r),e.push(o)}}function j(t){return t/360+.5}function U(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function Z(t,e,n,r,i,o,a,s){if(r/=e,o>=(n/=e)&&a<r)return t;if(a<n||o>=r)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=n&&d<r)u.push(c);else if(!(d<n||f>=r)){var m=[];if("Point"===p||"MultiPoint"===p)V(h,m,n,r,i);else if("LineString"===p)G(h,m,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===p)W(h,m,n,r,i,!1);else if("Polygon"===p)W(h,m,n,r,i,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var y=[];W(h[g],y,n,r,i,!0),y.length&&m.push(y)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)u.push(R(c.id,p,m[g],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),u.push(R(c.id,p,m,c.tags))}}}return u.length?u:null}function V(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function G(t,e,n,r,i,o,a){for(var s,u,l=H(t),c=0===i?X:Y,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],m=t[p+2],g=t[p+3],y=t[p+4],v=0===i?f:d,_=0===i?g:y,x=!1;a&&(s=Math.sqrt(Math.pow(f-g,2)+Math.pow(d-y,2))),v<n?_>n&&(u=c(l,f,d,g,y,n),a&&(l.start=h+s*u)):v>r?_<r&&(u=c(l,f,d,g,y,r),a&&(l.start=h+s*u)):q(l,f,d,m),_<n&&v>=n&&(u=c(l,f,d,g,y,n),x=!0),_>r&&v<=r&&(u=c(l,f,d,g,y,r),x=!0),!o&&x&&(a&&(l.end=h+s*u),e.push(l),l=H(t)),a&&(h+=s)}var b=t.length-3;f=t[b],d=t[b+1],m=t[b+2],(v=0===i?f:d)>=n&&v<=r&&q(l,f,d,m),b=l.length-3,o&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&q(l,l[0],l[1],l[2]),l.length&&e.push(l)}function H(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function W(t,e,n,r,i,o){for(var a=0;a<t.length;a++)G(t[a],e,n,r,i,o,!1)}function q(t,e,n,r){t.push(e),t.push(n),t.push(r)}function X(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function Y(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function K(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=Q(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(Q(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(Q(o.geometry[s][l],e));i.push(u)}n.push(R(o.id,a,i,o.tags))}return n}function Q(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function J(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push($(l[r],l[r+1],e,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push($(l[r][i],l[r][i+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function $(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function tt(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,et(a,t[s],o,i);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function et(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)nt(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)nt(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)nt(a,l[s],t,n,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function nt(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===r||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}(s,o),t.push(s)}}function rt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)N(n,t.features[r],e,r);else"Feature"===t.type?N(n,t,e):N(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(t,e){var n=e.buffer/e.extent,r=t,i=Z(t,1,-1-n,n,0,-1,2,e),o=Z(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=Z(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=K(i,1).concat(r)),o&&(r=r.concat(K(o,-1)))),r}(r,e),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function it(t,e,n){return 32*((1<<t)*n+e)+t}rt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rt.prototype.splitTile=function(t,e,n,r,i,o,a){for(var s=[t,e,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=it(e,n,r),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=tt(t,e,n,r,u),this.tileCoords.push({z:e,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){l>1&&console.time("clipping");var m,g,y,v,_,x,b=.5*u.buffer/u.extent,w=.5-b,S=.5+b,E=1+b;m=g=y=v=null,_=Z(t,c,n-b,n+S,0,p.minX,p.maxX,u),x=Z(t,c,n+w,n+E,0,p.minX,p.maxX,u),t=null,_&&(m=Z(_,c,r-b,r+S,1,p.minY,p.maxY,u),g=Z(_,c,r+w,r+E,1,p.minY,p.maxY,u),_=null),x&&(y=Z(x,c,r-b,r+S,1,p.minY,p.maxY,u),v=Z(x,c,r+w,r+E,1,p.minY,p.maxY,u),x=null),l>1&&console.timeEnd("clipping"),s.push(m||[],e+1,2*n,2*r),s.push(g||[],e+1,2*n,2*r+1),s.push(y||[],e+1,2*n+1,2*r),s.push(v||[],e+1,2*n+1,2*r+1)}}},rt.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var a=1<<t,s=it(t,e=(e%a+a)%a,n);if(this.tiles[s])return J(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,l=t,c=e,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[it(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?J(this.tiles[s],i):null):null};var ot={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function at(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],r+=((n=t[a]).x-e.x)*(e.y+n.y);return r}var st=["Unknown","Point","LineString","Polygon"];function ut(t,e,n,r,i){var o,a,s=i.geometry,u=i.type,l=i.tags,c=i.id,h=t*Math.pow(2,r),p=t*e,f=t*n,d=st[u];function m(t){for(var e=0;e<t.length;e++){var n=t[e];if(n[3])break;var r=180-360*(n[1]+f)/h,i=360*(n[0]+p)/h-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;t[e]=[i,o,0,1]}}switch(u){case 1:var g=[];for(o=0;o<s.length;o++)g[o]=s[o][0];m(s=g);break;case 2:for(o=0;o<s.length;o++)m(s[o]);break;case 3:for(s=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=at(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(s),o=0;o<s.length;o++)for(a=0;a<s[o].length;a++)m(s[o][a])}return 1===s.length?s=s[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:s},properties:l,id:c,tileOrigin:[0,0],coord:""}}var lt,ct=function(){var t=(0,E.Z)(M().mark((function t(e,n,r,i){return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var o=n.getTile(e.z,e.x,e.y),a=[];o.features.map((function(t){var e=ut(i,r.x,r.y,r.z,t);a.push(e)})),t({layers:{geojsonvt:{features:a}}})})));case 1:case"end":return t.stop()}}),t)})));return function(e,n,r,i){return t.apply(this,arguments)}}(),ht=n(5063),pt=n(596);function ft(t,e){for(var n=e[0],r=n.width,i=n.height,o=e.map((function(t){return t.rasterData})),a=r*i,s=[],u=JSON.stringify(t),l=0;l<a;l++){var c=JSON.parse(u),h=dt(c,o,l);if("number"==typeof h)s.push(h);else{var p=mt(c);s.push(p)}}return s}function dt(t,e,n){if(2===t.length&&"band"===t[0]&&"number"==typeof t[1])try{return e[t[1]][n]}catch(t){return console.warn("Raster Data err!"),0}t.map((function(r,i){if(Array.isArray(r)&&r.length>0)if("band"===r[0])try{t[i]=e[r[1]][n]}catch(e){console.warn("Raster Data err!"),t[i]=0}else dt(r,e,n)}))}function mt(t){var e=function(t){var e=(0,pt.Z)(t,3),n=e[0],r=e[1],i=void 0===r?-1:r,o=e[2],a=void 0===o?-1:o;return void 0===n?(console.warn("Express err!"),["+",0,0]):[n.replace(/\s+/g,""),i,a]}(t),n=e[0],r=e[1],i=e[2];return Array.isArray(r)&&(r=mt(t[1])),Array.isArray(i)&&(i=mt(t[2])),function(t,e,n){switch(t){case"+":return e+n;case"-":return e-n;case"*":return e*n;case"/":return e/n;case"%":return e%n;case"^":return Math.pow(e,n);case"abs":return Math.abs(e);case"floor":return Math.floor(e);case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"sin":return Math.sin(e);case"cos":return Math.cos(e);case"atan":return-1===n?Math.atan(e):Math.atan2(e,n);default:return console.warn("Calculate symbol err! Return default 0"),0}}(n,r,i)}function gt(t,e,n){return yt.apply(this,arguments)}function yt(){return(yt=(0,E.Z)(M().mark((function t(e,n,r){var i,o,a,s,u,l,c,h,p,f,d,m,g,y;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.length){t.next=2;break}return t.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return t.next=4,Promise.all(e.map((function(t){var e=t.data,r=t.bands;return n(e,void 0===r?[0]:r)})));case 4:i=(i=t.sent).flat(),o=i[0],a=o.width,s=o.height,l=void 0,c=void 0,h=void 0,t.t0=(0,ht.Z)(r),t.next="function"===t.t0?13:"object"===t.t0?15:17;break;case 13:return u=r(i),t.abrupt("break",18);case 15:return Array.isArray(r)?u=ft(r,i):(p=vt(r,i),f=_t(p),d=f.data,m=f.channelRMax,g=f.channelGMax,y=f.channelBMax,u=d,l=m,c=g,h=y),t.abrupt("break",18);case 17:u=i[0].rasterData;case 18:return t.abrupt("return",{rasterData:u,width:a,height:s,channelR:l,channelG:c,channelB:h});case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function vt(t,e){return void 0===t.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),void 0===t.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),void 0===t.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!"),[ft(t.r||["band",0],e),ft(t.g||["band",0],e),ft(t.b||["band",0],e)]}function _t(t){for(var e=t[0],n=t[1],r=t[2],i=[],o=-1/0,a=-1/0,s=-1/0,u=0;u<e.length;u++)i.push(e[u]),o=Math.max(o,e[u]),i.push(n[u]),a=Math.max(a,e[u]),i.push(r[u]),s=Math.max(s,e[u]);return{data:i,channelRMax:o,channelGMax:a,channelBMax:s}}function xt(t,e,n,r){return bt.apply(this,arguments)}function bt(){return(bt=(0,E.Z)(M().mark((function t(e,n,r,i){var o,a,s,u;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,gt(e,n,r);case 2:o=t.sent,a=o.rasterData,s=o.width,u=o.height,i(null,{data:a,width:s,height:u,min:0,max:8e3});case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function wt(t){return!!Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function St(t,e){return Array.isArray(t)?"string"==typeof t[0]?t.map((function(t){return(0,S.getURLFromTemplate)(t,e)})):t.map((function(t){return{url:(0,S.getURLFromTemplate)(t.url,e),bands:t.bands||[0]}})):(0,S.getURLFromTemplate)(t,e)}function Et(t,e){t.xhrCancel=function(){e.map((function(t){t.abort()}))}}!function(t){t.IMAGE="image",t.ARRAYBUFFER="arraybuffer",t.RGB="rgb"}(lt||(lt={}));var Ct=function(){var t=(0,E.Z)(M().mark((function t(e,n,r,i,o){var a,s,u,l,c,h;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(p=n.url,!((a="string"==typeof p?[{url:p,bands:[0]}]:"string"==typeof p[0]?p.map((function(t){return{url:t,bands:[0]}})):p).length>1)){t.next=15;break}return t.next=4,Mt(a,n);case 4:if(s=t.sent,u=s.rasterFiles,l=s.xhrList,c=s.errList,Et(e,l),!(c.length>0)){t.next=12;break}return r(c,null),t.abrupt("return");case 12:xt(u,i,o,r),t.next=17;break;case 15:h=(0,S.getArrayBuffer)(n,(function(t,e){t?r(t):e&&xt([{data:e,bands:a[0].bands}],i,o,r)})),Et(e,[h]);case 17:case"end":return t.stop()}var p}),t)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}();function Mt(t,e){return Tt.apply(this,arguments)}function Tt(){return(Tt=(0,E.Z)(M().mark((function t(e,n){var r,i,o,a,s,u,l,c,h,p,f;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<e.length)){t.next=20;break}return s=e[a],u=(0,y.Z)((0,y.Z)({},n),{},{url:s.url}),l=s.bands,t.next=10,(0,S.makeXMLHttpRequestPromise)((0,y.Z)((0,y.Z)({},u),{},{type:"arrayBuffer"}));case 10:c=t.sent,h=c.err,p=c.data,f=c.xhr,h&&o.push(h),i.push(f),r.push({data:p,bands:l});case 17:a++,t.next=4;break;case 20:return t.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var At=function(){var t=(0,E.Z)(M().mark((function t(e,n,r,i,o){var a;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={url:St(e,n)},t.abrupt("return",new Promise((function(t,e){Ct(r,a,(function(n,r){n?e(n):r&&t(r)}),i,o)})));case 2:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}(),Pt=function(){var t=(0,E.Z)(M().mark((function t(e,n,r){var i;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(0,S.getURLFromTemplate)(Array.isArray(e)?e[0]:e,n),t.abrupt("return",new Promise((function(t,e){var n=(0,S.getImage)({url:i},(function(n,r){n?e(n):r&&t(r)}));r.xhrCancel=function(){return n.abort()}})));case 2:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),Lt=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},It={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},kt=[lt.ARRAYBUFFER,lt.RGB],Ot={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},Rt=function(){var t=(0,E.Z)(M().mark((function t(e){return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=(0,pt.Z)(e.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3];t({layers:{testTile:{features:[{type:"Feature",properties:{key:e.x+"/"+e.y+"/"+e.z,textLng:(r+o)/2,textLat:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}})})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Dt=n(5683),Nt=n(89),Ft=n(3058),zt=n(3285),Bt=n(5963),jt=n(78),Ut=n(537),Zt=n(5048),Vt=n(1883),Gt=n(9479),Ht=n(1469),Wt=n.n(Ht);function qt(t,e){var n=e.radius,r=void 0===n?40:n,i=e.maxZoom,o=void 0===i?18:i,a=e.minZoom,s=void 0===a?0:a,u=e.zoom,l=void 0===u?2:u;if(t.pointIndex){var c=t.pointIndex.getClusters(t.extent,Math.floor(l));return t.dataArray=c.map((function(t,e){return(0,y.Z)({coordinates:t.geometry.coordinates,_id:e+1},t.properties)})),t}var h=new(Wt())({radius:r,minZoom:s,maxZoom:o}),p={type:"FeatureCollection",features:[]};return p.features=t.dataArray.map((function(t){return{type:"Feature",geometry:{type:"Point",coordinates:t.coordinates},properties:(0,y.Z)({},t)}})),h.load(p.features),h}function Xt(t){if(0===t.length)return 0;for(var e,n=t[0],r=0,i=1;i<t.length;i++)e=n+1*t[i],Math.abs(n)>=Math.abs(t[i])?r+=n-e+t[i]:r+=t[i]-e+n,n=e;return n+1*r}var Yt={min:function(t){if(0===t.length)throw new Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return e},max:function(t){if(0===t.length)throw new Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return e},mean:function(t){if(0===t.length)throw new Error("mean requires at least one data point");return Xt(t)/t.length},sum:Xt};function Kt(t,e){if(Array.isArray(e))return e}var Qt=function(t){(0,zt.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,jt.Z)(e);if(n){var i=(0,jt.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,Bt.Z)(this,t)});function i(t,e){var n;return(0,Dt.Z)(this,i),n=r.call(this),(0,Ut.Z)((0,Ft.Z)(n),"type","source"),(0,Ut.Z)((0,Ft.Z)(n),"inited",!1),(0,Ut.Z)((0,Ft.Z)(n),"hooks",{init:new Zt.ni}),(0,Ut.Z)((0,Ft.Z)(n),"parser",{type:"geojson"}),(0,Ut.Z)((0,Ft.Z)(n),"transforms",[]),(0,Ut.Z)((0,Ft.Z)(n),"cluster",!1),(0,Ut.Z)((0,Ft.Z)(n),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,Ut.Z)((0,Ft.Z)(n),"invalidExtent",!1),(0,Ut.Z)((0,Ft.Z)(n),"dataArrayChanged",!1),(0,Ut.Z)((0,Ft.Z)(n),"cfg",{}),n.originData=t,n.initCfg(e),n.init(),n}return(0,Nt.Z)(i,[{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var e=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,a=n.field,s=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,s.forEach((function(t){t.id||(t.properties.point_count=1)})),(a||(0,Gt.isFunction)(i))&&(s=s.map((function(t){var n=t.id;if(n){var r,o=e.clusterIndex.getLeaves(n,1/0).map((function(t){return t.properties}));if((0,Gt.isString)(i)&&a){var s=function(t,e){return t.map((function(t){return 1*t[e]}))}(o,a);r=Yt[i](s)}(0,Gt.isFunction)(i)&&(r=i(o)),t.properties.stat=r}else t.properties.point_count=1;return t}))),this.data=o("geojson")({type:"FeatureCollection",features:s}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var e=this.parser,n=e.type,r=void 0===n?"geojson":n,i=e.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(e){return e._id===t})):t<this.data.dataArray.length?this.data.dataArray[t]:"null";var o=t<this.originData.features.length?this.originData.features[t]:"null",a=(0,Gt.cloneDeep)(o);if(null!=a&&a.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(e){return e._id===t}));a.properties=s}return a}},{key:"updateFeaturePropertiesById",value:function(t,e){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===t?(0,y.Z)((0,y.Z)({},n),e):n})),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(t,e){var n=this.data.dataArray.find((function(n){return n[t]===e}));return null==n?void 0:n._id}},{key:"setData",value:function(t,e){this.originData=t,this.dataArrayChanged=!1,this.initCfg(e),this.init()}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(t=this.tileset)||void 0===t||t.destroy()}},{key:"handleData",value:function(){var t=this;return new Promise((function(e,n){try{t.excuteParser(),t.initCluster(),t.executeTrans(),e({})}catch(t){n(t)}}))}},{key:"initCfg",value:function(t){this.cfg=(0,Gt.mergeWith)(this.cfg,t,Kt);var e=this.cfg;e&&(e.parser&&(this.parser=e.parser),e.transforms&&(this.transforms=e.transforms),this.cluster=e.cluster||!1,e.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,y.Z)((0,y.Z)({},this.clusterOptions),e.clusterOptions)))}},{key:"init",value:function(){var t=this;this.inited=!1,this.handleData().then((function(){t.inited=!0,t.emit("update")}))}},{key:"excuteParser",value:function(){var t=this.parser,e=t.type||"geojson",n=o(e);this.data=n(this.originData,t),this.tileset=this.initTileset(),t.cancelExtent||(this.extent=(0,S.extent)(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(t)return this.tileset?(this.tileset.updateOptions(t),this.tileset):new S.TilesetManager((0,y.Z)({},t))}},{key:"executeTrans",value:function(){var t=this;this.transforms.forEach((function(e){var n=e.type,r=s(n)(t.data,e);Object.assign(t.data,r)}))}},{key:"initCluster",value:function(){if(this.cluster){var t=this.clusterOptions||{};this.clusterIndex=qt(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var e=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(e=(0,S.padBounds)((0,S.bBoxToBounds)(this.extent),t)),e[0].concat(e[1])}}]),i}(Vt.EventEmitter);function Jt(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return $t(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$t(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function $t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var te=6378e3,ee=Math.PI/3,ne=[0,ee,2*ee,3*ee,4*ee,5*ee];function re(t){return t[0]}function ie(t){return t[1]}a("rasterTile",(function(t,e){if(n=t,Array.isArray(n)&&0===n.length||!Array.isArray(n)&&"string"!=typeof n)throw new Error("tile server url is error");var n,r=(null==e?void 0:e.dataType)||lt.IMAGE;r===lt.RGB&&(r=lt.ARRAYBUFFER);var i=(0,y.Z)((0,y.Z)((0,y.Z)({},It),e),{},{getTileData:function(n,i){switch(r){case lt.IMAGE:return Pt(t,n,i);case lt.ARRAYBUFFER:return At(t,n,i,(null==e?void 0:e.format)||Lt,null==e?void 0:e.operation);default:return Pt(t,n,i)}}});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}})),a("mvt",(function(t,e){var n=Array.isArray(t)?t[0]:t,r=(0,y.Z)((0,y.Z)((0,y.Z)({},L),e),{},{getTileData:function(t,e){return I(n,t,e)}});return{data:n,dataArray:[],tilesetOptions:r,isTile:!0}})),a("geojsonvt",(function(t,e){var n=function(t){var e={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===t||void 0===t.geojsonvtOptions?e:(0,y.Z)((0,y.Z)({},e),t.geojsonvtOptions)}(e),r=n.extent||4096,i=function(t,e){return new rt(t,e)}(t,n);return{data:t,dataArray:[],tilesetOptions:(0,y.Z)((0,y.Z)((0,y.Z)({},ot),e),{},{getTileData:function(t,e){return ct(e,i,t,r)}}),isTile:!0}})),a("testTile",(function(t,e){return{data:t,dataArray:[],tilesetOptions:(0,y.Z)((0,y.Z)((0,y.Z)({},Ot),e),{},{getTileData:function(t){return Rt(t)}}),isTile:!0}})),a("geojson",(function(t,e){var n=[],r={};return t.features?(t.features=t.features.filter((function(t){var e=t.geometry;return null!=t&&e&&e.type&&e.coordinates&&e.coordinates.length>0})),_()(t,!0),0===t.features.length?{dataArray:[],featureKeys:r}:((0,b.nG)(t,(function(t,r){var i,o,a=(i=t,void 0===(o=null==e?void 0:e.featureId)?null:"id"===o&&i.id?i.id:i[o]?i[o]:i.properties&&i.properties[o]?function(t){for(var e=t.toString(),n=5381,r=e.length;r;)n=33*n^e.charCodeAt(--r);return n>>>0}(i.properties[o]+"")%1000019:null);null===a&&(a=r);var s=a,u=(0,x.r7)(t),l=(0,y.Z)((0,y.Z)({},t.properties),{},{coordinates:u,_id:s});n.push(l)})),{dataArray:n,featureKeys:r})):(t.features=[],{dataArray:[]})})),a("image",(function(t,e){var n=e.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(e){t instanceof HTMLImageElement||(0,S.isImageBitmap)(t)?e([t]):function(t,e){var n=t,r=[];if("string"==typeof n)(0,S.getImage)({url:n},(function(t,n){n&&(r.push(n),e(r))}));else{var i=n.length,o=0;n.forEach((function(t){(0,S.getImage)({url:t},(function(t,n){o++,n&&r.push(n),o===i&&e(r)}))}))}}(t,(function(t){e(t)}))}));return{originData:t,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]}})),a("csv",(function(t,e){return w(m(t),e)})),a("json",w),a("raster",(function(t,e){var n,r,i,o=e.extent,a=e.width,s=e.height,u=e.min,l=e.max,c=e.format,h=e.operation;return void 0===c||wt(t)?(n=Array.from(t),r=a,i=s):n=gt(Array.isArray(t)?t:[t],c,h),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:l,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]}})),a("rasterRgb",(function(t,e){var n,r,i,o=e.extent,a=e.width,s=e.height,u=e.min,l=e.max,c=e.format,h=e.operation;return void 0===c||wt(t)?(n=Array.from(t),r=a,i=s):n=gt(Array.isArray(t)?t:[t],c,h),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:l,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]}})),u("cluster",qt),u("filter",(function(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.filter(n)),t})),u("join",(function(t,e){var n=e.sourceField,r=e.targetField,i=e.data,o={};return i.forEach((function(t){o[t[n]]=t})),t.dataArray=t.dataArray.map((function(t){var e=t[r];return(0,y.Z)((0,y.Z)({},t),o[e])})),t})),u("map",(function(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.map(n)),t})),u("grid",(function(t,e){var n=t.dataArray,r=e.size,i=void 0===r?10:r,o=i/(2*Math.PI*te)*(256<<20)/2,a=function(t,e){var n,r,i=1/0,o=-1/0,a=Jt(t);try{for(a.s();!(r=a.n()).done;)n=r.value.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}catch(t){a.e(t)}finally{a.f()}var s,u,l,c,h=(u=(i+o)/2,l=(s=e)/te*(180/Math.PI),c=function(t,e){return e/te*(180/Math.PI)/Math.cos(t*Math.PI/180)}(u,s),{yOffset:l,xOffset:c});if(h.xOffset<=0||h.yOffset<=0)return{gridHash:{},gridOffset:h};var p,f={},d=Jt(t);try{for(d.s();!(p=d.n()).done;){var m=p.value,g=m.coordinates[1],y=m.coordinates[0];if(Number.isFinite(g)&&Number.isFinite(y)){var v=Math.floor((g+90)/h.yOffset),_=Math.floor((y+180)/h.xOffset),x="".concat(v,"-").concat(_);f[x]=f[x]||{count:0,points:[]},f[x].count+=1,f[x].points.push(m)}}}catch(t){d.e(t)}finally{d.f()}return{gridHash:f,gridOffset:h}}(n,i),s=function(t,e,n){return Object.keys(t).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),l={};if(n.field&&n.method){var c=S.Satistics.getColumn(t[i].points,n.field);l[n.method]=S.Satistics.statMap[n.method](c)}return Object.assign(l,{_id:o,coordinates:(0,S.aProjectFlat)([e.xOffset*(u+.5)-180,e.yOffset*(s+.5)-90]),rawData:t[i].points,count:t[i].count}),r.push(l),r}),[])}(a.gridHash,a.gridOffset,e);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:s}})),u("hexagon",(function(t,e){var n=t.dataArray,r=e.size,i=void 0===r?10:r,o=e.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(t){var e=(0,S.aProjectFlat)(t.coordinates),n=(0,pt.Z)(e,2),r=n[0],i=n[1];return(0,y.Z)((0,y.Z)({},t),{},{coordinates:[r,i]})})),l=function(){var t,e,n,r=0,i=0,o=1,a=1,s=re,u=ie;function l(t){var r,i={},o=[],a=t.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=t[r],r,t))&&!isNaN(h=+u.call(null,l,r,t))){var l,c,h,p=Math.round(h/=n),f=Math.round(c=c/e-(1&p)/2),d=h-p;if(3*Math.abs(d)>1){var m=c-f,g=f+(c<f?-1:1)/2,y=p+(h<p?-1:1),v=c-g,_=h-y;m*m+d*d>v*v+_*_&&(f=g+(1&p?1:-1)/2,p=y)}var x=f+"-"+p,b=i[x];b?b.push(l):(o.push(b=i[x]=[l]),b.x=(f+(1&p)/2)*e,b.y=p*n)}return o}function c(t){var e=0,n=0;return ne.map((function(r){var i=Math.sin(r)*t,o=-Math.cos(r)*t,a=i-e,s=o-n;return e=i,n=o,[a,s]}))}return l.hexagon=function(e){return"m"+c(null==e?t:+e).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/e),c=u*n;c<a+t;c+=n,++u)for(var h=l*e+(1&u)*e/2;h<o+e/2;h+=e)s.push([h,c]);return s},l.mesh=function(){var e=c(t).slice(0,4).join("l");return l.centers().map((function(t){return"M"+t+"m"+e})).join("")},l.x=function(t){return arguments.length?(s=t,l):s},l.y=function(t){return arguments.length?(u=t,l):u},l.radius=function(r){return arguments.length?(e=2*(t=+r)*Math.sin(ee),n=1.5*t,l):t},l.size=function(t){return arguments.length?(r=i=0,o=+t[0],a=+t[1],l):[o-r,a-i]},l.extent=function(t){return arguments.length?(r=+t[0][0],i=+t[0][1],o=+t[1][0],a=+t[1][1],l):[[r,i],[o,a]]},l.radius(1)}().radius(s).x((function(t){return t.coordinates[0]})).y((function(t){return t.coordinates[1]}));return{dataArray:l(u).map((function(t,n){var r;if(e.field&&a){var i=S.Satistics.getColumn(t,e.field);t[a]=S.Satistics.statMap[a](i)}return r={},(0,Ut.Z)(r,e.method,t[a]),(0,Ut.Z)(r,"count",t.length),(0,Ut.Z)(r,"rawData",t),(0,Ut.Z)(r,"coordinates",[t.x,t.y]),(0,Ut.Z)(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"}}));const oe=Qt},9470:(t,e,n)=>{"use strict";n.r(e),n.d(e,{$XMLHttpRequest:()=>Kt,$location:()=>Qt,$window:()=>Yt,AJAXError:()=>Ne,BKDRHash:()=>o,DOM:()=>r,FrequencyController:()=>An,LRUCache:()=>En,LineTriangulation:()=>Pr,LoadTileDataStatus:()=>Vr,PointFillTriangulation:()=>Lr,Satistics:()=>i,Tile:()=>ui,TilesetManager:()=>pi,UpdateTileStrategy:()=>Zr,WorkerSourceMap:()=>Or,aProjectFlat:()=>an,amap2Project:()=>un,amap2UnProject:()=>ln,anchorTranslate:()=>Dn,anchorType:()=>Tn,applyAnchorClass:()=>Nn,bBoxToBounds:()=>dn,bindAll:()=>Mn,boundsContains:()=>fn,calAngle:()=>vn,calDistance:()=>gn,calculateCentroid:()=>bn,calculatePointsCenterAndRadius:()=>wn,decodePickingColor:()=>kn,dispatchMapCameraParams:()=>Pt,dispatchMouseDown:()=>Zt,dispatchMouseMove:()=>Vt,dispatchMouseUp:()=>Gt,dispatchPointerDown:()=>zt,dispatchPointerMove:()=>Bt,dispatchPointerUp:()=>jt,dispatchTouchEnd:()=>At,dispatchTouchMove:()=>Tt,dispatchTouchStart:()=>Mt,djb2hash:()=>a,encodePickingColor:()=>On,executeWorkerTask:()=>jr,expandUrl:()=>Wr,extent:()=>Ke,flow:()=>xn,generateColorRamp:()=>Rn,getAngle:()=>_n,getArrayBuffer:()=>Ue,getBBoxFromPoints:()=>Sn,getCullFace:()=>Gr,getImage:()=>He,getJSON:()=>je,getMask:()=>Fn,getReferrer:()=>De,getTileIndices:()=>ai,getTileWarpXY:()=>si,getURLFromTemplate:()=>qr,isColor:()=>Ln,isImageBitmap:()=>Oe,isMini:()=>qt,isMiniAli:()=>Ht,isURLTemplate:()=>Hr,isWeChatMiniProgram:()=>Wt,isWorker:()=>Re,latitude:()=>rn,lineAtOffset:()=>wi,lineAtOffsetAsyc:()=>Si,lngLatToMeters:()=>tn,lnglatDistance:()=>cn,longitude:()=>nn,makeXMLHttpRequestPromise:()=>ze,metersToLngLat:()=>en,miniWindow:()=>Xt,normalize:()=>mn,osmLonLat2TileXY:()=>ri,osmTileXY2LonLat:()=>ii,padBounds:()=>pn,polygonFillTriangulation:()=>Ir,postData:()=>Ze,project:()=>hn,rgb2arr:()=>In,sameOrigin:()=>Ve,setL7WorkerSource:()=>zr,tileToBounds:()=>oi,tranfrormCoord:()=>Je,unProjectFlat:()=>sn,validateLngLat:()=>on});var r={};n.r(r),n.d(r,{DPR:()=>de,addClass:()=>re,addStyle:()=>me,clearChildren:()=>be,create:()=>ee,css2Style:()=>ve,empty:()=>ue,getClass:()=>se,getContainer:()=>Jt,getDiffRect:()=>_e,getStyleList:()=>ge,getViewPortScale:()=>fe,hasClass:()=>oe,printCanvas:()=>pe,remove:()=>ne,removeClass:()=>ie,removeStyle:()=>ye,setChecked:()=>xe,setClass:()=>ae,setTransform:()=>ce,setUnDraggable:()=>we,splitWords:()=>te,triggerResize:()=>he,trim:()=>$t});var i={};function o(t){var e=0;t+="x";for(var n=Math.floor(65745979961613.07),r=0;r<t.length;r++)e>n&&(e=Math.floor(e/137)),e=131*e+t.charCodeAt(r);return e}function a(t){for(var e=5381,n=(t=t.toString()).length;n;)e=33*e^t.charCodeAt(--n);return e>>>0}n.r(i),n.d(i,{getColumn:()=>Pe,getSatByColumn:()=>Le,max:()=>Se,mean:()=>Me,min:()=>Ee,mode:()=>Te,statMap:()=>Ae,sum:()=>Ce});var s=n(92),u=n(596),l=n(9479),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function h(t){this.message=t}function p(t){for(var e,n,r,i,o="",a=0,s=(t=String(t)).length%3;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(i=t.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");o+=c.charAt((e=n<<16|r<<8|i)>>18&63)+c.charAt(e>>12&63)+c.charAt(e>>6&63)+c.charAt(63&e)}return s?o.slice(0,s-3)+"===".substring(s):o}h.prototype=new Error,h.prototype.name="InvalidCharacterError";var f,d,m=n(5683),g=n(89),y=function(){function t(e,n){(0,m.Z)(this,t),this.buffers=e,this.type=n}return(0,g.Z)(t,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,e,n){throw new Error("not implemented")}}]),t}();f=f||(f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{}),d="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,n){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window;const v="undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:d.devicePixelRatio;var _=n(3285),x=n(5963),b=n(78),w=(0,g.Z)((function t(e,n){(0,m.Z)(this,t),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),S=n(3058);function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var C=new WeakMap,M=function(){function t(){(0,m.Z)(this,t),C.set(this,{})}return(0,g.Z)(t,[{key:"addEventListener",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=C.get(this);r||(r={}),r[t]||(r[t]=[]),r[t].push(e),C.set(this,r),n.capture,n.once,n.passive}},{key:"removeEventListener",value:function(t,e){var n=C.get(this);if(n){var r=n[t];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===e){r.splice(i,1);break}}}},{key:"dispatchEvent",value:function(t){var e=C.get(this)[t.type];if(e){var n,r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(e);try{for(r.s();!(n=r.n()).done;)(0,n.value)(t)}catch(t){r.e(t)}finally{r.f()}}}}]),t}();var T=function(t){(0,_.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,b.Z)(e);if(n){var i=(0,b.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,x.Z)(this,t)});function i(){var t;return(0,m.Z)(this,i),(t=r.call(this)).childNodes=[],t}return(0,g.Z)(i,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),i}(M);var A,P,L,I,k=function(t){(0,_.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,b.Z)(e);if(n){var i=(0,b.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,x.Z)(this,t)});function i(){var t;return(0,m.Z)(this,i),(t=r.call(this)).className="",t.children=[],t}return(0,g.Z)(i,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),i}(T);if("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM){var O=my.getSystemInfoSync();A=O.screenWidth,P=O.screenHeight,L=O.windowWidth,I=O.windowHeight}else{var R=d.innerWidth,D=d.innerHeight;A=R,P=D,L=R,I=D}var N={width:A,height:P,availWidth:L,availHeight:I,availLeft:0,availTop:0},F=N.availWidth,z=N.availHeight,B={style:[]};function j(t,e){var n,r;"parentNode"in t||(n=0===e?function(){return null}:1===e?function(){return B}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:n})),"parentElement"in t||(r=0===e?function(){return null}:1===e?function(){return B}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:r}))}function U(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:F+"px",height:z+"px",margin:"0px",padding:"0px"})}function Z(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=F,t.clientHeight=z),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function V(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=F,t.offsetHeight=z)}function G(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=F,t.scrollHeight=z)}function H(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function W(){}var q=function(t){(0,_.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,b.Z)(e);if(n){var i=(0,b.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,x.Z)(this,t)});function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return(0,m.Z)(this,i),(t=r.call(this)).className="",t.children=[],t.focus=W,t.blur=W,t.insertBefore=W,t.appendChild=W,t.removeChild=W,t.remove=W,t.innerHTML="",t.tagName=e.toUpperCase(),j((0,S.Z)(t),n),U((0,S.Z)(t)),H((0,S.Z)(t)),Z((0,S.Z)(t)),V((0,S.Z)(t)),G((0,S.Z)(t)),t}return(0,g.Z)(i)}(k);var X=function(t){(0,_.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,b.Z)(e);if(n){var i=(0,b.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,x.Z)(this,t)});function i(t){return(0,m.Z)(this,i),r.call(this,t)}return(0,g.Z)(i,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),i}(q);var Y=function(t){(0,_.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,b.Z)(e);if(n){var i=(0,b.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,x.Z)(this,t)});function i(){return(0,m.Z)(this,i),r.call(this,"video")}return(0,g.Z)(i)}(X),K={};function Q(){return K}var J=(0,g.Z)((function t(){(0,m.Z)(this,t);var e=Q(),n=e.createImage&&e.createImage()||{};return"tagName"in n||(n.tagName="IMG",n.__proto__=t.prototype),j(n),H(n),Object.assign(n,{addEventListener:function(t,e){n["on".concat(t)]=e.bind(n)},removeEventListener:function(t){n["on".concat(t)]=null}}),n})),$={href:"",protocol:"",host:""};function tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,b.Z)(t);if(e){var i=(0,b.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,x.Z)(this,n)}}var et=function(t){(0,_.Z)(n,t);var e=tt(n);function n(){return(0,m.Z)(this,n),e.call(this,"body",0)}return(0,g.Z)(n,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,n){}},{key:"dispatchEvent",value:function(t){}}]),n}(q),nt=function(t){(0,_.Z)(n,t);var e=tt(n);function n(){return(0,m.Z)(this,n),e.call(this,"html",0)}return(0,g.Z)(n,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),n}(q),rt={},it={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:$,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new J:"video"===t?new Y:new q(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,n){rt[t]||(rt[t]=[]),rt[t].push(e)},removeEventListener:function(t,e){var n=rt[t];if(n&&n.length>0)for(var r=n.length;r--;r>0)if(n[r]===e){n.splice(r,1);break}},dispatchEvent:function(t){var e=t.type,n=rt[e];if(n)for(var r=0;r<n.length;r++)n[r](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new w(t)}};it.documentElement=new nt,it.head=new q("head"),it.body=new et;var ot,at,st,ut,lt=Object,ct=n(5063),ht=function(){function t(){(0,m.Z)(this,t);var e=arguments.length;if(2===e){if("number"==typeof arguments[0]&&"number"==typeof arguments[1])return this._w=arguments[0],this._h=arguments[1],void(this._data=new Uint8ClampedArray(this._w*this._h*4))}else 3===e&&"object"===(0,ct.Z)(arguments[0])&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,g.Z)(t,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),t}();if("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM){var pt=my.getSystemInfoSync();ot=pt.system,at=pt.platform,st=pt.language}else{var ft={versions:(ut=d.navigator.userAgent,{trident:ut.indexOf("Trident")>-1,presto:ut.indexOf("Presto")>-1,webKit:ut.indexOf("AppleWebKit")>-1,gecko:ut.indexOf("Gecko")>-1&&-1===ut.indexOf("KHTML"),mobile:!!ut.match(/AppleWebKit.*Mobile.*/),ios:!!ut.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:ut.indexOf("Android")>-1||ut.indexOf("Linux")>-1,iPhone:ut.indexOf("iPhone")>-1,iPad:ut.indexOf("iPad")>-1,webApp:-1===ut.indexOf("Safari"),weixin:ut.indexOf("MicroMessenger")>-1,qq:" qq"===ut.match(/\sQQ/i)}),language:(d.navigator.browserLanguage||d.navigator.language).toLowerCase()};ft.versions.android?at="android":ft.versions.trident?at="IE":ft.versions.presto?at="Opera":ft.versions.webKit?at="webKit":ft.versions.gecko?at="Firefox":ft.versions.mobile?at="mobile":ft.versions.ios?at="ios":ft.versions.iPhone?at="iPhone":ft.versions.iPad?at="ipad":ft.versions.webApp?at="webApp":ft.versions.weixin?at="weixin":ft.versions.qq&&(at="qq"),ot=d.navigator.userAgent,st=ft.language}var dt=-1!==ot.toLowerCase().indexOf("android")?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",mt="Mozilla/5.0 (".concat(dt,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(st),gt={platform:at,language:st,appVersion:"5.0 (".concat(dt,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:mt},yt=0,vt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";(0,m.Z)(this,t),0!=e.indexOf("http://")&&0!=e.indexOf("https://")?this.href=n+e:this.href=e}return(0,g.Z)(t,null,[{key:"createObjectURL",value:function(t){var e=t.buffers[0],n=t.type,r=function(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return p(e)}(e);return"data:".concat(n,";base64, ")+r}}]),t}();var _t=new Map,xt=new Map,bt=new Map,wt=function(t){(0,_.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,b.Z)(e);if(n){var i=(0,b.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,x.Z)(this,t)});function i(){var t;return(0,m.Z)(this,i),(t=r.call(this)).onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,_t.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return(0,g.Z)(i,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=bt.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=xt.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\n")}},{key:"getResponseHeader",value:function(t){return xt.get("responseHeader")[t]}},{key:"open",value:function(t,e,n){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var n=_t.get("requestHeader");n[t]=e,_t.set("requestHeader",n)}},{key:"addEventListener",value:function(t,e){var n=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||n,e.call(n,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),i}(M);wt.UNSEND=0,wt.OPENED=1,wt.HEADERS_RECEIVED=2,wt.LOADING=3,wt.DONE=4;var St=function(t){(0,_.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,b.Z)(e);if(n){var i=(0,b.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,x.Z)(this,t)});function i(t){var e;return(0,m.Z)(this,i),(e=r.call(this,t)).touches=[],e.targetTouches=[],e.changedTouches=[],e.target=Q(),e.currentTarget=Q(),e}return(0,g.Z)(i)}(w);function Et(t){var e=t||{},n=e.x,r=void 0===n?0:n,i=e.y,o=void 0===i?0:i,a=e.clientX,s=void 0===a?0:a,u=e.clientY,l=void 0===u?0:u;-1!==Object.keys(t).indexOf("x")?(t.pageX=t.clientX=r,t.pageY=t.clientY=o):(t.x=s,t.y=l)}function Ct(t){return function(e){var n=new St(t);n.changedTouches=e.changedTouches,n.touches=e.touches,n.targetTouches=Array.prototype.slice.call(e.touches),n.timeStamp=e.timeStamp,n.changedTouches.forEach((function(t){return Et(t)})),n.touches.forEach((function(t){return Et(t)})),n.targetTouches.forEach((function(t){return Et(t)})),it.dispatchEvent(n)}}var Mt=Ct("touchstart"),Tt=Ct("touchmove"),At=Ct("touchend"),Pt=("mapCameaParams",function(t){t.type="mapCameaParams",it.dispatchEvent(t)});var Lt=function(t){(0,_.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,b.Z)(e);if(n){var i=(0,b.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,x.Z)(this,t)});function i(t){var e;return(0,m.Z)(this,i),(e=r.call(this,t)).target=Q(),e.currentTarget=Q(),e}return(0,g.Z)(i)}(w),It=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],kt=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0];function Ot(t,e,n){for(var r=new Lt(t),i=0;i<It.length;i++){var o=It[i];r[o]=e[o]||kt[i]}return r.type=t,r.target=Q(),r.currentTarget=Q(),r.buttons=function(t){var e=0;return"touchstart"!==t&&"touchmove"!==t&&"pointerdown"!==t&&"pointermove"!==t||(e=1),e}(t),r.which=r.buttons,r.pointerId=(e.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=2*(e.radiusX||.5),r.height=2*(e.radiusY||.5),r.pressure=e.force||.5,r.isPrimary=function(t){return Rt===t.identifier}(e),r.pointerType="touch",r.altKey=n.altKey,r.ctrlKey=n.ctrlKey,r.metaKey=n.metaKey,r.shiftKey=n.shiftKey,n.preventDefault&&(r.preventDefault=function(){n.preventDefault()}),r}var Rt=null;function Dt(t){null===Rt&&(Rt=t.identifier)}function Nt(t){Rt===t.identifier&&(Rt=null)}function Ft(t){return function(e){for(var n=e.changedTouches,r=0;r<n.length;r++){var i=n[r];0===r&&"pointerdown"===t?Dt(i):"pointerup"!==t&&"pointercancel"!==t||Nt(i);var o=Ot(t,i,e);it.dispatchEvent(o)}}}var zt=Ft("pointerdown"),Bt=Ft("pointermove"),jt=Ft("pointerup");function Ut(t){return function(e){e.type=t,it.dispatchEvent(e)}}var Zt=Ut("mousedown"),Vt=Ut("mousemove"),Gt=Ut("mouseup"),Ht="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Wt="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),qt=Ht||Wt,Xt={atob:function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new h("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i="",o=0,a=0;r=e.charAt(a++);~r&&(n=o%4?64*n+r:r,o++%4)?i+=String.fromCharCode(255&n>>(-2*o&6)):0)r=c.indexOf(r);return i},btoa:p,devicePixelRatio:v,Blob:y,document:it,Element:k,Event:w,EventTarget:M,HTMLCanvasElement:lt,HTMLElement:q,HTMLMediaElement:X,HTMLVideoElement:Y,Image:J,ImageData:ht,navigator:gt,Node:T,requestAnimationFrame:function(t){var e=Q();return e.requestAnimationFrame?e.requestAnimationFrame(t):function(t){var e=Date.now(),n=Math.max(yt+23,e);return setTimeout((function(){t(yt=n)}),n-e)}(t)},cancelAnimationFrame:function(t){var e=Q();return e.cancelAnimationFrame?e.cancelAnimationFrame(t):clearTimeout(t)},screen:N,XMLHttpRequest:wt,performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,n){return{duration:0}},now:function(){}},URL:vt,WebGLRenderingContext:{GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},WebGL2RenderingContext:{},addEventListener:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};it.addEventListener(t,e,n)},removeEventListener:function(t,e,n){it.removeEventListener(t,e)},dispatchEvent:function(t){it.dispatchEvent(t)},innerWidth:N.availWidth,innerHeight:N.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Yt=qt?Xt:d,Kt=qt?wt:d.XMLHttpRequest,Qt=qt?$:d.location;function Jt(t){var e=t;return"string"==typeof t&&(e=Yt.document.getElementById(t)),e}function $t(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function te(t){return $t(t).split(/\s+/)}function ee(t,e,n){var r=Yt.document.createElement(t);return e&&(r.className=e||""),n&&n.appendChild(r),r}function ne(t){var e=t.parentNode;e&&e.removeChild(t)}function re(t,e){if(void 0!==t.classList)for(var n=te(e),r=0,i=n.length;r<i;r++)t.classList.add(n[r]);else if(!oe(t,e)){var o=se(t);ae(t,(o?o+" ":"")+e)}}function ie(t,e){void 0!==t.classList?t.classList.remove(e):ae(t,$t((" "+se(t)+" ").replace(" "+e+" "," ")))}function oe(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=se(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function ae(t,e){t instanceof HTMLElement?t.className=e:t.className.baseVal=e}function se(t){return t instanceof SVGElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function ue(t){for(;t&&t.firstChild;)t.removeChild(t.firstChild)}var le=function(t){var e,n,r=null==Yt||null===(e=Yt.document)||void 0===e||null===(n=e.documentElement)||void 0===n?void 0:n.style;if(!r)return t[0];for(var i in t)if(t[i]&&t[i]in r)return t[i];return t[0]}(["transform","WebkitTransform"]);function ce(t,e){t.style[le]=e}function he(){if("function"==typeof Event)Yt.dispatchEvent(new Event("resize"));else{var t=Yt.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,Yt,0),Yt.dispatchEvent(t)}}function pe(t){var e=["padding: "+(t.height/2-8)+"px "+t.width/2+"px;","line-height: "+t.height+"px;","background-image: url("+t.toDataURL()+");"];console.log("%c\n",e.join(""))}function fe(){var t,e=Yt.document.querySelector('meta[name="viewport"]');if(!e)return 1;var n=(null===(t=e.content)||void 0===t?void 0:t.split(",")).find((function(t){var e=t.split("=");return"initial-scale"===(0,u.Z)(e,1)[0]}));return n?1*n.split("=")[1]:1}var de=fe()<1?1:Yt.devicePixelRatio;function me(t,e){t.setAttribute("style","".concat(t.style.cssText).concat(e))}function ge(t){return t.split(";").map((function(t){return t.trim()})).filter((function(t){return t}))}function ye(t,e){var n,r=ge(null!==(n=t.getAttribute("style"))&&void 0!==n?n:""),i=ge(e),o=l.pull.apply(void 0,[r].concat((0,s.Z)(i)));t.setAttribute("style",o.join(";"))}function ve(t){return Object.entries(t).map((function(t){var e=(0,u.Z)(t,2),n=e[0],r=e[1];return"".concat(n,": ").concat(r)})).join(";")}function _e(t,e){return{left:t.left-e.left,top:t.top-e.top,right:e.left+e.width-t.left-t.width,bottom:e.top+e.height-t.top-t.height}}function xe(t,e){t.checked=e,e?t.setAttribute("checked","true"):t.removeAttribute("checked")}function be(t){t.innerHTML=""}function we(t){t.setAttribute("draggable","false")}function Se(t){if(0===t.length)throw new Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return 1*e}function Ee(t){if(0===t.length)throw new Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return 1*e}function Ce(t){if(0===t.length)return 0;for(var e=1*t[0],n=1;n<t.length;n++)e+=1*t[n];return e}function Me(t){if(0===t.length)throw new Error("mean requires at least one data point");return Ce(t)/t.length}function Te(t){if(0===t.length)throw new Error("mean requires at least one data point");if(t.length<3)return t[0];t.sort();for(var e=t[0],n=NaN,r=0,i=1,o=1;o<t.length+1;o++)t[o]!==e?(i>r&&(r=i,n=e),i=1,e=t[o]):i++;return 1*n}var Ae={min:Ee,max:Se,mean:Me,sum:Ce,mode:Te};function Pe(t,e){return t.map((function(t){return t[e]}))}function Le(t,e){return Ae[t](e)}var Ie=n(1517),ke=n(1392);function Oe(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}function Re(){return"function"==typeof importScripts}var De=Re()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===window.location.protocol?window.parent:window).location.href};var Ne=function(t){(0,_.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,b.Z)(e);if(n){var i=(0,b.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,x.Z)(this,t)});function i(t,e,n,o){var a;return(0,m.Z)(this,i),(a=r.call(this,"AJAXError: ".concat(e," (").concat(t,"): ").concat(n))).status=t,a.statusText=e,a.url=n,a.body=o,a}return(0,g.Z)(i)}((0,ke.Z)(Error));function Fe(t,e){var n=new Kt,r=Array.isArray(t.url)?t.url[0]:t.url;for(var i in n.open(t.method||"GET",r,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)t.headers.hasOwnProperty(i)&&n.setRequestHeader(i,t.headers[i]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===t.type)try{i=JSON.parse(n.response)}catch(t){return e(t)}e(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});e(new Ne(n.status,n.statusText,r.toString(),o))}},n.send(t.body),n}function ze(t){return new Promise((function(e,n){Fe(t,(function(t,r,i,o,a){t?n({err:t,data:null,xhr:a}):e({err:null,data:r,cacheControl:i,expires:o,xhr:a})}))}))}function Be(t,e){return Fe(t,e)}var je=function(t,e){return Be((0,Ie.Z)((0,Ie.Z)({},t),{},{type:"json"}),e)},Ue=function(t,e){return Be((0,Ie.Z)((0,Ie.Z)({},t),{},{type:"arrayBuffer"}),e)},Ze=function(t,e){return Be((0,Ie.Z)((0,Ie.Z)({},t),{},{method:"POST"}),e)};function Ve(t){var e=Yt.document.createElement("a");return e.href=t,e.protocol===Yt.document.location.protocol&&e.host===Yt.document.location.host}var Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",He=function(t,e){return Ue(t,(function(t,n){t?e(t):n&&("function"==typeof createImageBitmap?function(t,e){var n=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(n).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of ".concat(t.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}(n,e):function(t,e){var n=new Yt.Image,r=Yt.URL||Yt.webkitURL;n.crossOrigin="anonymous",n.onload=function(){e(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((function(){n.src=Ge}))},n.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?r.createObjectURL(i):Ge}(n,e))}))},We=n(3959);function qe(t){return"number"==typeof t}var Xe=n(2512),Ye=2*Math.PI*6378137/2;function Ke(t){var e=[1/0,1/0,-1/0,-1/0];return t.forEach((function(t){var n=t.coordinates;Qe(e,n)})),e}function Qe(t,e){return Array.isArray(e[0])?e.forEach((function(e){Qe(t,e)})):(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])),t}function Je(t,e){return $e(t,e)}function $e(t,e){return Array.isArray(t[0])?t.map((function(t){return $e(t,e)})):e(t)}function tn(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(t=on(t,e))[0],i=t[1],o=r*Ye/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*Ye/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===t.length?[o,a,t[2]]:[o,a]}function en(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=t[0],r=t[1],i=n/Ye*180,o=r/Ye*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=e&&(i=Number(i.toFixed(e)),o=Number(o.toFixed(e))),3===t.length?[i,o,t[2]]:[i,o]}function nn(t){if(null==t)throw new Error("lng is required");return(t>180||t<-180)&&((t%=360)>180&&(t=-360+t),t<-180&&(t=360+t),0===t&&(t=0)),t}function rn(t){if(null==t)throw new Error("lat is required");return(t>90||t<-90)&&((t%=180)>90&&(t=-180+t),t<-90&&(t=180+t),0===t&&(t=0)),t}function on(t,e){if(!1===e)return t;var n=nn(t[0]),r=rn(t[1]);return r>85&&(r=85),r<-85&&(r=-85),3===t.length?[n,r,t[2]]:[n,r]}function an(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;return a=Math.log(Math.tan(Math.PI/4+a/2)),o=r*(.5/Math.PI*o+.5),a=r*(-.5/Math.PI*a+(i=.5)),[Math.floor(o),Math.floor(a)]}function sn(t){var e=.5/Math.PI,n=-.5/Math.PI,r=.5,i=256<<20,o=(0,u.Z)(t,2),a=o[0],s=o[1];return a=(a/i-.5)/e,s=(s/i-r)/n,s=2*(Math.atan(Math.pow(Math.E,s))-Math.PI/4),[a/(r=Math.PI/180),s/r]}function un(t,e){var n=85.0511287798,r=Math.PI/180,i=6378137;return e=Math.max(Math.min(n,e),-n),e*=r,[(t*=r)*i,(e=Math.log(Math.tan(Math.PI/4+e/2)))*i]}function ln(t,e){var n=Math.PI/180,r=6378137;return[t/r/n,2*(Math.atan(Math.exp(e/r))-Math.PI/4)/n]}function cn(t,e,n){var r=(0,We.Ht)(e[1]-t[1]),i=(0,We.Ht)(e[0]-t[0]),o=(0,We.Ht)(t[1]),a=(0,We.Ht)(e[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return(0,We.DL)(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function hn(t){var e=Math.PI/180,n=85.0511287798,r=6378137,i=Math.max(Math.min(n,t[1]),-n),o=Math.sin(i*e);return[r*t[0]*e,r*Math.log((1+o)/(1-o))/2]}function pn(t,e){var n=Math.abs(t[1][1]-t[0][1])*e,r=Math.abs(t[1][0]-t[0][0])*e;return[[t[0][0]-r,t[0][1]-n],[t[1][0]+r,t[1][1]+n]]}function fn(t,e){return t[0][0]<=e[0][0]&&t[0][1]<=e[0][1]&&t[1][0]>=e[1][0]&&t[1][1]>=e[1][1]}function dn(t){return[[t[0],t[1]],[t[2],t[3]]]}function mn(t){var e=gn(t,[0,0]);return[t[0]/e,t[1]/e]}function gn(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function yn(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function vn(t,e){return 180*Math.acos(function(t,e){return t[0]*e[0]+t[1]*e[1]}(t,e)/(yn(t)*yn(e)))/Math.PI}function _n(t,e){return e[0]>0?e[1]>0?90-180*Math.atan(e[1]/e[0])/Math.PI:90+180*Math.atan(-e[1]/e[0])/Math.PI:e[1]<0?90-180*Math.atan(e[1]/e[0])/Math.PI+180:270+180*Math.atan(e[1]/-e[0])/Math.PI}function xn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(t&&!(t.length<2)){for(var n=0,r=[],i=0;i<t.length-1;i++){var o=t[i],a=t[i+1],s=gn(o,a);n+=s;var u=[o[0]-a[0],o[1]-a[1]],l=_n(0,u);if(i>0){var c=r[i-1].rotation;c-l>360-c+l&&(l+=360)}r.push({start:o,end:a,dis:s,rotation:l,duration:0})}return r.map((function(t){t.duration=e*(t.dis/n)})),r}}function bn(t){if(qe(t[0]))return t;if(qe(t[0][0]))throw new Error("当前数据不支持标注");if(qe(t[0][0][0])){var e=0,n=0,r=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],n+=t[1],r++}))})),[e/r,n/r,0]}throw new Error("当前数据不支持标注")}function wn(t){for(var e=t[0],n=t[1],r=t[0],i=t[1],o=0,a=0,s=0,u=0;u<t.length;u+=2){var l=t[u],c=t[u+1];l&&c&&(e=Math.max(l,e),n=Math.max(c,n),r=Math.min(l,r),i=Math.min(c,i),o+=l,a+=c,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(e-r,2)+Math.pow(n-i,2))/2}}function Sn(t){return(0,Xe.Z)((0,We.uf)([(0,We.Tu)(t)]))}var En=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;(0,m.Z)(this,t),this.limit=e,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return(0,g.Z)(t,[{key:"clear",value:function(){var t=this;this.order.forEach((function(e){t.delete(e)})),this.cache={},this.order=[]}},{key:"get",value:function(t){var e=this.cache[t];return e&&(this.deleteOrder(t),this.appendOrder(t)),e}},{key:"set",value:function(t,e){this.cache[t]?(this.delete(t),this.cache[t]=e,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=e,this.appendOrder(t))}},{key:"delete",value:function(t){var e=this.cache[t];e&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(e,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var e=this.order.findIndex((function(e){return e===t}));e>=0&&this.order.splice(e,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,e){return null}}]),t}(),Cn=n(537);function Mn(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}var Tn,An=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;(0,m.Z)(this,t),(0,Cn.Z)(this,"duration",16),(0,Cn.Z)(this,"timestamp",(new Date).getTime()),this.duration=e}return(0,g.Z)(t,[{key:"run",value:function(t){var e=(new Date).getTime(),n=e-this.timestamp;this.timestamp=e,n>=this.duration&&t()}}]),t}(),Pn=n(4537);function Ln(t){return"string"==typeof t&&!!Pn.ZP(t)}function In(t){var e=Pn.ZP(t),n=[0,0,0,0];return null!=e&&(n[0]=e.r/255,n[1]=e.g/255,n[2]=e.b/255,n[3]=e.opacity),n}function kn(t){return(t&&t[0])+256*(t&&t[1])+65536*(t&&t[2])-1}function On(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}function Rn(t){var e=Yt.document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;var r=null;if(t.weights){var i=0;t.weights.map((function(e,r){var o=t.colors[r]||"rgba(0, 0, 0, 0)",a=i+e;n.fillStyle=o,n.fillRect(256*i,0,256*a,1),i=a}))}else{for(var o=n.createLinearGradient(0,0,256,1),a=t.positions[0],s=t.positions[t.positions.length-1],u=0;u<t.colors.length;++u){var l=(t.positions[u]-a)/(s-a);o.addColorStop(l,t.colors[u])}n.fillStyle=o,n.fillRect(0,0,256,1)}if(qt)return r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),e=null,n=null,{data:r,width:256,height:1};r=n.getImageData(0,0,256,1).data;for(var c=n.createImageData(256,1),h=0;h<c.data.length;h+=4)c.data[h+0]=r[h+0],c.data[h+1]=r[h+1],c.data[h+2]=r[h+2],c.data[h+3]=r[h+3];return e=null,n=null,c}!function(t){t.CENTER="center",t.TOP="top",t["TOP-LEFT"]="top-left",t["TOP-RIGHT"]="top-right",t.BOTTOM="bottom",t["BOTTOM-LEFT"]="bottom-left",t["BOTTOM-RIGHT"]="bottom-right",t.LEFT="left",t.RIGHT="right"}(Tn||(Tn={}));var Dn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Nn(t,e,n){var r=t.classList;for(var i in Dn)Dn.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(e))}function Fn(t,e){return{enable:t,mask:255,func:{cmp:514,ref:e?1:0,mask:255}}}var zn=n(7012),Bn=n(5814),jn=n.n(Bn);function Un(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof document&&document;var Zn="undefined"!=typeof window&&void 0!==window.orientation,Vn=function(){function t(t,e){var n=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){n.resolve=t,n.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Un(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Un(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}();const Gn=Vn;var Hn=new Map;function Wn(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function qn(t,e,n){void 0===e&&(e=!0);var r=n||new Set;if(t)if(Xn(t))r.add(t);else if(Xn(t.buffer))r.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var i in t)qn(t[i],e,r);return void 0===n?Array.from(r):[]}function Xn(t){return!!t&&(t instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&t instanceof MessagePort||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)}var Yn=function(){};const Kn=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,n=t.source,r=t.url;Un(n||r),this.name=e,this.source=n,this.url=r,this.onMessage=Yn,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Yn,this.onError=Yn,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||qn(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=function(t){Un(t.source&&!t.url||!t.source&&t.url);var e,n=Hn.get(t.source||t.url);return n||(t.url&&(n=(e=t.url).startsWith("http")?Wn("try {\n  importScripts('"+e+"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}"):e,Hn.set(t.url,n)),t.source&&(n=Wn(t.source),Hn.set(t.source,n))),Un(n),n}({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}();var Qn=function(){return Qn=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},Qn.apply(this,arguments)},Jn=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},$n=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};const tr=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Qn(Qn({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,n){return void 0===e&&(e=function(t,e,n){return t.done(n)}),void 0===n&&(n=function(t,e){return t.error(e)}),Jn(this,void 0,void 0,(function(){var r,i=this;return $n(this,(function(o){switch(o.label){case 0:return r=new Promise((function(r){return i.jobQueue.push({name:t,onMessage:e,onError:n,onStart:r}),i})),this.startQueuedJob(),[4,r];case 1:return[2,o.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Jn(this,void 0,void 0,(function(){var t,e,n;return $n(this,(function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),n=new Gn(e.name,t),t.onMessage=function(t){return e.onMessage(n,t.type,t.payload)},t.onError=function(t){return e.onError(n,t)},e.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Kn({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Zn?this.maxMobileConcurrency:this.maxConcurrency},t}();var er=function(){return er=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},er.apply(this,arguments)},nr=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},rr={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ir=function(){function t(t){this.workerPools=new Map,this.props=er({},rr),this.setProps(t),this.workerPools=new Map}return t.isSupported=function(){return Kn.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var n=nr(this.workerPools.values()),r=n.next();!r.done;r=n.next())r.value.destroy()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,n;this.props=er(er({},this.props),t);try{for(var r=nr(this.workerPools.values()),i=r.next();!i.done;i=r.next())i.value.setProps(this.getWorkerPoolProps())}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,n=t.source,r=t.url,i=this.workerPools.get(e);return i||((i=new tr({name:e,source:n,url:r})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,i)),i},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},t}();const or=ir;var ar=new Map,sr=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(lr(e)){var n=e.data,r=n.type,i=n.payload;t(r,i)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ar.get(t);e||(e=function(e){if(lr(e)){var n=e.data,r=n.type,i=n.payload;t(r,i)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ar.get(t);ar.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var n={source:"Worker thread",type:t,payload:e},r=qn(e);self.postMessage(n,r)}},t}();const ur=sr;function lr(t){var e=t.type,n=t.data;return"message"===e&&n&&"string"==typeof n.source&&"Main thread"===n.source}!function(){function t(){this._values=[],this._settlers=[],this._closed=!1}t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;)this._settlers.shift().resolve({done:!0});this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,n){t._settlers.push({resolve:e,reject:n})}))}}();var cr,hr=0;function pr(t,e){return void 0===e&&(e={}),new Promise((function(n,r){var i=hr++,o=function(t,e){if(e.id===i)switch(t){case"done":ur.removeEventListener(o),n(e.result);break;case"error":ur.removeEventListener(o),r(e.error)}};ur.addEventListener(o);var a={id:i,input:t,options:e};ur.postMessage("process",a)}))}function fr(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function dr(t,e,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}function mr(t){return t.filter?[1]:[0]}function gr(t,e){return[e]}var yr=n(6319),vr=n.n(yr),_r=n(9341),xr=_r.Ue(),br=(_r.Ue(),_r.Ue()),wr=_r.Ue(),Sr=_r.Ue();function Er(t,e,n,r,i){_r.IH(t,n,r),_r.Fv(t,t),e=_r.al(-t[1],t[0]);var o=_r.al(-n[1],n[0]);return[i/_r.AK(e,o),e]}function Cr(t,e){return _r.t8(t,-e[1],e[0])}function Mr(t,e,n){return _r.lu(t,e,n),_r.Fv(t,t),t}function Tr(t,e){return t[0]===e[0]&&t[1]===e[1]}var Ar=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,m.Z)(this,t),(0,Cn.Z)(this,"lastFlip",-1),(0,Cn.Z)(this,"miter",_r.al(0,0)),(0,Cn.Z)(this,"started",!1),(0,Cn.Z)(this,"dash",!1),(0,Cn.Z)(this,"totalDistance",0),(0,Cn.Z)(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,g.Z)(t,[{key:"extrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,u,l,c=t[o-1];c.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var h=e[o-1],p=t[o];p.push(null!==(u=e[o][2])&&void 0!==u?u:0);var f=e[o],d=o<t.length-1?[].concat((0,s.Z)(t[o+1]),[null!==(l=e[o+1][2])&&void 0!==l?l:0]):null,m=o<e.length-1?e[o+1]:null;i+=this.segment_gaode2(n,i,c,p,d,h,f,m)}if(this.dash)for(var g=0;g<n.positions.length/6;g++)n.positions[6*g+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,u,l,c=t[o-1];c.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var h=e[o-1],p=t[o];p.push(null!==(u=e[o][2])&&void 0!==u?u:0);var f=e[o],d=o<t.length-1?[].concat((0,s.Z)(t[o+1]),[null!==(l=e[o+1][2])&&void 0!==l?l:0]):null,m=o<e.length-1?e[o+1]:null;i+=this.simpleSegment(n,i,c,p,d,h,f,m)}if(this.dash)for(var g=0;g<n.positions.length/6;g++)n.positions[6*g+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.segment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.simpleSegment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,n,r,i,o,a,l){var c=0,h=t.indices,p=t.positions,f=t.normals,d="square"===this.cap,m="bevel"===this.join,g=an([a[0],a[1]]),y=an([o[0],o[1]]);Mr(br,r,n);var v=0;if(this.dash&&(v=this.lineSegmentDistance(g,y),this.totalDistance+=v),this.normal||(this.normal=_r.Ue(),Cr(this.normal,br)),!this.started)if(this.started=!0,d){var _=_r.Ue(),x=_r.Ue();_r.IH(_,this.normal,br),_r.IH(x,this.normal,br),f.push(x[0],x[1],0),f.push(_[0],_[1],0),p.push(n[0],n[1],0|n[2],this.totalDistance-v,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),p.push(n[0],n[1],0|n[2],this.totalDistance-v,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,f,n,this.normal,this.thickness,this.totalDistance-v);if(h.push(e+0,e+1,e+2),i){Tr(r,i)&&_r.IH(i,r,_r.Fv(i,_r.$X(i,r,n))),Mr(wr,i,r);var b=Er(Sr,_r.Ue(),br,wr,this.thickness),w=(0,u.Z)(b,2),S=w[0],E=w[1],C=_r.AK(Sr,this.normal)<0?-1:1,M=m;M||"miter"!==this.join||S>this.miterLimit&&(M=!0),M?(f.push(this.normal[0],this.normal[1],0),f.push(E[0],E[1],0),p.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*C,0|r[2]),this.complex.indexes.push(this.currentIndex),p.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*C,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,h.push.apply(h,(0,s.Z)(this.lastFlip!==-C?[e,e+2,e+3]:[e+2,e+1,e+3])),h.push(e+2,e+3,e+4),Cr(xr,wr),_r.JG(this.normal,xr),f.push(this.normal[0],this.normal[1],0),p.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*C,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(p,f,r,E,S,this.totalDistance),h.push.apply(h,(0,s.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),C=-1,_r.JG(this.normal,E),c+=2),this.lastFlip=C}else{if(Cr(this.normal,br),d){var T=_r.Ue(),A=_r.Ue();_r.lu(A,br,this.normal),_r.IH(T,br,this.normal),f.push(A[0],A[1],0),f.push(T[0],T[1],0),p.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),p.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,f,r,this.normal,this.thickness,this.totalDistance);h.push.apply(h,(0,s.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),c+=2}return c}},{key:"simpleSegment",value:function(t,e,n,r,i){var o=0,a=t.indices,l=t.positions,c=t.normals,h=an([r[0],r[1]]),p=an([n[0],n[1]]);Mr(br,h,p);var f=0;if(this.dash&&(f=this.lineSegmentDistance(h,p),this.totalDistance+=f),this.normal||(this.normal=_r.Ue(),Cr(this.normal,br)),this.started||(this.started=!0,this.extrusions(l,c,n,this.normal,this.thickness,this.totalDistance-f)),a.push(e+0,e+1,e+2),i){var d=an([i[0],i[1]]);Tr(h,d)&&_r.IH(d,h,_r.Fv(d,_r.$X(d,h,p))),Mr(wr,d,h);var m=Er(Sr,_r.Ue(),br,wr,this.thickness),g=(0,u.Z)(m,2),y=g[0],v=g[1];_r.AK(Sr,this.normal),this.extrusions(l,c,r,v,y,this.totalDistance),a.push.apply(a,(0,s.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),_r.JG(this.normal,v),o+=2,this.lastFlip=-1}else Cr(this.normal,br),this.extrusions(l,c,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,(0,s.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2;return o}},{key:"segment",value:function(t,e,n,r,i){var o=0,a=t.indices,l=t.positions,c=t.normals,h="square"===this.cap,p="bevel"===this.join,f=an([r[0],r[1]]),d=an([n[0],n[1]]);Mr(br,f,d);var m=0;if(this.dash&&(m=this.lineSegmentDistance(f,d),this.totalDistance+=m),this.normal||(this.normal=_r.Ue(),Cr(this.normal,br)),!this.started)if(this.started=!0,h){var g=_r.Ue(),y=_r.Ue();_r.IH(g,this.normal,br),_r.IH(y,this.normal,br),c.push(y[0],y[1],0),c.push(g[0],g[1],0),l.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,n,this.normal,this.thickness,this.totalDistance-m);if(a.push(e+0,e+1,e+2),i){var v=an([i[0],i[1]]);Tr(f,v)&&_r.IH(v,f,_r.Fv(v,_r.$X(v,f,d))),Mr(wr,v,f);var _=Er(Sr,_r.Ue(),br,wr,this.thickness),x=(0,u.Z)(_,2),b=x[0],w=x[1],S=_r.AK(Sr,this.normal)<0?-1:1,E=p;E||"miter"!==this.join||b>this.miterLimit&&(E=!0),E?(c.push(this.normal[0],this.normal[1],0),c.push(w[0],w[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,(0,s.Z)(this.lastFlip!==-S?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),Cr(xr,wr),_r.JG(this.normal,xr),c.push(this.normal[0],this.normal[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(l,c,r,w,b,this.totalDistance),a.push.apply(a,(0,s.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),S=-1,_r.JG(this.normal,w),o+=2),this.lastFlip=S}else{if(Cr(this.normal,br),h){var C=_r.Ue(),M=_r.Ue();_r.lu(M,br,this.normal),_r.IH(C,br,this.normal),c.push(M[0],M[1],0),c.push(C[0],C[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,(0,s.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2}return o}},{key:"extrusions",value:function(t,e,n,r,i,o){e.push(r[0],r[1],0),e.push(r[0],r[1],0),t.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}}]),t}();function Pr(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new Ar({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=e;c[0]&&!Array.isArray(c[0][0])&&(c=[e]),c.forEach((function(t){i.extrude(t)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function Lr(t){var e=bn(t.coordinates);return{vertices:[].concat((0,s.Z)(e),(0,s.Z)(e),(0,s.Z)(e),(0,s.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function Ir(t){var e=t.coordinates,n=vr().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:vr()(r,o,i),vertices:r,size:i}}var kr=function(){var t=(0,zn.Z)(jn().mark((function t(e){var n,r,i,o,a,u,l,c,h;return jn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o=e.iconMap,a={a_Color:fr,a_Position:dr,filter:mr,a_vertexId:gr,a_PickingColor:function(t){var e=t.id;return i?On(e):[0,0,0]},a_DistanceAndIndex:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]},a_Total_Distance:function(t,e,n){return[n[5]]},a_Size:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]},a_Normal:function(t,e,n,r,i){return i},a_Miter:function(t,e,n){return[n[4]]},a_iconMapUV:function(t){var e=t.texture,n=o[e]||{x:0,y:0};return[n.x,n.y]}},u={sizePerElement:0,elements:[]},l=0,c=[],h=3,r.forEach((function(t,e){var r=Pr(t),i=r.indices,o=r.vertices,p=r.normals,f=r.size,d=r.indexes;i.forEach((function(t){c.push(t+l)})),h=f;var m=o.length/f;u.sizePerElement=h,u.elements.push({featureIdx:e,vertices:o,normals:p,offset:l}),l+=m;for(var g=function(r){var i=(null==p?void 0:p.slice(3*r,3*r+3))||[],u=o.slice(r*f,r*f+f),l=0;d&&void 0!==d[r]&&(l=d[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,(0,s.Z)(a[n.name](t,e,u,r,i,l)))}))},y=0;y<m;y++)g(y)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Or={pointFill:function(){var t=(0,zn.Z)(jn().mark((function t(e){var n,r,i,o,a,u,l,c,h;return jn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o=e.shape2d,a={a_Color:fr,a_Position:dr,filter:mr,a_vertexId:gr,a_PickingColor:function(t){var e=t.id;return i?On(e):[0,0,0]},a_Shape:function(t){var e=t.shape,n=void 0===e?2:e;return[o.indexOf(n)]},a_Extrude:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]},a_Size:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}},u={sizePerElement:0,elements:[]},l=0,c=[],h=3,r.forEach((function(t,e){var r=Lr(t),i=r.indices,o=r.vertices,p=r.normals,f=r.size,d=r.indexes;i.forEach((function(t){c.push(t+l)})),h=f;var m=o.length/f;u.sizePerElement=h,u.elements.push({featureIdx:e,vertices:o,normals:p,offset:l}),l+=m;for(var g=function(r){var i=(null==p?void 0:p.slice(3*r,3*r+3))||[],u=o.slice(r*f,r*f+f),l=0;d&&void 0!==d[r]&&(l=d[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,(0,s.Z)(a[n.name](t,e,u,r,i,l)))}))},y=0;y<m;y++)g(y)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:kr,polygonFill:function(){var t=(0,zn.Z)(jn().mark((function t(e){var n,r,i,o,a,u,l,c;return jn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o={a_Color:fr,a_Position:dr,filter:mr,a_vertexId:gr,a_PickingColor:function(t){var e=t.id;return i?On(e):[0,0,0]}},a={sizePerElement:0,elements:[]},u=0,l=[],c=3,r.forEach((function(t,e){var r=Ir(t),i=r.indices,h=r.vertices,p=r.normals,f=r.size,d=r.indexes;i.forEach((function(t){l.push(t+u)})),c=f;var m=h.length/f;a.sizePerElement=c,a.elements.push({featureIdx:e,vertices:h,normals:p,offset:u}),u+=m;for(var g=function(r){var i=(null==p?void 0:p.slice(3*r,3*r+3))||[],a=h.slice(r*f,r*f+f),u=0;d&&void 0!==d[r]&&(u=d[r]),n.forEach((function(n){var l;n&&o[n.name]&&(l=n.buffer.data).push.apply(l,(0,s.Z)(o[n.name](t,e,a,r,i,u)))}))},y=0;y<m;y++)g(y)})),t.abrupt("return",{descriptors:n,featureLayout:a,indices:l});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},Rr=(0,Ie.Z)({},Or);function Dr(){return(Dr=(0,zn.Z)(jn().mark((function t(e){var n,r;return jn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,r=e.data,!Rr[n]){t.next=3;break}return t.abrupt("return",Rr[n](r));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(t,e){var n=this;if("undefined"!=typeof self){var r={process:pr};ur.onmessage=function(e,i){return o=n,a=void 0,u=function(){var n,o,a,s,u,l,c,h,p,f;return function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),e){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},r)];case 2:return n=d.sent(),ur.postMessage("done",{result:n}),[3,18];case 3:throw new Error("Worker does not support batched processing");case 4:d.trys.push([4,9,10,15]),a=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){!function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)}(r,i,(e=t[n](e)).done,e.value)}))}}}(o),d.label=5;case 5:return[4,a.next()];case 6:if((s=d.sent()).done)return[3,8];u=s.value,ur.postMessage("output-batch",{result:u}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return l=d.sent(),p={error:l},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(f=a.return)?[4,f.call(a)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ur.postMessage("done",{}),[3,18];case 16:return cr.push(i.input),[3,18];case 17:return cr.close(),[3,18];case 18:return[3,20];case 19:return c=d.sent(),h=c instanceof Error?c.message:"",ur.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))},new((s=void 0)||(s=Promise))((function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(n,r)}i((u=u.apply(o,a||[])).next())}));var o,a,s,u}}}((function(t){return Dr.apply(this,arguments)}));var Nr=new Map,Fr="l7-worker";function zr(t){!function(t,e){Nr.set("l7-worker",e)}(0,t)}function Br(){var t=(Fr,Nr.get("l7-worker"));if(!t)throw new Error("get worker failed by workerName: ".concat(Fr,"."));return t}function jr(t,e){return Ur.apply(this,arguments)}function Ur(){return(Ur=(0,zn.Z)(jn().mark((function t(e,n){var r,i,o,a,s;return jn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Br(),i=or.getWorkerFarm({maxConcurrency:3,reuseWorkers:!0}),o=i.getWorkerPool({name:Fr,source:r}),t.next=5,o.startJob(Fr,(function(t,e,n){return t.done(n)}));case 5:return(a=t.sent).postMessage("process",{input:{workerType:e,data:n}}),t.next=9,a.result;case 9:return s=t.sent,t.abrupt("return",s.result);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}zr('var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),u=new T(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var h={};function p(){}function v(){}function d(){}var y={};c(y,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(k([])));m&&m!==e&&n.call(m,a)&&(y=m);var x=d.prototype=p.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var r;o(this,"_invoke",{value:function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=l(t[o],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=A(a,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function A(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a \'throw\' method")}return h}var n=l(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,h;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=d,o(x,"constructor",{value:d,configurable:!0}),o(d,"constructor",{value:v,configurable:!0}),v.displayName=c(d,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,s,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},b(w.prototype),c(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(x),c(x,s,"Generator"),c(x,a,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var w,E,A=function(t){return t&&t.Math==Math&&t},O=A("object"==typeof globalThis&&globalThis)||A("object"==typeof window&&window)||A("object"==typeof self&&self)||A("object"==typeof x&&x)||function(){return this}()||Function("return this")(),S=Object.defineProperty,T=function(t,e){try{S(O,t,{value:e,configurable:!0,writable:!0})}catch(r){O[t]=e}return e},k=O["__core-js_shared__"]||T("__core-js_shared__",{}),I=b((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.26.0",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),j=function(t){try{return!!t()}catch(t){return!0}},P=!j((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),_=Function.prototype,M=_.call,L=P&&_.bind.bind(M,M),R=P?L:function(t){return function(){return M.apply(t,arguments)}},C=R({}.toString),N=R("".slice),D=function(t){return N(C(t),8,-1)},F=function(t){if("Function"===D(t))return R(t)},W=function(t){return null==t},z=TypeError,B=function(t){if(W(t))throw z("Can\'t call method on "+t);return t},U=Object,G=function(t){return U(B(t))},H=F({}.hasOwnProperty),V=Object.hasOwn||function(t,e){return H(G(t),e)},q=0,Z=Math.random(),Y=F(1..toString),$=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Y(++q+Z,36)},K="object"==typeof document&&document.all,Q={all:K,IS_HTMLDDA:void 0===K&&void 0!==K},X=Q.all,J=Q.IS_HTMLDDA?function(t){return"function"==typeof t||t===X}:function(t){return"function"==typeof t},tt=function(t){return J(t)?t:void 0},et=function(t,e){return arguments.length<2?tt(O[t]):O[t]&&O[t][e]},rt=et("navigator","userAgent")||"",nt=O.process,ot=O.Deno,it=nt&&nt.versions||ot&&ot.version,at=it&&it.v8;at&&(E=(w=at.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!E&&rt&&(!(w=rt.match(/Edge\\/(\\d+)/))||w[1]>=74)&&(w=rt.match(/Chrome\\/(\\d+)/))&&(E=+w[1]);var ut=E,st=!!Object.getOwnPropertySymbols&&!j((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ut&&ut<41})),ct=st&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ft=I("wks"),lt=O.Symbol,ht=lt&&lt.for,pt=ct?lt:lt&&lt.withoutSetter||$,vt=function(t){if(!V(ft,t)||!st&&"string"!=typeof ft[t]){var e="Symbol."+t;st&&V(lt,t)?ft[t]=lt[t]:ft[t]=ct&&ht?ht(e):pt(e)}return ft[t]},dt={};dt[vt("toStringTag")]="z";var yt="[object z]"===String(dt),gt=!j((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),mt=Q.all,xt=Q.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:J(t)||t===mt}:function(t){return"object"==typeof t?null!==t:J(t)},bt=O.document,wt=xt(bt)&&xt(bt.createElement),Et=function(t){return wt?bt.createElement(t):{}},At=!gt&&!j((function(){return 7!=Object.defineProperty(Et("div"),"a",{get:function(){return 7}}).a})),Ot=gt&&j((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),St=String,Tt=TypeError,kt=function(t){if(xt(t))return t;throw Tt(St(t)+" is not an object")},It=Function.prototype.call,jt=P?It.bind(It):function(){return It.apply(It,arguments)},Pt=F({}.isPrototypeOf),_t=Object,Mt=ct?function(t){return"symbol"==typeof t}:function(t){var e=et("Symbol");return J(e)&&Pt(e.prototype,_t(t))},Lt=String,Rt=function(t){try{return Lt(t)}catch(t){return"Object"}},Ct=TypeError,Nt=function(t){if(J(t))return t;throw Ct(Rt(t)+" is not a function")},Dt=function(t,e){var r=t[e];return W(r)?void 0:Nt(r)},Ft=TypeError,Wt=TypeError,zt=vt("toPrimitive"),Bt=function(t,e){if(!xt(t)||Mt(t))return t;var r,n=Dt(t,zt);if(n){if(void 0===e&&(e="default"),r=jt(n,t,e),!xt(r)||Mt(r))return r;throw Wt("Can\'t convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&J(r=t.toString)&&!xt(n=jt(r,t)))return n;if(J(r=t.valueOf)&&!xt(n=jt(r,t)))return n;if("string"!==e&&J(r=t.toString)&&!xt(n=jt(r,t)))return n;throw Ft("Can\'t convert object to primitive value")}(t,e)},Ut=function(t){var e=Bt(t,"string");return Mt(e)?e:e+""},Gt=TypeError,Ht=Object.defineProperty,Vt=Object.getOwnPropertyDescriptor,qt={f:gt?Ot?function(t,e,r){if(kt(t),e=Ut(e),kt(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Vt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Ht(t,e,r)}:Ht:function(t,e,r){if(kt(t),e=Ut(e),kt(r),At)try{return Ht(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Gt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Zt=Function.prototype,Yt=gt&&Object.getOwnPropertyDescriptor,$t=V(Zt,"name"),Kt={EXISTS:$t,PROPER:$t&&"something"===function(){}.name,CONFIGURABLE:$t&&(!gt||gt&&Yt(Zt,"name").configurable)},Qt=F(Function.toString);J(k.inspectSource)||(k.inspectSource=function(t){return Qt(t)});var Xt,Jt,te,ee=k.inspectSource,re=O.WeakMap,ne=J(re)&&/native code/.test(String(re)),oe=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ie=gt?function(t,e,r){return qt.f(t,e,oe(1,r))}:function(t,e,r){return t[e]=r,t},ae=I("keys"),ue=function(t){return ae[t]||(ae[t]=$(t))},se={},ce=O.TypeError,fe=O.WeakMap;if(ne||k.state){var le=k.state||(k.state=new fe);le.get=le.get,le.has=le.has,le.set=le.set,Xt=function(t,e){if(le.has(t))throw ce("Object already initialized");return e.facade=t,le.set(t,e),e},Jt=function(t){return le.get(t)||{}},te=function(t){return le.has(t)}}else{var he=ue("state");se[he]=!0,Xt=function(t,e){if(V(t,he))throw ce("Object already initialized");return e.facade=t,ie(t,he,e),e},Jt=function(t){return V(t,he)?t[he]:{}},te=function(t){return V(t,he)}}var pe={set:Xt,get:Jt,has:te,enforce:function(t){return te(t)?Jt(t):Xt(t,{})},getterFor:function(t){return function(e){var r;if(!xt(e)||(r=Jt(e)).type!==t)throw ce("Incompatible receiver, "+t+" required");return r}}},ve=b((function(t){var e=Kt.CONFIGURABLE,r=pe.enforce,n=pe.get,o=Object.defineProperty,i=gt&&!j((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),u=t.exports=function(t,n,u){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\\(([^)]*)\\)/,"$1")+"]"),u&&u.getter&&(n="get "+n),u&&u.setter&&(n="set "+n),(!V(t,"name")||e&&t.name!==n)&&(gt?o(t,"name",{value:n,configurable:!0}):t.name=n),i&&u&&V(u,"arity")&&t.length!==u.arity&&o(t,"length",{value:u.arity});try{u&&V(u,"constructor")&&u.constructor?gt&&o(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=r(t);return V(s,"source")||(s.source=a.join("string"==typeof n?n:"")),t};Function.prototype.toString=u((function(){return J(this)&&n(this).source||ee(this)}),"toString")})),de=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(J(r)&&ve(r,i,n),n.global)o?t[e]=r:T(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:qt.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},ye=vt("toStringTag"),ge=Object,me="Arguments"==D(function(){return arguments}()),xe=yt?D:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ge(t),ye))?r:me?D(e):"Object"==(n=D(e))&&J(e.callee)?"Arguments":n},be=yt?{}.toString:function(){return"[object "+xe(this)+"]"};yt||de(Object.prototype,"toString",be,{unsafe:!0});var we={}.propertyIsEnumerable,Ee=Object.getOwnPropertyDescriptor,Ae={f:Ee&&!we.call({1:2},1)?function(t){var e=Ee(this,t);return!!e&&e.enumerable}:we},Oe=Object,Se=F("".split),Te=j((function(){return!Oe("z").propertyIsEnumerable(0)}))?function(t){return"String"==D(t)?Se(t,""):Oe(t)}:Oe,ke=function(t){return Te(B(t))},Ie=Object.getOwnPropertyDescriptor,je={f:gt?Ie:function(t,e){if(t=ke(t),e=Ut(e),At)try{return Ie(t,e)}catch(t){}if(V(t,e))return oe(!jt(Ae.f,t,e),t[e])}},Pe=Math.ceil,_e=Math.floor,Me=Math.trunc||function(t){var e=+t;return(e>0?_e:Pe)(e)},Le=function(t){var e=+t;return e!=e||0===e?0:Me(e)},Re=Math.max,Ce=Math.min,Ne=function(t,e){var r=Le(t);return r<0?Re(r+e,0):Ce(r,e)},De=Math.min,Fe=function(t){return t>0?De(Le(t),9007199254740991):0},We=function(t){return Fe(t.length)},ze=function(t){return function(e,r,n){var o,i=ke(e),a=We(i),u=Ne(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},Be={includes:ze(!0),indexOf:ze(!1)},Ue=Be.indexOf,Ge=F([].push),He=function(t,e){var r,n=ke(t),o=0,i=[];for(r in n)!V(se,r)&&V(n,r)&&Ge(i,r);for(;e.length>o;)V(n,r=e[o++])&&(~Ue(i,r)||Ge(i,r));return i},Ve=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qe=Ve.concat("length","prototype"),Ze={f:Object.getOwnPropertyNames||function(t){return He(t,qe)}},Ye={f:Object.getOwnPropertySymbols},$e=F([].concat),Ke=et("Reflect","ownKeys")||function(t){var e=Ze.f(kt(t)),r=Ye.f;return r?$e(e,r(t)):e},Qe=function(t,e,r){for(var n=Ke(e),o=qt.f,i=je.f,a=0;a<n.length;a++){var u=n[a];V(t,u)||r&&V(r,u)||o(t,u,i(e,u))}},Xe=/#|\\.prototype\\./,Je=function(t,e){var r=er[tr(t)];return r==nr||r!=rr&&(J(e)?j(e):!!e)},tr=Je.normalize=function(t){return String(t).replace(Xe,".").toLowerCase()},er=Je.data={},rr=Je.NATIVE="N",nr=Je.POLYFILL="P",or=Je,ir=je.f,ar=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?O:c?O[u]||T(u,{}):(O[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=ir(r,n))&&a.value:r[n],!or(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qe(i,o)}(t.sham||o&&o.sham)&&ie(i,"sham",!0),de(r,n,i,t)}},ur="process"==D(O.process),sr=String,cr=TypeError,fr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=F(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return kt(r),function(t){if("object"==typeof t||J(t))return t;throw cr("Can\'t set "+sr(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),lr=qt.f,hr=vt("toStringTag"),pr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!V(t,hr)&&lr(t,hr,{configurable:!0,value:e})},vr=vt("species"),dr=function(t){var e=et(t),r=qt.f;gt&&e&&!e[vr]&&r(e,vr,{configurable:!0,get:function(){return this}})},yr=TypeError,gr=function(t,e){if(Pt(e,t))return t;throw yr("Incorrect invocation")},mr=function(){},xr=[],br=et("Reflect","construct"),wr=/^\\s*(?:class|function)\\b/,Er=F(wr.exec),Ar=!wr.exec(mr),Or=function(t){if(!J(t))return!1;try{return br(mr,xr,t),!0}catch(t){return!1}},Sr=function(t){if(!J(t))return!1;switch(xe(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ar||!!Er(wr,ee(t))}catch(t){return!0}};Sr.sham=!0;var Tr,kr,Ir,jr,Pr=!br||j((function(){var t;return Or(Or.call)||!Or(Object)||!Or((function(){t=!0}))||t}))?Sr:Or,_r=TypeError,Mr=function(t){if(Pr(t))return t;throw _r(Rt(t)+" is not a constructor")},Lr=vt("species"),Rr=function(t,e){var r,n=kt(t).constructor;return void 0===n||W(r=kt(n)[Lr])?e:Mr(r)},Cr=Function.prototype,Nr=Cr.apply,Dr=Cr.call,Fr="object"==typeof Reflect&&Reflect.apply||(P?Dr.bind(Nr):function(){return Dr.apply(Nr,arguments)}),Wr=F(F.bind),zr=function(t,e){return Nt(t),void 0===e?t:P?Wr(t,e):function(){return t.apply(e,arguments)}},Br=et("document","documentElement"),Ur=F([].slice),Gr=TypeError,Hr=function(t,e){if(t<e)throw Gr("Not enough arguments");return t},Vr=/(?:ipad|iphone|ipod).*applewebkit/i.test(rt),qr=O.setImmediate,Zr=O.clearImmediate,Yr=O.process,$r=O.Dispatch,Kr=O.Function,Qr=O.MessageChannel,Xr=O.String,Jr=0,tn={};try{Tr=O.location}catch(t){}var en=function(t){if(V(tn,t)){var e=tn[t];delete tn[t],e()}},rn=function(t){return function(){en(t)}},nn=function(t){en(t.data)},on=function(t){O.postMessage(Xr(t),Tr.protocol+"//"+Tr.host)};qr&&Zr||(qr=function(t){Hr(arguments.length,1);var e=J(t)?t:Kr(t),r=Ur(arguments,1);return tn[++Jr]=function(){Fr(e,void 0,r)},kr(Jr),Jr},Zr=function(t){delete tn[t]},ur?kr=function(t){Yr.nextTick(rn(t))}:$r&&$r.now?kr=function(t){$r.now(rn(t))}:Qr&&!Vr?(jr=(Ir=new Qr).port2,Ir.port1.onmessage=nn,kr=zr(jr.postMessage,jr)):O.addEventListener&&J(O.postMessage)&&!O.importScripts&&Tr&&"file:"!==Tr.protocol&&!j(on)?(kr=on,O.addEventListener("message",nn,!1)):kr="onreadystatechange"in Et("script")?function(t){Br.appendChild(Et("script")).onreadystatechange=function(){Br.removeChild(this),en(t)}}:function(t){setTimeout(rn(t),0)});var an,un,sn,cn,fn,ln,hn,pn,vn={set:qr,clear:Zr},dn=/ipad|iphone|ipod/i.test(rt)&&void 0!==O.Pebble,yn=/web0s(?!.*chrome)/i.test(rt),gn=je.f,mn=vn.set,xn=O.MutationObserver||O.WebKitMutationObserver,bn=O.document,wn=O.process,En=O.Promise,An=gn(O,"queueMicrotask"),On=An&&An.value;On||(an=function(){var t,e;for(ur&&(t=wn.domain)&&t.exit();un;){e=un.fn,un=un.next;try{e()}catch(t){throw un?cn():sn=void 0,t}}sn=void 0,t&&t.enter()},Vr||ur||yn||!xn||!bn?!dn&&En&&En.resolve?((hn=En.resolve(void 0)).constructor=En,pn=zr(hn.then,hn),cn=function(){pn(an)}):ur?cn=function(){wn.nextTick(an)}:(mn=zr(mn,O),cn=function(){mn(an)}):(fn=!0,ln=bn.createTextNode(""),new xn(an).observe(ln,{characterData:!0}),cn=function(){ln.data=fn=!fn}));var Sn=On||function(t){var e={fn:t,next:void 0};sn&&(sn.next=e),un||(un=e,cn()),sn=e},Tn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},kn=function(){this.head=null,this.tail=null};kn.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var In,jn,Pn,_n=kn,Mn=O.Promise,Ln="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Rn=!Ln&&!ur&&"object"==typeof window&&"object"==typeof document,Cn=(Mn&&Mn.prototype,vt("species")),Nn=!1,Dn=J(O.PromiseRejectionEvent),Fn={CONSTRUCTOR:or("Promise",(function(){var t=ee(Mn),e=t!==String(Mn);if(!e&&66===ut)return!0;if(!ut||ut<51||!/native code/.test(t)){var r=new Mn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Nn=r.then((function(){}))instanceof n))return!0}return!e&&(Rn||Ln)&&!Dn})),REJECTION_EVENT:Dn,SUBCLASSING:Nn},Wn=TypeError,zn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw Wn("Bad Promise constructor");e=t,r=n})),this.resolve=Nt(e),this.reject=Nt(r)},Bn={f:function(t){return new zn(t)}},Un=vn.set,Gn=Fn.CONSTRUCTOR,Hn=Fn.REJECTION_EVENT,Vn=Fn.SUBCLASSING,qn=pe.getterFor("Promise"),Zn=pe.set,Yn=Mn&&Mn.prototype,$n=Mn,Kn=Yn,Qn=O.TypeError,Xn=O.document,Jn=O.process,to=Bn.f,eo=to,ro=!!(Xn&&Xn.createEvent&&O.dispatchEvent),no=function(t){var e;return!(!xt(t)||!J(e=t.then))&&e},oo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&co(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Qn("Promise-chain cycle")):(n=no(r))?jt(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},io=function(t,e){t.notified||(t.notified=!0,Sn((function(){for(var r,n=t.reactions;r=n.get();)oo(r,t);t.notified=!1,e&&!t.rejection&&uo(t)})))},ao=function(t,e,r){var n,o;ro?((n=Xn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),O.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=O["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){var r=O.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},uo=function(t){jt(Un,O,(function(){var e,r=t.facade,n=t.value;if(so(t)&&(e=Tn((function(){ur?Jn.emit("unhandledRejection",n,r):ao("unhandledrejection",r,n)})),t.rejection=ur||so(t)?2:1,e.error))throw e.value}))},so=function(t){return 1!==t.rejection&&!t.parent},co=function(t){jt(Un,O,(function(){var e=t.facade;ur?Jn.emit("rejectionHandled",e):ao("rejectionhandled",e,t.value)}))},fo=function(t,e,r){return function(n){t(e,n,r)}},lo=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,io(t,!0))},ho=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Qn("Promise can\'t be resolved itself");var n=no(e);n?Sn((function(){var r={done:!1};try{jt(n,e,fo(ho,r,t),fo(lo,r,t))}catch(e){lo(r,e,t)}})):(t.value=e,t.state=1,io(t,!1))}catch(e){lo({done:!1},e,t)}}};if(Gn&&(Kn=($n=function(t){gr(this,Kn),Nt(t),jt(In,this);var e=qn(this);try{t(fo(ho,e),fo(lo,e))}catch(t){lo(e,t)}}).prototype,(In=function(t){Zn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new _n,rejection:!1,state:0,value:void 0})}).prototype=de(Kn,"then",(function(t,e){var r=qn(this),n=to(Rr(this,$n));return r.parent=!0,n.ok=!J(t)||t,n.fail=J(e)&&e,n.domain=ur?Jn.domain:void 0,0==r.state?r.reactions.add(n):Sn((function(){oo(n,r)})),n.promise})),jn=function(){var t=new In,e=qn(t);this.promise=t,this.resolve=fo(ho,e),this.reject=fo(lo,e)},Bn.f=to=function(t){return t===$n||void 0===t?new jn(t):eo(t)},J(Mn)&&Yn!==Object.prototype)){Pn=Yn.then,Vn||de(Yn,"then",(function(t,e){var r=this;return new $n((function(t,e){jt(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete Yn.constructor}catch(t){}fr&&fr(Yn,Kn)}ar({global:!0,constructor:!0,wrap:!0,forced:Gn},{Promise:$n}),pr($n,"Promise",!1),dr("Promise");var po={},vo=vt("iterator"),yo=Array.prototype,go=function(t){return void 0!==t&&(po.Array===t||yo[vo]===t)},mo=vt("iterator"),xo=function(t){if(!W(t))return Dt(t,mo)||Dt(t,"@@iterator")||po[xe(t)]},bo=TypeError,wo=function(t,e){var r=arguments.length<2?xo(t):e;if(Nt(r))return kt(jt(r,t));throw bo(Rt(t)+" is not iterable")},Eo=function(t,e,r){var n,o;kt(t);try{if(!(n=Dt(t,"return"))){if("throw"===e)throw r;return r}n=jt(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return kt(n),r},Ao=TypeError,Oo=function(t,e){this.stopped=t,this.result=e},So=Oo.prototype,To=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=zr(e,f),y=function(t){return n&&Eo(n,"normal",t),new Oo(!0,t)},g=function(t){return l?(kt(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Ao(Rt(t)+" is not iterable");if(go(o)){for(i=0,a=We(t);a>i;i++)if((u=g(t[i]))&&Pt(So,u))return u;return new Oo(!1)}n=wo(t,o)}for(s=h?t.next:n.next;!(c=jt(s,n)).done;){try{u=g(c.value)}catch(t){Eo(n,"throw",t)}if("object"==typeof u&&u&&Pt(So,u))return u}return new Oo(!1)},ko=vt("iterator"),Io=!1;try{var jo=0,Po={next:function(){return{done:!!jo++}},return:function(){Io=!0}};Po[ko]=function(){return this},Array.from(Po,(function(){throw 2}))}catch(t){}var _o=function(t,e){if(!e&&!Io)return!1;var r=!1;try{var n={};n[ko]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Mo=Fn.CONSTRUCTOR||!_o((function(t){Mn.all(t).then(void 0,(function(){}))}));ar({target:"Promise",stat:!0,forced:Mo},{all:function(t){var e=this,r=Bn.f(e),n=r.resolve,o=r.reject,i=Tn((function(){var r=Nt(e.resolve),i=[],a=0,u=1;To(t,(function(t){var s=a++,c=!1;u++,jt(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Lo=Fn.CONSTRUCTOR,Ro=Mn&&Mn.prototype;if(ar({target:"Promise",proto:!0,forced:Lo,real:!0},{catch:function(t){return this.then(void 0,t)}}),J(Mn)){var Co=et("Promise").prototype.catch;Ro.catch!==Co&&de(Ro,"catch",Co,{unsafe:!0})}ar({target:"Promise",stat:!0,forced:Mo},{race:function(t){var e=this,r=Bn.f(e),n=r.reject,o=Tn((function(){var o=Nt(e.resolve);To(t,(function(t){jt(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ar({target:"Promise",stat:!0,forced:Fn.CONSTRUCTOR},{reject:function(t){var e=Bn.f(this);return jt(e.reject,void 0,t),e.promise}});var No=Fn.CONSTRUCTOR;et("Promise");function Do(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ar({target:"Promise",stat:!0,forced:No},{resolve:function(t){return function(t,e){if(kt(t),xt(e)&&e.constructor===t)return e;var r=Bn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Fo="undefined"!=typeof window&&void 0!==window.orientation,Wo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),zo=new Map;function Bo(t){Do(t.source&&!t.url||!t.source&&t.url);var e=zo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Uo((e=t,"try {\\n  importScripts(\'"+e+"\');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),zo.set(t.url,e)),t.source&&(e=Uo(t.source),zo.set(t.source,e))),Do(e),e}function Uo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Go(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Go(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Vo=function(){},qo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Do(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Vo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Vo,this.onError=Vo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Go(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Bo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Zo=self&&self.__assign||function(){return(Zo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Yo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},$o=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ko=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Zo(Zo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),Yo(this,void 0,void 0,(function(){var n,o=this;return $o(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Yo(this,void 0,void 0,(function(){var t,e,r;return $o(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new Wo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new qo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Fo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Qo=self&&self.__assign||function(){return(Qo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Xo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ti=(function(){function t(t){this.workerPools=new Map,this.props=Qo({},Jo),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return qo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Xo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Qo(Qo({},this.props),t);try{for(var n=Xo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Ko({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ei=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ti.get(t);e||(e=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ti.get(t);ti.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Go(e);self.postMessage(r,n)}},t}();function ri(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ni,oi,ii=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ai=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},ui=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},si=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ci=0;function fi(t,e){var r=this;if("undefined"!=typeof self){var n={process:li};ei.onmessage=function(o,i){return ai(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return ui(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ei.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ni=new ii,oi=i.options||{},a=e(ni,oi,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=si(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ei.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ei.postMessage("done",{}),[3,18];case 16:return ni.push(i.input),[3,18];case 17:return ni.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ei.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function li(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ci++,i=function(t,e){if(e.id===o)switch(t){case"done":ei.removeEventListener(i),r(e.result);break;case"error":ei.removeEventListener(i),n(e.error)}};ei.addEventListener(i);var a={id:o,input:t,options:e};ei.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var hi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pi=Et("span").classList,vi=pi&&pi.constructor&&pi.constructor.prototype,di=vi===Object.prototype?void 0:vi,yi=Array.isArray||function(t){return"Array"==D(t)},gi=vt("species"),mi=Array,xi=function(t,e){return new(function(t){var e;return yi(t)&&(e=t.constructor,(Pr(e)&&(e===mi||yi(e.prototype))||xt(e)&&null===(e=e[gi]))&&(e=void 0)),void 0===e?mi:e}(t))(0===e?0:e)},bi=F([].push),wi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=G(s),d=Te(v),y=zr(c,f),g=We(d),m=0,x=l||xi,b=e?x(s,g):r||a?x(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)b[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:bi(b,h)}else switch(t){case 4:return!1;case 7:bi(b,h)}return i?-1:n||o?o:b}},Ei={forEach:wi(0),map:wi(1),filter:wi(2),some:wi(3),every:wi(4),find:wi(5),findIndex:wi(6),filterReject:wi(7)},Ai=function(t,e){var r=[][t];return!!r&&j((function(){r.call(null,e||function(){return 1},1)}))},Oi=Ei.forEach,Si=Ai("forEach")?[].forEach:function(t){return Oi(this,t,arguments.length>1?arguments[1]:void 0)},Ti=function(t){if(t&&t.forEach!==Si)try{ie(t,"forEach",Si)}catch(e){t.forEach=Si}};for(var ki in hi)hi[ki]&&Ti(O[ki]&&O[ki].prototype);Ti(di);var Ii=function(t,e,r){var n=Ut(e);n in t?qt.f(t,n,oe(0,r)):t[n]=r},ji=vt("species"),Pi=function(t){return ut>=51||!j((function(){var e=[];return(e.constructor={})[ji]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},_i=Pi("slice"),Mi=vt("species"),Li=Array,Ri=Math.max;ar({target:"Array",proto:!0,forced:!_i},{slice:function(t,e){var r,n,o,i=ke(this),a=We(i),u=Ne(t,a),s=Ne(void 0===e?a:e,a);if(yi(i)&&(r=i.constructor,(Pr(r)&&(r===Li||yi(r.prototype))||xt(r)&&null===(r=r[Mi]))&&(r=void 0),r===Li||void 0===r))return Ur(i,u,s);for(n=new(void 0===r?Li:r)(Ri(s-u,0)),o=0;u<s;u++,o++)u in i&&Ii(n,o,i[u]);return n.length=o,n}});var Ci=Kt.EXISTS,Ni=qt.f,Di=Function.prototype,Fi=F(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=F(Wi.exec);gt&&!Ci&&Ni(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi=Ei.map,Ui=Pi("map");ar({target:"Array",proto:!0,forced:!Ui},{map:function(t){return Bi(this,t,arguments.length>1?arguments[1]:void 0)}});var Gi,Hi=Object.keys||function(t){return He(t,Ve)},Vi={f:gt&&!Ot?Object.defineProperties:function(t,e){kt(t);for(var r,n=ke(e),o=Hi(e),i=o.length,a=0;i>a;)qt.f(t,r=o[a++],n[r]);return t}},qi=ue("IE_PROTO"),Zi=function(){},Yi=function(t){return"<script>"+t+"<\\/script>"},$i=function(t){t.write(Yi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ki=function(){try{Gi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Ki="undefined"!=typeof document?document.domain&&Gi?$i(Gi):((e=Et("iframe")).style.display="none",Br.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Yi("document.F=Object")),t.close(),t.F):$i(Gi);for(var r=Ve.length;r--;)delete Ki.prototype[Ve[r]];return Ki()};se[qi]=!0;var Qi=Object.create||function(t,e){var r;return null!==t?(Zi.prototype=kt(t),r=new Zi,Zi.prototype=null,r[qi]=t):r=Ki(),void 0===e?r:Vi.f(r,e)},Xi=qt.f,Ji=vt("unscopables"),ta=Array.prototype;null==ta[Ji]&&Xi(ta,Ji,{configurable:!0,value:Qi(null)});var ea,ra,na,oa=function(t){ta[Ji][t]=!0},ia=!j((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),aa=ue("IE_PROTO"),ua=Object,sa=ua.prototype,ca=ia?ua.getPrototypeOf:function(t){var e=G(t);if(V(e,aa))return e[aa];var r=e.constructor;return J(r)&&e instanceof r?r.prototype:e instanceof ua?sa:null},fa=vt("iterator"),la=!1;[].keys&&("next"in(na=[].keys())?(ra=ca(ca(na)))!==Object.prototype&&(ea=ra):la=!0),(!xt(ea)||j((function(){var t={};return ea[fa].call(t)!==t})))&&(ea={}),J(ea[fa])||de(ea,fa,(function(){return this}));var ha={IteratorPrototype:ea,BUGGY_SAFARI_ITERATORS:la},pa=ha.IteratorPrototype,va=function(){return this},da=Kt.PROPER,ya=Kt.CONFIGURABLE,ga=ha.IteratorPrototype,ma=ha.BUGGY_SAFARI_ITERATORS,xa=vt("iterator"),ba=function(){return this},wa=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Qi(pa,{next:oe(+!n,r)}),pr(t,o,!1),po[o]=va}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ma&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[xa]||p["@@iterator"]||o&&p[o],d=!ma&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ca(y.call(new t)))!==Object.prototype&&u.next&&(ca(u)!==ga&&(fr?fr(u,ga):J(u[xa])||de(u,xa,ba)),pr(u,l,!0)),da&&"values"==o&&v&&"values"!==v.name&&(ya?ie(p,"name","values"):(h=!0,d=function(){return jt(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ma||h||!(c in p))&&de(p,c,s[c]);else ar({target:e,proto:!0,forced:ma||h},s);return p[xa]!==d&&de(p,xa,d,{name:o}),po[e]=d,s},Ea=function(t,e){return{value:t,done:e}},Aa=qt.f,Oa=pe.set,Sa=pe.getterFor("Array Iterator"),Ta=wa(Array,"Array",(function(t,e){Oa(this,{type:"Array Iterator",target:ke(t),index:0,kind:e})}),(function(){var t=Sa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,Ea(void 0,!0)):Ea("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),ka=po.Arguments=po.Array;if(oa("keys"),oa("values"),oa("entries"),gt&&"values"!==ka.name)try{Aa(ka,"name",{value:"values"})}catch(t){}var Ia,ja,Pa,_a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ma=qt.f,La=pe.enforce,Ra=pe.get,Ca=O.Int8Array,Na=Ca&&Ca.prototype,Da=O.Uint8ClampedArray,Fa=Da&&Da.prototype,Wa=Ca&&ca(Ca),za=Na&&ca(Na),Ba=Object.prototype,Ua=O.TypeError,Ga=vt("toStringTag"),Ha=$("TYPED_ARRAY_TAG"),Va=_a&&!!fr&&"Opera"!==xe(O.opera),qa=!1,Za={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ya={BigInt64Array:8,BigUint64Array:8},$a=function(t){var e=ca(t);if(xt(e)){var r=Ra(e);return r&&V(r,"TypedArrayConstructor")?r.TypedArrayConstructor:$a(e)}},Ka=function(t){if(!xt(t))return!1;var e=xe(t);return V(Za,e)||V(Ya,e)};for(Ia in Za)(Pa=(ja=O[Ia])&&ja.prototype)?La(Pa).TypedArrayConstructor=ja:Va=!1;for(Ia in Ya)(Pa=(ja=O[Ia])&&ja.prototype)&&(La(Pa).TypedArrayConstructor=ja);if((!Va||!J(Wa)||Wa===Function.prototype)&&(Wa=function(){throw Ua("Incorrect invocation")},Va))for(Ia in Za)O[Ia]&&fr(O[Ia],Wa);if((!Va||!za||za===Ba)&&(za=Wa.prototype,Va))for(Ia in Za)O[Ia]&&fr(O[Ia].prototype,za);if(Va&&ca(Fa)!==za&&fr(Fa,za),gt&&!V(za,Ga))for(Ia in qa=!0,Ma(za,Ga,{get:function(){return xt(this)?this[Ha]:void 0}}),Za)O[Ia]&&ie(O[Ia],Ha,Ia);var Qa={NATIVE_ARRAY_BUFFER_VIEWS:Va,TYPED_ARRAY_TAG:qa&&Ha,aTypedArray:function(t){if(Ka(t))return t;throw Ua("Target is not a typed array")},aTypedArrayConstructor:function(t){if(J(t)&&(!fr||Pt(Wa,t)))return t;throw Ua(Rt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(gt){if(r)for(var o in Za){var i=O[o];if(i&&V(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}za[t]&&!r||de(za,t,r?e:Va&&Na[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(gt){if(fr){if(r)for(n in Za)if((o=O[n])&&V(o,t))try{delete o[t]}catch(t){}if(Wa[t]&&!r)return;try{return de(Wa,t,r?e:Va&&Wa[t]||e)}catch(t){}}for(n in Za)!(o=O[n])||o[t]&&!r||de(o,t,e)}},getTypedArrayConstructor:$a,isView:function(t){if(!xt(t))return!1;var e=xe(t);return"DataView"===e||V(Za,e)||V(Ya,e)},isTypedArray:Ka,TypedArray:Wa,TypedArrayPrototype:za},Xa=Qa.NATIVE_ARRAY_BUFFER_VIEWS,Ja=O.ArrayBuffer,tu=O.Int8Array,eu=!Xa||!j((function(){tu(1)}))||!j((function(){new tu(-1)}))||!_o((function(t){new tu,new tu(null),new tu(1.5),new tu(t)}),!0)||j((function(){return 1!==new tu(new Ja(2),1,void 0).length})),ru=function(t,e,r){for(var n in e)de(t,n,e[n],r);return t},nu=RangeError,ou=function(t){if(void 0===t)return 0;var e=Le(t),r=Fe(e);if(e!==r)throw nu("Wrong length or index");return r},iu=Array,au=Math.abs,uu=Math.pow,su=Math.floor,cu=Math.log,fu=Math.LN2,lu=function(t,e,r){var n,o,i,a=iu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?uu(2,-24)-uu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=au(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=su(cu(t)/fu),t*(i=uu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*uu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*uu(2,e),n+=c):(o=t*uu(2,c-1)*uu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},hu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=uu(2,e),f-=a}return(c?-1:1)*r*uu(2,f-e)},pu=function(t){for(var e=G(this),r=We(e),n=arguments.length,o=Ne(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ne(i,r);a>o;)e[o++]=t;return e},vu=Array,du=Math.max,yu=function(t,e,r){for(var n=We(t),o=Ne(e,n),i=Ne(void 0===r?n:r,n),a=vu(du(i-o,0)),u=0;o<i;o++,u++)Ii(a,u,t[o]);return a.length=u,a},gu=Ze.f,mu=qt.f,xu=Kt.PROPER,bu=Kt.CONFIGURABLE,wu=pe.get,Eu=pe.set,Au=O.ArrayBuffer,Ou=Au,Su=Ou&&Ou.prototype,Tu=O.DataView,ku=Tu&&Tu.prototype,Iu=Object.prototype,ju=O.Array,Pu=O.RangeError,_u=F(pu),Mu=F([].reverse),Lu=lu,Ru=hu,Cu=function(t){return[255&t]},Nu=function(t){return[255&t,t>>8&255]},Du=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Fu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Wu=function(t){return Lu(t,23,4)},zu=function(t){return Lu(t,52,8)},Bu=function(t,e){mu(t.prototype,e,{get:function(){return wu(this)[e]}})},Uu=function(t,e,r,n){var o=ou(r),i=wu(t);if(o+e>i.byteLength)throw Pu("Wrong index");var a=wu(i.buffer).bytes,u=o+i.byteOffset,s=yu(a,u,u+e);return n?s:Mu(s)},Gu=function(t,e,r,n,o,i){var a=ou(r),u=wu(t);if(a+e>u.byteLength)throw Pu("Wrong index");for(var s=wu(u.buffer).bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(_a){var Hu=xu&&"ArrayBuffer"!==Au.name;if(j((function(){Au(1)}))&&j((function(){new Au(-1)}))&&!j((function(){return new Au,new Au(1.5),new Au(NaN),1!=Au.length||Hu&&!bu})))Hu&&bu&&ie(Au,"name","ArrayBuffer");else{(Ou=function(t){return gr(this,Su),new Au(ou(t))}).prototype=Su;for(var Vu,qu=gu(Au),Zu=0;qu.length>Zu;)(Vu=qu[Zu++])in Ou||ie(Ou,Vu,Au[Vu]);Su.constructor=Ou}fr&&ca(ku)!==Iu&&fr(ku,Iu);var Yu=new Tu(new Ou(2)),$u=F(ku.setInt8);Yu.setInt8(0,2147483648),Yu.setInt8(1,2147483649),!Yu.getInt8(0)&&Yu.getInt8(1)||ru(ku,{setInt8:function(t,e){$u(this,t,e<<24>>24)},setUint8:function(t,e){$u(this,t,e<<24>>24)}},{unsafe:!0})}else Su=(Ou=function(t){gr(this,Su);var e=ou(t);Eu(this,{bytes:_u(ju(e),0),byteLength:e}),gt||(this.byteLength=e)}).prototype,ku=(Tu=function(t,e,r){gr(this,ku),gr(t,Su);var n=wu(t).byteLength,o=Le(e);if(o<0||o>n)throw Pu("Wrong offset");if(o+(r=void 0===r?n-o:Fe(r))>n)throw Pu("Wrong length");Eu(this,{buffer:t,byteLength:r,byteOffset:o}),gt||(this.buffer=t,this.byteLength=r,this.byteOffset=o)}).prototype,gt&&(Bu(Ou,"byteLength"),Bu(Tu,"buffer"),Bu(Tu,"byteLength"),Bu(Tu,"byteOffset")),ru(ku,{getInt8:function(t){return Uu(this,1,t)[0]<<24>>24},getUint8:function(t){return Uu(this,1,t)[0]},getInt16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Ru(Uu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Ru(Uu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Gu(this,1,t,Cu,e)},setUint8:function(t,e){Gu(this,1,t,Cu,e)},setInt16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Gu(this,4,t,Wu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Gu(this,8,t,zu,e,arguments.length>2?arguments[2]:void 0)}});pr(Ou,"ArrayBuffer"),pr(Tu,"DataView");var Ku={ArrayBuffer:Ou,DataView:Tu},Qu=Math.floor,Xu=Number.isInteger||function(t){return!xt(t)&&isFinite(t)&&Qu(t)===t},Ju=RangeError,ts=RangeError,es=function(t,e){var r=function(t){var e=Le(t);if(e<0)throw Ju("The argument can\'t be less than 0");return e}(t);if(r%e)throw ts("Wrong offset");return r},rs=F("".slice),ns=function(t){return"Big"===rs(xe(t),0,3)},os=TypeError,is=function(t){var e=Bt(t,"number");if("number"==typeof e)throw os("Can\'t convert number to bigint");return BigInt(e)},as=Qa.aTypedArrayConstructor,us=function(t){var e,r,n,o,i,a,u,s,c=Mr(this),f=G(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!go(v))for(s=(u=wo(f,v)).next,f=[];!(a=jt(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=zr(h,arguments[2])),r=We(f),n=new(as(c))(r),o=ns(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?is(i):+i;return n},ss=function(t,e,r){var n,o;return fr&&J(n=e.constructor)&&n!==r&&xt(o=n.prototype)&&o!==r.prototype&&fr(t,o),t},cs=b((function(t){var e=Ze.f,r=Ei.forEach,n=pe.get,o=pe.set,i=pe.enforce,a=qt.f,u=je.f,s=Math.round,c=O.RangeError,f=Ku.ArrayBuffer,l=f.prototype,h=Ku.DataView,p=Qa.NATIVE_ARRAY_BUFFER_VIEWS,v=Qa.TYPED_ARRAY_TAG,d=Qa.TypedArray,y=Qa.TypedArrayPrototype,g=Qa.aTypedArrayConstructor,m=Qa.isTypedArray,x=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},b=function(t,e){a(t,e,{get:function(){return n(this)[e]}})},w=function(t){var e;return Pt(l,t)||"ArrayBuffer"==(e=xe(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!Mt(e)&&e in t&&Xu(+e)&&e>=0},A=function(t,e){return e=Ut(e),E(t,e)?oe(2,t[e]):u(t,e)},S=function(t,e,r){return e=Ut(e),!(E(t,e)&&xt(r)&&V(r,"value"))||V(r,"get")||V(r,"set")||r.configurable||V(r,"writable")&&!r.writable||V(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};gt?(p||(je.f=A,qt.f=S,b(y,"buffer"),b(y,"byteOffset"),b(y,"byteLength"),b(y,"length")),ar({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:S}),t.exports=function(t,u,l){var g=t.match(/\\d+$/)[0]/8,b=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,S=O[b],T=S,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?eu&&(T=u((function(t,e,r,n){return gr(t,k),ss(xt(e)?w(e)?void 0!==n?new S(e,es(r,g),n):void 0!==r?new S(e,es(r,g)):new S(e):m(e)?x(T,e):jt(us,T,e):new S(ou(e)),t,T)})),fr&&fr(T,d),r(e(S),(function(t){t in T||ie(T,t,S[t])})),T.prototype=k):(T=u((function(t,e,r,n){gr(t,k);var i,a,u,s=0,l=0;if(xt(e)){if(!w(e))return m(e)?x(T,e):jt(us,T,e);i=e,l=es(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Fe(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=ou(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),fr&&fr(T,d),k=T.prototype=Qi(y)),k.constructor!==T&&ie(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&ie(k,v,b);var P=T!=S;I[b]=T,ar({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||ie(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||ie(k,"BYTES_PER_ELEMENT",g),dr(b)}):t.exports=function(){}}));cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var fs=TypeError,ls=function(t,e){if(!delete t[e])throw fs("Cannot delete property "+Rt(e)+" of "+Rt(t))},hs=Math.min,ps=F([].copyWithin||function(t,e){var r=G(this),n=We(r),o=Ne(t,n),i=Ne(e,n),a=arguments.length>2?arguments[2]:void 0,u=hs((void 0===a?n:Ne(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:ls(r,o),o+=s,i+=s;return r}),vs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("copyWithin",(function(t,e){return ps(vs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ds=Ei.every,ys=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("every",(function(t){return ds(ys(this),t,arguments.length>1?arguments[1]:void 0)}));var gs=Qa.aTypedArray,ms=Qa.exportTypedArrayMethod,xs=F("".slice);ms("fill",(function(t){var e=arguments.length;gs(this);var r="Big"===xs(xe(this),0,3)?is(t):+t;return jt(pu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),j((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var bs=Qa.aTypedArrayConstructor,ws=Qa.getTypedArrayConstructor,Es=function(t){return bs(Rr(t,ws(t)))},As=function(t,e){return function(t,e){for(var r=0,n=We(e),o=new t(n);n>r;)o[r]=e[r++];return o}(Es(t),e)},Os=Ei.filter,Ss=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("filter",(function(t){var e=Os(Ss(this),t,arguments.length>1?arguments[1]:void 0);return As(this,e)}));var Ts=Ei.find,ks=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("find",(function(t){return Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Ei.findIndex,js=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("findIndex",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Ei.forEach,_s=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("forEach",(function(t){Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=Be.includes,Ls=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("includes",(function(t){return Ms(Ls(this),t,arguments.length>1?arguments[1]:void 0)}));var Rs=Be.indexOf,Cs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("indexOf",(function(t){return Rs(Cs(this),t,arguments.length>1?arguments[1]:void 0)}));var Ns=vt("iterator"),Ds=O.Uint8Array,Fs=F(Ta.values),Ws=F(Ta.keys),zs=F(Ta.entries),Bs=Qa.aTypedArray,Us=Qa.exportTypedArrayMethod,Gs=Ds&&Ds.prototype,Hs=!j((function(){Gs[Ns].call([1])})),Vs=!!Gs&&Gs.values&&Gs[Ns]===Gs.values&&"values"===Gs.values.name,qs=function(){return Fs(Bs(this))};Us("entries",(function(){return zs(Bs(this))}),Hs),Us("keys",(function(){return Ws(Bs(this))}),Hs),Us("values",qs,Hs||!Vs,{name:"values"}),Us(Ns,qs,Hs||!Vs,{name:"values"});var Zs=Qa.aTypedArray,Ys=Qa.exportTypedArrayMethod,$s=F([].join);Ys("join",(function(t){return $s(Zs(this),t)}));var Ks=Math.min,Qs=[].lastIndexOf,Xs=!!Qs&&1/[1].lastIndexOf(1,-0)<0,Js=Ai("lastIndexOf"),tc=Xs||!Js?function(t){if(Xs)return Fr(Qs,this,arguments)||0;var e=ke(this),r=We(e),n=r-1;for(arguments.length>1&&(n=Ks(n,Le(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Qs,ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Fr(tc,ec(this),e>1?[t,arguments[1]]:[t])}));var rc=Ei.map,nc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("map",(function(t){return rc(nc(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Es(t))(e)}))}));var oc=TypeError,ic=function(t){return function(e,r,n,o){Nt(r);var i=G(e),a=Te(i),u=We(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw oc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},ac={left:ic(!1),right:ic(!0)},uc=ac.left,sc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return uc(sc(this),t,e,e>1?arguments[1]:void 0)}));var cc=ac.right,fc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return cc(fc(this),t,e,e>1?arguments[1]:void 0)}));var lc=Qa.aTypedArray,hc=Qa.exportTypedArrayMethod,pc=Math.floor;hc("reverse",(function(){for(var t,e=lc(this).length,r=pc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var vc=O.RangeError,dc=O.Int8Array,yc=dc&&dc.prototype,gc=yc&&yc.set,mc=Qa.aTypedArray,xc=Qa.exportTypedArrayMethod,bc=!j((function(){var t=new Uint8ClampedArray(2);return jt(gc,t,{length:1,0:3},1),3!==t[1]})),wc=bc&&Qa.NATIVE_ARRAY_BUFFER_VIEWS&&j((function(){var t=new dc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));xc("set",(function(t){mc(this);var e=es(arguments.length>1?arguments[1]:void 0,1),r=G(t);if(bc)return jt(gc,this,r,e);var n=this.length,o=We(r),i=0;if(o+e>n)throw vc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!bc||wc);var Ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Ur(Ec(this),t,e),n=Es(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),j((function(){new Int8Array(1).slice()})));var Ac=Ei.some,Oc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("some",(function(t){return Ac(Oc(this),t,arguments.length>1?arguments[1]:void 0)}));var Sc=Math.floor,Tc=function(t,e){var r=t.length,n=Sc(r/2);return r<8?kc(t,e):Ic(t,Tc(yu(t,0,n),e),Tc(yu(t,n),e),e)},kc=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ic=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},jc=Tc,Pc=rt.match(/firefox\\/(\\d+)/i),_c=!!Pc&&+Pc[1],Mc=/MSIE|Trident/.test(rt),Lc=rt.match(/AppleWebKit\\/(\\d+)\\./),Rc=!!Lc&&+Lc[1],Cc=Qa.aTypedArray,Nc=Qa.exportTypedArrayMethod,Dc=O.Uint16Array,Fc=Dc&&F(Dc.prototype.sort),Wc=!(!Fc||j((function(){Fc(new Dc(2),null)}))&&j((function(){Fc(new Dc(2),{})}))),zc=!!Fc&&!j((function(){if(ut)return ut<74;if(_c)return _c<67;if(Mc)return!0;if(Rc)return Rc<602;var t,e,r=new Dc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Fc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Nc("sort",(function(t){return void 0!==t&&Nt(t),zc?Fc(this,t):jc(Cc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!zc||Wc);var Bc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("subarray",(function(t,e){var r=Bc(this),n=r.length,o=Ne(t,n);return new(Es(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Fe((void 0===e?n:Ne(e,n))-o))}));var Uc=O.Int8Array,Gc=Qa.aTypedArray,Hc=Qa.exportTypedArrayMethod,Vc=[].toLocaleString,qc=!!Uc&&j((function(){Vc.call(new Uc(1))}));Hc("toLocaleString",(function(){return Fr(Vc,qc?Ur(Gc(this)):Gc(this),Ur(arguments))}),j((function(){return[1,2].toLocaleString()!=new Uc([1,2]).toLocaleString()}))||!j((function(){Uc.prototype.toLocaleString.call([1,2])})));var Zc=Qa.exportTypedArrayMethod,Yc=O.Uint8Array,$c=Yc&&Yc.prototype||{},Kc=[].toString,Qc=F([].join);j((function(){Kc.call({})}))&&(Kc=function(){return Qc(this)});var Xc=$c.toString!=Kc;Zc("toString",Kc,Xc);var Jc,tf,ef=String,rf=function(t){if("Symbol"===xe(t))throw TypeError("Cannot convert a Symbol value to a string");return ef(t)},nf=function(){var t=kt(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},of=O.RegExp,af=j((function(){var t=of("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),uf=af||j((function(){return!of("a","y").sticky})),sf={BROKEN_CARET:af||j((function(){var t=of("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:uf,UNSUPPORTED_Y:af},cf=O.RegExp,ff=j((function(){var t=cf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),lf=O.RegExp,hf=j((function(){var t=lf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),pf=pe.get,vf=I("native-string-replace",String.prototype.replace),df=RegExp.prototype.exec,yf=df,gf=F("".charAt),mf=F("".indexOf),xf=F("".replace),bf=F("".slice),wf=(tf=/b*/g,jt(df,Jc=/a/,"a"),jt(df,tf,"a"),0!==Jc.lastIndex||0!==tf.lastIndex),Ef=sf.BROKEN_CARET,Af=void 0!==/()??/.exec("")[1];(wf||Af||Ef||ff||hf)&&(yf=function(t){var e,r,n,o,i,a,u,s=this,c=pf(s),f=rf(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=jt(yf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=Ef&&s.sticky,v=jt(nf,s),d=s.source,y=0,g=f;if(p&&(v=xf(v,"y",""),-1===mf(v,"g")&&(v+="g"),g=bf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==gf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),Af&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),wf&&(n=s.lastIndex),o=jt(df,p?r:s,g),p?o?(o.input=bf(o.input,y),o[0]=bf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:wf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),Af&&o&&o.length>1&&jt(vf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Qi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var Of=yf;ar({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Sf,Tf=vt("species"),kf=RegExp.prototype,If=function(t,e,r,n){var o=vt(t),i=!j((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!j((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Tf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=F(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=F(t),s=e.exec;return s===Of||s===kf.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));de(String.prototype,t,s[0]),de(kf,o,s[1])}n&&ie(kf[o],"sham",!0)},jf=F("".charAt),Pf=F("".charCodeAt),_f=F("".slice),Mf=function(t){return function(e,r){var n,o,i=rf(B(e)),a=Le(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Pf(i,a))<55296||n>56319||a+1===u||(o=Pf(i,a+1))<56320||o>57343?t?jf(i,a):n:t?_f(i,a,a+2):o-56320+(n-55296<<10)+65536}},Lf={codeAt:Mf(!1),charAt:Mf(!0)},Rf=Lf.charAt,Cf=function(t,e,r){return e+(r?Rf(t,e).length:1)},Nf=Math.floor,Df=F("".charAt),Ff=F("".replace),Wf=F("".slice),zf=/\\$([$&\'`]|\\d{1,2}|<[^>]*>)/g,Bf=/\\$([$&\'`]|\\d{1,2})/g,Uf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Bf;return void 0!==o&&(o=G(o),s=zf),Ff(i,s,(function(i,s){var c;switch(Df(s,0)){case"$":return"$";case"&":return t;case"`":return Wf(e,0,r);case"\'":return Wf(e,a);case"<":c=o[Wf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Nf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Df(s,1):n[l-1]+Df(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Gf=TypeError,Hf=function(t,e){var r=t.exec;if(J(r)){var n=jt(r,t,e);return null!==n&&kt(n),n}if("RegExp"===D(t))return jt(Of,t,e);throw Gf("RegExp#exec called on incompatible receiver")},Vf=vt("replace"),qf=Math.max,Zf=Math.min,Yf=F([].concat),$f=F([].push),Kf=F("".indexOf),Qf=F("".slice),Xf="$0"==="a".replace(/./,"$0"),Jf=!!/./[Vf]&&""===/./[Vf]("a","$0");function tl(t){this.message=t}If("replace",(function(t,e,r){var n=Jf?"$":"$0";return[function(t,r){var n=B(this),o=W(t)?void 0:Dt(t,Vf);return o?jt(o,t,n,r):jt(e,rf(n),t,r)},function(t,o){var i=kt(this),a=rf(t);if("string"==typeof o&&-1===Kf(o,n)&&-1===Kf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=J(o);s||(o=rf(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Hf(i,a);if(null===h)break;if($f(l,h),!c)break;""===rf(h[0])&&(i.lastIndex=Cf(a,Fe(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=rf((h=l[y])[0]),m=qf(Zf(Le(h.index),a.length),0),x=[],b=1;b<h.length;b++)$f(x,void 0===(p=h[b])?p:String(p));var w=h.groups;if(s){var E=Yf([g],x,m,a);void 0!==w&&$f(E,w);var A=rf(Fr(o,void 0,E))}else A=Uf(g,a,m,x,w,o);m>=d&&(v+=Qf(a,d,m)+A,d=m+g.length)}return v+Qf(a,d)}]}),!!j((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Xf||Jf),tl.prototype=new Error,tl.prototype.name="InvalidCharacterError",ar({global:!0,forced:O.globalThis!==O},{globalThis:O}),Sf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:Sf.devicePixelRatio;var el=TypeError,rl=Object.getOwnPropertyDescriptor,nl=gt&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(yi(t)&&!rl(t,"length").writable)throw el("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},ol=TypeError,il=function(t){if(t>9007199254740991)throw ol("Maximum allowed index exceeded");return t},al=Pi("splice"),ul=Math.max,sl=Math.min;ar({target:"Array",proto:!0,forced:!al},{splice:function(t,e){var r,n,o,i,a,u,s=G(this),c=We(s),f=Ne(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=sl(ul(Le(e),0),c-f)),il(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&Ii(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:ls(s,u);for(i=c;i>c-n+r;i--)ls(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:ls(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return nl(s,c-n+r),o}});var cl=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),fl=Object.assign,ll=Object.defineProperty,hl=F([].concat),pl=!fl||j((function(){if(gt&&1!==fl({b:1},fl(ll({},"a",{enumerable:!0,get:function(){ll(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=fl({},t)[r]||"abcdefghijklmnopqrst"!=Hi(fl({},e)).join("")}))?function(t,e){for(var r=G(t),n=arguments.length,o=1,i=Ye.f,a=Ae.f;n>o;)for(var u,s=Te(arguments[o++]),c=i?hl(Hi(s),i(s)):Hi(s),f=c.length,l=0;f>l;)u=c[l++],gt&&!jt(a,s,u)||(r[u]=s[u]);return r}:fl;ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==pl},{assign:pl});var vl=Ei.findIndex,dl=!0;"findIndex"in[]&&Array(1).findIndex((function(){dl=!1})),ar({target:"Array",proto:!0,forced:dl},{findIndex:function(t){return vl(this,t,arguments.length>1?arguments[1]:void 0)}}),oa("findIndex");var yl=Lf.charAt,gl=pe.set,ml=pe.getterFor("String Iterator");wa(String,"String",(function(t){gl(this,{type:"String Iterator",string:rf(t),index:0})}),(function(){var t,e=ml(this),r=e.string,n=e.index;return n>=r.length?Ea(void 0,!0):(t=yl(r,n),e.index+=t.length,Ea(t,!1))}));var xl=Ze.f,bl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],wl={f:function(t){return bl&&"Window"==D(t)?function(t){try{return xl(t)}catch(t){return yu(bl)}}(t):xl(ke(t))}},El=j((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Al=Object.isExtensible,Ol=j((function(){Al(1)}))||El?function(t){return!!xt(t)&&((!El||"ArrayBuffer"!=D(t))&&(!Al||Al(t)))}:Al,Sl=!j((function(){return Object.isExtensible(Object.preventExtensions({}))})),Tl=b((function(t){var e=qt.f,r=!1,n=$("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=Ze.f,e=F([].splice),o={};o[n]=1,t(o).length&&(Ze.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ar({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:wl.f}))},fastKey:function(t,e){if(!xt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!V(t,n)){if(!Ol(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!V(t,n)){if(!Ol(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return Sl&&r&&Ol(t)&&!V(t,n)&&i(t),t}};se[n]=!0})),kl=(Tl.enable,Tl.fastKey,Tl.getWeakData,Tl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=O[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=F(u[t]);de(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!xt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!xt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!xt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(or(t,!J(a)||!(o||u.forEach&&!j((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),Tl.enable();else if(or(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=j((function(){l.has(1)})),v=_o((function(t){new a(t)})),d=!o&&j((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){gr(t,u);var r=ss(new a,t,s);return W(e)||To(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ar({global:!0,constructor:!0,forced:s!=a},c),pr(s,t),o||r.setStrong(s,t,n),s}),Il=Tl.getWeakData,jl=pe.set,Pl=pe.getterFor,_l=Ei.find,Ml=Ei.findIndex,Ll=F([].splice),Rl=0,Cl=function(t){return t.frozen||(t.frozen=new Nl)},Nl=function(){this.entries=[]},Dl=function(t,e){return _l(t.entries,(function(t){return t[0]===e}))};Nl.prototype={get:function(t){var e=Dl(this,t);if(e)return e[1]},has:function(t){return!!Dl(this,t)},set:function(t,e){var r=Dl(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Ml(this.entries,(function(e){return e[0]===t}));return~e&&Ll(this.entries,e,1),!!~e}};var Fl,Wl={getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),jl(t,{type:e,id:Rl++,frozen:void 0}),W(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Pl(e),u=function(t,e,r){var n=a(t),o=Il(kt(e),!0);return!0===o?Cl(n).set(e,r):o[n.id]=r,t};return ru(i,{delete:function(t){var e=a(this);if(!xt(t))return!1;var r=Il(t);return!0===r?Cl(e).delete(t):r&&V(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!xt(t))return!1;var r=Il(t);return!0===r?Cl(e).has(t):r&&V(r,e.id)}}),ru(i,r?{get:function(t){var e=a(this);if(xt(t)){var r=Il(t);return!0===r?Cl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},zl=pe.enforce,Bl=!O.ActiveXObject&&"ActiveXObject"in O,Ul=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Gl=kl("WeakMap",Ul,Wl);if(ne&&Bl){Fl=Wl.getConstructor(Ul,"WeakMap",!0),Tl.enable();var Hl=Gl.prototype,Vl=F(Hl.delete),ql=F(Hl.has),Zl=F(Hl.get),Yl=F(Hl.set);ru(Hl,{delete:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),Vl(this,t)||e.frozen.delete(t)}return Vl(this,t)},has:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)||e.frozen.has(t)}return ql(this,t)},get:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)?Zl(this,t):e.frozen.get(t)}return Zl(this,t)},set:function(t,e){if(xt(t)&&!Ol(t)){var r=zl(this);r.frozen||(r.frozen=new Fl),ql(this,t)?Yl(this,t,e):r.frozen.set(t,e)}else Yl(this,t,e);return this}})}var $l=vt("iterator"),Kl=vt("toStringTag"),Ql=Ta.values,Xl=function(t,e){if(t){if(t[$l]!==Ql)try{ie(t,$l,Ql)}catch(e){t[$l]=Ql}if(t[Kl]||ie(t,Kl,e),hi[e])for(var r in Ta)if(t[r]!==Ta[r])try{ie(t,r,Ta[r])}catch(e){t[r]=Ta[r]}}};for(var Jl in hi)Xl(O[Jl]&&O[Jl].prototype,Jl);Xl(di,"DOMTokenList");var th,eh,rh,nh,oh=new WeakMap,ih=function(){function t(){i(this,t),oh.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=oh.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),oh.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=oh.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=oh.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),ah=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(ih));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var uh=my.getSystemInfoSync();th=uh.screenWidth,eh=uh.screenHeight,rh=uh.windowWidth,nh=uh.windowHeight}else{var sh=Sf.innerWidth,ch=Sf.innerHeight;th=sh,eh=ch,rh=sh,nh=ch}var fh={width:th,height:eh,availWidth:rh,availHeight:nh,availLeft:0,availTop:0},lh=fh.availWidth,hh=fh.availHeight,ph={style:[]};function vh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function dh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:lh+"px",height:hh+"px",margin:"0px",padding:"0px"})}function yh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=lh,t.clientHeight=hh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function gh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=lh,t.offsetHeight=hh)}function mh(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=lh,t.scrollHeight=hh)}function xh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function bh(){}var wh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=bh,t.blur=bh,t.insertBefore=bh,t.appendChild=bh,t.removeChild=bh,t.remove=bh,t.innerHTML="",t.tagName=n.toUpperCase(),vh(h(t),o),dh(h(t)),xh(h(t)),yh(h(t)),gh(h(t)),mh(h(t)),t}return u(r)}(ah),Eh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wh)),Ah={};function Oh(){return Ah}var Sh=u((function t(){i(this,t);var e=Oh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),vh(r),xh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),Th={href:"",protocol:"",host:""},kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),Ih=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),jh={},Ph={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Th,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Sh:"video"===t?new Eh:new wh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){jh[t]||(jh[t]=[]),jh[t].push(e)},removeEventListener:function(t,e){var r=jh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=jh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new cl(t)}};Ph.documentElement=new Ih,Ph.head=new wh("head"),Ph.body=new kh,If("match",(function(t,e,r){return[function(e){var r=B(this),n=W(e)?void 0:Dt(e,t);return n?jt(n,e,r):new RegExp(e)[t](rf(r))},function(t){var n=kt(this),o=rf(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Hf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Hf(n,o));){var f=rf(u[0]);s[c]=f,""===f&&(n.lastIndex=Cf(o,Fe(n.lastIndex),a)),c++}return 0===c?null:s}]}));var _h,Mh,Lh=vt("isConcatSpreadable"),Rh=ut>=51||!j((function(){var t=[];return t[Lh]=!1,t.concat()[0]!==t})),Ch=Pi("concat"),Nh=function(t){if(!xt(t))return!1;var e=t[Lh];return void 0!==e?!!e:yi(t)};if(ar({target:"Array",proto:!0,arity:1,forced:!Rh||!Ch},{concat:function(t){var e,r,n,o,i,a=G(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(Nh(i=-1===e?a:arguments[e]))for(o=We(i),il(s+o),r=0;r<o;r++,s++)r in i&&Ii(u,s,i[r]);else il(s+1),Ii(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Dh=my.getSystemInfoSync();_h=Dh.system,Dh.platform,Dh.language}else{var Fh={versions:(Mh=Sf.navigator.userAgent,{trident:Mh.indexOf("Trident")>-1,presto:Mh.indexOf("Presto")>-1,webKit:Mh.indexOf("AppleWebKit")>-1,gecko:Mh.indexOf("Gecko")>-1&&-1===Mh.indexOf("KHTML"),mobile:!!Mh.match(/AppleWebKit.*Mobile.*/),ios:!!Mh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Mh.indexOf("Android")>-1||Mh.indexOf("Linux")>-1,iPhone:Mh.indexOf("iPhone")>-1,iPad:Mh.indexOf("iPad")>-1,webApp:-1===Mh.indexOf("Safari"),weixin:Mh.indexOf("MicroMessenger")>-1,qq:" qq"===Mh.match(/\\sQQ/i)}),language:(Sf.navigator.browserLanguage||Sf.navigator.language).toLowerCase()};Fh.versions.android?"android":Fh.versions.trident?"IE":Fh.versions.presto?"Opera":Fh.versions.webKit?"webKit":Fh.versions.gecko?"Firefox":Fh.versions.mobile?"mobile":Fh.versions.ios?"ios":Fh.versions.iPhone?"iPhone":Fh.versions.iPad?"ipad":Fh.versions.webApp?"webApp":Fh.versions.weixin?"weixin":Fh.versions.qq&&"qq",_h=Sf.navigator.userAgent,Fh.language}_h.toLowerCase().indexOf("android");cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Wh=qt.f,zh=Tl.fastKey,Bh=pe.set,Uh=pe.getterFor;kl("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),Bh(t,{type:e,index:Qi(null),first:void 0,last:void 0,size:0}),gt||(t.size=0),W(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Uh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=zh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),gt?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=zh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return ru(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,gt?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),gt?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=zr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),ru(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),gt&&Wh(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Uh(e),i=Uh(n);wa(t,e,(function(t,e){Bh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?Ea("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,Ea(void 0,!0))}),r?"entries":"values",!r,!0),dr(e)}});var Gh=F([].join),Hh=Te!=Object,Vh=Ai("join",",");ar({target:"Array",proto:!0,forced:Hh||!Vh},{join:function(t){return Gh(ke(this),void 0===t?",":t)}});var qh=j((function(){Hi(1)}));ar({target:"Object",stat:!0,forced:qh},{keys:function(t){return Hi(G(t))}});var Zh=new Map,Yh=new Map,$h=new Map,Kh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Zh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=$h.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Yh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Yh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Zh.get("requestHeader");r[t]=e,Zh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(ih);s(Kh,"UNSEND",void 0),s(Kh,"OPENED",void 0),s(Kh,"HEADERS_RECEIVED",void 0),s(Kh,"LOADING",void 0),s(Kh,"DONE",void 0),Kh.UNSEND=0,Kh.OPENED=1,Kh.HEADERS_RECEIVED=2,Kh.LOADING=3,Kh.DONE=4;var Qh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Xh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Jh=Qh||Xh;Jh||Sf.XMLHttpRequest,Jh||Sf.location;function tp(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ep=Ei.filter,rp=Pi("filter");function np(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function op(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function ip(t){return t.filter?[1]:[0]}function ap(t,e){return[e]}ar({target:"Array",proto:!0,forced:!rp},{filter:function(t){return ep(this,t,arguments.length>1?arguments[1]:void 0)}});var up=cp,sp=cp;function cp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=fp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=fp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(wp(s));for(c.sort(gp),o=0;o<c.length;o++)r=mp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return hp(h,p,r,n,o,c,0),p}function fp(t,e,r,n,o){var i,a;if(o===Rp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=_p(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=_p(i,t[i],t[i+1],a);return a&&Sp(a,a.next)&&(Mp(a),a=a.next),a}function lp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Sp(n,n.next)&&0!==Op(n.prev,n,n.next))n=n.next;else{if(Mp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function hp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=bp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?vp(t,n,o,i):pp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Mp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?hp(t=dp(lp(t),e,r),e,r,n,o,i,2):2===a&&yp(t,e,r,n,o,i):hp(lp(t),e,r,n,o,i,1);break}}}function pp(t){var e=t.prev,r=t,n=t.next;if(Op(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&Ep(o,u,i,s,a,c,v.x,v.y)&&Op(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function vp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(Op(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=bp(p,v,e,r,n),m=bp(d,y,e,r,n),x=t.prevZ,b=t.nextZ;x&&x.z>=g&&b&&b.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function dp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Sp(o,i)&&Tp(o,n,n.next,i)&&jp(o,i)&&jp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Mp(n),Mp(n.next),n=t=i),n=n.next}while(n!==t);return lp(n)}function yp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ap(a,u)){var s=Pp(a,u);return a=lp(a,a.next),s=lp(s,s.next),hp(a,e,r,n,o,i,0),void hp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function gp(t,e){return t.x-e.x}function mp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&Ep(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),jp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&xp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Pp(r,t);return lp(n,n.next),lp(r,r.next)}function xp(t,e){return Op(t.prev,t,e.prev)<0&&Op(e.next,t,t.next)<0}function bp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ep(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ap(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Tp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(jp(t,e)&&jp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Op(t.prev,t,e.prev)||Op(t,e.prev,e))||Sp(t,e)&&Op(t.prev,t,t.next)>0&&Op(e.prev,e,e.next)>0)}function Op(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Sp(t,e){return t.x===e.x&&t.y===e.y}function Tp(t,e,r,n){var o=Ip(Op(t,e,r)),i=Ip(Op(t,e,n)),a=Ip(Op(r,n,t)),u=Ip(Op(r,n,e));return o!==i&&a!==u||(!(0!==o||!kp(t,r,e))||(!(0!==i||!kp(t,n,e))||(!(0!==a||!kp(r,t,n))||!(0!==u||!kp(r,e,n)))))}function kp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ip(t){return t>0?1:t<0?-1:0}function jp(t,e){return Op(t.prev,t,t.next)<0?Op(t,e,t.next)>=0&&Op(t,t.prev,e)>=0:Op(t,e,t.prev)<0||Op(t,t.next,e)<0}function Pp(t,e){var r=new Lp(t.i,t.x,t.y),n=new Lp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function _p(t,e,r,n){var o=new Lp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Mp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}cp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Rp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Rp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},cp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},up.default=sp;var Cp=F(1..valueOf),Np=F("".replace),Dp="[\\t\\n\\v\\f\\r                　\\u2028\\u2029\\ufeff]",Fp=RegExp("^"+Dp+Dp+"*"),Wp=RegExp(Dp+Dp+"*$"),zp=function(t){return function(e){var r=rf(B(e));return 1&t&&(r=Np(r,Fp,"")),2&t&&(r=Np(r,Wp,"")),r}},Bp={start:zp(1),end:zp(2),trim:zp(3)},Up=Ze.f,Gp=je.f,Hp=qt.f,Vp=Bp.trim,qp=O.Number,Zp=qp.prototype,Yp=O.TypeError,$p=F("".slice),Kp=F("".charCodeAt),Qp=function(t){var e=Bt(t,"number");return"bigint"==typeof e?e:Xp(e)},Xp=function(t){var e,r,n,o,i,a,u,s,c=Bt(t,"number");if(Mt(c))throw Yp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Vp(c),43===(e=Kp(c,0))||45===e){if(88===(r=Kp(c,2))||120===r)return NaN}else if(48===e){switch(Kp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=$p(c,2)).length,u=0;u<a;u++)if((s=Kp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c};if(or("Number",!qp(" 0o1")||!qp("0b1")||qp("+0x1"))){for(var Jp,tv=function(t){var e=arguments.length<1?0:qp(Qp(t)),r=this;return Pt(Zp,r)&&j((function(){Cp(r)}))?ss(Object(e),r,tv):e},ev=gt?Up(qp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),rv=0;ev.length>rv;rv++)V(qp,Jp=ev[rv])&&!V(tv,Jp)&&Hp(tv,Jp,Gp(qp,Jp));tv.prototype=Zp,Zp.constructor=tv,de(O,"Number",tv,{constructor:!0})}var nv=RangeError,ov=RangeError,iv=String,av=Math.floor,uv=F((function(t){var e=rf(B(this)),r="",n=Le(t);if(n<0||n==1/0)throw nv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),sv=F("".slice),cv=F(1..toFixed),fv=function(t,e,r){return 0===e?r:e%2==1?fv(t,e-1,r*t):fv(t*t,e/2,r)},lv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=av(o/1e7)},hv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=av(n/e),n=n%e*1e7},pv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=iv(t[e]);r=""===r?n:r+uv("0",7-n.length)+n}return r},vv=j((function(){return"0.000"!==cv(8e-5,3)||"1"!==cv(.9,0)||"1.25"!==cv(1.255,2)||"1000000000000000128"!==cv(0xde0b6b3a7640080,0)}))||!j((function(){cv({})}));function dv(t){return"number"==typeof t}function yv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ar({target:"Number",proto:!0,forced:vv},{toFixed:function(t){var e,r,n,o,i=Cp(this),a=Le(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw ov("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return iv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*fv(2,69,1))-69)<0?i*fv(2,-e,1):i/fv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(lv(u,0,r),n=a;n>=7;)lv(u,1e7,0),n-=7;for(lv(u,fv(10,n,1),0),n=e-1;n>=23;)hv(u,1<<23),n-=23;hv(u,1<<n),lv(u,1,1),hv(u,2),c=pv(u)}else lv(u,0,r),lv(u,1<<-e,0),c=pv(u)+uv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+uv("0",a-o)+c:sv(c,0,o-a)+"."+sv(c,o-a)):s+c}});var gv,mv=/"/g,xv=F("".replace);ar({target:"String",proto:!0,forced:(gv="sub",j((function(){var t=""[gv](\'"\');return t!==t.toLowerCase()||t.split(\'"\').length>3})))},{sub:function(){return t="sub",e="",r="",n=rf(B(this)),o="<"+t,""!==e&&(o+=" "+e+\'="\'+xv(rf(r),mv,"&quot;")+\'"\'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var bv=RegExp.prototype,wv=Kt.PROPER,Ev=RegExp.prototype.toString,Av=j((function(){return"/a/b"!=Ev.call({source:"a",flags:"b"})})),Ov=wv&&"toString"!=Ev.name;(Av||Ov)&&de(RegExp.prototype,"toString",(function(){var t=kt(this);return"/"+rf(t.source)+"/"+rf(function(t){var e=t.flags;return void 0!==e||"flags"in bv||V(t,"flags")||!Pt(bv,t)?e:jt(nf,t)}(t))}),{unsafe:!0});var Sv="undefined"!=typeof Float32Array?Float32Array:Array;function Tv(){var t=new Sv(2);return Sv!=Float32Array&&(t[0]=0,t[1]=0),t}function kv(t,e){var r=new Sv(2);return r[0]=t,r[1]=e,r}function Iv(t,e){return t[0]=e[0],t[1]=e[1],t}function jv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Pv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _v(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Mv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Lv,Rv=Pv,Cv=(Lv=Tv(),Tv()),Nv=(Tv(),Tv()),Dv=Tv(),Fv=Tv();function Wv(t,e,r,n,o){return jv(t,r,n),_v(t,t),[o/Mv(e=kv(-t[1],t[0]),kv(-r[1],r[0])),e]}function zv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Bv(t,e,r){return Rv(t,e,r),_v(t,t),t}function Uv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Gv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",kv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=yv([a[0],a[1]]),g=yv([i[0],i[1]]);Bv(Nv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,h){var x=Tv(),b=Tv();jv(x,this.normal,Nv),jv(b,this.normal,Nv),l.push(b[0],b[1],0),l.push(x[0],x[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Uv(n,o)&&jv(o,n,_v(o,Pv(o,n,r))),Bv(Dv,o,n);var w=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),E=w[0],A=w[1],O=Mv(Fv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Iv(this.normal,A),s+=2),this.lastFlip=O}else{if(zv(this.normal,Nv),h){var T=Tv(),k=Tv();Rv(k,Nv,this.normal),jv(T,Nv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=yv([n[0],n[1]]),f=yv([r[0],r[1]]);Bv(Nv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=yv([o[0],o[1]]);Uv(c,h)&&jv(h,c,_v(h,Pv(h,c,f))),Bv(Dv,h,c);var p=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),v=p[0],g=p[1];Mv(Fv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Iv(this.normal,g),i+=2,this.lastFlip=-1}else zv(this.normal,Nv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=yv([n[0],n[1]]),h=yv([r[0],r[1]]);Bv(Nv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,c){var v=Tv(),g=Tv();jv(v,this.normal,Nv),jv(g,this.normal,Nv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=yv([o[0],o[1]]);Uv(l,m)&&jv(m,l,_v(m,Pv(m,l,h))),Bv(Dv,m,l);var x=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),b=x[0],w=x[1],E=Mv(Fv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,b,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Iv(this.normal,w),i+=2),this.lastFlip=E}else{if(zv(this.normal,Nv),c){var O=Tv(),S=Tv();Rv(S,Nv,this.normal),jv(O,Nv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Hv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Gv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Vv(t){var e=function(t){if(dv(t[0]))return t;if(dv(t[0][0]))throw new Error("当前数据不支持标注");if(dv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("当前数据不支持标注")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function qv(t){var e=t.coordinates,r=up.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:up(n,i,o),vertices:n,size:o}}var Zv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Hv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Yv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Vv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Zv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$v=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Yv);function Kv(t){return Qv.apply(this,arguments)}function Qv(){return(Qv=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!$v[n]){t.next=3;break}return t.abrupt("return",$v[n](o));case 3:return t.abrupt("return",Promise.reject(new Error(\'Worker with type "\'.concat(n,\'" non-existent.\'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return fi(Kv),t.WorkerSourceMap=Yv,t.createWorker=fi,t.worker=Kv,t}({});\n');var Zr,Vr;function Gr(t){switch(t){case"GAODE1.x":case"GAODE2.x":case"GLOBEL":return 1029;default:return 1028}}function Hr(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function Wr(t){var e=[],n=/\{([a-z])-([a-z])\}/.exec(t);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)e.push(t.replace(n[0],String.fromCharCode(r)));return e}if(n=/\{(\d+)-(\d+)\}/.exec(t)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)e.push(t.replace(n[0],s.toString()));return e}return e.push(t),e}function qr(t,e){if(!t||!t.length)throw new Error("url is not allowed to be empty");var n=e.x,r=e.y,i=e.z,o=Wr(t);return o[Math.abs(n+r)%o.length].replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}!function(t){t.Realtime="realtime",t.Overlap="overlap",t.Replace="replace"}(Zr||(Zr={})),function(t){t.Loading="Loading",t.Loaded="Loaded",t.Failure="Failure",t.Cancelled="Cancelled"}(Vr||(Vr={}));var Xr,Yr=n(5203),Kr=n(1883),Qr=n.n(Kr);function Jr(t){for(;t;){if(t.isLoaded)return t.properties.state|=2,!0;t=t.parent}return!1}function $r(t){t.children.forEach((function(t){t.isLoaded?t.properties.state|=2:$r(t)}))}var ti=[-1/0,-1/0,1/0,1/0],ei=(Xr={},(0,Cn.Z)(Xr,Zr.Realtime,(function(t){t.forEach((function(t){t.isCurrent&&(t.isVisible=t.isLoaded)}))})),(0,Cn.Z)(Xr,Zr.Overlap,(function(t){t.forEach((function(t){t.properties.state=0})),t.forEach((function(t){t.isCurrent&&!Jr(t)&&$r(t)})),t.forEach((function(t){t.isVisible=Boolean(2&t.properties.state)}))})),(0,Cn.Z)(Xr,Zr.Replace,(function(t){t.forEach((function(t){t.properties.state=0})),t.forEach((function(t){t.isCurrent&&Jr(t)})),t.slice().sort((function(t,e){return t.z-e.z})).forEach((function(t){t.isVisible=Boolean(2&t.properties.state),t.children.length&&(t.isVisible||1&t.properties.state)?t.children.forEach((function(t){t.properties.state=1})):t.isCurrent&&$r(t)}))})),Xr),ni=function(){};function ri(t,e,n){return[Math.floor((t+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}function ii(t,e,n){var r=t/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*e/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var oi=function(t,e,n){var r=ii(t,e,n),i=(0,u.Z)(r,2),o=i[0],a=i[1],s=ii(t+1,e+1,n),l=(0,u.Z)(s,2),c=l[0];return[o,l[1],c,a]};function ai(t){var e=t.zoom,n=t.latLonBounds,r=t.maxZoom,i=void 0===r?1/0:r,o=t.minZoom,a=void 0===o?0:o,s=t.zoomOffset,l=void 0===s?0:s,c=t.extent,h=void 0===c?ti:c,p=Math.ceil(e)+l;if(Number.isFinite(a)&&p<a)return[];Number.isFinite(i)&&p>i&&(p=i);for(var f=(0,u.Z)(n,4),d=f[0],m=f[1],g=f[2],y=f[3],v=[Math.max(d,h[0]),Math.max(m,h[1]),Math.min(g,h[2]),Math.min(y,h[3])],_=[],x=ri(v[0],v[1],p),b=(0,u.Z)(x,2),w=b[0],S=b[1],E=ri(v[2],v[3],p),C=(0,u.Z)(E,2),M=C[0],T=C[1],A=w;A<=M;A++)for(var P=T;P<=S;P++)_.push({x:A,y:P,z:p});var L=(M+w)/2,I=(S+T)/2,k=function(t,e){return Math.abs(t-L)+Math.abs(e-I)};return _.sort((function(t,e){return k(t.x,t.y)-k(e.x,e.y)})),_}var si=function(t,e,n){var r=Math.pow(2,n),i=t;return i<0?i+=r:i>r-1&&(i%=r),{warpX:i,warpY:e}};var ui=function(t){(0,_.Z)(o,t);var e,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,b.Z)(n);if(r){var i=(0,b.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,x.Z)(this,t)});function o(t){var e;(0,m.Z)(this,o),e=i.call(this),(0,Cn.Z)((0,S.Z)(e),"tileSize",256),(0,Cn.Z)((0,S.Z)(e),"isVisible",!1),(0,Cn.Z)((0,S.Z)(e),"isCurrent",!1),(0,Cn.Z)((0,S.Z)(e),"isVisibleChange",!1),(0,Cn.Z)((0,S.Z)(e),"layerIDList",[]),(0,Cn.Z)((0,S.Z)(e),"loadedLayers",0),(0,Cn.Z)((0,S.Z)(e),"parent",null),(0,Cn.Z)((0,S.Z)(e),"children",[]),(0,Cn.Z)((0,S.Z)(e),"loadedChilds",0),(0,Cn.Z)((0,S.Z)(e),"data",null),(0,Cn.Z)((0,S.Z)(e),"properties",{}),(0,Cn.Z)((0,S.Z)(e),"loadDataId",0);var n=t.x,r=t.y,a=t.z,s=t.tileSize;return e.x=n,e.y=r,e.z=a,e.tileSize=s,e}return(0,g.Z)(o,[{key:"isLoading",get:function(){return this.loadStatus===Vr.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Vr.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Vr.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===Vr.Cancelled}},{key:"isDone",get:function(){return[Vr.Loaded,Vr.Cancelled,Vr.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return oi(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,u.Z)(this.bounds,4),e=t[0],n=t[1],r=[(t[2]-e)/2,(t[3]-n)/2];return(0,Yr.Z)(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:r,meta:"\n      ".concat(this.key,"\n      ")}})}},{key:"key",get:function(){return"".concat(this.x,",").concat(this.y,",").concat(this.z)}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:(e=(0,zn.Z)(jn().mark((function t(e){var n,r,i,o,a,s,u,l,c,h,p,f,d,m,g,y;return jn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getData,r=e.onLoad,i=e.onError,this.loadDataId++,o=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Vr.Loading,a=null,t.prev=7,u=this.x,l=this.y,c=this.z,h=this.bounds,p=this.tileSize,f=si(u,l,c),d=f.warpX,m=f.warpY,g=this.abortController.signal,y={x:d,y:m,z:c,bounds:h,tileSize:p,signal:g},t.next=14,n(y,this);case 14:a=t.sent,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),s=t.t0;case 20:if(o===this.loadDataId){t.next=22;break}return t.abrupt("return");case 22:if(!this.isCancelled||a){t.next=24;break}return t.abrupt("return");case 24:if(!s&&a){t.next=28;break}return this.loadStatus=Vr.Failure,i(s,this),t.abrupt("return");case 28:this.loadStatus=Vr.Loaded,this.data=a,r(this);case 31:case"end":return t.stop()}}),t,this,[[7,17]])}))),function(t){return e.apply(this,arguments)})},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Vr.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),o}(Kr.EventEmitter);function li(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ci(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ci(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ci(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var hi,pi=function(t){(0,_.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,b.Z)(e);if(n){var i=(0,b.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,x.Z)(this,t)});function i(t){var e;return(0,m.Z)(this,i),e=r.call(this),(0,Cn.Z)((0,S.Z)(e),"currentTiles",[]),(0,Cn.Z)((0,S.Z)(e),"cacheTiles",new Map),(0,Cn.Z)((0,S.Z)(e),"throttleUpdate",(0,l.throttle)((function(t,n){e.update(t,n)}),16)),(0,Cn.Z)((0,S.Z)(e),"onTileLoad",(function(t){e.emit("tile-loaded",t),e.updateTileVisible()})),(0,Cn.Z)((0,S.Z)(e),"onTileError",(function(t,n){e.emit("tile-error",{error:t,tile:n}),e.updateTileVisible()})),(0,Cn.Z)((0,S.Z)(e),"onTileUnload",(function(t){e.emit("tile-unload",t)})),e.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:ti,getTileData:ni,updateStrategy:Zr.Replace},e.updateOptions(t),e}return(0,g.Z)(i,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(t){return t.isDone}))}},{key:"tiles",get:function(){return Array.from(this.cacheTiles.values()).sort((function(t,e){return t.z-e.z}))}},{key:"updateOptions",value:function(t){var e=void 0===t.minZoom?this.options.minZoom:Math.ceil(t.minZoom),n=void 0===t.maxZoom?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,Ie.Z)((0,Ie.Z)((0,Ie.Z)({},this.options),t),{},{minZoom:e,maxZoom:n})}},{key:"update",value:function(t,e){var n=this,r=Math.ceil(t);if(!this.lastViewStates||this.lastViewStates.zoom!==r||!function(t,e){return fn(dn(t),dn(e))}(this.lastViewStates.latLonBoundsBuffer,e)){var i=function(t,e){var n=pn(dn(t),.2),r=85.0511287798065;return[Math.max(n[0][0],-900),Math.max(n[0][1],-r),Math.min(n[1][0],900),Math.min(n[1][1],r)]}(e);this.lastViewStates={zoom:r,latLonBounds:e,latLonBoundsBuffer:i};var o=!1,a=this.getTileIndices(r,i);this.currentTiles=a.map((function(t){var e,r,i=t.x,a=t.y,s=t.z,u=n.getTile(i,a,s);return u?(((null===(e=u)||void 0===e?void 0:e.isFailure)||(null===(r=u)||void 0===r?void 0:r.isCancelled))&&u.loadData({getData:n.options.getTileData,onLoad:n.onTileLoad,onError:n.onTileError}),u):(u=n.createTile(i,a,s),o=!0,u)})),o&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t,e=li(this.cacheTiles);try{for(e.s();!(t=e.n()).done;){var n=(0,u.Z)(t.value,2),r=n[0],i=n[1];this.currentTiles.includes(i)||(this.cacheTiles.delete(r),this.onTileUnload(i)),this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(t){e.e(t)}finally{e.f()}}},{key:"pruneRequests",value:function(){var t,e=[],n=li(this.cacheTiles.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.isLoading&&(r.isCurrent||r.isVisible||e.push(r))}}catch(t){n.e(t)}finally{n.f()}for(;e.length>0;)e.shift().abortLoad()}},{key:"getTileByLngLat",value:function(t,e,n){var r=this.options.zoomOffset,i=Math.ceil(n)+r,o=ri(t,e,i);return this.tiles.filter((function(t){return t.key==="".concat(o[0],",").concat(o[1],",").concat(i)}))[0]}},{key:"destroy",value:function(){var t,e=li(this.cacheTiles.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.isLoading&&n.abortLoad()}}catch(t){e.e(t)}finally{e.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t,e=this.options.updateStrategy,n=new Map,r=li(this.cacheTiles.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(t){r.e(t)}finally{r.f()}var o,a=li(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(t){a.e(t)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof e?e(u):ei[e](u);var l=!1;Array.from(this.cacheTiles.values()).forEach((function(t){t.isVisible!==n.get(t.key)?(t.isVisibleChange=!0,l=!0):t.isVisibleChange=!1})),l&&this.emit("tile-update")}},{key:"getTileIndices",value:function(t,e){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset;return ai({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:t,latLonBounds:e,extent:i})}},{key:"getTileId",value:function(t,e,n){return"".concat(t,",").concat(e,",").concat(n)}},{key:"getTile",value:function(t,e,n){var r=this.getTileId(t,e,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(t,e,n){var r=this.getTileId(t,e,n),i=new ui({x:t,y:e,z:n,tileSize:this.options.tileSize});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var t=5*this.currentTiles.length;if(this.cacheTiles.size>t){var e,n=li(this.cacheTiles);try{for(n.s();!(e=n.n()).done;){var r=(0,u.Z)(e.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=t)break}}catch(t){n.e(t)}finally{n.f()}}}},{key:"rebuildTileTree",value:function(){var t,e=li(this.cacheTiles.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.parent=null,n.children.length=0}}catch(t){e.e(t)}finally{e.f()}var r,i=li(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(t){i.e(t)}finally{i.f()}}},{key:"getNearestAncestor",value:function(t,e,n){for(;n>this.options.minZoom;){t=Math.floor(t/2),e=Math.floor(e/2),n-=1;var r=this.getTile(t,e,n);if(r)return r}return null}}]),i}(Qr());function fi(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=arguments.length>6?arguments[6]:void 0,s=n;return a&&(s=Math.round(n*(o-1))/(o-1)),gi(t,e,s,r||.314,i)}function di(t,e){var n=1-e;return(t[0]*n+t[1]*e)*n+(t[1]*n+t[2]*e)*e}function mi(t,e,n){var r,i,o=[e[0]-t[0],e[1]-t[1]],a=(r=o,i=[0,0],Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2))),s=Math.atan2(o[1],o[0]),u=a/2/Math.cos(n),l=s+n;return[u*Math.cos(l)+t[0],u*Math.sin(l)+t[1]]}function gi(t,e,n,r,i){if(i===hi["GAODE2.x"]){var o=un(t[0],t[1]),a=un(e[0],e[1]),u=mi(o,a,r),l=[o[0],u[0],a[0]],c=[o[1],u[1],a[1]];return[].concat((0,s.Z)(ln(di(l,n),di(c,n))),[0])}var h=mi(t,e,r),p=[t[0],h[0],e[0]],f=[t[1],h[1],e[1]];return[di(p,n),di(f,n),0]}function yi(t,e,n,r,i){var o=arguments.length>6?arguments[6]:void 0,a=n;return o&&(a=Math.round(29*n)/29),_i(t,e,a,i)}function vi(t,e){var n=1-e;return(t[0]*n+t[1]*e)*n+(t[1]*n+t[2]*e)*e}function _i(t,e,n,r){var i=[(0,We.Ht)(t[0]),(0,We.Ht)(t[1])],o=[(0,We.Ht)(e[0]),(0,We.Ht)(e[1])];if("GAODE2.x"===r){var a=function(t,e){var n=[e[0]-t[0],e[1]-t[1]],r=gn(n,[0,0]),i=Math.atan2(n[1],n[0]),o=r/2/Math.cos(.314),a=i+.314;return[o*Math.cos(a)+t[0],o*Math.sin(a)+t[1]]}(i,o),s=[i[0],a[0],o[0]],u=[i[1],a[1],o[1]];return[vi(s,n),vi(u,n),0]}var l=function(t,e){var n=[t[0]-e[0],t[1]-e[1]],r=[Math.sin(n[0]/2),Math.sin(n[1]/2)],i=r[1]*r[1]+Math.cos(t[1])*Math.cos(e[1])*r[0]*r[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}(i,o);if(Math.abs(l-Math.PI)<.001)return[(1-n)*i[0]+n*o[0],(1-n)*i[1]+n*o[1]];var c=Math.sin((1-n)*l)/Math.sin(l),h=Math.sin(n*l)/Math.sin(l),p=[Math.sin(i[0]),Math.sin(i[1])],f=[Math.cos(i[0]),Math.cos(i[1])],d=[Math.sin(o[0]),Math.sin(o[1])],m=[Math.cos(o[0]),Math.cos(o[1])],g=c*f[1]*f[0]+h*m[1]*m[0],y=c*f[1]*p[0]+h*m[1]*d[0],v=c*p[1]+h*d[1];return[(0,We.vi)(Math.atan2(y,g)),(0,We.vi)(Math.atan2(v,Math.sqrt(g*g+y*y)))]}function xi(t,e,n){return[t[0]*n+e[0]*(1-n),t[1]*n+e[1]*(1-n)]}function bi(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function wi(t,e){var n=e.featureId,r=t.data.dataArray;return"number"==typeof n&&(r=r.filter((function(t){return t.id===n}))),r.map((function(t){var n=function(t,e){var n=e.offset,r=e.shape,i=e.thetaOffset,o=e.mapVersion,a=e.segmentNumber,s=void 0===a?30:a,l=e.autoFit,c=void 0===l||l,h=t.coordinates;if("line"===r)return function(t,e){for(var n=0,r=[],i=0;i<t.length-1;i++){var o=t[i],a=t[i+1],s=bi(o,a),u=n;n+=s,r.push({p1:o,p2:a,totalDistance:n,distance:s,lastTotalDistance:u})}for(var l,c,h=n*e,p=0,f=r;p<f.length;p++){var d=f[p];if(d.totalDistance>h){var m=d.p1,g=xi(d.p2,m,(h-d.lastTotalDistance)/d.distance);l=g[0],c=g[1];break}}return{lng:l,lat:c,height:0}}(h,n);var p,f=h[0],d=h[1],m="string"==typeof i?t[i]||0:i;switch(r){case"arc":default:p=fi;break;case"greatcircle":p=yi}var g=p(f,d,n,m,o,s,c),y=(0,u.Z)(g,3);return{lng:y[0],lat:y[1],height:y[2]}}(t,e);return(0,Ie.Z)((0,Ie.Z)({},t),n)}))}function Si(t,e){return new Promise((function(n){t.inited?n(wi(t,e)):t.once("update",(function(){n(wi(t,e))}))}))}!function(t){t["GAODE1.x"]="GAODE1.x",t["GAODE2.x"]="GAODE2.x",t.MAPBOX="MAPBOX",t.L7MAP="L7MAP",t.SIMPLE="SIMPLE",t.GLOBEL="GLOBEL"}(hi||(hi={}))},1341:(t,e,n)=>{"use strict";n.r(e),n.d(e,{CategoryLegend:()=>N,ContinueLegend:()=>W,Tooltip:()=>C,version:()=>r});const r="0.0.5";var i=n(6898),o=n(4859);function a(t,e){if(t)for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n]);return t}const s='\n  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",\n  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",\n  SimSun, "sans-serif"';var u,l="l7plot-tooltip",c="l7plot-tooltip__title",h="l7plot-tooltip__list",p="l7plot-tooltip__list-item",f="l7plot-tooltip__name",d="l7plot-tooltip__value",m='<div class="'.concat(l,'">\n  <div class="').concat(c,'"></div>\n  <ul class="').concat(h,'"></ul>\n</div>'),g='<li class="'.concat(p,'" data-index={index}>\n  <span class="').concat(f,'">{name}</span>\n  <span class="').concat(d,'">{value}</span>\n</li>');const y=((u={})[l]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:s,lineHeight:"20px",padding:"10px 10px 6px 10px"},u[c]={marginBottom:"4px"},u[h]={margin:"0px",listStyleType:"none",padding:"0px"},u[p]={listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},u[f]={},u[d]={marginLeft:"30px"},u);var v,_,x,b;function w(t){for(var e=t.childNodes,n=e.length-1;n>=0;n--)t.removeChild(e[n])}var S,E=function(){function t(t){this.destroyed=!1,this.options=(0,o.deepMix)({},this.getDefaultOptions(),t),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}return t.prototype.getDefaultOptions=function(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}},t.prototype.getContainer=function(){return this.container},t.prototype.getParentContainer=function(){var t,e=this.options.parent;if(!e)return t;if((0,o.isString)(e)){var n=document.getElementById(e);if(!n)throw new Error("No parent id ".concat(e));t=n}else t=e;return t},t.prototype.initContainer=function(){var t=this.createDom(this.options.containerTpl),e=this.getParentContainer();return e&&e.appendChild(t),t},t.prototype.initVisible=function(){this.options.visible?this.show():this.hide()},t.prototype.initCapture=function(){this.setCapture(this.options.capture)},t.prototype.update=function(t){this.options=(0,o.deepMix)({},this.options,t),this.updateInner(t),this.afterUpdate(t)},t.prototype.updateInner=function(t){t.domStyles&&this.applyStyles()},t.prototype.afterUpdate=function(t){t.capture&&this.setCapture(t.capture)},t.prototype.setCapture=function(t){var e=t?"auto":"none";this.container.style.pointerEvents=e},t.prototype.applyStyles=function(){var t=this.options.domStyles;if(t){var e=this.container;this.applyChildrenStyles(e,t);var n,r=this.options.className;r&&(n=r,e.className.match(new RegExp("(\\s|^)".concat(n,"(\\s|$)"))))&&a(e,t[r])}},t.prototype.applyChildrenStyles=function(t,e){(0,o.each)(e,(function(e,n){var r=t.getElementsByClassName(n);(0,o.each)(r,(function(t){a(t,e)}))}))},t.prototype.applyStyle=function(t,e){var n=this.options.domStyles;n&&a(e,n[t])},t.prototype.createDom=function(t){return void 0===t&&(t="<div></div>"),function(t){v||(v=document.createElement("table"),_=document.createElement("tr"),x=/^\s*<(\w+|!)[^>]*>/,b={tr:document.createElement("tbody"),tbody:v,thead:v,tfoot:v,td:_,th:_,"*":document.createElement("div")});var e=x.test(t)&&RegExp.$1;e&&e in b||(e="*");var n=b[e];t="string"==typeof t?t.replace(/(^\s*)|(\s*$)/g,""):t,n.innerHTML=""+t;var r=n.childNodes[0];return r&&n.contains(r)&&n.removeChild(r),r}(t)},t.prototype.removeDom=function(){var t=this.container;t&&t.parentNode&&t.parentNode.removeChild(t)},t.prototype.destroy=function(){this.removeEvent(),this.removeDom(),this.destroyed=!0},t}(),C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,o.deepMix)({},t.prototype.getDefaultOptions.call(this),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:m,itemTpl:g,domStyles:y,className:l})},e.prototype.initContainer=function(){var e=this.options.customContent;if(e){var n=this.getHtmlContentNode(e),r=this.getParentContainer();return r&&r.appendChild(n),n}return t.prototype.initContainer.call(this)},e.prototype.initDom=function(){this.cacheDoms()},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(c)[0],n=t.getElementsByClassName(h)[0];this.titleDom=e,this.listDom=n},e.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},e.prototype.show=function(){var t=this.container;t&&!this.destroyed&&a(t,{visibility:"visible"})},e.prototype.hide=function(){var t=this.container;t&&!this.destroyed&&a(t,{visibility:"hidden"})},e.prototype.updateInner=function(e){this.options.customContent?this.renderCustomContent(this.options.customContent):(e.title&&this.resetTitle(),e.items&&this.renderItems()),t.prototype.updateInner.call(this,e)},e.prototype.renderCustomContent=function(t){var e=this.container.parentNode,n=this.getHtmlContentNode(t),r=this.container;e&&e.replaceChild(n,r),this.container=n,this.applyStyles()},e.prototype.getHtmlContentNode=function(t){var e=t(this.options.title||"",this.options.items);return(0,o.isString)(e)?this.createDom(e):e},e.prototype.resetTitle=function(){var t=this.options.title;this.options.showTitle&&t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},e.prototype.showTitle=function(){var t=this.titleDom;t&&a(t,{display:"block"})},e.prototype.hideTitle=function(){var t=this.titleDom;t&&a(t,{display:"none"})},e.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},e.prototype.renderItems=function(){var t=this;this.clearItemDoms();var e=this.options.items,n=this.options.itemTpl||g,r=this.listDom;r&&(e.forEach((function(e){var a=(0,i.__assign)({},e),s=(0,o.substitute)(n,a),u=t.createDom(s);r.appendChild(u)})),this.applyChildrenStyles(r,this.options.domStyles))},e.prototype.clearItemDoms=function(){this.listDom&&w(this.listDom)},e.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},e}(E),M="l7plot-legend l7plot-legend__category",T="l7plot-legend__title",A="l7plot-legend__category-list",P="l7plot-legend__list-item",L="l7plot-legend__category-marker",I="l7plot-legend__category-value",k='<div class="'.concat(M,'">\n  <div class="').concat(T,'"></div>\n  <ul class="').concat(A,'"></ul>\n</div>'),O='<li class="'.concat(P,'" data-index={index}>\n  <span class="').concat(L,'" style="background:{color}"></span>\n  <span class="').concat(I,'">{value}</span>\n</li>');const R=((S={})[M]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:s,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},S[T]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},S[A]={margin:"0px",listStyleType:"none",padding:"0px"},S[P]={listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},S[L]={width:"10px",height:"10px"},S[I]={paddingLeft:"8px"},S);var D,N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,o.deepMix)({},t.prototype.getDefaultOptions.call(this),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:k,itemTpl:O,domStyles:R,className:M})},e.prototype.initContainer=function(){var e=this.options.customContent;if(e){var n=this.getHtmlContentNode(e),r=this.getParentContainer();return r&&r.appendChild(n),n}return t.prototype.initContainer.call(this)},e.prototype.initDom=function(){this.cacheDoms()},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(T)[0],n=t.getElementsByClassName(A)[0];this.titleDom=e,this.listDom=n},e.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},e.prototype.show=function(){var t=this.container;t&&!this.destroyed&&a(t,{visibility:"visible"})},e.prototype.hide=function(){var t=this.container;t&&!this.destroyed&&a(t,{visibility:"hidden"})},e.prototype.updateInner=function(e){this.options.customContent?this.renderCustomContent(this.options.customContent):(e.title&&this.resetTitle(),e.items&&this.renderItems()),t.prototype.updateInner.call(this,e)},e.prototype.renderCustomContent=function(t){var e=this.container.parentNode,n=this.getHtmlContentNode(t),r=this.container;e&&e.replaceChild(n,r),this.container=n,this.applyStyles()},e.prototype.getHtmlContentNode=function(t){var e=t(this.options.title||"",this.options.items);return(0,o.isString)(e)?this.createDom(e):e},e.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},e.prototype.showTitle=function(){var t=this.titleDom;t&&a(t,{display:"block"})},e.prototype.hideTitle=function(){var t=this.titleDom;t&&a(t,{display:"none"})},e.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},e.prototype.renderItems=function(){var t=this;this.clearItemDoms();var e=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,n=this.options.itemTpl||O,r=this.listDom;r&&(e.forEach((function(e){var a=""===e.value?"—":Array.isArray(e.value)?e.value.join(" - "):e.value,s=(0,i.__assign)((0,i.__assign)({},e),{value:a}),u=(0,o.substitute)(n,s),l=t.createDom(u);r.appendChild(l)})),this.applyChildrenStyles(r,this.options.domStyles))},e.prototype.clearItemDoms=function(){this.listDom&&w(this.listDom)},e.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},e}(E),F="l7plot-legend l7plot-legend__continue",z="l7plot-legend__title",B="l7plot-legend__ribbon-container",j="l7plot-legend__ribbon",U="l7plot-legend__gradient-bar",Z="l7plot-legend__value-range",V='<div class="'.concat(F,'">\n  <div class="').concat(z,'"></div>\n  <div class="').concat(B,'"></div>\n</div>'),G='<div class="'.concat(j,'">\n  <span class="').concat(Z,'">{min}</span>\n  <div class="').concat(U,'" style="background-image: {backgroundImage}"></div>\n  <span class="').concat(Z,'">{max}</span>\n</div>');const H=((D={})[F]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:s,padding:"10px",lineHeight:1,fontSize:"12px"},D["l7plot-legend__title"]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},D[j]={display:"flex",alignItems:"center"},D[U]={width:"140px",height:"14px",margin:"0px 5px"},D[Z]={padding:"0px"},D);var W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,o.deepMix)({},t.prototype.getDefaultOptions.call(this),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:V,ribbonTpl:G,domStyles:H,className:F})},e.prototype.initContainer=function(){var e=this.options.customContent;if(e){var n=this.getHtmlContentNode(e),r=this.getParentContainer();return r&&r.appendChild(n),n}return t.prototype.initContainer.call(this)},e.prototype.initDom=function(){this.cacheDoms()},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(z)[0],n=t.getElementsByClassName(B)[0];this.titleDom=e,this.ribbonContainerDom=n},e.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())},e.prototype.show=function(){var t=this.container;t&&!this.destroyed&&a(t,{visibility:"visible"})},e.prototype.hide=function(){var t=this.container;t&&!this.destroyed&&a(t,{visibility:"hidden"})},e.prototype.updateInner=function(e){this.options.customContent?this.renderCustomContent(this.options.customContent):(e.title&&this.resetTitle(),e.colors&&this.renderRibbon()),t.prototype.updateInner.call(this,e)},e.prototype.renderCustomContent=function(t){var e=this.container.parentNode,n=this.getHtmlContentNode(t),r=this.container;e&&e.replaceChild(n,r),this.container=n,this.applyStyles()},e.prototype.getHtmlContentNode=function(t){var e=t(this.options.title||"",this.options.min,this.options.max,this.options.colors);return(0,o.isString)(e)?this.createDom(e):e},e.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},e.prototype.showTitle=function(){var t=this.titleDom;t&&a(t,{display:"block"})},e.prototype.hideTitle=function(){var t=this.titleDom;t&&a(t,{display:"none"})},e.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},e.prototype.renderRibbon=function(){this.clearRibbonContainerDoms();var t=this.options,e=t.min,n=t.max,r=t.colors,i=t.ribbonTpl,a=void 0===i?G:i,s=this.ribbonContainerDom;if(s){var u={min:e,max:n,backgroundImage:"linear-gradient(to right, ".concat(r.join(", "),")")},l=(0,o.substitute)(a,u),c=this.createDom(l);s.appendChild(c),this.applyChildrenStyles(s,this.options.domStyles)}},e.prototype.clearRibbonContainerDoms=function(){this.ribbonContainerDom&&w(this.ribbonContainerDom)},e.prototype.clear=function(){this.setTitle(""),this.clearRibbonContainerDoms()},e}(E)},5864:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ITEM_TPL=e.CONTAINER_TPL=e.VALUE_CLASS=e.MARKER_CLASS=e.LIST_ITEM_CLASS=e.LIST_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-legend l7plot-legend__category",e.TITLE_CLASS="l7plot-legend__title",e.LIST_CLASS="l7plot-legend__category-list",e.LIST_ITEM_CLASS="l7plot-legend__list-item",e.MARKER_CLASS="l7plot-legend__category-marker",e.VALUE_CLASS="l7plot-legend__category-value",e.CONTAINER_TPL='<div class="'.concat(e.CONTAINER_CLASS,'">\n  <div class="').concat(e.TITLE_CLASS,'"></div>\n  <ul class="').concat(e.LIST_CLASS,'"></ul>\n</div>'),e.ITEM_TPL='<li class="'.concat(e.LIST_ITEM_CLASS,'" data-index={index}>\n  <span class="').concat(e.MARKER_CLASS,'" style="background:{color}"></span>\n  <span class="').concat(e.VALUE_CLASS,'">{value}</span>\n</li>')},3109:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RIBBON_TPL=e.CONTAINER_TPL=e.VALUE_RANGE_CLASS=e.GRADIENT_BAR_CLASS=e.RIBBON_CLASS=e.RIBBON_CONTAINER_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-legend l7plot-legend__continue",e.TITLE_CLASS="l7plot-legend__title",e.RIBBON_CONTAINER_CLASS="l7plot-legend__ribbon-container",e.RIBBON_CLASS="l7plot-legend__ribbon",e.GRADIENT_BAR_CLASS="l7plot-legend__gradient-bar",e.VALUE_RANGE_CLASS="l7plot-legend__value-range",e.CONTAINER_TPL='<div class="'.concat(e.CONTAINER_CLASS,'">\n  <div class="').concat(e.TITLE_CLASS,'"></div>\n  <div class="').concat(e.RIBBON_CONTAINER_CLASS,'"></div>\n</div>'),e.RIBBON_TPL='<div class="'.concat(e.RIBBON_CLASS,'">\n  <span class="').concat(e.VALUE_RANGE_CLASS,'">{min}</span>\n  <div class="').concat(e.GRADIENT_BAR_CLASS,'" style="background-image: {backgroundImage}"></div>\n  <span class="').concat(e.VALUE_RANGE_CLASS,'">{max}</span>\n</div>')},1501:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ITEM_TPL=e.CONTAINER_TPL=e.VALUE_CLASS=e.NAME_CLASS=e.LIST_ITEM_CLASS=e.LIST_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-tooltip",e.TITLE_CLASS="l7plot-tooltip__title",e.LIST_CLASS="l7plot-tooltip__list",e.LIST_ITEM_CLASS="l7plot-tooltip__list-item",e.NAME_CLASS="l7plot-tooltip__name",e.VALUE_CLASS="l7plot-tooltip__value",e.CONTAINER_TPL='<div class="'.concat(e.CONTAINER_CLASS,'">\n  <div class="').concat(e.TITLE_CLASS,'"></div>\n  <ul class="').concat(e.LIST_CLASS,'"></ul>\n</div>'),e.ITEM_TPL='<li class="'.concat(e.LIST_ITEM_CLASS,'" data-index={index}>\n  <span class="').concat(e.NAME_CLASS,'">{name}</span>\n  <span class="').concat(e.VALUE_CLASS,'">{value}</span>\n</li>')},9268:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MappingLayer=e.getMappingFunction=void 0;var r=n(4859);function i(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i={};return t.forEach((function(t,e){i[t]=n[e]})),delete i[void 0],e(i)}}e.getMappingFunction=i;var o=function(){function t(){}return t.shape=function(e,n){if((0,r.isString)(n))e.shape(n);else if((0,r.isFunction)(n)){var o=[];e.shape(o.join("*"),i(o,n))}else if((0,r.isObject)(n)){var a=n.field?n.field:"";(0,r.isFunction)(n.value)?(o=(0,r.isArray)(a)?a:a.split("*"),e.shape(a,i(o,n.value))):e.shape(a,n.value),(0,r.isString)(a)&&n.scale&&t.scale(e,a,n.scale)}},t.size=function(e,n){if((0,r.isNumber)(n))e.size(n);else if((0,r.isArray)(n))e.size(n);else if((0,r.isFunction)(n)){var o=[];e.size(o.join("*"),i(o,n))}else if((0,r.isObject)(n)){var a=n.field?n.field:"";(0,r.isFunction)(n.value)?(o=(0,r.isArray)(a)?a:a.split("*"),e.size(a,i(o,n.value))):e.size(a,n.value),(0,r.isString)(a)&&n.scale&&t.scale(e,a,n.scale)}},t.color=function(e,n){if((0,r.isString)(n))e.color(n);else if((0,r.isFunction)(n)){var o=[];e.color(o.join("*"),i(o,n))}else if((0,r.isObject)(n)){var a=n.field?n.field:"";(0,r.isFunction)(n.value)?(o=(0,r.isArray)(a)?a:a.split("*"),e.color(a,i(o,n.value))):e.color(a,n.value),(0,r.isString)(a)&&n.scale&&t.scale(e,a,n.scale)}},t.style=function(t,e){e&&t.style(e)},t.state=function(t,e){var n=e.active,r=e.select;n&&t.active(n),r&&t.select(r)},t.rotate=function(t,e){(0,r.isString)(e)||(0,r.isFunction)(e)||(0,r.isObject)(e)},t.texture=function(t,e){(0,r.isString)(e)&&t.texture(e)},t.animate=function(t,e){((0,r.isBoolean)(e)||(0,r.isObject)(e))&&t.animate(e)},t.scale=function(t,e,n){t.scale(e,n)},t.filter=function(t,e){var n=e.field?e.field:"",o=(0,r.isArray)(n)?n:n.split("*");t.filter(o.join("*"),i(o,e.value))},t}();e.MappingLayer=o},3409:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MappingSource=void 0;var n=function(){function t(){}return t.aggregation=function(t,e){var n=e.type,r={type:void 0===n?"grid":n,size:e.radius,method:e.method,field:e.field};t.transforms?(t.transforms=t.transforms.filter((function(t){return t.type!==r.type})),t.transforms.push(r)):t.transforms=[r]},t}();e.MappingSource=n},2988:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Legend=void 0;var r=n(6898),i=n(5803),o=n(1341),a=function(t){function e(e){var n=t.call(this,e)||this;return n.legendComponents=[],n.options=e,n.legendComponents=n.initLegendComponents(e.items),n}return(0,r.__extends)(e,t),e.prototype.initLegendComponents=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];if("category"===r.type){var i=new o.CategoryLegend({title:r.options.title,items:r.options.items,className:r.options.className,customContent:r.options.customContent,domStyles:r.options.domStyles});e.push(i)}else"continue"===r.type&&(i=new o.ContinueLegend({title:r.options.title,min:r.options.min,max:r.options.max,colors:r.options.colors,className:r.options.className,customContent:r.options.customContent,domStyles:r.options.domStyles}),e.push(i))}return e},e.prototype.getDefaultOptions=function(){return{position:"bottomleft"}},e.prototype.onAdd=function(){var t=window.document.createElement("div");return t.className="l7plot-legend-container",this.legendComponents.forEach((function(e){var n=e.getContainer();t.appendChild(n)})),t},e.prototype.onRemove=function(){this.legendComponents.forEach((function(t){t.destroy()}))},e}(i.Control);e.Legend=a},2301:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Tooltip=void 0;var r=n(6898),i=n(5803),o=(0,r.__importDefault)(n(3275)),a=n(4859),s=n(1341),u=n(3057),l=n(6829),c=n(1745),h=["mousemove","click"],p=function(t){function e(e,n,r){var o=t.call(this)||this;o.currentVisible=!1,o.interactionTriggerHander=function(t){var e=t.feature,n=t.featureId,r=o.options,i=r.title,s=r.customTitle,l=r.items,c=r.customItems,h="Feature"===e.type&&e.geometry&&e.properties?e.properties:e,p=[];if(c){var f=c(e);if(!Array.isArray(f))throw new Error("customItems return array");p=f}else l&&l.forEach((function(t){if((0,a.isString)(t)){var e=t.split(".").pop()||t;void 0!==(r=(0,u.get)(h,t))&&p.push({name:e,value:r})}else{var r,i=t.field,o=t.alias,s=t.customValue,l=o||i.split(".").pop()||i;void 0!==(r=(0,u.get)(h,i))&&p.push({name:l,value:s?s(r,h,n):r})}}));var d={title:s?s(h):i,items:p};o.updateTooltip(t,d)},o.interactionUntriggerHander=function(){o.hideTooltip()},o.scene=e,o.interactionLayers=n,o.options=(0,c.deepAssign)({},o.getDefaultOptions(),r);var l=o.options,h=l.offsets,p=l.title,f=l.showTitle,d=l.customContent,m=l.domStyles,g=l.anchor,y=l.className;return o.marker=new i.Marker({offsets:h,anchor:g,draggable:!1}),o.tooltipComponent=new s.Tooltip({title:p,showTitle:f,items:[],customContent:d,domStyles:m,className:y}),o.setComponent(),o.initInteractionEvent(),o}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:l.TooltipAnchorType["TOP-LEFT"]}},e.prototype.update=function(t){this.marker.remove(),this.currentVisible=!1,this.options=(0,c.deepAssign)({},this.options,t);var e=this.options,n=e.offsets,r=e.showTitle,o=e.customContent,a=e.domStyles,s=e.anchor,u=e.className;this.marker=new i.Marker({offsets:n,anchor:s,draggable:!1}),this.tooltipComponent.update({showTitle:r,customContent:o,domStyles:a,className:u}),this.setComponent()},e.prototype.initInteractionEvent=function(){var t=this,e=this.options.trigger||"mousemove";if(!h.includes(e))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach((function(n){var r=n.layer;r.on(e,t.interactionTriggerHander),r.on("un".concat(e),t.interactionUntriggerHander)}))},e.prototype.unBindInteractionEvent=function(){var t=this,e=this.options.trigger||"mousemove";this.interactionLayers.forEach((function(n){var r=n.layer;r.off(e,t.interactionTriggerHander),r.off("un".concat(e),t.interactionUntriggerHander)}))},e.prototype.updateTooltip=function(t,e){var n=t.lngLat,r=t.x,i=t.y;if(this.options.showComponent&&(this.updateComponent(e),this.setPostion(n)),this.currentVisible){var o={type:"tooltip:change",data:e,lngLat:n,x:r,y:i};this.emit("tooltip:change",o)}else{this.showTooltip();var a={type:"tooltip:show",data:e,lngLat:n,x:r,y:i};this.emit("tooltip:show",a)}},e.prototype.showTooltip=function(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)},e.prototype.hideTooltip=function(){this.currentVisible&&(this.options.showComponent&&this.marker.remove(),this.currentVisible=!1,this.emit("tooltip:hide",{type:"tooltip:hide"}))},e.prototype.updateComponent=function(t){(0,a.isEqual)(this.lastComponentOptions,t)||(this.tooltipComponent.update(t),this.lastComponentOptions=t)},e.prototype.setComponent=function(){var t=this.tooltipComponent.getContainer(),e=window.document.createElement("div");e.style.cursor="auto",e.style.userSelect="text",e.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(t){e.addEventListener(t,(function(t){return t.stopPropagation()}))})),e.appendChild(t),this.marker.setElement(e)},e.prototype.setPostion=function(t){this.marker.setLnglat(t)},e.prototype.destroy=function(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()},e}(o.default);e.Tooltip=p},6954:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LayerGroup=void 0;var r=n(6898),i=n(4859),o=function(t){function e(e,n){void 0===e&&(e=[]),void 0===n&&(n={});var r=t.call(this)||this;return r.name=n.name?n.name:(0,i.uniqueId)("layerGroup"),r.layers=e,r}return(0,r.__extends)(e,t),e.prototype.addTo=function(t){var e=this;this.scene=t;var n=0,r=this.layers.length;this.layers.forEach((function(i){i.once("inited",(function(t){n++,e.emit("inited",t),n===r&&e.emit("inited-all")})),i.addTo(t)}))},e.prototype.hasLayer=function(t){return this.layers.some((function(e){return e===t}))},e.prototype.addLayer=function(t){var e=this;this.layers.push(t),this.scene&&(t.once("inited",(function(t){return e.emit("inited",t)})),t.addTo(this.scene))},e.prototype.removeLayer=function(t){var e=this.layers.findIndex((function(e){return e===t}));return-1!==e&&(this.layers.splice(e,1),this.scene&&t.remove(this.scene),!0)},e.prototype.getLayers=function(){return this.layers},e.prototype.getInteractionLayers=function(){return this.layers.filter((function(t){return t.interaction}))},e.prototype.getLayer=function(t){return this.layers.find((function(e){return e.layer.id===t}))},e.prototype.getLayerByName=function(t){return this.layers.find((function(e){return e.name===t}))},e.prototype.removeAllLayer=function(){var t=this;this.layers.forEach((function(e){t.scene&&e.remove(t.scene)})),this.layers=[]},e.prototype.isEmpty=function(){return 0===this.layers.length},e}((0,r.__importDefault)(n(3275)).default);e.LayerGroup=o},9025:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlotLayer=void 0;var r=n(6898),i=n(4859),o=(0,r.__importDefault)(n(4793)),a=(0,r.__importDefault)(n(3275)),s=n(7482),u=n(3409),l=n(5498),c=n(1745),h=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"],p=function(t){function e(e){var n=t.call(this)||this;return n.options=(0,c.deepAssign)({},n.getDefaultOptions(),e),n.lastOptions=n.options,n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return{}},e.prototype.pickLayerConfig=function(t){return(0,i.pick)(t,h)},e.prototype.addTo=function(t){t.addLayer(this.layer)},e.prototype.remove=function(t){t.removeLayer(this.layer)},e.prototype.update=function(t){this.updateOption(t),this.updateConfig(t)},e.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=(0,c.deepAssign)({},this.options,t)},e.prototype.updateConfig=function(t){(0,i.isUndefined)(t.zIndex)||(0,i.isEqual)(this.lastOptions.zIndex,this.options.zIndex)||this.setIndex(t.zIndex),(0,i.isUndefined)(t.blend)||(0,i.isEqual)(this.lastOptions.blend,this.options.blend)||this.setBlend(t.blend),(0,i.isUndefined)(t.minZoom)||(0,i.isEqual)(this.lastOptions.minZoom,this.options.minZoom)||this.setMinZoom(t.minZoom),(0,i.isUndefined)(t.maxZoom)||(0,i.isEqual)(this.lastOptions.maxZoom,this.options.maxZoom)||this.setMinZoom(t.maxZoom),(0,i.isUndefined)(t.visible)||(0,i.isEqual)(this.lastOptions.visible,this.options.visible)||(t.visible?this.show():this.hide())},e.prototype.render=function(){this.layer.renderLayers()},e.prototype.setSource=function(t){if(t instanceof o.default)this.layer.setSource(t);else{var e=t.data,n=t.aggregation,i=(0,r.__rest)(t,["data","aggregation"]);n&&u.MappingSource.aggregation(i,n),this.layer.getSource()?this.layer.setData(e,i):this.layer.source(e,i)}},e.prototype.changeData=function(t){this.setSource(t)},e.prototype.setIndex=function(t){this.layer.setIndex(t)},e.prototype.setBlend=function(t){this.layer.setBlend(t)},e.prototype.setMinZoom=function(t){this.layer.setMinZoom(t)},e.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t)},e.prototype.show=function(){this.layer.inited&&this.layer.show()},e.prototype.hide=function(){this.layer.inited&&this.layer.hide()},e.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},e.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():this.options.visible},e.prototype.fitBounds=function(t){this.layer.fitBounds(t)},e.prototype.on=function(e,n){return-1!==l.LayerEventList.indexOf(e)?this.layer.on(e,n):t.prototype.on.call(this,e,n),this},e.prototype.once=function(e,n){return-1!==l.LayerEventList.indexOf(e)?this.layer.once(e,n):t.prototype.once.call(this,e,n),this},e.prototype.off=function(e,n){return-1!==l.LayerEventList.indexOf(e)?this.layer.off(e,n):t.prototype.off.call(this,e,n),this},e.LayerType=s.LayerType,e.LayerConfigkeys=h,e}(a.default);e.PlotLayer=p},5498:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LayerEventList=e.MapEventList=e.SceneEventList=void 0,e.SceneEventList=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],e.MapEventList=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],e.LayerEventList=["inited","add","remove","dataUpdate","click","unclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick"]},3108:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Map=void 0;var r=n(6898),i=n(7112),o=n(6564),a=n(5803),s=(0,r.__importDefault)(n(3275)),u=n(4859),l=n(2301),c=n(2988),h=n(1745),p=n(6829),f=n(6954),d=n(5498),m=n(1003),g=n(4896),y=n(6510),v={map:{type:p.BaseMapType.Amap},logo:!0},_=function(t){function e(e){var n=t.call(this)||this;return n.inited=!1,n.sceneLoaded=!1,n.layersLoaded=!1,n.loaded=!1,n.layerGroup=new f.LayerGroup,n.options=(0,h.deepAssign)({},n.getDefaultOptions(),e),n.lastOptions=n.options,n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createContainer=function(t){var e=this.options,n=e.width,r=e.height,i="string"==typeof t?document.getElementById(t):t;return i.style.position||(i.style.position="relative"),n&&(i.style.width||(i.style.width="".concat(n,"px"))),r&&(i.style.height||(i.style.height="".concat(r,"px"))),i},e.prototype.createTheme=function(){return(0,u.isObject)(this.options.theme)?(0,h.deepAssign)({},(0,g.getTheme)("default"),(0,y.createTheme)(this.options.theme)):(0,g.getTheme)(this.options.theme)},e.prototype.createMap=function(){var t=this.options.map?this.options.map:v.map,e=t.type,n=(0,r.__rest)(t,["type"]),i=Object.assign({style:this.theme.mapStyle},n);return e===p.BaseMapType.Amap?new o.GaodeMap(i):new o.Mapbox(i)},e.prototype.createScene=function(){var t=this.options,e=t.logo,n=t.antialias,o=t.preserveDrawingBuffer,a=(0,u.isBoolean)(e)?{logoVisible:e}:{logoVisible:null==e?void 0:e.visible,logoPosition:null==e?void 0:e.position},s=Object.assign({antialias:n,preserveDrawingBuffer:o},a),l=this.createMap();return new i.Scene((0,r.__assign)({id:this.container,map:l},s))},e.prototype.registerResources=function(){var t=this;m.IMAGES_CACHE.size&&m.IMAGES_CACHE.forEach((function(e,n){!t.scene.hasImage(n)&&t.scene.addImage(n,e)})),m.FONT_FACE_CACHE.size&&m.FONT_FACE_CACHE.forEach((function(e,n){t.scene.addFontFace(n,e)})),m.ICON_FONT_CACHE.size&&m.ICON_FONT_CACHE.forEach((function(e,n){t.scene.addIconFont(n,e)}))},e.prototype.update=function(t){this.updateOption(t),t.map&&!(0,u.isEqual)(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.render(),this.emit("update")},e.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=(0,h.deepAssign)({},this.options,t)},e.prototype.updateMap=function(t){var e;if(this.scene){var n=t.style,r=t.center,i=t.zoom,o=t.rotation,a=t.pitch;(0,u.isUndefined)(a)||this.scene.setPitch(a),(0,u.isUndefined)(o)||this.scene.setRotation(o),n&&n!==(null===(e=this.lastOptions.map)||void 0===e?void 0:e.style)&&this.scene.setMapStyle(n),i&&r&&this.scene.setZoomAndCenter(i,r)}},e.prototype.changeSize=function(t,e){this.options.width===t&&this.options.height===e||(this.container.style.width="".concat(t,"px"),this.container.style.height="".concat(e,"px"),this.options=Object.assign(this.options,{width:t,height:e}))},e.prototype.on=function(t,e){return this.proxyEventHander("on",t,e),this},e.prototype.once=function(t,e){return this.proxyEventHander("once",t,e),this},e.prototype.off=function(t,e){return this.proxyEventHander("off",t,e),this},e.prototype.proxyEventHander=function(e,n,i){var o=d.SceneEventList.find((function(t){return t.adaptation===n}));if(o)this.scene[e](o.original,i);else if(-1!==d.MapEventList.indexOf(n))this.scene[e](n,i);else if(n.includes("Layer:")){var a=(0,r.__read)(n.split(":"),2),s=a[0],u=a[1];if(!this[s]||!this[s][e]||-1===d.LayerEventList.indexOf(u))throw new Error('No event name "'.concat(n,'"'));this[s][e](u,i)}else t.prototype[e].call(this,n,i)},e.prototype.getScene=function(){return this.scene},e.prototype.getMap=function(){var t,e;return(null===(t=this.options.map)||void 0===t?void 0:t.type)===p.BaseMapType.Amap||(null===(e=this.options.map)||void 0===e||e.type,p.BaseMapType.Mapbox),this.scene.map},e.prototype.addLayer=function(t){this.layerGroup.addLayer(t)},e.prototype.getLayes=function(){return console.warn("Replace to use getLayers()"),this.getLayers()},e.prototype.getLayers=function(){return this.layerGroup.getLayers()},e.prototype.getLayerByName=function(t){return this.layerGroup.getLayerByName(t)},e.prototype.removeLayer=function(t){return this.layerGroup.removeLayer(t)},e.prototype.removeAllLayer=function(){this.layerGroup.removeAllLayer()},e.prototype.zoomIn=function(){this.scene.zoomIn()},e.prototype.zoomOut=function(){this.scene.zoomOut()},e.prototype.setPitch=function(t){this.scene.setPitch(t)},e.prototype.fitBounds=function(t){this.scene.fitBounds(t)},e.prototype.setMapStatus=function(t){this.scene.setMapStatus(t)},e.prototype.setBgColor=function(t){this.scene.setBgColor(t)},e.prototype.initComponents=function(){this.initControls(),this.initTooltip()},e.prototype.updateComponents=function(){this.updateControls(),this.initTooltip()},e.prototype.initControls=function(){var t=this.options,e=t.zoom,n=t.scale,r=t.layerMenu,i=t.legend;n&&this.addScaleControl(n),e&&this.addZoomControl(e),r&&this.addLayerMenuControl(r),i&&this.addLegendControl(i)},e.prototype.updateControls=function(){var t=this.options,e=t.zoom,n=t.scale,r=t.layerMenu,i=t.legend;(0,u.isEqual)(this.lastOptions.zoom,e)||(e?this.updateZoomControl(e):this.removeZoomControl()),(0,u.isEqual)(this.lastOptions.scale,n)||(n?this.updateScaleControl(n):this.removeScaleControl()),(0,u.isEqual)(this.lastOptions.layerMenu,r)||(r?this.updateLayerMenuControl(r):this.removeLayerMenuControl()),(0,u.isEqual)(this.lastOptions.legend,i)||(i?this.updateLegendControl(i):this.removeLegendControl())},e.prototype.addZoomControl=function(t){this.zoomControl||(this.zoomControl=new a.Zoom(t),this.scene.addControl(this.zoomControl))},e.prototype.updateZoomControl=function(t){this.zoomControl?(this.removeZoomControl(),this.addZoomControl(t)):this.addZoomControl(t)},e.prototype.removeZoomControl=function(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)},e.prototype.addScaleControl=function(t){this.scaleControl||(this.scaleControl=new a.Scale(t),this.scene.addControl(this.scaleControl))},e.prototype.updateScaleControl=function(t){this.scaleControl?(this.removeScaleControl(),this.addScaleControl(t)):this.addScaleControl(t)},e.prototype.removeScaleControl=function(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)},e.prototype.addLayerMenuControl=function(t){if(!this.layerMenuControl){var e={};this.layerGroup.getLayers().forEach((function(t){var n=t.name,r=t.layer;e[n]=r})),this.layerMenuControl=new a.Layers(Object.assign({},t,{baseLayers:{},overlayers:e})),this.scene.addControl(this.layerMenuControl)}},e.prototype.updateLayerMenuControl=function(t){this.layerMenuControl?(this.removeLayerMenuControl(),this.addLayerMenuControl(t)):this.addLayerMenuControl(t)},e.prototype.removeLayerMenuControl=function(){this.layerMenuControl&&(this.layerMenuControl.remove(),this.layerMenuControl=void 0)},e.prototype.getLegendOptions=function(){return{}},e.prototype.addLegendControl=function(t){if(!this.legendControl){var e=this.theme.components.legend,n=(0,h.deepAssign)({},this.getLegendOptions(),t),i=n.type,o=n.position,a=(0,r.__rest)(n,["type","position"]),s=[];if("category"===i){var u=(0,h.deepAssign)({},{domStyles:e.category.domStyles},a);s.push({type:i,options:u})}else if("continue"===i){var l=(0,h.deepAssign)({},{domStyles:e.continue.domStyles},a);s.push({type:i,options:l})}s.length&&(this.legendControl=new c.Legend({position:o,items:s}),this.scene.addControl(this.legendControl))}},e.prototype.updateLegendControl=function(t){this.legendControl?(this.removeLegendControl(),this.addLegendControl(t)):this.addLegendControl(t)},e.prototype.removeLegendControl=function(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)},e.prototype.initTooltip=function(){var t=this;this.tooltip&&this.tooltip.destroy();var e=this.options.tooltip;if(e){var n=(0,h.deepAssign)({},{domStyles:this.theme.components.tooltip.domStyles},e),r=this.layerGroup.getInteractionLayers();this.tooltip=new l.Tooltip(this.scene,r,n),this.tooltip.on("*",(function(e){return t.emit(e.type,e)}))}},e.prototype.exportPng=function(t){return this.scene.exportPng(t)},e.prototype.destroy=function(){var e;t.prototype.off.call(this,"*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),null===(e=this.tooltip)||void 0===e||e.destroy(),this.scene.destroy()},e.DefaultOptions=v,e}(s.default);e.Map=_},1003:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unregisterIconFont=e.registerIconFonts=e.registerIconFont=e.ICON_FONT_CACHE=e.unregisterFontFace=e.registerFontFace=e.FONT_FACE_CACHE=e.unregisterImage=e.hasImage=e.getImage=e.registerImages=e.registerImage=e.IMAGES_CACHE=void 0,e.IMAGES_CACHE=new Map,e.registerImage=function(t,n){e.IMAGES_CACHE.set(t,n)},e.registerImages=function(t){t.forEach((function(t){e.IMAGES_CACHE.set(t.id,t.image)}))},e.getImage=function(t){return e.IMAGES_CACHE.get(t)},e.hasImage=function(t){return e.IMAGES_CACHE.has(t)},e.unregisterImage=function(t){return e.IMAGES_CACHE.delete(t)},e.FONT_FACE_CACHE=new Map,e.registerFontFace=function(t,n){e.FONT_FACE_CACHE.set(t,n)},e.unregisterFontFace=function(t){return e.FONT_FACE_CACHE.delete(t)},e.ICON_FONT_CACHE=new Map,e.registerIconFont=function(t,n){e.ICON_FONT_CACHE.set(t,n)},e.registerIconFonts=function(t){t.forEach((function(t){e.ICON_FONT_CACHE.set(t.name,t.fontUnicode)}))},e.unregisterIconFont=function(t){return e.ICON_FONT_CACHE.delete(t)}},3722:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Plot=void 0;var r=n(6898),i=n(3108),o=n(1745),a=n(6877),s=n(6829),u=n(3409),l=n(4859),c=n(4896),h={autoFit:!1},p=function(t){function e(e,n){var r=this;if("string"==typeof e||e instanceof Element){if(void 0===n)throw new Error("options is undefined");(r=t.call(this,n)||this).container=r.createContainer(e),r.theme=r.createTheme(),r.scene=r.createScene(),r.registerResources(),r.initSource()}else r=t.call(this,e)||this;return r}return(0,r.__extends)(e,t),e.prototype.initSource=function(){this.source=this.createSource(),this.render(),this.inited=!0},e.prototype.initLayersEvent=function(){},e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createSource=function(){var t=this.options.source,e=t.data,n=t.aggregation,i=(0,r.__rest)(t,["data","aggregation"]);return n&&u.MappingSource.aggregation(i,n),new s.Source(e,i)},e.prototype.createLabelLayer=function(t,e,n){var i=n||{},o=i.visible,s=i.minZoom,u=i.maxZoom,l=i.zIndex,c=void 0===l?0:l;return new a.TextLayer((0,r.__assign)({name:"labelLayer",visible:o,minZoom:s,maxZoom:u,zIndex:c+.1,source:t},e))},e.prototype.updateLabelLayer=function(t,e,n,i){e?i?i.update((0,r.__assign)({},e)):(i=this.createLabelLayer(t,e,n),this.layerGroup.addLayer(i)):!1===e&&i&&this.layerGroup.removeLayer(i)},e.prototype.render=function(){var t=this,e=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),e.addTo(this.scene),this.layerGroup=e):(this.layerGroup=e,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(function(){t.onSceneLoaded()}))),this.initLayersEvent()},e.prototype.onSceneLoaded=function(){var t=this;this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",(function(){t.onLayersLoaded()})),this.layerGroup.addTo(this.scene)},e.prototype.onLayersLoaded=function(){this.layersLoaded=!0,this.initComponents(),this.loaded=!0,this.emit("loaded")},e.prototype.attachToScene=function(t,e){this.scene=t,this.theme=e||(0,c.getTheme)("default"),this.registerResources(),this.initSource()},e.prototype.unattachFromScene=function(){var t;this.removeAllLayer(),null===(t=this.tooltip)||void 0===t||t.destroy()},e.prototype.addToScene=function(t){this.attachToScene(t)},e.prototype.removeFromScene=function(){var t;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),null===(t=this.tooltip)||void 0===t||t.destroy()},e.prototype.update=function(t){if(this.updateOption(t),t.map&&!(0,l.isEqual)(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.scene.setEnableRender(!1),t.source&&!(0,l.isEqual)(this.lastOptions.source,this.options.source)){var e=t.source,n=e.data,i=(0,r.__rest)(e,["data"]);this.changeData(n,i)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")},e.prototype.changeData=function(t,e){var n=this;this.options.source=(0,o.deepAssign)({},this.options.source,(0,r.__assign)({data:t},e));var i=this.options.source,a=i.aggregation,s=(0,r.__rest)(i,["aggregation"]);a&&u.MappingSource.aggregation(s,a),this.source.setData(this.options.source.data,s);var l=this.options.legend;l&&setTimeout((function(){n.updateLegendControl(l)})),this.emit("change-data")},e.DefaultOptions=h,e.PlotType=s.PlotType,e}(i.Map);e.Plot=p},8532:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Choropleth=e.Area=e.Flow=e.Path=e.Hexbin=e.Grid=e.Heatmap=e.DotDensity=e.Dot=e.PrismLayer=e.AreaLayer=e.ArcLayer=e.PathLayer=e.HexbinLayer=e.GridLayer=e.HeatmapLayer=e.TextLayer=e.DotDensityLayer=e.IconLayer=e.DotLayer=e.L7Plot=e.Plot=e.Map=e.registerTheme=e.getTheme=e.unregisterIconFont=e.registerIconFonts=e.registerIconFont=e.unregisterFontFace=e.registerFontFace=e.unregisterImage=e.registerImages=e.registerImage=e.version=void 0;var r=n(6898),i=n(5178);Object.defineProperty(e,"version",{enumerable:!0,get:function(){return(0,r.__importDefault)(i).default}});var o=n(1003);Object.defineProperty(e,"registerImage",{enumerable:!0,get:function(){return o.registerImage}}),Object.defineProperty(e,"registerImages",{enumerable:!0,get:function(){return o.registerImages}}),Object.defineProperty(e,"unregisterImage",{enumerable:!0,get:function(){return o.unregisterImage}}),Object.defineProperty(e,"registerFontFace",{enumerable:!0,get:function(){return o.registerFontFace}}),Object.defineProperty(e,"unregisterFontFace",{enumerable:!0,get:function(){return o.unregisterFontFace}}),Object.defineProperty(e,"registerIconFont",{enumerable:!0,get:function(){return o.registerIconFont}}),Object.defineProperty(e,"registerIconFonts",{enumerable:!0,get:function(){return o.registerIconFonts}}),Object.defineProperty(e,"unregisterIconFont",{enumerable:!0,get:function(){return o.unregisterIconFont}});var a=n(4896);Object.defineProperty(e,"getTheme",{enumerable:!0,get:function(){return a.getTheme}}),Object.defineProperty(e,"registerTheme",{enumerable:!0,get:function(){return a.registerTheme}}),(0,r.__exportStar)(n(6829),e);var s=n(3108);Object.defineProperty(e,"Map",{enumerable:!0,get:function(){return s.Map}});var u=n(3722);Object.defineProperty(e,"Plot",{enumerable:!0,get:function(){return u.Plot}});var l=n(514);Object.defineProperty(e,"L7Plot",{enumerable:!0,get:function(){return l.L7Plot}});var c=n(4833);Object.defineProperty(e,"DotLayer",{enumerable:!0,get:function(){return c.DotLayer}});var h=n(6097);Object.defineProperty(e,"IconLayer",{enumerable:!0,get:function(){return h.IconLayer}});var p=n(2178);Object.defineProperty(e,"DotDensityLayer",{enumerable:!0,get:function(){return p.DotDensityLayer}});var f=n(6877);Object.defineProperty(e,"TextLayer",{enumerable:!0,get:function(){return f.TextLayer}});var d=n(9455);Object.defineProperty(e,"HeatmapLayer",{enumerable:!0,get:function(){return d.HeatmapLayer}});var m=n(8218);Object.defineProperty(e,"GridLayer",{enumerable:!0,get:function(){return m.GridLayer}});var g=n(5827);Object.defineProperty(e,"HexbinLayer",{enumerable:!0,get:function(){return g.HexbinLayer}});var y=n(3314);Object.defineProperty(e,"PathLayer",{enumerable:!0,get:function(){return y.PathLayer}});var v=n(6246);Object.defineProperty(e,"ArcLayer",{enumerable:!0,get:function(){return v.ArcLayer}});var _=n(3407);Object.defineProperty(e,"AreaLayer",{enumerable:!0,get:function(){return _.AreaLayer}});var x=n(705);Object.defineProperty(e,"PrismLayer",{enumerable:!0,get:function(){return x.PrismLayer}});var b=n(8327);Object.defineProperty(e,"Dot",{enumerable:!0,get:function(){return b.Dot}});var w=n(9178);Object.defineProperty(e,"DotDensity",{enumerable:!0,get:function(){return w.DotDensity}});var S=n(9077);Object.defineProperty(e,"Heatmap",{enumerable:!0,get:function(){return S.Heatmap}});var E=n(2712);Object.defineProperty(e,"Grid",{enumerable:!0,get:function(){return E.Grid}});var C=n(3096);Object.defineProperty(e,"Hexbin",{enumerable:!0,get:function(){return C.Hexbin}});var M=n(6964);Object.defineProperty(e,"Path",{enumerable:!0,get:function(){return M.Path}});var T=n(6430);Object.defineProperty(e,"Flow",{enumerable:!0,get:function(){return T.Flow}});var A=n(1863);Object.defineProperty(e,"Area",{enumerable:!0,get:function(){return A.Area}});var P=n(9878);Object.defineProperty(e,"Choropleth",{enumerable:!0,get:function(){return P.Choropleth}})},6246:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ArcLayer=void 0;var r=n(6898),i=n(1745),o=n(9861),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.LinesLayer.LayerType.ArcLayer,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepAssign)({},o.LinesLayer.DefaultOptions,{shape:"arc"})},e}(o.LinesLayer);e.ArcLayer=a},8582:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=e.getDefaultState=void 0;var r=n(4859),i=n(9268),o="#2f54eb",a={active:{fill:!1,stroke:o,lineWidth:1.5,lineOpacity:.8},select:{fill:!1,stroke:o,lineWidth:1.5,lineOpacity:.8}};e.getDefaultState=function(t){return(0,r.isUndefined)(t)||(!1===t.active?a.active=Object.assign(a.active,{fill:!1,stroke:!1}):"object"==typeof t.active&&(!1===t.active.fill?a.active.fill=!1:"string"==typeof t.active.fill&&(a.active.fill=t.active.fill),!1===t.active.stroke?a.active.stroke=!1:"string"==typeof t.active.stroke&&(a.active.stroke=t.active.stroke),"number"==typeof t.active.lineWidth&&(a.active.lineWidth=t.active.lineWidth),"number"==typeof t.active.lineOpacity&&(a.active.lineOpacity=t.active.lineOpacity)),!1===t.select?a.select=Object.assign(a.select,{fill:!1,stroke:!1}):"object"==typeof t.select&&(!1===t.select.fill?a.select.fill=!1:"string"==typeof t.select.fill&&(a.select.fill=t.select.fill),!1===t.select.stroke?a.select.stroke=!1:"string"==typeof t.select.stroke&&(a.select.stroke=t.select.stroke),"number"==typeof t.select.lineWidth&&(a.select.lineWidth=t.select.lineWidth),"number"==typeof t.select.lineOpacity&&(a.select.lineOpacity=t.select.lineOpacity))),a},e.mappingLayer=function(t,n,r,o,a,s){var u=s.color,l=s.style,c=s.state,h=(0,e.getDefaultState)(c),p={active:!1!==h.active.fill&&{color:h.active.fill},select:!1},f={opacity:null==l?void 0:l.opacity},d=null==l?void 0:l.fillBottomColor,m=null==l?void 0:l.lineWidth,g=null==l?void 0:l.stroke,y={opacity:null==l?void 0:l.lineOpacity,dashArray:null==l?void 0:l.lineDash,lineType:null==l?void 0:l.lineType};if(i.MappingLayer.shape(t,"fill"),u&&i.MappingLayer.color(t,u),f&&i.MappingLayer.style(t,f),p&&i.MappingLayer.state(t,p),d&&t.setBottomColor(d),i.MappingLayer.shape(n,"line"),m&&i.MappingLayer.size(n,m),g&&i.MappingLayer.color(n,g),y&&i.MappingLayer.style(n,y),h.active.stroke){var v=h.active.stroke,_=h.active.lineWidth||m,x={opacity:h.active.lineOpacity};i.MappingLayer.shape(r,"line"),_&&i.MappingLayer.size(r,_),v&&i.MappingLayer.color(r,v),x&&i.MappingLayer.style(r,x)}if(h.select.fill){var b=h.select.fill;i.MappingLayer.shape(o,"fill"),b&&i.MappingLayer.color(o,b),f&&i.MappingLayer.style(o,f),i.MappingLayer.state(o,{select:!1,active:!1})}if(h.select.stroke){var w=h.select.stroke,S=(_=h.select.lineWidth||m,{opacity:h.select.lineOpacity});i.MappingLayer.shape(a,"line"),_&&i.MappingLayer.size(a,_),w&&i.MappingLayer.color(a,w),S&&i.MappingLayer.style(a,S)}}},3407:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AreaLayer=void 0;var r=n(6898),i=n(4859),o=n(137),a=n(9025),s=n(8582),u=n(3432),l={visible:!0,state:{active:!1,select:!1},enabledMultiSelect:!1},c=["color","style","state","enabledMultiSelect"],h=function(t){function e(e){var n=t.call(this,e)||this;n.selectData=[],n.type=a.PlotLayer.LayerType.AreaLayer,n.interaction=!0,n.onHighlighHandle=function(t){var e=t.feature,r=t.featureId;n.setHighlightLayerSource(e,r)},n.onUnhighlighHandle=function(){n.setHighlightLayerSource()},n.onSelectHandle=function(t){var e=n.options.enabledMultiSelect,r=t.feature,o=t.featureId,a=(0,i.clone)(n.selectData),s=a.findIndex((function(t){return t.featureId===o}));if(-1===s)e?a.push({feature:r,featureId:o}):a=[{feature:r,featureId:o}],n.emit("select",r,(0,i.clone)(a));else{var u=a[s];e?a.splice(s,1):a=[],n.emit("unselect",u,(0,i.clone)(a))}n.setSelectLayerSource(a)};var u=n.options,l=u.name,c=u.source,h=u.visible,p=u.minZoom,f=u.maxZoom,d=u.zIndex,m=void 0===d?0:d,g=n.pickLayerConfig(n.options),y=(0,s.getDefaultState)(n.options.state);return n.name=l||(0,i.uniqueId)(n.type),n.layer=new o.PolygonLayer((0,r.__assign)((0,r.__assign)({},g),{name:n.name})),n.strokeLayer=new o.LineLayer({name:"strokeLayer",visible:h,zIndex:m,minZoom:p,maxZoom:f}),n.highlightLayer=new o.LineLayer({name:"highlightLayer",visible:h&&Boolean(y.active.stroke),zIndex:m+.1,minZoom:p,maxZoom:f}),n.selectFillLayer=new o.PolygonLayer({name:"selectFillLayer",visible:h&&Boolean(y.select.fill),zIndex:m+.1,minZoom:p,maxZoom:f}),n.selectStrokeLayer=new o.LineLayer({name:"selectStrokeLayer",visible:h&&Boolean(y.select.stroke),zIndex:m+.1,minZoom:p,maxZoom:f}),n.mappingLayer(n.options),n.setSource(c),n.initEvent(),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return l},e.prototype.mappingLayer=function(t){(0,s.mappingLayer)(this.layer,this.strokeLayer,this.highlightLayer,this.selectFillLayer,this.selectStrokeLayer,t)},e.prototype.setSource=function(e){t.prototype.setSource.call(this,e),this.setStrokeLayerSource(),this.setHighlightLayerSource(),this.selectFillLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.selectStrokeLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}})},e.prototype.setStrokeLayerSource=function(){var t=this.layer.getSource();if(t)this.strokeLayer.setSource(t);else{var e=this.layer.sourceOption,n=e.data,r=e.options;this.strokeLayer.source(n,r)}},e.prototype.setHighlightLayerSource=function(t,e){if(void 0===e&&(e=-999),this.highlightLayerData!==e){var n=t?[t]:[];this.highlightLayer.setData({type:"FeatureCollection",features:n},{parser:{type:"geojson"}}),this.highlightLayerData=e}},e.prototype.setSelectLayerSource=function(t){if(void 0===t&&(t=[]),this.selectData.length!==t.length||!(0,i.isEqual)(this.selectData.map((function(t){return t.featureId})),t.map((function(t){return t.featureId})))){var e=t.map((function(t){return t.feature}));this.selectFillLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectStrokeLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectData=t}},e.prototype.initEvent=function(){this.layer.off("mousemove",this.onHighlighHandle),this.layer.off("unmousemove",this.onHighlighHandle),this.layer.off("click",this.onSelectHandle),this.selectData=[],this.highlightLayerData=null,this.options.state&&(this.options.state.active&&(this.layer.on("mousemove",this.onHighlighHandle),this.layer.on("unmousemove",this.onUnhighlighHandle)),this.options.state.select&&this.layer.on("click",this.onSelectHandle))},e.prototype.addTo=function(t){t.addLayer(this.layer),t.addLayer(this.strokeLayer),t.addLayer(this.highlightLayer),t.addLayer(this.selectFillLayer),t.addLayer(this.selectStrokeLayer)},e.prototype.remove=function(t){t.removeLayer(this.layer),t.removeLayer(this.strokeLayer),t.removeLayer(this.highlightLayer),t.removeLayer(this.selectFillLayer),t.removeLayer(this.selectStrokeLayer)},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this.mappingLayer(this.options),this.options.visible){(0,i.isUndefined)(e.state)||(0,i.isEqual)(this.lastOptions.state,this.options.state)||this.updateHighlightLayer();var n=(0,s.getDefaultState)(this.options.state);n.active.stroke&&this.setHighlightLayerSource(),(n.select.fill||n.select.stroke)&&this.setSelectLayerSource()}this.initEvent()},e.prototype.updateHighlightLayer=function(){var t=(0,s.getDefaultState)(this.options.state),e=(0,s.getDefaultState)(this.lastOptions.state);e.active.stroke!==t.active.stroke&&(t.active.stroke?this.highlightLayer.show():this.highlightLayer.hide()),e.select.fill!==t.select.fill&&(t.select.fill?this.selectFillLayer.show():this.selectFillLayer.hide()),e.select.stroke!==t.select.stroke&&(t.select.stroke?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())},e.prototype.setIndex=function(t){this.layer.setIndex(t),this.strokeLayer.setIndex(t),this.highlightLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1)},e.prototype.setMinZoom=function(t){this.layer.setMinZoom(t),this.strokeLayer.setMinZoom(t),this.highlightLayer.setMinZoom(t),this.selectFillLayer.setMinZoom(t),this.selectStrokeLayer.setMinZoom(t)},e.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t),this.strokeLayer.setMaxZoom(t),this.highlightLayer.setMaxZoom(t),this.selectFillLayer.setMaxZoom(t),this.selectStrokeLayer.setMaxZoom(t)},e.prototype.show=function(){this.layer.inited&&(this.layer.show(),this.strokeLayer.show(),this.selectFillLayer.show(),this.selectStrokeLayer.show())},e.prototype.hide=function(){this.layer.inited&&(this.layer.hide(),this.strokeLayer.hide(),this.selectFillLayer.hide(),this.selectStrokeLayer.hide())},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?(0,u.getColorLegendItems)(t):[]},e.prototype.setActive=function(t){},e.prototype.setSelect=function(t){},e.DefaultOptions=l,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(c),e}(a.PlotLayer);e.AreaLayer=h},5550:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ColumnLayer=void 0;var r=n(6898),i=n(1745),o=n(4833),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.DotLayer.LayerType.ColumnLayer,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepAssign)({},o.DotLayer.DefaultOptions,{shape:"cylinder"})},e}(o.DotLayer);e.ColumnLayer=a},2178:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DotDensityLayer=void 0;var r=n(6898),i=n(1745),o=n(4833),a=["color","size","style","state","animate"],s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.DotLayer.LayerType.DotDensity,e.interaction=!1,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepAssign)({},o.DotLayer.DefaultOptions,{shape:"dot",size:1})},e.LayerOptionsKeys=o.DotLayer.LayerConfigkeys.concat(a),e}(o.DotLayer);e.DotDensityLayer=s},5054:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(9268);e.mappingLayer=function(t,e){var n=e.shape,i=e.color,o=e.size,a=e.style,s=e.state,u=e.animate;n&&r.MappingLayer.shape(t,n),o&&r.MappingLayer.size(t,o),i&&r.MappingLayer.color(t,i),a&&r.MappingLayer.style(t,a),s&&r.MappingLayer.state(t,s),u&&r.MappingLayer.animate(t,u)}},3432:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getColorLegendItems=void 0;var r=n(6898),i=n(3057);e.getColorLegendItems=function(t){return function(t){return!Array.isArray(t[0].value)}(t)?t:t.map((function(t){return(0,r.__assign)((0,r.__assign)({},t),{value:[(0,i.round)(t.value[0],2),(0,i.round)(t.value[1],2)]})}))}},4833:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DotLayer=void 0;var r=n(6898),i=n(4859),o=n(137),a=n(9025),s=n(5054),u=n(3432),l={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"circle",size:12,color:"#5FD3A6"},c=["shape","color","size","style","state","animate"],h=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.DotLayer,n.interaction=!0;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.PointLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return l},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?(0,u.getColorLegendItems)(t):[]},e.DefaultOptions=l,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(c),e}(a.PlotLayer);e.DotLayer=h},8133:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(9268);e.mappingLayer=function(t,e){var n=e.shape,i=e.color,o=e.size,a=e.style,s=e.state;n&&r.MappingLayer.shape(t,n),o&&r.MappingLayer.size(t,o),i&&r.MappingLayer.color(t,i),a&&r.MappingLayer.style(t,a),s&&r.MappingLayer.state(t,s)}},8218:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GridLayer=void 0;var r=n(6898),i=n(4859),o=n(137),a=n(9025),s=n(8133),u={source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"grid",field:"",radius:15e3,method:"sum"}},shape:"square",color:"#5FD3A6",style:{coverage:.9,angle:0,opacity:1}},l=["shape","color","size","style","state"],c=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.GridLayer,n.interaction=!1;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.HeatmapLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return u},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=u,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(l),e}(a.PlotLayer);e.GridLayer=c},9051:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(9268);e.mappingLayer=function(t,e){var n=e.shape,i=e.size,o=e.style,a=e.state;n&&r.MappingLayer.shape(t,n),i&&r.MappingLayer.size(t,i),o&&("colorsRamp"in o&&(o.rampColors=function(t){var e=t.colorsRamp,n={colors:[],positions:[]};return e.forEach((function(t){var e=t.color,r=t.position;n.colors.push(e),n.positions.push(r)})),n}(o)),r.MappingLayer.style(t,o)),a&&r.MappingLayer.state(t,a)}},9455:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HeatmapLayer=void 0;var r=n(6898),i=n(4859),o=n(137),a=n(9025),s=n(9051),u={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"heatmap",size:{value:[0,1]},style:{intensity:3,radius:20,opacity:1,colorsRamp:[{color:"rgba(33,102,172,0.0)",position:0},{color:"rgb(103,169,207)",position:.2},{color:"rgb(209,229,240)",position:.4},{color:"rgb(253,219,199)",position:.6},{color:"rgb(239,138,98)",position:.8},{color:"rgb(178,24,43,1.0)",position:1}]}},l=["shape","color","size","style","state"],c=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.HeatmapLayer,n.interaction=!1;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.HeatmapLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return u},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=u,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(l),e}(a.PlotLayer);e.HeatmapLayer=c},5098:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(9268);e.mappingLayer=function(t,e){var n=e.shape,i=e.color,o=e.size,a=e.style,s=e.state;n&&r.MappingLayer.shape(t,n),o&&r.MappingLayer.size(t,o),i&&r.MappingLayer.color(t,i),a&&r.MappingLayer.style(t,a),s&&r.MappingLayer.state(t,s)}},5827:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HexbinLayer=void 0;var r=n(6898),i=n(4859),o=n(137),a=n(9025),s=n(5098),u={source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"hexagon",field:"",radius:15e3,method:"sum"}},shape:"hexagon",color:"#5FD3A6",style:{coverage:.9,angle:0,opacity:1}},l=["shape","color","size","style","state"],c=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.HexbinLayer,n.interaction=!1;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.HeatmapLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return u},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=u,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(l),e}(a.PlotLayer);e.HexbinLayer=c},6097:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IconLayer=void 0;var r=n(6898),i=n(1745),o=n(4833),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.DotLayer.LayerType.IconLayer,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepAssign)({},o.DotLayer.DefaultOptions,{color:void 0})},e}(o.DotLayer);e.IconLayer=a},1281:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(9268);e.mappingLayer=function(t,e){var n=e.shape,i=e.color,o=e.size,a=e.style,s=e.state,u=e.animate,l=e.texture;n&&r.MappingLayer.shape(t,n),o&&r.MappingLayer.size(t,o),i&&r.MappingLayer.color(t,i),a&&r.MappingLayer.style(t,a),s&&r.MappingLayer.state(t,s),u&&r.MappingLayer.animate(t,u),l&&r.MappingLayer.texture(t,l)}},9861:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LinesLayer=void 0;var r=n(6898),i=n(4859),o=n(137),a=n(9025),s=n(1281),u=n(3432),l={},c=["shape","color","size","style","state","animate"],h=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.LinesLayer,n.interaction=!0;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.LineLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return l},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?(0,u.getColorLegendItems)(t):[]},e.DefaultOptions=l,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(c),e}(a.PlotLayer);e.LinesLayer=h},3314:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PathLayer=void 0;var r=n(6898),i=n(1745),o=n(9861),a=["color","size","style","state","animate"],s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.LinesLayer.LayerType.PathLayer,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,i.deepAssign)({},o.LinesLayer.DefaultOptions,{shape:"line"})},e.LayerOptionsKeys=o.LinesLayer.LayerConfigkeys.concat(a),e}(o.LinesLayer);e.PathLayer=s},8148:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(9268);e.mappingLayer=function(t,e){var n=e.color,i=e.size,o=e.style,a=e.state;r.MappingLayer.shape(t,"extrude"),i&&r.MappingLayer.size(t,i),n&&r.MappingLayer.color(t,n),o&&r.MappingLayer.style(t,o),a&&r.MappingLayer.state(t,a)}},705:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PrismLayer=void 0;var r=n(6898),i=n(4859),o=n(137),a=n(9025),s=n(8148),u=n(3432),l={},c=["color","size","style","state"],h=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.PrismLayer,n.interaction=!0;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.PolygonLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return l},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?(0,u.getColorLegendItems)(t):[]},e.DefaultOptions=l,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(c),e}(a.PlotLayer);e.PrismLayer=h},1776:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mappingLayer=void 0;var r=n(9268);e.mappingLayer=function(t,e){var n=e.field,i=e.content,o=e.style,a=void 0===o?{}:o,s=e.state,u=a.fontSize,l=a.fill,c={field:n||i||"",value:"text"};r.MappingLayer.shape(t,c),u&&r.MappingLayer.size(t,u),l&&r.MappingLayer.color(t,l),a&&r.MappingLayer.style(t,a),s&&r.MappingLayer.state(t,s)}},6877:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayer=void 0;var r=n(6898),i=n(4859),o=n(137),a=n(9025),s=n(1776),u={style:{fontSize:12}},l=[],c=function(t){function e(e){var n=t.call(this,e)||this;n.type=a.PlotLayer.LayerType.TextLayer,n.interaction=!1;var s=n.options,u=s.name,l=s.source,c=n.pickLayerConfig(n.options);return n.name=u||(0,i.uniqueId)(n.type),n.layer=new o.PointLayer((0,r.__assign)((0,r.__assign)({},c),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(l),n}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return u},e.prototype.mappingLayer=function(t,e){(0,s.mappingLayer)(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=u,e.LayerOptionsKeys=a.PlotLayer.LayerConfigkeys.concat(l),e}(a.PlotLayer);e.TextLayer=c},514:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.L7Plot=void 0;var r=n(6898),i=n(4859),o=n(3108),a=n(1745),s=n(6954),u=n(182),l={},c=function(t){function e(e,n){var r=t.call(this,n)||this;return r.plots=[],r.container=r.createContainer(e),r.theme=r.createTheme(),r.scene=r.createScene(),r.registerResources(),r.render(),r.inited=!0,r}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return(0,a.deepAssign)({},o.Map.DefaultOptions,e.DefaultOptions)},e.prototype.createLayers=function(){for(var t=new s.LayerGroup([]),e=this.options.layers||[],n=0;n<e.length;n++){var r=this.createLayer(e[n]);t.addLayer(r)}return t},e.prototype.createLayer=function(t){var e=t.type,n=(0,r.__rest)(t,["type"]),o=u.LAYERS_MAP[e];if((0,i.isUndefined)(o))throw new Error("Don't exist ".concat(e," layer"));return new o(n)},e.prototype.addLayer=function(e){if(function(t){return"function"==typeof t.render}(e))t.prototype.addLayer.call(this,e);else{var n=this.createLayer(e);t.prototype.addLayer.call(this,n)}},e.prototype.removeLayerByName=function(t){var e=this.layerGroup.getLayerByName(t);return!!e&&this.layerGroup.removeLayer(e)},e.prototype.updateLayers=function(t){},e.prototype.updatePlots=function(t){},e.prototype.render=function(){var t=this,e=this.createLayers();this.inited?(this.layerGroup.removeAllLayer(),e.addTo(this.scene),this.layerGroup=e,this.updateControls()):(this.layerGroup=e,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(function(){t.onSceneLoaded()})))},e.prototype.onSceneLoaded=function(){var t=this;this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",(function(){t.onLayersLoaded()})),this.layerGroup.addTo(this.scene)},e.prototype.onLayersLoaded=function(){this.layersLoaded=!0,this.renderPlots(),this.initControls(),this.loaded=!0,this.emit("loaded")},e.prototype.renderPlots=function(){for(var t=this.options.plots||[],e=0;e<t.length;e++){var n=t[e],r=this.createPlot(n);this.plots.push(r)}},e.prototype.createPlot=function(t){var e=t.type,n=(t.legend,t.layerMenu,(0,r.__rest)(t,["type","legend","layerMenu"])),o=u.PLOTS_MAP[e];if((0,i.isUndefined)(o))throw new Error("Don't exist ".concat(e," plot"));var a=new o(n);return a.attachToScene(this.scene,this.theme),a},e.prototype.addPlot=function(t){var e=this.createPlot(t);this.plots.push(e)},e.prototype.getPlots=function(){return this.plots},e.prototype.getPlotByName=function(t){return this.plots.find((function(e){var n;return(null===(n=e.options)||void 0===n?void 0:n.name)===t}))},e.prototype.removePlotByName=function(t){var e=this.plots.findIndex((function(e){var n;return(null===(n=e.options)||void 0===n?void 0:n.name)===t}));return-1!==e&&((0,r.__read)(this.plots.splice(e,1),1)[0].unattachFromScene(),!0)},e.prototype.removeAllPlot=function(){this.plots.forEach((function(t){t.unattachFromScene()})),this.plots=[]},e.DefaultOptions=l,e}(o.Map);e.L7Plot=c},182:(t,e,n)=>{"use strict";var r,i;Object.defineProperty(e,"__esModule",{value:!0}),e.LAYERS_MAP=e.PLOTS_MAP=void 0;var o=n(6829),a=n(8327),s=n(9178),u=n(9077),l=n(2712),c=n(3096),h=n(6964),p=n(6430),f=n(1863),d=n(9878),m=n(6877),g=n(4833),y=n(6097),v=n(5550),_=n(2178),x=n(8218),b=n(5827),w=n(3314),S=n(6246),E=n(9455),C=n(3407),M=n(705);e.PLOTS_MAP=((r={})[o.PlotType.Dot]=a.Dot,r[o.PlotType.DotDensity]=s.DotDensity,r[o.PlotType.Heatmap]=u.Heatmap,r[o.PlotType.Grid]=l.Grid,r[o.PlotType.Hexbin]=c.Hexbin,r[o.PlotType.Path]=h.Path,r[o.PlotType.Flow]=p.Flow,r[o.PlotType.Area]=f.Area,r[o.PlotType.Choropleth]=d.Choropleth,r),e.LAYERS_MAP=((i={})[o.LayerType.TextLayer]=m.TextLayer,i[o.LayerType.DotLayer]=g.DotLayer,i[o.LayerType.IconLayer]=y.IconLayer,i[o.LayerType.DotDensity]=_.DotDensityLayer,i[o.LayerType.ColumnLayer]=v.ColumnLayer,i[o.LayerType.HeatmapLayer]=E.HeatmapLayer,i[o.LayerType.GridLayer]=x.GridLayer,i[o.LayerType.HexbinLayer]=b.HexbinLayer,i[o.LayerType.PathLayer]=w.PathLayer,i[o.LayerType.ArcLayer]=S.ArcLayer,i[o.LayerType.AreaLayer]=C.AreaLayer,i[o.LayerType.PrismLayer]=M.PrismLayer,i)},8555:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3722),i=n(1745);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}})},1863:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Area=void 0;var r=n(6898),i=n(4859),o=n(3722),a=n(8555),s=n(3407),u=n(6954),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Area,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.areaLayer=new s.AreaLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.AreaLayer.LayerOptionsKeys)));var e=new u.LayerGroup([this.areaLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.AreaLayer.LayerOptionsKeys);this.areaLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.initLayersEvent=function(){},e.prototype.getLegendOptions=function(){var t=this.areaLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Area=l},4291:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unregisterCacheArea=e.hasCacheArea=e.getCacheArea=e.registerCacheAreas=e.registerCacheArea=e.AREA_CACHE=void 0,e.AREA_CACHE=new Map,e.registerCacheArea=function(t,n){e.AREA_CACHE.set(t,n)},e.registerCacheAreas=function(t){t.forEach((function(t){e.AREA_CACHE.set(t.key,t.area)}))},e.getCacheArea=function(t){return e.AREA_CACHE.get(t)},e.hasCacheArea=function(t){return e.AREA_CACHE.has(t)},e.unregisterCacheArea=function(t){return e.AREA_CACHE.delete(t)}},19:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CHINA_BOUNDARY_STYLE=e.GEO_AREA_URL=e.GEO_DATA_URL=e.DEFAULT_AREA_GRANULARITY=e.DEFAULT_OPTIONS=void 0;var r=n(3722),i=n(1745);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],joinBy:{geoField:"adcode"}},viewLevel:{level:"country",adcode:"100000"},chinaBorder:!0}),e.DEFAULT_AREA_GRANULARITY={world:"country",country:"province",province:"city",city:"district",district:"district"},e.GEO_DATA_URL="https://gw.alipayobjects.com/os/alisis/geo-data-v0.1.2",e.GEO_AREA_URL="".concat(e.GEO_DATA_URL,"/choropleth-data"),e.CHINA_BOUNDARY_STYLE={national:{color:"red",width:1,opacity:1},dispute:{color:"red",width:1,opacity:.8,dashArray:[1,6]},coast:{color:"blue",width:.7,opacity:.8},hkm:{color:"gray",width:.7,opacity:.8}}},3159:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDrillStepDefaultConfig=e.isEqualDrillSteps=e.topojson2geojson=e.getGeoAreaConfig=void 0;var r=n(6898),i=n(4859),o=(0,r.__importStar)(n(3273)),a=n(19);e.getGeoAreaConfig=function(t){var e={url:a.GEO_AREA_URL,type:"topojson",extension:"topo.json"};return(0,i.isUndefined)(t)||("string"==typeof t?e.url=t:(e.url=(null==t?void 0:t.url)||a.GEO_AREA_URL,e.type=t.type,e.extension="topojson"===t.type?"topo.json":"json")),e},e.topojson2geojson=function(t){try{return o.feature(t,"json")}catch(t){throw new Error('Failed convert to geojson from topojson, topojson default layer name "json"')}},e.isEqualDrillSteps=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++){var r=t[n],i=r.level,o=r.granularity;if(e[n].level!==i||e[n].granularity!==o)return!1}return!0},e.getDrillStepDefaultConfig=function(t){return(0,i.pick)(t,["source","color","style","state","label","tooltip"])}},9878:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Choropleth=void 0;var r=n(6898),i=n(4859),o=n(3722),a=n(1745),s=n(19),u=n(3407),l=n(6877),c=n(6829),h=n(6954),p=n(7369),f=n(4291),d=n(3159),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Choropleth,e.chinaBoundaryData={type:"FeatureCollection",features:[]},e.currentDistrictData={type:"FeatureCollection",features:[]},e.drillSteps=[],e.drillStacks=[],e.onDrillDownHander=function(t){var n,i=e.options.drill,o=i.steps,u=i.onDown,l=null===(n=t.feature)||void 0===n?void 0:n.properties,c=l.adcode;if(e.drillStacks.length!==o.length+1){var h=e.drillStacks.slice(-1)[0],p=e.drillStacks.length-1,f=e.drillSteps[p],d=f.level,m=f.granularity,g=void 0===m?s.DEFAULT_AREA_GRANULARITY[d]:m,y=(0,r.__rest)(f,["level","granularity"]),v={from:{level:h.level,adcode:h.adcode,granularity:h.granularity},to:{level:d,adcode:c,granularity:g,properties:l}},_=function(t){void 0===t&&(t={});var n={level:d,adcode:c,granularity:g},r=(0,a.deepAssign)({},y,t);e.changeView(n,r).then((function(t){t&&(e.drillStacks.push(t),e.emit("drilldown",v))}))};u?u(v.from,v.to,_):_()}},e.onDrillUpHander=function(){var t=e.options.drill.onUp;if(0!==e.drillStacks.length&&1!==e.drillStacks.length){var n=e.drillStacks.length-1,r=e.drillStacks[n],i=e.drillStacks[n-1],o={from:{level:r.level,adcode:r.adcode,granularity:r.granularity},to:{level:i.level,adcode:i.adcode,granularity:i.granularity}},s=function(t){void 0===t&&(t={});var n=o.to,r=(0,a.deepAssign)({},i.config,t);e.changeView(n,r).then((function(t){t&&(e.drillStacks.pop(),e.emit("drillup",o))}))};t?t(o.from,o.to,s):s()}},e}return(0,r.__extends)(e,t),e.prototype.initSource=function(){var t=this;this.getInitDistrictData().then((function(){t.source=t.createSource(),t.render(),t.inited=!0}))},e.prototype.render=function(){var t=this;if(console.time("l7plot choropleth render time"),this.inited)this.scene.setEnableRender(!0),this.scene.render();else{var e=this.createLayers(this.source);this.layerGroup=e,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(function(){t.onSceneLoaded()})),this.initLayersEvent()}console.timeEnd("l7plot choropleth render time")},e.prototype.update=function(t){var e,n,o,a=this;if(this.updateOption(t),t.map&&!(0,i.isEqual)(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),t.drill&&!1!==t.drill.enabled&&!(0,i.isEqual)(null===(e=this.lastOptions.drill)||void 0===e?void 0:e.steps,null===(n=this.options.drill)||void 0===n?void 0:n.steps)&&(this.drillReset(),this.initDrillEvent()),this.scene.setEnableRender(!1),t.viewLevel&&!(0,i.isEqual)(this.lastOptions.viewLevel,this.options.viewLevel)){var s=null===(o=t.source)||void 0===o?void 0:o.joinBy.geoData;console.time("l7plot choropleth update viewLevel time"),this.getDistrictData(s).then((function(){var e=a.options.source,n=e.data,i=(0,r.__rest)(e,["data"]);a.changeData(n,i),a.updateLayers(t),a.render(),a.updateComponents(),console.timeEnd("l7plot choropleth update viewLevel time"),a.emit("update")}))}else{if(t.source&&!(0,i.isEqual)(this.lastOptions.source,this.options.source)){var u=this.options.source,l=u.data,c=(0,r.__rest)(u,["data"]);this.changeData(l,c)}this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")}},e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.parserSourceConfig=function(t){var e=t.data,n=t.joinBy,i=(0,r.__rest)(t,["data","joinBy"]),o=n.sourceField,a=n.geoField,s=n.geoData,u={type:"join",sourceField:o,targetField:a,data:e};return i.transforms?i.transforms.push(u):i.transforms=[u],i.parser&&delete i.parser,{data:s,sourceCFG:i}},e.prototype.createSource=function(){var t=this.parserSourceConfig(this.options.source),e=t.data,n=t.sourceCFG;return new c.Source(e,n)},e.prototype.changeData=function(t,e){var n=this;console.time("l7plot choropleth update data time"),this.options.source=(0,a.deepAssign)({},this.options.source,(0,r.__assign)({data:t},e));var i=this.parserSourceConfig(this.options.source),o=i.data,s=i.sourceCFG;this.source.setData(o,s),console.timeEnd("l7plot choropleth update data time");var u=this.options.legend;u&&setTimeout((function(){n.updateLegendControl(u)})),this.emit("change-data")},e.prototype.createLayers=function(t){this.fillAreaLayer=new u.AreaLayer((0,r.__assign)({name:"fillAreaLayer",source:t},(0,i.pick)(this.options,u.AreaLayer.LayerOptionsKeys)));var e=new h.LayerGroup([this.fillAreaLayer]);if(this.options.chinaBorder){var n=this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options),o=n.chinaBoundaryLayer,a=n.chinaDisputeBoundaryLayer;this.chinaBoundaryLayer=o,this.chinaDisputeBoundaryLayer=a,e.addLayer(this.chinaBoundaryLayer),e.addLayer(this.chinaDisputeBoundaryLayer)}return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e},e.prototype.createCountryBoundaryLayer=function(t,e){var n=(0,p.createCountryBoundaryLayer)(t,e);return{chinaBoundaryLayer:n.chinaBoundaryLayer,chinaDisputeBoundaryLayer:n.chinaDisputeBoundaryLayer}},e.prototype.createLabelLayer=function(t,e){var n=this,i=t.originData.features.map((function(t){var e=t.properties;return Object.assign({},e,{centroid:e.centroid||e.center})})).filter((function(t){return t.centroid})),o=this.options,a=o.visible,s=o.minZoom,u=o.maxZoom,c=o.zIndex,h=void 0===c?0:c,p=new l.TextLayer((0,r.__assign)({name:"labelLayer",source:{data:i,parser:{type:"json",coordinates:"centroid"},transforms:t.transforms},visible:a,minZoom:s,maxZoom:u,zIndex:h+.1},e)),f=function(){var t=n.source.originData.features.map((function(t){return t.properties})).filter((function(t){return t.centroid}));p.layer.setData(t)};return t.on("update",f),p.on("remove",(function(){t.off("update",f)})),p},e.prototype.updateLayers=function(t){var e=this,n=(0,i.pick)(t,u.AreaLayer.LayerOptionsKeys);this.fillAreaLayer.update(n);var r=function(){var t=e.createCountryBoundaryLayer(e.chinaBoundaryData,e.options),n=t.chinaBoundaryLayer,r=t.chinaDisputeBoundaryLayer;e.chinaBoundaryLayer=n,e.chinaDisputeBoundaryLayer=r,e.layerGroup.addLayer(e.chinaBoundaryLayer),e.layerGroup.addLayer(e.chinaDisputeBoundaryLayer)},o=function(){e.chinaBoundaryLayer&&e.layerGroup.removeLayer(e.chinaBoundaryLayer),e.chinaDisputeBoundaryLayer&&e.layerGroup.removeLayer(e.chinaDisputeBoundaryLayer)};t.chinaBorder?this.chinaBoundaryLayer?(o(),r()):r():!1===t.chinaBorder&&o(),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.initLayersEvent=function(){this.initDrillEvent()},e.prototype.initDrillEvent=function(){if(this.lastOptions.drill){var t=this.lastOptions.drill,e=t.triggerUp,n=void 0===e?"unclick":e,r=t.triggerDown,i=void 0===r?"click":r;this.fillAreaLayer.off(n,this.onDrillUpHander),this.fillAreaLayer.off(i,this.onDrillDownHander)}if(this.options.drill&&!1!==this.options.drill.enabled){var o=this.options.drill,a=o.steps,u=o.triggerUp,l=void 0===u?"unclick":u,c=o.triggerDown,h=void 0===c?"click":c,p=a.map((function(t){return"string"==typeof t?{level:t,granularity:s.DEFAULT_AREA_GRANULARITY[t]}:(t.granularity||(t.granularity=s.DEFAULT_AREA_GRANULARITY[t.level]),t)}));if((0,d.isEqualDrillSteps)(p,this.drillSteps)||(this.drillSteps=p,this.drillStacks=[]),!this.drillStacks.length){var f=this.options.viewLevel,m=f.level,g=f.adcode,y=f.granularity,v=void 0===y?s.DEFAULT_AREA_GRANULARITY[m]:y,_=(0,d.getDrillStepDefaultConfig)(this.options);this.drillStacks=[{level:m,adcode:g,granularity:v,config:_}]}this.fillAreaLayer.on(l,this.onDrillUpHander),this.fillAreaLayer.on(h,this.onDrillDownHander)}},e.prototype.drillReset=function(){this.drillStacks=[]},e.prototype.getCurrentDrillSteps=function(){return this.drillStacks.map((function(t){return(0,i.pick)(t,["level","adcode","granularity"])}))},e.prototype.getLegendOptions=function(){var t=this.fillAreaLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.prototype.fetchData=function(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var i,o,a,s,u,l,c;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return i="".concat(e,"_").concat(t,"_").concat(n),(o=(0,f.getCacheArea)(i))?[2,o]:(a=(0,d.getGeoAreaConfig)(this.options.geoArea),s=a.url,u=a.type,l=a.extension,[4,fetch("".concat(s,"/").concat(t,"/").concat(i,".").concat(l))]);case 1:return[4,r.sent().json()];case 2:return c=r.sent(),"topojson"===u&&(c=(0,d.topojson2geojson)(c)),(0,f.registerCacheArea)(i,c),[2,c]}}))}))},e.prototype.getInitDistrictData=function(){var t;return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,n,i,o;return(0,r.__generator)(this,(function(a){switch(a.label){case 0:e=this.fetchData("country","100000","boundary"),n=null===(t=this.options.source)||void 0===t?void 0:t.joinBy.geoData,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Promise.all([e,this.getDistrictData(n)])];case 2:return o=r.__read.apply(void 0,[a.sent(),1]),this.chinaBoundaryData=o[0],[3,4];case 3:throw i=a.sent(),new Error("Failed to get china boundary data，".concat(i));case 4:return[2]}}))}))},e.prototype.getDistrictData=function(t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,n,i,o,u,l,c,h;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:e=this.options.viewLevel,n=e.level,i=e.adcode,o=e.granularity,u=void 0===o?s.DEFAULT_AREA_GRANULARITY[n]:o,l=t?Promise.resolve(t):this.fetchData(n,i,u),r.label=1;case 1:return r.trys.push([1,3,,4]),c=this,[4,l];case 2:return c.currentDistrictData=r.sent(),this.options.source=(0,a.deepAssign)({},this.options.source,{joinBy:{geoData:this.currentDistrictData}}),[3,4];case 3:throw h=r.sent(),new Error("Failed to get district data，".concat(h));case 4:return[2]}}))}))},e.prototype.drillDown=function(t,e){var n=this;void 0===e&&(e={}),this.changeView(t,e).then((function(t){t&&n.drillStacks.push(t)}))},e.prototype.drillUp=function(t,e){void 0===t&&(t={});var n=this.drillStacks.length;if(![0,1].includes(n)){var i=e?this.drillStacks.findIndex((function(t){return t.level===e})):-1,o=-1!==i,s=o?i:n-2,u=this.drillStacks[s],l=u.config,c=(0,r.__rest)(u,["config"]),h=(0,a.deepAssign)({},l,t);this.changeView(c,h),o?this.drillStacks.splice(i+1):this.drillStacks.pop()}},e.prototype.changeView=function(t,e){return void 0===e&&(e={}),(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,o,u,l,c;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=t.level,i=t.adcode,o=t.granularity,u=void 0===o?s.DEFAULT_AREA_GRANULARITY[n]:o,[4,this.fetchData(n,i,u)];case 1:return(l=r.sent()).features.length?(c=(0,a.deepAssign)({},(0,d.getDrillStepDefaultConfig)(this.options),e,{viewLevel:{level:n,adcode:i,granularity:u},source:{joinBy:{geoData:l}}}),this.update(c),[2,{level:n,adcode:i,granularity:u,config:c}]):[2]}}))}))},e.DefaultOptions=s.DEFAULT_OPTIONS,e.GeoDataUrl=s.GEO_DATA_URL,e.GeoAreaUrl=s.GEO_AREA_URL,e}(o.Plot);e.Choropleth=m},7369:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createCountryBoundaryLayer=void 0;var r=n(1745),i=n(3314),o=n(19);e.createCountryBoundaryLayer=function(t,e){var n=e||{},a=n.visible,s=n.minZoom,u=n.maxZoom,l=n.zIndex,c=void 0===l?0:l,h=n.chinaBorder,p="object"==typeof h?(0,r.deepAssign)({},o.CHINA_BOUNDARY_STYLE,h):o.CHINA_BOUNDARY_STYLE,f=t.features.filter((function(t){var e=t.properties;return["coast","hkm","national"].includes(null==e?void 0:e.type)})),d=t.features.filter((function(t){var e=t.properties;return"dispute"===(null==e?void 0:e.type)})),m=new i.PathLayer({name:"chinaBoundaryLayer",visible:a,minZoom:s,maxZoom:u,zIndex:c+.1,source:{data:{type:"FeatureCollection",features:f},parser:{type:"geojson"}},color:{field:"type",value:function(t){var e=t.type;return p[e].color}},size:{field:"type",value:function(t){var e=t.type;return p[e].width}},style:{opacity:["type",function(t){return p[t].opacity}]}});return{chinaBoundaryLayer:m,chinaDisputeBoundaryLayer:new i.PathLayer({name:"chinaDisputeBoundaryLayer",visible:a,minZoom:s,maxZoom:u,zIndex:c+.1,source:{data:{type:"FeatureCollection",features:d},parser:{type:"geojson"}},color:p.dispute.color,size:p.dispute.width,style:{opacity:p.dispute.opacity,lineType:"dash",dashArray:p.dispute.dashArray}})}}},9856:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3722),i=n(1745);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}})},9178:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DotDensity=void 0;var r=n(6898),i=n(4859),o=n(3722),a=n(9856),s=n(6954),u=n(2178),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.DotDensity,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){return this.dotDensityLayer=new u.DotDensityLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,u.DotDensityLayer.LayerOptionsKeys))),new s.LayerGroup([this.dotDensityLayer])},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,u.DotDensityLayer.LayerOptionsKeys);this.dotDensityLayer.update(e)},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.DotDensity=l},5:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3722),i=n(1745);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}})},8327:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Dot=void 0;var r=n(6898),i=n(4859),o=n(3722),a=n(5),s=n(4833),u=n(6954),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Dot,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.dotLayer=new s.DotLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.DotLayer.LayerOptionsKeys)));var e=new u.LayerGroup([this.dotLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.DotLayer.LayerOptionsKeys);this.dotLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.getLegendOptions=function(){var t=this.dotLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Dot=l},9907:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3722),i=n(1745);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json"}},shape:"arc"})},6430:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Flow=void 0;var r=n(6898),i=n(4859),o=n(3722),a=n(9907),s=n(6246),u=n(4833),l=n(6877),c=n(6954),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Flow,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.flowLayer=new s.ArcLayer((0,r.__assign)({name:"flowLayer",source:t},(0,i.pick)(this.options,s.ArcLayer.LayerOptionsKeys)));var e=new c.LayerGroup([this.flowLayer]);return this.options.radiation&&(this.radiationLayer=this.createRadiationLayer(t),e.addLayer(this.radiationLayer)),this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e},e.prototype.parserPointData=function(t){var e=[];return t.data.dataArray.forEach((function(t){var n=t.coordinates,i=(0,r.__read)(n,2)[1];e.push((0,r.__assign)((0,r.__assign)({},t),{coordinates:i}))})),e},e.prototype.createRadiationLayer=function(t){var e=this,n=this.parserPointData(t),r=this.options.radiation||{},i=r.enabled,o=void 0===i||i,a=r.color,s=r.size,l=void 0===s?20:s,c=r.shape,h=void 0===c?"circle":c,p=r.animate,f=void 0===p||p,d=new u.DotLayer({name:"radiationLayer",source:{data:n,parser:{type:"json",coordinates:"coordinates"}},visible:o,color:a,size:l,shape:h,animate:f}),m=function(){var t=e.parserPointData(e.source);d.layer.setData(t)};return t.on("update",m),d.on("remove",(function(){t.off("update",m)})),d},e.prototype.createLabelLayer=function(t,e){var n=this,i=this.parserPointData(t),o=this.options,a=o.visible,s=o.minZoom,u=o.maxZoom,c=o.zIndex,h=void 0===c?0:c,p=new l.TextLayer((0,r.__assign)({name:"labelLayer",source:{data:i,parser:{type:"json",coordinates:"coordinates"}},visible:a,minZoom:s,maxZoom:u,zIndex:h+.1},e)),f=function(){var t=n.parserPointData(n.source);p.layer.setData(t)};return t.on("update",f),p.on("remove",(function(){t.off("update",f)})),p},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.ArcLayer.LayerOptionsKeys);if(this.flowLayer.update(e),t.radiation)if(this.radiationLayer){var n=(0,r.__assign)((0,r.__assign)({},t.radiation),{visible:t.radiation.enabled});this.radiationLayer.update(n)}else this.radiationLayer=this.createRadiationLayer(this.source),this.layerGroup.addLayer(this.radiationLayer);this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.getLegendOptions=function(){var t=this.flowLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Flow=h},2206:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3722),i=n(1745);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"grid",radius:15e3,method:"sum"}}})},2712:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Grid=void 0;var r=n(6898),i=n(4859),o=n(3722),a=n(2206),s=n(8218),u=n(6954),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Grid,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.gridLayer=new s.GridLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.GridLayer.LayerOptionsKeys)));var e=new u.LayerGroup([this.gridLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.GridLayer.LayerOptionsKeys);this.gridLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Grid=l},7834:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3722),i=n(1745);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}})},9077:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Heatmap=void 0;var r=n(6898),i=n(4859),o=n(3722),a=n(7834),s=n(9455),u=n(6954),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Heatmap,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.heatmapLayer=new s.HeatmapLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.HeatmapLayer.LayerOptionsKeys)));var e=new u.LayerGroup([this.heatmapLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.HeatmapLayer.LayerOptionsKeys);this.heatmapLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.getLegendOptions=function(){var t,e=this.heatmapLayer.layer.getLegendItems("size");return Array.isArray(e)&&0!==e.length?{type:"continue",min:e[0].value,max:e[e.length-1].value,colors:null===(t=this.heatmapLayer.options.style)||void 0===t?void 0:t.colorsRamp.map((function(t){return t.color}))}:{}},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Heatmap=l},4766:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3722),i=n(1745);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"hexagon",radius:15e3,method:"sum"}}})},3096:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Hexbin=void 0;var r=n(6898),i=n(4859),o=n(3722),a=n(4766),s=n(5827),u=n(6954),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Hexbin,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.hexbinLayer=new s.HexbinLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.HexbinLayer.LayerOptionsKeys)));var e=new u.LayerGroup([this.hexbinLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.HexbinLayer.LayerOptionsKeys);this.hexbinLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Hexbin=l},7017:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_OPTIONS=void 0;var r=n(3722),i=n(1745);e.DEFAULT_OPTIONS=(0,i.deepAssign)({},r.Plot.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}})},6964:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Path=void 0;var r=n(6898),i=n(4859),o=n(3722),a=n(7017),s=n(3314),u=n(6954),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=o.Plot.PlotType.Path,e}return(0,r.__extends)(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){return this.pathLayer=new s.PathLayer((0,r.__assign)({source:t},(0,i.pick)(this.options,s.PathLayer.LayerOptionsKeys))),new u.LayerGroup([this.pathLayer])},e.prototype.updateLayers=function(t){var e=(0,i.pick)(t,s.PathLayer.LayerOptionsKeys);this.pathLayer.update(e)},e.prototype.getLegendOptions=function(){var t=this.pathLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=a.DEFAULT_OPTIONS,e}(o.Plot);e.Path=l},4896:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.registerTheme=e.getTheme=void 0;var r=n(4859),i=n(6510),o=(0,i.createTheme)({}),a={default:o,light:o,dark:(0,i.createDarkTheme)({})};e.getTheme=function(t){return void 0===t&&(t="default"),(0,r.get)(a,(0,r.lowerCase)(t),a.default)},e.registerTheme=function(t,e,n){void 0===n&&(n="light"),a[(0,r.lowerCase)(t)]="light"===n?(0,i.createTheme)(e):(0,i.createDarkTheme)(e)}},2313:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.dark=e.createDarkStyleSheet=void 0;var n="#FFFFFF",r="#A6A6A6",i=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],o=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],a=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"];e.createDarkStyleSheet=function(t){void 0===t&&(t={});var e=t.mapStyle,s=void 0===e?"dark":e,u=t.subColor,l=void 0===u?"rgba(255,255,255,0.05)":u,c=t.paletteQualitative10,h=void 0===c?i:c,p=t.paletteQualitative20,f=void 0===p?o:p,d=t.paletteSemanticRed,m=void 0===d?"#F4664A":d,g=t.paletteSemanticGreen,y=void 0===g?"#30BF78":g,v=t.paletteSemanticYellow,_=void 0===v?"#FAAD14":v,x=t.paletteSequence,b=void 0===x?a:x,w=t.fontFamily,S=void 0===w?'"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,\n    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",\n    "Noto Color Emoji"':w,E=t.brandColor;return{mapStyle:s,brandColor:void 0===E?h[0]:E,subColor:l,paletteQualitative10:h,paletteQualitative20:f,paletteSemanticRed:m,paletteSemanticGreen:y,paletteSemanticYellow:_,paletteSequence:b,fontFamily:S,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:r,legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:r,tooltipItemNameFillColor:r,tooltipItemValueFillColor:r,tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:r,labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:i[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:"#000",pointActiveBorderColor:n,pointSelectedBorderColor:n}},e.dark=(0,e.createDarkStyleSheet)()},9593:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.light=e.createLightStyleSheet=void 0;var n="#000",r="#595959",i=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],o=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],a=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"];e.createLightStyleSheet=function(t){void 0===t&&(t={});var e=t.mapStyle,s=void 0===e?"light":e,u=t.subColor,l=void 0===u?"rgba(0,0,0,0.05)":u,c=t.paletteQualitative10,h=void 0===c?i:c,p=t.paletteQualitative20,f=void 0===p?o:p,d=t.paletteSemanticRed,m=void 0===d?"#F4664A":d,g=t.paletteSemanticGreen,y=void 0===g?"#30BF78":g,v=t.paletteSemanticYellow,_=void 0===v?"#FAAD14":v,x=t.paletteSequence,b=void 0===x?a:x,w=t.fontFamily,S=void 0===w?'"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,\n    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",\n    "Noto Color Emoji"':w,E=t.brandColor,C=void 0===E?h[0]:E;return{mapStyle:s,brandColor:C,subColor:l,paletteQualitative10:h,paletteQualitative20:f,paletteSemanticRed:m,paletteSemanticGreen:y,paletteSemanticYellow:_,paletteSequence:b,fontFamily:S,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:r,legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:r,tooltipItemNameFillColor:r,tooltipItemValueFillColor:r,tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:r,labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:C,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:"#FFFFFF",pointActiveBorderColor:n,pointSelectedBorderColor:n}},e.light=(0,e.createLightStyleSheet)()},9640:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createThemeByStyleSheet=void 0;var r=n(6898),i=(0,r.__importStar)(n(1501)),o=(0,r.__importStar)(n(5864)),a=(0,r.__importStar)(n(3109));e.createThemeByStyleSheet=function(t){var e,n,r,s={point:{default:{fill:t.pointFillColor,size:t.pointSize,stroke:t.pointBorderColor,lineWidth:t.pointBorder,fillOpacity:t.pointFillOpacity},active:{fill:t.pointActiveFillColor},selected:{fill:t.pointSelectedFillColor}}};return{mapStyle:t.mapStyle,defaultColor:t.brandColor,subColor:t.subColor,semanticRed:t.paletteSemanticRed,semanticGreen:t.paletteSemanticGreen,fontFamily:t.fontFamily,colors10:t.paletteQualitative10,colors20:t.paletteQualitative20,sequenceColors:t.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:s.point.default},active:{style:s.point.active},selected:{style:s.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:(e={},e[o.CONTAINER_CLASS]={visibility:"visible",zIndex:1,backgroundColor:t.legendContainerFillColor,boxShadow:t.legendContainerShadow,borderRadius:"".concat(t.legendContainerBorderRadius,"px"),color:t.legendTextFillColor,fontFamily:t.fontFamily,padding:"10px",lineHeight:"1",fontSize:"".concat(t.legendTextFontSize,"px")},e[o.TITLE_CLASS]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},e[o.LIST_CLASS]={margin:"0px",padding:"0px"},e[o.LIST_ITEM_CLASS]={marginBottom:"2px"},e[o.MARKER_CLASS]={width:"10px",height:"10px"},e[o.VALUE_CLASS]={paddingLeft:"8px"},e)},continue:{domStyles:(n={},n[a.CONTAINER_CLASS]={visibility:"visible",zIndex:1,backgroundColor:t.legendContainerFillColor,boxShadow:t.legendContainerShadow,borderRadius:"".concat(t.legendContainerBorderRadius,"px"),color:t.legendTextFillColor,fontFamily:t.fontFamily,padding:"10px",lineHeight:1,fontSize:"".concat(t.legendTextFontSize,"px")},n[a.TITLE_CLASS]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},n[a.RIBBON_CLASS]={display:"flex",alignItems:"center"},n[a.GRADIENT_BAR_CLASS]={width:"140px",height:"14px",margin:"0px 5px"},n[a.VALUE_RANGE_CLASS]={padding:"0px"},n)}},tooltip:{domStyles:(r={},r[i.CONTAINER_CLASS]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:t.tooltipContainerFillColor,boxShadow:t.tooltipContainerShadow,borderRadius:"".concat(t.tooltipContainerBorderRadius,"px"),color:t.tooltipTextFillColor,fontSize:"".concat(t.tooltipTextFontSize,"px"),fontFamily:t.fontFamily,lineHeight:t.tooltipTextLineHeight},r[i.TITLE_CLASS]={marginBottom:"4px"},r[i.LIST_CLASS]={margin:"0px",padding:"0px"},r[i.LIST_ITEM_CLASS]={marginBottom:"4px"},r[i.NAME_CLASS]={color:t.tooltipItemNameFillColor},r[i.VALUE_CLASS]={color:t.tooltipItemValueFillColor,marginLeft:"30px"},r)},label:{style:{textAnchor:"center",textOffset:[0,0],fill:t.labelFillColor,fontSize:t.labelFontSize,fontFamily:t.fontFamily,fillColorDark:t.labelFillColorDark,fillColorLight:t.labelFillColorLight}}}}}},2764:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createDarkTheme=e.createTheme=void 0;var r=n(6898),i=n(4859),o=n(9640),a=n(9593),s=n(2313);e.createTheme=function(t){var e=t.styleSheet,n=void 0===e?{}:e,s=(0,r.__rest)(t,["styleSheet"]),u=(0,a.createLightStyleSheet)(n);return(0,i.deepMix)({},(0,o.createThemeByStyleSheet)(u),s)},e.createDarkTheme=function(t){var e=t.styleSheet,n=void 0===e?{}:e,a=(0,r.__rest)(t,["styleSheet"]),u=(0,s.createDarkStyleSheet)(n);return(0,i.deepMix)({},(0,o.createThemeByStyleSheet)(u),a)}},6510:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createDarkTheme=e.createTheme=void 0;var r=n(2764);Object.defineProperty(e,"createTheme",{enumerable:!0,get:function(){return r.createTheme}}),Object.defineProperty(e,"createDarkTheme",{enumerable:!0,get:function(){return r.createDarkTheme}})},134:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},5709:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlendType=void 0;var r=n(4534);Object.defineProperty(e,"BlendType",{enumerable:!0,get:function(){return r.BlendType}}),n(7112)},206:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PositionType=void 0;var r=n(4534);Object.defineProperty(e,"PositionType",{enumerable:!0,get:function(){return r.PositionType}})},6829:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6898);(0,r.__exportStar)(n(5709),e),(0,r.__exportStar)(n(134),e),(0,r.__exportStar)(n(7482),e),(0,r.__exportStar)(n(6707),e),(0,r.__exportStar)(n(3097),e),(0,r.__exportStar)(n(8064),e),(0,r.__exportStar)(n(2502),e),(0,r.__exportStar)(n(8621),e),(0,r.__exportStar)(n(206),e),(0,r.__exportStar)(n(6720),e),(0,r.__exportStar)(n(3023),e)},8064:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},7482:(t,e)=>{"use strict";var n,r;Object.defineProperty(e,"__esModule",{value:!0}),e.LayerType=e.LineStyleType=void 0,(r=e.LineStyleType||(e.LineStyleType={}))[r.solid=0]="solid",r[r.dash=1]="dash",(n=e.LayerType||(e.LayerType={})).TextLayer="textLayer",n.DotLayer="dotLayer",n.IconLayer="iconLayer",n.DotDensity="dotDensityLayer",n.ColumnLayer="columnLayer",n.HeatmapLayer="heatmapLayer",n.GridLayer="gridLayer",n.HexbinLayer="hexbinLayer",n.LinesLayer="linesLayer",n.PathLayer="pathLayer",n.ArcLayer="arcLayer",n.AreaLayer="areaLayer",n.PrismLayer="prismLayer"},6720:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},6707:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BaseMapType=e.Source=e.MapboxglMap=void 0;var r=n(6898),i=n(6172);Object.defineProperty(e,"MapboxglMap",{enumerable:!0,get:function(){return i.Map}});var o,a=(0,r.__importDefault)(n(4793));e.Source=a.default,(o=e.BaseMapType||(e.BaseMapType={})).Amap="amap",o.Mapbox="mapbox"},3097:(t,e)=>{"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.PlotType=void 0,(n=e.PlotType||(e.PlotType={})).Dot="dot",n.DotDensity="dotDensity",n.Heatmap="heatmap",n.Grid="grid",n.Hexbin="hexbin",n.Path="path",n.Flow="flow",n.Area="area",n.Choropleth="choropleth"},8621:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},3023:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},2502:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TooltipAnchorType=void 0;var r=n(9470);Object.defineProperty(e,"TooltipAnchorType",{enumerable:!0,get:function(){return r.anchorType}})},1726:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.deepAssign=void 0;var n=(new Object).toString,r=function(t,e){return n.call(t)==="[object "+e+"]"},i=function(t){return r(t,"Array")},o=function(t){if(!function(t){return"object"==typeof t&&null!==t}(t)||!r(t,"Object"))return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},a=function(t,e,n,r){for(var s in n=n||0,r=r||5,e)if(Object.prototype.hasOwnProperty.call(e,s)){var u=e[s];u?o(u)?(o(t[s])||(t[s]={}),n<r?a(t[s],u,n+1,r):t[s]=e[s]):i(u)?(t[s]=[],t[s]=t[s].concat(u)):t[s]=u:t[s]=u}};e.deepAssign=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)a(t,e[r]);return t}},1745:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.deepAssign=void 0;var r=n(1726);Object.defineProperty(e,"deepAssign",{enumerable:!0,get:function(){return r.deepAssign}})},5178:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="0.0.11"},4859:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Cache:()=>Me,assign:()=>Wt,augment:()=>qt,clamp:()=>et,clearAnimationFrame:()=>Gt,clone:()=>Yt,contains:()=>i,debounce:()=>Kt,deepMix:()=>$t,difference:()=>a,each:()=>f,endsWith:()=>V,every:()=>G,extend:()=>te,filter:()=>o,find:()=>v,findIndex:()=>_,firstValue:()=>x,fixedBase:()=>nt,flatten:()=>b,flattenDeep:()=>S,forIn:()=>_t,get:()=>ce,getEllipsisText:()=>Ce,getRange:()=>M,getType:()=>It,getWrapBehavior:()=>K,group:()=>Y,groupBy:()=>q,groupToMap:()=>X,has:()=>xt,hasKey:()=>bt,hasValue:()=>St,head:()=>j,identity:()=>xe,includes:()=>i,indexOf:()=>ee,isArguments:()=>kt,isArray:()=>h,isArrayLike:()=>r,isBoolean:()=>Ot,isDate:()=>Rt,isDecimal:()=>it,isElement:()=>Zt,isEmpty:()=>re,isEqual:()=>oe,isEqualWith:()=>ae,isError:()=>Dt,isEven:()=>ot,isFinite:()=>Nt,isFunction:()=>l,isInteger:()=>at,isMatch:()=>m,isNegative:()=>st,isNil:()=>c,isNull:()=>Ft,isNumber:()=>rt,isNumberEqual:()=>ut,isObject:()=>p,isObjectLike:()=>g,isOdd:()=>lt,isPlainObject:()=>y,isPositive:()=>ct,isPrototype:()=>Bt,isRegExp:()=>jt,isString:()=>D,isType:()=>u,isUndefined:()=>Ut,keys:()=>d,last:()=>U,lowerCase:()=>Ct,lowerFirst:()=>Mt,map:()=>se,mapValues:()=>le,max:()=>E,maxBy:()=>ht,measureTextWidth:()=>Ee,memoize:()=>Qt,min:()=>C,minBy:()=>pt,mix:()=>Wt,mod:()=>ft,noop:()=>_e,number2color:()=>$,omit:()=>de,parseRadius:()=>tt,pick:()=>fe,pull:()=>L,pullAt:()=>k,reduce:()=>O,remove:()=>R,requestAnimationFrame:()=>Vt,set:()=>he,size:()=>be,some:()=>H,sortBy:()=>N,startsWith:()=>Z,substitute:()=>Tt,throttle:()=>me,toArray:()=>ge,toDegree:()=>mt,toInteger:()=>gt,toRadian:()=>vt,toString:()=>Et,union:()=>z,uniq:()=>F,uniqueId:()=>ve,upperCase:()=>At,upperFirst:()=>Pt,values:()=>wt,valuesOfKey:()=>B,wrapBehavior:()=>Q});const r=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},i=function(t,e){return!!r(t)&&t.indexOf(e)>-1},o=function(t,e){if(!r(t))return t;for(var n=[],i=0;i<t.length;i++){var o=t[i];e(o,i)&&n.push(o)}return n},a=function(t,e){return void 0===e&&(e=[]),o(t,(function(t){return!i(e,t)}))};var s={}.toString;const u=function(t,e){return s.call(t)==="[object "+e+"]"},l=function(t){return u(t,"Function")},c=function(t){return null==t},h=function(t){return Array.isArray?Array.isArray(t):u(t,"Array")},p=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e},f=function(t,e){if(t)if(h(t))for(var n=0,r=t.length;n<r&&!1!==e(t[n],n);n++);else if(p(t))for(var i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))break},d=Object.keys?function(t){return Object.keys(t)}:function(t){var e=[];return f(t,(function(n,r){l(t)&&"prototype"===r||e.push(r)})),e},m=function(t,e){var n=d(e),r=n.length;if(c(t))return!r;for(var i=0;i<r;i+=1){var o=n[i];if(e[o]!==t[o]||!(o in t))return!1}return!0},g=function(t){return"object"==typeof t&&null!==t},y=function(t){if(!g(t)||!u(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},v=function(t,e){if(!h(t))return null;var n;if(l(e)&&(n=e),y(e)&&(n=function(t){return m(t,e)}),n)for(var r=0;r<t.length;r+=1)if(n(t[r]))return t[r];return null},_=function(t,e,n){void 0===n&&(n=0);for(var r=n;r<t.length;r++)if(e(t[r],r))return r;return-1},x=function(t,e){for(var n=null,r=0;r<t.length;r++){var i=t[r][e];if(!c(i)){n=h(i)?i[0]:i;break}}return n},b=function(t){if(!h(t))return[];for(var e=[],n=0;n<t.length;n++)e=e.concat(t[n]);return e};var w=function(t,e){if(void 0===e&&(e=[]),h(t))for(var n=0;n<t.length;n+=1)w(t[n],e);else e.push(t);return e};const S=w,E=function(t){if(h(t))return t.reduce((function(t,e){return Math.max(t,e)}),t[0])},C=function(t){if(h(t))return t.reduce((function(t,e){return Math.min(t,e)}),t[0])},M=function(t){var e=t.filter((function(t){return!isNaN(t)}));if(!e.length)return{min:0,max:0};if(h(t[0])){for(var n=[],r=0;r<t.length;r++)n=n.concat(t[r]);e=n}var i=E(e);return{min:C(e),max:i}};var T=Array.prototype,A=T.splice,P=T.indexOf;const L=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=-1;(o=P.call(t,i))>-1;)A.call(t,o,1);return t};var I=Array.prototype.splice;const k=function(t,e){if(!r(t))return[];for(var n=t?e.length:0,i=n-1;n--;){var o=void 0,a=e[n];n!==i&&a===o||(o=a,I.call(t,a,1))}return t},O=function(t,e,n){if(!h(t)&&!y(t))return t;var r=n;return f(t,(function(t,n){r=e(r,t,n)})),r},R=function(t,e){var n=[];if(!r(t))return n;for(var i=-1,o=[],a=t.length;++i<a;){var s=t[i];e(s,i,t)&&(n.push(s),o.push(i))}return k(t,o),n},D=function(t){return u(t,"String")},N=function(t,e){var n;if(l(e))n=function(t,n){return e(t)-e(n)};else{var r=[];D(e)?r.push(e):h(e)&&(r=e),n=function(t,e){for(var n=0;n<r.length;n+=1){var i=r[n];if(t[i]>e[i])return 1;if(t[i]<e[i])return-1}return 0}}return t.sort(n),t};function F(t,e){void 0===e&&(e=new Map);var n=[];if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++){var o=t[r];e.has(o)||(n.push(o),e.set(o,!0))}return n}const z=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return F([].concat.apply([],t))},B=function(t,e){for(var n=[],r={},i=0;i<t.length;i++){var o=t[i][e];if(!c(o)){h(o)||(o=[o]);for(var a=0;a<o.length;a++){var s=o[a];r[s]||(n.push(s),r[s]=!0)}}}return n};function j(t){if(r(t))return t[0]}function U(t){if(r(t))return t[t.length-1]}const Z=function(t,e){return!(!h(t)&&!D(t))&&t[0]===e},V=function(t,e){return!(!h(t)&&!D(t))&&t[t.length-1]===e},G=function(t,e){for(var n=0;n<t.length;n++)if(!e(t[n],n))return!1;return!0},H=function(t,e){for(var n=0;n<t.length;n++)if(e(t[n],n))return!0;return!1};var W=Object.prototype.hasOwnProperty;const q=function(t,e){if(!e||!h(t))return{};for(var n,r={},i=l(e)?e:function(t){return t[e]},o=0;o<t.length;o++){var a=t[o];n=i(a),W.call(r,n)?r[n].push(a):r[n]=[a]}return r};function X(t,e){if(!e)return{0:t};if(!l(e)){var n=h(e)?e:e.replace(/\s+/g,"").split("*");e=function(t){for(var e="_",r=0,i=n.length;r<i;r++)e+=t[n[r]]&&t[n[r]].toString();return e}}return q(t,e)}const Y=function(t,e){if(!e)return[t];var n=X(t,e),r=[];for(var i in n)r.push(n[i]);return r},K=function(t,e){return t["_wrap_"+e]},Q=function(t,e){if(t["_wrap_"+e])return t["_wrap_"+e];var n=function(n){t[e](n)};return t["_wrap_"+e]=n,n};var J={};const $=function(t){var e=J[t];if(!e){for(var n=t.toString(16),r=n.length;r<6;r++)n="0"+n;e="#"+n,J[t]=e}return e},tt=function(t){var e=0,n=0,r=0,i=0;return h(t)?1===t.length?e=n=r=i=t[0]:2===t.length?(e=r=t[0],n=i=t[1]):3===t.length?(e=t[0],n=i=t[1],r=t[2]):(e=t[0],n=t[1],r=t[2],i=t[3]):e=n=r=i=t,{r1:e,r2:n,r3:r,r4:i}},et=function(t,e,n){return t<e?e:t>n?n:t},nt=function(t,e){var n=e.toString(),r=n.indexOf(".");if(-1===r)return Math.round(t);var i=n.substr(r+1).length;return i>20&&(i=20),parseFloat(t.toFixed(i))},rt=function(t){return u(t,"Number")},it=function(t){return rt(t)&&t%1!=0},ot=function(t){return rt(t)&&t%2==0},at=Number.isInteger?Number.isInteger:function(t){return rt(t)&&t%1==0},st=function(t){return rt(t)&&t<0};function ut(t,e,n){return void 0===n&&(n=1e-5),Math.abs(t-e)<n}const lt=function(t){return rt(t)&&t%2!=0},ct=function(t){return rt(t)&&t>0},ht=function(t,e){if(h(t)){for(var n,r=-1/0,i=0;i<t.length;i++){var o=t[i],a=l(e)?e(o):o[e];a>r&&(n=o,r=a)}return n}},pt=function(t,e){if(h(t)){for(var n,r=1/0,i=0;i<t.length;i++){var o=t[i],a=l(e)?e(o):o[e];a<r&&(n=o,r=a)}return n}},ft=function(t,e){return(t%e+e)%e};var dt=180/Math.PI;const mt=function(t){return dt*t},gt=parseInt;var yt=Math.PI/180;const vt=function(t){return yt*t},_t=f,xt=function(t,e){return t.hasOwnProperty(e)},bt=xt,wt=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return f(t,(function(n,r){l(t)&&"prototype"===r||e.push(n)})),e},St=function(t,e){return i(wt(t),e)},Et=function(t){return c(t)?"":t.toString()},Ct=function(t){return Et(t).toLowerCase()},Mt=function(t){var e=Et(t);return e.charAt(0).toLowerCase()+e.substring(1)},Tt=function(t,e){return t&&e?t.replace(/\\?\{([^{}]+)\}/g,(function(t,n){return"\\"===t.charAt(0)?t.slice(1):void 0===e[n]?"":e[n]})):t},At=function(t){return Et(t).toUpperCase()},Pt=function(t){var e=Et(t);return e.charAt(0).toUpperCase()+e.substring(1)};var Lt={}.toString;const It=function(t){return Lt.call(t).replace(/^\[object /,"").replace(/]$/,"")},kt=function(t){return u(t,"Arguments")},Ot=function(t){return u(t,"Boolean")},Rt=function(t){return u(t,"Date")},Dt=function(t){return u(t,"Error")};function Nt(t){return rt(t)&&isFinite(t)}const Ft=function(t){return null===t};var zt=Object.prototype;const Bt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||zt)},jt=function(t){return u(t,"RegExp")},Ut=function(t){return void 0===t},Zt=function(t){return t instanceof Element||t instanceof HTMLDocument};function Vt(t){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16)})(t)}function Gt(t){(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout)(t)}function Ht(t,e){for(var n in e)e.hasOwnProperty(n)&&"constructor"!==n&&void 0!==e[n]&&(t[n]=e[n])}function Wt(t,e,n,r){return e&&Ht(t,e),n&&Ht(t,n),r&&Ht(t,r),t}const qt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t[0],r=1;r<t.length;r++){var i=t[r];l(i)&&(i=i.prototype),Wt(n.prototype,i)}};var Xt=function(t){if("object"!=typeof t||null===t)return t;var e;if(h(t)){e=[];for(var n=0,r=t.length;n<r;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=Xt(t[n]):e[n]=t[n]}else for(var i in e={},t)"object"==typeof t[i]&&null!=t[i]?e[i]=Xt(t[i]):e[i]=t[i];return e};const Yt=Xt,Kt=function(t,e,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||t.apply(i,o)},s=n&&!r;clearTimeout(r),r=setTimeout(a,e),s&&t.apply(i,o)}},Qt=function(t,e){if(!l(t))throw new TypeError("Expected a function");var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=e?e.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=t.apply(this,r);return a.set(o,s),s};return n.cache=new Map,n};function Jt(t,e,n,r){for(var i in n=n||0,r=r||5,e)if(e.hasOwnProperty(i)){var o=e[i];null!==o&&y(o)?(y(t[i])||(t[i]={}),n<r?Jt(t[i],o,n+1,r):t[i]=e[i]):h(o)?(t[i]=[],t[i]=t[i].concat(o)):void 0!==o&&(t[i]=o)}}const $t=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)Jt(t,e[r]);return t},te=function(t,e,n,r){l(e)||(n=e,e=t,t=function(){});var i=Object.create?function(t,e){return Object.create(t,{constructor:{value:e}})}:function(t,e){function n(){}n.prototype=t;var r=new n;return r.constructor=e,r},o=i(e.prototype,t);return t.prototype=Wt(o,t.prototype),t.superclass=i(e.prototype,e),Wt(o,n),Wt(t,r),t},ee=function(t,e){if(!r(t))return-1;var n=Array.prototype.indexOf;if(n)return n.call(t,e);for(var i=-1,o=0;o<t.length;o++)if(t[o]===e){i=o;break}return i};var ne=Object.prototype.hasOwnProperty;const re=function(t){if(c(t))return!0;if(r(t))return!t.length;var e=It(t);if("Map"===e||"Set"===e)return!t.size;if(Bt(t))return!Object.keys(t).length;for(var n in t)if(ne.call(t,n))return!1;return!0};var ie=function(t,e){if(t===e)return!0;if(!t||!e)return!1;if(D(t)||D(e))return!1;if(r(t)||r(e)){if(t.length!==e.length)return!1;for(var n=!0,i=0;i<t.length&&(n=ie(t[i],e[i]));i++);return n}if(g(t)||g(e)){var o=Object.keys(t),a=Object.keys(e);if(o.length!==a.length)return!1;for(n=!0,i=0;i<o.length&&(n=ie(t[o[i]],e[o[i]]));i++);return n}return!1};const oe=ie,ae=function(t,e,n){return l(n)?!!n(t,e):oe(t,e)},se=function(t,e){if(!r(t))return t;for(var n=[],i=0;i<t.length;i++){var o=t[i];n.push(e(o,i))}return n};var ue=function(t){return t};const le=function(t,e){void 0===e&&(e=ue);var n={};return p(t)&&!c(t)&&Object.keys(t).forEach((function(r){n[r]=e(t[r],r)})),n},ce=function(t,e,n){for(var r=0,i=D(e)?e.split("."):e;t&&r<i.length;)t=t[i[r++]];return void 0===t||r<i.length?n:t},he=function(t,e,n){var r=t,i=D(e)?e.split("."):e;return i.forEach((function(t,e){e<i.length-1?(p(r[t])||(r[t]=rt(i[e+1])?[]:{}),r=r[t]):r[t]=n})),t};var pe=Object.prototype.hasOwnProperty;const fe=function(t,e){if(null===t||!y(t))return{};var n={};return f(e,(function(e){pe.call(t,e)&&(n[e]=t[e])})),n},de=function(t,e){return O(t,(function(t,n,r){return e.includes(r)||(t[r]=n),t}),{})},me=function(t,e,n){var r,i,o,a,s=0;n||(n={});var u=function(){s=!1===n.leading?0:Date.now(),r=null,a=t.apply(i,o),r||(i=o=null)},l=function(){var l=Date.now();s||!1!==n.leading||(s=l);var c=e-(l-s);return i=this,o=arguments,c<=0||c>e?(r&&(clearTimeout(r),r=null),s=l,a=t.apply(i,o),r||(i=o=null)):r||!1===n.trailing||(r=setTimeout(u,c)),a};return l.cancel=function(){clearTimeout(r),s=0,r=i=o=null},l},ge=function(t){return r(t)?Array.prototype.slice.call(t):[]};var ye={};const ve=function(t){return ye[t=t||"g"]?ye[t]+=1:ye[t]=1,t+ye[t]},_e=function(){},xe=function(t){return t};function be(t){return c(t)?0:r(t)?t.length:Object.keys(t).length}var we,Se=n(6898);const Ee=Qt((function(t,e){void 0===e&&(e={});var n=e.fontSize,r=e.fontFamily,i=e.fontWeight,o=e.fontStyle,a=e.fontVariant;return we||(we=document.createElement("canvas").getContext("2d")),we.font=[o,a,i,n+"px",r].join(" "),we.measureText(D(t)?t:"").width}),(function(t,e){return void 0===e&&(e={}),(0,Se.__spreadArrays)([t],wt(e)).join("")})),Ce=function(t,e,n,r){void 0===r&&(r="...");var i,o,a=Ee(r,n),s=D(t)?t:Et(t),u=e,l=[];if(Ee(t,n)<=e)return t;for(;i=s.substr(0,16),!((o=Ee(i,n))+a>u&&o>u);)if(l.push(i),u-=o,!(s=s.substr(16)))return l.join("");for(;i=s.substr(0,1),!((o=Ee(i,n))+a>u);)if(l.push(i),u-=o,!(s=s.substr(1)))return l.join("");return""+l.join("")+r},Me=function(){function t(){this.map={}}return t.prototype.has=function(t){return void 0!==this.map[t]},t.prototype.get=function(t,e){var n=this.map[t];return void 0===n?e:n},t.prototype.set=function(t,e){this.map[t]=e},t.prototype.clear=function(){this.map={}},t.prototype.delete=function(t){delete this.map[t]},t.prototype.size=function(){return Object.keys(this.map).length},t}()},2576:t=>{function e(t,e){if(0!==t.length){n(t[0],e);for(var r=1;r<t.length;r++)n(t[r],!e)}}function n(t,e){for(var n=0,r=0,i=0,o=t.length,a=o-1;i<o;a=i++){var s=(t[i][0]-t[a][0])*(t[a][1]+t[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!e&&t.reverse()}t.exports=function t(n,r){var i,o=n&&n.type;if("FeatureCollection"===o)for(i=0;i<n.features.length;i++)t(n.features[i],r);else if("GeometryCollection"===o)for(i=0;i<n.geometries.length;i++)t(n.geometries[i],r);else if("Feature"===o)t(n.geometry,r);else if("Polygon"===o)e(n.coordinates,r);else if("MultiPolygon"===o)for(i=0;i<n.coordinates.length;i++)e(n.coordinates[i],r);return n}},3585:t=>{"use strict";function e(t,e){this.x=t,this.y=e}t.exports=e,e.prototype={clone:function(){return new e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}},6922:t=>{function e(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}t.exports=e,e.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},e.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},e.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},e.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},e.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},6672:(t,e,n)=>{t.exports.VectorTile=n(8403),n(3741),n(8984)},8403:(t,e,n)=>{"use strict";var r=n(8984);function i(t,e,n){if(3===t){var i=new r(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}t.exports=function(t,e){this.layers=t.readFields(i,{},e)}},3741:(t,e,n)=>{"use strict";var r=n(3585);function i(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(o,this,e)}function o(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function a(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],r+=((n=t[a]).x-e.x)*(e.y+n.y);return r}t.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,o=0,a=0,s=0,u=[];t.pos<n;){if(o<=0){var l=t.readVarint();i=7&l,o=l>>3}if(o--,1===i||2===i)a+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new r(a,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},i.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(r<=0){var c=t.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},i.prototype.toGeoJSON=function(t,e,n){var r,o,s=this.extent*Math.pow(2,n),u=this.extent*t,l=this.extent*e,c=this.loadGeometry(),h=i.types[this.type];function p(t){for(var e=0;e<t.length;e++){var n=t[e],r=180-360*(n.y+l)/s;t[e]=[360*(n.x+u)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(r=0;r<c.length;r++)f[r]=c[r][0];p(c=f);break;case 2:for(r=0;r<c.length;r++)p(c[r]);break;case 3:for(c=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var s=a(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(c),r=0;r<c.length;r++)for(o=0;o<c[r].length;o++)p(c[r][o])}1===c.length?c=c[0]:h="Multi"+h;var d={type:"Feature",geometry:{type:h,coordinates:c},properties:this.properties};return"id"in this&&(d.id=this.id),d}},8984:(t,e,n)=>{"use strict";var r=n(3741);function i(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(o,this,e),this.length=this._features.length}function o(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}t.exports=i,i.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,e,this.extent,this._keys,this._values)}},3374:(t,e,n)=>{"use strict";var r=n(4262);function i(t){var e=[1/0,1/0,-1/0,-1/0];return r.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}i.default=i,e.Z=i},3969:(t,e)=>{"use strict";function n(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function r(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!f(t[0])||!f(t[1]))throw new Error("coordinates must contain numbers");return n({type:"Point",coordinates:t},e,r)}function i(t,e,r){void 0===r&&(r={});for(var i=0,o=t;i<o.length;i++){var a=o[i];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return n({type:"Polygon",coordinates:t},e,r)}function o(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return n({type:"LineString",coordinates:t},e,r)}function a(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function s(t,e,r){return void 0===r&&(r={}),n({type:"MultiLineString",coordinates:t},e,r)}function u(t,e,r){return void 0===r&&(r={}),n({type:"MultiPoint",coordinates:t},e,r)}function l(t,e,r){return void 0===r&&(r={}),n({type:"MultiPolygon",coordinates:t},e,r)}function c(t,n){void 0===n&&(n="kilometers");var r=e.factors[n];if(!r)throw new Error(n+" units is invalid");return t*r}function h(t,n){void 0===n&&(n="kilometers");var r=e.factors[n];if(!r)throw new Error(n+" units is invalid");return t/r}function p(t){return t%(2*Math.PI)*180/Math.PI}function f(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:1.0936*e.earthRadius},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=n,e.geometry=function(t,e,n){switch(void 0===n&&(n={}),t){case"Point":return r(e).geometry;case"LineString":return o(e).geometry;case"Polygon":return i(e).geometry;case"MultiPoint":return u(e).geometry;case"MultiLineString":return s(e).geometry;case"MultiPolygon":return l(e).geometry;default:throw new Error(t+" is invalid")}},e.point=r,e.points=function(t,e,n){return void 0===n&&(n={}),a(t.map((function(t){return r(t,e)})),n)},e.polygon=i,e.polygons=function(t,e,n){return void 0===n&&(n={}),a(t.map((function(t){return i(t,e)})),n)},e.lineString=o,e.lineStrings=function(t,e,n){return void 0===n&&(n={}),a(t.map((function(t){return o(t,e)})),n)},e.featureCollection=a,e.multiLineString=s,e.multiPoint=u,e.multiPolygon=l,e.geometryCollection=function(t,e,r){return void 0===r&&(r={}),n({type:"GeometryCollection",geometries:t},e,r)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n},e.radiansToLength=c,e.lengthToRadians=h,e.lengthToDegrees=function(t,e){return p(h(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=p,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,n){if(void 0===e&&(e="kilometers"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return c(h(t,e),n)},e.convertArea=function(t,n,r){if(void 0===n&&(n="meters"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("area must be a positive number");var i=e.areaFactors[n];if(!i)throw new Error("invalid original units");var o=e.areaFactors[r];if(!o)throw new Error("invalid final units");return t/i*o},e.isNumber=f,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!f(t))throw new Error("bbox must only contain numbers")}))},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}},4262:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3969);function i(t,e,n){if(null!==t)for(var r,o,a,s,u,l,c,h,p=0,f=0,d=t.type,m="FeatureCollection"===d,g="Feature"===d,y=m?t.features.length:1,v=0;v<y;v++){u=(h=!!(c=m?t.features[v].geometry:g?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<u;_++){var x=0,b=0;if(null!==(s=h?c.geometries[_]:c)){l=s.coordinates;var w=s.type;switch(p=!n||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===e(l,f,v,x,b))return!1;f++,x++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===e(l[r],f,v,x,b))return!1;f++,"MultiPoint"===w&&x++}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(o=0;o<l[r].length-p;o++){if(!1===e(l[r][o],f,v,x,b))return!1;f++}"MultiLineString"===w&&x++,"Polygon"===w&&b++}"Polygon"===w&&x++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(b=0,o=0;o<l[r].length;o++){for(a=0;a<l[r][o].length-p;a++){if(!1===e(l[r][o][a],f,v,x,b))return!1;f++}b++}x++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===i(s.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&!1!==e(t.features[n].properties,n);n++);break;case"Feature":e(t.properties,0)}}function a(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function s(t,e){var n,r,i,o,a,s,u,l,c,h,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,m=f?t.features.length:1;for(n=0;n<m;n++){for(s=f?t.features[n].geometry:d?t.geometry:t,l=f?t.features[n].properties:d?t.properties:{},c=f?t.features[n].bbox:d?t.bbox:void 0,h=f?t.features[n].id:d?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,l,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],p,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,l,c,h))return!1;p++}}function u(t,e){s(t,(function(t,n,i,o,a){var s,u=null===t?null:t.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==e(r.feature(t,i,{bbox:o,id:a}),n,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<t.coordinates.length;l++){var c={type:s,coordinates:t.coordinates[l]};if(!1===e(r.feature(c,i),n,l))return!1}}))}function l(t,e){u(t,(function(t,n,o){var a=0;if(t.geometry){var s=t.geometry.type;if("Point"!==s&&"MultiPoint"!==s){var u,l=0,c=0,h=0;return!1!==i(t,(function(i,s,p,f,d){if(void 0===u||n>l||f>c||d>h)return u=i,l=n,c=f,h=d,void(a=0);var m=r.lineString([u,i],t.properties);if(!1===e(m,n,o,d,a))return!1;a++,u=i}))&&void 0}}}))}function c(t,e){if(!t)throw new Error("geojson is required");u(t,(function(t,n,i){if(null!==t.geometry){var o=t.geometry.type,a=t.geometry.coordinates;switch(o){case"LineString":if(!1===e(t,n,i,0,0))return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(!1===e(r.lineString(a[s],t.properties),n,i,s))return!1}}}))}e.coordAll=function(t){var e=[];return i(t,(function(t){e.push(t)})),e},e.coordEach=i,e.coordReduce=function(t,e,n,r){var o=n;return i(t,(function(t,r,i,a,s){o=0===r&&void 0===n?t:e(o,t,r,i,a,s)}),r),o},e.featureEach=a,e.featureReduce=function(t,e,n){var r=n;return a(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r},e.findPoint=function(t,e){if(e=e||{},!r.isObject(e))throw new Error("options is invalid");var n,i=e.featureIndex||0,o=e.multiFeatureIndex||0,a=e.geometryIndex||0,s=e.coordIndex||0,u=e.properties;switch(t.type){case"FeatureCollection":i<0&&(i=t.features.length+i),u=u||t.features[i].properties,n=t.features[i].geometry;break;case"Feature":u=u||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var l=n.coordinates;switch(n.type){case"Point":return r.point(l,u,e);case"MultiPoint":return o<0&&(o=l.length+o),r.point(l[o],u,e);case"LineString":return s<0&&(s=l.length+s),r.point(l[s],u,e);case"Polygon":return a<0&&(a=l.length+a),s<0&&(s=l[a].length+s),r.point(l[a][s],u,e);case"MultiLineString":return o<0&&(o=l.length+o),s<0&&(s=l[o].length+s),r.point(l[o][s],u,e);case"MultiPolygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a),s<0&&(s=l[o][a].length-s),r.point(l[o][a][s],u,e)}throw new Error("geojson is invalid")},e.findSegment=function(t,e){if(e=e||{},!r.isObject(e))throw new Error("options is invalid");var n,i=e.featureIndex||0,o=e.multiFeatureIndex||0,a=e.geometryIndex||0,s=e.segmentIndex||0,u=e.properties;switch(t.type){case"FeatureCollection":i<0&&(i=t.features.length+i),u=u||t.features[i].properties,n=t.features[i].geometry;break;case"Feature":u=u||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var l=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=l.length+s-1),r.lineString([l[s],l[s+1]],u,e);case"Polygon":return a<0&&(a=l.length+a),s<0&&(s=l[a].length+s-1),r.lineString([l[a][s],l[a][s+1]],u,e);case"MultiLineString":return o<0&&(o=l.length+o),s<0&&(s=l[o].length+s-1),r.lineString([l[o][s],l[o][s+1]],u,e);case"MultiPolygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a),s<0&&(s=l[o][a].length-s-1),r.lineString([l[o][a][s],l[o][a][s+1]],u,e)}throw new Error("geojson is invalid")},e.flattenEach=u,e.flattenReduce=function(t,e,n){var r=n;return u(t,(function(t,i,o){r=0===i&&0===o&&void 0===n?t:e(r,t,i,o)})),r},e.geomEach=s,e.geomReduce=function(t,e,n){var r=n;return s(t,(function(t,i,o,a,s){r=0===i&&void 0===n?t:e(r,t,i,o,a,s)})),r},e.lineEach=c,e.lineReduce=function(t,e,n){var r=n;return c(t,(function(t,i,o,a){r=0===i&&void 0===n?t:e(r,t,i,o,a)})),r},e.propEach=o,e.propReduce=function(t,e,n){var r=n;return o(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r},e.segmentEach=l,e.segmentReduce=function(t,e,n){var r=n,i=!1;return l(t,(function(t,o,a,s,u){r=!1===i&&void 0===n?t:e(r,t,o,a,s,u),i=!0})),r}},2864:(t,e,n)=>{"use strict";var r=n(8487),i=n(5592),o=i(r("String.prototype.indexOf"));t.exports=function(t,e){var n=r(t,!!e);return"function"==typeof n&&o(t,".prototype.")>-1?i(n):n}},5592:(t,e,n)=>{"use strict";var r=n(2698),i=n(8487),o=i("%Function.prototype.apply%"),a=i("%Function.prototype.call%"),s=i("%Reflect.apply%",!0)||r.call(a,o),u=i("%Object.getOwnPropertyDescriptor%",!0),l=i("%Object.defineProperty%",!0),c=i("%Math.max%");if(l)try{l({},"a",{value:1})}catch(t){l=null}t.exports=function(t){var e=s(r,a,arguments);if(u&&l){var n=u(e,"length");n.configurable&&l(e,"length",{value:1+c(0,t.length-(arguments.length-1))})}return e};var h=function(){return s(r,o,arguments)};l?l(t.exports,"apply",{value:h}):t.exports.apply=h},8304:(t,e,n)=>{"use strict";var r=n(8346),i=n(1048),o=n(1807),a=n(8935).orient2d;function s(t,e,n){e=Math.max(0,void 0===e?2:e),n=n||0;var i=function(t){for(var e=t[0],n=t[0],r=t[0],i=t[0],a=0;a<t.length;a++){var s=t[a];s[0]<e[0]&&(e=s),s[0]>r[0]&&(r=s),s[1]<n[1]&&(n=s),s[1]>i[1]&&(i=s)}var u=[e,n,r,i],l=u.slice();for(a=0;a<t.length;a++)o(t[a],u)||l.push(t[a]);return function(t){t.sort(_);for(var e=[],n=0;n<t.length;n++){for(;e.length>=2&&f(e[e.length-2],e[e.length-1],t[n])<=0;)e.pop();e.push(t[n])}for(var r=[],i=t.length-1;i>=0;i--){for(;r.length>=2&&f(r[r.length-2],r[r.length-1],t[i])<=0;)r.pop();r.push(t[i])}return r.pop(),e.pop(),e.concat(r)}(l)}(t),a=new r(16);a.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},a.compareMinX=function(t,e){return t[0]-e[0]},a.compareMinY=function(t,e){return t[1]-e[1]},a.load(t);for(var s,l=[],c=0;c<i.length;c++){var h=i[c];a.remove(h),s=m(h,s),l.push(s)}var p=new r(16);for(c=0;c<l.length;c++)p.insert(d(l[c]));for(var y=e*e,v=n*n;l.length;){var x=l.shift(),b=x.p,w=x.next.p,S=g(b,w);if(!(S<v)){var E=S/y;(h=u(a,x.prev.p,b,w,x.next.next.p,E,p))&&Math.min(g(h,b),g(h,w))<=E&&(l.push(x),l.push(m(h,x)),a.remove(h),p.remove(x),p.insert(d(x)),p.insert(d(x.next)))}}x=s;var C=[];do{C.push(x.p),x=x.next}while(x!==s);return C.push(x.p),C}function u(t,e,n,r,o,a,s){for(var u=new i([],l),h=t.data;h;){for(var f=0;f<h.children.length;f++){var d=h.children[f],m=h.leaf?y(d,n,r):c(n,r,d);m>a||u.push({node:d,dist:m})}for(;u.length&&!u.peek().node.children;){var g=u.pop(),v=g.node,_=y(v,e,n),x=y(v,r,o);if(g.dist<_&&g.dist<x&&p(n,v,s)&&p(r,v,s))return v}(h=u.pop())&&(h=h.node)}return null}function l(t,e){return t.dist-e.dist}function c(t,e,n){if(h(t,n)||h(e,n))return 0;var r=v(t[0],t[1],e[0],e[1],n.minX,n.minY,n.maxX,n.minY);if(0===r)return 0;var i=v(t[0],t[1],e[0],e[1],n.minX,n.minY,n.minX,n.maxY);if(0===i)return 0;var o=v(t[0],t[1],e[0],e[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var a=v(t[0],t[1],e[0],e[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===a?0:Math.min(r,i,o,a)}function h(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function p(t,e,n){for(var r,i,o,a,s=Math.min(t[0],e[0]),u=Math.min(t[1],e[1]),l=Math.max(t[0],e[0]),c=Math.max(t[1],e[1]),h=n.search({minX:s,minY:u,maxX:l,maxY:c}),p=0;p<h.length;p++)if(r=h[p].p,i=h[p].next.p,o=t,r!==(a=e)&&i!==o&&f(r,i,o)>0!=f(r,i,a)>0&&f(o,a,r)>0!=f(o,a,i)>0)return!1;return!0}function f(t,e,n){return a(t[0],t[1],e[0],e[1],n[0],n[1])}function d(t){var e=t.p,n=t.next.p;return t.minX=Math.min(e[0],n[0]),t.minY=Math.min(e[1],n[1]),t.maxX=Math.max(e[0],n[0]),t.maxY=Math.max(e[1],n[1]),t}function m(t,e){var n={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(n.next=e.next,n.prev=e,e.next.prev=n,e.next=n):(n.prev=n,n.next=n),n}function g(t,e){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function y(t,e,n){var r=e[0],i=e[1],o=n[0]-r,a=n[1]-i;if(0!==o||0!==a){var s=((t[0]-r)*o+(t[1]-i)*a)/(o*o+a*a);s>1?(r=n[0],i=n[1]):s>0&&(r+=o*s,i+=a*s)}return(o=t[0]-r)*o+(a=t[1]-i)*a}function v(t,e,n,r,i,o,a,s){var u,l,c,h,p=n-t,f=r-e,d=a-i,m=s-o,g=t-i,y=e-o,v=p*p+f*f,_=p*d+f*m,x=d*d+m*m,b=p*g+f*y,w=d*g+m*y,S=v*x-_*_,E=S,C=S;0===S?(l=0,E=1,h=w,C=x):(h=v*w-_*b,(l=_*w-x*b)<0?(l=0,h=w,C=x):l>E&&(l=E,h=w+_,C=x)),h<0?(h=0,-b<0?l=0:-b>v?l=E:(l=-b,E=v)):h>C&&(h=C,-b+_<0?l=0:-b+_>v?l=E:(l=-b+_,E=v));var M=(1-(c=0===h?0:h/C))*i+c*a-((1-(u=0===l?0:l/E))*t+u*n),T=(1-c)*o+c*s-((1-u)*e+u*r);return M*M+T*T}function _(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}i.default&&(i=i.default),t.exports=s,t.exports.default=s},937:(t,e,n)=>{"use strict";function r(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function i(t){var e;return 1===t.length&&(e=t,t=function(t,n){return r(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}n.d(e,{j2:()=>r,b4:()=>s,YF:()=>i,We:()=>u,TS:()=>g,VR:()=>v,G9:()=>d,ly:()=>m,sd:()=>f});var o=i(r),a=o.right;o.left;const s=a;function u(t,e){var n,r,i,o=t.length,a=-1;if(null==e){for(;++a<o;)if(null!=(n=t[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=t[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=e(t[a],a,t))&&n>=n)for(r=i=n;++a<o;)null!=(n=e(t[a],a,t))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}var l=Array.prototype,c=(l.slice,l.map,Math.sqrt(50)),h=Math.sqrt(10),p=Math.sqrt(2);function f(t,e,n){var r,i,o,a,s=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=d(t,e,n))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(t+s)*a;else for(t=Math.floor(t*a),e=Math.ceil(e*a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(t-s)/a;return r&&o.reverse(),o}function d(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=c?10:o>=h?5:o>=p?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=c?10:o>=h?5:o>=p?2:1)}function m(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=c?i*=10:o>=h?i*=5:o>=p&&(i*=2),e<t?-i:i}function g(t){for(var e,n,r,i=t.length,o=-1,a=0;++o<i;)a+=t[o].length;for(n=new Array(a);--i>=0;)for(e=(r=t[i]).length;--e>=0;)n[--a]=r[e];return n}function y(t){return null===t?NaN:+t}function v(t,e,n){if(null==n&&(n=y),r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),a=+n(t[o],o,t);return a+(+n(t[o+1],o+1,t)-a)*(i-o)}}},4537:(t,e,n)=>{"use strict";function r(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function i(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function o(){}n.d(e,{ZP:()=>b,B8:()=>C});var a=.7,s=1/a,u="\\s*([+-]?\\d+)\\s*",l="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",c="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",h=/^#([0-9a-f]{3,8})$/,p=new RegExp("^rgb\\("+[u,u,u]+"\\)$"),f=new RegExp("^rgb\\("+[c,c,c]+"\\)$"),d=new RegExp("^rgba\\("+[u,u,u,l]+"\\)$"),m=new RegExp("^rgba\\("+[c,c,c,l]+"\\)$"),g=new RegExp("^hsl\\("+[l,c,c]+"\\)$"),y=new RegExp("^hsla\\("+[l,c,c,l]+"\\)$"),v={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function _(){return this.rgb().formatHex()}function x(){return this.rgb().formatRgb()}function b(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=h.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?w(e):3===n?new M(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?S(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?S(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=p.exec(t))?new M(e[1],e[2],e[3],1):(e=f.exec(t))?new M(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=d.exec(t))?S(e[1],e[2],e[3],e[4]):(e=m.exec(t))?S(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=g.exec(t))?L(e[1],e[2]/100,e[3]/100,1):(e=y.exec(t))?L(e[1],e[2]/100,e[3]/100,e[4]):v.hasOwnProperty(t)?w(v[t]):"transparent"===t?new M(NaN,NaN,NaN,0):null}function w(t){return new M(t>>16&255,t>>8&255,255&t,1)}function S(t,e,n,r){return r<=0&&(t=e=n=NaN),new M(t,e,n,r)}function E(t){return t instanceof o||(t=b(t)),t?new M((t=t.rgb()).r,t.g,t.b,t.opacity):new M}function C(t,e,n,r){return 1===arguments.length?E(t):new M(t,e,n,null==r?1:r)}function M(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function T(){return"#"+P(this.r)+P(this.g)+P(this.b)}function A(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function P(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function L(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new k(t,e,n,r)}function I(t){if(t instanceof k)return new k(t.h,t.s,t.l,t.opacity);if(t instanceof o||(t=b(t)),!t)return new k;if(t instanceof k)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),s=NaN,u=a-i,l=(a+i)/2;return u?(s=e===a?(n-r)/u+6*(n<r):n===a?(r-e)/u+2:(e-n)/u+4,u/=l<.5?a+i:2-a-i,s*=60):u=l>0&&l<1?0:s,new k(s,u,l,t.opacity)}function k(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function O(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}r(o,b,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:_,formatHex:_,formatHsl:function(){return I(this).formatHsl()},formatRgb:x,toString:x}),r(M,C,i(o,{brighter:function(t){return t=null==t?s:Math.pow(s,t),new M(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?a:Math.pow(a,t),new M(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:T,formatHex:T,formatRgb:A,toString:A})),r(k,(function(t,e,n,r){return 1===arguments.length?I(t):new k(t,e,n,null==r?1:r)}),i(o,{brighter:function(t){return t=null==t?s:Math.pow(s,t),new k(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?a:Math.pow(a,t),new k(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new M(O(t>=240?t-240:t+120,i,r),O(t,i,r),O(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}))},2050:t=>{function e(t,e,n){var r,i,o,a,s;function u(){var l=Date.now()-a;l<e&&l>=0?r=setTimeout(u,e-l):(r=null,n||(s=t.apply(o,i),o=i=null))}null==e&&(e=100);var l=function(){o=this,i=arguments,a=Date.now();var l=n&&!r;return r||(r=setTimeout(u,e)),l&&(s=t.apply(o,i),o=i=null),s};return l.clear=function(){r&&(clearTimeout(r),r=null)},l.flush=function(){r&&(s=t.apply(o,i),o=i=null,clearTimeout(r),r=null)},l}e.debounce=e,t.exports=e},1374:(t,e,n)=>{var r=n(3571),i=n(9462),o=n(2641),a=n(9360),s=n(7483),u=n(3846),l=Date.prototype.getTime;function c(t){return null==t}function h(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0])}t.exports=function t(e,n,p){var f=p||{};return!!(f.strict?o(e,n):e===n)||(!e||!n||"object"!=typeof e&&"object"!=typeof n?f.strict?o(e,n):e==n:function(e,n,o){var p,f;if(typeof e!=typeof n)return!1;if(c(e)||c(n))return!1;if(e.prototype!==n.prototype)return!1;if(i(e)!==i(n))return!1;var d=a(e),m=a(n);if(d!==m)return!1;if(d||m)return e.source===n.source&&s(e)===s(n);if(u(e)&&u(n))return l.call(e)===l.call(n);var g=h(e),y=h(n);if(g!==y)return!1;if(g||y){if(e.length!==n.length)return!1;for(p=0;p<e.length;p++)if(e[p]!==n[p])return!1;return!0}if(typeof e!=typeof n)return!1;try{var v=r(e),_=r(n)}catch(t){return!1}if(v.length!==_.length)return!1;for(v.sort(),_.sort(),p=v.length-1;p>=0;p--)if(v[p]!=_[p])return!1;for(p=v.length-1;p>=0;p--)if(!t(e[f=v[p]],n[f],o))return!1;return!0}(e,n,f))}},6699:(t,e,n)=>{"use strict";var r=n(3571),i="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,a=Array.prototype.concat,s=Object.defineProperty,u=n(138)(),l=s&&u,c=function(t,e,n,r){var i;(!(e in t)||"function"==typeof(i=r)&&"[object Function]"===o.call(i)&&r())&&(l?s(t,e,{configurable:!0,enumerable:!1,value:n,writable:!0}):t[e]=n)},h=function(t,e){var n=arguments.length>2?arguments[2]:{},o=r(e);i&&(o=a.call(o,Object.getOwnPropertySymbols(e)));for(var s=0;s<o.length;s+=1)c(t,o[s],e[o[s]],n[o[s]])};h.supportsDescriptors=!!l,t.exports=h},6902:t=>{function e(t,e,n,r){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,n,r)}e.prototype.run=function(t,e,n,r){this._init(t,e,n,r);for(var i=0;i<this._datasetLength;i++)if(1!==this._visited[i]){this._visited[i]=1;var o=this._regionQuery(i);if(o.length<this.minPts)this.noise.push(i);else{var a=this.clusters.length;this.clusters.push([]),this._addToCluster(i,a),this._expandCluster(a,o)}}return this.clusters},e.prototype._init=function(t,e,n,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),n&&(this.minPts=n),r&&(this.distance=r)},e.prototype._expandCluster=function(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(1!==this._visited[r]){this._visited[r]=1;var i=this._regionQuery(r);i.length>=this.minPts&&(e=this._mergeArrays(e,i))}1!==this._assigned[r]&&this._addToCluster(r,t)}},e.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},e.prototype._regionQuery=function(t){for(var e=[],n=0;n<this._datasetLength;n++)this.distance(this.dataset[t],this.dataset[n])<this.epsilon&&e.push(n);return e},e.prototype._mergeArrays=function(t,e){for(var n=e.length,r=0;r<n;r++){var i=e[r];t.indexOf(i)<0&&t.push(i)}return t},e.prototype._euclideanDistance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},t.exports&&(t.exports=e)},6731:t=>{function e(t,e,n){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,n)}e.prototype.init=function(t,e,n){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==n&&(this.distance=n)},e.prototype.run=function(t,e){this.init(t,e);for(var n=this.dataset.length,r=0;r<this.k;r++)this.centroids[r]=this.randomCentroid();for(var i=!0;i;){i=this.assign();for(var o=0;o<this.k;o++){for(var a=new Array(c),s=0,u=0;u<c;u++)a[u]=0;for(var l=0;l<n;l++){var c=this.dataset[l].length;if(o===this.assignments[l]){for(u=0;u<c;u++)a[u]+=this.dataset[l][u];s++}}if(s>0){for(u=0;u<c;u++)a[u]/=s;this.centroids[o]=a}else this.centroids[o]=this.randomCentroid(),i=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var t,e,n=this.dataset.length-1;do{e=Math.round(Math.random()*n),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},e.prototype.assign=function(){for(var t,e=!1,n=this.dataset.length,r=0;r<n;r++)(t=this.argmin(this.dataset[r],this.centroids,this.distance))!=this.assignments[r]&&(this.assignments[r]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),n=0;n<this.assignments.length;n++)void 0===e[t=this.assignments[n]]&&(e[t]=[]),e[t].push(n);return e},e.prototype.argmin=function(t,e,n){for(var r,i=Number.MAX_VALUE,o=0,a=e.length,s=0;s<a;s++)(r=n(t,e[s]))<i&&(i=r,o=s);return o},e.prototype.distance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;){var i=t[r]-e[r];n+=i*i}return Math.sqrt(n)},t.exports&&(t.exports=e)},6515:(t,e,n)=>{if(t.exports)var r=n(5672);function i(t,e,n,r){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,n,r)}i.prototype.run=function(t,e,n,i){this._init(t,e,n,i);for(var o=0,a=this.dataset.length;o<a;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var s=this.clusters.length-1;this._orderedList.push(o);var u=new r(null,null,"asc"),l=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,l,u),this._expandCluster(s,u))}return this.clusters},i.prototype.getReachabilityPlot=function(){for(var t=[],e=0,n=this._orderedList.length;e<n;e++){var r=this._orderedList[e],i=this._reachability[r];t.push([r,i])}return t},i.prototype._init=function(t,e,n,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),n&&(this.minPts=n),r&&(this.distance=r)},i.prototype._updateQueue=function(t,e,n){var r=this;this._coreDistance=this._distanceToCore(t),e.forEach((function(e){if(void 0===r._processed[e]){var i=r.distance(r.dataset[t],r.dataset[e]),o=Math.max(r._coreDistance,i);void 0===r._reachability[e]?(r._reachability[e]=o,n.insert(e,o)):o<r._reachability[e]&&(r._reachability[e]=o,n.remove(e),n.insert(e,o))}}))},i.prototype._expandCluster=function(t,e){for(var n=e.getElements(),r=0,i=n.length;r<i;r++){var o=n[r];if(void 0===this._processed[o]){var a=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,a,e),this._expandCluster(t,e))}}},i.prototype._distanceToCore=function(t){for(var e=this.epsilon,n=0;n<e;n++)if(this._regionQuery(t,n).length>=this.minPts)return n},i.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var n=[],r=0,i=this.dataset.length;r<i;r++)this.distance(this.dataset[t],this.dataset[r])<e&&n.push(r);return n},i.prototype._euclideanDistance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},t.exports&&(t.exports=i)},5672:t=>{function e(t,e,n){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,n)}e.prototype.insert=function(t,e){for(var n=this._queue.length,r=n;r--;){var i=this._priorities[r];"desc"===this._sorting?e>i&&(n=r):e<i&&(n=r)}this._insertAt(t,e,n)},e.prototype.remove=function(t){for(var e=this._queue.length;e--;)if(t===this._queue[e]){this._queue.splice(e,1),this._priorities.splice(e,1);break}},e.prototype.forEach=function(t){this._queue.forEach(t)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(t){return this._priorities[t]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,n=this._queue.length;e<n;e++)t.push([this._queue[e],this._priorities[e]]);return t},e.prototype._init=function(t,e,n){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var r=0;r<t.length;r++)this.insert(t[r],e[r])}n&&(this._sorting=n)},e.prototype._insertAt=function(t,e,n){this._queue.length===n?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(n,0,t),this._priorities.splice(n,0,e))},t.exports&&(t.exports=e)},8788:(t,e,n)=>{t.exports&&(t.exports={DBSCAN:n(6902),KMEANS:n(6731),OPTICS:n(6515),PriorityQueue:n(5672)})},6319:t=>{"use strict";function e(t,e,r){r=r||2;var o,a,s,u,h,p,d,m=e&&e.length,g=m?e[0]*r:t.length,y=n(t,0,g,r,!0),v=[];if(!y||y.next===y.prev)return v;if(m&&(y=function(t,e,r,i){var o,a,s,u=[];for(o=0,a=e.length;o<a;o++)(s=n(t,e[o]*i,o<a-1?e[o+1]*i:t.length,i,!1))===s.next&&(s.steiner=!0),u.push(f(s));for(u.sort(l),o=0;o<u.length;o++)r=c(u[o],r);return r}(t,e,y,r)),t.length>80*r){o=s=t[0],a=u=t[1];for(var _=r;_<g;_+=r)(h=t[_])<o&&(o=h),(p=t[_+1])<a&&(a=p),h>s&&(s=h),p>u&&(u=p);d=0!==(d=Math.max(s-o,u-a))?32767/d:0}return i(y,v,r,o,a,d,0),v}function n(t,e,n,r,i){var o,a;if(i===M(t,e,n,r)>0)for(o=e;o<n;o+=r)a=S(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=S(o,t[o],t[o+1],a);return a&&y(a,a.next)&&(E(a),a=a.next),a}function r(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!y(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(E(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function i(t,e,n,l,c,h,f){if(t){!f&&h&&function(t,e,n,r){var i=t;do{0===i.z&&(i.z=p(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,l,c,h);for(var d,m,g=t;t.prev!==t.next;)if(d=t.prev,m=t.next,h?a(t,l,c,h):o(t))e.push(d.i/n|0),e.push(t.i/n|0),e.push(m.i/n|0),E(t),t=m.next,g=m.next;else if((t=m)===g){f?1===f?i(t=s(r(t),e,n),e,n,l,c,h,2):2===f&&u(t,e,n,l,c,h):i(r(t),e,n,l,c,h,1);break}}}function o(t){var e=t.prev,n=t,r=t.next;if(g(e,n,r)>=0)return!1;for(var i=e.x,o=n.x,a=r.x,s=e.y,u=n.y,l=r.y,c=i<o?i<a?i:a:o<a?o:a,h=s<u?s<l?s:l:u<l?u:l,p=i>o?i>a?i:a:o>a?o:a,f=s>u?s>l?s:l:u>l?u:l,m=r.next;m!==e;){if(m.x>=c&&m.x<=p&&m.y>=h&&m.y<=f&&d(i,s,o,u,a,l,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function a(t,e,n,r){var i=t.prev,o=t,a=t.next;if(g(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,l=a.x,c=i.y,h=o.y,f=a.y,m=s<u?s<l?s:l:u<l?u:l,y=c<h?c<f?c:f:h<f?h:f,v=s>u?s>l?s:l:u>l?u:l,_=c>h?c>f?c:f:h>f?h:f,x=p(m,y,e,n,r),b=p(v,_,e,n,r),w=t.prevZ,S=t.nextZ;w&&w.z>=x&&S&&S.z<=b;){if(w.x>=m&&w.x<=v&&w.y>=y&&w.y<=_&&w!==i&&w!==a&&d(s,c,u,h,l,f,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,S.x>=m&&S.x<=v&&S.y>=y&&S.y<=_&&S!==i&&S!==a&&d(s,c,u,h,l,f,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.nextZ}for(;w&&w.z>=x;){if(w.x>=m&&w.x<=v&&w.y>=y&&w.y<=_&&w!==i&&w!==a&&d(s,c,u,h,l,f,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;S&&S.z<=b;){if(S.x>=m&&S.x<=v&&S.y>=y&&S.y<=_&&S!==i&&S!==a&&d(s,c,u,h,l,f,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function s(t,e,n){var i=t;do{var o=i.prev,a=i.next.next;!y(o,a)&&v(o,i,i.next,a)&&b(o,a)&&b(a,o)&&(e.push(o.i/n|0),e.push(i.i/n|0),e.push(a.i/n|0),E(i),E(i.next),i=t=a),i=i.next}while(i!==t);return r(i)}function u(t,e,n,o,a,s){var u=t;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&m(u,l)){var c=w(u,l);return u=r(u,u.next),c=r(c,c.next),i(u,e,n,o,a,s,0),void i(c,e,n,o,a,s,0)}l=l.next}u=u.next}while(u!==t)}function l(t,e){return t.x-e.x}function c(t,e){var n=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==e);if(!n)return null;var u,l=n,c=n.x,p=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&d(o<p?i:a,o,c,p,o<p?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),b(r,t)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,f=u)),r=r.next}while(r!==l);return n}(t,e);if(!n)return e;var i=w(n,t);return r(i,i.next),r(n,n.next)}function h(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function p(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function d(t,e,n,r,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(r-s)>=(n-a)*(e-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&v(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(b(t,e)&&b(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||y(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function v(t,e,n,r){var i=x(g(t,e,n)),o=x(g(t,e,r)),a=x(g(n,r,t)),s=x(g(n,r,e));return i!==o&&a!==s||!(0!==i||!_(t,n,e))||!(0!==o||!_(t,r,e))||!(0!==a||!_(n,t,r))||!(0!==s||!_(n,e,r))}function _(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function x(t){return t>0?1:t<0?-1:0}function b(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function w(t,e){var n=new C(t.i,t.x,t.y),r=new C(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function S(t,e,n,r){var i=new C(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function E(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function C(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=e,t.exports.default=e,e.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(M(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,c=s<u-1?e[s+1]*n:t.length;a-=Math.abs(M(t,l,c,n))}var h=0;for(s=0;s<r.length;s+=3){var p=r[s]*n,f=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},e.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},1154:t=>{function e(t){var e=t.target||t.srcElement;e.__resizeRAF__&&cancelAnimationFrame(e.__resizeRAF__),e.__resizeRAF__=requestAnimationFrame((function(){var n=e.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(e){e.call(n,t)}))}))}var n=function(t,n){var r,i=this.document,o=i.attachEvent;if("undefined"!=typeof navigator&&(r=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!t.__resizeListeners__)if(t.__resizeListeners__=[],o)t.__resizeTrigger__=t,t.attachEvent("onresize",e);else{"static"===getComputedStyle(t).position&&(t.style.position="relative");var a=t.__resizeTrigger__=i.createElement("object");a.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),a.setAttribute("class","resize-sensor"),a.setAttribute("tabindex","-1"),a.setAttribute("title",""),a.__resizeElement__=t,a.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",e)},a.type="text/html",r&&t.appendChild(a),a.data="about:blank",r||t.appendChild(a)}t.__resizeListeners__.push(n)};t.exports="undefined"==typeof window?n:n.bind(window),t.exports.unbind=function(t,n){var r=document.attachEvent,i=t.__resizeListeners__||[];if(n){var o=i.indexOf(n);-1!==o&&i.splice(o,1)}else i=t.__resizeListeners__=[];if(!i.length){if(r)t.detachEvent("onresize",e);else if(t.__resizeTrigger__){var a=t.__resizeTrigger__.contentDocument,s=a&&a.defaultView;s&&(s.removeEventListener("resize",e),delete s.__resizeTrigger__),t.__resizeTrigger__=!t.removeChild(t.__resizeTrigger__)}delete t.__resizeListeners__}}},1883:t=>{"use strict";var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||t,a),u=n?n+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},s.prototype.emit=function(t,e,r,i,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var u,l,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,i),!0;case 5:return c.fn.call(c.context,e,r,i,o),!0;case 6:return c.fn.call(c.context,e,r,i,o,a),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var p,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,r);break;case 4:c[l].fn.call(c[l].context,e,r,i);break;default:if(!u)for(p=1,u=new Array(h-1);p<h;p++)u[p-1]=arguments[p];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,i){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==e||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s},9748:t=>{"use strict";var e="Function.prototype.bind called on incompatible ",n=Array.prototype.slice,r=Object.prototype.toString,i="[object Function]";t.exports=function(t){var o=this;if("function"!=typeof o||r.call(o)!==i)throw new TypeError(e+o);for(var a,s=n.call(arguments,1),u=function(){if(this instanceof a){var e=o.apply(this,s.concat(n.call(arguments)));return Object(e)===e?e:this}return o.apply(t,s.concat(n.call(arguments)))},l=Math.max(0,o.length-s.length),c=[],h=0;h<l;h++)c.push("$"+h);if(a=Function("binder","return function ("+c.join(",")+"){ return binder.apply(this,arguments); }")(u),o.prototype){var p=function(){};p.prototype=o.prototype,a.prototype=new p,p.prototype=null}return a}},2698:(t,e,n)=>{"use strict";var r=n(9748);t.exports=Function.prototype.bind||r},9879:t=>{"use strict";var e=function(){return"string"==typeof function(){}.name},n=Object.getOwnPropertyDescriptor;if(n)try{n([],"length")}catch(t){n=null}e.functionsHaveConfigurableNames=function(){if(!e()||!n)return!1;var t=n((function(){}),"name");return!!t&&!!t.configurable};var r=Function.prototype.bind;e.boundFunctionsHaveNames=function(){return e()&&"function"==typeof r&&""!==function(){}.bind().name},t.exports=e},2950:(t,e,n)=>{var r=n(1374),i=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:s};function o(t){return t.coordinates.map((function(e){return{type:t.type.replace("Multi",""),coordinates:e}}))}function a(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function s(t,e){return r(t,e,{strict:!0})}i.prototype.compare=function(t,e){if(t.type!==e.type||!a(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var n=this,r=o(t),i=o(e);return r.every((function(t){return this.some((function(e){return n.compare(t,e)}))}),i)}}return!1},i.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n].toFixed(this.precision)!==e[n].toFixed(this.precision))return!1;return!0},i.prototype.compareLine=function(t,e,n,r){if(!a(t,e))return!1;var i=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!r||this.compareCoord(i[0],o[0])||(o=this.fixStartIndex(o,i))){var s=this.compareCoord(i[n],o[n]);return this.direction||s?this.comparePath(i,o):!!this.compareCoord(i[n],o[o.length-(1+n)])&&this.comparePath(i.slice().reverse(),o)}},i.prototype.fixStartIndex=function(t,e){for(var n,r=-1,i=0;i<t.length;i++)if(this.compareCoord(t[i],e[0])){r=i;break}return r>=0&&(n=[].concat(t.slice(r,t.length),t.slice(1,r+1))),n},i.prototype.comparePath=function(t,e){var n=this;return t.every((function(t,e){return n.compareCoord(t,this[e])}),e)},i.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var n=t.coordinates.slice(1,t.coordinates.length),r=e.coordinates.slice(1,e.coordinates.length),i=this;return n.every((function(t){return this.some((function(e){return i.compareLine(t,e,1,!0)}))}),r)}return!1},i.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},i.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},i.prototype.removePseudo=function(t){return t},t.exports=i},2399:(t,e,n)=>{var r=n(8346),i=n(3969),o=n(4262),a=n(3374).Z,s=o.featureEach,u=(o.coordEach,i.polygon,i.featureCollection);function l(t){var e=new r(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:a(t),r.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:a(t),e.push(t)})):s(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:a(t),e.push(t)})),r.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:a(t),r.prototype.remove.call(this,t,e)},e.clear=function(){return r.prototype.clear.call(this)},e.search=function(t){var e=r.prototype.search.call(this,this.toBBox(t));return u(e)},e.collides=function(t){return r.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=r.prototype.all.call(this);return u(t)},e.toJSON=function(){return r.prototype.toJSON.call(this)},e.fromJSON=function(t){return r.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=a(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=a(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}t.exports=l,t.exports.default=l},8487:(t,e,n)=>{"use strict";var r,i=SyntaxError,o=Function,a=TypeError,s=function(t){try{return o('"use strict"; return ('+t+").constructor;")()}catch(t){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(t){u=null}var l=function(){throw new a},c=u?function(){try{return l}catch(t){try{return u(arguments,"callee").get}catch(t){return l}}}():l,h=n(2770)(),p=Object.getPrototypeOf||function(t){return t.__proto__},f={},d="undefined"==typeof Uint8Array?r:p(Uint8Array),m={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":h?p([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h?p(p([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h?p((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h?p((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h?p(""[Symbol.iterator]()):r,"%Symbol%":h?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":c,"%TypedArray%":d,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet},g=function t(e){var n;if("%AsyncFunction%"===e)n=s("async function () {}");else if("%GeneratorFunction%"===e)n=s("function* () {}");else if("%AsyncGeneratorFunction%"===e)n=s("async function* () {}");else if("%AsyncGenerator%"===e){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===e){var i=t("%AsyncGenerator%");i&&(n=p(i.prototype))}return m[e]=n,n},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},v=n(2698),_=n(2786),x=v.call(Function.call,Array.prototype.concat),b=v.call(Function.apply,Array.prototype.splice),w=v.call(Function.call,String.prototype.replace),S=v.call(Function.call,String.prototype.slice),E=v.call(Function.call,RegExp.prototype.exec),C=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,M=/\\(\\)?/g,T=function(t){var e=S(t,0,1),n=S(t,-1);if("%"===e&&"%"!==n)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==e)throw new i("invalid intrinsic syntax, expected opening `%`");var r=[];return w(t,C,(function(t,e,n,i){r[r.length]=n?w(i,M,"$1"):e||t})),r},A=function(t,e){var n,r=t;if(_(y,r)&&(r="%"+(n=y[r])[0]+"%"),_(m,r)){var o=m[r];if(o===f&&(o=g(r)),void 0===o&&!e)throw new a("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:o}}throw new i("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new a('"allowMissing" argument must be a boolean');if(null===E(/^%?[^%]*%?$/,t))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=T(t),r=n.length>0?n[0]:"",o=A("%"+r+"%",e),s=o.name,l=o.value,c=!1,h=o.alias;h&&(r=h[0],b(n,x([0,1],h)));for(var p=1,f=!0;p<n.length;p+=1){var d=n[p],g=S(d,0,1),y=S(d,-1);if(('"'===g||"'"===g||"`"===g||'"'===y||"'"===y||"`"===y)&&g!==y)throw new i("property names with quotes must have matching quotes");if("constructor"!==d&&f||(c=!0),_(m,s="%"+(r+="."+d)+"%"))l=m[s];else if(null!=l){if(!(d in l)){if(!e)throw new a("base intrinsic for "+t+" exists, but the property is not available.");return}if(u&&p+1>=n.length){var v=u(l,d);l=(f=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:l[d]}else f=_(l,d),l=l[d];f&&!c&&(m[s]=l)}}return l}},4249:(t,e,n)=>{"use strict";n.d(e,{FD:()=>o,Ib:()=>r,WT:()=>i});var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,o=Math.random;Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},2401:(t,e,n)=>{"use strict";n.r(e),n.d(e,{add:()=>q,adjoint:()=>p,clone:()=>o,copy:()=>a,create:()=>i,determinant:()=>f,equals:()=>J,exactEquals:()=>Q,frob:()=>W,fromQuat:()=>R,fromQuat2:()=>A,fromRotation:()=>S,fromRotationTranslation:()=>T,fromRotationTranslationScale:()=>k,fromRotationTranslationScaleOrigin:()=>O,fromScaling:()=>w,fromTranslation:()=>b,fromValues:()=>s,fromXRotation:()=>E,fromYRotation:()=>C,fromZRotation:()=>M,frustum:()=>D,getRotation:()=>I,getScaling:()=>L,getTranslation:()=>P,identity:()=>l,invert:()=>h,lookAt:()=>V,mul:()=>$,multiply:()=>d,multiplyScalar:()=>Y,multiplyScalarAndAdd:()=>K,ortho:()=>U,orthoNO:()=>j,orthoZO:()=>Z,perspective:()=>F,perspectiveFromFieldOfView:()=>B,perspectiveNO:()=>N,perspectiveZO:()=>z,rotate:()=>y,rotateX:()=>v,rotateY:()=>_,rotateZ:()=>x,scale:()=>g,set:()=>u,str:()=>H,sub:()=>tt,subtract:()=>X,targetTo:()=>G,translate:()=>m,transpose:()=>c});var r=n(4249);function i(){var t=new r.WT(16);return r.WT!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function o(t){var e=new r.WT(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function s(t,e,n,i,o,a,s,u,l,c,h,p,f,d,m,g){var y=new r.WT(16);return y[0]=t,y[1]=e,y[2]=n,y[3]=i,y[4]=o,y[5]=a,y[6]=s,y[7]=u,y[8]=l,y[9]=c,y[10]=h,y[11]=p,y[12]=f,y[13]=d,y[14]=m,y[15]=g,y}function u(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=c,t[10]=h,t[11]=p,t[12]=f,t[13]=d,t[14]=m,t[15]=g,t}function l(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function h(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],g=e[14],y=e[15],v=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,w=r*l-o*s,S=i*l-o*u,E=c*m-h*d,C=c*g-p*d,M=c*y-f*d,T=h*g-p*m,A=h*y-f*m,P=p*y-f*g,L=v*P-_*A+x*T+b*M-w*C+S*E;return L?(L=1/L,t[0]=(s*P-u*A+l*T)*L,t[1]=(i*A-r*P-o*T)*L,t[2]=(m*S-g*w+y*b)*L,t[3]=(p*w-h*S-f*b)*L,t[4]=(u*M-a*P-l*C)*L,t[5]=(n*P-i*M+o*C)*L,t[6]=(g*x-d*S-y*_)*L,t[7]=(c*S-p*x+f*_)*L,t[8]=(a*A-s*M+l*E)*L,t[9]=(r*M-n*A-o*E)*L,t[10]=(d*w-m*x+y*v)*L,t[11]=(h*x-c*w-f*v)*L,t[12]=(s*C-a*T-u*E)*L,t[13]=(n*T-r*C+i*E)*L,t[14]=(m*_-d*b-g*v)*L,t[15]=(c*b-h*_+p*v)*L,t):null}function p(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],g=e[14],y=e[15];return t[0]=s*(p*y-f*g)-h*(u*y-l*g)+m*(u*f-l*p),t[1]=-(r*(p*y-f*g)-h*(i*y-o*g)+m*(i*f-o*p)),t[2]=r*(u*y-l*g)-s*(i*y-o*g)+m*(i*l-o*u),t[3]=-(r*(u*f-l*p)-s*(i*f-o*p)+h*(i*l-o*u)),t[4]=-(a*(p*y-f*g)-c*(u*y-l*g)+d*(u*f-l*p)),t[5]=n*(p*y-f*g)-c*(i*y-o*g)+d*(i*f-o*p),t[6]=-(n*(u*y-l*g)-a*(i*y-o*g)+d*(i*l-o*u)),t[7]=n*(u*f-l*p)-a*(i*f-o*p)+c*(i*l-o*u),t[8]=a*(h*y-f*m)-c*(s*y-l*m)+d*(s*f-l*h),t[9]=-(n*(h*y-f*m)-c*(r*y-o*m)+d*(r*f-o*h)),t[10]=n*(s*y-l*m)-a*(r*y-o*m)+d*(r*l-o*s),t[11]=-(n*(s*f-l*h)-a*(r*f-o*h)+c*(r*l-o*s)),t[12]=-(a*(h*g-p*m)-c*(s*g-u*m)+d*(s*p-u*h)),t[13]=n*(h*g-p*m)-c*(r*g-i*m)+d*(r*p-i*h),t[14]=-(n*(s*g-u*m)-a*(r*g-i*m)+d*(r*u-i*s)),t[15]=n*(s*p-u*h)-a*(r*p-i*h)+c*(r*u-i*s),t}function f(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],f=t[12],d=t[13],m=t[14],g=t[15];return(e*a-n*o)*(h*g-p*m)-(e*s-r*o)*(c*g-p*d)+(e*u-i*o)*(c*m-h*d)+(n*s-r*a)*(l*g-p*f)-(n*u-i*a)*(l*m-h*f)+(r*u-i*s)*(l*d-c*f)}function d(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],g=e[13],y=e[14],v=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*h+w*m,t[1]=_*i+x*u+b*p+w*g,t[2]=_*o+x*l+b*f+w*y,t[3]=_*a+x*c+b*d+w*v,_=n[4],x=n[5],b=n[6],w=n[7],t[4]=_*r+x*s+b*h+w*m,t[5]=_*i+x*u+b*p+w*g,t[6]=_*o+x*l+b*f+w*y,t[7]=_*a+x*c+b*d+w*v,_=n[8],x=n[9],b=n[10],w=n[11],t[8]=_*r+x*s+b*h+w*m,t[9]=_*i+x*u+b*p+w*g,t[10]=_*o+x*l+b*f+w*y,t[11]=_*a+x*c+b*d+w*v,_=n[12],x=n[13],b=n[14],w=n[15],t[12]=_*r+x*s+b*h+w*m,t[13]=_*i+x*u+b*p+w*g,t[14]=_*o+x*l+b*f+w*y,t[15]=_*a+x*c+b*d+w*v,t}function m(t,e,n){var r,i,o,a,s,u,l,c,h,p,f,d,m=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=r*m+s*g+h*y+e[12],t[13]=i*m+u*g+p*y+e[13],t[14]=o*m+l*g+f*y+e[14],t[15]=a*m+c*g+d*y+e[15]),t}function g(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function y(t,e,n,i){var o,a,s,u,l,c,h,p,f,d,m,g,y,v,_,x,b,w,S,E,C,M,T,A,P=i[0],L=i[1],I=i[2],k=Math.hypot(P,L,I);return k<r.Ib?null:(P*=k=1/k,L*=k,I*=k,o=Math.sin(n),s=1-(a=Math.cos(n)),u=e[0],l=e[1],c=e[2],h=e[3],p=e[4],f=e[5],d=e[6],m=e[7],g=e[8],y=e[9],v=e[10],_=e[11],x=P*P*s+a,b=L*P*s+I*o,w=I*P*s-L*o,S=P*L*s-I*o,E=L*L*s+a,C=I*L*s+P*o,M=P*I*s+L*o,T=L*I*s-P*o,A=I*I*s+a,t[0]=u*x+p*b+g*w,t[1]=l*x+f*b+y*w,t[2]=c*x+d*b+v*w,t[3]=h*x+m*b+_*w,t[4]=u*S+p*E+g*C,t[5]=l*S+f*E+y*C,t[6]=c*S+d*E+v*C,t[7]=h*S+m*E+_*C,t[8]=u*M+p*T+g*A,t[9]=l*M+f*T+y*A,t[10]=c*M+d*T+v*A,t[11]=h*M+m*T+_*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function v(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=u*i+p*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=p*i-u*r,t}function _(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*r,t[1]=a*i-c*r,t[2]=s*i-h*r,t[3]=u*i-p*r,t[8]=o*r+l*i,t[9]=a*r+c*i,t[10]=s*r+h*i,t[11]=u*r+p*i,t}function x(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=u*i+p*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=p*i-u*r,t}function b(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function w(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function S(t,e,n){var i,o,a,s=n[0],u=n[1],l=n[2],c=Math.hypot(s,u,l);return c<r.Ib?null:(s*=c=1/c,u*=c,l*=c,i=Math.sin(e),a=1-(o=Math.cos(e)),t[0]=s*s*a+o,t[1]=u*s*a+l*i,t[2]=l*s*a-u*i,t[3]=0,t[4]=s*u*a-l*i,t[5]=u*u*a+o,t[6]=l*u*a+s*i,t[7]=0,t[8]=s*l*a+u*i,t[9]=u*l*a-s*i,t[10]=l*l*a+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function E(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function C(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,l=o+o,c=r*s,h=r*u,p=r*l,f=i*u,d=i*l,m=o*l,g=a*s,y=a*u,v=a*l;return t[0]=1-(f+m),t[1]=h+v,t[2]=p-y,t[3]=0,t[4]=h-v,t[5]=1-(c+m),t[6]=d+g,t[7]=0,t[8]=p+y,t[9]=d-g,t[10]=1-(c+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function A(t,e){var n=new r.WT(3),i=-e[0],o=-e[1],a=-e[2],s=e[3],u=e[4],l=e[5],c=e[6],h=e[7],p=i*i+o*o+a*a+s*s;return p>0?(n[0]=2*(u*s+h*i+l*a-c*o)/p,n[1]=2*(l*s+h*o+c*i-u*a)/p,n[2]=2*(c*s+h*a+u*o-l*i)/p):(n[0]=2*(u*s+h*i+l*a-c*o),n[1]=2*(l*s+h*o+c*i-u*a),n[2]=2*(c*s+h*a+u*o-l*i)),T(t,e,n),t}function P(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function L(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],l=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,l,c),t}function I(t,e){var n=new r.WT(3);L(n,e);var i=1/n[0],o=1/n[1],a=1/n[2],s=e[0]*i,u=e[1]*o,l=e[2]*a,c=e[4]*i,h=e[5]*o,p=e[6]*a,f=e[8]*i,d=e[9]*o,m=e[10]*a,g=s+h+m,y=0;return g>0?(y=2*Math.sqrt(g+1),t[3]=.25*y,t[0]=(p-d)/y,t[1]=(f-l)/y,t[2]=(u-c)/y):s>h&&s>m?(y=2*Math.sqrt(1+s-h-m),t[3]=(p-d)/y,t[0]=.25*y,t[1]=(u+c)/y,t[2]=(f+l)/y):h>m?(y=2*Math.sqrt(1+h-s-m),t[3]=(f-l)/y,t[0]=(u+c)/y,t[1]=.25*y,t[2]=(p+d)/y):(y=2*Math.sqrt(1+m-s-h),t[3]=(u-c)/y,t[0]=(f+l)/y,t[1]=(p+d)/y,t[2]=.25*y),t}function k(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,l=o+o,c=a+a,h=i*u,p=i*l,f=i*c,d=o*l,m=o*c,g=a*c,y=s*u,v=s*l,_=s*c,x=r[0],b=r[1],w=r[2];return t[0]=(1-(d+g))*x,t[1]=(p+_)*x,t[2]=(f-v)*x,t[3]=0,t[4]=(p-_)*b,t[5]=(1-(h+g))*b,t[6]=(m+y)*b,t[7]=0,t[8]=(f+v)*w,t[9]=(m-y)*w,t[10]=(1-(h+d))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function O(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,c=a+a,h=s+s,p=o*l,f=o*c,d=o*h,m=a*c,g=a*h,y=s*h,v=u*l,_=u*c,x=u*h,b=r[0],w=r[1],S=r[2],E=i[0],C=i[1],M=i[2],T=(1-(m+y))*b,A=(f+x)*b,P=(d-_)*b,L=(f-x)*w,I=(1-(p+y))*w,k=(g+v)*w,O=(d+_)*S,R=(g-v)*S,D=(1-(p+m))*S;return t[0]=T,t[1]=A,t[2]=P,t[3]=0,t[4]=L,t[5]=I,t[6]=k,t[7]=0,t[8]=O,t[9]=R,t[10]=D,t[11]=0,t[12]=n[0]+E-(T*E+L*C+O*M),t[13]=n[1]+C-(A*E+I*C+R*M),t[14]=n[2]+M-(P*E+k*C+D*M),t[15]=1,t}function R(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,p=i*a,f=i*s,d=i*u,m=o*a,g=o*s,y=o*u;return t[0]=1-h-d,t[1]=c+y,t[2]=p-g,t[3]=0,t[4]=c-y,t[5]=1-l-d,t[6]=f+m,t[7]=0,t[8]=p+g,t[9]=f-m,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function D(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t}function N(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var F=N;function z(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function B(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function j(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t}var U=j;function Z(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*l,t[15]=1,t}function V(t,e,n,i){var o,a,s,u,c,h,p,f,d,m,g=e[0],y=e[1],v=e[2],_=i[0],x=i[1],b=i[2],w=n[0],S=n[1],E=n[2];return Math.abs(g-w)<r.Ib&&Math.abs(y-S)<r.Ib&&Math.abs(v-E)<r.Ib?l(t):(p=g-w,f=y-S,d=v-E,o=x*(d*=m=1/Math.hypot(p,f,d))-b*(f*=m),a=b*(p*=m)-_*d,s=_*f-x*p,(m=Math.hypot(o,a,s))?(o*=m=1/m,a*=m,s*=m):(o=0,a=0,s=0),u=f*s-d*a,c=d*o-p*s,h=p*a-f*o,(m=Math.hypot(u,c,h))?(u*=m=1/m,c*=m,h*=m):(u=0,c=0,h=0),t[0]=o,t[1]=u,t[2]=p,t[3]=0,t[4]=a,t[5]=c,t[6]=f,t[7]=0,t[8]=s,t[9]=h,t[10]=d,t[11]=0,t[12]=-(o*g+a*y+s*v),t[13]=-(u*g+c*y+h*v),t[14]=-(p*g+f*y+d*v),t[15]=1,t)}function G(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=o-n[1],p=a-n[2],f=c*c+h*h+p*p;f>0&&(c*=f=1/Math.sqrt(f),h*=f,p*=f);var d=u*p-l*h,m=l*c-s*p,g=s*h-u*c;return(f=d*d+m*m+g*g)>0&&(d*=f=1/Math.sqrt(f),m*=f,g*=f),t[0]=d,t[1]=m,t[2]=g,t[3]=0,t[4]=h*g-p*m,t[5]=p*d-c*g,t[6]=c*m-h*d,t[7]=0,t[8]=c,t[9]=h,t[10]=p,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function H(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function W(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function q(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function X(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Y(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function K(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Q(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function J(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],d=t[11],m=t[12],g=t[13],y=t[14],v=t[15],_=e[0],x=e[1],b=e[2],w=e[3],S=e[4],E=e[5],C=e[6],M=e[7],T=e[8],A=e[9],P=e[10],L=e[11],I=e[12],k=e[13],O=e[14],R=e[15];return Math.abs(n-_)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-x)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-w)<=r.Ib*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-S)<=r.Ib*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(u-E)<=r.Ib*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(l-C)<=r.Ib*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-M)<=r.Ib*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(h-T)<=r.Ib*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(p-A)<=r.Ib*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(f-P)<=r.Ib*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(d-L)<=r.Ib*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(m-I)<=r.Ib*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(g-k)<=r.Ib*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(y-O)<=r.Ib*Math.max(1,Math.abs(y),Math.abs(O))&&Math.abs(v-R)<=r.Ib*Math.max(1,Math.abs(v),Math.abs(R))}var $=d,tt=X},9341:(t,e,n)=>{"use strict";n.d(e,{$X:()=>l,AK:()=>p,Fv:()=>h,IH:()=>u,JG:()=>a,Ue:()=>i,al:()=>o,lu:()=>d,t7:()=>f,t8:()=>s,tk:()=>c});var r=n(4249);function i(){var t=new r.WT(2);return r.WT!=Float32Array&&(t[0]=0,t[1]=0),t}function o(t,e){var n=new r.WT(2);return n[0]=t,n[1]=e,n}function a(t,e){return t[0]=e[0],t[1]=e[1],t}function s(t,e,n){return t[0]=e,t[1]=n,t}function u(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function l(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function c(t,e){return t[0]=-e[0],t[1]=-e[1],t}function h(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function p(t,e){return t[0]*e[0]+t[1]*e[1]}function f(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}var d=l;i()},2329:(t,e,n)=>{"use strict";n.r(e),n.d(e,{add:()=>c,angle:()=>B,bezier:()=>I,ceil:()=>d,clone:()=>o,copy:()=>u,create:()=>i,cross:()=>A,dist:()=>X,distance:()=>b,div:()=>q,divide:()=>f,dot:()=>T,equals:()=>V,exactEquals:()=>Z,floor:()=>m,forEach:()=>J,fromValues:()=>s,hermite:()=>L,inverse:()=>C,len:()=>K,length:()=>a,lerp:()=>P,max:()=>y,min:()=>g,mul:()=>W,multiply:()=>p,negate:()=>E,normalize:()=>M,random:()=>k,rotateX:()=>N,rotateY:()=>F,rotateZ:()=>z,round:()=>v,scale:()=>_,scaleAndAdd:()=>x,set:()=>l,sqrDist:()=>Y,sqrLen:()=>Q,squaredDistance:()=>w,squaredLength:()=>S,str:()=>U,sub:()=>H,subtract:()=>h,transformMat3:()=>R,transformMat4:()=>O,transformQuat:()=>D,zero:()=>j});var r=n(4249);function i(){var t=new r.WT(3);return r.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function o(t){var e=new r.WT(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function s(t,e,n){var i=new r.WT(3);return i[0]=t,i[1]=e,i[2]=n,i}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function l(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function c(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function h(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function p(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function f(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function d(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function m(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function g(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function y(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function v(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function _(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function x(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function b(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function w(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function S(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function E(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function C(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function M(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function T(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function A(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function P(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function L(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*l+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*l+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*l+i[2]*c,t}function I(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,p=u*o;return t[0]=e[0]*l+n[0]*c+r[0]*h+i[0]*p,t[1]=e[1]*l+n[1]*c+r[1]*h+i[1]*p,t[2]=e[2]*l+n[2]*c+r[2]*h+i[2]*p,t}function k(t,e){e=e||1;var n=2*r.FD()*Math.PI,i=2*r.FD()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*o,t[1]=Math.sin(n)*o,t[2]=i*e,t}function O(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function R(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function D(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],l=e[2],c=i*l-o*u,h=o*s-r*l,p=r*u-i*s,f=i*p-o*h,d=o*c-r*p,m=r*h-i*c,g=2*a;return c*=g,h*=g,p*=g,f*=2,d*=2,m*=2,t[0]=s+c+f,t[1]=u+h+d,t[2]=l+p+m,t}function N(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function F(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function z(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function B(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),l=u&&T(t,e)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function j(t){return t[0]=0,t[1]=0,t[2]=0,t}function U(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Z(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function V(t,e){var n=t[0],i=t[1],o=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(n-a)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(u))}var G,H=h,W=p,q=f,X=b,Y=w,K=a,Q=S,J=(G=i(),function(t,e,n,r,i,o){var a,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)G[0]=t[a],G[1]=t[a+1],G[2]=t[a+2],i(G,G,o),t[a]=G[0],t[a+1]=G[1],t[a+2]=G[2];return t})},5512:(t,e,n)=>{"use strict";n.d(e,{Ue:()=>i,al:()=>o,bA:()=>a,fF:()=>s});var r=n(4249);function i(){var t=new r.WT(4);return r.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function o(t,e,n,i){var o=new r.WT(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=i,o}function a(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function s(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}i()},138:(t,e,n)=>{"use strict";var r=n(8487)("%Object.defineProperty%",!0),i=function(){if(r)try{return r({},"a",{value:1}),!0}catch(t){return!1}return!1};i.hasArrayLengthDefineBug=function(){if(!i())return null;try{return 1!==r([],"length",{value:1}).length}catch(t){return!0}},t.exports=i},2770:(t,e,n)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,i=n(9578);t.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&i()}},9578:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),n=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},3342:(t,e,n)=>{"use strict";var r=n(9578);t.exports=function(){return r()&&!!Symbol.toStringTag}},2786:(t,e,n)=>{"use strict";var r=n(2698);t.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},7164:(t,e)=>{e.read=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,p=n?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+f]=255&a,f+=d,a/=256,l-=8);t[n+f-d]|=128*m}},9953:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(t,e,r,i){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,e)&&Reflect.defineMetadata(n,r(),this,e),Reflect.hasMetadata(n,this,e)?Reflect.getMetadata(n,this,e):r()},set:function(t){Reflect.defineMetadata(n,t,this,e)}})}e.makePropertyInjectDecorator=function(t,e){return function(n){return function(i,o){r(i,o,(function(){return t.get(n)}),e)}}},e.makePropertyInjectNamedDecorator=function(t,e){return function(n,i){return function(o,a){r(o,a,(function(){return t.getNamed(n,i)}),e)}}},e.makePropertyInjectTaggedDecorator=function(t,e){return function(n,i,o){return function(a,s){r(a,s,(function(){return t.getTagged(n,i,o)}),e)}}},e.makePropertyMultiInjectDecorator=function(t,e){return function(n){return function(i,o){r(i,o,(function(){return t.getAll(n)}),e)}}}},719:(t,e,n)=>{"use strict";var r=n(9953);e.Z=function(t,e){return void 0===e&&(e=!0),{lazyInject:r.makePropertyInjectDecorator(t,e),lazyInjectNamed:r.makePropertyInjectNamedDecorator(t,e),lazyInjectTagged:r.makePropertyInjectTaggedDecorator(t,e),lazyMultiInject:r.makePropertyMultiInjectDecorator(t,e)}}},5976:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagProperty=e.tagParameter=e.decorate=void 0;var r=n(4172),i=n(8465);function o(t,e,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(a=Reflect.getMetadata(t,e));var l=a[u];if(Array.isArray(l))for(var c=0,h=l;c<h.length;c++){var p=h[c];if(p.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+p.key.toString())}else l=[];l.push(i),a[u]=l,Reflect.defineMetadata(t,a,e)}function a(t,e){Reflect.decorate(t,e)}function s(t,e){return function(n,r){e(n,r,t)}}e.tagParameter=function(t,e,n,r){o(i.TAGGED,t,e,r,n)},e.tagProperty=function(t,e,n){o(i.TAGGED_PROP,t.constructor,e,n)},e.decorate=function(t,e,n){"number"==typeof n?a([s(n,t)],e):"string"==typeof n?Reflect.decorate([t],e,n):a([t],e)}},5700:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.inject=e.LazyServiceIdentifer=void 0;var r=n(4172),i=n(8465),o=n(4543),a=n(5976),s=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();e.LazyServiceIdentifer=s,e.inject=function(t){return function(e,n,s){if(void 0===t)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(e.name));var u=new o.Metadata(i.INJECT_TAG,t);"number"==typeof s?a.tagParameter(e,n,s,u):a.tagProperty(e,n,u)}}},6047:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.injectable=void 0;var r=n(4172),i=n(8465);e.injectable=function(){return function(t){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,t))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(i.PARAM_TYPES,e,t),t}}},49:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiInject=void 0;var r=n(8465),i=n(4543),o=n(5976);e.multiInject=function(t){return function(e,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},5893:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.named=void 0;var r=n(8465),i=n(4543),o=n(5976);e.named=function(t){return function(e,n,a){var s=new i.Metadata(r.NAMED_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},339:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.optional=void 0;var r=n(8465),i=n(4543),o=n(5976);e.optional=function(){return function(t,e,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(t,e,n,a):o.tagProperty(t,e,a)}}},2622:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.postConstruct=void 0;var r=n(4172),i=n(8465),o=n(4543);e.postConstruct=function(){return function(t,e,n){var a=new o.Metadata(i.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,t.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,t.constructor)}}},1277:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagged=void 0;var r=n(4543),i=n(5976);e.tagged=function(t,e){return function(n,o,a){var s=new r.Metadata(t,e);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},5898:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.targetName=void 0;var r=n(8465),i=n(4543),o=n(5976);e.targetName=function(t){return function(e,n,a){var s=new i.Metadata(r.NAME_TAG,t);o.tagParameter(e,n,a,s)}}},1637:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unmanaged=void 0;var r=n(8465),i=n(4543),o=n(5976);e.unmanaged=function(){return function(t,e,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(t,e,n,a)}}},3383:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Binding=void 0;var r=n(4453),i=n(9022),o=function(){function t(t,e){this.id=i.id(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=e.scope===r.BindingScopeEnum.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();e.Binding=o},6925:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingCount=void 0,e.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},4172:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STACK_OVERFLOW=e.CIRCULAR_DEPENDENCY_IN_FACTORY=e.POST_CONSTRUCT_ERROR=e.MULTIPLE_POST_CONSTRUCT_METHODS=e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=e.ARGUMENTS_LENGTH_MISMATCH=e.INVALID_DECORATOR_OPERATION=e.INVALID_TO_SELF_VALUE=e.INVALID_FUNCTION_BINDING=e.INVALID_MIDDLEWARE_RETURN=e.NO_MORE_SNAPSHOTS_AVAILABLE=e.INVALID_BINDING_TYPE=e.NOT_IMPLEMENTED=e.CIRCULAR_DEPENDENCY=e.UNDEFINED_INJECT_ANNOTATION=e.MISSING_INJECT_ANNOTATION=e.MISSING_INJECTABLE_ANNOTATION=e.NOT_REGISTERED=e.CANNOT_UNBIND=e.AMBIGUOUS_MATCH=e.KEY_NOT_FOUND=e.NULL_ARGUMENT=e.DUPLICATED_METADATA=e.DUPLICATED_INJECTABLE_DECORATOR=void 0,e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",e.NULL_ARGUMENT="NULL argument",e.KEY_NOT_FOUND="Key Not Found",e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",e.UNDEFINED_INJECT_ANNOTATION=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},e.CIRCULAR_DEPENDENCY="Circular dependency found:",e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",e.INVALID_BINDING_TYPE="Invalid binding type:",e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",e.ARGUMENTS_LENGTH_MISMATCH=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",e.POST_CONSTRUCT_ERROR=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]},e.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."},e.STACK_OVERFLOW="Maximum call stack size exceeded"},4453:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TargetTypeEnum=e.BindingTypeEnum=e.BindingScopeEnum=void 0,e.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"},e.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},e.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},8465:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NON_CUSTOM_TAG_KEYS=e.POST_CONSTRUCT=e.DESIGN_PARAM_TYPES=e.PARAM_TYPES=e.TAGGED_PROP=e.TAGGED=e.MULTI_INJECT_TAG=e.INJECT_TAG=e.OPTIONAL_TAG=e.UNMANAGED_TAG=e.NAME_TAG=e.NAMED_TAG=void 0,e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct",e.NON_CUSTOM_TAG_KEYS=[e.INJECT_TAG,e.MULTI_INJECT_TAG,e.NAME_TAG,e.UNMANAGED_TAG,e.NAMED_TAG,e.OPTIONAL_TAG]},3357:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var a=n(3383),s=n(4172),u=n(4453),l=n(8465),c=n(4272),h=n(6144),p=n(4379),f=n(9774),d=n(9022),m=n(1062),g=n(2421),y=n(9643),v=function(){function t(t){this._appliedMiddleware=[];var e=t||{};if("object"!=typeof e)throw new Error(""+s.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=u.BindingScopeEnum.Transient;else if(e.defaultScope!==u.BindingScopeEnum.Singleton&&e.defaultScope!==u.BindingScopeEnum.Transient&&e.defaultScope!==u.BindingScopeEnum.Request)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!=typeof e.autoBindInjectable)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!=typeof e.skipBaseClassChecks)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.id=d.id(),this._bindingDictionary=new y.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new c.MetadataReader}return t.merge=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=new t,s=o([e,n],r).map((function(t){return h.getBindingDictionary(t)})),u=h.getBindingDictionary(a);function l(t,e){t.traverse((function(t,n){n.forEach((function(t){e.add(t.serviceIdentifier,t.clone())}))}))}return s.forEach((function(t){l(t,u)})),a},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=t;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,(function(){var e,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,r=t,i.label=1;case 1:return n<r.length?(o=r[n],a=e(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(t){return function(e){return e.moduleId===t}};e.forEach((function(e){var n=r(e.id);t._bindingDictionary.removeByCondition(n)}))},t.prototype.bind=function(t){var e=this.options.defaultScope||u.BindingScopeEnum.Transient,n=new a.Binding(t,e);return this._bindingDictionary.add(t,n),new f.BindingToSyntax(n)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(s.CANNOT_UNBIND+" "+m.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new y.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,l.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,n){var r=!1;if(this._bindingDictionary.hasKey(t)){var i=this._bindingDictionary.get(t),o=h.createMockRequest(this,t,e,n);r=i.some((function(t){return t.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,e,n)),r},t.prototype.snapshot=function(){this._snapshots.push(g.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw new Error(s.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var n=new t(e||this.options);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce((function(t,e){return e(t)}),n)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,u.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,n){return this._get(!1,!1,u.TargetTypeEnum.Variable,t,e,n)},t.prototype.getNamed=function(t,e){return this.getTagged(t,l.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,u.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,n){return this._get(!1,!0,u.TargetTypeEnum.Variable,t,e,n)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,l.NAMED_TAG,e)},t.prototype.resolve=function(t){var e=this.createChild();return e.bind(t).toSelf(),this._appliedMiddleware.forEach((function(t){e.applyMiddleware(t)})),e.get(t)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e},n=function(n){return function(r){var i=t.rebind.bind(t)(r);return e(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=t.bind.bind(t)(n);return e(r,i),r}),isboundFunction:function(e){return t.isBound.bind(t)(e)},rebindFunction:n(r),unbindFunction:function(e){t.unbind.bind(t)(e)}};var i}},t.prototype._get=function(t,e,n,r,i,o){var a=null,u={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(u)))throw new Error(s.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(u);return a},t.prototype._planAndResolve=function(){var t=this;return function(e){var n=h.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return n=e.contextInterceptor(n),p.resolve(n)}},t}();e.Container=v},5427:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncContainerModule=e.ContainerModule=void 0;var r=n(9022);e.ContainerModule=function(t){this.id=r.id(),this.registry=t};e.AsyncContainerModule=function(t){this.id=r.id(),this.registry=t}},2421:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerSnapshot=void 0;var n=function(){function t(){}return t.of=function(e,n){var r=new t;return r.bindings=e,r.middleware=n,r},t}();e.ContainerSnapshot=n},9643:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Lookup=void 0;var r=n(4172),i=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null==t)throw new Error(r.NULL_ARGUMENT);if(null==e)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(t);void 0!==n?(n.push(e),this._map.set(t,n)):this._map.set(t,[e])},t.prototype.get=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw new Error(r.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(t))throw new Error(r.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach((function(n,r){var i=n.filter((function(e){return!t(e)}));i.length>0?e._map.set(r,i):e._map.delete(r)}))},t.prototype.hasKey=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach((function(t,n){t.forEach((function(t){return e.add(n,t.clone())}))})),e},t.prototype.traverse=function(t){this._map.forEach((function(e,n){t(n,e)}))},t}();e.Lookup=i},7745:(t,e,n)=>{"use strict";e.GW=e.zY=e.f3=e.b2=e.W2=void 0,n(8465);var r=n(3357);Object.defineProperty(e,"W2",{enumerable:!0,get:function(){return r.Container}});n(4453),n(5427);var i=n(6047);Object.defineProperty(e,"b2",{enumerable:!0,get:function(){return i.injectable}});n(1277),n(5893);var o=n(5700);Object.defineProperty(e,"f3",{enumerable:!0,get:function(){return o.inject}});n(339),n(1637),n(49),n(5898);var a=n(2622);Object.defineProperty(e,"zY",{enumerable:!0,get:function(){return a.postConstruct}});n(4272),n(9022);var s=n(5976);Object.defineProperty(e,"GW",{enumerable:!0,get:function(){return s.decorate}});n(1565),n(1062),n(4362)},3802:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0;var r=n(9022),i=function(){function t(t){this.id=r.id(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();e.Context=i},4543:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var r=n(8465),i=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();e.Metadata=i},4272:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataReader=void 0;var r=n(8465),i=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,t),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Reflect.getMetadata(r.TAGGED_PROP,t)||[]},t}();e.MetadataReader=i},2402:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Plan=void 0;e.Plan=function(t,e){this.parentContext=t,this.rootRequest=e}},6144:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getBindingDictionary=e.createMockRequest=e.plan=void 0;var r=n(6925),i=n(4172),o=n(4453),a=n(8465),s=n(5017),u=n(1062),l=n(3802),c=n(4543),h=n(2402),p=n(4844),f=n(8506),d=n(804);function m(t){return t._bindingDictionary}function g(t,e,n,o,a){var s,l=v(n.container,a.serviceIdentifier);return l.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&t.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),l=v(n.container,a.serviceIdentifier)),s=e?l:l.filter((function(t){var e=new f.Request(t.serviceIdentifier,n,o,t,a);return t.constraint(e)})),function(t,e,n,o){switch(e.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return e;var a=u.getServiceIdentifierAsString(t),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,v),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return e;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return e;throw a=u.getServiceIdentifierAsString(t),s=i.AMBIGUOUS_MATCH+" "+a,s+=u.listRegisteredBindingsForServiceIdentifier(o,a,v),new Error(s)}}(a.serviceIdentifier,s,a,n.container),s}function y(t,e,n,r,a,s){var u,l;if(null===a){u=g(t,e,r,null,s),l=new f.Request(n,r,null,u,s);var c=new h.Plan(r,l);r.addPlan(c)}else u=g(t,e,r,a,s),l=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(e){var n=null;if(s.isArray())n=l.addChildRequest(e.serviceIdentifier,e,s);else{if(e.cache)return;n=l}if(e.type===o.BindingTypeEnum.Instance&&null!==e.implementationType){var a=p.getDependencies(t,e.implementationType);if(!r.container.options.skipBaseClassChecks){var u=p.getBaseClassDependencyCount(t,e.implementationType);if(a.length<u){var c=i.ARGUMENTS_LENGTH_MISMATCH(p.getFunctionName(e.implementationType));throw new Error(c)}}a.forEach((function(e){y(t,!1,e.serviceIdentifier,r,n,e)}))}}))}function v(t,e){var n=[],r=m(t);return r.hasKey(e)?n=r.get(e):null!==t.parent&&(n=v(t.parent,e)),n}e.getBindingDictionary=m,e.plan=function(t,e,n,r,i,o,h,p){void 0===p&&(p=!1);var f=new l.Context(e),m=function(t,e,n,r,i,o){var s=t?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new c.Metadata(s,n),l=new d.Target(e,"",n,u);if(void 0!==i){var h=new c.Metadata(i,o);l.metadata.push(h)}return l}(n,r,i,0,o,h);try{return y(t,p,i,f,null,m),f}catch(t){throw s.isStackOverflowExeption(t)&&f.plan&&u.circularDependencyToException(f.plan.rootRequest),t}},e.createMockRequest=function(t,e,n,r){var i=new d.Target(o.TargetTypeEnum.Variable,"",e,new c.Metadata(n,r)),a=new l.Context(t);return new f.Request(e,a,null,[],i)}},1195:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QueryableString=void 0;var n=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e,n=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();e.QueryableString=n},4844:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctionName=e.getBaseClassDependencyCount=e.getDependencies=void 0;var i=n(5700),o=n(4172),a=n(4453),s=n(8465),u=n(1062);Object.defineProperty(e,"getFunctionName",{enumerable:!0,get:function(){return u.getFunctionName}});var l=n(804);function c(t,e,n,i){var a=t.getConstructorMetadata(n),s=a.compilerGeneratedMetadata;if(void 0===s){var u=o.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(u)}var l=a.userGeneratedMetadata,c=Object.keys(l),f=0===n.length&&c.length>0,d=c.length>n.length,m=function(t,e,n,r,i){for(var o=[],a=0;a<i;a++){var s=h(a,t,e,n,r);null!==s&&o.push(s)}return o}(i,e,s,l,f||d?c.length:n.length),g=p(t,n);return r(r([],m),g)}function h(t,e,n,r,s){var u=s[t.toString()]||[],c=f(u),h=!0!==c.unmanaged,p=r[t];if((p=c.inject||c.multiInject||p)instanceof i.LazyServiceIdentifer&&(p=p.unwrap()),h){if(!e&&(p===Object||p===Function||void 0===p)){var d=o.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+n+".";throw new Error(d)}var m=new l.Target(a.TargetTypeEnum.ConstructorArgument,c.targetName,p);return m.metadata=u,m}return null}function p(t,e){for(var n=t.getPropertiesMetadata(e),i=[],o=0,s=Object.keys(n);o<s.length;o++){var u=s[o],c=n[u],h=f(n[u]),d=h.targetName||u,m=h.inject||h.multiInject,g=new l.Target(a.TargetTypeEnum.ClassProperty,d,m);g.metadata=c,i.push(g)}var y=Object.getPrototypeOf(e.prototype).constructor;if(y!==Object){var v=p(t,y);i=r(r([],i),v)}return i}function f(t){var e={};return t.forEach((function(t){e[t.key.toString()]=t.value})),{inject:e[s.INJECT_TAG],multiInject:e[s.MULTI_INJECT_TAG],targetName:e[s.NAME_TAG],unmanaged:e[s.UNMANAGED_TAG]}}e.getDependencies=function(t,e){return c(t,u.getFunctionName(e),e,!1)},e.getBaseClassDependencyCount=function t(e,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=c(e,u.getFunctionName(r),r,!0),o=i.map((function(t){return t.metadata.filter((function(t){return t.key===s.UNMANAGED_TAG}))})),a=[].concat.apply([],o).length,l=i.length-a;return l>0?l:t(e,r)}return 0}},8506:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Request=void 0;var r=n(9022),i=function(){function t(t,e,n,i,o){this.id=r.id(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,r){var i=new t(e,this.parentContext,this,n,r);return this.childRequests.push(i),i},t}();e.Request=i},804:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Target=void 0;var r=n(8465),i=n(9022),o=n(4543),a=n(1195),s=function(){function t(t,e,n,s){this.id=i.id(),this.type=t,this.serviceIdentifier=n,this.name=new a.QueryableString(e||""),this.metadata=new Array;var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return t.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++)if(n[e].key===t)return!0;return!1},t.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(r.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some((function(t){return r.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))}))},t.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(t){return t.key===r.NAMED_TAG}))[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(t){return r.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))})):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(r.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(n){for(var r=0,i=e.metadata;r<i.length;r++){var o=i[r];if(o.key===t&&o.value===n)return!0}return!1}},t}();e.Target=s},2682:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.resolveInstance=void 0;var i=n(4172),o=n(4453),a=n(8465);e.resolveInstance=function(t,e,n){var s,u,l=null;e.length>0?(u=e.filter((function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ConstructorArgument})).map(n),l=function(t,e,n){var r=e.filter((function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(e,n){var r;r=e.target.name.value();var o=i[n];t[r]=o})),t}(l=new((s=t).bind.apply(s,r([void 0],u))),e,n)):l=new t;return function(t,e){if(Reflect.hasMetadata(a.POST_CONSTRUCT,t)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,t);try{e[n.value]()}catch(e){throw new Error(i.POST_CONSTRUCT_ERROR(t.name,e.message))}}}(t,l),l}},4379:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolve=void 0;var r=n(4172),i=n(4453),o=n(5017),a=n(1062),s=n(2682),u=function(t,e,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString())):n}},l=function(t){return function(e){e.parentContext.setCurrentRequest(e);var n=e.bindings,o=e.childRequests,c=e.target&&e.target.isArray(),h=!(e.parentRequest&&e.parentRequest.target&&e.target&&e.parentRequest.target.matchesArray(e.target.serviceIdentifier));if(c&&h)return o.map((function(e){return l(t)(e)}));var p=null;if(!e.target.isOptional()||0!==n.length){var f=n[0],d=f.scope===i.BindingScopeEnum.Singleton,m=f.scope===i.BindingScopeEnum.Request;if(d&&f.activated)return f.cache;if(m&&null!==t&&t.has(f.id))return t.get(f.id);if(f.type===i.BindingTypeEnum.ConstantValue)p=f.cache,f.activated=!0;else if(f.type===i.BindingTypeEnum.Function)p=f.cache,f.activated=!0;else if(f.type===i.BindingTypeEnum.Constructor)p=f.implementationType;else if(f.type===i.BindingTypeEnum.DynamicValue&&null!==f.dynamicValue)p=u("toDynamicValue",f.serviceIdentifier,(function(){return f.dynamicValue(e.parentContext)}));else if(f.type===i.BindingTypeEnum.Factory&&null!==f.factory)p=u("toFactory",f.serviceIdentifier,(function(){return f.factory(e.parentContext)}));else if(f.type===i.BindingTypeEnum.Provider&&null!==f.provider)p=u("toProvider",f.serviceIdentifier,(function(){return f.provider(e.parentContext)}));else{if(f.type!==i.BindingTypeEnum.Instance||null===f.implementationType){var g=a.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+g)}p=s.resolveInstance(f.implementationType,o,l(t))}return"function"==typeof f.onActivation&&(p=f.onActivation(e.parentContext,p)),d&&(f.cache=p,f.activated=!0),m&&null!==t&&!t.has(f.id)&&t.set(f.id,p),p}}};e.resolve=function(t){return l(t.plan.rootRequest.requestScope)(t.plan.rootRequest)}},1180:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInSyntax=void 0;var r=n(4453),i=n(1843),o=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},t}();e.BindingInSyntax=o},6308:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInWhenOnSyntax=void 0;var r=n(1180),i=n(4079),o=n(6775),a=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingInWhenOnSyntax=a},4079:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingOnSyntax=void 0;var r=n(6775),i=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new r.BindingWhenSyntax(this._binding)},t}();e.BindingOnSyntax=i},9774:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingToSyntax=void 0;var r=n(4172),i=n(4453),o=n(6308),a=n(1843),s=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=t,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!=typeof t)throw new Error(r.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,e},t.prototype.toAutoFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue((function(e){return e.container.get(t)}))},t}();e.BindingToSyntax=s},1843:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenOnSyntax=void 0;var r=n(4079),i=n(6775),o=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingWhenOnSyntax=o},6775:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenSyntax=void 0;var r=n(4079),i=n(1565),o=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=i.namedConstraint(t),new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=i.taggedConstraint(t)(e),new r.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return i.typeConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return i.namedConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){return i.taggedConstraint(t)(e)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t}();e.BindingWhenSyntax=o},1565:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.typeConstraint=e.namedConstraint=e.taggedConstraint=e.traverseAncerstors=void 0;var r=n(8465),i=n(4543),o=function(t,e){var n=t.parentRequest;return null!==n&&(!!e(n)||o(n,e))};e.traverseAncerstors=o;var a=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new i.Metadata(t,e),n}};e.taggedConstraint=a;var s=a(r.NAMED_TAG);e.namedConstraint=s,e.typeConstraint=function(t){return function(e){var n=null;if(null!==e){if(n=e.bindings[0],"string"==typeof t)return n.serviceIdentifier===t;var r=e.bindings[0].implementationType;return t===r}return!1}}},4362:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=void 0,e.multiBindToService=function(t){return function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return t.bind(n).toService(e)}))}}}},5017:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isStackOverflowExeption=void 0;var r=n(4172);e.isStackOverflowExeption=function(t){return t instanceof RangeError||t.message===r.STACK_OVERFLOW}},9022:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.id=void 0;var n=0;e.id=function(){return n++}},1062:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.circularDependencyToException=e.listMetadataForTarget=e.listRegisteredBindingsForServiceIdentifier=e.getServiceIdentifierAsString=e.getFunctionName=void 0;var r=n(4172);function i(t){return"function"==typeof t?t.name:"symbol"==typeof t?t.toString():t}function o(t,e){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===e||o(t.parentRequest,e))}function a(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}e.getServiceIdentifierAsString=i,e.listRegisteredBindingsForServiceIdentifier=function(t,e,n){var r="",i=n(t,e);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(t){var e="Object";null!==t.implementationType&&(e=a(t.implementationType)),r=r+"\n "+e,t.constraint.metaData&&(r=r+" - "+t.constraint.metaData)}))),r},e.circularDependencyToException=function t(e){e.childRequests.forEach((function(e){if(o(e,e.serviceIdentifier)){var n=function(t){return function t(e,n){void 0===n&&(n=[]);var r=i(e.serviceIdentifier);return n.push(r),null!==e.parentRequest?t(e.parentRequest,n):n}(t).reverse().join(" --\x3e ")}(e);throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}t(e)}))},e.listMetadataForTarget=function(t,e){if(e.isTagged()||e.isNamed()){var n="",r=e.getNamedTag(),i=e.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(t){n+=t.toString()+"\n"}))," "+t+"\n "+t+" - "+n}return" "+t},e.getFunctionName=a},9462:(t,e,n)=>{"use strict";var r=n(3342)(),i=n(2864)("Object.prototype.toString"),o=function(t){return!(r&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===i(t)},a=function(t){return!!o(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==i(t)&&"[object Function]"===i(t.callee)},s=function(){return o(arguments)}();o.isLegacyArguments=a,t.exports=s?o:a},3846:(t,e,n)=>{"use strict";var r=Date.prototype.getDay,i=Object.prototype.toString,o=n(3342)();t.exports=function(t){return"object"==typeof t&&null!==t&&(o?function(t){try{return r.call(t),!0}catch(t){return!1}}(t):"[object Date]"===i.call(t))}},9360:(t,e,n)=>{"use strict";var r,i,o,a,s=n(2864),u=n(3342)();if(u){r=s("Object.prototype.hasOwnProperty"),i=s("RegExp.prototype.exec"),o={};var l=function(){throw o};a={toString:l,valueOf:l},"symbol"==typeof Symbol.toPrimitive&&(a[Symbol.toPrimitive]=l)}var c=s("Object.prototype.toString"),h=Object.getOwnPropertyDescriptor;t.exports=u?function(t){if(!t||"object"!=typeof t)return!1;var e=h(t,"lastIndex");if(!e||!r(e,"value"))return!1;try{i(t,a)}catch(t){return t===o}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===c(t)}},8298:t=>{"use strict";t.exports=n,t.exports.default=n;var e=1e20;function n(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer,u="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;u?this.canvas=my.createOffscreenCanvas(a,a,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=u?Math.round(a/2*1):Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function r(t,e,n,r,o,a){for(var s=0;s<e;s++)i(t,s,e,n,r,o,a);for(var u=0;u<n;u++)i(t,u*e,1,e,r,o,a)}function i(t,n,r,i,o,a,s){var u,l,c,h;for(a[0]=0,s[0]=-e,s[1]=e,u=0;u<i;u++)o[u]=t[n+u*r];for(u=1,l=0,c=0;u<i;u++){do{h=a[l],c=(o[u]-o[h]+u*u-h*h)/(u-h)/2}while(c<=s[l]&&--l>-1);a[++l]=u,s[l]=c,s[l+1]=e}for(u=0,l=0;u<i;u++){for(;s[l+1]<u;)l++;h=a[l],t[n+u*r]=o[h]+(u-h)*(u-h)}}n.prototype._draw=function(t,n){var i,o,a,s,u,l,c,h,p,f=this.ctx.measureText(t),d=f.width,m=2*this.buffer;n&&this.useMetrics?(u=Math.floor(f.actualBoundingBoxAscent),h=this.buffer+Math.ceil(f.actualBoundingBoxAscent),l=this.buffer,c=this.buffer,i=(o=Math.min(this.size,Math.ceil(f.actualBoundingBoxRight-f.actualBoundingBoxLeft)))+m,a=(s=Math.min(this.size-l,Math.ceil(f.actualBoundingBoxAscent+f.actualBoundingBoxDescent)))+m,this.ctx.textBaseline="alphabetic"):(i=o=this.size,a=s=this.size,u=19*this.fontSize/24,l=c=0,h=this.middle,this.ctx.textBaseline="middle"),o&&s&&(this.ctx.clearRect(c,l,o,s),this.ctx.fillText(t,this.buffer,h),p=this.ctx.getImageData(c,l,o,s));var g=new Uint8ClampedArray(i*a);return function(t,n,r,i,o,a,s){a.fill(e,0,n*r),s.fill(0,0,n*r);for(var u=(n-i)/2,l=0;l<o;l++)for(var c=0;c<i;c++){var h=(l+u)*n+c+u,p=t.data[4*(l*i+c)+3]/255;if(1===p)a[h]=0,s[h]=e;else if(0===p)a[h]=e,s[h]=0;else{var f=Math.max(0,.5-p),d=Math.max(0,p-.5);a[h]=f*f,s[h]=d*d}}}(p,i,a,o,s,this.gridOuter,this.gridInner),r(this.gridOuter,i,a,this.f,this.v,this.z),r(this.gridInner,i,a,this.f,this.v,this.z),function(t,e,n,r,i,o,a){for(var s=0;s<e*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);t[s]=Math.round(255-255*(u/o+a))}}(g,i,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:g,metrics:{width:o,height:s,sdfWidth:i,sdfHeight:a,top:u,left:0,advance:d}}},n.prototype.draw=function(t){return this._draw(t,!1).data},n.prototype.drawWithMetrics=function(t){return this._draw(t,!0)}},9946:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Function:()=>Se,Interpreter:()=>ge,default:()=>Ee,evaluate:()=>we,vm:()=>r});var r={};n.r(r),n.d(r,{Script:()=>be,compileFunction:()=>ve,createContext:()=>ye,runInContext:()=>_e,runInNewContext:()=>xe});var i={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},o="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",a={5:o,"5module":o+" export import",6:o+" const class extends export import super"},s=/^in(stanceof)?$/,u="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࣇऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-鿼ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-ꟊꟵ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",l="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿᫀᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",c=new RegExp("["+u+"]"),h=new RegExp("["+u+l+"]");u=l=null;var p=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],f=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function d(t,e){for(var n=65536,r=0;r<e.length;r+=2){if((n+=e[r])>t)return!1;if((n+=e[r+1])>=t)return!0}}function m(t,e){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&c.test(String.fromCharCode(t)):!1!==e&&d(t,p)))}function g(t,e){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&h.test(String.fromCharCode(t)):!1!==e&&(d(t,p)||d(t,f)))))}var y=function(t,e){void 0===e&&(e={}),this.label=t,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null};function v(t,e){return new y(t,{beforeExpr:!0,binop:e})}var _={beforeExpr:!0},x={startsExpr:!0},b={};function w(t,e){return void 0===e&&(e={}),e.keyword=t,b[t]=new y(t,e)}var S={num:new y("num",x),regexp:new y("regexp",x),string:new y("string",x),name:new y("name",x),eof:new y("eof"),bracketL:new y("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new y("]"),braceL:new y("{",{beforeExpr:!0,startsExpr:!0}),braceR:new y("}"),parenL:new y("(",{beforeExpr:!0,startsExpr:!0}),parenR:new y(")"),comma:new y(",",_),semi:new y(";",_),colon:new y(":",_),dot:new y("."),question:new y("?",_),questionDot:new y("?."),arrow:new y("=>",_),template:new y("template"),invalidTemplate:new y("invalidTemplate"),ellipsis:new y("...",_),backQuote:new y("`",x),dollarBraceL:new y("${",{beforeExpr:!0,startsExpr:!0}),eq:new y("=",{beforeExpr:!0,isAssign:!0}),assign:new y("_=",{beforeExpr:!0,isAssign:!0}),incDec:new y("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new y("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:v("||",1),logicalAND:v("&&",2),bitwiseOR:v("|",3),bitwiseXOR:v("^",4),bitwiseAND:v("&",5),equality:v("==/!=/===/!==",6),relational:v("</>/<=/>=",7),bitShift:v("<</>>/>>>",8),plusMin:new y("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:v("%",10),star:v("*",10),slash:v("/",10),starstar:new y("**",{beforeExpr:!0}),coalesce:v("??",1),_break:w("break"),_case:w("case",_),_catch:w("catch"),_continue:w("continue"),_debugger:w("debugger"),_default:w("default",_),_do:w("do",{isLoop:!0,beforeExpr:!0}),_else:w("else",_),_finally:w("finally"),_for:w("for",{isLoop:!0}),_function:w("function",x),_if:w("if"),_return:w("return",_),_switch:w("switch"),_throw:w("throw",_),_try:w("try"),_var:w("var"),_const:w("const"),_while:w("while",{isLoop:!0}),_with:w("with"),_new:w("new",{beforeExpr:!0,startsExpr:!0}),_this:w("this",x),_super:w("super",x),_class:w("class",x),_extends:w("extends",_),_export:w("export"),_import:w("import",x),_null:w("null",x),_true:w("true",x),_false:w("false",x),_in:w("in",{beforeExpr:!0,binop:7}),_instanceof:w("instanceof",{beforeExpr:!0,binop:7}),_typeof:w("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:w("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:w("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},E=/\r\n?|\n|\u2028|\u2029/,C=new RegExp(E.source,"g");function M(t,e){return 10===t||13===t||!e&&(8232===t||8233===t)}var T=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,A=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,P=Object.prototype,L=P.hasOwnProperty,I=P.toString;function k(t,e){return L.call(t,e)}var O=Array.isArray||function(t){return"[object Array]"===I.call(t)};function R(t){return new RegExp("^(?:"+t.replace(/ /g,"|")+")$")}var D=function(t,e){this.line=t,this.column=e};D.prototype.offset=function(t){return new D(this.line,this.column+t)};var N=function(t,e,n){this.start=e,this.end=n,null!==t.sourceFile&&(this.source=t.sourceFile)};function F(t,e){for(var n=1,r=0;;){C.lastIndex=r;var i=C.exec(t);if(!(i&&i.index<e))return new D(n,e-r);++n,r=i.index+i[0].length}}var z={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function B(t,e){return 2|(t?4:0)|(e?8:0)}var j=function(t,e,n){this.options=t=function(t){var e={};for(var n in z)e[n]=t&&k(t,n)?t[n]:z[n];if(e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),null==e.allowReserved&&(e.allowReserved=e.ecmaVersion<5),O(e.onToken)){var r=e.onToken;e.onToken=function(t){return r.push(t)}}return O(e.onComment)&&(e.onComment=function(t,e){return function(n,r,i,o,a,s){var u={type:n?"Block":"Line",value:r,start:i,end:o};t.locations&&(u.loc=new N(this,a,s)),t.ranges&&(u.range=[i,o]),e.push(u)}}(e,e.onComment)),e}(t),this.sourceFile=t.sourceFile,this.keywords=R(a[t.ecmaVersion>=6?6:"module"===t.sourceType?"5module":5]);var r="";if(!0!==t.allowReserved){for(var o=t.ecmaVersion;!(r=i[o]);o--);"module"===t.sourceType&&(r+=" await")}this.reservedWords=R(r);var s=(r?r+" ":"")+i.strict;this.reservedWordsStrict=R(s),this.reservedWordsStrictBind=R(s+" "+i.strictBind),this.input=String(e),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(E).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=S.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===t.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&t.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},U={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};j.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)},U.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},U.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},U.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},U.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},U.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},U.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},j.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},j.extend=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var n=this,r=0;r<t.length;r++)n=t[r](n);return n},j.parse=function(t,e){return new this(e,t).parse()},j.parseExpressionAt=function(t,e,n){var r=new this(n,t,e);return r.nextToken(),r.parseExpression()},j.tokenizer=function(t,e){return new this(e,t)},Object.defineProperties(j.prototype,U);var Z=j.prototype,V=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function G(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Z.strictDirective=function(t){for(;;){A.lastIndex=t,t+=A.exec(this.input)[0].length;var e=V.exec(this.input.slice(t));if(!e)return!1;if("use strict"===(e[1]||e[2])){A.lastIndex=t+e[0].length;var n=A.exec(this.input),r=n.index+n[0].length,i=this.input.charAt(r);return";"===i||"}"===i||E.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(r+1))}t+=e[0].length,A.lastIndex=t,t+=A.exec(this.input)[0].length,";"===this.input[t]&&t++}},Z.eat=function(t){return this.type===t&&(this.next(),!0)},Z.isContextual=function(t){return this.type===S.name&&this.value===t&&!this.containsEsc},Z.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},Z.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},Z.canInsertSemicolon=function(){return this.type===S.eof||this.type===S.braceR||E.test(this.input.slice(this.lastTokEnd,this.start))},Z.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Z.semicolon=function(){this.eat(S.semi)||this.insertSemicolon()||this.unexpected()},Z.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0},Z.expect=function(t){this.eat(t)||this.unexpected()},Z.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")},Z.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var n=e?t.parenthesizedAssign:t.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},Z.checkExpressionErrors=function(t,e){if(!t)return!1;var n=t.shorthandAssign,r=t.doubleProto;if(!e)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},Z.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Z.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var H=j.prototype;H.parseTopLevel=function(t){var e={};for(t.body||(t.body=[]);this.type!==S.eof;){var n=this.parseStatement(null,!0,e);t.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var o=i[r];this.raiseRecoverable(this.undefinedExports[o].start,"Export '"+o+"' is not defined")}return this.adaptDirectivePrologue(t.body),this.next(),t.sourceType=this.options.sourceType,this.finishNode(t,"Program")};var W={kind:"loop"},q={kind:"switch"};H.isLet=function(t){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;A.lastIndex=this.pos;var e=A.exec(this.input),n=this.pos+e[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(t)return!1;if(123===r)return!0;if(m(r,!0)){for(var i=n+1;g(this.input.charCodeAt(i),!0);)++i;var o=this.input.slice(n,i);if(!s.test(o))return!0}return!1},H.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;A.lastIndex=this.pos;var t=A.exec(this.input),e=this.pos+t[0].length;return!(E.test(this.input.slice(this.pos,e))||"function"!==this.input.slice(e,e+8)||e+8!==this.input.length&&g(this.input.charAt(e+8)))},H.parseStatement=function(t,e,n){var r,i=this.type,o=this.startNode();switch(this.isLet(t)&&(i=S._var,r="let"),i){case S._break:case S._continue:return this.parseBreakContinueStatement(o,i.keyword);case S._debugger:return this.parseDebuggerStatement(o);case S._do:return this.parseDoStatement(o);case S._for:return this.parseForStatement(o);case S._function:return t&&(this.strict||"if"!==t&&"label"!==t)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1,!t);case S._class:return t&&this.unexpected(),this.parseClass(o,!0);case S._if:return this.parseIfStatement(o);case S._return:return this.parseReturnStatement(o);case S._switch:return this.parseSwitchStatement(o);case S._throw:return this.parseThrowStatement(o);case S._try:return this.parseTryStatement(o);case S._const:case S._var:return r=r||this.value,t&&"var"!==r&&this.unexpected(),this.parseVarStatement(o,r);case S._while:return this.parseWhileStatement(o);case S._with:return this.parseWithStatement(o);case S.braceL:return this.parseBlock(!0,o);case S.semi:return this.parseEmptyStatement(o);case S._export:case S._import:if(this.options.ecmaVersion>10&&i===S._import){A.lastIndex=this.pos;var a=A.exec(this.input),s=this.pos+a[0].length,u=this.input.charCodeAt(s);if(40===u||46===u)return this.parseExpressionStatement(o,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===S._import?this.parseImport(o):this.parseExport(o,n);default:if(this.isAsyncFunction())return t&&this.unexpected(),this.next(),this.parseFunctionStatement(o,!0,!t);var l=this.value,c=this.parseExpression();return i===S.name&&"Identifier"===c.type&&this.eat(S.colon)?this.parseLabeledStatement(o,l,c,t):this.parseExpressionStatement(o,c)}},H.parseBreakContinueStatement=function(t,e){var n="break"===e;this.next(),this.eat(S.semi)||this.insertSemicolon()?t.label=null:this.type!==S.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==t.label||i.name===t.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(t.label&&n)break}}return r===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,n?"BreakStatement":"ContinueStatement")},H.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},H.parseDoStatement=function(t){return this.next(),this.labels.push(W),t.body=this.parseStatement("do"),this.labels.pop(),this.expect(S._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(S.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},H.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(W),this.enterScope(0),this.expect(S.parenL),this.type===S.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var n=this.isLet();if(this.type===S._var||this.type===S._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===S._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,r)):(e>-1&&this.unexpected(e),this.parseFor(t,r))}var o=new G,a=this.parseExpression(!0,o);return this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===S._in?e>-1&&this.unexpected(e):t.await=e>-1),this.toAssignable(a,!1,o),this.checkLVal(a),this.parseForIn(t,a)):(this.checkExpressionErrors(o,!0),e>-1&&this.unexpected(e),this.parseFor(t,a))},H.parseFunctionStatement=function(t,e,n){return this.next(),this.parseFunction(t,Y|(n?0:K),!1,e)},H.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement("if"),t.alternate=this.eat(S._else)?this.parseStatement("if"):null,this.finishNode(t,"IfStatement")},H.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(S.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},H.parseSwitchStatement=function(t){var e;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(S.braceL),this.labels.push(q),this.enterScope(0);for(var n=!1;this.type!==S.braceR;)if(this.type===S._case||this.type===S._default){var r=this.type===S._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),r?e.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,e.test=null),this.expect(S.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},H.parseThrowStatement=function(t){return this.next(),E.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var X=[];H.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===S._catch){var e=this.startNode();if(this.next(),this.eat(S.parenL)){e.param=this.parseBindingAtom();var n="Identifier"===e.param.type;this.enterScope(n?32:0),this.checkLVal(e.param,n?4:2),this.expect(S.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0);e.body=this.parseBlock(!1),this.exitScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(S._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},H.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},H.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(W),t.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(t,"WhileStatement")},H.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement("with"),this.finishNode(t,"WithStatement")},H.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},H.parseLabeledStatement=function(t,e,n,r){for(var i=0,o=this.labels;i<o.length;i+=1)o[i].name===e&&this.raise(n.start,"Label '"+e+"' is already declared");for(var a=this.type.isLoop?"loop":this.type===S._switch?"switch":null,s=this.labels.length-1;s>=0;s--){var u=this.labels[s];if(u.statementStart!==t.start)break;u.statementStart=this.start,u.kind=a}return this.labels.push({name:e,kind:a,statementStart:this.start}),t.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),t.label=n,this.finishNode(t,"LabeledStatement")},H.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},H.parseBlock=function(t,e,n){for(void 0===t&&(t=!0),void 0===e&&(e=this.startNode()),e.body=[],this.expect(S.braceL),t&&this.enterScope(0);this.type!==S.braceR;){var r=this.parseStatement(null);e.body.push(r)}return n&&(this.strict=!1),this.next(),t&&this.exitScope(),this.finishNode(e,"BlockStatement")},H.parseFor=function(t,e){return t.init=e,this.expect(S.semi),t.test=this.type===S.semi?null:this.parseExpression(),this.expect(S.semi),t.update=this.type===S.parenR?null:this.parseExpression(),this.expect(S.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,"ForStatement")},H.parseForIn=function(t,e){var n=this.type===S._in;return this.next(),"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==e.kind||"Identifier"!==e.declarations[0].id.type)?this.raise(e.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===e.type&&this.raise(e.start,"Invalid left-hand side in for-loop"),t.left=e,t.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(S.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,n?"ForInStatement":"ForOfStatement")},H.parseVar=function(t,e,n){for(t.declarations=[],t.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(S.eq)?r.init=this.parseMaybeAssign(e):"const"!==n||this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||e&&(this.type===S._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(S.comma))break}return t},H.parseVarId=function(t,e){t.id=this.parseBindingAtom(),this.checkLVal(t.id,"var"===e?1:2,!1)};var Y=1,K=2;H.parseFunction=function(t,e,n,r){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===S.star&&e&K&&this.unexpected(),t.generator=this.eat(S.star)),this.options.ecmaVersion>=8&&(t.async=!!r),e&Y&&(t.id=4&e&&this.type!==S.name?null:this.parseIdent(),!t.id||e&K||this.checkLVal(t.id,this.strict||t.generator||t.async?this.treatFunctionsAsVar?1:2:3));var i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(B(t.async,t.generator)),e&Y||(t.id=this.type===S.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,n,!1),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(t,e&Y?"FunctionDeclaration":"FunctionExpression")},H.parseFunctionParams=function(t){this.expect(S.parenL),t.params=this.parseBindingList(S.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},H.parseClass=function(t,e){this.next();var n=this.strict;this.strict=!0,this.parseClassId(t,e),this.parseClassSuper(t);var r=this.startNode(),i=!1;for(r.body=[],this.expect(S.braceL);this.type!==S.braceR;){var o=this.parseClassElement(null!==t.superClass);o&&(r.body.push(o),"MethodDefinition"===o.type&&"constructor"===o.kind&&(i&&this.raise(o.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=n,this.next(),t.body=this.finishNode(r,"ClassBody"),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},H.parseClassElement=function(t){var e=this;if(this.eat(S.semi))return null;var n=this.startNode(),r=function(t,r){void 0===r&&(r=!1);var i=e.start,o=e.startLoc;return!(!e.eatContextual(t)||(e.type===S.parenL||r&&e.canInsertSemicolon())&&(n.key&&e.unexpected(),n.computed=!1,n.key=e.startNodeAt(i,o),n.key.name=t,e.finishNode(n.key,"Identifier"),1))};n.kind="method",n.static=r("static");var i=this.eat(S.star),o=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(o=!0,i=this.options.ecmaVersion>=9&&this.eat(S.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key,s=!1;return n.computed||n.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),o&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor",s=t),this.parseClassMethod(n,i,o,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},H.parseClassMethod=function(t,e,n,r){return t.value=this.parseMethod(e,n,r),this.finishNode(t,"MethodDefinition")},H.parseClassId=function(t,e){this.type===S.name?(t.id=this.parseIdent(),e&&this.checkLVal(t.id,2,!1)):(!0===e&&this.unexpected(),t.id=null)},H.parseClassSuper=function(t){t.superClass=this.eat(S._extends)?this.parseExprSubscripts():null},H.parseExport=function(t,e){if(this.next(),this.eat(S.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(t.exported=this.parseIdent(!0),this.checkExport(e,t.exported.name,this.lastTokStart)):t.exported=null),this.expectContextual("from"),this.type!==S.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(S._default)){var n;if(this.checkExport(e,"default",this.lastTokStart),this.type===S._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),t.declaration=this.parseFunction(r,4|Y,!1,n)}else if(this.type===S._class){var i=this.startNode();t.declaration=this.parseClass(i,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(null),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id.name,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==S.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var o=0,a=t.specifiers;o<a.length;o+=1){var s=a[o];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},H.checkExport=function(t,e,n){t&&(k(t,e)&&this.raiseRecoverable(n,"Duplicate export '"+e+"'"),t[e]=!0)},H.checkPatternExport=function(t,e){var n=e.type;if("Identifier"===n)this.checkExport(t,e.name,e.start);else if("ObjectPattern"===n)for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.checkPatternExport(t,o)}else if("ArrayPattern"===n)for(var a=0,s=e.elements;a<s.length;a+=1){var u=s[a];u&&this.checkPatternExport(t,u)}else"Property"===n?this.checkPatternExport(t,e.value):"AssignmentPattern"===n?this.checkPatternExport(t,e.left):"RestElement"===n?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(t,e.expression)},H.checkVariableExport=function(t,e){if(t)for(var n=0,r=e;n<r.length;n+=1){var i=r[n];this.checkPatternExport(t,i.id)}},H.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},H.parseExportSpecifiers=function(t){var e=[],n=!0;for(this.expect(S.braceL);!this.eat(S.braceR);){if(n)n=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(t,r.exported.name,r.exported.start),e.push(this.finishNode(r,"ExportSpecifier"))}return e},H.parseImport=function(t){return this.next(),this.type===S.string?(t.specifiers=X,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===S.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},H.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===S.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,2),t.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(S.comma))return t}if(this.type===S.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,2),t.push(this.finishNode(r,"ImportNamespaceSpecifier")),t}for(this.expect(S.braceL);!this.eat(S.braceR);){if(e)e=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,2),t.push(this.finishNode(i,"ImportSpecifier"))}return t},H.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},H.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var Q=j.prototype;Q.toAssignable=function(t,e,n){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.toAssignable(o,e),"RestElement"!==o.type||"ArrayPattern"!==o.argument.type&&"ObjectPattern"!==o.argument.type||this.raise(o.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(t.expression,e,n);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return t},Q.toAssignableList=function(t,e){for(var n=t.length,r=0;r<n;r++){var i=t[r];i&&this.toAssignable(i,e)}if(n){var o=t[n-1];6===this.options.ecmaVersion&&e&&o&&"RestElement"===o.type&&"Identifier"!==o.argument.type&&this.unexpected(o.argument.start)}return t},Q.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")},Q.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==S.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},Q.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case S.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(S.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case S.braceL:return this.parseObj(!0)}return this.parseIdent()},Q.parseBindingList=function(t,e,n){for(var r=[],i=!0;!this.eat(t);)if(i?i=!1:this.expect(S.comma),e&&this.type===S.comma)r.push(null);else{if(n&&this.afterTrailingComma(t))break;if(this.type===S.ellipsis){var o=this.parseRestBinding();this.parseBindingListItem(o),r.push(o),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),r.push(a)}return r},Q.parseBindingListItem=function(t){return t},Q.parseMaybeDefault=function(t,e,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(S.eq))return n;var r=this.startNodeAt(t,e);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},Q.checkLVal=function(t,e,n){switch(void 0===e&&(e=0),t.type){case"Identifier":2===e&&"let"===t.name&&this.raiseRecoverable(t.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(e?"Binding ":"Assigning to ")+t.name+" in strict mode"),n&&(k(n,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),n[t.name]=!0),0!==e&&5!==e&&this.declareName(t.name,e,t.start);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":e&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.checkLVal(o,e,n)}break;case"Property":this.checkLVal(t.value,e,n);break;case"ArrayPattern":for(var a=0,s=t.elements;a<s.length;a+=1){var u=s[a];u&&this.checkLVal(u,e,n)}break;case"AssignmentPattern":this.checkLVal(t.left,e,n);break;case"RestElement":this.checkLVal(t.argument,e,n);break;case"ParenthesizedExpression":this.checkLVal(t.expression,e,n);break;default:this.raise(t.start,(e?"Binding":"Assigning to")+" rvalue")}};var J=j.prototype;J.checkPropClash=function(t,e,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type||this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var r,i=t.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var o=t.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===o&&(e.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),e.proto=!0);else{var a=e[r="$"+r];a?("init"===o?this.strict&&a.init||a.get||a.set:a.init||a[o])&&this.raiseRecoverable(i.start,"Redefinition of property"):a=e[r]={init:!1,get:!1,set:!1},a[o]=!0}}},J.parseExpression=function(t,e){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(t,e);if(this.type===S.comma){var o=this.startNodeAt(n,r);for(o.expressions=[i];this.eat(S.comma);)o.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(o,"SequenceExpression")}return i},J.parseMaybeAssign=function(t,e,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(t);this.exprAllowed=!1}var r=!1,i=-1,o=-1;e?(i=e.parenthesizedAssign,o=e.trailingComma,e.parenthesizedAssign=e.trailingComma=-1):(e=new G,r=!0);var a=this.start,s=this.startLoc;this.type!==S.parenL&&this.type!==S.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(t,e);if(n&&(u=n.call(this,u,a,s)),this.type.isAssign){var l=this.startNodeAt(a,s);return l.operator=this.value,l.left=this.type===S.eq?this.toAssignable(u,!1,e):u,r||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=l.left.start&&(e.shorthandAssign=-1),this.checkLVal(u),this.next(),l.right=this.parseMaybeAssign(t),this.finishNode(l,"AssignmentExpression")}return r&&this.checkExpressionErrors(e,!0),i>-1&&(e.parenthesizedAssign=i),o>-1&&(e.trailingComma=o),u},J.parseMaybeConditional=function(t,e){var n=this.start,r=this.startLoc,i=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return i;if(this.eat(S.question)){var o=this.startNodeAt(n,r);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(S.colon),o.alternate=this.parseMaybeAssign(t),this.finishNode(o,"ConditionalExpression")}return i},J.parseExprOps=function(t,e){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(e,!1);return this.checkExpressionErrors(e)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,t)},J.parseExprOp=function(t,e,n,r,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==S._in)&&o>r){var a=this.type===S.logicalOR||this.type===S.logicalAND,s=this.type===S.coalesce;s&&(o=S.logicalAND.binop);var u=this.value;this.next();var l=this.start,c=this.startLoc,h=this.parseExprOp(this.parseMaybeUnary(null,!1),l,c,o,i),p=this.buildBinary(e,n,t,h,u,a||s);return(a&&this.type===S.coalesce||s&&(this.type===S.logicalOR||this.type===S.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(p,e,n,r,i)}return t},J.buildBinary=function(t,e,n,r,i,o){var a=this.startNodeAt(t,e);return a.left=n,a.operator=i,a.right=r,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")},J.parseMaybeUnary=function(t,e){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),e=!0;else if(this.type.prefix){var o=this.startNode(),a=this.type===S.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(t,!0),a?this.checkLVal(o.argument):this.strict&&"delete"===o.operator&&"Identifier"===o.argument.type?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):e=!0,n=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(t),this.checkExpressionErrors(t))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var s=this.startNodeAt(r,i);s.operator=this.value,s.prefix=!1,s.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(s,"UpdateExpression")}}return!e&&this.eat(S.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},J.parseExprSubscripts=function(t){var e=this.start,n=this.startLoc,r=this.parseExprAtom(t);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,e,n);return t&&"MemberExpression"===i.type&&(t.parenthesizedAssign>=i.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=i.start&&(t.parenthesizedBind=-1)),i},J.parseSubscripts=function(t,e,n,r){for(var i=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&t.end-t.start==5&&this.potentialArrowAt===t.start,o=!1;;){var a=this.parseSubscript(t,e,n,r,i,o);if(a.optional&&(o=!0),a===t||"ArrowFunctionExpression"===a.type){if(o){var s=this.startNodeAt(e,n);s.expression=a,a=this.finishNode(s,"ChainExpression")}return a}t=a}},J.parseSubscript=function(t,e,n,r,i,o){var a=this.options.ecmaVersion>=11,s=a&&this.eat(S.questionDot);r&&s&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(S.bracketL);if(u||s&&this.type!==S.parenL&&this.type!==S.backQuote||this.eat(S.dot)){var l=this.startNodeAt(e,n);l.object=t,l.property=u?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),l.computed=!!u,u&&this.expect(S.bracketR),a&&(l.optional=s),t=this.finishNode(l,"MemberExpression")}else if(!r&&this.eat(S.parenL)){var c=new G,h=this.yieldPos,p=this.awaitPos,f=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var d=this.parseExprList(S.parenR,this.options.ecmaVersion>=8,!1,c);if(i&&!s&&!this.canInsertSemicolon()&&this.eat(S.arrow))return this.checkPatternErrors(c,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=h,this.awaitPos=p,this.awaitIdentPos=f,this.parseArrowExpression(this.startNodeAt(e,n),d,!0);this.checkExpressionErrors(c,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=p||this.awaitPos,this.awaitIdentPos=f||this.awaitIdentPos;var m=this.startNodeAt(e,n);m.callee=t,m.arguments=d,a&&(m.optional=s),t=this.finishNode(m,"CallExpression")}else if(this.type===S.backQuote){(s||o)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var g=this.startNodeAt(e,n);g.tag=t,g.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(g,"TaggedTemplateExpression")}return t},J.parseExprAtom=function(t){this.type===S.slash&&this.readRegexp();var e,n=this.potentialArrowAt===this.start;switch(this.type){case S._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),e=this.startNode(),this.next(),this.type!==S.parenL||this.allowDirectSuper||this.raise(e.start,"super() call outside constructor of a subclass"),this.type!==S.dot&&this.type!==S.bracketL&&this.type!==S.parenL&&this.unexpected(),this.finishNode(e,"Super");case S._this:return e=this.startNode(),this.next(),this.finishNode(e,"ThisExpression");case S.name:var r=this.start,i=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(S._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(S.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===S.name&&!o)return a=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(S.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[a],!0)}return a;case S.regexp:var s=this.value;return(e=this.parseLiteral(s.value)).regex={pattern:s.pattern,flags:s.flags},e;case S.num:case S.string:return this.parseLiteral(this.value);case S._null:case S._true:case S._false:return(e=this.startNode()).value=this.type===S._null?null:this.type===S._true,e.raw=this.type.keyword,this.next(),this.finishNode(e,"Literal");case S.parenL:var u=this.start,l=this.parseParenAndDistinguishExpression(n);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(l)&&(t.parenthesizedAssign=u),t.parenthesizedBind<0&&(t.parenthesizedBind=u)),l;case S.bracketL:return e=this.startNode(),this.next(),e.elements=this.parseExprList(S.bracketR,!0,!0,t),this.finishNode(e,"ArrayExpression");case S.braceL:return this.parseObj(!1,t);case S._function:return e=this.startNode(),this.next(),this.parseFunction(e,0);case S._class:return this.parseClass(this.startNode(),!1);case S._new:return this.parseNew();case S.backQuote:return this.parseTemplate();case S._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},J.parseExprImport=function(){var t=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var e=this.parseIdent(!0);switch(this.type){case S.parenL:return this.parseDynamicImport(t);case S.dot:return t.meta=e,this.parseImportMeta(t);default:this.unexpected()}},J.parseDynamicImport=function(t){if(this.next(),t.source=this.parseMaybeAssign(),!this.eat(S.parenR)){var e=this.start;this.eat(S.comma)&&this.eat(S.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(t,"ImportExpression")},J.parseImportMeta=function(t){this.next();var e=this.containsEsc;return t.property=this.parseIdent(!0),"meta"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(t.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(t.start,"Cannot use 'import.meta' outside a module"),this.finishNode(t,"MetaProperty")},J.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),110===e.raw.charCodeAt(e.raw.length-1)&&(e.bigint=e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")},J.parseParenExpression=function(){this.expect(S.parenL);var t=this.parseExpression();return this.expect(S.parenR),t},J.parseParenAndDistinguishExpression=function(t){var e,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o,a=this.start,s=this.startLoc,u=[],l=!0,c=!1,h=new G,p=this.yieldPos,f=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==S.parenR;){if(l?l=!1:this.expect(S.comma),i&&this.afterTrailingComma(S.parenR,!0)){c=!0;break}if(this.type===S.ellipsis){o=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,h,this.parseParenItem))}var d=this.start,m=this.startLoc;if(this.expect(S.parenR),t&&!this.canInsertSemicolon()&&this.eat(S.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=p,this.awaitPos=f,this.parseParenArrowList(n,r,u);u.length&&!c||this.unexpected(this.lastTokStart),o&&this.unexpected(o),this.checkExpressionErrors(h,!0),this.yieldPos=p||this.yieldPos,this.awaitPos=f||this.awaitPos,u.length>1?((e=this.startNodeAt(a,s)).expressions=u,this.finishNodeAt(e,"SequenceExpression",d,m)):e=u[0]}else e=this.parseParenExpression();if(this.options.preserveParens){var g=this.startNodeAt(n,r);return g.expression=e,this.finishNode(g,"ParenthesizedExpression")}return e},J.parseParenItem=function(t){return t},J.parseParenArrowList=function(t,e,n){return this.parseArrowExpression(this.startNodeAt(t,e),n)};var $=[];J.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var t=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(S.dot)){t.meta=e;var n=this.containsEsc;return t.property=this.parseIdent(!0),"target"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(t.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(t.start,"'new.target' can only be used in functions"),this.finishNode(t,"MetaProperty")}var r=this.start,i=this.startLoc,o=this.type===S._import;return t.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),o&&"ImportExpression"===t.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(S.parenL)?t.arguments=this.parseExprList(S.parenR,this.options.ecmaVersion>=8,!1):t.arguments=$,this.finishNode(t,"NewExpression")},J.parseTemplateElement=function(t){var e=t.isTagged,n=this.startNode();return this.type===S.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===S.backQuote,this.finishNode(n,"TemplateElement")},J.parseTemplate=function(t){void 0===t&&(t={});var e=t.isTagged;void 0===e&&(e=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:e});for(n.quasis=[r];!r.tail;)this.type===S.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(S.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(S.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(n,"TemplateLiteral")},J.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===S.name||this.type===S.num||this.type===S.string||this.type===S.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===S.star)&&!E.test(this.input.slice(this.lastTokEnd,this.start))},J.parseObj=function(t,e){var n=this.startNode(),r=!0,i={};for(n.properties=[],this.next();!this.eat(S.braceR);){if(r)r=!1;else if(this.expect(S.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(S.braceR))break;var o=this.parseProperty(t,e);t||this.checkPropClash(o,i,e),n.properties.push(o)}return this.finishNode(n,t?"ObjectPattern":"ObjectExpression")},J.parseProperty=function(t,e){var n,r,i,o,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(S.ellipsis))return t?(a.argument=this.parseIdent(!1),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===S.parenL&&e&&(e.parenthesizedAssign<0&&(e.parenthesizedAssign=this.start),e.parenthesizedBind<0&&(e.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,e),this.type===S.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(t||e)&&(i=this.start,o=this.startLoc),t||(n=this.eat(S.star)));var s=this.containsEsc;return this.parsePropertyName(a),!t&&!s&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(S.star),this.parsePropertyName(a,e)):r=!1,this.parsePropertyValue(a,t,n,r,i,o,e,s),this.finishNode(a,"Property")},J.parsePropertyValue=function(t,e,n,r,i,o,a,s){if((n||r)&&this.type===S.colon&&this.unexpected(),this.eat(S.colon))t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),t.kind="init";else if(this.options.ecmaVersion>=6&&this.type===S.parenL)e&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(n,r);else if(e||s||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===S.comma||this.type===S.braceR||this.type===S.eq)this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(t.key),"await"!==t.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),t.kind="init",e?t.value=this.parseMaybeDefault(i,o,t.key):this.type===S.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),t.value=this.parseMaybeDefault(i,o,t.key)):t.value=t.key,t.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1);var u="get"===t.kind?0:1;if(t.value.params.length!==u){var l=t.value.start;"get"===t.kind?this.raiseRecoverable(l,"getter should have no params"):this.raiseRecoverable(l,"setter should have exactly one param")}else"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")}},J.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(S.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(S.bracketR),t.key;t.computed=!1}return t.key=this.type===S.num||this.type===S.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},J.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},J.parseMethod=function(t,e,n){var r=this.startNode(),i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=t),this.options.ecmaVersion>=8&&(r.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|B(e,r.generator)|(n?128:0)),this.expect(S.parenL),r.params=this.parseBindingList(S.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(r,"FunctionExpression")},J.parseArrowExpression=function(t,e,n){var r=this.yieldPos,i=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(16|B(n,!1)),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=o,this.finishNode(t,"ArrowFunctionExpression")},J.parseFunctionBody=function(t,e,n){var r=e&&this.type!==S.braceL,i=this.strict,o=!1;if(r)t.body=this.parseMaybeAssign(),t.expression=!0,this.checkParams(t,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);i&&!a||(o=this.strictDirective(this.end))&&a&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list");var s=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(t,!i&&!o&&!e&&!n&&this.isSimpleParamList(t.params)),this.strict&&t.id&&this.checkLVal(t.id,5),t.body=this.parseBlock(!1,void 0,o&&!i),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=s}this.exitScope()},J.isSimpleParamList=function(t){for(var e=0,n=t;e<n.length;e+=1)if("Identifier"!==n[e].type)return!1;return!0},J.checkParams=function(t,e){for(var n={},r=0,i=t.params;r<i.length;r+=1){var o=i[r];this.checkLVal(o,1,e?null:n)}},J.parseExprList=function(t,e,n,r){for(var i=[],o=!0;!this.eat(t);){if(o)o=!1;else if(this.expect(S.comma),e&&this.afterTrailingComma(t))break;var a=void 0;n&&this.type===S.comma?a=null:this.type===S.ellipsis?(a=this.parseSpread(r),r&&this.type===S.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):a=this.parseMaybeAssign(!1,r),i.push(a)}return i},J.checkUnreserved=function(t){var e=t.start,n=t.end,r=t.name;this.inGenerator&&"yield"===r&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(e,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(e,n).indexOf("\\")||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+r+"' is reserved"))},J.parseIdent=function(t,e){var n=this.startNode();return this.type===S.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!t),this.finishNode(n,"Identifier"),t||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},J.parseYield=function(t){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===S.semi||this.canInsertSemicolon()||this.type!==S.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(S.star),e.argument=this.parseMaybeAssign(t)),this.finishNode(e,"YieldExpression")},J.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!1),this.finishNode(t,"AwaitExpression")};var tt=j.prototype;tt.raise=function(t,e){var n=F(this.input,t);e+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(e);throw r.pos=t,r.loc=n,r.raisedAt=this.pos,r},tt.raiseRecoverable=tt.raise,tt.curPosition=function(){if(this.options.locations)return new D(this.curLine,this.pos-this.lineStart)};var et=j.prototype,nt=function(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[]};et.enterScope=function(t){this.scopeStack.push(new nt(t))},et.exitScope=function(){this.scopeStack.pop()},et.treatFunctionsAsVarInScope=function(t){return 2&t.flags||!this.inModule&&1&t.flags},et.declareName=function(t,e,n){var r=!1;if(2===e){var i=this.currentScope();r=i.lexical.indexOf(t)>-1||i.functions.indexOf(t)>-1||i.var.indexOf(t)>-1,i.lexical.push(t),this.inModule&&1&i.flags&&delete this.undefinedExports[t]}else if(4===e)this.currentScope().lexical.push(t);else if(3===e){var o=this.currentScope();r=this.treatFunctionsAsVar?o.lexical.indexOf(t)>-1:o.lexical.indexOf(t)>-1||o.var.indexOf(t)>-1,o.functions.push(t)}else for(var a=this.scopeStack.length-1;a>=0;--a){var s=this.scopeStack[a];if(s.lexical.indexOf(t)>-1&&!(32&s.flags&&s.lexical[0]===t)||!this.treatFunctionsAsVarInScope(s)&&s.functions.indexOf(t)>-1){r=!0;break}if(s.var.push(t),this.inModule&&1&s.flags&&delete this.undefinedExports[t],3&s.flags)break}r&&this.raiseRecoverable(n,"Identifier '"+t+"' has already been declared")},et.checkLocalExport=function(t){-1===this.scopeStack[0].lexical.indexOf(t.name)&&-1===this.scopeStack[0].var.indexOf(t.name)&&(this.undefinedExports[t.name]=t)},et.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},et.currentVarScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(3&e.flags)return e}},et.currentThisScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(3&e.flags&&!(16&e.flags))return e}};var rt=function(t,e,n){this.type="",this.start=e,this.end=0,t.options.locations&&(this.loc=new N(t,n)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[e,0])},it=j.prototype;function ot(t,e,n,r){return t.type=e,t.end=n,this.options.locations&&(t.loc.end=r),this.options.ranges&&(t.range[1]=n),t}it.startNode=function(){return new rt(this,this.start,this.startLoc)},it.startNodeAt=function(t,e){return new rt(this,t,e)},it.finishNode=function(t,e){return ot.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)},it.finishNodeAt=function(t,e,n,r){return ot.call(this,t,e,n,r)};var at=function(t,e,n,r,i){this.token=t,this.isExpr=!!e,this.preserveSpace=!!n,this.override=r,this.generator=!!i},st={b_stat:new at("{",!1),b_expr:new at("{",!0),b_tmpl:new at("${",!1),p_stat:new at("(",!1),p_expr:new at("(",!0),q_tmpl:new at("`",!0,!0,(function(t){return t.tryReadTemplateToken()})),f_stat:new at("function",!1),f_expr:new at("function",!0),f_expr_gen:new at("function",!0,!1,null,!0),f_gen:new at("function",!1,!1,null,!0)},ut=j.prototype;ut.initialContext=function(){return[st.b_stat]},ut.braceIsBlock=function(t){var e=this.curContext();return e===st.f_expr||e===st.f_stat||(t!==S.colon||e!==st.b_stat&&e!==st.b_expr?t===S._return||t===S.name&&this.exprAllowed?E.test(this.input.slice(this.lastTokEnd,this.start)):t===S._else||t===S.semi||t===S.eof||t===S.parenR||t===S.arrow||(t===S.braceL?e===st.b_stat:t!==S._var&&t!==S._const&&t!==S.name&&!this.exprAllowed):!e.isExpr)},ut.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if("function"===e.token)return e.generator}return!1},ut.updateContext=function(t){var e,n=this.type;n.keyword&&t===S.dot?this.exprAllowed=!1:(e=n.updateContext)?e.call(this,t):this.exprAllowed=n.beforeExpr},S.parenR.updateContext=S.braceR.updateContext=function(){if(1!==this.context.length){var t=this.context.pop();t===st.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr}else this.exprAllowed=!0},S.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?st.b_stat:st.b_expr),this.exprAllowed=!0},S.dollarBraceL.updateContext=function(){this.context.push(st.b_tmpl),this.exprAllowed=!0},S.parenL.updateContext=function(t){var e=t===S._if||t===S._for||t===S._with||t===S._while;this.context.push(e?st.p_stat:st.p_expr),this.exprAllowed=!0},S.incDec.updateContext=function(){},S._function.updateContext=S._class.updateContext=function(t){!t.beforeExpr||t===S.semi||t===S._else||t===S._return&&E.test(this.input.slice(this.lastTokEnd,this.start))||(t===S.colon||t===S.braceL)&&this.curContext()===st.b_stat?this.context.push(st.f_stat):this.context.push(st.f_expr),this.exprAllowed=!1},S.backQuote.updateContext=function(){this.curContext()===st.q_tmpl?this.context.pop():this.context.push(st.q_tmpl),this.exprAllowed=!1},S.star.updateContext=function(t){if(t===S._function){var e=this.context.length-1;this.context[e]===st.f_expr?this.context[e]=st.f_expr_gen:this.context[e]=st.f_gen}this.exprAllowed=!0},S.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==S.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var lt="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ct={9:lt,10:"ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS Extended_Pictographic",11:"ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS Extended_Pictographic"},ht="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",pt="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",ft={9:pt,10:"Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",11:"Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho"},dt={};function mt(t){var e=dt[t]={binary:R(ct[t]+" "+ht),nonBinary:{General_Category:R(ht),Script:R(ft[t])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}mt(9),mt(10),mt(11);var gt=j.prototype,yt=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.unicodeProperties=dt[t.options.ecmaVersion>=11?11:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function vt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function _t(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function xt(t){return t>=65&&t<=90||t>=97&&t<=122}function bt(t){return xt(t)||95===t}function wt(t){return bt(t)||St(t)}function St(t){return t>=48&&t<=57}function Et(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function Ct(t){return t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:t-48}function Mt(t){return t>=48&&t<=55}yt.prototype.reset=function(t,e,n){var r=-1!==n.indexOf("u");this.start=0|t,this.source=e+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},yt.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},yt.prototype.at=function(t,e){void 0===e&&(e=!1);var n=this.source,r=n.length;if(t>=r)return-1;var i=n.charCodeAt(t);if(!e&&!this.switchU||i<=55295||i>=57344||t+1>=r)return i;var o=n.charCodeAt(t+1);return o>=56320&&o<=57343?(i<<10)+o-56613888:i},yt.prototype.nextIndex=function(t,e){void 0===e&&(e=!1);var n=this.source,r=n.length;if(t>=r)return r;var i,o=n.charCodeAt(t);return!e&&!this.switchU||o<=55295||o>=57344||t+1>=r||(i=n.charCodeAt(t+1))<56320||i>57343?t+1:t+2},yt.prototype.current=function(t){return void 0===t&&(t=!1),this.at(this.pos,t)},yt.prototype.lookahead=function(t){return void 0===t&&(t=!1),this.at(this.nextIndex(this.pos,t),t)},yt.prototype.advance=function(t){void 0===t&&(t=!1),this.pos=this.nextIndex(this.pos,t)},yt.prototype.eat=function(t,e){return void 0===e&&(e=!1),this.current(e)===t&&(this.advance(e),!0)},gt.validateRegExpFlags=function(t){for(var e=t.validFlags,n=t.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===e.indexOf(i)&&this.raise(t.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(t.start,"Duplicate regular expression flag")}},gt.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},gt.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,n=t.backReferenceNames;e<n.length;e+=1){var r=n[e];-1===t.groupNames.indexOf(r)&&t.raise("Invalid named capture referenced")}},gt.regexp_disjunction=function(t){for(this.regexp_alternative(t);t.eat(124);)this.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},gt.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););},gt.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!!(t.switchU?this.regexp_eatAtom(t):this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},gt.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!n,!0}return t.pos=e,!1},gt.regexp_eatQuantifier=function(t,e){return void 0===e&&(e=!1),!!this.regexp_eatQuantifierPrefix(t,e)&&(t.eat(63),!0)},gt.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)},gt.regexp_eatBracedQuantifier=function(t,e){var n=t.pos;if(t.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(i=t.lastIntValue),t.eat(125)))return-1!==i&&i<r&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=n}return!1},gt.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},gt.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1},gt.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=e}return!1},gt.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},gt.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},gt.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},gt.regexp_eatSyntaxCharacter=function(t){var e=t.current();return!!_t(e)&&(t.lastIntValue=e,t.advance(),!0)},gt.regexp_eatPatternCharacters=function(t){for(var e=t.pos,n=0;-1!==(n=t.current())&&!_t(n);)t.advance();return t.pos!==e},gt.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return!(-1===e||36===e||e>=40&&e<=43||46===e||63===e||91===e||94===e||124===e||(t.advance(),0))},gt.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return-1!==t.groupNames.indexOf(t.lastStringValue)&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},gt.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},gt.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=vt(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=vt(t.lastIntValue);return!0}return!1},gt.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,n=this.options.ecmaVersion>=11,r=t.current(n);return t.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,n)&&(r=t.lastIntValue),function(t){return m(t,!0)||36===t||95===t}(r)?(t.lastIntValue=r,!0):(t.pos=e,!1)},gt.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,n=this.options.ecmaVersion>=11,r=t.current(n);return t.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,n)&&(r=t.lastIntValue),function(t){return g(t,!0)||36===t||95===t||8204===t||8205===t}(r)?(t.lastIntValue=r,!0):(t.pos=e,!1)},gt.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},gt.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var n=t.lastIntValue;if(t.switchU)return n>t.maxBackReference&&(t.maxBackReference=n),!0;if(n<=t.numCapturingParens)return!0;t.pos=e}return!1},gt.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},gt.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t,!1)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},gt.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1},gt.regexp_eatZero=function(t){return 48===t.current()&&!St(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},gt.regexp_eatControlEscape=function(t){var e=t.current();return 116===e?(t.lastIntValue=9,t.advance(),!0):110===e?(t.lastIntValue=10,t.advance(),!0):118===e?(t.lastIntValue=11,t.advance(),!0):102===e?(t.lastIntValue=12,t.advance(),!0):114===e&&(t.lastIntValue=13,t.advance(),!0)},gt.regexp_eatControlLetter=function(t){var e=t.current();return!!xt(e)&&(t.lastIntValue=e%32,t.advance(),!0)},gt.regexp_eatRegExpUnicodeEscapeSequence=function(t,e){void 0===e&&(e=!1);var n,r=t.pos,i=e||t.switchU;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var o=t.lastIntValue;if(i&&o>=55296&&o<=56319){var a=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var s=t.lastIntValue;if(s>=56320&&s<=57343)return t.lastIntValue=1024*(o-55296)+(s-56320)+65536,!0}t.pos=a,t.lastIntValue=o}return!0}if(i&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&(n=t.lastIntValue)>=0&&n<=1114111)return!0;i&&t.raise("Invalid unicode escape"),t.pos=r}return!1},gt.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var e=t.current();return!(99===e||t.switchN&&107===e||(t.lastIntValue=e,t.advance(),0))},gt.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do{t.lastIntValue=10*t.lastIntValue+(e-48),t.advance()}while((e=t.current())>=48&&e<=57);return!0}return!1},gt.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(function(t){return 100===t||68===t||115===t||83===t||119===t||87===t}(e))return t.lastIntValue=-1,t.advance(),!0;if(t.switchU&&this.options.ecmaVersion>=9&&(80===e||112===e)){if(t.lastIntValue=-1,t.advance(),t.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(t)&&t.eat(125))return!0;t.raise("Invalid property name")}return!1},gt.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var n=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,n,r),!0}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var i=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,i),!0}return!1},gt.regexp_validateUnicodePropertyNameAndValue=function(t,e,n){k(t.unicodeProperties.nonBinary,e)||t.raise("Invalid property name"),t.unicodeProperties.nonBinary[e].test(n)||t.raise("Invalid property value")},gt.regexp_validateUnicodePropertyNameOrValue=function(t,e){t.unicodeProperties.binary.test(e)||t.raise("Invalid property name")},gt.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";bt(e=t.current());)t.lastStringValue+=vt(e),t.advance();return""!==t.lastStringValue},gt.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";wt(e=t.current());)t.lastStringValue+=vt(e),t.advance();return""!==t.lastStringValue},gt.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},gt.regexp_eatCharacterClass=function(t){if(t.eat(91)){if(t.eat(94),this.regexp_classRanges(t),t.eat(93))return!0;t.raise("Unterminated character class")}return!1},gt.regexp_classRanges=function(t){for(;this.regexp_eatClassAtom(t);){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var n=t.lastIntValue;!t.switchU||-1!==e&&-1!==n||t.raise("Invalid character class"),-1!==e&&-1!==n&&e>n&&t.raise("Range out of order in character class")}}},gt.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var n=t.current();(99===n||Mt(n))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var r=t.current();return 93!==r&&(t.lastIntValue=r,t.advance(),!0)},gt.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},gt.regexp_eatClassControlLetter=function(t){var e=t.current();return!(!St(e)&&95!==e||(t.lastIntValue=e%32,t.advance(),0))},gt.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1},gt.regexp_eatDecimalDigits=function(t){var e=t.pos,n=0;for(t.lastIntValue=0;St(n=t.current());)t.lastIntValue=10*t.lastIntValue+(n-48),t.advance();return t.pos!==e},gt.regexp_eatHexDigits=function(t){var e=t.pos,n=0;for(t.lastIntValue=0;Et(n=t.current());)t.lastIntValue=16*t.lastIntValue+Ct(n),t.advance();return t.pos!==e},gt.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var n=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=64*e+8*n+t.lastIntValue:t.lastIntValue=8*e+n}else t.lastIntValue=e;return!0}return!1},gt.regexp_eatOctalDigit=function(t){var e=t.current();return Mt(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)},gt.regexp_eatFixedHexDigits=function(t,e){var n=t.pos;t.lastIntValue=0;for(var r=0;r<e;++r){var i=t.current();if(!Et(i))return t.pos=n,!1;t.lastIntValue=16*t.lastIntValue+Ct(i),t.advance()}return!0};var Tt=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new N(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},At=j.prototype;function Pt(t){return"function"!=typeof BigInt?null:BigInt(t.replace(/_/g,""))}function Lt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}At.next=function(t){!t&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Tt(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},At.getToken=function(){return this.next(),new Tt(this)},"undefined"!=typeof Symbol&&(At[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===S.eof,value:e}}}}),At.curContext=function(){return this.context[this.context.length-1]},At.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(S.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},At.readToken=function(t){return m(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},At.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);return t<=55295||t>=57344?t:(t<<10)+this.input.charCodeAt(this.pos+1)-56613888},At.skipBlockComment=function(){var t,e=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations)for(C.lastIndex=n;(t=C.exec(this.input))&&t.index<this.pos;)++this.curLine,this.lineStart=t.index+t[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,e,this.curPosition())},At.skipLineComment=function(t){for(var e=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!M(r);)r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,n,this.curPosition())},At.skipSpace=function(){t:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(!(t>8&&t<14||t>=5760&&T.test(String.fromCharCode(t))))break t;++this.pos}}},At.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=t,this.value=e,this.updateContext(n)},At.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===e?(this.pos+=3,this.finishToken(S.ellipsis)):(++this.pos,this.finishToken(S.dot))},At.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(S.assign,2):this.finishOp(S.slash,1)},At.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),n=1,r=42===t?S.star:S.modulo;return this.options.ecmaVersion>=7&&42===t&&42===e&&(++n,r=S.starstar,e=this.input.charCodeAt(this.pos+2)),61===e?this.finishOp(S.assign,n+1):this.finishOp(r,n)},At.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?this.options.ecmaVersion>=12&&61===this.input.charCodeAt(this.pos+2)?this.finishOp(S.assign,3):this.finishOp(124===t?S.logicalOR:S.logicalAND,2):61===e?this.finishOp(S.assign,2):this.finishOp(124===t?S.bitwiseOR:S.bitwiseAND,1)},At.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(S.assign,2):this.finishOp(S.bitwiseXOR,1)},At.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?45!==e||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!E.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(S.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===e?this.finishOp(S.assign,2):this.finishOp(S.plusMin,1)},At.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),n=1;return e===t?(n=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(S.assign,n+1):this.finishOp(S.bitShift,n)):33!==e||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===e&&(n=2),this.finishOp(S.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},At.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(S.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===e&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(S.arrow)):this.finishOp(61===t?S.eq:S.prefix,1)},At.readToken_question=function(){var t=this.options.ecmaVersion;if(t>=11){var e=this.input.charCodeAt(this.pos+1);if(46===e){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(S.questionDot,2)}if(63===e)return t>=12&&61===this.input.charCodeAt(this.pos+2)?this.finishOp(S.assign,3):this.finishOp(S.coalesce,2)}return this.finishOp(S.question,1)},At.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(S.parenL);case 41:return++this.pos,this.finishToken(S.parenR);case 59:return++this.pos,this.finishToken(S.semi);case 44:return++this.pos,this.finishToken(S.comma);case 91:return++this.pos,this.finishToken(S.bracketL);case 93:return++this.pos,this.finishToken(S.bracketR);case 123:return++this.pos,this.finishToken(S.braceL);case 125:return++this.pos,this.finishToken(S.braceR);case 58:return++this.pos,this.finishToken(S.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(S.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(120===e||88===e)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===e||79===e)return this.readRadixNumber(8);if(98===e||66===e)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 63:return this.readToken_question();case 126:return this.finishOp(S.prefix,1)}this.raise(this.pos,"Unexpected character '"+Lt(t)+"'")},At.finishOp=function(t,e){var n=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,n)},At.readRegexp=function(){for(var t,e,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(E.test(r)&&this.raise(n,"Unterminated regular expression"),t)t=!1;else{if("["===r)e=!0;else if("]"===r&&e)e=!1;else if("/"===r&&!e)break;t="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var o=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(o);var s=this.regexpState||(this.regexpState=new yt(this));s.reset(n,i,a),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var u=null;try{u=new RegExp(i,a)}catch(t){}return this.finishToken(S.regexp,{pattern:i,flags:a,value:u})},At.readInt=function(t,e,n){for(var r=this.options.ecmaVersion>=12&&void 0===e,i=n&&48===this.input.charCodeAt(this.pos),o=this.pos,a=0,s=0,u=0,l=null==e?1/0:e;u<l;++u,++this.pos){var c=this.input.charCodeAt(this.pos),h=void 0;if(r&&95===c)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===s&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===u&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),s=c;else{if((h=c>=97?c-97+10:c>=65?c-65+10:c>=48&&c<=57?c-48:1/0)>=t)break;s=c,a=a*t+h}}return r&&95===s&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===o||null!=e&&this.pos-o!==e?null:a},At.readRadixNumber=function(t){var e=this.pos;this.pos+=2;var n=this.readInt(t);return null==n&&this.raise(this.start+2,"Expected number in radix "+t),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n=Pt(this.input.slice(e,this.pos)),++this.pos):m(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(S.num,n)},At.readNumber=function(t){var e=this.pos;t||null!==this.readInt(10,void 0,!0)||this.raise(e,"Invalid number");var n=this.pos-e>=2&&48===this.input.charCodeAt(e);n&&this.strict&&this.raise(e,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!t&&this.options.ecmaVersion>=11&&110===r){var i=Pt(this.input.slice(e,this.pos));return++this.pos,m(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(S.num,i)}n&&/[89]/.test(this.input.slice(e,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(43!==(r=this.input.charCodeAt(++this.pos))&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(e,"Invalid number")),m(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var o,a=(o=this.input.slice(e,this.pos),n?parseInt(o,8):parseFloat(o.replace(/_/g,"")));return this.finishToken(S.num,a)},At.readCodePoint=function(){var t;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var e=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(e,"Code point out of bounds")}else t=this.readHexChar(4);return t},At.readString=function(t){for(var e="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===t)break;92===r?(e+=this.input.slice(n,this.pos),e+=this.readEscapedChar(!1),n=this.pos):(M(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(n,this.pos++),this.finishToken(S.string,e)};var It={};function kt(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function Ot(t){var e="function"==typeof Map?new Map:void 0;return Ot=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Dt(t,arguments,Ft(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Nt(r,t)},Ot(t)}function Rt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Dt(t,e,n){return Dt=Rt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Nt(i,n.prototype),i},Dt.apply(null,arguments)}function Nt(t,e){return Nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Nt(t,e)}function Ft(t){return Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ft(t)}At.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t!==It)throw t;this.readInvalidTemplateToken()}this.inTemplateElement=!1},At.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw It;this.raise(t,e)},At.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==S.template&&this.type!==S.invalidTemplate?(t+=this.input.slice(e,this.pos),this.finishToken(S.template,t)):36===n?(this.pos+=2,this.finishToken(S.dollarBraceL)):(++this.pos,this.finishToken(S.backQuote));if(92===n)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(M(n)){switch(t+=this.input.slice(e,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(n)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}},At.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(S.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},At.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Lt(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(t){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(e>=48&&e<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,e=this.input.charCodeAt(this.pos),"0"===r&&56!==e&&57!==e||!this.strict&&!t||this.invalidStringToken(this.pos-1-r.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return M(e)?"":String.fromCharCode(e)}},At.readHexChar=function(t){var e=this.pos,n=this.readInt(16,t);return null===n&&this.invalidStringToken(e,"Bad character escape sequence"),n},At.readWord1=function(){this.containsEsc=!1;for(var t="",e=!0,n=this.pos,r=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(g(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,t+=this.input.slice(n,this.pos);var o=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(e?m:g)(a,r)||this.invalidStringToken(o,"Invalid Unicode escape"),t+=Lt(a),n=this.pos}e=!1}return t+this.input.slice(n,this.pos)},At.readWord=function(){var t=this.readWord1(),e=S.name;return this.keywords.test(t)&&(e=b[t]),this.finishToken(e,t)},j.acorn={Parser:j,version:"7.4.1",defaultOptions:z,Position:D,SourceLocation:N,getLineInfo:F,Node:rt,TokenType:y,tokTypes:S,keywordTypes:b,TokContext:at,tokContexts:st,isIdentifierChar:g,isIdentifierStart:m,Token:Tt,isNewLine:M,lineBreak:E,lineBreakG:C,nonASCIIwhitespace:T};var zt=function(t){function e(){return t.apply(this,arguments)||this}return kt(e,t),e}(Ot(Error)),Bt=function(t){function e(){return t.apply(this,arguments)||this}return kt(e,t),e}(Ot(SyntaxError)),jt=function(t){function e(){return t.apply(this,arguments)||this}return kt(e,t),e}(Ot(ReferenceError)),Ut=function(t){function e(){return t.apply(this,arguments)||this}return kt(e,t),e}(Ot(TypeError)),Zt=function(t){function e(){return t.apply(this,arguments)||this}return kt(e,t),e}(zt),Vt=function(t){function e(){return t.apply(this,arguments)||this}return kt(e,t),e}(Bt),Gt=function(t){function e(){return t.apply(this,arguments)||this}return kt(e,t),e}(jt),Ht={UnknownError:[3001,"%0",Zt],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Zt],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Gt],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Gt],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Gt],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Gt],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Gt],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Gt],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Gt],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Gt],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Gt],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Gt],FunctionUndefinedReferenceError:[2001,"%0 is not a function",jt],VariableUndefinedReferenceError:[2002,"%0 is not defined",jt],IsNotConstructor:[2003,"%0 is not a constructor",Ut]};function Wt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function qt(t,e,n){return qt=Wt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Xt(i,n.prototype),i},qt.apply(null,arguments)}function Xt(t,e){return Xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Xt(t,e)}function Yt(t,e){Object.defineProperty(t,"name",{value:e,writable:!1,enumerable:!1,configurable:!0})}var Kt=Object.prototype.hasOwnProperty,Qt=Symbol("Break"),Jt=Symbol("Continue"),$t=Symbol("DefaultCase"),te=Symbol("EmptyStatementReturn"),ee=Symbol("WithScopeName"),ne=Symbol("SuperScopeName"),re=Symbol("RootScopeName"),ie=Symbol("GlobalScopeName");function oe(t){return"function"==typeof t}var ae=function(){function t(t){this.interpreter=t}return t.prototype.generator=function(){var t=this.interpreter;return{getOptions:t.getOptions.bind(t),getCurrentScope:function(){return this.getCurrentScope()}.bind(t),getGlobalScope:function(){return this.getGlobalScope()}.bind(t),getCurrentContext:function(){return this.getCurrentContext()}.bind(t),getExecStartTime:t.getExecStartTime.bind(t)}},t}();function se(t,e,n){if(void 0===n&&(n=!0),!(t instanceof ae))throw new Error("Illegal call");if("string"!=typeof e)return e;if(e){var r=t.generator(),i={timeout:r.getOptions().timeout,_initEnv:function(){n||this.setCurrentContext(r.getCurrentContext()),this.execStartTime=r.getExecStartTime(),this.execEndTime=this.execStartTime}},o=n?r.getGlobalScope():r.getCurrentScope();return new ge(o,i).evaluate(e)}}function ue(t){if(!(t instanceof ae))throw new Error("Illegal call");for(var e=t.generator(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r.pop(),a=new ge(e.getGlobalScope(),e.getOptions()),s="\n\t\t    (function anonymous("+r.join(",")+"){\n\t\t        "+o+"\n\t\t    });\n\t\t    ";return a.evaluate(s)}Object.defineProperty(se,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(ue,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var le=function(t){this.value=t},ce=function(t){this.value=t},he=function(t){this.value=t},pe=function(t,e,n){void 0===e&&(e=null),this.name=n,this.parent=e,this.data=t,this.labelStack=[]};function fe(){}function de(t,e){return void 0===t&&(t=null),new pe(Object.create(null),t,e)}var me={NaN:NaN,Infinity:1/0,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:se,Function:ue};"undefined"!=typeof JSON&&(me.JSON=JSON),"undefined"!=typeof Promise&&(me.Promise=Promise),"undefined"!=typeof Set&&(me.Set=Set),"undefined"!=typeof Map&&(me.Map=Map),"undefined"!=typeof Symbol&&(me.Symbol=Symbol),"undefined"!=typeof Proxy&&(me.Proxy=Proxy),"undefined"!=typeof WeakMap&&(me.WeakMap=WeakMap),"undefined"!=typeof WeakSet&&(me.WeakSet=WeakSet),"undefined"!=typeof Reflect&&(me.Reflect=Reflect);var ge=function(){function t(e,n){void 0===e&&(e=t.global),void 0===n&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||t.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:void 0===n.globalContextInFunction?t.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=e||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var e=t.prototype;return e.initEnvironment=function(t){var e;if(t instanceof pe)e=t;else{var n=null,r=this.createSuperScope(t);this.options.rootContext&&(n=new pe(function(t){return Object.create(t)}(this.options.rootContext),r,re)),e=new pe(t,n||r,ie)}this.globalScope=e,this.currentScope=this.globalScope,this.globalContext=e.data,this.currentContext=e.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var i=this.options._initEnv;i&&i.call(this)},e.getExecStartTime=function(){return this.execStartTime},e.getExecutionTime=function(){return this.execEndTime-this.execStartTime},e.setExecTimeout=function(t){void 0===t&&(t=0),this.options.timeout=t},e.getOptions=function(){return this.options},e.getGlobalScope=function(){return this.globalScope},e.getCurrentScope=function(){return this.currentScope},e.getCurrentContext=function(){return this.currentContext},e.isInterruptThrow=function(t){return t instanceof Zt||t instanceof Gt||t instanceof Vt},e.createSuperScope=function(t){var e=Object.assign({},me);return Object.keys(e).forEach((function(n){n in t&&delete e[n]})),new pe(e,null,ne)},e.setCurrentContext=function(t){this.currentContext=t},e.setCurrentScope=function(t){this.currentScope=t},e.evaluate=function(e){var n,r,i;if(void 0===e&&(e=""),e)return r=e,i={ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||t.ecmaVersion},n=j.parse(r,i),this.evaluateNode(n,e)},e.appendCode=function(t){return this.evaluate(t)},e.evaluateNode=function(t,e){var n=this;void 0===e&&(e=""),this.value=void 0,this.source=e,this.sourceList.push(e),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var r=this.getCurrentScope(),i=this.getCurrentContext(),o=r.labelStack.concat([]),a=this.callStack.concat([]);try{var s=this.createClosure(t);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),s()}catch(t){throw t}finally{n.setCurrentScope(r),n.setCurrentContext(i),r.labelStack=o,n.callStack=a,this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},e.createErrorMessage=function(t,e,n){var r=t[1].replace("%0",String(e));return null!==n&&(r+=this.getNodePosition(n||this.lastExecNode)),r},e.createError=function(t,e){return new e(t)},e.createThrowError=function(t,e){return this.createError(t,e)},e.createInternalThrowError=function(t,e,n){return this.createError(this.createErrorMessage(t,e,n),t[2])},e.checkTimeout=function(){if(!this.isRunning)return!1;var t=this.options.timeout||0;return Date.now()-this.execStartTime>t},e.getNodePosition=function(t){return t&&t.loc?" ["+t.loc.start.line+":"+t.loc.start.column+"]":""},e.createClosure=function(t){var e,n=this;switch(t.type){case"BinaryExpression":e=this.binaryExpressionHandler(t);break;case"LogicalExpression":e=this.logicalExpressionHandler(t);break;case"UnaryExpression":e=this.unaryExpressionHandler(t);break;case"UpdateExpression":e=this.updateExpressionHandler(t);break;case"ObjectExpression":e=this.objectExpressionHandler(t);break;case"ArrayExpression":e=this.arrayExpressionHandler(t);break;case"CallExpression":e=this.callExpressionHandler(t);break;case"NewExpression":e=this.newExpressionHandler(t);break;case"MemberExpression":e=this.memberExpressionHandler(t);break;case"ThisExpression":e=this.thisExpressionHandler(t);break;case"SequenceExpression":e=this.sequenceExpressionHandler(t);break;case"Literal":e=this.literalHandler(t);break;case"Identifier":e=this.identifierHandler(t);break;case"AssignmentExpression":e=this.assignmentExpressionHandler(t);break;case"FunctionDeclaration":e=this.functionDeclarationHandler(t);break;case"VariableDeclaration":e=this.variableDeclarationHandler(t);break;case"BlockStatement":case"Program":e=this.programHandler(t);break;case"ExpressionStatement":e=this.expressionStatementHandler(t);break;case"EmptyStatement":e=this.emptyStatementHandler(t);break;case"ReturnStatement":e=this.returnStatementHandler(t);break;case"FunctionExpression":e=this.functionExpressionHandler(t);break;case"IfStatement":e=this.ifStatementHandler(t);break;case"ConditionalExpression":e=this.conditionalExpressionHandler(t);break;case"ForStatement":e=this.forStatementHandler(t);break;case"WhileStatement":e=this.whileStatementHandler(t);break;case"DoWhileStatement":e=this.doWhileStatementHandler(t);break;case"ForInStatement":e=this.forInStatementHandler(t);break;case"WithStatement":e=this.withStatementHandler(t);break;case"ThrowStatement":e=this.throwStatementHandler(t);break;case"TryStatement":e=this.tryStatementHandler(t);break;case"ContinueStatement":e=this.continueStatementHandler(t);break;case"BreakStatement":e=this.breakStatementHandler(t);break;case"SwitchStatement":e=this.switchStatementHandler(t);break;case"LabeledStatement":e=this.labeledStatementHandler(t);break;case"DebuggerStatement":e=this.debuggerStatementHandler(t);break;default:throw this.createInternalThrowError(Ht.NodeTypeSyntaxError,t.type,t)}return function(){var r=n.options.timeout;if(r&&r>0&&n.checkTimeout())throw n.createInternalThrowError(Ht.ExecutionTimeOutError,r,null);return n.lastExecNode=t,e.apply(void 0,arguments)}},e.binaryExpressionHandler=function(t){var e=this,n=this.createClosure(t.left),r=this.createClosure(t.right);return function(){var i=n(),o=r();switch(t.operator){case"==":return i==o;case"!=":return i!=o;case"===":return i===o;case"!==":return i!==o;case"<":return i<o;case"<=":return i<=o;case">":return i>o;case">=":return i>=o;case"<<":return i<<o;case">>":return i>>o;case">>>":return i>>>o;case"+":return i+o;case"-":return i-o;case"*":return i*o;case"**":return Math.pow(i,o);case"/":return i/o;case"%":return i%o;case"|":return i|o;case"^":return i^o;case"&":return i&o;case"in":return i in o;case"instanceof":return i instanceof o;default:throw e.createInternalThrowError(Ht.BinaryOperatorSyntaxError,t.operator,t)}}},e.logicalExpressionHandler=function(t){var e=this,n=this.createClosure(t.left),r=this.createClosure(t.right);return function(){switch(t.operator){case"||":return n()||r();case"&&":return n()&&r();default:throw e.createInternalThrowError(Ht.LogicalOperatorSyntaxError,t.operator,t)}}},e.unaryExpressionHandler=function(t){var e,n=this;if("delete"===t.operator){var r=this.createObjectGetter(t.argument),i=this.createNameGetter(t.argument);return function(){return delete r()[i()]}}if("typeof"===t.operator&&"Identifier"===t.argument.type){var o=this.createObjectGetter(t.argument),a=this.createNameGetter(t.argument);e=function(){return o()[a()]}}else e=this.createClosure(t.argument);return function(){var r=e();switch(t.operator){case"-":return-r;case"+":return+r;case"!":return!r;case"~":return~r;case"void":return;case"typeof":return typeof r;default:throw n.createInternalThrowError(Ht.UnaryOperatorSyntaxError,t.operator,t)}}},e.updateExpressionHandler=function(t){var e=this,n=this.createObjectGetter(t.argument),r=this.createNameGetter(t.argument);return function(){var i=n(),o=r();switch(e.assertVariable(i,o,t),t.operator){case"++":return t.prefix?++i[o]:i[o]++;case"--":return t.prefix?--i[o]:i[o]--;default:throw e.createInternalThrowError(Ht.UpdateOperatorSyntaxError,t.operator,t)}}},e.objectExpressionHandler=function(t){var e=this,n=[],r=Object.create(null);return t.properties.forEach((function(t){var i=t.kind,o=function(t){return"Identifier"===t.type?t.name:"Literal"===t.type?t.value:this.throwError(Ht.ObjectStructureSyntaxError,t.type,t)}(t.key);r[o]&&"init"!==i||(r[o]={}),r[o][i]=e.createClosure(t.value),n.push({key:o,property:t})})),function(){for(var t={},e=n.length,i=0;i<e;i++){var o=n[i],a=o.key,s=r[a],u=s.init?s.init():void 0,l=s.get?s.get():function(){},c=s.set?s.set():function(t){};if("set"in s||"get"in s){var h={configurable:!0,enumerable:!0,get:l,set:c};Object.defineProperty(t,a,h)}else{var p=o.property,f=p.kind;"Identifier"!==p.key.type||"FunctionExpression"!==p.value.type||"init"!==f||p.value.id||Yt(u,p.key.name),t[a]=u}}return t}},e.arrayExpressionHandler=function(t){var e=this,n=t.elements.map((function(t){return t?e.createClosure(t):t}));return function(){for(var t=n.length,e=Array(t),r=0;r<t;r++){var i=n[r];i&&(e[r]=i())}return e}},e.safeObjectGet=function(t,e,n){return t[e]},e.createCallFunctionGetter=function(t){var e=this;if("MemberExpression"===t.type){var n=this.createClosure(t.object),r=this.createMemberKeyGetter(t),i=this.source;return function(){var o=n(),a=r(),s=e.safeObjectGet(o,a,t);if(!s||!oe(s)){var u=i.slice(t.start,t.end);throw e.createInternalThrowError(Ht.FunctionUndefinedReferenceError,u,t)}return s.__IS_EVAL_FUNC?function(t){return s(new ae(e),t,!0)}:s.__IS_FUNCTION_FUNC?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return s.apply(void 0,[new ae(e)].concat(n))}:s.bind(o)}}var o=this.createClosure(t);return function(){var n="";"Identifier"===t.type&&(n=t.name);var r=o();if(!r||!oe(r))throw e.createInternalThrowError(Ht.FunctionUndefinedReferenceError,n,t);if("Identifier"===t.type&&r.__IS_EVAL_FUNC&&"eval"===n)return function(t){var i=e.getScopeFromName(n,e.getCurrentScope()),o=i.name===ne||i.name===ie||i.name===re;return r(new ae(e),t,!o)};if(r.__IS_EVAL_FUNC)return function(t){return r(new ae(e),t,!0)};if(r.__IS_FUNCTION_FUNC)return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.apply(void 0,[new ae(e)].concat(n))};var i=e.options.globalContextInFunction;if("Identifier"===t.type){var a=e.getIdentifierScope(t);a.name===ee&&(i=a.data)}return r.bind(i)}},e.callExpressionHandler=function(t){var e=this,n=this.createCallFunctionGetter(t.callee),r=t.arguments.map((function(t){return e.createClosure(t)}));return function(){return n().apply(void 0,r.map((function(t){return t()})))}},e.functionExpressionHandler=function(t){var e=this,n=this,r=this.source,i=this.collectDeclVars,o=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var a=t.id?t.id.name:"",s=t.params.length,u=t.params.map((function(t){return e.createParamNameGetter(t)})),l=this.createClosure(t.body),c=this.collectDeclVars,h=this.collectDeclFuncs;return this.collectDeclVars=i,this.collectDeclFuncs=o,function(){var e=n.getCurrentScope(),i=function t(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.callStack.push(""+a);var s=n.getCurrentScope(),p=de(e,"FunctionScope("+a+")");n.setCurrentScope(p),n.addDeclarationsToScope(c,h,p),a&&(p.data[a]=t),p.data.arguments=arguments,u.forEach((function(t,e){p.data[t()]=i[e]}));var f=n.getCurrentContext();n.setCurrentContext(this);var d=l();if(n.setCurrentContext(f),n.setCurrentScope(s),n.callStack.pop(),d instanceof le)return d.value};return Yt(i,a),Object.defineProperty(i,"length",{value:s,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(i,"toString",{value:function(){return r.slice(t.start,t.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(i,"valueOf",{value:function(){return r.slice(t.start,t.end)},writable:!0,configurable:!0,enumerable:!1}),i}},e.newExpressionHandler=function(t){var e=this,n=this.source,r=this.createClosure(t.callee),i=t.arguments.map((function(t){return e.createClosure(t)}));return function(){var o=r();if(!oe(o)||o.__IS_EVAL_FUNC){var a=t.callee,s=n.slice(a.start,a.end);throw e.createInternalThrowError(Ht.IsNotConstructor,s,t)}return o.__IS_FUNCTION_FUNC?o.apply(void 0,[new ae(e)].concat(i.map((function(t){return t()})))):qt(o,i.map((function(t){return t()})))}},e.memberExpressionHandler=function(t){var e=this.createClosure(t.object),n=this.createMemberKeyGetter(t);return function(){return e()[n()]}},e.thisExpressionHandler=function(t){var e=this;return function(){return e.getCurrentContext()}},e.sequenceExpressionHandler=function(t){var e=this,n=t.expressions.map((function(t){return e.createClosure(t)}));return function(){for(var t,e=n.length,r=0;r<e;r++)t=(0,n[r])();return t}},e.literalHandler=function(t){return function(){return t.regex?new RegExp(t.regex.pattern,t.regex.flags):t.value}},e.identifierHandler=function(t){var e=this;return function(){var n=e.getCurrentScope(),r=e.getScopeDataFromName(t.name,n);return e.assertVariable(r,t.name,t),r[t.name]}},e.getIdentifierScope=function(t){var e=this.getCurrentScope();return this.getScopeFromName(t.name,e)},e.assignmentExpressionHandler=function(t){var e=this;"Identifier"!==t.left.type||"FunctionExpression"!==t.right.type||t.right.id||(t.right.id={type:"Identifier",name:t.left.name});var n=this.createObjectGetter(t.left),r=this.createNameGetter(t.left),i=this.createClosure(t.right);return function(){var o=n(),a=r(),s=i();switch("="!==t.operator&&e.assertVariable(o,a,t),t.operator){case"=":return o[a]=s;case"+=":return o[a]+=s;case"-=":return o[a]-=s;case"*=":return o[a]*=s;case"**=":return o[a]=Math.pow(o[a],s);case"/=":return o[a]/=s;case"%=":return o[a]%=s;case"<<=":return o[a]<<=s;case">>=":return o[a]>>=s;case">>>=":return o[a]>>>=s;case"&=":return o[a]&=s;case"^=":return o[a]^=s;case"|=":return o[a]|=s;default:throw e.createInternalThrowError(Ht.AssignmentExpressionSyntaxError,t.type,t)}}},e.functionDeclarationHandler=function(t){if(t.id){var e=this.functionExpressionHandler(t);Object.defineProperty(e,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(t.id.name,e)}return function(){return te}},e.getVariableName=function(t){if("Identifier"===t.type)return t.name;throw this.createInternalThrowError(Ht.VariableTypeSyntaxError,t.type,t)},e.variableDeclarationHandler=function(t){for(var e,n=this,r=[],i=0;i<t.declarations.length;i++){var o=t.declarations[i];this.varDeclaration(this.getVariableName(o.id)),o.init&&r.push({type:"AssignmentExpression",operator:"=",left:o.id,right:o.init})}return r.length&&(e=this.createClosure({type:"BlockStatement",body:r})),function(){if(e){var t=n.isVarDeclMode;n.isVarDeclMode=!0,e(),n.isVarDeclMode=t}return te}},e.assertVariable=function(t,e,n){if(t===this.globalScope.data&&!(e in t))throw this.createInternalThrowError(Ht.VariableUndefinedReferenceError,e,n)},e.programHandler=function(t){var e=this,n=t.body.map((function(t){return e.createClosure(t)}));return function(){for(var t=te,r=0;r<n.length;r++){var i=n[r],o=e.setValue(i());if(o!==te&&((t=o)instanceof le||t instanceof ce||t instanceof he||t===Qt||t===Jt))break}return t}},e.expressionStatementHandler=function(t){return this.createClosure(t.expression)},e.emptyStatementHandler=function(t){return function(){return te}},e.returnStatementHandler=function(t){var e=t.argument?this.createClosure(t.argument):fe;return function(){return new le(e())}},e.ifStatementHandler=function(t){var e=this.createClosure(t.test),n=this.createClosure(t.consequent),r=t.alternate?this.createClosure(t.alternate):function(){return te};return function(){return e()?n():r()}},e.conditionalExpressionHandler=function(t){return this.ifStatementHandler(t)},e.forStatementHandler=function(t){var e=this,n=fe,r=t.test?this.createClosure(t.test):function(){return!0},i=fe,o=this.createClosure(t.body);return"ForStatement"===t.type&&(n=t.init?this.createClosure(t.init):n,i=t.update?this.createClosure(t.update):fe),function(a){var s,u=te,l="DoWhileStatement"===t.type;for(a&&"LabeledStatement"===a.type&&(s=a.label.name),n();l||r();i()){l=!1;var c=e.setValue(o());if(c!==te&&c!==Jt){if(c===Qt)break;if((u=c)instanceof he&&u.value===s)u=te;else if(u instanceof le||u instanceof ce||u instanceof he)break}}return u}},e.whileStatementHandler=function(t){return this.forStatementHandler(t)},e.doWhileStatementHandler=function(t){return this.forStatementHandler(t)},e.forInStatementHandler=function(t){var e=this,n=t.left,r=this.createClosure(t.right),i=this.createClosure(t.body);return"VariableDeclaration"===t.left.type&&(this.createClosure(t.left)(),n=t.left.declarations[0].id),function(t){var o,a,s=te;t&&"LabeledStatement"===t.type&&(o=t.label.name);var u=r();for(a in u){e.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:n,right:{type:"Literal",value:a}})();var l=e.setValue(i());if(l!==te&&l!==Jt){if(l===Qt)break;if((s=l)instanceof he&&s.value===o)s=te;else if(s instanceof le||s instanceof ce||s instanceof he)break}}return s}},e.withStatementHandler=function(t){var e=this,n=this.createClosure(t.object),r=this.createClosure(t.body);return function(){var t=n(),i=e.getCurrentScope(),o=new pe(t,i,ee);e.setCurrentScope(o);var a=e.setValue(r());return e.setCurrentScope(i),a}},e.throwStatementHandler=function(t){var e=this,n=this.createClosure(t.argument);return function(){throw e.setValue(void 0),n()}},e.tryStatementHandler=function(t){var e=this,n=this.createClosure(t.block),r=t.handler?this.catchClauseHandler(t.handler):null,i=t.finalizer?this.createClosure(t.finalizer):null;return function(){var t,o,a=e.getCurrentScope(),s=e.getCurrentContext(),u=a.labelStack.concat([]),l=e.callStack.concat([]),c=te,h=function(){e.setCurrentScope(a),e.setCurrentContext(s),a.labelStack=u,e.callStack=l};try{(c=e.setValue(n()))instanceof le&&(t=c)}catch(n){if(h(),e.isInterruptThrow(n))throw n;if(r)try{(c=e.setValue(r(n)))instanceof le&&(t=c)}catch(t){if(h(),e.isInterruptThrow(t))throw t;o=t}}if(i)try{(c=i())instanceof le&&(t=c)}catch(t){if(h(),e.isInterruptThrow(t))throw t;o=t}if(o)throw o;return t||c}},e.catchClauseHandler=function(t){var e=this,n=this.createParamNameGetter(t.param),r=this.createClosure(t.body);return function(t){var i,o=e.getCurrentScope().data,a=n(),s=Kt.call(o,a),u=o[a];return o[a]=t,i=r(),s?o[a]=u:delete o[a],i}},e.continueStatementHandler=function(t){return function(){return t.label?new he(t.label.name):Jt}},e.breakStatementHandler=function(t){return function(){return t.label?new ce(t.label.name):Qt}},e.switchStatementHandler=function(t){var e=this,n=this.createClosure(t.discriminant),r=t.cases.map((function(t){return e.switchCaseHandler(t)}));return function(){for(var t,i,o,a=n(),s=!1,u=0;u<r.length;u++){var l=r[u](),c=l.testClosure();if(c!==$t){if(s||c===a){if(s=!0,(i=e.setValue(l.bodyClosure()))===te)continue;if(i===Qt)break;if((t=i)instanceof le||t instanceof ce||t instanceof he||t===Jt)break}}else o=l}return!s&&o&&((i=e.setValue(o.bodyClosure()))===te||i===Qt||i===Jt||(t=i)),t}},e.switchCaseHandler=function(t){var e=t.test?this.createClosure(t.test):function(){return $t},n=this.createClosure({type:"BlockStatement",body:t.consequent});return function(){return{testClosure:e,bodyClosure:n}}},e.labeledStatementHandler=function(t){var e=this,n=t.label.name,r=this.createClosure(t.body);return function(){var i,o=e.getCurrentScope();return o.labelStack.push(n),(i=r(t))instanceof ce&&i.value===n&&(i=te),o.labelStack.pop(),i}},e.debuggerStatementHandler=function(t){return function(){return te}},e.createParamNameGetter=function(t){if("Identifier"===t.type)return function(){return t.name};throw this.createInternalThrowError(Ht.ParamTypeSyntaxError,t.type,t)},e.createObjectKeyGetter=function(t){var e;return e="Identifier"===t.type?function(){return t.name}:this.createClosure(t),function(){return e()}},e.createMemberKeyGetter=function(t){return t.computed?this.createClosure(t.property):this.createObjectKeyGetter(t.property)},e.createObjectGetter=function(t){var e=this;switch(t.type){case"Identifier":return function(){return e.getScopeDataFromName(t.name,e.getCurrentScope())};case"MemberExpression":return this.createClosure(t.object);default:throw this.createInternalThrowError(Ht.AssignmentTypeSyntaxError,t.type,t)}},e.createNameGetter=function(t){switch(t.type){case"Identifier":return function(){return t.name};case"MemberExpression":return this.createMemberKeyGetter(t);default:throw this.createInternalThrowError(Ht.AssignmentTypeSyntaxError,t.type,t)}},e.varDeclaration=function(t){this.collectDeclVars[t]=void 0},e.funcDeclaration=function(t,e){this.collectDeclFuncs[t]=e},e.addDeclarationsToScope=function(t,e,n){var r=n.data;for(var i in e){var o=e[i];r[i]=o?o():o}for(var a in t)a in r||(r[a]=void 0)},e.getScopeValue=function(t,e){return this.getScopeFromName(t,e).data[t]},e.getScopeDataFromName=function(t,e){return this.getScopeFromName(t,e).data},e.getScopeFromName=function(t,e){var n=e;do{if(t in n.data)return n}while(n=n.parent);return this.globalScope},e.setValue=function(t){var e=this.callStack.length;return this.isVarDeclMode||e||t===te||t===Qt||t===Jt||t instanceof ce||t instanceof he||(this.value=t instanceof le?t.value:t),t},e.getValue=function(){return this.value},t}();function ye(t){return void 0===t&&(t=Object.create(null)),t}function ve(t,e,n){void 0===e&&(e=[]),void 0===n&&(n={});var r=n.parsingContext,i=void 0===n.timeout?0:n.timeout,o="\n    (function anonymous("+e.join(",")+"){\n         "+t+"\n    });\n    ";return new ge(r,{ecmaVersion:n.ecmaVersion,timeout:i,rootContext:n.rootContext,globalContextInFunction:n.globalContextInFunction}).evaluate(o)}function _e(t,e,n){return new ge(e,n).evaluate(t)}ge.version="0.0.3",ge.eval=se,ge.Function=ue,ge.ecmaVersion=5,ge.globalContextInFunction=void 0,ge.global=Object.create(null);var xe=_e,be=function(){function t(t){this._code=t}var e=t.prototype;return e.runInContext=function(t){return _e(this._code,t)},e.runInNewContext=function(t){return _e(this._code,t)},t}();const we=function(t,e,n){return _e(t,e,n)};function Se(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.pop();return ve(r||"",e)}const Ee=we},9315:(t,e,n)=>{var r;!function(i,o,a,s){"use strict";var u,l="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,c="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),h=l||c,p=["","webkit","Moz","MS","ms","o"],f=h?"":o.createElement("div"),d=Math.round,m=Math.abs,g=Date.now;function y(t,e,n){return setTimeout(E(t,n),e)}function v(t,e,n){return!!Array.isArray(t)&&(_(t,n[e],n),!0)}function _(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==s)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function x(t,e,n){var r="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=i.console&&(i.console.warn||i.console.log);return o&&o.call(i.console,r,n),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}:Object.assign;var b=x((function(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;)(!n||n&&t[r[i]]===s)&&(t[r[i]]=e[r[i]]),i++;return t}),"extend","Use `assign`."),w=x((function(t,e){return b(t,e,!0)}),"merge","Use `assign`.");function S(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&u(r,n)}function E(t,e){return function(){return t.apply(e,arguments)}}function C(t,e){return"function"==typeof t?t.apply(e&&e[0]||s,e):t}function M(t,e){return t===s?e:t}function T(t,e,n){_(I(e),(function(e){t.addEventListener(e,n,!1)}))}function A(t,e,n){_(I(e),(function(e){t.removeEventListener(e,n,!1)}))}function P(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function L(t,e){return t.indexOf(e)>-1}function I(t){return t.trim().split(/\s+/g)}function k(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function O(t){return Array.prototype.slice.call(t,0)}function R(t,e,n){for(var r=[],i=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];k(i,a)<0&&r.push(t[o]),i[o]=a,o++}return n&&(r=e?r.sort((function(t,n){return t[e]>n[e]})):r.sort()),r}function D(t,e){for(var n,r,i=e[0].toUpperCase()+e.slice(1),o=0;o<p.length;){if((r=(n=p[o])?n+i:e)in t)return r;o++}return s}var N=1;function F(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||i}var z="ontouchstart"in i,B=D(i,"PointerEvent")!==s,j=z&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),U="touch",Z="mouse",V=["x","y"],G=["clientX","clientY"];function H(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){C(t.options.enable,[t])&&n.handler(e)},this.init()}function W(t,e,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&e&&r-i==0,a=12&e&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,r=e.pointers,i=r.length;n.firstInput||(n.firstInput=q(e)),i>1&&!n.firstMultiple?n.firstMultiple=q(e):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,u=a?a.center:o.center,l=e.center=X(r);e.timeStamp=g(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=J(u,l),e.distance=Q(u,l),function(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},o=t.prevInput||{};1!==e.eventType&&4!==o.eventType||(i=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}(n,e),e.offsetDirection=K(e.deltaX,e.deltaY);var c,h,p=Y(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=p.x,e.overallVelocityY=p.y,e.overallVelocity=m(p.x)>m(p.y)?p.x:p.y,e.scale=a?(c=a.pointers,Q((h=r)[0],h[1],G)/Q(c[0],c[1],G)):1,e.rotation=a?function(t,e){return J(e[1],e[0],G)+J(t[1],t[0],G)}(a.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,r,i,o,a=t.lastInterval||e,u=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(u>25||a.velocity===s)){var l=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,h=Y(u,l,c);r=h.x,i=h.y,n=m(h.x)>m(h.y)?h.x:h.y,o=K(l,c),t.lastInterval=e}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=r,e.velocityY=i,e.direction=o}(n,e);var f=t.element;P(e.srcEvent.target,f)&&(f=e.srcEvent.target),e.target=f}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function q(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:d(t.pointers[n].clientX),clientY:d(t.pointers[n].clientY)},n++;return{timeStamp:g(),pointers:e,center:X(e),deltaX:t.deltaX,deltaY:t.deltaY}}function X(t){var e=t.length;if(1===e)return{x:d(t[0].clientX),y:d(t[0].clientY)};for(var n=0,r=0,i=0;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:d(n/e),y:d(r/e)}}function Y(t,e,n){return{x:e/t||0,y:n/t||0}}function K(t,e){return t===e?1:m(t)>=m(e)?t<0?2:4:e<0?8:16}function Q(t,e,n){n||(n=V);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function J(t,e,n){n||(n=V);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}H.prototype={handler:function(){},init:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(F(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(F(this.element),this.evWin,this.domHandler)}};var $={mousedown:1,mousemove:2,mouseup:4},tt="mousedown",et="mousemove mouseup";function nt(){this.evEl=tt,this.evWin=et,this.pressed=!1,H.apply(this,arguments)}S(nt,H,{handler:function(t){var e=$[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:Z,srcEvent:t}))}});var rt={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},it={2:U,3:"pen",4:Z,5:"kinect"},ot="pointerdown",at="pointermove pointerup pointercancel";function st(){this.evEl=ot,this.evWin=at,H.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}h||!i.MSPointerEvent||i.PointerEvent||(ot="MSPointerDown",at="MSPointerMove MSPointerUp MSPointerCancel"),S(st,H,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=rt[r],o=it[t.pointerType]||t.pointerType,a=o==U,s=k(e,t.pointerId,"pointerId");1&i&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):12&i&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(s,1))}});var ut={touchstart:1,touchmove:2,touchend:4,touchcancel:8},lt="touchstart",ct="touchstart touchmove touchend touchcancel";function ht(){this.evTarget=lt,this.evWin=ct,this.started=!1,H.apply(this,arguments)}function pt(t,e){var n=O(t.touches),r=O(t.changedTouches);return 12&e&&(n=R(n.concat(r),"identifier",!0)),[n,r]}S(ht,H,{handler:function(t){var e=ut[t.type];if(1===e&&(this.started=!0),this.started){var n=pt.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:U,srcEvent:t})}}});var ft={touchstart:1,touchmove:2,touchend:4,touchcancel:8},dt="touchstart touchmove touchend touchcancel";function mt(){this.evTarget=dt,this.targetIds={},H.apply(this,arguments)}function gt(t,e){var n=O(t.touches),r=this.targetIds;if(3&e&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=O(t.changedTouches),s=[],u=this.target;if(o=n.filter((function(t){return P(t.target,u)})),1===e)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&e&&delete r[a[i].identifier],i++;return s.length?[R(o.concat(s),"identifier",!0),s]:void 0}function yt(){H.apply(this,arguments);var t=E(this.handler,this);this.touch=new mt(this.manager,t),this.mouse=new nt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function vt(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,_t.call(this,e)):12&t&&_t.call(this,e)}function _t(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)}),2500)}}function xt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(e-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}S(mt,H,{handler:function(t){var e=ft[t.type],n=gt.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:U,srcEvent:t})}}),S(yt,H,{handler:function(t,e,n){var r=n.pointerType==U,i=n.pointerType==Z;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)vt.call(this,e,n);else if(i&&xt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var bt=h?s:D(f.style,"touchAction"),wt=bt!==s,St="compute",Et="auto",Ct="manipulation",Mt="none",Tt="pan-x",At="pan-y",Pt=function(){if(!wt)return!1;var t={};if(h)return t;var e=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||i.CSS.supports("touch-action",n)})),t}();function Lt(t,e){this.manager=t,this.set(e)}Lt.prototype={set:function(t){t==St&&(t=this.compute()),wt&&this.manager.element.style&&Pt[t]&&(this.manager.element.style[bt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return _(this.manager.recognizers,(function(e){C(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(L(t,Mt))return Mt;var e=L(t,Tt),n=L(t,At);return e&&n?Mt:e||n?e?Tt:At:L(t,Ct)?Ct:Et}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,i=L(r,Mt)&&!Pt.none,o=L(r,At)&&!Pt["pan-y"],a=L(r,Tt)&&!Pt["pan-x"];if(i){var s=1===t.pointers.length,u=t.distance<2,l=t.deltaTime<250;if(s&&u&&l)return}if(!a||!o)return i||o&&6&n||a&&24&n?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var It=32;function kt(t){this.options=u({},this.defaults,t||{}),this.id=N++,this.manager=null,this.options.enable=M(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Ot(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function Rt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Dt(t,e){var n=e.manager;return n?n.get(t):t}function Nt(){kt.apply(this,arguments)}function Ft(){Nt.apply(this,arguments),this.pX=null,this.pY=null}function zt(){Nt.apply(this,arguments)}function Bt(){kt.apply(this,arguments),this._timer=null,this._input=null}function jt(){Nt.apply(this,arguments)}function Ut(){Nt.apply(this,arguments)}function Zt(){kt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Vt(t,e){return(e=e||{}).recognizers=M(e.recognizers,Vt.defaults.preset),new Gt(t,e)}function Gt(t,e){this.options=u({},Vt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new(this.options.inputClass||(B?st:j?mt:z?yt:nt))(this,W),this.touchAction=new Lt(this,this.options.touchAction),Ht(this,!0),_(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Ht(t,e){var n,r=t.element;r.style&&(_(t.options.cssProps,(function(i,o){n=D(r.style,o),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}kt.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(v(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Dt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return v(t,"dropRecognizeWith",this)||(t=Dt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(v(t,"requireFailure",this))return this;var e=this.requireFail;return-1===k(e,t=Dt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(v(t,"dropRequireFailure",this))return this;t=Dt(t,this);var e=k(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<8&&r(e.options.event+Ot(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=8&&r(e.options.event+Ot(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=It},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!C(this.options.enable,[this,e]))return this.reset(),void(this.state=It);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},S(Nt,kt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=6&e,i=this.attrTest(t);return r&&(8&n||!i)?16|e:r||i?4&n?8|e:2&e?4|e:2:It}}),S(Ft,Nt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(At),24&t&&e.push(Tt),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,o=t.deltaX,a=t.deltaY;return i&e.direction||(6&e.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(t.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return Nt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Rt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),S(zt,Nt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Mt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),S(Bt,kt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Et]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||12&t.eventType&&!i)this.reset();else if(1&t.eventType)this.reset(),this._timer=y((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return It},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=g(),this.manager.emit(this.options.event,this._input)))}}),S(jt,Nt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Mt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),S(Ut,Nt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Ft.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:24&n&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&m(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=Rt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),S(Zt,kt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ct]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=t.eventType)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||Q(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=y((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return It},failTimeout:function(){return this._timer=y((function(){this.state=It}),this.options.interval,this),It},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Vt.VERSION="2.0.7",Vt.defaults={domEvents:!1,touchAction:St,enable:!0,inputTarget:null,inputClass:null,preset:[[jt,{enable:!1}],[zt,{enable:!1},["rotate"]],[Ut,{direction:6}],[Ft,{direction:6},["swipe"]],[Zt],[Zt,{event:"doubletap",taps:2},["tap"]],[Bt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Gt.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var r=this.recognizers,i=e.curRecognizer;(!i||i&&8&i.state)&&(i=e.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===e.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&14&n.state&&(i=e.curRecognizer=n),o++}},get:function(t){if(t instanceof kt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(v(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(v(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=k(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var n=this.handlers;return _(I(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==s){var n=this.handlers;return _(I(t),(function(t){e?n[t]&&n[t].splice(k(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){if(!h){var n=o.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](e),r++}},destroy:function(){this.element&&Ht(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h||(u(Vt,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:It,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Gt,Input:H,TouchAction:Lt,TouchInput:mt,MouseInput:nt,PointerEventInput:st,TouchMouseInput:yt,SingleTouchInput:ht,Recognizer:kt,AttrRecognizer:Nt,Tap:Zt,Pan:Ft,Swipe:Ut,Pinch:zt,Rotate:jt,Press:Bt,on:T,off:A,each:_,merge:w,extend:b,assign:u,inherit:S,bindFn:E,prefixed:D}),("undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Hammer=Vt,(r=function(){return Vt}.call(e,n,e,t))===s||(t.exports=r))}("undefined"!=typeof window?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document)},5499:function(t,e,n){t.exports=function(t){"use strict";var e=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},n=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},r="\n";function i(t){var e=new Error("(regl) "+t);throw console.error(e),e}function o(t,e){t||i(e)}function a(t){return t?": "+t:""}function s(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function u(t,e,n){e.indexOf(t)<0&&i("invalid value"+a(n)+". must be one of: "+e)}var l=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(t,e){for(t+="";t.length<e;)t=" "+t;return t}function h(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function p(t,e){this.number=t,this.line=e,this.errors=[]}function f(t,e,n){this.file=t,this.line=e,this.message=n}function d(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function m(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function g(t,e){var n,r=t.split("\n"),i=1,o=0,a={unknown:new h,0:new h};a.unknown.name=a[0].name=e||d(),a.unknown.lines.push(new p(0,""));for(var s=0;s<r.length;++s){var u=r[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(i=0|c[1],c[2]&&((o=0|c[2])in a||(a[o]=new h)));break;case"define":var f=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);f&&(a[o].name=f[1]?(n=f[2],"undefined"!=typeof atob?atob(n):"base64:"+n):f[2])}a[o].lines.push(new p(i++,u))}return Object.keys(a).forEach((function(t){var e=a[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),a}function y(t){t._commandRef=d()}function v(t,e){var n=m();i(t+" in command "+(e||d())+("unknown"===n?"":" called from "+n))}function _(t,e,n,r){s(t,e)||v("invalid parameter type"+a(n)+". expected "+e+", got "+typeof t,r||d())}var x=33071,b={};function w(t,e){return 32820===t||32819===t||33635===t?2:34042===t?4:b[t]*e}function S(t){return!(t&t-1||!t)}b[5120]=b[5121]=1,b[5122]=b[5123]=b[36193]=b[33635]=b[32819]=b[32820]=2,b[5124]=b[5125]=b[5126]=b[34042]=4;var E=n(o,{optional:function(t){t()},raise:i,commandRaise:v,command:function(t,e,n){t||v(e,n||d())},parameter:function(t,e,n){t in e||i("unknown parameter ("+t+")"+a(n)+". possible values: "+Object.keys(e).join())},commandParameter:function(t,e,n,r){t in e||v("unknown parameter ("+t+")"+a(n)+". possible values: "+Object.keys(e).join(),r||d())},constructor:function(t){Object.keys(t).forEach((function(t){l.indexOf(t)<0&&i('invalid regl constructor argument "'+t+'". must be one of '+l)}))},type:function(t,e,n){s(t,e)||i("invalid parameter type"+a(n)+". expected "+e+", got "+typeof t)},commandType:_,isTypedArray:function(t,n){e(t)||i("invalid parameter type"+a(n)+". must be a typed array")},nni:function(t,e){t>=0&&(0|t)===t||i("invalid parameter type, ("+t+")"+a(e)+". must be a nonnegative integer")},oneOf:u,shaderError:function(t,e,n,i,a){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var s=t.getShaderInfoLog(e),u=i===t.FRAGMENT_SHADER?"fragment":"vertex";_(n,"string",u+" shader source must be a string",a);var l=g(n,a),h=function(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new f(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new f("unknown",0,t))}})),e}(s);(function(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))})(l,h),Object.keys(l).forEach((function(t){var e=l[t];if(e.hasErrors){var n=[""],i=[""];o("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){o(c(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(t.line+r,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(n){var i=n.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),e=Math.max(t.line.indexOf(s,e),0)}else e=0;o(c("| ",6)),o(c("^^^",e+3)+r,"font-weight:bold"),o(c("| ",6)),o(i+r,"font-weight:bold")})),o(c("| ",6)+r)}else o(c(t.number,4)+"|  "),o(t.line+r,"color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(i[0]=n.join("%c"),console.log.apply(console,i))}function o(t,e){n.push(t),i.push(e||"")}})),o.raise("Error compiling "+u+" shader, "+l[0].name)}},linkError:function(t,e,n,i,a){if(!t.getProgramParameter(e,t.LINK_STATUS)){var s=t.getProgramInfoLog(e),u=g(n,a),l='Error linking program with vertex shader, "'+g(i,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+l+"\n%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(l+r+s),o.raise(l)}},callSite:m,saveCommandRef:y,saveDrawInfo:function(t,e,n,r){function i(t){return t?r.id(t):0}function o(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}y(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var a=t._uniformSet={};o(a,e.static),o(a,e.dynamic);var s=t._attributeSet={};o(s,n.static),o(s,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic},framebufferFormat:function(t,e,n){t.texture?u(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):u(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(t,e,n){var r,i=e.width,a=e.height,s=e.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),t.wrapS===x&&t.wrapT===x||o(S(i)&&S(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==a&&o(9984!==t.minFilter&&9986!==t.minFilter&&9985!==t.minFilter&&9987!==t.minFilter,"min filter requires mipmap"):(o(S(i)&&S(a),"texture must be a square power of 2 to support mipmapping"),o(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),5126===e.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&o(9728===t.minFilter&&9728===t.magFilter,"filter not supported, must enable oes_texture_float_linear"),o(!t.genMipmaps,"mipmap generation not supported with float textures"));var u=e.images;for(r=0;r<16;++r)if(u[r]){var l=i>>r,c=a>>r;o(e.mipmask&1<<r,"missing mipmap data");var h=u[r];if(o(h.width===l&&h.height===c,"invalid shape for mip images"),o(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed);else if(h.data){var p=Math.ceil(w(h.type,s)*l/h.unpackAlignment)*h.unpackAlignment;o(h.data.byteLength===p*c,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else t.genMipmaps||o(0==(e.mipmask&1<<r),"extra mipmap data");e.compressed&&o(!t.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(t,e,n,r){var i=t.width,a=t.height,s=t.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(e.wrapS===x&&e.wrapT===x,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];o(l.width===i&&l.height===a,"inconsistent cube map face shape"),e.genMipmaps&&(o(!l.compressed,"can not generate mipmap for compressed textures"),o(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,h=0;h<16;++h){var p=c[h];if(p){var f=i>>h,d=a>>h;o(l.mipmask&1<<h,"missing mipmap data"),o(p.width===f&&p.height===d,"invalid shape for mip images"),o(p.format===t.format&&p.internalformat===t.internalformat&&p.type===t.type,"incompatible type for mip image"),p.compressed||(p.data?o(p.data.byteLength===f*d*Math.max(w(p.type,s),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):p.element||p.copy)}}}}}),C=0;function M(t,e){this.id=C++,this.type=t,this.data=e}function T(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function A(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+T(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return A(t.substr(0,r.index)).concat(A(r[1])).concat(A(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+T(t)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(A(i[a]));return o}function P(t){return"["+A(t).join("][")+"]"}var L={DynamicVariable:M,define:function(t,e){return new M(t,P(e+""))},isDynamic:function(t){return"function"==typeof t&&!t._reglType||t instanceof M},unbox:function t(e,n){return"function"==typeof e?new M(0,e):"number"==typeof e||"boolean"==typeof e?new M(5,e):Array.isArray(e)?new M(6,e.map((function(e,r){return t(e,n+"["+r+"]")}))):e instanceof M?e:void E(!1,"invalid option type in uniform "+n)},accessor:P},I={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},k="undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?function(){return+new Date}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function O(t){return"string"==typeof t?t.split():(E(Array.isArray(t),"invalid extension array"),t)}function R(t){return"string"==typeof t?(E("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function D(t){var e,r,i,o,a,s=t||{},u={},l=[],c=[],h="undefined"==typeof window?1:window.devicePixelRatio,p=!1,f=function(t){t&&E.raise(t)},d=function(){};if("string"==typeof s?(E("undefined"!=typeof document,"selector queries only supported in DOM environments"),e=document.querySelector(s),E(e,"invalid query string for element")):"object"==typeof s?"string"==typeof(a=s).nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?e=s:function(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}(s)?i=(o=s).canvas:(E.constructor(s),"gl"in s?o=s.gl:"canvas"in s?i=R(s.canvas):"container"in s&&(r=R(s.container)),"attributes"in s&&(u=s.attributes,E.type(u,"object","invalid context attributes")),"extensions"in s&&(l=O(s.extensions)),"optionalExtensions"in s&&(c=O(s.optionalExtensions)),"onDone"in s&&(E.type(s.onDone,"function","invalid or missing onDone callback"),f=s.onDone),"profile"in s&&(p=!!s.profile),"pixelRatio"in s&&(h=+s.pixelRatio,E(h>0,"invalid pixel ratio"))):E.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?i=e:r=e),!o){if(!i){E("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var m=function(t,e,r){var i,o=document.createElement("canvas");function a(){var e=window.innerWidth,n=window.innerHeight;if(t!==document.body){var i=o.getBoundingClientRect();e=i.right-i.left,n=i.bottom-i.top}o.width=r*e,o.height=r*n}return n(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),t.appendChild(o),t===document.body&&(o.style.position="absolute",n(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(t):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),t.removeChild(o)}}}(r||document.body,0,h);if(!m)return null;i=m.canvas,d=m.onDestroy}void 0===u.premultipliedAlpha&&(u.premultipliedAlpha=!0),o=function(t,e){function n(n){try{return t.getContext(n,e)}catch(t){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,u)}return o?{gl:o,canvas:i,container:r,extensions:l,optionalExtensions:c,pixelRatio:h,profile:p,onDone:f,onDestroy:d}:(d(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function N(t,e){var n={};function r(e){E.type(e,"string","extension name must be string");var r,i=e.toLowerCase();try{r=n[i]=function(e){return t.getExtension(e)?t.getExtension(e):t.getExtension(e.toLowerCase())?t.getExtension(e.toLowerCase()):null}(e)}catch(t){}return!!r}for(var i=0;i<e.extensions.length;++i){var o=e.extensions[i];if(!r(o))return e.onDestroy(),e.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}function F(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}function z(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function B(){var t=F(8,(function(){return[]}));function e(e){var n=function(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}(e),r=t[z(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[z(e.byteLength)>>2].push(e)}return{alloc:e,free:n,allocType:function(t,n){var r=null;switch(t){case 5120:r=new Int8Array(e(n),0,n);break;case 5121:r=new Uint8Array(e(n),0,n);break;case 5122:r=new Int16Array(e(2*n),0,n);break;case 5123:r=new Uint16Array(e(2*n),0,n);break;case 5124:r=new Int32Array(e(4*n),0,n);break;case 5125:r=new Uint32Array(e(4*n),0,n);break;case 5126:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(t){n(t.buffer)}}}var j=B();j.zero=B();var U=3553,Z=6408,V=5126,G=36160;function H(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var W=function(t){return Object.keys(t).map((function(e){return t[e]}))},q={shape:function(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e},flatten:function(t,e,n,r){var i=1;if(e.length)for(var o=0;o<e.length;++o)i*=e[o];else i=0;var a=r||j.allocType(n,i);switch(e.length){case 0:break;case 1:!function(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}(t,e[0],a);break;case 2:!function(t,e,n,r){for(var i=0,o=0;o<e;++o)for(var a=t[o],s=0;s<n;++s)r[i++]=a[s]}(t,e[0],e[1],a);break;case 3:X(t,e[0],e[1],e[2],a,0);break;default:Y(t,e,0,a,0)}return a}};function X(t,e,n,r,i,o){for(var a=o,s=0;s<e;++s)for(var u=t[s],l=0;l<n;++l)for(var c=u[l],h=0;h<r;++h)i[a++]=c[h]}function Y(t,e,n,r,i){for(var o=1,a=n+1;a<e.length;++a)o*=e[a];var s=e[n];if(e.length-n==4){var u=e[n+1],l=e[n+2],c=e[n+3];for(a=0;a<s;++a)X(t[a],u,l,c,r,i),i+=o}else for(a=0;a<s;++a)Y(t[a],e,n+1,r,i),i+=o}var K={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Q={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},J={dynamic:35048,stream:35040,static:35044},$=q.flatten,tt=q.shape,et=5121,nt=5126,rt=[];function it(t){return 0|K[Object.prototype.toString.call(t)]}function ot(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function at(t,e,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)t[s++]=e[i*u+o*l+a]}rt[5120]=1,rt[5122]=2,rt[5124]=4,rt[5121]=1,rt[5123]=2,rt[5125]=4,rt[5126]=4;var st={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ut=5121,lt=5123,ct=5125,ht=34963;var pt=new Float32Array(1),ft=new Uint32Array(pt.buffer);function dt(t){for(var e=j.allocType(5123,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{pt[0]=t[n];var r=ft[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)e[n]=i;else if(o<-14){var s=-14-o;e[n]=i+(a+1024>>s)}else e[n]=o>15?i+31744:i+(o+15<<10)+a}return e}function mt(t){return Array.isArray(t)||e(t)}var gt=function(t){return!(t&t-1||!t)},yt=3553,vt=34067,_t=34069,xt=6408,bt=6406,wt=6407,St=6409,Et=6410,Ct=32855,Mt=6402,Tt=34041,At=35904,Pt=35906,Lt=36193,It=33776,kt=33777,Ot=33778,Rt=33779,Dt=5121,Nt=5123,Ft=5125,zt=5126,Bt=33071,jt=9728,Ut=9984,Zt=9987,Vt=4352,Gt=33984,Ht=[Ut,9986,9985,Zt],Wt=[0,St,Et,wt,xt],qt={};function Xt(t){return"[object "+t+"]"}qt[6409]=qt[6406]=qt[6402]=1,qt[34041]=qt[6410]=2,qt[6407]=qt[35904]=3,qt[6408]=qt[35906]=4;var Yt=Xt("HTMLCanvasElement"),Kt=Xt("OffscreenCanvas"),Qt=Xt("CanvasRenderingContext2D"),Jt=Xt("ImageBitmap"),$t=Xt("HTMLImageElement"),te=Xt("HTMLVideoElement"),ee=Object.keys(K).concat([Yt,Kt,Qt,Jt,$t,te]),ne=[];ne[5121]=1,ne[5126]=4,ne[36193]=2,ne[5123]=2,ne[5125]=4;var re=[];function ie(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function oe(t){return!!Array.isArray(t)&&!(0===t.length||!mt(t[0]))}function ae(t){return Object.prototype.toString.call(t)}function se(t){return ae(t)===Yt}function ue(t){return ae(t)===Kt}function le(t){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&t&&t.getContext)}function ce(t){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&t&&"src"in t&&"crossOrigin"in t)}function he(t){if(!t)return!1;if(le(t)||ce(t))return!0;var e=ae(t);return ee.indexOf(e)>=0||ie(t)||oe(t)||H(t)}function pe(t){return 0|K[Object.prototype.toString.call(t)]}function fe(t,e){return j.allocType(t.type===Lt?zt:t.type,e)}function de(t,e){t.type===Lt?(t.data=dt(e),j.freeType(e)):t.data=e}function me(t,e,n,r,i,o){var a;if(a=void 0!==re[t]?re[t]:qt[t]*ne[e],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function ge(t,r,i,o,a,s,u){var l={"don't care":Vt,"dont care":Vt,nice:4354,fast:4353},c={repeat:10497,clamp:Bt,mirror:33648},h={nearest:jt,linear:9729},p=n({mipmap:Zt,"nearest mipmap nearest":Ut,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":Zt},h),f={none:0,browser:37444},d={uint8:Dt,rgba4:32819,rgb565:33635,"rgb5 a1":32820},m={alpha:bt,luminance:St,"luminance alpha":Et,rgb:wt,rgba:xt,rgba4:32854,"rgb5 a1":Ct,rgb565:36194},g={};r.ext_srgb&&(m.srgb=At,m.srgba=Pt),r.oes_texture_float&&(d.float32=d.float=zt),r.oes_texture_half_float&&(d.float16=d["half float"]=Lt),r.webgl_depth_texture&&(n(m,{depth:Mt,"depth stencil":Tt}),n(d,{uint16:Nt,uint32:Ft,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&n(g,{"rgb s3tc dxt1":It,"rgba s3tc dxt1":kt,"rgba s3tc dxt3":Ot,"rgba s3tc dxt5":Rt}),r.webgl_compressed_texture_atc&&n(g,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&n(g,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=36196);var y=Array.prototype.slice.call(t.getParameter(34467)||new Uint32Array(0));Object.keys(g).forEach((function(t){var e=g[t];y.indexOf(e)>=0&&(m[t]=e)}));var v=Object.keys(m);i.textureFormats=v;var _=[];Object.keys(m).forEach((function(t){var e=m[t];_[e]=t}));var x=[];Object.keys(d).forEach((function(t){var e=d[t];x[e]=t}));var b=[];Object.keys(h).forEach((function(t){b[h[t]]=t}));var w=[];Object.keys(p).forEach((function(t){var e=p[t];w[e]=t}));var S=[];Object.keys(c).forEach((function(t){S[c[t]]=t}));var C=v.reduce((function(t,e){var n=m[e];return n===St||n===bt||n===St||n===Et||n===Mt||n===Tt||r.ext_srgb&&(n===At||n===Pt)?t[n]=n:n===Ct||e.indexOf("rgba")>=0?t[n]=xt:t[n]=wt,t}),{});function M(){this.internalformat=xt,this.format=xt,this.type=Dt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function T(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function A(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(E.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(E.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(E.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(E.parameter(e.colorSpace,f,"invalid colorSpace"),t.colorSpace=f[e.colorSpace]),"type"in e){var n=e.type;E(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),E(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),E(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),E.parameter(n,d,"invalid texture type"),t.type=d[n]}var o=t.width,a=t.height,s=t.channels,u=!1;"shape"in e?(E(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),o=e.shape[0],a=e.shape[1],3===e.shape.length&&(s=e.shape[2],E(s>0&&s<=4,"invalid number of channels"),u=!0),E(o>=0&&o<=i.maxTextureSize,"invalid width"),E(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in e&&(o=a=e.radius,E(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in e&&(o=e.width,E(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in e&&(a=e.height,E(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in e&&(s=e.channels,E(s>0&&s<=4,"invalid number of channels"),u=!0)),t.width=0|o,t.height=0|a,t.channels=0|s;var l=!1;if("format"in e){var c=e.format;E(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),E.parameter(c,m,"invalid texture format");var h=t.internalformat=m[c];t.format=C[h],c in d&&("type"in e||(t.type=d[c])),c in g&&(t.compressed=!0),l=!0}!u&&l?t.channels=qt[t.format]:u&&!l?t.channels!==Wt[t.format]&&(t.format=t.internalformat=Wt[t.channels]):l&&u&&E(t.channels===qt[t.format],"number of channels inconsistent with specified format")}}function P(e){t.pixelStorei(37440,e.flipY),t.pixelStorei(37441,e.premultiplyAlpha),t.pixelStorei(37443,e.colorSpace),t.pixelStorei(3317,e.unpackAlignment)}function L(){M.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(t,n){var r=null;if(he(n)?r=n:n&&(E.type(n,"object","invalid pixel data type"),A(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),he(n.data)&&(r=n.data)),E(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){E(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,E(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Dt||(t.type=pe(r));else if(ie(r))t.channels=t.channels||4,function(t,e){var n=e.length;switch(t.type){case Dt:case Nt:case Ft:case zt:var r=j.allocType(t.type,n);r.set(e),t.data=r;break;case Lt:t.data=dt(e);break;default:E.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(H(r)){var u=r.data;Array.isArray(u)||t.type!==Dt||(t.type=pe(u));var l,c,h,p,f,d,m=r.shape,g=r.stride;3===m.length?(h=m[2],d=g[2]):(E(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),l=m[0],c=m[1],p=g[0],f=g[1],t.alignment=1,t.width=l,t.height=c,t.channels=h,t.format=t.internalformat=Wt[h],t.needsFree=!0,function(t,e,n,r,i,o){for(var a=t.width,s=t.height,u=t.channels,l=fe(t,a*s*u),c=0,h=0;h<s;++h)for(var p=0;p<a;++p)for(var f=0;f<u;++f)l[c++]=e[n*p+r*h+i*f+o];de(t,l)}(t,u,p,f,d,r.offset)}else if(le(r)||se(r)||ue(r)||ae(r)===Qt)le(r)||se(r)||ue(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(t){return ae(t)===Jt}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(t){return ae(t)===$t}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(ce(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(t){return ae(t)===te}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(oe(r)){var y=t.width||r[0].length,v=t.height||r.length,_=t.channels;_=mt(r[0][0])?_||r[0][0].length:_||1;for(var x=q.shape(r),b=1,w=0;w<x.length;++w)b*=x[w];var S=fe(t,b);q.flatten(r,x,"",S),de(t,S),t.alignment=1,t.width=y,t.height=v,t.channels=_,t.format=t.internalformat=Wt[_],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===zt?E(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Lt&&E(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function k(e,n,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,l=e.type,c=e.width,h=e.height;P(e),i?t.texImage2D(n,r,u,u,l,i):e.compressed?t.compressedTexImage2D(n,r,s,c,h,0,a):e.needsCopy?(o(),t.copyTexImage2D(n,r,u,e.xOffset,e.yOffset,c,h,0)):t.texImage2D(n,r,u,c,h,0,u,l,a||null)}function O(e,n,r,i,a){var s=e.element,u=e.data,l=e.internalformat,c=e.format,h=e.type,p=e.width,f=e.height;P(e),s?t.texSubImage2D(n,a,r,i,c,h,s):e.compressed?t.compressedTexSubImage2D(n,a,r,i,l,p,f,u):e.needsCopy?(o(),t.copyTexSubImage2D(n,a,r,i,e.xOffset,e.yOffset,p,f)):t.texSubImage2D(n,a,r,i,p,f,c,h,u)}var R=[];function D(){return R.pop()||new L}function N(t){t.needsFree&&j.freeType(t.data),L.call(t),R.push(t)}function F(){M.call(this),this.genMipmaps=!1,this.mipmapHint=Vt,this.mipmask=0,this.images=Array(16)}function z(t,e,n){var r=t.images[0]=D();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function B(t,e){var n=null;if(he(e))T(n=t.images[0]=D(),t),I(n,e),t.mipmask=1;else if(A(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)T(n=t.images[i]=D(),t),n.width>>=i,n.height>>=i,I(n,r[i]),t.mipmask|=1<<i;else T(n=t.images[0]=D(),t),I(n,e),t.mipmask=1;T(t,t.images[0]),!t.compressed||t.internalformat!==It&&t.internalformat!==kt&&t.internalformat!==Ot&&t.internalformat!==Rt||E(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function U(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;k(n[r],e,r)}}var Z=[];function V(){var t=Z.pop()||new F;M.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function G(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&N(e[n]),e[n]=null;Z.push(t)}function X(){this.minFilter=jt,this.magFilter=jt,this.wrapS=Bt,this.wrapT=Bt,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Vt}function Y(t,e){if("min"in e){var n=e.min;E.parameter(n,p),t.minFilter=p[n],Ht.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;E.parameter(r,h),t.magFilter=h[r]}var o=t.wrapS,a=t.wrapT;if("wrap"in e){var s=e.wrap;"string"==typeof s?(E.parameter(s,c),o=a=c[s]):Array.isArray(s)&&(E.parameter(s[0],c),E.parameter(s[1],c),o=c[s[0]],a=c[s[1]])}else{if("wrapS"in e){var u=e.wrapS;E.parameter(u,c),o=c[u]}if("wrapT"in e){var f=e.wrapT;E.parameter(f,c),a=c[f]}}if(t.wrapS=o,t.wrapT=a,"anisotropic"in e){var d=e.anisotropic;E("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var m=!1;switch(typeof e.mipmap){case"string":E.parameter(e.mipmap,l,"invalid mipmap hint"),t.mipmapHint=l[e.mipmap],t.genMipmaps=!0,m=!0;break;case"boolean":m=t.genMipmaps=e.mipmap;break;case"object":E(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,m=!0;break;default:E.raise("invalid mipmap type")}m&&!("min"in e)&&(t.minFilter=Ut)}}function K(e,n){t.texParameteri(n,10241,e.minFilter),t.texParameteri(n,10240,e.magFilter),t.texParameteri(n,10242,e.wrapS),t.texParameteri(n,10243,e.wrapT),r.ext_texture_filter_anisotropic&&t.texParameteri(n,34046,e.anisotropic),e.genMipmaps&&(t.hint(33170,e.mipmapHint),t.generateMipmap(n))}var Q=0,J={},$=i.maxTextureUnits,tt=Array($).map((function(){return null}));function et(e){M.call(this),this.mipmask=0,this.internalformat=xt,this.id=Q++,this.refCount=1,this.target=e,this.texture=t.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new X,u.profile&&(this.stats={size:0})}function nt(e){t.activeTexture(Gt),t.bindTexture(e.target,e.texture)}function rt(){var e=tt[0];e?t.bindTexture(e.target,e.texture):t.bindTexture(yt,null)}function it(e){var n=e.texture;E(n,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(t.activeTexture(Gt+r),t.bindTexture(i,null),tt[r]=null),t.deleteTexture(n),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete J[e.id],s.textureCount--}return n(et.prototype,{bind:function(){var e=this;e.bindCount+=1;var n=e.unit;if(n<0){for(var r=0;r<$;++r){var i=tt[r];if(i){if(i.bindCount>0)continue;i.unit=-1}tt[r]=e,n=r;break}n>=$&&E.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<n+1&&(s.maxTextureUnits=n+1),e.unit=n,t.activeTexture(Gt+n),t.bindTexture(e.target,e.texture)}return n},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&it(this)}}),u.profile&&(s.getTotalTextureSize=function(){var t=0;return Object.keys(J).forEach((function(e){t+=J[e].stats.size})),t}),{create2D:function(e,n){var r=new et(yt);function o(t,e){var n=r.texInfo;X.call(n);var a=V();return"number"==typeof t?z(a,0|t,"number"==typeof e?0|e:0|t):t?(E.type(t,"object","invalid arguments to regl.texture"),Y(n,t),B(a,t)):z(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,T(r,a),E.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,nt(r),U(a,yt),K(n,yt),rt(),G(a),u.profile&&(r.stats.size=me(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=_[r.internalformat],o.type=x[r.type],o.mag=b[n.magFilter],o.min=w[n.minFilter],o.wrapS=S[n.wrapS],o.wrapT=S[n.wrapT],o}return J[r.id]=r,s.textureCount++,o(e,n),o.subimage=function(t,e,n,i){E(!!t,"must specify image data");var a=0|e,s=0|n,u=0|i,l=D();return T(l,r),l.width=0,l.height=0,I(l,t),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,E(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),E(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),E(r.mipmask&1<<u,"missing mipmap data"),E(l.data||l.element||l.needsCopy,"missing image data"),nt(r),O(l,yt,a,s,u),rt(),N(l),o},o.resize=function(e,n){var i=0|e,a=0|n||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,nt(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=a>>s;if(!l||!c)break;t.texImage2D(yt,s,r.format,l,c,0,r.format,r.type,null)}return rt(),u.profile&&(r.stats.size=me(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,n,r,o,a,l){var c=new et(vt);J[c.id]=c,s.cubeCount++;var h=new Array(6);function p(t,e,n,r,o,a){var s,l=c.texInfo;for(X.call(l),s=0;s<6;++s)h[s]=V();if("number"!=typeof t&&t)if("object"==typeof t)if(e)B(h[0],t),B(h[1],e),B(h[2],n),B(h[3],r),B(h[4],o),B(h[5],a);else if(Y(l,t),A(c,t),"faces"in t){var f=t.faces;for(E(Array.isArray(f)&&6===f.length,"cube faces must be a length 6 array"),s=0;s<6;++s)E("object"==typeof f[s]&&!!f[s],"invalid input for cube map face"),T(h[s],c),B(h[s],f[s])}else for(s=0;s<6;++s)B(h[s],t);else E.raise("invalid arguments to cube map");else{var d=0|t||1;for(s=0;s<6;++s)z(h[s],d,d)}for(T(c,h[0]),E.optional((function(){i.npotTextureCube||E(gt(c.width)&&gt(c.height),"your browser does not support non power or two texture dimensions")})),l.genMipmaps?c.mipmask=(h[0].width<<1)-1:c.mipmask=h[0].mipmask,E.textureCube(c,l,h,i),c.internalformat=h[0].internalformat,p.width=h[0].width,p.height=h[0].height,nt(c),s=0;s<6;++s)U(h[s],_t+s);for(K(l,vt),rt(),u.profile&&(c.stats.size=me(c.internalformat,c.type,p.width,p.height,l.genMipmaps,!0)),p.format=_[c.internalformat],p.type=x[c.type],p.mag=b[l.magFilter],p.min=w[l.minFilter],p.wrapS=S[l.wrapS],p.wrapT=S[l.wrapT],s=0;s<6;++s)G(h[s]);return p}return p(e,n,r,o,a,l),p.subimage=function(t,e,n,r,i){E(!!e,"must specify image data"),E("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=D();return T(u,c),u.width=0,u.height=0,I(u,e),u.width=u.width||(c.width>>s)-o,u.height=u.height||(c.height>>s)-a,E(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),E(o>=0&&a>=0&&o+u.width<=c.width&&a+u.height<=c.height,"texture.subimage write out of bounds"),E(c.mipmask&1<<s,"missing mipmap data"),E(u.data||u.element||u.needsCopy,"missing image data"),nt(c),O(u,_t+t,o,a,s),rt(),N(u),p},p.resize=function(e){var n=0|e;if(n!==c.width){p.width=c.width=n,p.height=c.height=n,nt(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)t.texImage2D(_t+r,i,c.format,n>>i,n>>i,0,c.format,c.type,null);return rt(),u.profile&&(c.stats.size=me(c.internalformat,c.type,p.width,p.height,!1,!0)),p}},p._reglType="textureCube",p._texture=c,u.profile&&(p.stats=c.stats),p.destroy=function(){c.decRef()},p},clear:function(){for(var e=0;e<$;++e)t.activeTexture(Gt+e),t.bindTexture(yt,null),tt[e]=null;W(J).forEach(it),s.cubeCount=0,s.textureCount=0},getTexture:function(t){return null},restore:function(){for(var e=0;e<$;++e){var n=tt[e];n&&(n.bindCount=0,n.unit=-1,tt[e]=null)}W(J).forEach((function(e){e.texture=t.createTexture(),t.bindTexture(e.target,e.texture);for(var n=0;n<32;++n)if(0!=(e.mipmask&1<<n))if(e.target===yt)t.texImage2D(yt,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)t.texImage2D(_t+r,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);K(e.texInfo,e.target)}))},refresh:function(){for(var e=0;e<$;++e){var n=tt[e];n&&(n.bindCount=0,n.unit=-1,tt[e]=null),t.activeTexture(Gt+e),t.bindTexture(yt,null),t.bindTexture(vt,null)}}}}re[32854]=2,re[32855]=2,re[36194]=2,re[34041]=4,re[33776]=.5,re[33777]=.5,re[33778]=1,re[33779]=1,re[35986]=.5,re[35987]=1,re[34798]=1,re[35840]=.5,re[35841]=.25,re[35842]=.5,re[35843]=.25,re[36196]=.5;var ye=36161,ve=32854,_e=[];function xe(t,e,n){return _e[t]*e*n}_e[32854]=2,_e[32855]=2,_e[36194]=2,_e[33189]=2,_e[36168]=1,_e[34041]=4,_e[35907]=4,_e[34836]=16,_e[34842]=8,_e[34843]=6;var be=36160,we=36161,Se=3553,Ee=34069,Ce=[6407,6408],Me=[];Me[6408]=4,Me[6407]=3;var Te=[];Te[5121]=1,Te[5126]=4,Te[36193]=2;var Ae=[32854,32855,36194,35907,34842,34843,34836],Pe={};Pe[36053]="complete",Pe[36054]="incomplete attachment",Pe[36057]="incomplete dimensions",Pe[36055]="incomplete, missing attachment",Pe[36061]="unsupported";var Le=34963,Ie=["attributes","elements","offset","count","primitive","instances"];function ke(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}var Oe=5121,Re=5126;function De(t,n,r,i,o,a,s){function u(u){var l;null===n.next?(E(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=Oe):(E(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,E.optional((function(){a.oes_texture_float?(E(l===Oe||l===Re,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===Re&&E(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):E(l===Oe,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var c=0,h=0,p=i.framebufferWidth,f=i.framebufferHeight,d=null;e(u)?d=u:u&&(E.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,h=0|u.y,E(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),E(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),p=0|(u.width||i.framebufferWidth-c),f=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(l===Oe?E(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===Re&&E(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),E(p>0&&p+c<=i.framebufferWidth,"invalid width for read pixels"),E(f>0&&f+h<=i.framebufferHeight,"invalid height for read pixels"),r();var m=p*f*4;return d||(l===Oe?d=new Uint8Array(m):l===Re&&(d=d||new Float32Array(m))),E.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),E(d.byteLength>=m,"data buffer for regl.read() too small"),t.pixelStorei(3333,4),t.readPixels(c,h,p,f,6408,l,d),d}return function(t){return t&&"framebuffer"in t?function(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=u(t)})),e}(t):u(t)}}function Ne(t){return Array.prototype.slice.call(t)}function Fe(t){return Ne(t).join("")}var ze="xyzw".split(""),Be="dither",je="blend.enable",Ue="blend.color",Ze="blend.equation",Ve="blend.func",Ge="depth.enable",He="depth.func",We="depth.range",qe="depth.mask",Xe="colorMask",Ye="cull.enable",Ke="cull.face",Qe="frontFace",Je="lineWidth",$e="polygonOffset.enable",tn="polygonOffset.offset",en="sample.alpha",nn="sample.enable",rn="sample.coverage",on="stencil.enable",an="stencil.mask",sn="stencil.func",un="stencil.opFront",ln="stencil.opBack",cn="scissor.enable",hn="scissor.box",pn="viewport",fn="profile",dn="framebuffer",mn="vert",gn="frag",yn="elements",vn="primitive",_n="count",xn="offset",bn="instances",wn="vao",Sn="Width",En="Height",Cn=dn+Sn,Mn=dn+En,Tn="drawingBufferWidth",An="drawingBufferHeight",Pn=[Ve,Ze,sn,un,ln,rn,pn,hn,tn],Ln=34962,In=34963,kn=5126,On=35664,Rn=35665,Dn=35666,Nn=5124,Fn=35667,zn=35668,Bn=35669,jn=35670,Un=35671,Zn=35672,Vn=35673,Gn=35674,Hn=35675,Wn=35676,qn=35678,Xn=35680,Yn=1028,Kn=1029,Qn=2305,Jn=7680,$n={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},tr=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],er={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},nr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rr={frag:35632,vert:35633},ir={cw:2304,ccw:Qn};function or(t){return Array.isArray(t)||e(t)||H(t)}function ar(t){return t.sort((function(t,e){return t===pn?-1:e===pn?1:t<e?-1:1}))}function sr(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function ur(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function lr(t){return new sr(!1,!1,!1,t)}function cr(t,e){var n=t.type;if(0===n){var r=t.data.length;return new sr(!0,r>=1,r>=2,e)}if(4===n){var i=t.data;return new sr(i.thisDep,i.contextDep,i.propDep,e)}if(5===n)return new sr(!1,!1,!1,e);if(6===n){for(var o=!1,a=!1,s=!1,u=0;u<t.data.length;++u){var l=t.data[u];if(1===l.type)s=!0;else if(2===l.type)a=!0;else if(3===l.type)o=!0;else if(0===l.type){o=!0;var c=l.data;c>=1&&(a=!0),c>=2&&(s=!0)}else 4===l.type&&(o=o||l.data.thisDep,a=a||l.data.contextDep,s=s||l.data.propDep)}return new sr(o,a,s,e)}return new sr(3===n,2===n,1===n,e)}var hr=new sr(!1,!1,!1,(function(){}));function pr(e,r,i,o,a,s,u,l,c,h,p,f,d,m,g){var y=h.Record,v={add:32774,subtract:32778,"reverse subtract":32779};i.ext_blend_minmax&&(v.min=32775,v.max=32776);var _=i.angle_instanced_arrays,x=i.webgl_draw_buffers,b=i.oes_vertex_array_object,w={dirty:!0,profile:g.profile},S={},C=[],M={},T={};function A(t){return t.replace(".","_")}function P(t,e,n){var r=A(t);C.push(t),S[r]=w[r]=!!n,M[r]=e}function I(t,e,n){var r=A(t);C.push(t),Array.isArray(n)?(w[r]=n.slice(),S[r]=n.slice()):w[r]=S[r]=n,T[r]=e}P(Be,3024),P(je,3042),I(Ue,"blendColor",[0,0,0,0]),I(Ze,"blendEquationSeparate",[32774,32774]),I(Ve,"blendFuncSeparate",[1,0,1,0]),P(Ge,2929,!0),I(He,"depthFunc",513),I(We,"depthRange",[0,1]),I(qe,"depthMask",!0),I(Xe,Xe,[!0,!0,!0,!0]),P(Ye,2884),I(Ke,"cullFace",Kn),I(Qe,Qe,Qn),I(Je,Je,1),P($e,32823),I(tn,"polygonOffset",[0,0]),P(en,32926),P(nn,32928),I(rn,"sampleCoverage",[1,!1]),P(on,2960),I(an,"stencilMask",-1),I(sn,"stencilFunc",[519,0,-1]),I(un,"stencilOpSeparate",[Yn,Jn,Jn,Jn]),I(ln,"stencilOpSeparate",[Kn,Jn,Jn,Jn]),P(cn,3089),I(hn,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),I(pn,pn,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var k={gl:e,context:d,strings:r,next:S,current:w,draw:f,elements:s,buffer:a,shader:p,attributes:h.state,vao:h,uniforms:c,framebuffer:l,extensions:i,timer:m,isBufferArgs:or},O={primTypes:st,compareFuncs:er,blendFuncs:$n,blendEquations:v,stencilOps:nr,glTypes:Q,orientationType:ir};E.optional((function(){k.isArrayLike=mt})),x&&(O.backBuffer=[Kn],O.drawBuffer=F(o.maxDrawbuffers,(function(t){return 0===t?[0]:F(t,(function(t){return 36064+t}))})));var R=0;function D(){var e=function(){var e=0,r=[],i=[];function o(){var t=[],r=[];return n((function(){t.push.apply(t,Ne(arguments))}),{def:function(){var n="v"+e++;return r.push(n),arguments.length>0&&(t.push(n,"="),t.push.apply(t,Ne(arguments)),t.push(";")),n},toString:function(){return Fe([r.length>0?"var "+r.join(",")+";":"",Fe(t)])}})}function a(){var t=o(),e=o(),r=t.toString,i=e.toString;function a(n,r){e(n,r,"=",t.def(n,r),";")}return n((function(){t.apply(t,Ne(arguments))}),{def:t.def,entry:t,exit:e,save:a,set:function(e,n,r){a(e,n),t(e,n,"=",r,";")},toString:function(){return r()+i()}})}var s=o(),u={};return{global:s,link:function(t){for(var n=0;n<i.length;++n)if(i[n]===t)return r[n];var o="g"+e++;return r.push(o),i.push(t),o},block:o,proc:function(t,e){var r=[];function i(){var t="a"+r.length;return r.push(t),t}e=e||0;for(var o=0;o<e;++o)i();var s=a(),l=s.toString;return u[t]=n(s,{arg:i,toString:function(){return Fe(["function(",r.join(),"){",l(),"}"])}})},scope:a,cond:function(){var t=Fe(arguments),e=a(),r=a(),i=e.toString,o=r.toString;return n(e,{then:function(){return e.apply(e,Ne(arguments)),this},else:function(){return r.apply(r,Ne(arguments)),this},toString:function(){var e=o();return e&&(e="else{"+e+"}"),Fe(["if(",t,"){",i(),"}",e])}})},compile:function(){var e=['"use strict";',s,"return {"];Object.keys(u).forEach((function(t){e.push('"',t,'":',u[t].toString(),",")})),e.push("}");var n=Fe(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?t.Function.apply(null,r.concat(n)):Function.apply(null,r.concat(n))).apply(null,i)}}}(),i=e.link,o=e.global;e.id=R++,e.batchId="0";var a=i(k),s=e.shared={props:"a0"};Object.keys(k).forEach((function(t){s[t]=o.def(a,".",t)})),E.optional((function(){e.CHECK=i(E),e.commandStr=E.guessCommand(),e.command=i(e.commandStr),e.assert=function(t,e,n){t("if(!(",e,"))",this.CHECK,".commandRaise(",i(n),",",this.command,");")},O.invalidBlendCombinations=tr}));var u=e.next={},l=e.current={};Object.keys(T).forEach((function(t){Array.isArray(w[t])&&(u[t]=o.def(s.next,".",t),l[t]=o.def(s.current,".",t))}));var c=e.constants={};Object.keys(O).forEach((function(t){c[t]=o.def(JSON.stringify(O[t]))})),e.invoke=function(t,n){switch(n.type){case 0:var r=["this",s.context,s.props,e.batchId];return t.def(i(n.data),".call(",r.slice(0,Math.max(n.data.length+1,4)),")");case 1:return t.def(s.props,n.data);case 2:return t.def(s.context,n.data);case 3:return t.def("this",n.data);case 4:return n.data.append(e,t),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map((function(n){return e.invoke(t,n)}))}},e.attribCache={};var p={};return e.scopeAttrib=function(t){var e=r.id(t);if(e in p)return p[e];var n=h.scope[e];return n||(n=h.scope[e]=new y),p[e]=i(n)},e}function N(t,e,n,u,c){var f=t.static,d=t.dynamic;E.optional((function(){var t=[dn,mn,gn,yn,vn,xn,_n,bn,fn,wn].concat(C);function e(e){Object.keys(e).forEach((function(e){E.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',c.commandStr)}))}e(f),e(d)}));var m=function(t,e){var n=t.static;if("string"==typeof n[gn]&&"string"==typeof n[mn]){if(Object.keys(e.dynamic).length>0)return null;var r=e.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)E("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(t,e),g=function(t,e){var n=t.static,r=t.dynamic;if(dn in n){var i=n[dn];return i?(i=l.getFramebuffer(i),E.command(i,"invalid framebuffer object"),lr((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var o=r.context;return e.set(o,"."+Cn,n+".width"),e.set(o,"."+Mn,n+".height"),n}))):lr((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+Cn,r+"."+Tn),e.set(r,"."+Mn,r+"."+An),"null"}))}if(dn in r){var o=r[dn];return cr(o,(function(t,e){var n=t.invoke(e,o),r=t.shared,i=r.framebuffer,a=e.def(i,".getFramebuffer(",n,")");E.optional((function(){t.assert(e,"!"+n+"||"+a,"invalid framebuffer object")})),e.set(i,".next",a);var s=r.context;return e.set(s,"."+Cn,a+"?"+a+".width:"+s+"."+Tn),e.set(s,"."+Mn,a+"?"+a+".height:"+s+"."+An),a}))}return null}(t),x=function(t,e,n){var r=t.static,i=t.dynamic;function o(t){if(t in r){var o=r[t];E.commandType(o,"object","invalid "+t,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,E.command(a>=0,"invalid "+t,n.commandStr)):u=!1,"height"in o?(s=0|o.height,E.command(s>=0,"invalid "+t,n.commandStr)):u=!1,new sr(!u&&e&&e.thisDep,!u&&e&&e.contextDep,!u&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=a;"width"in o||(r=e.def(n,".",Cn,"-",l));var i=s;return"height"in o||(i=e.def(n,".",Mn,"-",c)),[l,c,r,i]}))}if(t in i){var h=i[t],p=cr(h,(function(e,n){var r=e.invoke(n,h);E.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Cn,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",Mn,"-",a,")");return E.optional((function(){e.assert(n,s+">=0&&"+u+">=0","invalid "+t)})),[o,a,s,u]}));return e&&(p.thisDep=p.thisDep||e.thisDep,p.contextDep=p.contextDep||e.contextDep,p.propDep=p.propDep||e.propDep),p}return e?new sr(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",Cn),e.def(n,".",Mn)]})):null}var a=o(pn);if(a){var s=a;a=new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=s.append(t,e),r=t.shared.context;return e.set(r,".viewportWidth",n[2]),e.set(r,".viewportHeight",n[3]),n}))}return{viewport:a,scissor_box:o(hn)}}(t,g,c),b=function(t,e){var n=t.static,r=t.dynamic,i={},o=!1,a=function(){if(wn in n){var t=n[wn];return null!==t&&null===h.getVAO(t)&&(t=h.createVAO(t)),o=!0,i.vao=t,lr((function(e){var n=h.getVAO(t);return n?e.link(n):"null"}))}if(wn in r){o=!0;var e=r[wn];return cr(e,(function(t,n){var r=t.invoke(n,e);return n.def(t.shared.vao+".getVAO("+r+")")}))}return null}(),u=!1,l=function(){if(yn in n){var t=n[yn];if(i.elements=t,or(t)){var l=i.elements=s.create(t,!0);t=s.getElements(l),u=!0}else t&&(t=s.getElements(t),u=!0,E.command(t,"invalid elements",e.commandStr));var c=lr((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return c.value=t,c}if(yn in r){u=!0;var h=r[yn];return cr(h,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,o=t.invoke(e,h),a=e.def("null"),s=e.def(r,"(",o,")"),u=t.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return E.optional((function(){t.assert(u.else,"!"+o+"||"+a,"invalid elements")})),e.entry(u),e.exit(t.cond(s).then(i,".destroyStream(",a,");")),t.ELEMENTS=a,a}))}return o?new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.elements+".getElements("+t.shared.vao+".currentVAO.elements):null")})):null}();function c(t,s){if(t in n){var l=0|n[t];return s?i.offset=l:i.instances=l,E.command(!s||l>=0,"invalid "+t,e.commandStr),lr((function(t,e){return s&&(t.OFFSET=l),l}))}if(t in r){var c=r[t];return cr(c,(function(e,n){var r=e.invoke(n,c);return s&&(e.OFFSET=r,E.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}if(s){if(u)return lr((function(t,e){return t.OFFSET=0,0}));if(o)return new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.offset:0")}))}else if(o)return new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.instances:-1")}));return null}var p=c(xn,!0),f=function(){if(vn in n){var t=n[vn];return i.primitive=t,E.commandParameter(t,st,"invalid primitve",e.commandStr),lr((function(e,n){return st[t]}))}if(vn in r){var s=r[vn];return cr(s,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,s);return E.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys(st))})),e.def(n,"[",r,"]")}))}return u?ur(l)?l.value?lr((function(t,e){return e.def(t.ELEMENTS,".primType")})):lr((function(){return 4})):new sr(l.thisDep,l.contextDep,l.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",4)})):o?new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.primitive:4")})):null}(),d=function(){if(_n in n){var t=0|n[_n];return i.count=t,E.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),lr((function(){return t}))}if(_n in r){var s=r[_n];return cr(s,(function(t,e){var n=t.invoke(e,s);return E.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(u){if(ur(l)){if(l)return p?new sr(p.thisDep,p.contextDep,p.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return E.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):lr((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var c=lr((function(){return-1}));return E.optional((function(){c.MISSING=!0})),c}var h=new sr(l.thisDep||p.thisDep,l.contextDep||p.contextDep,l.propDep||p.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return E.optional((function(){h.DYNAMIC=!0})),h}if(o){var f=new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){return e.def(t.shared.vao,".currentVAO?",t.shared.vao,".currentVAO.count:-1")}));return f}return null}(),m=c(bn,!1);return{elements:l,primitive:f,count:d,instances:m,offset:p,vao:a,vaoActive:o,elementsActive:u,static:i}}(t,c),w=function(t,e){var n=t.static,r=t.dynamic,i={};return C.forEach((function(t){var a=A(t);function s(e,o){if(t in n){var s=e(n[t]);i[a]=lr((function(){return s}))}else if(t in r){var u=r[t];i[a]=cr(u,(function(t,e){return o(t,e,t.invoke(e,u))}))}}switch(t){case Ye:case je:case Be:case on:case Ge:case cn:case $e:case en:case nn:case qe:return s((function(n){return E.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return E.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case He:return s((function(n){return E.commandParameter(n,er,"invalid "+t,e.commandStr),er[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return E.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(er))})),n.def(i,"[",r,"]")}));case We:return s((function(t){return E.command(mt(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return E.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case Ve:return s((function(t){E.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,o="dstAlpha"in t?t.dstAlpha:t.dst;return E.commandParameter(n,$n,a+".srcRGB",e.commandStr),E.commandParameter(r,$n,a+".srcAlpha",e.commandStr),E.commandParameter(i,$n,a+".dstRGB",e.commandStr),E.commandParameter(o,$n,a+".dstAlpha",e.commandStr),E.command(-1===tr.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[$n[n],$n[i],$n[r],$n[o]]}),(function(e,n,r){var i=e.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return E.optional((function(){e.assert(n,s+" in "+i,"invalid "+t+"."+o+a+", must be one of "+Object.keys($n))})),s}E.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");E.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case Ze:return s((function(n){return"string"==typeof n?(E.commandParameter(n,v,"invalid "+t,e.commandStr),[v[n],v[n]]):"object"==typeof n?(E.commandParameter(n.rgb,v,t+".rgb",e.commandStr),E.commandParameter(n.alpha,v,t+".alpha",e.commandStr),[v[n.rgb],v[n.alpha]]):void E.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,o=n.def(),a=n.def(),s=e.cond("typeof ",r,'==="string"');return E.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(v))}n(s.then,t,r),e.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(s.else,t+".rgb",r+".rgb"),n(s.else,t+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case Ue:return s((function(t){return E.command(mt(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),F(4,(function(e){return+t[e]}))}),(function(t,e,n){return E.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),F(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case an:return s((function(t){return E.commandType(t,"number",a,e.commandStr),0|t}),(function(t,e,n){return E.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case sn:return s((function(n){E.commandType(n,"object",a,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return E.commandParameter(r,er,t+".cmp",e.commandStr),E.commandType(i,"number",t+".ref",e.commandStr),E.commandType(o,"number",t+".mask",e.commandStr),[er[r],i,o]}),(function(t,e,n){var r=t.constants.compareFuncs;return E.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Jn),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case un:case ln:return s((function(n){E.commandType(n,"object",a,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return E.commandParameter(r,nr,t+".fail",e.commandStr),E.commandParameter(i,nr,t+".zfail",e.commandStr),E.commandParameter(o,nr,t+".zpass",e.commandStr),[t===ln?Kn:Yn,nr[r],nr[i],nr[o]]}),(function(e,n,r){var i=e.constants.stencilOps;function o(o){return E.optional((function(){e.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+t+"."+o+", must be one of "+Object.keys(nr))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Jn)}return E.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===ln?Kn:Yn,o("fail"),o("zfail"),o("zpass")]}));case tn:return s((function(t){E.commandType(t,"object",a,e.commandStr);var n=0|t.factor,r=0|t.units;return E.commandType(n,"number",a+".factor",e.commandStr),E.commandType(r,"number",a+".units",e.commandStr),[n,r]}),(function(e,n,r){return E.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Ke:return s((function(t){var n=0;return"front"===t?n=Yn:"back"===t&&(n=Kn),E.command(!!n,a,e.commandStr),n}),(function(t,e,n){return E.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',Yn,":",Kn)}));case Je:return s((function(t){return E.command("number"==typeof t&&t>=o.lineWidthDims[0]&&t<=o.lineWidthDims[1],"invalid line width, must be a positive number between "+o.lineWidthDims[0]+" and "+o.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return E.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+o.lineWidthDims[0]+"&&"+n+"<="+o.lineWidthDims[1],"invalid line width")})),n}));case Qe:return s((function(t){return E.commandParameter(t,ir,a,e.commandStr),ir[t]}),(function(t,e,n){return E.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?2304:'+Qn)}));case Xe:return s((function(t){return E.command(mt(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return E.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),F(4,(function(t){return"!!"+n+"["+t+"]"}))}));case rn:return s((function(t){E.command("object"==typeof t&&t,a,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return E.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){return E.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),i}(t,c),S=function(t,e,n){var i=t.static,o=t.dynamic;function a(t){if(t in i){var e=r.id(i[t]);E.optional((function(){p.shader(rr[t],e,E.guessCommand())}));var n=lr((function(){return e}));return n.id=e,n}if(t in o){var a=o[t];return cr(a,(function(e,n){var r=e.invoke(n,a),i=n.def(e.shared.strings,".id(",r,")");return E.optional((function(){n(e.shared.shader,".shader(",rr[t],",",i,",",e.command,");")})),i}))}return null}var s,u=a(gn),l=a(mn),c=null;return ur(u)&&ur(l)?(c=p.program(l.id,u.id,null,n),s=lr((function(t,e){return t.link(c)}))):s=new sr(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(t,e){var n,r=t.shared.shader;n=u?u.append(t,e):e.def(r,".",gn);var i=r+".program("+(l?l.append(t,e):e.def(r,".",mn))+","+n;return E.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}(t,0,m);function M(t){var e=x[t];e&&(w[t]=e)}M(pn),M(A(hn));var T=Object.keys(w).length>0,P={framebuffer:g,draw:b,shader:S,state:w,dirty:T,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(P.profile=function(t){var e,n=t.static,r=t.dynamic;if(fn in n){var i=!!n[fn];(e=lr((function(t,e){return i}))).enable=i}else if(fn in r){var o=r[fn];e=cr(o,(function(t,e){return t.invoke(e,o)}))}return e}(t),P.uniforms=function(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,o=n[t];if("number"==typeof o||"boolean"==typeof o)r=lr((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=lr((function(t){return t.link(o)})):"framebuffer"===a||"framebufferCube"===a?(E.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=lr((function(t){return t.link(o.color[0])}))):E.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else mt(o)?r=lr((function(e){return e.global.def("[",F(o.length,(function(n){return E.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+t,e.commandStr),o[n]})),"]")})):E.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=o,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=cr(e,(function(t,n){return t.invoke(n,e)}))})),i}(n,c),P.drawVAO=P.scopeVAO=b.vao,!P.drawVAO&&S.program&&!m&&i.angle_instanced_arrays&&b.static.elements){var L=!0,I=S.program.attributes.map((function(t){var n=e.static[t];return L=L&&!!n,n}));if(L&&I.length>0){var k=h.getVAO(h.createVAO({attributes:I,elements:b.static.elements}));P.drawVAO=new sr(null,null,null,(function(t,e){return t.link(k)})),P.useVAO=!0}}return m?P.useVAO=!0:P.attributes=function(t,e){var n=t.static,i=t.dynamic,o={};return Object.keys(n).forEach((function(t){var i=n[t],s=r.id(t),u=new y;if(or(i))u.state=1,u.buffer=a.getBuffer(a.create(i,Ln,!1,!0)),u.type=0;else{var l=a.getBuffer(i);if(l)u.state=1,u.buffer=l,u.type=0;else if(E.command("object"==typeof i&&i,"invalid data for attribute "+t,e.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=2,"number"==typeof c?u.x=c:(E.command(mt(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+t,e.commandStr),ze.forEach((function(t,e){e<c.length&&(u[t]=c[e])})))}else{l=or(i.buffer)?a.getBuffer(a.create(i.buffer,Ln,!1,!0)):a.getBuffer(i.buffer),E.command(!!l,'missing buffer for attribute "'+t+'"',e.commandStr);var h=0|i.offset;E.command(h>=0,'invalid offset for attribute "'+t+'"',e.commandStr);var p=0|i.stride;E.command(p>=0&&p<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',e.commandStr);var f=0|i.size;E.command(!("size"in i)||f>0&&f<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',e.commandStr);var d=!!i.normalized,m=0;"type"in i&&(E.commandParameter(i.type,Q,"invalid type for attribute "+t,e.commandStr),m=Q[i.type]);var g=0|i.divisor;E.optional((function(){"divisor"in i&&(E.command(0===g||_,'cannot specify divisor for attribute "'+t+'", instancing not supported',e.commandStr),E.command(g>=0,'invalid divisor for attribute "'+t+'"',e.commandStr));var n=e.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(e){E.command(r.indexOf(e)>=0,'unknown parameter "'+e+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",n)}))})),u.buffer=l,u.state=1,u.size=f,u.normalized=d,u.type=m||l.dtype,u.offset=h,u.stride=p,u.divisor=g}}o[t]=lr((function(t,e){var n=t.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(t){r[t]=u[t]})),u.buffer&&(r.buffer=t.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(t){var e=i[t];o[t]=cr(e,(function(n,r){var i=n.invoke(r,e),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;E.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var l={isStream:r.def(!1)},c=new y;c.state=1,Object.keys(c).forEach((function(t){l[t]=r.def(""+c[t])}));var h=l.buffer,p=l.type;function f(t){r(l[t],"=",i,".",t,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",h,"=",u,".createStream(",Ln,",",i,");",p,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",p,"=",h,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",2,";","if(typeof "+i+'.constant === "number"){',l[ze[0]],"=",i,".constant;",ze.slice(1).map((function(t){return l[t]})).join("="),"=0;","}else{",ze.map((function(t,e){return l[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",Ln,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",p,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",l.normalized,"=!!",i,".normalized;"),f("size"),f("offset"),f("stride"),f("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",h,");","}"),l}))})),o}(e,c),P.context=function(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=lr((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=cr(e,(function(t,n){return t.invoke(n,e)}))})),r}(u),P}function z(t,e,n){var r=t.shared.context,i=t.scope();Object.keys(n).forEach((function(o){e.save(r,"."+o);var a=n[o].append(t,e);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),e(i)}function B(t,e,n,r){var i,o=t.shared,a=o.gl,s=o.framebuffer;x&&(i=e.def(o.extensions,".webgl_draw_buffers"));var u,l=t.constants,c=l.drawBuffer,h=l.backBuffer;u=n?n.append(t,e):e.def(s,".next"),r||e("if(",u,"!==",s,".cur){"),e("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),x&&e(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),e("}else{",a,".bindFramebuffer(",36160,",null);"),x&&e(i,".drawBuffersWEBGL(",h,");"),e("}",s,".cur=",u,";"),r||e("}")}function j(t,e,n){var r=t.shared,i=r.gl,o=t.current,a=t.next,s=r.current,u=r.next,l=t.cond(s,".dirty");C.forEach((function(e){var r,c,h=A(e);if(!(h in n.state))if(h in a){r=a[h],c=o[h];var p=F(w[h].length,(function(t){return l.def(r,"[",t,"]")}));l(t.cond(p.map((function(t,e){return t+"!=="+c+"["+e+"]"})).join("||")).then(i,".",T[h],"(",p,");",p.map((function(t,e){return c+"["+e+"]="+t})).join(";"),";"))}else{r=l.def(u,".",h);var f=t.cond(r,"!==",s,".",h);l(f),h in M?f(t.cond(r).then(i,".enable(",M[h],");").else(i,".disable(",M[h],");"),s,".",h,"=",r,";"):f(i,".",T[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),e(l)}function U(t,e,n,r){var i=t.shared,o=t.current,a=i.current,s=i.gl;ar(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(t,e);if(M[i]){var c=M[i];ur(u)?e(s,l?".enable(":".disable(",c,");"):e(t.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),e(a,".",i,"=",l,";")}else if(mt(l)){var h=o[i];e(s,".",T[i],"(",l,");",l.map((function(t,e){return h+"["+e+"]="+t})).join(";"),";")}else e(s,".",T[i],"(",l,");",a,".",i,"=",l,";")}}))}function Z(t,e){_&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function V(t,e,n,r,i){var o,a,s,u=t.shared,l=t.stats,c=u.current,h=u.timer,p=n.profile;function f(){return"undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM||"undefined"==typeof performance?"Date.now()":"performance.now()"}function d(t){t(o=e.def(),"=",f(),";"),"string"==typeof i?t(l,".count+=",i,";"):t(l,".count++;"),m&&(r?t(a=e.def(),"=",h,".getNumPendingQueries();"):t(h,".beginQuery(",l,");"))}function g(t){t(l,".cpuTime+=",f(),"-",o,";"),m&&(r?t(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",l,");"):t(h,".endQuery();"))}function y(t){var n=e.def(c,".profile");e(c,".profile=",t,";"),e.exit(c,".profile=",n,";")}if(p){if(ur(p))return void(p.enable?(d(e),g(e.exit),y("true")):y("false"));y(s=p.append(t,e))}else s=e.def(c,".profile");var v=t.block();d(v),e("if(",s,"){",v,"}");var _=t.block();g(_),e.exit("if(",s,"){",_,"}")}function G(t,e,n,r,i){var o=t.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(t,e)}else{if(!i(hr))return;var l=t.scopeAttrib(s);E.optional((function(){t.assert(e,l+".state","missing attribute "+s)})),a={},Object.keys(new y).forEach((function(t){a[t]=e.def(l,".",t)}))}!function(n,r,i){var a=o.gl,s=e.def(n,".location"),u=e.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,h=[i.x,i.y,i.z,i.w],p=["buffer","normalized","offset","stride"];function f(){e("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",u,".type!==",o,"||",u,".size!==",n,"||",p.map((function(t){return u+"."+t+"!=="+i[t]})).join("||"),"){",a,".bindBuffer(",Ln,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",p.map((function(t){return u+"."+t+"="+i[t]+";"})).join(""),"}"),_){var l=i.divisor;e("if(",u,".divisor!==",l,"){",t.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){e("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",ze.map((function(t,e){return u+"."+t+"!=="+h[e]})).join("||"),"){",a,".vertexAttrib4f(",s,",",h,");",ze.map((function(t,e){return u+"."+t+"="+h[e]+";"})).join(""),"}")}1===l?f():2===l?d():(e("if(",l,"===",1,"){"),f(),e("}else{"),d(),e("}"))}(t.link(r),function(t){switch(t){case On:case Fn:case Un:return 2;case Rn:case zn:case Zn:return 3;case Dn:case Bn:case Vn:return 4;default:return 1}}(r.info.type),a)}))}function H(t,e,n,i,o,a){for(var s,u=t.shared,l=u.gl,c=0;c<i.length;++c){var h,p=i[c],f=p.name,d=p.info.type,m=n.uniforms[f],g=t.link(p)+".location";if(m){if(!o(m))continue;if(ur(m)){var y=m.value;if(E.command(null!=y,'missing uniform "'+f+'"',t.commandStr),d===qn||d===Xn){E.command("function"==typeof y&&(d===qn&&("texture2d"===y._reglType||"framebuffer"===y._reglType)||d===Xn&&("textureCube"===y._reglType||"framebufferCube"===y._reglType)),"invalid texture for uniform "+f,t.commandStr);var v=t.link(y._texture||y.color[0]._texture);e(l,".uniform1i(",g,",",v+".bind());"),e.exit(v,".unbind();")}else if(d===Gn||d===Hn||d===Wn){E.optional((function(){E.command(mt(y),"invalid matrix for uniform "+f,t.commandStr),E.command(d===Gn&&4===y.length||d===Hn&&9===y.length||d===Wn&&16===y.length,"invalid length for matrix uniform "+f,t.commandStr)}));var _=t.global.def("new Float32Array(["+Array.prototype.slice.call(y)+"])"),x=2;d===Hn?x=3:d===Wn&&(x=4),e(l,".uniformMatrix",x,"fv(",g,",false,",_,");")}else{switch(d){case kn:E.commandType(y,"number","uniform "+f,t.commandStr),s="1f";break;case On:E.command(mt(y)&&2===y.length,"uniform "+f,t.commandStr),s="2f";break;case Rn:E.command(mt(y)&&3===y.length,"uniform "+f,t.commandStr),s="3f";break;case Dn:E.command(mt(y)&&4===y.length,"uniform "+f,t.commandStr),s="4f";break;case jn:E.commandType(y,"boolean","uniform "+f,t.commandStr),s="1i";break;case Nn:E.commandType(y,"number","uniform "+f,t.commandStr),s="1i";break;case Un:case Fn:E.command(mt(y)&&2===y.length,"uniform "+f,t.commandStr),s="2i";break;case Zn:case zn:E.command(mt(y)&&3===y.length,"uniform "+f,t.commandStr),s="3i";break;case Vn:case Bn:E.command(mt(y)&&4===y.length,"uniform "+f,t.commandStr),s="4i"}e(l,".uniform",s,"(",g,",",mt(y)?Array.prototype.slice.call(y):y,");")}continue}h=m.append(t,e)}else{if(!o(hr))continue;h=e.def(u.uniforms,"[",r.id(f),"]")}d===qn?(E(!Array.isArray(h),"must specify a scalar prop for textures"),e("if(",h,"&&",h,'._reglType==="framebuffer"){',h,"=",h,".color[0];","}")):d===Xn&&(E(!Array.isArray(h),"must specify a scalar prop for cube maps"),e("if(",h,"&&",h,'._reglType==="framebufferCube"){',h,"=",h,".color[0];","}")),E.optional((function(){function n(n,r){t.assert(e,n,'bad data or missing for uniform "'+f+'".  '+r)}function r(t){E(!Array.isArray(h),"must not specify an array type for uniform"),n("typeof "+h+'==="'+t+'"',"invalid type, expected "+t)}function i(e,r){Array.isArray(h)?E(h.length===e,"must have length "+e):n(u.isArrayLike+"("+h+")&&"+h+".length==="+e,"invalid vector, should have length "+e,t.commandStr)}function o(e){E(!Array.isArray(h),"must not specify a value type"),n("typeof "+h+'==="function"&&'+h+'._reglType==="texture'+(3553===e?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(d){case Nn:r("number");break;case Fn:i(2);break;case zn:i(3);break;case Bn:i(4);break;case kn:r("number");break;case On:i(2);break;case Rn:i(3);break;case Dn:i(4);break;case jn:r("boolean");break;case Un:i(2);break;case Zn:i(3);break;case Vn:case Gn:i(4);break;case Hn:i(9);break;case Wn:i(16);break;case qn:o(3553);break;case Xn:o(34067)}}));var b=1;switch(d){case qn:case Xn:var w=e.def(h,"._texture");e(l,".uniform1i(",g,",",w,".bind());"),e.exit(w,".unbind();");continue;case Nn:case jn:s="1i";break;case Fn:case Un:s="2i",b=2;break;case zn:case Zn:s="3i",b=3;break;case Bn:case Vn:s="4i",b=4;break;case kn:s="1f";break;case On:s="2f",b=2;break;case Rn:s="3f",b=3;break;case Dn:s="4f",b=4;break;case Gn:s="Matrix2fv";break;case Hn:s="Matrix3fv";break;case Wn:s="Matrix4fv"}if("M"===s.charAt(0)){e(l,".uniform",s,"(",g,",");var S=Math.pow(d-Gn+2,2),C=t.global.def("new Float32Array(",S,")");Array.isArray(h)?e("false,(",F(S,(function(t){return C+"["+t+"]="+h[t]})),",",C,")"):e("false,(Array.isArray(",h,")||",h," instanceof Float32Array)?",h,":(",F(S,(function(t){return C+"["+t+"]="+h+"["+t+"]"})),",",C,")"),e(");")}else if(b>1){for(var M=[],T=[],A=0;A<b;++A)Array.isArray(h)?T.push(h[A]):T.push(e.def(h+"["+A+"]")),a&&M.push(e.def());a&&e("if(!",t.batchId,"||",M.map((function(t,e){return t+"!=="+T[e]})).join("||"),"){",M.map((function(t,e){return t+"="+T[e]+";"})).join("")),e(l,".uniform",s,"(",g,",",T.join(","),");"),a&&e("}")}else{if(E(!Array.isArray(h),"uniform value must not be an array"),a){var P=e.def();e("if(!",t.batchId,"||",P,"!==",h,"){",P,"=",h,";")}e(l,".uniform",s,"(",g,",",h,");"),a&&e("}")}}}function W(t,e,n,r){var i=t.shared,o=i.gl,a=i.draw,s=r.draw;var u=function(){var u,l=s.elements,c=e;return l?((l.contextDep&&r.contextDynamic||l.propDep)&&(c=n),u=l.append(t,c),s.elementsActive&&c("if("+u+")"+o+".bindBuffer("+"34963,"+u+".buffer.buffer);")):(u=c.def(),c(u,"=",a,".",yn,";","if(",u,"){",o,".bindBuffer(",In,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",t.shared.elements+".getElements("+i.vao,".currentVAO.elements);",b?"":"if("+u+")"+o+".bindBuffer("+"34963,"+u+".buffer.buffer);","}")),u}();function l(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(t,n):o.append(t,e):e.def(a,".",i)}var c,h,p=l(vn),f=l(xn),d=function(){var i,o=s.count,u=e;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(t,u),E.optional((function(){o.MISSING&&t.assert(e,"false","missing vertex count"),o.DYNAMIC&&t.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",_n),E.optional((function(){t.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");_&&(c=l(bn),h=t.instancing);var m=u+".type",g=s.elements&&ur(s.elements)&&!s.vaoActive;function y(){function t(){n(h,".drawElementsInstancedANGLE(",[p,d,m,f+"<<(("+m+"-5121)>>1)",c],");")}function e(){n(h,".drawArraysInstancedANGLE(",[p,f,d,c],");")}u&&"null"!==u?g?t():(n("if(",u,"){"),t(),n("}else{"),e(),n("}")):e()}function v(){function t(){n(o+".drawElements("+[p,d,m,f+"<<(("+m+"-5121)>>1)"]+");")}function e(){n(o+".drawArrays("+[p,f,d]+");")}u&&"null"!==u?g?t():(n("if(",u,"){"),t(),n("}else{"),e(),n("}")):e()}_&&("number"!=typeof c||c>=0)?"string"==typeof c?(n("if(",c,">0){"),y(),n("}else if(",c,"<0){"),v(),n("}")):y():v()}function q(t,e,n,r,i){var o=D(),a=o.proc("body",i);return E.optional((function(){o.commandStr=e.commandStr,o.command=o.link(e.commandStr)})),_&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),t(o,a,n,r),o.compile().body}function X(t,e,n,r){Z(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),G(t,e,n,r.attributes,(function(){return!0}))),H(t,e,n,r.uniforms,(function(){return!0}),!1),W(t,e,e,n)}function Y(t,e,n,r){function i(){return!0}t.batchId="a1",Z(t,e),G(t,e,n,r.attributes,i),H(t,e,n,r.uniforms,i,!1),W(t,e,e,n)}function K(t,e,n,r){Z(t,e);var i=n.contextDep,o=e.def(),a=e.def();t.shared.props=a,t.batchId=o;var s=t.scope(),u=t.scope();function l(t){return t.contextDep&&i||t.propDep}function c(t){return!l(t)}if(e(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&z(t,u,n.context),n.needsFramebuffer&&B(t,u,n.framebuffer),U(t,u,n.state,l),n.profile&&l(n.profile)&&V(t,u,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?u(t.shared.vao,".setVAO(",n.drawVAO.append(t,u),");"):s(t.shared.vao,".setVAO(",n.drawVAO.append(t,s),");"):s(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(s(t.shared.vao,".setVAO(null);"),G(t,s,n,r.attributes,c),G(t,u,n,r.attributes,l)),H(t,s,n,r.uniforms,c,!1),H(t,u,n,r.uniforms,l,!0),W(t,s,u,n);else{var h=t.global.def("{}"),p=n.shader.progVar.append(t,u),f=u.def(p,".id"),d=u.def(h,"[",f,"]");u(t.shared.gl,".useProgram(",p,".program);","if(!",d,"){",d,"=",h,"[",f,"]=",t.link((function(e){return q(Y,t,n,e,2)})),"(",p,");}",d,".call(this,a0[",o,"],",o,");")}}function J(t,e,n){var r=e.static[n];if(r&&function(t){if("object"==typeof t&&!mt(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(L.isDynamic(t[e[n]]))return!0;return!1}}(r)){var i=t.global,o=Object.keys(r),a=!1,s=!1,u=!1,l=t.global.def("{}");o.forEach((function(e){var n=r[e];if(L.isDynamic(n)){"function"==typeof n&&(n=r[e]=L.unbox(n));var o=cr(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(l,".",e,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n))}i(";")}})),e.dynamic[n]=new L.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:l,append:function(t,e){o.forEach((function(n){var i=r[n];if(L.isDynamic(i)){var o=t.invoke(e,i);e(l,".",n,"=",o,";")}}))}}),delete e.static[n]}}return{next:S,current:w,procs:function(){var t=D(),e=t.proc("poll"),n=t.proc("refresh"),r=t.block();e(r),n(r);var a,s=t.shared,u=s.gl,l=s.next,c=s.current;r(c,".dirty=false;"),B(t,e),B(t,n,null,!0),_&&(a=t.link(_)),i.oes_vertex_array_object&&n(t.link(i.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<o.maxAttributes;++h){var p=n.def(s.attributes,"[",h,"]"),f=t.cond(p,".buffer");f.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",Ln,",",p,".buffer.buffer);",u,".vertexAttribPointer(",h,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;"),n(f),_&&n(a,".vertexAttribDivisorANGLE(",h,",",p,".divisor);")}return n(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(M).forEach((function(i){var o=M[i],a=r.def(l,".",i),s=t.block();s("if(",a,"){",u,".enable(",o,")}else{",u,".disable(",o,")}",c,".",i,"=",a,";"),n(s),e("if(",a,"!==",c,".",i,"){",s,"}")})),Object.keys(T).forEach((function(i){var o,a,s=T[i],h=w[i],p=t.block();if(p(u,".",s,"("),mt(h)){var f=h.length;o=t.global.def(l,".",i),a=t.global.def(c,".",i),p(F(f,(function(t){return o+"["+t+"]"})),");",F(f,(function(t){return a+"["+t+"]="+o+"["+t+"];"})).join("")),e("if(",F(f,(function(t){return o+"["+t+"]!=="+a+"["+t+"]"})).join("||"),"){",p,"}")}else o=r.def(l,".",i),a=r.def(c,".",i),p(o,");",c,".",i,"=",o,";"),e("if(",o,"!==",a,"){",p,"}");n(p)})),t.compile()}(),compile:function(t,e,i,o,a){var s=D();s.stats=s.link(a),Object.keys(e.static).forEach((function(t){J(s,e,t)})),Pn.forEach((function(e){J(s,t,e)}));var u=N(t,e,i,o,s);return function(t,e){var n=t.proc("draw",1);Z(t,n),z(t,n,e.context),B(t,n,e.framebuffer),j(t,n,e),U(t,n,e.state),V(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)X(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(t.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",t.link((function(n){return q(X,t,e,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}(s,u),function(t,e){var n=t.proc("scope",3);t.batchId="a2";var i=t.shared,o=i.current;function a(r){var o=e.shader[r];o&&n.set(i.shader,"."+r,o.append(t,n))}z(t,n,e.context),e.framebuffer&&e.framebuffer.append(t,n),ar(Object.keys(e.state)).forEach((function(r){var o=e.state[r].append(t,n);mt(o)?o.forEach((function(e,i){n.set(t.next[r],"["+i+"]",e)})):n.set(i.next,"."+r,o)})),V(t,n,e,!0,!0),[yn,xn,_n,bn,vn].forEach((function(r){var o=e.draw[r];o&&n.set(i.draw,"."+r,""+o.append(t,n))})),Object.keys(e.uniforms).forEach((function(o){var a=e.uniforms[o].append(t,n);Array.isArray(a)&&(a="["+a.join()+"]"),n.set(i.uniforms,"["+r.id(o)+"]",a)})),Object.keys(e.attributes).forEach((function(r){var i=e.attributes[r].append(t,n),o=t.scopeAttrib(r);Object.keys(new y).forEach((function(t){n.set(o,"."+t,i[t])}))})),e.scopeVAO&&n.set(i.vao,".targetVAO",e.scopeVAO.append(t,n)),a(mn),a(gn),Object.keys(e.state).length>0&&(n(o,".dirty=true;"),n.exit(o,".dirty=true;")),n("a1(",t.shared.context,",a0,",t.batchId,");")}(s,u),function(t,e){var n=t.proc("batch",2);t.batchId="0",Z(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(z(t,n,e.context),i=!1);var o=e.framebuffer,a=!1;function s(t){return t.contextDep&&r||t.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||B(t,n,o)):B(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),j(t,n,e),U(t,n,e.state,(function(t){return!s(t)})),e.profile&&s(e.profile)||V(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=a;var u=e.shader.progVar;if(u.contextDep&&r||u.propDep)K(t,n,e,null);else{var l=u.append(t,n);if(n(t.shared.gl,".useProgram(",l,".program);"),e.shader.program)K(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var c=t.global.def("{}"),h=n.def(l,".id"),p=n.def(c,"[",h,"]");n(t.cond(p).then(p,".call(this,a0,a1);").else(p,"=",c,"[",h,"]=",t.link((function(n){return q(K,t,e,n,2)})),"(",l,");",p,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}(s,u),n(s.compile(),{destroy:function(){u.shader.program.destroy()}})}}}var fr=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(t){n.push(t)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(t){a.push(t)}var u=[];function l(t,e,n){var r=a.pop()||new o;r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,u.push(r)}var c=[],h=[];return{beginQuery:function(t){var r=n.pop()||e.ext_disjoint_timer_query.createQueryEXT();e.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),l(i.length-1,i.length,t)},endQuery:function(){e.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:l,update:function(){var t,n,o=i.length;if(0!==o){h.length=Math.max(h.length,o+1),c.length=Math.max(c.length,o+1),c[0]=0,h[0]=0;var a=0;for(t=0,n=0;n<i.length;++n){var l=i[n];e.ext_disjoint_timer_query.getQueryObjectEXT(l,34919)?(a+=e.ext_disjoint_timer_query.getQueryObjectEXT(l,34918),r(l)):i[t++]=l,c[n+1]=a,h[n+1]=t}for(i.length=t,t=0,n=0;n<u.length;++n){var p=u[n],f=p.startQueryIndex,d=p.endQueryIndex;p.sum+=c[d]-c[f];var m=h[f],g=h[d];g===m?(p.stats.gpuTime+=p.sum/1e6,s(p)):(p.startQueryIndex=m,p.endQueryIndex=g,u[t++]=p)}u.length=t}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},dr="webglcontextlost",mr="webglcontextrestored";function gr(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}return function(t){var r=D(t);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=N(i,r);if(!s)return null;var u,l,c=(u={"":0},l=[""],{id:function(t){var e=u[t];return e||(e=u[t]=l.length,l.push(t),e)},str:function(t){return l[t]}}),h={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},p=s.extensions,f=fr(0,p),d=k(),m=i.drawingBufferWidth,g=i.drawingBufferHeight,y={tick:0,time:0,viewportWidth:m,viewportHeight:g,framebufferWidth:m,framebufferHeight:g,drawingBufferWidth:m,drawingBufferHeight:g,pixelRatio:r.pixelRatio},v={elements:null,primitive:4,count:-1,offset:0,instances:-1},_=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(34047));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(34852),i=t.getParameter(36063));var o=!!e.oes_texture_float;if(o){var a=t.createTexture();t.bindTexture(U,a),t.texImage2D(U,0,Z,1,1,0,Z,V,null);var s=t.createFramebuffer();if(t.bindFramebuffer(G,s),t.framebufferTexture2D(G,36064,U,a,0),t.bindTexture(U,null),36053!==t.checkFramebufferStatus(G))o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(16384);var u=j.allocType(V,4);t.readPixels(0,0,1,1,Z,V,u),t.getError()?o=!1:(t.deleteFramebuffer(s),t.deleteTexture(a),o=1===u[0]),j.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=t.createTexture(),h=j.allocType(5121,36);t.activeTexture(33984),t.bindTexture(34067,c),t.texImage2D(34069,0,Z,3,3,0,Z,5121,h),j.freeType(h),t.bindTexture(34067,null),t.deleteTexture(c),l=!t.getError()}return{colorBits:[t.getParameter(3410),t.getParameter(3411),t.getParameter(3412),t.getParameter(3413)],depthBits:t.getParameter(3414),stencilBits:t.getParameter(3415),subpixelBits:t.getParameter(3408),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(33901),lineWidthDims:t.getParameter(33902),maxViewportDims:t.getParameter(3386),maxCombinedTextureUnits:t.getParameter(35661),maxCubeMapSize:t.getParameter(34076),maxRenderbufferSize:t.getParameter(34024),maxTextureUnits:t.getParameter(34930),maxTextureSize:t.getParameter(3379),maxAttributes:t.getParameter(34921),maxVertexUniforms:t.getParameter(36347),maxVertexTextureUnits:t.getParameter(35660),maxVaryingVectors:t.getParameter(36348),maxFragmentUniforms:t.getParameter(36349),glsl:t.getParameter(35724),renderer:t.getParameter(7937),vendor:t.getParameter(7936),version:t.getParameter(7938),readFloat:o,npotTextureCube:l}}(i,p),x=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=et,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function l(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function c(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||nt,n.length>0)if(Array.isArray(n[0])){s=tt(n);for(var c=1,h=1;h<s.length;++h)c*=s[h];t.dimension=c,l(t,u=$(n,s,t.dtype),r),a?t.persistentData=u:j.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var p=j.allocType(t.dtype,n.length);ot(p,n),l(t,p,r),a?t.persistentData=p:j.freeType(p)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||it(n[0])||nt,l(t,u=$(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:j.freeType(u)):E.raise("invalid buffer data")}else if(e(n))t.dtype=i||it(n),t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(H(n)){s=n.shape;var f=n.stride,d=n.offset,m=0,g=0,y=0,v=0;1===s.length?(m=s[0],g=1,y=f[0],v=0):2===s.length?(m=s[0],g=s[1],y=f[0],v=f[1]):E.raise("invalid shape"),t.dtype=i||it(n.data)||nt,t.dimension=g;var _=j.allocType(t.dtype,m*g);at(_,n.data,m,g,y,v,d),l(t,_,r),a?t.persistentData=_:j.freeType(_)}else n instanceof ArrayBuffer?(t.dtype=et,t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):E.raise("invalid buffer data")}function h(e){n.bufferCount--,i(e);var r=e.buffer;E(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(a).forEach((function(e){t+=a[e].stats.size})),t}),{create:function(i,o,u,l){n.bufferCount++;var p=new s(o);function f(n){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||H(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(E.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(E(null===o||Array.isArray(o)||e(o)||H(o),"invalid data for buffer"),o=n.data),"usage"in n&&(E.parameter(n.usage,J,"invalid buffer usage"),i=J[n.usage]),"type"in n&&(E.parameter(n.type,Q,"invalid buffer type"),s=Q[n.type]),"dimension"in n&&(E.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(E.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),p.bind(),o?c(p,o,i,s,u,l):(a&&t.bufferData(p.type,a,i),p.dtype=s||et,p.usage=i,p.dimension=u,p.byteLength=a),r.profile&&(p.stats.size=p.byteLength*rt[p.dtype]),f}function d(e,n){E(n+e.byteLength<=p.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+p.byteLength),t.bufferSubData(p.type,n,e)}return a[p.id]=p,u||f(i),f._reglType="buffer",f._buffer=p,f.subdata=function(t,n){var r,i=0|(n||0);if(p.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=j.allocType(p.dtype,t.length);ot(o,t),d(o,i),j.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=tt(t);var a=$(t,r,p.dtype);d(a,i),j.freeType(a)}else E.raise("invalid buffer data")}else if(H(t)){r=t.shape;var s=t.stride,u=0,l=0,c=0,h=0;1===r.length?(u=r[0],l=1,c=s[0],h=0):2===r.length?(u=r[0],l=r[1],c=s[0],h=s[1]):E.raise("invalid shape");var m=Array.isArray(t.data)?p.dtype:it(t.data),g=j.allocType(m,u*l);at(g,t.data,u,l,c,h,t.offset),d(g,i),j.freeType(g)}else E.raise("invalid data for buffer subdata");return f},r.profile&&(f.stats=p.stats),f.destroy=function(){h(p)},f},createStream:function(t,e){var n=u.pop();return n||(n=new s(t)),n.bind(),c(n,e,35040,0,1,!1),n},destroyStream:function(t){u.push(t)},clear:function(){W(a).forEach(h),u.forEach(h)},getBuffer:function(t){return t&&t._buffer instanceof s?t._buffer:null},restore:function(){W(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:c}}(i,h,r,(function(t){return w.destroyBuffer(t)})),b=function(t,n,r,i){var o={},a=0,s={uint8:ut,uint16:lt};function u(t){this.id=a++,o[this.id]=this,this.buffer=t,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=ct),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(i,o,a,s,u,l,c){var h;if(i.buffer.bind(),o){var p=c;c||e(o)&&(!H(o)||e(o.data))||(p=n.oes_element_index_uint?ct:lt),r._initBuffer(i.buffer,o,a,p,3)}else t.bufferData(ht,l,a),i.buffer.dtype=h||ut,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(h=c,!c){switch(i.buffer.dtype){case ut:case 5120:h=ut;break;case lt:case 5122:h=lt;break;case ct:case 5124:h=ct;break;default:E.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,E(h!==ct||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var f=u;f<0&&(f=i.buffer.byteLength,h===lt?f>>=1:h===ct&&(f>>=2)),i.vertCount=f;var d=s;if(s<0){d=4;var m=i.buffer.dimension;1===m&&(d=0),2===m&&(d=1),3===m&&(d=4)}i.primType=d}function h(t){i.elementsCount--,E(null!==t.buffer,"must not double destroy elements"),delete o[t.id],t.buffer.destroy(),t.buffer=null}return{create:function(t,n){var o=r.create(null,ht,!0),a=new u(o._buffer);function l(t){if(t)if("number"==typeof t)o(t),a.primType=4,a.vertCount=0|t,a.type=ut;else{var n=null,r=35044,i=-1,u=-1,h=0,p=0;Array.isArray(t)||e(t)||H(t)?n=t:(E.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,E(Array.isArray(n)||e(n)||H(n),"invalid data for element buffer")),"usage"in t&&(E.parameter(t.usage,J,"invalid element buffer usage"),r=J[t.usage]),"primitive"in t&&(E.parameter(t.primitive,st,"invalid element buffer primitive"),i=st[t.primitive]),"count"in t&&(E("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(E.parameter(t.type,s,"invalid buffer type"),p=s[t.type]),"length"in t?h=0|t.length:(h=u,p===lt||5122===p?h*=2:p!==ct&&5124!==p||(h*=4))),c(a,n,r,i,u,h,p)}else o(),a.primType=4,a.vertCount=0,a.type=ut;return l}return i.elementsCount++,l(t),l._reglType="elements",l._elements=a,l.subdata=function(t,e){return o.subdata(t,e),l},l.destroy=function(){h(a)},l},createStream:function(t){var e=l.pop();return e||(e=new u(r.create(null,ht,!0,!1)._buffer)),c(e,t,35040,-1,-1,0,0),e},destroyStream:function(t){l.push(t)},getElements:function(t){return"function"==typeof t&&t._elements instanceof u?t._elements:null},clear:function(){W(o).forEach(h)}}}(i,p,x,h),w=function(t,n,r,i,o,a,s){for(var u=r.maxAttributes,l=new Array(u),c=0;c<u;++c)l[c]=new ke;var h=0,p={},f={Record:ke,scope:{},state:l,currentVAO:null,targetVAO:null,restore:d()?function(){d()&&W(p).forEach((function(t){t.refresh()}))}:function(){},createVAO:function(t){var r=new g;function s(t){var i;if(Array.isArray(t))i=t,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(E("object"==typeof t,"invalid arguments for create vao"),E("attributes"in t,"must specify attributes for vao"),t.elements){var l=t.elements;r.ownsElements?"function"==typeof l&&"elements"===l._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(l),r.ownsElements=!1):a.getElements(t.elements)?(r.elements=t.elements,r.ownsElements=!1):(r.elements=a.create(t.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=t.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in t&&(r.offset=0|t.offset),"count"in t&&(r.count=0|t.count),"instances"in t&&(r.instances=0|t.instances),"primitive"in t&&(E(t.primitive in st,"bad primitive type: "+t.primitive),r.primitive=st[t.primitive]),E.optional((function(){for(var e=Object.keys(t),n=0;n<e.length;++n)E(Ie.indexOf(e[n])>=0,'invalid option for vao: "'+e[n]+'" valid options are '+Ie)})),E(Array.isArray(i),"attributes must be an array")}E(i.length<u,"too many attributes"),E(i.length>0,"must specify at least one attribute");var c={},h=r.attributes;h.length=i.length;for(var p=0;p<i.length;++p){var f,d=i[p],m=h[p]=new ke,g=d.data||d;Array.isArray(g)||e(g)||H(g)?(r.buffers[p]&&(f=r.buffers[p],e(g)&&f._buffer.byteLength>=g.byteLength?f.subdata(g):(f.destroy(),r.buffers[p]=null)),r.buffers[p]||(f=r.buffers[p]=o.create(d,34962,!1,!0)),m.buffer=o.getBuffer(f),m.size=0|m.buffer.dimension,m.normalized=!1,m.type=m.buffer.dtype,m.offset=0,m.stride=0,m.divisor=0,m.state=1,c[p]=1):o.getBuffer(d)?(m.buffer=o.getBuffer(d),m.size=0|m.buffer.dimension,m.normalized=!1,m.type=m.buffer.dtype,m.offset=0,m.stride=0,m.divisor=0,m.state=1):o.getBuffer(d.buffer)?(m.buffer=o.getBuffer(d.buffer),m.size=0|(+d.size||m.buffer.dimension),m.normalized=!!d.normalized||!1,"type"in d?(E.parameter(d.type,Q,"invalid buffer type"),m.type=Q[d.type]):m.type=m.buffer.dtype,m.offset=0|(d.offset||0),m.stride=0|(d.stride||0),m.divisor=0|(d.divisor||0),m.state=1,E(m.size>=1&&m.size<=4,"size must be between 1 and 4"),E(m.offset>=0,"invalid offset"),E(m.stride>=0&&m.stride<=255,"stride must be between 0 and 255"),E(m.divisor>=0,"divisor must be positive"),E(!m.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in d?(E(p>0,"first attribute must not be a constant"),m.x=+d.x||0,m.y=+d.y||0,m.z=+d.z||0,m.w=+d.w||0,m.state=2):E(!1,"invalid attribute spec for location "+p)}for(var y=0;y<r.buffers.length;++y)!c[y]&&r.buffers[y]&&(r.buffers[y].destroy(),r.buffers[y]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var t=0;t<r.buffers.length;++t)r.buffers[t]&&r.buffers[t].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(t)},getVAO:function(t){return"function"==typeof t&&t._vao?t._vao:null},destroyBuffer:function(e){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:d()?function(t){if(t!==f.currentVAO){var e=d();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),f.currentVAO=t}}:function(e){if(e!==f.currentVAO){if(e)e.bindAttrs();else{for(var n=m(),r=0;r<l.length;++r){var i=l[r];i.buffer?(t.enableVertexAttribArray(r),i.buffer.bind(),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?t.bindBuffer(Le,s.elements.buffer.buffer):t.bindBuffer(Le,null)}f.currentVAO=e}},clear:d()?function(){W(p).forEach((function(t){t.destroy()}))}:function(){}};function d(){return n.oes_vertex_array_object}function m(){return n.angle_instanced_arrays}function g(){this.id=++h,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var t=d();this.vao=t?t.createVertexArrayOES():null,p[this.id]=this,this.buffers=[]}return g.prototype.bindAttrs=function(){for(var e=m(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(34962,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<u;++o)t.disableVertexAttribArray(o);var s=a.getElements(this.elements);s?t.bindBuffer(Le,s.buffer.buffer):t.bindBuffer(Le,null)},g.prototype.refresh=function(){var t=d();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),f.currentVAO=null,t.bindVertexArrayOES(null))},g.prototype.destroy=function(){if(this.vao){var t=d();this===f.currentVAO&&(f.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),p[this.id]&&(delete p[this.id],i.vaoCount-=1)},f}(i,p,_,h,x,b,v),S=function(t,e,r,i){var o={},a={};function s(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function u(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function l(n,r,i){var s=35632===n?o:a,u=s[r];if(!u){var l=e.str(r);u=t.createShader(n),t.shaderSource(u,l),t.compileShader(u),E.shaderError(t,u,l,n,i),s[r]=u}return u}var c={},h=[],p=0;function f(t,e){this.id=p++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,r,o){var a,c,h=l(35632,n.fragId),p=l(35633,n.vertId),f=n.program=t.createProgram();if(t.attachShader(f,h),t.attachShader(f,p),o)for(a=0;a<o.length;++a){var d=o[a];t.bindAttribLocation(f,d[0],d[1])}t.linkProgram(f),E.linkError(t,f,e.str(n.fragId),e.str(n.vertId),r);var m=t.getProgramParameter(f,35718);i.profile&&(n.stats.uniformsCount=m);var g=n.uniforms;for(a=0;a<m;++a)if(c=t.getActiveUniform(f,a))if(c.size>1)for(var y=0;y<c.size;++y){var v=c.name.replace("[0]","["+y+"]");u(g,new s(v,e.id(v),t.getUniformLocation(f,v),c))}else u(g,new s(c.name,e.id(c.name),t.getUniformLocation(f,c.name),c));var _=t.getProgramParameter(f,35721);i.profile&&(n.stats.attributesCount=_);var x=n.attributes;for(a=0;a<_;++a)(c=t.getActiveAttrib(f,a))&&u(x,new s(c.name,e.id(c.name),t.getAttribLocation(f,c.name),c))}return i.profile&&(r.getMaxUniformsCount=function(){var t=0;return h.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return h.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);W(o).forEach(e),o={},W(a).forEach(e),a={},h.forEach((function(e){t.deleteProgram(e.program)})),h.length=0,c={},r.shaderCount=0},program:function(e,i,s,u){E.command(e>=0,"missing vertex shader",s),E.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var p=l[e];if(p&&(p.refCount++,!u))return p;var m=new f(i,e);return r.shaderCount++,d(m,s,u),p||(l[e]=m),h.push(m),n(m,{destroy:function(){if(m.refCount--,m.refCount<=0){t.deleteProgram(m.program);var e=h.indexOf(m);h.splice(e,1),r.shaderCount--}l[m.vertId].refCount<=0&&(t.deleteShader(a[m.vertId]),delete a[m.vertId],delete c[m.fragId][m.vertId]),Object.keys(c[m.fragId]).length||(t.deleteShader(o[m.fragId]),delete o[m.fragId],delete c[m.fragId])}})},restore:function(){o={},a={};for(var t=0;t<h.length;++t)d(h[t],null,h[t].attributes.map((function(t){return[t.location,t.name]})))},shader:l,frag:-1,vert:-1}}(i,c,h,r),C=ge(i,p,_,(function(){A.procs.poll()}),y,h,r),M=function(t,e,n,r,i){var o={rgba4:ve,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(o.srgba=35907),e.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),e.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(t){var e=o[t];a[e]=t}));var s=0,u={};function l(t){this.id=s++,this.refCount=1,this.renderbuffer=t,this.format=ve,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(e){var n=e.renderbuffer;E(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(ye,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete u[e.id],r.renderbufferCount--}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(u).forEach((function(e){t+=u[e].stats.size})),t}),{create:function(e,s){var c=new l(t.createRenderbuffer());function h(e,r){var s=0,u=0,l=ve;if("object"==typeof e&&e){var p=e;if("shape"in p){var f=p.shape;E(Array.isArray(f)&&f.length>=2,"invalid renderbuffer shape"),s=0|f[0],u=0|f[1]}else"radius"in p&&(s=u=0|p.radius),"width"in p&&(s=0|p.width),"height"in p&&(u=0|p.height);"format"in p&&(E.parameter(p.format,o,"invalid renderbuffer format"),l=o[p.format])}else"number"==typeof e?(s=0|e,u="number"==typeof r?0|r:s):e?E.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(E(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return h.width=c.width=s,h.height=c.height=u,c.format=l,t.bindRenderbuffer(ye,c.renderbuffer),t.renderbufferStorage(ye,l,s,u),E(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=xe(c.format,c.width,c.height)),h.format=a[c.format],h}return u[c.id]=c,r.renderbufferCount++,h(e,s),h.resize=function(e,r){var o=0|e,a=0|r||o;return o===c.width&&a===c.height||(E(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=c.width=o,h.height=c.height=a,t.bindRenderbuffer(ye,c.renderbuffer),t.renderbufferStorage(ye,c.format,o,a),E(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=xe(c.format,c.width,c.height))),h},h._reglType="renderbuffer",h._renderbuffer=c,i.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h},clear:function(){W(u).forEach(c)},restore:function(){W(u).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(ye,e.renderbuffer),t.renderbufferStorage(ye,e.format,e.width,e.height)})),t.bindRenderbuffer(ye,null)}}}(i,p,_,h,r),T=function(t,e,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&l.push("srgba"),e.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),e.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function h(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function p(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function f(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);E(i===e&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=t.renderbuffer._renderbuffer;E(a.width===e&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(e,n){n&&(n.texture?t.framebufferTexture2D(be,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(be,e,we,n.renderbuffer._renderbuffer.renderbuffer))}function m(t){var e=Se,n=null,r=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),E.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,E(e===Se)):"textureCube"===o?(n=i,E(e>=Ee&&e<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,e=we):E.raise("invalid regl object for attachment"),new h(e,n,r)}function g(t,e,n,r,a){if(n){var s=i.create2D({width:t,height:e,format:r,type:a});return s._texture.refCount=0,new h(Se,s,null)}var u=o.create({width:t,height:e,format:r});return u._renderbuffer.refCount=0,new h(we,null,u)}function y(t){return t&&(t.texture||t.renderbuffer)}function v(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}e.oes_texture_half_float&&c.push("half float","float16"),e.oes_texture_float&&c.push("float","float32");var _=0,x={};function b(){this.id=_++,x[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function w(t){t.colorAttachments.forEach(p),p(t.depthAttachment),p(t.stencilAttachment),p(t.depthStencilAttachment)}function S(e){var n=e.framebuffer;E(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,a.framebufferCount--,delete x[e.id]}function C(e){var n;t.bindFramebuffer(be,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)d(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(be,36064+n,Se,null,0);t.framebufferTexture2D(be,33306,Se,null,0),t.framebufferTexture2D(be,36096,Se,null,0),t.framebufferTexture2D(be,36128,Se,null,0),d(36096,e.depthAttachment),d(36128,e.stencilAttachment),d(33306,e.depthStencilAttachment);var o=t.checkFramebufferStatus(be);t.isContextLost()||36053===o||E.raise("framebuffer configuration not supported, status = "+Pe[o]),t.bindFramebuffer(be,s.next?s.next.framebuffer:null),s.cur=s.next,t.getError()}function M(t,i){var o=new b;function h(t,n){var i;E(s.next!==o,"can not update framebuffer which is currently in use");var a=0,p=0,d=!0,v=!0,_=null,x=!0,b="rgba",S="uint8",M=1,T=null,A=null,P=null,L=!1;if("number"==typeof t)a=0|t,p=0|n||a;else if(t){E.type(t,"object","invalid arguments for framebuffer");var I=t;if("shape"in I){var k=I.shape;E(Array.isArray(k)&&k.length>=2,"invalid shape for framebuffer"),a=k[0],p=k[1]}else"radius"in I&&(a=p=I.radius),"width"in I&&(a=I.width),"height"in I&&(p=I.height);("color"in I||"colors"in I)&&(_=I.color||I.colors,Array.isArray(_)&&E(1===_.length||e.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in I&&(M=0|I.colorCount,E(M>0,"invalid color buffer count")),"colorTexture"in I&&(x=!!I.colorTexture,b="rgba4"),"colorType"in I&&(S=I.colorType,x?(E(e.oes_texture_float||!("float"===S||"float32"===S),"you must enable OES_texture_float in order to use floating point framebuffer objects"),E(e.oes_texture_half_float||!("half float"===S||"float16"===S),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===S||"float16"===S?(E(e.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),b="rgba16f"):"float"!==S&&"float32"!==S||(E(e.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),b="rgba32f"),E.oneOf(S,c,"invalid color type")),"colorFormat"in I&&(b=I.colorFormat,u.indexOf(b)>=0?x=!0:l.indexOf(b)>=0?x=!1:E.optional((function(){x?E.oneOf(I.colorFormat,u,"invalid color format for texture"):E.oneOf(I.colorFormat,l,"invalid color format for renderbuffer")})))),("depthTexture"in I||"depthStencilTexture"in I)&&(L=!(!I.depthTexture&&!I.depthStencilTexture),E(!L||e.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in I&&("boolean"==typeof I.depth?d=I.depth:(T=I.depth,v=!1)),"stencil"in I&&("boolean"==typeof I.stencil?v=I.stencil:(A=I.stencil,d=!1)),"depthStencil"in I&&("boolean"==typeof I.depthStencil?d=v=I.depthStencil:(P=I.depthStencil,d=!1,v=!1))}else a=p=1;var O=null,R=null,D=null,N=null;if(Array.isArray(_))O=_.map(m);else if(_)O=[m(_)];else for(O=new Array(M),i=0;i<M;++i)O[i]=g(a,p,x,b,S);E(e.webgl_draw_buffers||O.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),E(O.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||O[0].width,p=p||O[0].height,T?R=m(T):d&&!v&&(R=g(a,p,L,"depth","uint32")),A?D=m(A):v&&!d&&(D=g(a,p,!1,"stencil","uint8")),P?N=m(P):!T&&!A&&v&&d&&(N=g(a,p,L,"depth stencil","depth stencil")),E(!!T+!!A+!!P<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(i=0;i<O.length;++i)if(f(O[i],a,p),E(!O[i]||O[i].texture&&Ce.indexOf(O[i].texture._texture.format)>=0||O[i].renderbuffer&&Ae.indexOf(O[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),O[i]&&O[i].texture){var z=Me[O[i].texture._texture.format]*Te[O[i].texture._texture.type];null===F?F=z:E(F===z,"all color attachments much have the same number of bits per pixel.")}return f(R,a,p),E(!R||R.texture&&6402===R.texture._texture.format||R.renderbuffer&&33189===R.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),f(D,a,p),E(!D||D.renderbuffer&&36168===D.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),f(N,a,p),E(!N||N.texture&&34041===N.texture._texture.format||N.renderbuffer&&34041===N.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),w(o),o.width=a,o.height=p,o.colorAttachments=O,o.depthAttachment=R,o.stencilAttachment=D,o.depthStencilAttachment=N,h.color=O.map(y),h.depth=y(R),h.stencil=y(D),h.depthStencil=y(N),h.width=o.width,h.height=o.height,C(o),h}return a.framebufferCount++,h(t,i),n(h,{resize:function(t,e){E(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===o.width&&r===o.height)return h;for(var i=o.colorAttachments,a=0;a<i.length;++a)v(i[a],n,r);return v(o.depthAttachment,n,r),v(o.stencilAttachment,n,r),v(o.depthStencilAttachment,n,r),o.width=h.width=n,o.height=h.height=r,C(o),h},_reglType:"framebuffer",_framebuffer:o,destroy:function(){S(o),w(o)},use:function(t){s.setFBO({framebuffer:h},t)}})}return n(s,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof b)return e}return null},create:M,createCube:function(t){var o=Array(6);function a(t){var r;E(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,h={color:null},p=0,f=null,d="rgba",m="uint8",g=1;if("number"==typeof t)p=0|t;else if(t){E.type(t,"object","invalid arguments for framebuffer");var y=t;if("shape"in y){var v=y.shape;E(Array.isArray(v)&&v.length>=2,"invalid shape for framebuffer"),E(v[0]===v[1],"cube framebuffer must be square"),p=v[0]}else"radius"in y&&(p=0|y.radius),"width"in y?(p=0|y.width,"height"in y&&E(y.height===p,"must be square")):"height"in y&&(p=0|y.height);("color"in y||"colors"in y)&&(f=y.color||y.colors,Array.isArray(f)&&E(1===f.length||e.webgl_draw_buffers,"multiple render targets not supported")),f||("colorCount"in y&&(g=0|y.colorCount,E(g>0,"invalid color buffer count")),"colorType"in y&&(E.oneOf(y.colorType,c,"invalid color type"),m=y.colorType),"colorFormat"in y&&(d=y.colorFormat,E.oneOf(y.colorFormat,u,"invalid color format for texture"))),"depth"in y&&(h.depth=y.depth),"stencil"in y&&(h.stencil=y.stencil),"depthStencil"in y&&(h.depthStencil=y.depthStencil)}else p=1;if(f)if(Array.isArray(f))for(l=[],r=0;r<f.length;++r)l[r]=f[r];else l=[f];else{l=Array(g);var _={radius:p,format:d,type:m};for(r=0;r<g;++r)l[r]=i.createCube(_)}for(h.color=Array(l.length),r=0;r<l.length;++r){var x=l[r];E("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),p=p||x.width,E(x.width===p&&x.height===p,"invalid cube map shape"),h.color[r]={target:Ee,data:l[r]}}for(r=0;r<6;++r){for(var b=0;b<l.length;++b)h.color[b].target=Ee+r;r>0&&(h.depth=o[0].depth,h.stencil=o[0].stencil,h.depthStencil=o[0].depthStencil),o[r]?o[r](h):o[r]=M(h)}return n(a,{width:p,height:p,color:l})}return a(t),n(a,{faces:o,resize:function(t){var e,n=0|t;if(E(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)o[e].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(t){t.destroy()}))}})},clear:function(){W(x).forEach(S)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,W(x).forEach((function(e){e.framebuffer=t.createFramebuffer(),C(e)}))}})}(i,p,_,C,M,h),A=pr(i,c,p,_,x,b,0,T,{},w,S,v,y,f,r),P=De(i,T,A.procs.poll,y,o,p,_),O=A.next,R=i.canvas,F=[],z=[],B=[],q=[r.onDestroy],X=null;function Y(){if(0===F.length)return f&&f.update(),void(X=null);X=I.next(Y),bt();for(var t=F.length-1;t>=0;--t){var e=F[t];e&&e(y,null,0)}i.flush(),f&&f.update()}function K(){!X&&F.length>0&&(X=I.next(Y))}function pt(){X&&(I.cancel(Y),X=null)}function ft(t){t.preventDefault(),a=!0,pt(),z.forEach((function(t){t()}))}function dt(t){i.getError(),a=!1,s.restore(),S.restore(),x.restore(),C.restore(),M.restore(),T.restore(),w.restore(),f&&f.restore(),A.procs.refresh(),K(),B.forEach((function(t){t()}))}var mt="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;function gt(t){function e(t,e){var n={},r={};return Object.keys(t).forEach((function(i){var o=t[i];if(L.isDynamic(o))r[i]=L.unbox(o,i);else{if(e&&Array.isArray(o))for(var a=0;a<o.length;++a)if(L.isDynamic(o[a]))return void(r[i]=L.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}E(!!t,"invalid args to regl({...})"),E.type(t,"object","invalid args to regl({...})");var r=e(t.context||{},!0),i=e(t.uniforms||{},!0),o=e(t.attributes||{},!1),s=e(function(t){var e=n({},t);function r(t){if(t in e){var n=e[t];delete e[t],Object.keys(n).forEach((function(r){e[t+"."+r]=n[r]}))}}return delete e.uniforms,delete e.attributes,delete e.context,delete e.vao,"stencil"in e&&e.stencil.op&&(e.stencil.opBack=e.stencil.opFront=e.stencil.op,delete e.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(e.vao=t.vao),e}(t),!1),u={gpuTime:0,cpuTime:0,count:0},l=A.compile(s,o,i,r,u),c=l.draw,h=l.batch,p=l.scope,f=[];return n((function(t,e){var n;if(a&&E.raise("context lost"),"function"==typeof t)return p.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)p.call(this,null,e,n);else{if(!Array.isArray(t))return p.call(this,t,e,0);for(n=0;n<t.length;++n)p.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return h.call(this,function(t){for(;f.length<t;)f.push(null);return f}(0|t),0|t)}else{if(!Array.isArray(t))return c.call(this,t);if(t.length)return h.call(this,t,t.length)}}),{stats:u,destroy:function(){l.destroy()}})}!mt&&R&&(R.addEventListener(dr,ft,!1),R.addEventListener(mr,dt,!1));var yt=T.setFBO=gt({framebuffer:L.define.call(null,1,"framebuffer")});function vt(t,e){var n=0;A.procs.poll();var r=e.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in e&&(i.clearDepth(+e.depth),n|=256),"stencil"in e&&(i.clearStencil(0|e.stencil),n|=1024),E(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function _t(t){return E.type(t,"function","regl.frame() callback must be a function"),F.push(t),K(),{cancel:function(){var e=gr(F,t);E(e>=0,"cannot cancel a frame twice"),F[e]=function t(){var e=gr(F,t);F[e]=F[F.length-1],F.length-=1,F.length<=0&&pt()}}}}function xt(){var t=O.viewport,e=O.scissor_box;t[0]=t[1]=e[0]=e[1]=0,y.viewportWidth=y.framebufferWidth=y.drawingBufferWidth=t[2]=e[2]=i.drawingBufferWidth,y.viewportHeight=y.framebufferHeight=y.drawingBufferHeight=t[3]=e[3]=i.drawingBufferHeight}function bt(){y.tick+=1,y.time=St(),xt(),A.procs.poll()}function wt(){C.refresh(),xt(),A.procs.refresh(),f&&f.update()}function St(){return(k()-d)/1e3}wt();var Et=n(gt,{clear:function(t){if(E("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var e=0;e<6;++e)yt(n({framebuffer:t.framebuffer.faces[e]},t),vt);else yt(t,vt);else vt(0,t)},prop:L.define.bind(null,1),context:L.define.bind(null,2),this:L.define.bind(null,3),draw:gt({}),buffer:function(t){return x.create(t,34962,!1,!1)},elements:function(t){return b.create(t,!1)},texture:C.create2D,cube:C.createCube,renderbuffer:M.create,framebuffer:T.create,framebufferCube:T.createCube,vao:w.createVAO,attributes:o,frame:_t,on:function(t,e){var n;switch(E.type(e,"function","listener callback must be a function"),t){case"frame":return _t(e);case"lost":n=z;break;case"restore":n=B;break;case"destroy":n=q;break;default:E.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}},limits:_,hasExtension:function(t){return _.extensions.indexOf(t.toLowerCase())>=0},read:P,destroy:function(){F.length=0,pt(),!mt&&R&&(R.removeEventListener(dr,ft),R.removeEventListener(mr,dt)),S.clear(),T.clear(),M.clear(),w.clear(),C.clear(),b.clear(),x.clear(),f&&f.clear(),q.forEach((function(t){t()}))},_gl:i,_refresh:wt,poll:function(){bt(),f&&f.update()},now:St,stats:h});return r.onDone(null,Et),Et}}(n(9946))},4466:(t,e,n)=>{var r=n(5234)(n(3250),"DataView");t.exports=r},5208:(t,e,n)=>{var r=n(4440),i=n(4108),o=n(1085),a=n(7706),s=n(8636);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},1998:(t,e,n)=>{var r=n(266),i=n(2875),o=n(5828),a=n(4115),s=n(7690);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},2887:(t,e,n)=>{var r=n(5234)(n(3250),"Map");t.exports=r},5678:(t,e,n)=>{var r=n(9016),i=n(2363),o=n(4348),a=n(3062),s=n(262);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},5747:(t,e,n)=>{var r=n(5234)(n(3250),"Promise");t.exports=r},6616:(t,e,n)=>{var r=n(5234)(n(3250),"Set");t.exports=r},9549:(t,e,n)=>{var r=n(1998),i=n(3210),o=n(8603),a=n(8947),s=n(885),u=n(8938);function l(t){var e=this.__data__=new r(t);this.size=e.size}l.prototype.clear=i,l.prototype.delete=o,l.prototype.get=a,l.prototype.has=s,l.prototype.set=u,t.exports=l},861:(t,e,n)=>{var r=n(3250).Symbol;t.exports=r},3526:(t,e,n)=>{var r=n(3250).Uint8Array;t.exports=r},8001:(t,e,n)=>{var r=n(5234)(n(3250),"WeakMap");t.exports=r},2274:t=>{t.exports=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}},4004:t=>{t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},2493:t=>{t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}},5825:(t,e,n)=>{var r=n(8509),i=n(9312),o=n(5589),a=n(5778),s=n(5023),u=n(922),l=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=o(t),c=!n&&i(t),h=!n&&!c&&a(t),p=!n&&!c&&!h&&u(t),f=n||c||h||p,d=f?r(t.length,String):[],m=d.length;for(var g in t)!e&&!l.call(t,g)||f&&("length"==g||h&&("offset"==g||"parent"==g)||p&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,m))||d.push(g);return d}},111:t=>{t.exports=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}},3532:(t,e,n)=>{var r=n(7500),i=n(8260);t.exports=function(t,e,n){(void 0!==n&&!i(t[e],n)||void 0===n&&!(e in t))&&r(t,e,n)}},3192:(t,e,n)=>{var r=n(7500),i=n(8260),o=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];o.call(t,e)&&i(a,n)&&(void 0!==n||e in t)||r(t,e,n)}},8498:(t,e,n)=>{var r=n(8260);t.exports=function(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}},4265:(t,e,n)=>{var r=n(8618),i=n(2096);t.exports=function(t,e){return t&&r(e,i(e),t)}},1629:(t,e,n)=>{var r=n(8618),i=n(9882);t.exports=function(t,e){return t&&r(e,i(e),t)}},7500:(t,e,n)=>{var r=n(5595);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},8361:(t,e,n)=>{var r=n(9549),i=n(4004),o=n(3192),a=n(4265),s=n(1629),u=n(6502),l=n(2166),c=n(7272),h=n(2066),p=n(4357),f=n(5713),d=n(7493),m=n(2865),g=n(1908),y=n(4046),v=n(5589),_=n(5778),x=n(7613),b=n(3702),w=n(693),S=n(2096),E=n(9882),C="[object Arguments]",M="[object Function]",T="[object Object]",A={};A[C]=A["[object Array]"]=A["[object ArrayBuffer]"]=A["[object DataView]"]=A["[object Boolean]"]=A["[object Date]"]=A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Map]"]=A["[object Number]"]=A[T]=A["[object RegExp]"]=A["[object Set]"]=A["[object String]"]=A["[object Symbol]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A["[object Error]"]=A[M]=A["[object WeakMap]"]=!1,t.exports=function t(e,n,P,L,I,k){var O,R=1&n,D=2&n,N=4&n;if(P&&(O=I?P(e,L,I,k):P(e)),void 0!==O)return O;if(!b(e))return e;var F=v(e);if(F){if(O=m(e),!R)return l(e,O)}else{var z=d(e),B=z==M||"[object GeneratorFunction]"==z;if(_(e))return u(e,R);if(z==T||z==C||B&&!I){if(O=D||B?{}:y(e),!R)return D?h(e,s(O,e)):c(e,a(O,e))}else{if(!A[z])return I?e:{};O=g(e,z,R)}}k||(k=new r);var j=k.get(e);if(j)return j;k.set(e,O),w(e)?e.forEach((function(r){O.add(t(r,n,P,r,e,k))})):x(e)&&e.forEach((function(r,i){O.set(i,t(r,n,P,i,e,k))}));var U=F?void 0:(N?D?f:p:D?E:S)(e);return i(U||e,(function(r,i){U&&(r=e[i=r]),o(O,i,t(r,n,P,i,e,k))})),O}},7890:(t,e,n)=>{var r=n(3702),i=Object.create,o=function(){function t(){}return function(e){if(!r(e))return{};if(i)return i(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=o},2825:(t,e,n)=>{var r=n(111),i=n(7123);t.exports=function t(e,n,o,a,s){var u=-1,l=e.length;for(o||(o=i),s||(s=[]);++u<l;){var c=e[u];n>0&&o(c)?n>1?t(c,n-1,o,a,s):r(s,c):a||(s[s.length]=c)}return s}},9943:(t,e,n)=>{var r=n(2545)();t.exports=r},4468:(t,e,n)=>{var r=n(111),i=n(5589);t.exports=function(t,e,n){var o=e(t);return i(t)?o:r(o,n(t))}},9823:(t,e,n)=>{var r=n(861),i=n(1339),o=n(5151),a=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":a&&a in Object(t)?i(t):o(t)}},3016:(t,e,n)=>{var r=n(9823),i=n(440);t.exports=function(t){return i(t)&&"[object Arguments]"==r(t)}},2275:(t,e,n)=>{var r=n(7493),i=n(440);t.exports=function(t){return i(t)&&"[object Map]"==r(t)}},9817:(t,e,n)=>{var r=n(5563),i=n(8597),o=n(3702),a=n(5784),s=/^\[object .+?Constructor\]$/,u=Function.prototype,l=Object.prototype,c=u.toString,h=l.hasOwnProperty,p=RegExp("^"+c.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!o(t)||i(t))&&(r(t)?p:s).test(a(t))}},7170:(t,e,n)=>{var r=n(7493),i=n(440);t.exports=function(t){return i(t)&&"[object Set]"==r(t)}},2448:(t,e,n)=>{var r=n(9823),i=n(6052),o=n(440),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return o(t)&&i(t.length)&&!!a[r(t)]}},1351:(t,e,n)=>{var r=n(2840),i=n(8559),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return i(t);var e=[];for(var n in Object(t))o.call(t,n)&&"constructor"!=n&&e.push(n);return e}},1309:(t,e,n)=>{var r=n(3702),i=n(2840),o=n(4866),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=i(t),n=[];for(var s in t)("constructor"!=s||!e&&a.call(t,s))&&n.push(s);return n}},2133:(t,e,n)=>{var r=n(9549),i=n(3532),o=n(9943),a=n(1241),s=n(3702),u=n(9882),l=n(1933);t.exports=function t(e,n,c,h,p){e!==n&&o(n,(function(o,u){if(p||(p=new r),s(o))a(e,n,u,c,t,h,p);else{var f=h?h(l(e,u),o,u+"",e,n,p):void 0;void 0===f&&(f=o),i(e,u,f)}}),u)}},1241:(t,e,n)=>{var r=n(3532),i=n(6502),o=n(1327),a=n(2166),s=n(4046),u=n(9312),l=n(5589),c=n(8268),h=n(5778),p=n(5563),f=n(3702),d=n(4256),m=n(922),g=n(1933),y=n(6222);t.exports=function(t,e,n,v,_,x,b){var w=g(t,n),S=g(e,n),E=b.get(S);if(E)r(t,n,E);else{var C=x?x(w,S,n+"",t,e,b):void 0,M=void 0===C;if(M){var T=l(S),A=!T&&h(S),P=!T&&!A&&m(S);C=S,T||A||P?l(w)?C=w:c(w)?C=a(w):A?(M=!1,C=i(S,!0)):P?(M=!1,C=o(S,!0)):C=[]:d(S)||u(S)?(C=w,u(w)?C=y(w):f(w)&&!p(w)||(C=s(S))):M=!1}M&&(b.set(S,C),_(C,S,v,x,b),b.delete(S)),r(t,n,C)}}},9735:(t,e,n)=>{var r=n(229),i=n(340),o=n(4173);t.exports=function(t,e){return o(i(t,e,r),t+"")}},6739:(t,e,n)=>{var r=n(9203),i=n(5595),o=n(229),a=i?function(t,e){return i(t,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:o;t.exports=a},8509:t=>{t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},1525:t=>{t.exports=function(t){return function(e){return t(e)}}},2962:(t,e,n)=>{var r=n(3526);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},6502:(t,e,n)=>{t=n.nmd(t);var r=n(3250),i=e&&!e.nodeType&&e,o=i&&t&&!t.nodeType&&t,a=o&&o.exports===i?r.Buffer:void 0,s=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=s?s(n):new t.constructor(n);return t.copy(r),r}},7037:(t,e,n)=>{var r=n(2962);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},3429:t=>{var e=/\w*$/;t.exports=function(t){var n=new t.constructor(t.source,e.exec(t));return n.lastIndex=t.lastIndex,n}},4539:(t,e,n)=>{var r=n(861),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;t.exports=function(t){return o?Object(o.call(t)):{}}},1327:(t,e,n)=>{var r=n(2962);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},2166:t=>{t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},8618:(t,e,n)=>{var r=n(3192),i=n(7500);t.exports=function(t,e,n,o){var a=!n;n||(n={});for(var s=-1,u=e.length;++s<u;){var l=e[s],c=o?o(n[l],t[l],l,n,t):void 0;void 0===c&&(c=t[l]),a?i(n,l,c):r(n,l,c)}return n}},7272:(t,e,n)=>{var r=n(8618),i=n(4450);t.exports=function(t,e){return r(t,i(t),e)}},2066:(t,e,n)=>{var r=n(8618),i=n(4969);t.exports=function(t,e){return r(t,i(t),e)}},1622:(t,e,n)=>{var r=n(3250)["__core-js_shared__"];t.exports=r},6948:(t,e,n)=>{var r=n(9735),i=n(8132);t.exports=function(t){return r((function(e,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;for(a=t.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(n[0],n[1],s)&&(a=o<3?void 0:a,o=1),e=Object(e);++r<o;){var u=n[r];u&&t(e,u,r,a)}return e}))}},2545:t=>{t.exports=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}},5595:(t,e,n)=>{var r=n(5234),i=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=i},302:(t,e,n)=>{var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;t.exports=r},4357:(t,e,n)=>{var r=n(4468),i=n(4450),o=n(2096);t.exports=function(t){return r(t,o,i)}},5713:(t,e,n)=>{var r=n(4468),i=n(4969),o=n(9882);t.exports=function(t){return r(t,o,i)}},7570:(t,e,n)=>{var r=n(8949);t.exports=function(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}},5234:(t,e,n)=>{var r=n(9817),i=n(7736);t.exports=function(t,e){var n=i(t,e);return r(n)?n:void 0}},8490:(t,e,n)=>{var r=n(3540)(Object.getPrototypeOf,Object);t.exports=r},1339:(t,e,n)=>{var r=n(861),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;t.exports=function(t){var e=o.call(t,s),n=t[s];try{t[s]=void 0;var r=!0}catch(t){}var i=a.call(t);return r&&(e?t[s]=n:delete t[s]),i}},4450:(t,e,n)=>{var r=n(2493),i=n(4506),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(t){return null==t?[]:(t=Object(t),r(a(t),(function(e){return o.call(t,e)})))}:i;t.exports=s},4969:(t,e,n)=>{var r=n(111),i=n(8490),o=n(4450),a=n(4506),s=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,o(t)),t=i(t);return e}:a;t.exports=s},7493:(t,e,n)=>{var r=n(4466),i=n(2887),o=n(5747),a=n(6616),s=n(8001),u=n(9823),l=n(5784),c="[object Map]",h="[object Promise]",p="[object Set]",f="[object WeakMap]",d="[object DataView]",m=l(r),g=l(i),y=l(o),v=l(a),_=l(s),x=u;(r&&x(new r(new ArrayBuffer(1)))!=d||i&&x(new i)!=c||o&&x(o.resolve())!=h||a&&x(new a)!=p||s&&x(new s)!=f)&&(x=function(t){var e=u(t),n="[object Object]"==e?t.constructor:void 0,r=n?l(n):"";if(r)switch(r){case m:return d;case g:return c;case y:return h;case v:return p;case _:return f}return e}),t.exports=x},7736:t=>{t.exports=function(t,e){return null==t?void 0:t[e]}},4440:(t,e,n)=>{var r=n(4545);t.exports=function(){this.__data__=r?r(null):{},this.size=0}},4108:t=>{t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},1085:(t,e,n)=>{var r=n(4545),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(r){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(e,t)?e[t]:void 0}},7706:(t,e,n)=>{var r=n(4545),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return r?void 0!==e[t]:i.call(e,t)}},8636:(t,e,n)=>{var r=n(4545);t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?"__lodash_hash_undefined__":e,this}},2865:t=>{var e=Object.prototype.hasOwnProperty;t.exports=function(t){var n=t.length,r=new t.constructor(n);return n&&"string"==typeof t[0]&&e.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},1908:(t,e,n)=>{var r=n(2962),i=n(7037),o=n(3429),a=n(4539),s=n(1327);t.exports=function(t,e,n){var u=t.constructor;switch(e){case"[object ArrayBuffer]":return r(t);case"[object Boolean]":case"[object Date]":return new u(+t);case"[object DataView]":return i(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(t,n);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(t);case"[object RegExp]":return o(t);case"[object Symbol]":return a(t)}}},4046:(t,e,n)=>{var r=n(7890),i=n(8490),o=n(2840);t.exports=function(t){return"function"!=typeof t.constructor||o(t)?{}:r(i(t))}},7123:(t,e,n)=>{var r=n(861),i=n(9312),o=n(5589),a=r?r.isConcatSpreadable:void 0;t.exports=function(t){return o(t)||i(t)||!!(a&&t&&t[a])}},5023:t=>{var e=/^(?:0|[1-9]\d*)$/;t.exports=function(t,n){var r=typeof t;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&e.test(t))&&t>-1&&t%1==0&&t<n}},8132:(t,e,n)=>{var r=n(8260),i=n(568),o=n(5023),a=n(3702);t.exports=function(t,e,n){if(!a(n))return!1;var s=typeof e;return!!("number"==s?i(n)&&o(e,n.length):"string"==s&&e in n)&&r(n[e],t)}},8949:t=>{t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},8597:(t,e,n)=>{var r,i=n(1622),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!o&&o in t}},2840:t=>{var e=Object.prototype;t.exports=function(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||e)}},266:t=>{t.exports=function(){this.__data__=[],this.size=0}},2875:(t,e,n)=>{var r=n(8498),i=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=r(e,t);return!(n<0||(n==e.length-1?e.pop():i.call(e,n,1),--this.size,0))}},5828:(t,e,n)=>{var r=n(8498);t.exports=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}},4115:(t,e,n)=>{var r=n(8498);t.exports=function(t){return r(this.__data__,t)>-1}},7690:(t,e,n)=>{var r=n(8498);t.exports=function(t,e){var n=this.__data__,i=r(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}},9016:(t,e,n)=>{var r=n(5208),i=n(1998),o=n(2887);t.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},2363:(t,e,n)=>{var r=n(7570);t.exports=function(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}},4348:(t,e,n)=>{var r=n(7570);t.exports=function(t){return r(this,t).get(t)}},3062:(t,e,n)=>{var r=n(7570);t.exports=function(t){return r(this,t).has(t)}},262:(t,e,n)=>{var r=n(7570);t.exports=function(t,e){var n=r(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}},4545:(t,e,n)=>{var r=n(5234)(Object,"create");t.exports=r},8559:(t,e,n)=>{var r=n(3540)(Object.keys,Object);t.exports=r},4866:t=>{t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},8690:(t,e,n)=>{t=n.nmd(t);var r=n(302),i=e&&!e.nodeType&&e,o=i&&t&&!t.nodeType&&t,a=o&&o.exports===i&&r.process,s=function(){try{return o&&o.require&&o.require("util").types||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=s},5151:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},3540:t=>{t.exports=function(t,e){return function(n){return t(e(n))}}},340:(t,e,n)=>{var r=n(2274),i=Math.max;t.exports=function(t,e,n){return e=i(void 0===e?t.length-1:e,0),function(){for(var o=arguments,a=-1,s=i(o.length-e,0),u=Array(s);++a<s;)u[a]=o[e+a];a=-1;for(var l=Array(e+1);++a<e;)l[a]=o[a];return l[e]=n(u),r(t,this,l)}}},3250:(t,e,n)=>{var r=n(302),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();t.exports=o},1933:t=>{t.exports=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}},4173:(t,e,n)=>{var r=n(6739),i=n(7357)(r);t.exports=i},7357:t=>{var e=Date.now;t.exports=function(t){var n=0,r=0;return function(){var i=e(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(void 0,arguments)}}},3210:(t,e,n)=>{var r=n(1998);t.exports=function(){this.__data__=new r,this.size=0}},8603:t=>{t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},8947:t=>{t.exports=function(t){return this.__data__.get(t)}},885:t=>{t.exports=function(t){return this.__data__.has(t)}},8938:(t,e,n)=>{var r=n(1998),i=n(2887),o=n(5678);t.exports=function(t,e){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([t,e]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(t,e),this.size=n.size,this}},5784:t=>{var e=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return e.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},7179:(t,e,n)=>{var r=n(8361);t.exports=function(t){return r(t,5)}},9203:t=>{t.exports=function(t){return function(){return t}}},8260:t=>{t.exports=function(t,e){return t===e||t!=t&&e!=e}},2923:(t,e,n)=>{var r=n(2825);t.exports=function(t){return null!=t&&t.length?r(t,1):[]}},229:t=>{t.exports=function(t){return t}},9312:(t,e,n)=>{var r=n(3016),i=n(440),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(t){return i(t)&&a.call(t,"callee")&&!s.call(t,"callee")};t.exports=u},5589:t=>{var e=Array.isArray;t.exports=e},568:(t,e,n)=>{var r=n(5563),i=n(6052);t.exports=function(t){return null!=t&&i(t.length)&&!r(t)}},8268:(t,e,n)=>{var r=n(568),i=n(440);t.exports=function(t){return i(t)&&r(t)}},5778:(t,e,n)=>{t=n.nmd(t);var r=n(3250),i=n(7999),o=e&&!e.nodeType&&e,a=o&&t&&!t.nodeType&&t,s=a&&a.exports===o?r.Buffer:void 0,u=(s?s.isBuffer:void 0)||i;t.exports=u},5563:(t,e,n)=>{var r=n(9823),i=n(3702);t.exports=function(t){if(!i(t))return!1;var e=r(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},6052:t=>{t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},7613:(t,e,n)=>{var r=n(2275),i=n(1525),o=n(8690),a=o&&o.isMap,s=a?i(a):r;t.exports=s},3702:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},440:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},4256:(t,e,n)=>{var r=n(9823),i=n(8490),o=n(440),a=Function.prototype,s=Object.prototype,u=a.toString,l=s.hasOwnProperty,c=u.call(Object);t.exports=function(t){if(!o(t)||"[object Object]"!=r(t))return!1;var e=i(t);if(null===e)return!0;var n=l.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==c}},693:(t,e,n)=>{var r=n(7170),i=n(1525),o=n(8690),a=o&&o.isSet,s=a?i(a):r;t.exports=s},922:(t,e,n)=>{var r=n(2448),i=n(1525),o=n(8690),a=o&&o.isTypedArray,s=a?i(a):r;t.exports=s},2096:(t,e,n)=>{var r=n(5825),i=n(1351),o=n(568);t.exports=function(t){return o(t)?r(t):i(t)}},9882:(t,e,n)=>{var r=n(5825),i=n(1309),o=n(568);t.exports=function(t){return o(t)?r(t,!0):i(t)}},8469:(t,e,n)=>{var r=n(2133),i=n(6948)((function(t,e,n){r(t,e,n)}));t.exports=i},4506:t=>{t.exports=function(){return[]}},7999:t=>{t.exports=function(){return!1}},6222:(t,e,n)=>{var r=n(8618),i=n(9882);t.exports=function(t){return r(t,i(t))}},6172:function(t){t.exports=function(){"use strict";var t,e,n;function r(r,i){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),n=i(a),"undefined"!=typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=i;else t=i}return r(0,(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=r;function r(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}r.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},r.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},r.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},r.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},r.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=o;function o(t,e){this.x=t,this.y=e}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var a="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1;function u(t,e,r,i){var o=new n(t,e,r,i);return function(t){return o.solve(t)}}var l=u(.25,.1,.25,1);function c(t,e,n){return Math.min(n,Math.max(e,t))}function h(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function p(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}var f=1;function d(){return f++}function m(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function g(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function y(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function v(t,e){return-1!==t.indexOf(e,t.length-e.length)}function _(t,e,n){var r={};for(var i in t)r[i]=e.call(n||this,t[i],i,t);return r}function x(t,e,n){var r={};for(var i in t)e.call(n||this,t[i],i,t)&&(r[i]=t[i]);return r}function b(t){return Array.isArray(t)?t.map(b):"object"==typeof t&&t?_(t,b):t}var w={};function S(t){w[t]||("undefined"!=typeof console&&console.warn(t),w[t]=!0)}function E(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function C(t){for(var e=0,n=0,r=t.length,i=r-1,o=void 0,a=void 0;n<r;i=n++)e+=((a=t[i]).x-(o=t[n]).x)*(o.y+a.y);return e}function M(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function T(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,n,r,i){var o=r||i;return e[n]=!o||o.toLowerCase(),""})),e["max-age"]){var n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}var A=null;function P(t){if(null==A){var e=t.navigator?t.navigator.userAgent:null;A=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return A}function L(t){try{var e=a[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var I,k,O,R,D=a.performance&&a.performance.now?a.performance.now.bind(a.performance):Date.now.bind(Date),N=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,F=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame,z={now:D,frame:function(t){var e=N(t);return{cancel:function(){return F(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var n=a.document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return I||(I=a.document.createElement("a")),I.href=t,I.href},hardwareConcurrency:a.navigator&&a.navigator.hardwareConcurrency||4,get devicePixelRatio(){return a.devicePixelRatio},get prefersReducedMotion(){return!!a.matchMedia&&(null==k&&(k=a.matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}},B={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},j={supported:!1,testSupport:function(t){!U&&R&&(Z?V(t):O=t)}},U=!1,Z=!1;function V(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,R),t.isContextLost())return;j.supported=!0}catch(t){}t.deleteTexture(e),U=!0}a.document&&((R=a.document.createElement("img")).onload=function(){O&&V(O),O=null,Z=!0},R.onerror=function(){U=!0,O=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var G="01",H=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function W(t){return 0===t.indexOf("mapbox:")}H.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",G,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},H.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},H.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},H.prototype.normalizeStyleURL=function(t,e){if(!W(t))return t;var n=K(t);return n.path="/styles/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},H.prototype.normalizeGlyphsURL=function(t,e){if(!W(t))return t;var n=K(t);return n.path="/fonts/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},H.prototype.normalizeSourceURL=function(t,e){if(!W(t))return t;var n=K(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)},H.prototype.normalizeSpriteURL=function(t,e,n,r){var i=K(t);return W(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+n,this._makeAPIURL(i,this._customAccessToken||r)):(i.path+=""+e+n,Q(i))},H.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!W(t))return t;var n=K(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,(z.devicePixelRatio>=2||512===e?"@2x":"")+(j.supported?".webp":"$1")),n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/v4"+n.path;var r=this._customAccessToken||function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e].match(/^access_token=(.*)$/);if(r)return r[1]}return null}(n.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push("sku="+this._skuToken),this._makeAPIURL(n,r)},H.prototype.canonicalizeTileURL=function(t,e){var n=K(t);if(!n.path.match(/(^\/v4\/)/)||!n.path.match(/\.[\w]+$/))return t;var r="mapbox://tiles/";r+=n.path.replace("/v4/","");var i=n.params;return e&&(i=i.filter((function(t){return!t.match(/^access_token=/)}))),i.length&&(r+="?"+i.join("&")),r},H.prototype.canonicalizeTileset=function(t,e){for(var n=!!e&&W(e),r=[],i=0,o=t.tiles||[];i<o.length;i+=1){var a=o[i];X(a)?r.push(this.canonicalizeTileURL(a,n)):r.push(a)}return r},H.prototype._makeAPIURL=function(t,e){var n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=K(B.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){var i=t.params.indexOf("secure");i>=0&&t.params.splice(i,1)}if("/"!==r.path&&(t.path=""+r.path+t.path),!B.REQUIRE_ACCESS_TOKEN)return Q(t);if(!(e=e||B.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),Q(t)};var q=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function X(t){return q.test(t)}var Y=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function K(t){var e=t.match(Y);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Q(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function J(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(a.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var $=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};$.prototype.getStorageKey=function(t){var e,n=J(B.ACCESS_TOKEN);return e=n&&n.u?a.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):B.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},$.prototype.fetchEventData=function(){var t=L("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{var r=a.localStorage.getItem(e);r&&(this.eventData=JSON.parse(r));var i=a.localStorage.getItem(n);i&&(this.anonId=i)}catch(t){S("Unable to read from LocalStorage")}},$.prototype.saveEventData=function(){var t=L("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{a.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&a.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){S("Unable to write to LocalStorage")}},$.prototype.processRequests=function(t){},$.prototype.postEvent=function(t,e,n,r){var i=this;if(B.EVENTS_URL){var o=K(B.EVENTS_URL);o.params.push("access_token="+(r||B.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:G,userId:this.anonId},s=e?p(a,e):a,u={url:Q(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=bt(u,(function(t){i.pendingRequest=null,n(t),i.saveEventData(),i.processRequests(r)}))}},$.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var tt,et,nt=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,n,r){this.skuToken=n,(B.EVENTS_URL&&r||B.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return W(t)||X(t)})))&&this.queueRequest({id:e,timestamp:Date.now()},r)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),r=n.id,i=n.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),g(this.anonId)||(this.anonId=m()),this.postEvent(i,{skuToken:this.skuToken},(function(t){t||r&&(e.success[r]=!0)}),t))}},e}($),rt=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return W(t)||X(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=J(B.ACCESS_TOKEN),r=n?n.u:B.ACCESS_TOKEN,i=r!==this.eventData.tokenU;g(this.anonId)||(this.anonId=m(),i=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),u=(o-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||a.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=r)}),t)}},e}($)),it=rt.postTurnstileEvent.bind(rt),ot=new nt,at=ot.postMapLoadEvent.bind(ot),st=500,ut=50;function lt(){a.caches&&!tt&&(tt=a.caches.open("mapbox-tiles"))}function ct(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ht,pt=1/0;function ft(){return null==ht&&(ht=a.OffscreenCanvas&&new a.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.createImageBitmap),ht}var dt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(dt);var mt,gt,yt=function(t){function e(e,n,r){401===n&&X(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=n,this.url=r,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),vt=M()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===a.location.protocol?a.parent:a).location.href},_t=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(vt())&&!/^\w+:/.test(n))){if(a.fetch&&a.Request&&a.AbortController&&a.Request.prototype.hasOwnProperty("signal"))return function(t,e){var n,r=new a.AbortController,i=new a.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:vt(),signal:r.signal}),o=!1,s=!1,u=(n=i.url).indexOf("sku=")>0&&X(n);"json"===t.type&&i.headers.set("Accept","application/json");var l=function(n,r,o){if(!s){if(n&&"SecurityError"!==n.message&&S(n),r&&o)return c(r);var l=Date.now();a.fetch(i).then((function(n){if(n.ok){var r=u?n.clone():null;return c(n,r,l)}return e(new yt(n.statusText,n.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},c=function(n,r,u){("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then((function(t){s||(r&&u&&function(t,e,n){if(lt(),tt){var r={status:e.status,statusText:e.statusText,headers:new a.Headers};e.headers.forEach((function(t,e){return r.headers.set(e,t)}));var i=T(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-n<42e4||function(t,e){if(void 0===et)try{new Response(new ReadableStream),et=!0}catch(t){et=!1}et?e(t.body):t.blob().then(e)}(e,(function(e){var n=new a.Response(e,r);lt(),tt&&tt.then((function(e){return e.put(ct(t.url),n)})).catch((function(t){return S(t.message)}))})))}}(i,r,u),o=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((function(t){s||e(new Error(t.message))}))};return u?function(t,e){if(lt(),!tt)return e(null);var n=ct(t.url);tt.then((function(t){t.match(n).then((function(r){var i=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),n=T(t.headers.get("Cache-Control")||"");return e>Date.now()&&!n["no-cache"]}(r);t.delete(n),i&&t.put(n,r.clone()),e(null,r,i)})).catch(e)})).catch(e)}(i,l):l(null,null),{cancel:function(){s=!0,o||r.abort()}}}(t,e);if(M()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){var n=new a.XMLHttpRequest;for(var r in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(r,t.headers[r]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var r=n.response;if("json"===t.type)try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new yt(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}}(t,e)},xt=function(t,e){return _t(p(t,{type:"arrayBuffer"}),e)},bt=function(t,e){return _t(p(t,{method:"POST"}),e)},wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";mt=[],gt=0;var St=function(t,e){if(j.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),gt>=B.MAX_PARALLEL_IMAGE_REQUESTS){var n={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return mt.push(n),n}gt++;var r=!1,i=function(){if(!r)for(r=!0,gt--;mt.length&&gt<B.MAX_PARALLEL_IMAGE_REQUESTS;){var t=mt.shift();t.cancelled||(t.cancel=St(t.requestParameters,t.callback).cancel)}},o=xt(t,(function(t,n,r,o){i(),t?e(t):n&&(ft()?function(t,e){var n=new a.Blob([new Uint8Array(t)],{type:"image/png"});a.createImageBitmap(n).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(n,e):function(t,e,n,r){var i=new a.Image,o=a.URL;i.onload=function(){e(null,i),o.revokeObjectURL(i.src),i.onload=null,a.requestAnimationFrame((function(){i.src=wt}))},i.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new a.Blob([new Uint8Array(t)],{type:"image/png"});i.cacheControl=n,i.expires=r,i.src=t.byteLength?o.createObjectURL(s):wt}(n,e,r,o))}));return{cancel:function(){o.cancel(),i()}}};function Et(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Ct(t,e,n){if(n&&n[t]){var r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}var Mt=function(t,e){void 0===e&&(e={}),p(this,e),this.type=t},Tt=function(t){function e(e,n){void 0===n&&(n={}),t.call(this,"error",p({error:e},n))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Mt),At=function(){};At.prototype.on=function(t,e){return this._listeners=this._listeners||{},Et(t,e,this._listeners),this},At.prototype.off=function(t,e){return Ct(t,e,this._listeners),Ct(t,e,this._oneTimeListeners),this},At.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},Et(t,e,this._oneTimeListeners),this},At.prototype.fire=function(t,e){"string"==typeof t&&(t=new Mt(t,e||{}));var n=t.type;if(this.listens(n)){t.target=this;for(var r=0,i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];r<i.length;r+=1)i[r].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];o<a.length;o+=1){var s=a[o];Ct(n,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(p(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof Tt&&console.error(t.error);return this},At.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},At.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Pt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Lt=function(t,e,n,r){this.message=(t?t+": ":"")+n,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)};function It(t){var e=t.value;return e?[new Lt(t.key,e,"constants have been deprecated as of v8")]:[]}function kt(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}function Ot(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Rt(t){if(Array.isArray(t))return t.map(Rt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var n in t)e[n]=Rt(t[n]);return e}return Ot(t)}var Dt=function(t){function e(e,n){t.call(this,n),this.message=n,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Nt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var n=0,r=e;n<r.length;n+=1){var i=r[n];this.bindings[i[0]]=i[1]}};Nt.prototype.concat=function(t){return new Nt(this,t)},Nt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Nt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Ft={kind:"null"},zt={kind:"number"},Bt={kind:"string"},jt={kind:"boolean"},Ut={kind:"color"},Zt={kind:"object"},Vt={kind:"value"},Gt={kind:"collator"},Ht={kind:"formatted"},Wt={kind:"resolvedImage"};function qt(t,e){return{kind:"array",itemType:t,N:e}}function Xt(t){if("array"===t.kind){var e=Xt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Yt=[Ft,zt,Bt,jt,Ut,Ht,Zt,qt(Vt),Wt];function Kt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Kt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var n=0,r=Yt;n<r.length;n+=1)if(!Kt(r[n],e))return null}return"Expected "+Xt(t)+" but found "+Xt(e)+" instead."}function Qt(t,e){return e.some((function(e){return e.kind===t.kind}))}function Jt(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t}))}var $t=e((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return r("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function a(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in n)return n[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=s.indexOf("("),l=s.indexOf(")");if(-1!==u&&l+1===s.length){var c=s.substr(0,u),h=s.substr(u+1,l-(u+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=o(h[1]),m=o(h[2]),g=m<=.5?m*(d+1):m+d-m*d,y=2*m-g;return[r(255*a(y,g,f+1/3)),r(255*a(y,g,f)),r(255*a(y,g,f-1/3)),p];default:return null}}return null}}catch(t){}})).parseCSSColor,te=function(t,e,n,r){void 0===r&&(r=1),this.r=t,this.g=e,this.b=n,this.a=r};te.parse=function(t){if(t){if(t instanceof te)return t;if("string"==typeof t){var e=$t(t);if(e)return new te(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},te.prototype.toString=function(){var t=this.toArray(),e=t[1],n=t[2],r=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(n)+","+r+")"},te.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},te.black=new te(0,0,0,1),te.white=new te(1,1,1,1),te.transparent=new te(0,0,0,0),te.red=new te(1,0,0,1);var ee=function(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ee.prototype.compare=function(t,e){return this.collator.compare(t,e)},ee.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ne=function(t,e,n,r,i){this.text=t,this.image=e,this.scale=n,this.fontStack=r,this.textColor=i},re=function(t){this.sections=t};re.fromString=function(t){return new re([new ne(t,null,null,null,null)])},re.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},re.factory=function(t){return t instanceof re?t:re.fromString(t)},re.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},re.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];if(r.image)t.push(["image",r.image.name]);else{t.push(r.text);var i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),r.textColor&&(i["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(i)}}return t};var ie=function(t){this.name=t.name,this.available=t.available};function oe(t,e,n,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value ["+[t,e,n,r].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof r?[t,e,n,r]:[t,e,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ae(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof te)return!0;if(t instanceof ee)return!0;if(t instanceof re)return!0;if(t instanceof ie)return!0;if(Array.isArray(t)){for(var e=0,n=t;e<n.length;e+=1)if(!ae(n[e]))return!1;return!0}if("object"==typeof t){for(var r in t)if(!ae(t[r]))return!1;return!0}return!1}function se(t){if(null===t)return Ft;if("string"==typeof t)return Bt;if("boolean"==typeof t)return jt;if("number"==typeof t)return zt;if(t instanceof te)return Ut;if(t instanceof ee)return Gt;if(t instanceof re)return Ht;if(t instanceof ie)return Wt;if(Array.isArray(t)){for(var e,n=t.length,r=0,i=t;r<i.length;r+=1){var o=se(i[r]);if(e){if(e===o)continue;e=Vt;break}e=o}return qt(e||Vt,n)}return Zt}function ue(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof te||t instanceof re||t instanceof ie?t.toString():JSON.stringify(t)}ie.prototype.toString=function(){return this.name},ie.fromString=function(t){return t?new ie({name:t,available:!1}):null},ie.prototype.serialize=function(){return["image",this.name]};var le=function(t,e){this.type=t,this.value=e};le.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ae(t[1]))return e.error("invalid value");var n=t[1],r=se(n),i=e.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new le(r,n)},le.prototype.evaluate=function(){return this.value},le.prototype.eachChild=function(){},le.prototype.outputDefined=function(){return!0},le.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof te?["rgba"].concat(this.value.toArray()):this.value instanceof re?this.value.serialize():this.value};var ce=function(t){this.name="ExpressionEvaluationError",this.message=t};ce.prototype.toJSON=function(){return this.message};var he={string:Bt,number:zt,boolean:jt,object:Zt},pe=function(t,e){this.type=t,this.args=e};pe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n,r=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in he)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=he[s],r++}else o=Vt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],r++}n=qt(o,a)}else n=he[i];for(var u=[];r<t.length;r++){var l=e.parse(t[r],r,Vt);if(!l)return null;u.push(l)}return new pe(n,u)},pe.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var n=this.args[e].evaluate(t);if(!Kt(this.type,se(n)))return n;if(e===this.args.length-1)throw new ce("Expected value to be of type "+Xt(this.type)+", but found "+Xt(se(n))+" instead.")}return null},pe.prototype.eachChild=function(t){this.args.forEach(t)},pe.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},pe.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);var r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var fe=function(t){this.type=Ht,this.sections=t};fe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");for(var r=[],i=!1,o=1;o<=t.length-1;++o){var a=t[o];if(i&&"object"==typeof a&&!Array.isArray(a)){i=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,zt)))return null;var u=null;if(a["text-font"]&&!(u=e.parse(a["text-font"],1,qt(Bt))))return null;var l=null;if(a["text-color"]&&!(l=e.parse(a["text-color"],1,Ut)))return null;var c=r[r.length-1];c.scale=s,c.font=u,c.textColor=l}else{var h=e.parse(t[o],1,Vt);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:h,scale:null,font:null,textColor:null})}}return new fe(r)},fe.prototype.evaluate=function(t){return new re(this.sections.map((function(e){var n=e.content.evaluate(t);return se(n)===Wt?new ne("",n,null,null,null):new ne(ue(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},fe.prototype.eachChild=function(t){for(var e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}},fe.prototype.outputDefined=function(){return!1},fe.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t.push(r.content.serialize());var i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),r.textColor&&(i["text-color"]=r.textColor.serialize()),t.push(i)}return t};var de=function(t){this.type=Wt,this.input=t};de.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Bt);return n?new de(n):e.error("No image name provided.")},de.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=ie.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n},de.prototype.eachChild=function(t){t(this.input)},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){return["image",this.input.serialize()]};var me={"to-boolean":jt,"to-color":Ut,"to-number":zt,"to-string":Bt},ge=function(t,e){this.type=t,this.args=e};ge.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");for(var r=me[n],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Vt);if(!a)return null;i.push(a)}return new ge(r,i)},ge.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,n,r=0,i=this.args;r<i.length;r+=1){if(n=null,(e=i[r].evaluate(t))instanceof te)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(n=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":oe(e[0],e[1],e[2],e[3])))return new te(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ce(n||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var l=Number(a);if(!isNaN(l))return l}throw new ce("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?re.fromString(ue(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ie.fromString(ue(this.args[0].evaluate(t))):ue(this.args[0].evaluate(t))},ge.prototype.eachChild=function(t){this.args.forEach(t)},ge.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ge.prototype.serialize=function(){if("formatted"===this.type.kind)return new fe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new de(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var ye=["Unknown","Point","LineString","Polygon"],ve=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ve.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ve.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ye[this.feature.type]:this.feature.type:null},ve.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ve.prototype.canonicalID=function(){return this.canonical},ve.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ve.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=te.parse(t)),e};var _e=function(t,e,n,r){this.name=t,this.type=e,this._evaluate=n,this.args=r};_e.prototype.evaluate=function(t){return this._evaluate(t,this.args)},_e.prototype.eachChild=function(t){this.args.forEach(t)},_e.prototype.outputDefined=function(){return!1},_e.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},_e.parse=function(t,e){var n,r=t[0],i=_e.definitions[r];if(!i)return e.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter((function(e){var n=e[0];return!Array.isArray(n)||n.length===t.length-1})),u=null,l=0,c=s;l<c.length;l+=1){var h=c[l],p=h[0],f=h[1];u=new Ue(e.registry,e.path,null,e.scope);for(var d=[],m=!1,g=1;g<t.length;g++){var y=t[g],v=Array.isArray(p)?p[g-1]:p.type,_=u.parse(y,1+d.length,v);if(!_){m=!0;break}d.push(_)}if(!m)if(Array.isArray(p)&&p.length!==d.length)u.error("Expected "+p.length+" arguments, but found "+d.length+" instead.");else{for(var x=0;x<d.length;x++){var b=Array.isArray(p)?p[x]:p.type,w=d[x];u.concat(x+1).checkSubtype(b,w.type)}if(0===u.errors.length)return new _e(r,o,f,d)}}if(1===s.length)(n=e.errors).push.apply(n,u.errors);else{for(var S=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Xt).join(", ")+")":"("+Xt(e.type)+"...)"})).join(" | "),E=[],C=1;C<t.length;C++){var M=e.parse(t[C],1+E.length);if(!M)return null;E.push(Xt(M.type))}e.error("Expected arguments of type "+S+", but found ("+E.join(", ")+") instead.")}return null},_e.register=function(t,e){for(var n in _e.definitions=e,e)t[n]=_e};var xe=function(t,e,n){this.type=Gt,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e};function be(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function we(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Se(t,e){var n=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(n*i*8192),Math.round(r*i*8192)]}function Ee(t,e,n){return e[1]>t[1]!=n[1]>t[1]&&t[0]<(n[0]-e[0])*(t[1]-e[1])/(n[1]-e[1])+e[0]}function Ce(t,e){for(var n,r,i,o,a,s,u,l=!1,c=0,h=e.length;c<h;c++)for(var p=e[c],f=0,d=p.length;f<d-1;f++){if((o=(n=t)[0]-(r=p[f])[0])*(u=n[1]-(i=p[f+1])[1])-(s=n[0]-i[0])*(a=n[1]-r[1])==0&&o*s<=0&&a*u<=0)return!1;Ee(t,p[f],p[f+1])&&(l=!l)}return l}function Me(t,e){for(var n=0;n<e.length;n++)if(Ce(t,e[n]))return!0;return!1}function Te(t,e,n,r){var i=r[0]-n[0],o=r[1]-n[1],a=(t[0]-n[0])*o-i*(t[1]-n[1]),s=(e[0]-n[0])*o-i*(e[1]-n[1]);return a>0&&s<0||a<0&&s>0}function Ae(t,e,n){for(var r=0,i=n;r<i.length;r+=1)for(var o=i[r],a=0;a<o.length-1;++a)if(0!=(h=[(c=o[a+1])[0]-(l=o[a])[0],c[1]-l[1]])[0]*(p=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-h[1]*p[0]&&Te(s,u,l,c)&&Te(l,c,s,u))return!0;var s,u,l,c,h,p;return!1}function Pe(t,e){for(var n=0;n<t.length;++n)if(!Ce(t[n],e))return!1;for(var r=0;r<t.length-1;++r)if(Ae(t[r],t[r+1],e))return!1;return!0}function Le(t,e){for(var n=0;n<e.length;n++)if(Pe(t,e[n]))return!0;return!1}function Ie(t,e,n){for(var r=[],i=0;i<t.length;i++){for(var o=[],a=0;a<t[i].length;a++){var s=Se(t[i][a],n);be(e,s),o.push(s)}r.push(o)}return r}function ke(t,e,n){for(var r=[],i=0;i<t.length;i++){var o=Ie(t[i],e,n);r.push(o)}return r}function Oe(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){var i=.5*r,o=t[0]-n[0]>i?-r:n[0]-t[0]>i?r:0;0===o&&(o=t[0]-n[2]>i?-r:n[2]-t[0]>i?r:0),t[0]+=o}be(e,t)}function Re(t,e,n,r){for(var i=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[],s=0,u=t;s<u.length;s+=1)for(var l=0,c=u[s];l<c.length;l+=1){var h=c[l],p=[h.x+o[0],h.y+o[1]];Oe(p,e,n,i),a.push(p)}return a}function De(t,e,n,r){for(var i,o=8192*Math.pow(2,r.z),a=[8192*r.x,8192*r.y],s=[],u=0,l=t;u<l.length;u+=1){for(var c=[],h=0,p=l[u];h<p.length;h+=1){var f=p[h],d=[f.x+a[0],f.y+a[1]];be(e,d),c.push(d)}s.push(c)}if(e[2]-e[0]<=o/2){(i=e)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var m=0,g=s;m<g.length;m+=1)for(var y=0,v=g[m];y<v.length;y+=1)Oe(v[y],e,n,o)}return s}xe.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");var r=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,jt);if(!r)return null;var i=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,jt);if(!i)return null;var o=null;return n.locale&&!(o=e.parse(n.locale,1,Bt))?null:new xe(r,i,o)},xe.prototype.evaluate=function(t){return new ee(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},xe.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},xe.prototype.outputDefined=function(){return!1},xe.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Ne=function(t,e){this.type=jt,this.geojson=t,this.geometries=e};function Fe(t){if(t instanceof _e){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Ne)return!1;var e=!0;return t.eachChild((function(t){e&&!Fe(t)&&(e=!1)})),e}function ze(t){if(t instanceof _e&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!ze(t)&&(e=!1)})),e}function Be(t,e){if(t instanceof _e&&e.indexOf(t.name)>=0)return!1;var n=!0;return t.eachChild((function(t){n&&!Be(t,e)&&(n=!1)})),n}Ne.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ae(t[1])){var n=t[1];if("FeatureCollection"===n.type)for(var r=0;r<n.features.length;++r){var i=n.features[r].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ne(n,n.features[r].geometry)}else if("Feature"===n.type){var o=n.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new Ne(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new Ne(n,n)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ne.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Ie(e.coordinates,r,i),a=Re(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Ce(u[s],o))return!1}if("MultiPolygon"===e.type){var l=ke(e.coordinates,r,i),c=Re(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Me(p[h],l))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Ie(e.coordinates,r,i),a=De(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Pe(u[s],o))return!1}if("MultiPolygon"===e.type){var l=ke(e.coordinates,r,i),c=De(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Le(p[h],l))return!1}return!0}(t,this.geometries)}return!1},Ne.prototype.eachChild=function(){},Ne.prototype.outputDefined=function(){return!0},Ne.prototype.serialize=function(){return["within",this.geojson]};var je=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};je.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var n=t[1];return e.scope.has(n)?new je(n,e.scope.get(n)):e.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},je.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},je.prototype.eachChild=function(){},je.prototype.outputDefined=function(){return!1},je.prototype.serialize=function(){return["var",this.name]};var Ue=function(t,e,n,r,i){void 0===e&&(e=[]),void 0===r&&(r=new Nt),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=r,this.errors=i,this.expectedType=n};function Ze(t,e){for(var n,r=t.length-1,i=0,o=r,a=0;i<=o;)if((n=t[a=Math.floor((i+o)/2)])<=e){if(a===r||e<t[a+1])return a;i=a+1}else{if(!(n>e))throw new ce("Input is not a number.");o=a-1}return 0}Ue.prototype.parse=function(t,e,n,r,i){return void 0===i&&(i={}),e?this.concat(e,n,r)._parse(t,i):this._parse(t,i)},Ue.prototype._parse=function(t,e){function n(t,e,n){return"assert"===n?new pe(e,[t]):"coerce"===n?new ge(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=t[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+typeof r+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[r];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=n(o,a,e.typeAnnotation||"coerce");else o=n(o,a,e.typeAnnotation||"assert")}if(!(o instanceof le)&&"resolvedImage"!==o.type.kind&&function t(e){if(e instanceof je)return t(e.boundExpression);if(e instanceof _e&&"error"===e.name)return!1;if(e instanceof xe)return!1;if(e instanceof Ne)return!1;var n=e instanceof ge||e instanceof pe,r=!0;return e.eachChild((function(e){r=n?r&&t(e):r&&e instanceof le})),!!r&&Fe(e)&&Be(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var u=new ve;try{o=new le(o.type,o.evaluate(u))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ue.prototype.concat=function(t,e,n){var r="number"==typeof t?this.path.concat(t):this.path,i=n?this.scope.concat(n):this.scope;return new Ue(this.registry,r,e||null,i,this.errors)},Ue.prototype.error=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Dt(r,t))},Ue.prototype.checkSubtype=function(t,e){var n=Kt(t,e);return n&&this.error(n),n};var Ve=function(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var r=0,i=n;r<i.length;r+=1){var o=i[r],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function Ge(t,e,n){return t*(1-n)+e*n}Ve.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var n=e.parse(t[1],1,zt);if(!n)return null;var r=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],u=o,l=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var c=e.parse(s,l,i);if(!c)return null;i=i||c.type,r.push([a,c])}return new Ve(i,n,r)},Ve.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;return r>=e[i-1]?n[i-1].evaluate(t):n[Ze(e,r)].evaluate(t)},Ve.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},Ve.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Ve.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var He=Object.freeze({__proto__:null,number:Ge,color:function(t,e,n){return new te(Ge(t.r,e.r,n),Ge(t.g,e.g,n),Ge(t.b,e.b,n),Ge(t.a,e.a,n))},array:function(t,e,n){return t.map((function(t,r){return Ge(t,e[r],n)}))}}),We=6/29*3*(6/29),qe=Math.PI/180,Xe=180/Math.PI;function Ye(t){return t>.008856451679035631?Math.pow(t,1/3):t/We+4/29}function Ke(t){return t>6/29?t*t*t:We*(t-4/29)}function Qe(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Je(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $e(t){var e=Je(t.r),n=Je(t.g),r=Je(t.b),i=Ye((.4124564*e+.3575761*n+.1804375*r)/.95047),o=Ye((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-Ye((.0193339*e+.119192*n+.9503041*r)/1.08883)),alpha:t.a}}function tn(t){var e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Ke(e),n=.95047*Ke(n),r=1.08883*Ke(r),new te(Qe(3.2404542*n-1.5371385*e-.4985314*r),Qe(-.969266*n+1.8760108*e+.041556*r),Qe(.0556434*n-.2040259*e+1.0572252*r),t.alpha)}function en(t,e,n){var r=e-t;return t+n*(r>180||r<-180?r-360*Math.round(r/360):r)}var nn={forward:$e,reverse:tn,interpolate:function(t,e,n){return{l:Ge(t.l,e.l,n),a:Ge(t.a,e.a,n),b:Ge(t.b,e.b,n),alpha:Ge(t.alpha,e.alpha,n)}}},rn={forward:function(t){var e=$e(t),n=e.l,r=e.a,i=e.b,o=Math.atan2(i,r)*Xe;return{h:o<0?o+360:o,c:Math.sqrt(r*r+i*i),l:n,alpha:t.a}},reverse:function(t){var e=t.h*qe,n=t.c;return tn({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:en(t.h,e.h,n),c:Ge(t.c,e.c,n),l:Ge(t.l,e.l,n),alpha:Ge(t.alpha,e.alpha,n)}}},on=Object.freeze({__proto__:null,lab:nn,hcl:rn}),an=function(t,e,n,r,i){this.type=t,this.operator=e,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[1];this.labels.push(s[0]),this.outputs.push(u)}};function sn(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}an.interpolationFactor=function(t,e,r,i){var o=0;if("exponential"===t.name)o=sn(e,t.base,r,i);else if("linear"===t.name)o=sn(e,1,r,i);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new n(a[0],a[1],a[2],a[3]).solve(sn(e,1,r,i))}return o},an.parse=function(t,e){var n=t[0],r=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var a=r[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:a}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);var s=r.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,zt)))return null;var u=[],l=null;"interpolate-hcl"===n||"interpolate-lab"===n?l=Ut:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<o.length;c+=2){var h=o[c],p=o[c+1],f=c+3,d=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var m=e.parse(p,d,l);if(!m)return null;l=l||m.type,u.push([h,m])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new an(l,n,r,i,u):e.error("Type "+Xt(l)+" is not interpolatable.")},an.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;if(r>=e[i-1])return n[i-1].evaluate(t);var o=Ze(e,r),a=an.interpolationFactor(this.interpolation,r,e[o],e[o+1]),s=n[o].evaluate(t),u=n[o+1].evaluate(t);return"interpolate"===this.operator?He[this.type.kind.toLowerCase()](s,u,a):"interpolate-hcl"===this.operator?rn.reverse(rn.interpolate(rn.forward(s),rn.forward(u),a)):nn.reverse(nn.interpolate(nn.forward(s),nn.forward(u),a))},an.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},an.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},an.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e};var un=function(t,e){this.type=t,this.args=e};un.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var n=null,r=e.expectedType;r&&"value"!==r.kind&&(n=r);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+i.length,n,void 0,{typeAnnotation:"omit"});if(!s)return null;n=n||s.type,i.push(s)}var u=r&&i.some((function(t){return Kt(r,t.type)}));return new un(u?Vt:n,i)},un.prototype.evaluate=function(t){for(var e,n=null,r=0,i=0,o=this.args;i<o.length&&(r++,(n=o[i].evaluate(t))&&n instanceof ie&&!n.available&&(e||(e=n.name),n=null,r===this.args.length&&(n=e)),null===n);i+=1);return n},un.prototype.eachChild=function(t){this.args.forEach(t)},un.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},un.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var ln=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};ln.prototype.evaluate=function(t){return this.result.evaluate(t)},ln.prototype.eachChild=function(t){for(var e=0,n=this.bindings;e<n.length;e+=1)t(n[e][1]);t(this.result)},ln.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var n=[],r=1;r<t.length-1;r+=2){var i=t[r];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);var o=e.parse(t[r+1],r+1);if(!o)return null;n.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return a?new ln(n,a):null},ln.prototype.outputDefined=function(){return this.result.outputDefined()},ln.prototype.serialize=function(){for(var t=["let"],e=0,n=this.bindings;e<n.length;e+=1){var r=n[e];t.push(r[0],r[1].serialize())}return t.push(this.result.serialize()),t};var cn=function(t,e,n){this.type=t,this.index=e,this.input=n};cn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,zt),r=e.parse(t[2],2,qt(e.expectedType||Vt));return n&&r?new cn(r.type.itemType,n,r):null},cn.prototype.evaluate=function(t){var e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new ce("Array index out of bounds: "+e+" < 0.");if(e>=n.length)throw new ce("Array index out of bounds: "+e+" > "+(n.length-1)+".");if(e!==Math.floor(e))throw new ce("Array index must be an integer, but found "+e+" instead.");return n[e]},cn.prototype.eachChild=function(t){t(this.index),t(this.input)},cn.prototype.outputDefined=function(){return!1},cn.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var hn=function(t,e){this.type=jt,this.needle=t,this.haystack=e};hn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Vt),r=e.parse(t[2],2,Vt);return n&&r?Qt(n.type,[jt,Bt,zt,Ft,Vt])?new hn(n,r):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Xt(n.type)+" instead"):null},hn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!Jt(e,["boolean","string","number","null"]))throw new ce("Expected first argument to be of type boolean, string, number or null, but found "+Xt(se(e))+" instead.");if(!Jt(n,["string","array"]))throw new ce("Expected second argument to be of type array or string, but found "+Xt(se(n))+" instead.");return n.indexOf(e)>=0},hn.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},hn.prototype.outputDefined=function(){return!0},hn.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var pn=function(t,e,n){this.type=zt,this.needle=t,this.haystack=e,this.fromIndex=n};pn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Vt),r=e.parse(t[2],2,Vt);if(!n||!r)return null;if(!Qt(n.type,[jt,Bt,zt,Ft,Vt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Xt(n.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,zt);return i?new pn(n,r,i):null}return new pn(n,r)},pn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!Jt(e,["boolean","string","number","null"]))throw new ce("Expected first argument to be of type boolean, string, number or null, but found "+Xt(se(e))+" instead.");if(!Jt(n,["string","array"]))throw new ce("Expected second argument to be of type array or string, but found "+Xt(se(n))+" instead.");if(this.fromIndex){var r=this.fromIndex.evaluate(t);return n.indexOf(e,r)}return n.indexOf(e)},pn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},pn.prototype.outputDefined=function(){return!1},pn.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var fn=function(t,e,n,r,i,o){this.inputType=t,this.type=e,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o};fn.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var n,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var l=e.concat(a);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return l.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return l.error("Numeric branch labels must be integer values.");if(n){if(l.checkSubtype(n,se(p)))return null}else n=se(p);if(void 0!==i[String(p)])return l.error("Branch labels must be unique.");i[String(p)]=o.length}var f=e.parse(u,a,r);if(!f)return null;r=r||f.type,o.push(f)}var d=e.parse(t[1],1,Vt);if(!d)return null;var m=e.parse(t[t.length-1],t.length-1,r);return m?"value"!==d.type.kind&&e.concat(1).checkSubtype(n,d.type)?null:new fn(n,r,d,i,o,m):null},fn.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(se(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},fn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},fn.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},fn.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],n=[],r={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(h=r[this.cases[a]])?(r[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=n;u<l.length;u+=1){var c=l[u],h=c[0],p=c[1];e.push(1===p.length?s(p[0]):p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var dn=function(t,e,n){this.type=t,this.branches=e,this.otherwise=n};dn.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var r=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,jt);if(!o)return null;var a=e.parse(t[i+1],i+1,n);if(!a)return null;r.push([o,a]),n=n||a.type}var s=e.parse(t[t.length-1],t.length-1,n);return s?new dn(n,r,s):null},dn.prototype.evaluate=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[1];if(r[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},dn.prototype.eachChild=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[1];t(r[0]),t(i)}t(this.otherwise)},dn.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},dn.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var mn=function(t,e,n,r){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=r};function gn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function yn(t,e,n,r){return 0===r.compare(e,n)}function vn(t,e,n){var r="=="!==t&&"!="!==t;return function(){function i(t,e,n){this.type=jt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=t[0],o=e.parse(t[1],1,Vt);if(!o)return null;if(!gn(n,o.type))return e.concat(1).error('"'+n+"\" comparisons are not supported for type '"+Xt(o.type)+"'.");var a=e.parse(t[2],2,Vt);if(!a)return null;if(!gn(n,a.type))return e.concat(2).error('"'+n+"\" comparisons are not supported for type '"+Xt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+Xt(o.type)+"' and '"+Xt(a.type)+"'.");r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new pe(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new pe(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Gt)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){var s=se(o),u=se(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new ce('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!r&&this.hasUntypedArgument){var l=se(o),c=se(a);if("string"!==l.kind||"string"!==c.kind)return e(i,o,a)}return this.collator?n(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},i}()}mn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Vt),r=e.parse(t[2],2,zt);if(!n||!r)return null;if(!Qt(n.type,[qt(Vt),Bt,Vt]))return e.error("Expected first argument to be of type array or string, but found "+Xt(n.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,zt);return i?new mn(n.type,n,r,i):null}return new mn(n.type,n,r)},mn.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!Jt(e,["string","array"]))throw new ce("Expected first argument to be of type array or string, but found "+Xt(se(e))+" instead.");if(this.endIndex){var r=this.endIndex.evaluate(t);return e.slice(n,r)}return e.slice(n)},mn.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},mn.prototype.outputDefined=function(){return!1},mn.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var _n=vn("==",(function(t,e,n){return e===n}),yn),xn=vn("!=",(function(t,e,n){return e!==n}),(function(t,e,n,r){return!yn(0,e,n,r)})),bn=vn("<",(function(t,e,n){return e<n}),(function(t,e,n,r){return r.compare(e,n)<0})),wn=vn(">",(function(t,e,n){return e>n}),(function(t,e,n,r){return r.compare(e,n)>0})),Sn=vn("<=",(function(t,e,n){return e<=n}),(function(t,e,n,r){return r.compare(e,n)<=0})),En=vn(">=",(function(t,e,n){return e>=n}),(function(t,e,n,r){return r.compare(e,n)>=0})),Cn=function(t,e,n,r,i){this.type=Bt,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i};Cn.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,zt);if(!n)return null;var r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");var i=null;if(r.locale&&!(i=e.parse(r.locale,1,Bt)))return null;var o=null;if(r.currency&&!(o=e.parse(r.currency,1,Bt)))return null;var a=null;if(r["min-fraction-digits"]&&!(a=e.parse(r["min-fraction-digits"],1,zt)))return null;var s=null;return r["max-fraction-digits"]&&!(s=e.parse(r["max-fraction-digits"],1,zt))?null:new Cn(n,i,o,a,s)},Cn.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Cn.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Cn.prototype.outputDefined=function(){return!1},Cn.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Mn=function(t){this.type=zt,this.input=t};Mn.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found "+Xt(n.type)+" instead."):new Mn(n):null},Mn.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ce("Expected value to be of type string or array, but found "+Xt(se(e))+" instead.")},Mn.prototype.eachChild=function(t){t(this.input)},Mn.prototype.outputDefined=function(){return!1},Mn.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Tn={"==":_n,"!=":xn,">":wn,"<":bn,">=":En,"<=":Sn,array:pe,at:cn,boolean:pe,case:dn,coalesce:un,collator:xe,format:fe,image:de,in:hn,"index-of":pn,interpolate:an,"interpolate-hcl":an,"interpolate-lab":an,length:Mn,let:ln,literal:le,match:fn,number:pe,"number-format":Cn,object:pe,slice:mn,step:Ve,string:pe,"to-boolean":ge,"to-color":ge,"to-number":ge,"to-string":ge,var:je,within:Ne};function An(t,e){var n=e[0],r=e[1],i=e[2],o=e[3];n=n.evaluate(t),r=r.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=oe(n,r,i,a);if(s)throw new ce(s);return new te(n/255*a,r/255*a,i/255*a,a)}function Pn(t,e){return t in e}function Ln(t,e){var n=e[t];return void 0===n?null:n}function In(t){return{type:t}}function kn(t){return{result:"success",value:t}}function On(t){return{result:"error",value:t}}function Rn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Dn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Nn(t){return!!t.expression&&t.expression.interpolated}function Fn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function zn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Bn(t){return t}function jn(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Un(t,e,n,r,i){return jn(typeof n===i?r[n]:void 0,t.default,e.default)}function Zn(t,e,n){if("number"!==Fn(n))return jn(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];var i=Ze(t.stops.map((function(t){return t[0]})),n);return t.stops[i][1]}function Vn(t,e,n){var r=void 0!==t.base?t.base:1;if("number"!==Fn(n))return jn(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var o=Ze(t.stops.map((function(t){return t[0]})),n),a=function(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(n,r,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],u=t.stops[o+1][1],l=He[e.type]||Bn;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=on[t.colorSpace];l=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=s.evaluate.apply(void 0,t),r=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==r)return l(n,r,a)}}:l(s,u,a)}function Gn(t,e,n){return"color"===e.type?n=te.parse(n):"formatted"===e.type?n=re.fromString(n.toString()):"resolvedImage"===e.type?n=ie.fromString(n.toString()):Fn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),jn(n,t.default,e.default)}_e.register(Tn,{error:[{kind:"error"},[Bt],function(t,e){throw new ce(e[0].evaluate(t))}],typeof:[Bt,[Vt],function(t,e){return Xt(se(e[0].evaluate(t)))}],"to-rgba":[qt(zt,4),[Ut],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Ut,[zt,zt,zt],An],rgba:[Ut,[zt,zt,zt,zt],An],has:{type:jt,overloads:[[[Bt],function(t,e){return Pn(e[0].evaluate(t),t.properties())}],[[Bt,Zt],function(t,e){var n=e[1];return Pn(e[0].evaluate(t),n.evaluate(t))}]]},get:{type:Vt,overloads:[[[Bt],function(t,e){return Ln(e[0].evaluate(t),t.properties())}],[[Bt,Zt],function(t,e){var n=e[1];return Ln(e[0].evaluate(t),n.evaluate(t))}]]},"feature-state":[Vt,[Bt],function(t,e){return Ln(e[0].evaluate(t),t.featureState||{})}],properties:[Zt,[],function(t){return t.properties()}],"geometry-type":[Bt,[],function(t){return t.geometryType()}],id:[Vt,[],function(t){return t.id()}],zoom:[zt,[],function(t){return t.globals.zoom}],"heatmap-density":[zt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[zt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Vt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[zt,In(zt),function(t,e){for(var n=0,r=0,i=e;r<i.length;r+=1)n+=i[r].evaluate(t);return n}],"*":[zt,In(zt),function(t,e){for(var n=1,r=0,i=e;r<i.length;r+=1)n*=i[r].evaluate(t);return n}],"-":{type:zt,overloads:[[[zt,zt],function(t,e){var n=e[1];return e[0].evaluate(t)-n.evaluate(t)}],[[zt],function(t,e){return-e[0].evaluate(t)}]]},"/":[zt,[zt,zt],function(t,e){var n=e[1];return e[0].evaluate(t)/n.evaluate(t)}],"%":[zt,[zt,zt],function(t,e){var n=e[1];return e[0].evaluate(t)%n.evaluate(t)}],ln2:[zt,[],function(){return Math.LN2}],pi:[zt,[],function(){return Math.PI}],e:[zt,[],function(){return Math.E}],"^":[zt,[zt,zt],function(t,e){var n=e[1];return Math.pow(e[0].evaluate(t),n.evaluate(t))}],sqrt:[zt,[zt],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[zt,[zt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[zt,[zt],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[zt,[zt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[zt,[zt],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[zt,[zt],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[zt,[zt],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[zt,[zt],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[zt,[zt],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[zt,[zt],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[zt,In(zt),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[zt,In(zt),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[zt,[zt],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[zt,[zt],function(t,e){var n=e[0].evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[zt,[zt],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[zt,[zt],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[jt,[Bt,Vt],function(t,e){var n=e[0],r=e[1];return t.properties()[n.value]===r.value}],"filter-id-==":[jt,[Vt],function(t,e){var n=e[0];return t.id()===n.value}],"filter-type-==":[jt,[Bt],function(t,e){var n=e[0];return t.geometryType()===n.value}],"filter-<":[jt,[Bt,Vt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i<o}],"filter-id-<":[jt,[Vt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r<i}],"filter->":[jt,[Bt,Vt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i>o}],"filter-id->":[jt,[Vt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r>i}],"filter-<=":[jt,[Bt,Vt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[jt,[Vt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r<=i}],"filter->=":[jt,[Bt,Vt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[jt,[Vt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r>=i}],"filter-has":[jt,[Vt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[jt,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[jt,[qt(Bt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[jt,[qt(Vt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[jt,[Bt,qt(Vt)],function(t,e){var n=e[0];return e[1].value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[jt,[Bt,qt(Vt)],function(t,e){var n=e[0],r=e[1];return function(t,e,n,r){for(;n<=r;){var i=n+r>>1;if(e[i]===t)return!0;e[i]>t?r=i-1:n=i+1}return!1}(t.properties()[n.value],r.value,0,r.value.length-1)}],all:{type:jt,overloads:[[[jt,jt],function(t,e){var n=e[1];return e[0].evaluate(t)&&n.evaluate(t)}],[In(jt),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(!r[n].evaluate(t))return!1;return!0}]]},any:{type:jt,overloads:[[[jt,jt],function(t,e){var n=e[1];return e[0].evaluate(t)||n.evaluate(t)}],[In(jt),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(r[n].evaluate(t))return!0;return!1}]]},"!":[jt,[jt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[jt,[Bt],function(t,e){var n=t.globals&&t.globals.isSupportedScript;return!n||n(e[0].evaluate(t))}],upcase:[Bt,[Bt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Bt,[Bt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Bt,In(Vt),function(t,e){return e.map((function(e){return ue(e.evaluate(t))})).join("")}],"resolved-locale":[Bt,[Gt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Hn=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new ve,this._defaultValue=e?function(t){return"color"===t.type&&zn(t.default)?new te(0,0,0,0):"color"===t.type?te.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function Wn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Tn}function qn(t,e){var n=new Ue(Tn,[],e?function(t){var e={color:Ut,string:Bt,number:zt,enum:Bt,boolean:jt,formatted:Ht,resolvedImage:Wt};return"array"===t.type?qt(e[t.value]||Vt,t.length):e[t.type]}(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?kn(new Hn(r,e)):On(n.errors)}Hn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},Hn.prototype.evaluate=function(t,e,n,r,i,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null;try{var a=this.expression.evaluate(this._evaluator);if(null==a||"number"==typeof a&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new ce("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(a)+" instead.");return a}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Xn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!ze(e.expression)};Xn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)},Xn.prototype.evaluate=function(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)};var Yn=function(t,e,n,r){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!ze(e.expression),this.interpolationType=r};function Kn(t,e){if("error"===(t=qn(t,e)).result)return t;var n=t.value.expression,r=Fe(n);if(!r&&!Rn(e))return On([new Dt("","data expressions not supported")]);var i=Be(n,["zoom"]);if(!i&&!Dn(e))return On([new Dt("","zoom expressions not supported")]);var o=function t(e){var n=null;if(e instanceof ln)n=t(e.result);else if(e instanceof un)for(var r=0,i=e.args;r<i.length&&!(n=t(i[r]));r+=1);else(e instanceof Ve||e instanceof an)&&e.input instanceof _e&&"zoom"===e.input.name&&(n=e);return n instanceof Dt||e.eachChild((function(e){var r=t(e);r instanceof Dt?n=r:!n&&r?n=new Dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&r&&n!==r&&(n=new Dt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}(n);return o||i?o instanceof Dt?On([o]):o instanceof an&&!Nn(e)?On([new Dt("",'"interpolate" expressions cannot be used with this property')]):kn(o?new Yn(r?"camera":"composite",t.value,o.labels,o instanceof an?o.interpolation:void 0):new Xn(r?"constant":"source",t.value)):On([new Dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Yn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)},Yn.prototype.evaluate=function(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)},Yn.prototype.interpolationFactor=function(t,e,n){return this.interpolationType?an.interpolationFactor(this.interpolationType,t,e,n):0};var Qn=function(t,e){this._parameters=t,this._specification=e,kt(this,function t(e,n){var r,i,o,a="color"===n.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||!(s||void 0!==e.property),l=e.type||(Nn(n)?"exponential":"interval");if(a&&((e=kt({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],te.parse(t[1])]}))),e.default=te.parse(e.default?e.default:n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!on[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)r=Vn;else if("interval"===l)r=Zn;else if("categorical"===l){r=Un,i=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var p=h[c];i[p[0]]=p[1]}o=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');r=Gn}if(s){for(var f={},d=[],m=0;m<e.stops.length;m++){var g=e.stops[m],y=g[0].zoom;void 0===f[y]&&(f[y]={zoom:y,type:e.type,property:e.property,default:e.default,stops:[]},d.push(y)),f[y].stops.push([g[0].value,g[1]])}for(var v=[],_=0,x=d;_<x.length;_+=1){var b=x[_];v.push([f[b].zoom,t(f[b],n)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:an.interpolationFactor.bind(void 0,w),zoomStops:v.map((function(t){return t[0]})),evaluate:function(t,r){var i=t.zoom;return Vn({stops:v,base:e.base},n,i).evaluate(i,r)}}}if(u){var S="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:an.interpolationFactor.bind(void 0,S),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return r(e,n,t.zoom,i,o)}}}return{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?jn(e.default,n.default):r(e,n,s,i,o)}}}(this._parameters,this._specification))};function Jn(t){var e=t.key,n=t.value,r=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],u=Fn(n);if("object"!==u)return[new Lt(e,n,"object expected, "+u+" found")];for(var l in n){var c=l.split(".")[0],h=r[c]||r["*"],p=void 0;if(i[c])p=i[c];else if(r[c])p=Sr;else if(i["*"])p=i["*"];else{if(!r["*"]){s.push(new Lt(e,n[l],'unknown property "'+l+'"'));continue}p=Sr}s=s.concat(p({key:(e?e+".":e)+l,value:n[l],valueSpec:h,style:o,styleSpec:a,object:n,objectKey:l},n))}for(var f in r)i[f]||r[f].required&&void 0===r[f].default&&void 0===n[f]&&s.push(new Lt(e,n,'missing required property "'+f+'"'));return s}function $n(t){var e=t.value,n=t.valueSpec,r=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||Sr;if("array"!==Fn(e))return[new Lt(o,e,"array expected, "+Fn(e)+" found")];if(n.length&&e.length!==n.length)return[new Lt(o,e,"array length "+n.length+" expected, length "+e.length+" found")];if(n["min-length"]&&e.length<n["min-length"])return[new Lt(o,e,"array length at least "+n["min-length"]+" expected, length "+e.length+" found")];var s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),"object"===Fn(n.value)&&(s=n.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(a({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:r,styleSpec:i,key:o+"["+l+"]"}));return u}function tr(t){var e=t.key,n=t.value,r=t.valueSpec,i=Fn(n);return"number"===i&&n!=n&&(i="NaN"),"number"!==i?[new Lt(e,n,"number expected, "+i+" found")]:"minimum"in r&&n<r.minimum?[new Lt(e,n,n+" is less than the minimum value "+r.minimum)]:"maximum"in r&&n>r.maximum?[new Lt(e,n,n+" is greater than the maximum value "+r.maximum)]:[]}function er(t){var e,n,r,i=t.valueSpec,o=Ot(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,u=!s,l="array"===Fn(t.value.stops)&&"array"===Fn(t.value.stops[0])&&"object"===Fn(t.value.stops[0][0]),c=Jn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new Lt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;return e=e.concat($n({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Fn(n)&&0===n.length&&e.push(new Lt(t.key,n,"array must have at least one stop")),e},default:function(t){return Sr({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&c.push(new Lt(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||c.push(new Lt(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!Nn(t.valueSpec)&&c.push(new Lt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!Rn(t.valueSpec)?c.push(new Lt(t.key,t.value,"property functions not supported")):s&&!Dn(t.valueSpec)&&c.push(new Lt(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!l||void 0!==t.value.property||c.push(new Lt(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],o=t.value,s=t.key;if("array"!==Fn(o))return[new Lt(s,o,"array expected, "+Fn(o)+" found")];if(2!==o.length)return[new Lt(s,o,"array length 2 expected, length "+o.length+" found")];if(l){if("object"!==Fn(o[0]))return[new Lt(s,o,"object expected, "+Fn(o[0])+" found")];if(void 0===o[0].zoom)return[new Lt(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new Lt(s,o,"object stop key must have value")];if(r&&r>Ot(o[0].zoom))return[new Lt(s,o[0].zoom,"stop zoom values must appear in ascending order")];Ot(o[0].zoom)!==r&&(r=Ot(o[0].zoom),n=void 0,a={}),e=e.concat(Jn({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:tr,value:p}}))}else e=e.concat(p({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return Wn(Rt(o[1]))?e.concat([new Lt(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(Sr({key:s+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,r){var s=Fn(t.value),u=Ot(t.value),l=null!==t.value?t.value:r;if(e){if(s!==e)return[new Lt(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Lt(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var c="number expected, "+s+" found";return Rn(i)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Lt(t.key,l,c)]}return"categorical"!==o||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==o&&"number"===s&&void 0!==n&&u<n?[new Lt(t.key,l,"stop domain values must appear in ascending order")]:(n=u,"categorical"===o&&u in a?[new Lt(t.key,l,"stop domain values must be unique")]:(a[u]=!0,[])):[new Lt(t.key,l,"integer expected, found "+u)]}}function nr(t){var e=("property"===t.expressionContext?Kn:qn)(Rt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new Lt(""+t.key+e.key,t.value,e.message)}));var n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Lt(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!ze(n))return[new Lt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!ze(n))return[new Lt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Be(n,["zoom","feature-state"]))return[new Lt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Fe(n))return[new Lt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rr(t){var e=t.key,n=t.value,r=t.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Ot(n))&&i.push(new Lt(e,n,"expected one of ["+r.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(r.values).indexOf(Ot(n))&&i.push(new Lt(e,n,"expected one of ["+Object.keys(r.values).join(", ")+"], "+JSON.stringify(n)+" found")),i}function ir(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,n=t.slice(1);e<n.length;e+=1){var r=n[e];if(!ir(r)&&"boolean"!=typeof r)return!1}return!0;default:return!0}}Qn.deserialize=function(t){return new Qn(t._parameters,t._specification)},Qn.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var or={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ar(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};ir(t)||(t=ur(t));var e=qn(t,or);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,n,r){return e.value.evaluate(t,n,{},r)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var n=1;n<e.length;n++)if(t(e[n]))return!0;return!1}(t)}}function sr(t,e){return t<e?-1:t>e?1:0}function ur(t){if(!t)return!0;var e,n=t[0];return t.length<=1?"any"!==n:"=="===n?lr(t[1],t[2],"=="):"!="===n?pr(lr(t[1],t[2],"==")):"<"===n||">"===n||"<="===n||">="===n?lr(t[1],t[2],n):"any"===n?(e=t.slice(1),["any"].concat(e.map(ur))):"all"===n?["all"].concat(t.slice(1).map(ur)):"none"===n?["all"].concat(t.slice(1).map(ur).map(pr)):"in"===n?cr(t[1],t.slice(2)):"!in"===n?pr(cr(t[1],t.slice(2))):"has"===n?hr(t[1]):"!has"===n?pr(hr(t[1])):"within"!==n||t}function lr(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function cr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(sr)]]:["filter-in-small",t,["literal",e]]}}function hr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function pr(t){return["!",t]}function fr(t){return ir(Rt(t.value))?nr(kt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var n=e.value,r=e.key;if("array"!==Fn(n))return[new Lt(r,n,"array expected, "+Fn(n)+" found")];var i,o=e.styleSpec,a=[];if(n.length<1)return[new Lt(r,n,"filter array must have at least 1 element")];switch(a=a.concat(rr({key:r+"[0]",value:n[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ot(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Ot(n[1])&&a.push(new Lt(r,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&a.push(new Lt(r,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":n.length>=2&&"string"!==(i=Fn(n[1]))&&a.push(new Lt(r+"[1]",n[1],"string expected, "+i+" found"));for(var s=2;s<n.length;s++)i=Fn(n[s]),"$type"===Ot(n[1])?a=a.concat(rr({key:r+"["+s+"]",value:n[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new Lt(r+"["+s+"]",n[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<n.length;u++)a=a.concat(t({key:r+"["+u+"]",value:n[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Fn(n[1]),2!==n.length?a.push(new Lt(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new Lt(r+"[1]",n[1],"string expected, "+i+" found"));break;case"within":i=Fn(n[1]),2!==n.length?a.push(new Lt(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"object"!==i&&a.push(new Lt(r+"[1]",n[1],"object expected, "+i+" found"))}return a}(t)}function dr(t,e){var n=t.key,r=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return Sr({key:n,value:o,valueSpec:i.transition,style:r,styleSpec:i});var l,c=t.valueSpec||s[a];if(!c)return[new Lt(n,o,'unknown property "'+a+'"')];if("string"===Fn(o)&&Rn(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(o)))return[new Lt(n,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&r&&!r.glyphs&&h.push(new Lt(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&zn(Rt(o))&&"identity"===Ot(o.type)&&h.push(new Lt(n,o,'"text-font" does not support identity functions'))),h.concat(Sr({key:t.key,value:o,valueSpec:c,style:r,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function mr(t){return dr(t,"paint")}function gr(t){return dr(t,"layout")}function yr(t){var e=[],n=t.value,r=t.key,i=t.style,o=t.styleSpec;n.type||n.ref||e.push(new Lt(r,n,'either "type" or "ref" is required'));var a,s=Ot(n.type),u=Ot(n.ref);if(n.id)for(var l=Ot(n.id),c=0;c<t.arrayIndex;c++){var h=i.layers[c];Ot(h.id)===l&&e.push(new Lt(r,n.id,'duplicate layer id "'+n.id+'", previously used at line '+h.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(t){t in n&&e.push(new Lt(r,n[t],'"'+t+'" is prohibited for ref layers'))})),i.layers.forEach((function(t){Ot(t.id)===u&&(a=t)})),a?a.ref?e.push(new Lt(r,n.ref,"ref cannot reference another ref layer")):s=Ot(a.type):e.push(new Lt(r,n.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(n.source){var p=i.sources&&i.sources[n.source],f=p&&Ot(p.type);p?"vector"===f&&"raster"===s?e.push(new Lt(r,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new Lt(r,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==f||n["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new Lt(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||e.push(new Lt(r,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Lt(r,n,'layer "'+n.id+'" must specify a "source-layer"')):e.push(new Lt(r,n.source,'source "'+n.source+'" not found'))}else e.push(new Lt(r,n,'missing required property "source"'));return e=e.concat(Jn({key:r,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Sr({key:r+".type",value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"})},filter:fr,layout:function(t){return Jn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return gr(kt({layerType:s},t))}}})},paint:function(t){return Jn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return mr(kt({layerType:s},t))}}})}}}))}function vr(t){var e=t.value,n=t.key,r=Fn(e);return"string"!==r?[new Lt(n,e,"string expected, "+r+" found")]:[]}var _r={promoteId:function(t){var e=t.key,n=t.value;if("string"===Fn(n))return vr({key:e,value:n});var r=[];for(var i in n)r.push.apply(r,vr({key:e+"."+i,value:n[i]}));return r}};function xr(t){var e=t.value,n=t.key,r=t.styleSpec,i=t.style;if(!e.type)return[new Lt(n,e,'"type" is required')];var o,a=Ot(e.type);switch(a){case"vector":case"raster":case"raster-dem":return Jn({key:n,value:e,valueSpec:r["source_"+a.replace("-","_")],style:t.style,styleSpec:r,objectElementValidators:_r});case"geojson":if(o=Jn({key:n,value:e,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:_r}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],l=u[0],c="string"==typeof l?[l,["accumulated"],["get",s]]:l;o.push.apply(o,nr({key:n+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),o.push.apply(o,nr({key:n+"."+s+".reduce",value:c,expressionContext:"cluster-reduce"}))}return o;case"video":return Jn({key:n,value:e,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return Jn({key:n,value:e,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new Lt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rr({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function br(t){var e=t.value,n=t.styleSpec,r=n.light,i=t.style,o=[],a=Fn(e);if(void 0===e)return o;if("object"!==a)return o.concat([new Lt("light",e,"object expected, "+a+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);o=o.concat(u&&r[u[1]]&&r[u[1]].transition?Sr({key:s,value:e[s],valueSpec:n.transition,style:i,styleSpec:n}):r[s]?Sr({key:s,value:e[s],valueSpec:r[s],style:i,styleSpec:n}):[new Lt(s,e[s],'unknown property "'+s+'"')])}return o}var wr={"*":function(){return[]},array:$n,boolean:function(t){var e=t.value,n=t.key,r=Fn(e);return"boolean"!==r?[new Lt(n,e,"boolean expected, "+r+" found")]:[]},number:tr,color:function(t){var e=t.key,n=t.value,r=Fn(n);return"string"!==r?[new Lt(e,n,"color expected, "+r+" found")]:null===$t(n)?[new Lt(e,n,'color expected, "'+n+'" found')]:[]},constants:It,enum:rr,filter:fr,function:er,layer:yr,object:Jn,source:xr,light:br,string:vr,formatted:function(t){return 0===vr(t).length?[]:nr(t)},resolvedImage:function(t){return 0===vr(t).length?[]:nr(t)}};function Sr(t){var e=t.value,n=t.valueSpec,r=t.styleSpec;return n.expression&&zn(Ot(e))?er(t):n.expression&&Wn(Rt(e))?nr(t):n.type&&wr[n.type]?wr[n.type](t):Jn(kt({},t,{valueSpec:n.type?r[n.type]:n}))}function Er(t){var e=t.value,n=t.key,r=vr(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new Lt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new Lt(n,e,'"glyphs" url must include a "{range}" token'))),r}function Cr(t,e){void 0===e&&(e=Pt);var n=[];return n=n.concat(Sr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Er,"*":function(){return[]}}})),t.constants&&(n=n.concat(It({key:"constants",value:t.constants,style:t,styleSpec:e}))),Mr(n)}function Mr(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function Tr(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return Mr(t.apply(this,e))}}Cr.source=Tr(xr),Cr.light=Tr(br),Cr.layer=Tr(yr),Cr.filter=Tr(fr),Cr.paintProperty=Tr(mr),Cr.layoutProperty=Tr(gr);var Ar=Cr,Pr=Ar.light,Lr=Ar.paintProperty,Ir=Ar.layoutProperty;function kr(t,e){var n=!1;if(e&&e.length)for(var r=0,i=e;r<i.length;r+=1)t.fire(new Tt(new Error(i[r].message))),n=!0;return n}var Or=Rr;function Rr(t,e,n){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(n=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[3+o],s=i[3+o+1];r.push(a===s?null:i.subarray(a,s))}var u=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var l=0;l<this.d*this.d;l++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var c=n/e*t;this.min=-c,this.max=t+c}Rr.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Rr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Rr.prototype._insertCell=function(t,e,n,r,i,o){this.cells[i].push(o)},Rr.prototype.query=function(t,e,n,r,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=n&&a<=r&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,n,r,this._queryCell,s,{},i),s},Rr.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=this.cells[i];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var p=u[h];if(void 0===a[p]){var f=4*p;(s?s(c[f+0],c[f+1],c[f+2],c[f+3]):t<=c[f+2]&&e<=c[f+3]&&n>=c[f+0]&&r>=c[f+1])?(a[p]=!0,o.push(l[p])):a[p]=!1}}},Rr.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(n),h=this._convertToCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.d*f+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&i.call(this,t,e,n,r,d,o,a,s))return}},Rr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Rr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Rr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[3+a]=o,i.set(s,o),o+=s.length}return i[3+t.length]=o,i.set(this.keys,o),i[3+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var Dr=a.ImageData,Nr=a.ImageBitmap,Fr={};function zr(t,e,n){void 0===n&&(n={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Fr[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}for(var Br in zr("Object",Object),Or.serialize=function(t,e){var n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Or.deserialize=function(t){return new Or(t.buffer)},zr("Grid",Or),zr("Color",te),zr("Error",Error),zr("ResolvedImage",ie),zr("StylePropertyFunction",Qn),zr("StyleExpression",Hn,{omit:["_evaluator"]}),zr("ZoomDependentExpression",Yn),zr("ZoomConstantExpression",Xn),zr("CompoundExpression",_e,{omit:["_evaluate"]}),Tn)Tn[Br]._classRegistryKey||zr("Expression_"+Br,Tn[Br]);function jr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Ur(t){return Nr&&t instanceof Nr}function Zr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(jr(t)||Ur(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var n=t;return e&&e.push(n.buffer),n}if(t instanceof Dr)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var r=[],i=0,o=t;i<o.length;i+=1)r.push(Zr(o[i],e));return r}if("object"==typeof t){var a=t.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var u=a.serialize?a.serialize(t,e):{};if(!a.serialize){for(var l in t)if(t.hasOwnProperty(l)&&!(Fr[s].omit.indexOf(l)>=0)){var c=t[l];u[l]=Fr[s].shallow.indexOf(l)>=0?c:Zr(c,e)}t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function Vr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||jr(t)||Ur(t)||ArrayBuffer.isView(t)||t instanceof Dr)return t;if(Array.isArray(t))return t.map(Vr);if("object"==typeof t){var e=t.$name||"Object",n=Fr[e].klass;if(!n)throw new Error("can't deserialize unregistered class "+e);if(n.deserialize)return n.deserialize(t);for(var r=Object.create(n.prototype),i=0,o=Object.keys(t);i<o.length;i+=1){var a=o[i];if("$name"!==a){var s=t[a];r[a]=Fr[e].shallow.indexOf(a)>=0?s:Vr(s)}}return r}throw new Error("can't deserialize object of type "+typeof t)}var Gr=function(){this.first=!0};Gr.prototype.update=function(t,e){var n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))};var Hr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Wr(t){for(var e=0,n=t;e<n.length;e+=1)if(qr(n[e].charCodeAt(0)))return!0;return!1}function qr(t){return!(746!==t&&747!==t&&(t<4352||!(Hr["Bopomofo Extended"](t)||Hr.Bopomofo(t)||Hr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Hr["CJK Compatibility Ideographs"](t)||Hr["CJK Compatibility"](t)||Hr["CJK Radicals Supplement"](t)||Hr["CJK Strokes"](t)||!(!Hr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Hr["CJK Unified Ideographs Extension A"](t)||Hr["CJK Unified Ideographs"](t)||Hr["Enclosed CJK Letters and Months"](t)||Hr["Hangul Compatibility Jamo"](t)||Hr["Hangul Jamo Extended-A"](t)||Hr["Hangul Jamo Extended-B"](t)||Hr["Hangul Jamo"](t)||Hr["Hangul Syllables"](t)||Hr.Hiragana(t)||Hr["Ideographic Description Characters"](t)||Hr.Kanbun(t)||Hr["Kangxi Radicals"](t)||Hr["Katakana Phonetic Extensions"](t)||Hr.Katakana(t)&&12540!==t||!(!Hr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Hr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Hr["Unified Canadian Aboriginal Syllabics"](t)||Hr["Unified Canadian Aboriginal Syllabics Extended"](t)||Hr["Vertical Forms"](t)||Hr["Yijing Hexagram Symbols"](t)||Hr["Yi Syllables"](t)||Hr["Yi Radicals"](t))))}function Xr(t){return!(qr(t)||function(t){return!!(Hr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Hr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Hr["Letterlike Symbols"](t)||Hr["Number Forms"](t)||Hr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Hr["Control Pictures"](t)&&9251!==t||Hr["Optical Character Recognition"](t)||Hr["Enclosed Alphanumerics"](t)||Hr["Geometric Shapes"](t)||Hr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Hr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Hr["CJK Symbols and Punctuation"](t)||Hr.Katakana(t)||Hr["Private Use Area"](t)||Hr["CJK Compatibility Forms"](t)||Hr["Small Form Variants"](t)||Hr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Yr(t){return t>=1424&&t<=2303||Hr["Arabic Presentation Forms-A"](t)||Hr["Arabic Presentation Forms-B"](t)}function Kr(t,e){return!(!e&&Yr(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Hr.Khmer(t))}function Qr(t){for(var e=0,n=t;e<n.length;e+=1)if(Yr(n[e].charCodeAt(0)))return!0;return!1}var Jr=null,$r="unavailable",ti=null,ei=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&($r="error"),Jr&&Jr(t)};function ni(){ri.fire(new Mt("pluginStateChange",{pluginStatus:$r,pluginURL:ti}))}var ri=new At,ii=function(){return $r},oi=function(){if("deferred"!==$r||!ti)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$r="loading",ni(),ti&&xt({url:ti},(function(t){t?ei(t):($r="loaded",ni())}))},ai={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===$r||null!=ai.applyArabicShaping},isLoading:function(){return"loading"===$r},setState:function(t){$r=t.pluginStatus,ti=t.pluginURL},isParsed:function(){return null!=ai.applyArabicShaping&&null!=ai.processBidirectionalText&&null!=ai.processStyledBidirectionalText},getPluginURL:function(){return ti}},si=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Gr,this.transition={})};si.prototype.isSupportedScript=function(t){return function(t,e){for(var n=0,r=t;n<r.length;n+=1)if(!Kr(r[n].charCodeAt(0),e))return!1;return!0}(t,ai.isLoaded())},si.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},si.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}};var ui=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(zn(t))return new Qn(t,e);if(Wn(t)){var n=Kn(t,e);if("error"===n.result)throw new Error(n.value.map((function(t){return t.key+": "+t.message})).join(", "));return n.value}var r=t;return"string"==typeof t&&"color"===e.type&&(r=te.parse(t)),{kind:"constant",evaluate:function(){return r}}}(void 0===e?t.specification.default:e,t.specification)};ui.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},ui.prototype.possiblyEvaluate=function(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)};var li=function(t){this.property=t,this.value=new ui(t,void 0)};li.prototype.transitioned=function(t,e){return new hi(this.property,this.value,e,p({},t.transition,this.transition),t.now)},li.prototype.untransitioned=function(){return new hi(this.property,this.value,null,{},0)};var ci=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};ci.prototype.getValue=function(t){return b(this._values[t].value.value)},ci.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new li(this._values[t].property)),this._values[t].value=new ui(this._values[t].property,null===e?void 0:b(e))},ci.prototype.getTransition=function(t){return b(this._values[t].transition)},ci.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new li(this._values[t].property)),this._values[t].transition=b(e)||void 0},ci.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i);var o=this.getTransition(r);void 0!==o&&(t[r+"-transition"]=o)}return t},ci.prototype.transitioned=function(t,e){for(var n=new pi(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var o=i[r];n._values[o]=this._values[o].transitioned(t,e._values[o])}return n},ci.prototype.untransitioned=function(){for(var t=new pi(this._properties),e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e];t._values[r]=this._values[r].untransitioned()}return t};var hi=function(t,e,n,r,i){this.property=t,this.value=e,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=n)};hi.prototype.possiblyEvaluate=function(t,e,n){var r=t.now||0,i=this.value.possiblyEvaluate(t,e,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(t,e,n);var a=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,n),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(a))}return i};var pi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};pi.prototype.possiblyEvaluate=function(t,e,n){for(var r=new mi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(t,e,n)}return r},pi.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var fi=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};fi.prototype.getValue=function(t){return b(this._values[t].value)},fi.prototype.setValue=function(t,e){this._values[t]=new ui(this._values[t].property,null===e?void 0:b(e))},fi.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i)}return t},fi.prototype.possiblyEvaluate=function(t,e,n){for(var r=new mi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(t,e,n)}return r};var di=function(t,e,n){this.property=t,this.value=e,this.parameters=n};di.prototype.isConstant=function(){return"constant"===this.value.kind},di.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},di.prototype.evaluate=function(t,e,n,r){return this.property.evaluate(this.value,this.parameters,t,e,n,r)};var mi=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};mi.prototype.get=function(t){return this._values[t]};var gi=function(t){this.specification=t};gi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},gi.prototype.interpolate=function(t,e,n){var r=He[this.specification.type];return r?r(t,e,n):t};var yi=function(t,e){this.specification=t,this.overrides=e};yi.prototype.possiblyEvaluate=function(t,e,n,r){return new di(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,r)}:t.expression,e)},yi.prototype.interpolate=function(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new di(this,{kind:"constant",value:void 0},t.parameters);var r=He[this.specification.type];return r?new di(this,{kind:"constant",value:r(t.value.value,e.value.value,n)},t.parameters):t},yi.prototype.evaluate=function(t,e,n,r,i,o){return"constant"===t.kind?t.value:t.evaluate(e,n,r,i,o)};var vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,n,r){if(void 0===t.value)return new di(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(o,o,o,e);return new di(this,{kind:"constant",value:a},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new di(this,{kind:"constant",value:s},e)}return new di(this,t.expression,e)},e.prototype.evaluate=function(t,e,n,r,i,o){if("source"===t.kind){var a=t.evaluate(e,n,r,i,o);return this._calculate(a,a,a,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,r),t.evaluate({zoom:Math.floor(e.zoom)},n,r),t.evaluate({zoom:Math.floor(e.zoom)+1},n,r),e):t.value},e.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},e.prototype.interpolate=function(t){return t},e}(yi),_i=function(t){this.specification=t};_i.prototype.possiblyEvaluate=function(t,e,n,r){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n,r);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new si(Math.floor(e.zoom-1),e)),t.expression.evaluate(new si(Math.floor(e.zoom),e)),t.expression.evaluate(new si(Math.floor(e.zoom+1),e)),e)}},_i.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},_i.prototype.interpolate=function(t){return t};var xi=function(t){this.specification=t};xi.prototype.possiblyEvaluate=function(t,e,n,r){return!!t.expression.evaluate(e,null,{},n,r)},xi.prototype.interpolate=function(){return!1};var bi=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var n=t[e];n.specification.overridable&&this.overridableProperties.push(e);var r=this.defaultPropertyValues[e]=new ui(n,void 0),i=this.defaultTransitionablePropertyValues[e]=new li(n);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}};zr("DataDrivenProperty",yi),zr("DataConstantProperty",gi),zr("CrossFadedDataDrivenProperty",vi),zr("CrossFadedProperty",_i),zr("ColorRampProperty",xi);var wi=function(t){function e(e,n){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new fi(n.layout)),n.paint)){for(var r in this._transitionablePaint=new ci(n.paint),e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mi(n.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,n){void 0===n&&(n={}),null!=e&&this._validate(Ir,"layers."+this.id+".layout."+t,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return v(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e&&this._validate(Lr,"layers."+this.id+".paint."+t,t,e,n))return!1;if(v(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var r=this._transitionablePaint._values[t],i="cross-faded-data-driven"===r.property.specification["property-type"],o=r.value.isDataDriven(),a=r.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||o||i||this._handleOverridablePaintPropertyUpdate(t,a,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,n){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),x(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,n,r,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&kr(this,t.call(Ar,{key:e,layerType:this.type,objectKey:n,value:r,styleSpec:Pt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof di&&Rn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(At),Si={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ei=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ci=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Mi(t,e){void 0===e&&(e=1);var n=0,r=0;return{members:t.map((function(t){var i=Si[t.type].BYTES_PER_ELEMENT,o=n=Ti(n,Math.max(e,i)),a=t.components||1;return r=Math.max(r,i),n+=i*a,{name:t.name,type:t.type,components:a,offset:o}})),size:Ti(n,Math.max(r,e)),alignment:e}}function Ti(t,e){return Math.ceil(t/e)*e}Ci.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ci.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Ci.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ci.prototype.clear=function(){this.length=0},Ci.prototype.resize=function(t){this.reserve(t),this.length=t},Ci.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Ci.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ai=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.int16[r+0]=e,this.int16[r+1]=n,t},e}(Ci);Ai.prototype.bytesPerElement=4,zr("StructArrayLayout2i4",Ai);var Pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,t},e}(Ci);Pi.prototype.bytesPerElement=8,zr("StructArrayLayout4i8",Pi);var Li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ci);Li.prototype.bytesPerElement=12,zr("StructArrayLayout2i4i12",Li);var Ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=4*t,u=8*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.uint8[u+4]=r,this.uint8[u+5]=i,this.uint8[u+6]=o,this.uint8[u+7]=a,t},e}(Ci);Ii.prototype.bytesPerElement=8,zr("StructArrayLayout2i4ub8",Ii);var ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.float32[r+0]=e,this.float32[r+1]=n,t},e}(Ci);ki.prototype.bytesPerElement=8,zr("StructArrayLayout2f8",ki);var Oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,r,i,o,a,s,u,l)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c){var h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=i,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=u,this.uint16[h+8]=l,this.uint16[h+9]=c,t},e}(Ci);Oi.prototype.bytesPerElement=20,zr("StructArrayLayout10ui20",Oi);var Ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,n,r,i,o,a,s,u,l,c,h)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,p){var f=12*t;return this.int16[f+0]=e,this.int16[f+1]=n,this.int16[f+2]=r,this.int16[f+3]=i,this.uint16[f+4]=o,this.uint16[f+5]=a,this.uint16[f+6]=s,this.uint16[f+7]=u,this.int16[f+8]=l,this.int16[f+9]=c,this.int16[f+10]=h,this.int16[f+11]=p,t},e}(Ci);Ri.prototype.bytesPerElement=24,zr("StructArrayLayout4i4ui4i24",Ri);var Di=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=n,this.float32[i+2]=r,t},e}(Ci);Di.prototype.bytesPerElement=12,zr("StructArrayLayout3f12",Di);var Ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Ci);Ni.prototype.bytesPerElement=4,zr("StructArrayLayout1ul4",Ni);var Fi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,n,r,i,o,a,s,u)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l){var c=10*t,h=5*t;return this.int16[c+0]=e,this.int16[c+1]=n,this.int16[c+2]=r,this.int16[c+3]=i,this.int16[c+4]=o,this.int16[c+5]=a,this.uint32[h+3]=s,this.uint16[c+8]=u,this.uint16[c+9]=l,t},e}(Ci);Fi.prototype.bytesPerElement=20,zr("StructArrayLayout6i1ul2ui20",Fi);var zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ci);zi.prototype.bytesPerElement=12,zr("StructArrayLayout2i2i2i12",zi);var Bi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,r,i)},e.prototype.emplace=function(t,e,n,r,i,o){var a=4*t,s=8*t;return this.float32[a+0]=e,this.float32[a+1]=n,this.float32[a+2]=r,this.int16[s+6]=i,this.int16[s+7]=o,t},e}(Ci);Bi.prototype.bytesPerElement=16,zr("StructArrayLayout2f1f2i16",Bi);var ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=n,this.float32[a+1]=r,this.float32[a+2]=i,t},e}(Ci);ji.prototype.bytesPerElement=12,zr("StructArrayLayout2ub2f12",ji);var Ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,this.uint16[i+2]=r,t},e}(Ci);Ui.prototype.bytesPerElement=6,zr("StructArrayLayout3ui6",Ui);var Zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g){var y=this.length;return this.resize(y+1),this.emplace(y,t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g,y){var v=24*t,_=12*t,x=48*t;return this.int16[v+0]=e,this.int16[v+1]=n,this.uint16[v+2]=r,this.uint16[v+3]=i,this.uint32[_+2]=o,this.uint32[_+3]=a,this.uint32[_+4]=s,this.uint16[v+10]=u,this.uint16[v+11]=l,this.uint16[v+12]=c,this.float32[_+7]=h,this.float32[_+8]=p,this.uint8[x+36]=f,this.uint8[x+37]=d,this.uint8[x+38]=m,this.uint32[_+10]=g,this.int16[v+22]=y,t},e}(Ci);Zi.prototype.bytesPerElement=48,zr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Zi);var Vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g,y,v,_,x,b,w,S,E,C,M,T){var A=this.length;return this.resize(A+1),this.emplace(A,t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g,y,v,_,x,b,w,S,E,C,M,T)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g,y,v,_,x,b,w,S,E,C,M,T,A){var P=34*t,L=17*t;return this.int16[P+0]=e,this.int16[P+1]=n,this.int16[P+2]=r,this.int16[P+3]=i,this.int16[P+4]=o,this.int16[P+5]=a,this.int16[P+6]=s,this.int16[P+7]=u,this.uint16[P+8]=l,this.uint16[P+9]=c,this.uint16[P+10]=h,this.uint16[P+11]=p,this.uint16[P+12]=f,this.uint16[P+13]=d,this.uint16[P+14]=m,this.uint16[P+15]=g,this.uint16[P+16]=y,this.uint16[P+17]=v,this.uint16[P+18]=_,this.uint16[P+19]=x,this.uint16[P+20]=b,this.uint16[P+21]=w,this.uint16[P+22]=S,this.uint32[L+12]=E,this.float32[L+13]=C,this.float32[L+14]=M,this.float32[L+15]=T,this.float32[L+16]=A,t},e}(Ci);Vi.prototype.bytesPerElement=68,zr("StructArrayLayout8i15ui1ul4f68",Vi);var Gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Ci);Gi.prototype.bytesPerElement=4,zr("StructArrayLayout1f4",Gi);var Hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=n,this.int16[i+2]=r,t},e}(Ci);Hi.prototype.bytesPerElement=6,zr("StructArrayLayout3i6",Hi);var Wi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=n,this.uint16[i+3]=r,t},e}(Ci);Wi.prototype.bytesPerElement=8,zr("StructArrayLayout1ul2ui8",Wi);var qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,t},e}(Ci);qi.prototype.bytesPerElement=4,zr("StructArrayLayout2ui4",qi);var Xi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Ci);Xi.prototype.bytesPerElement=2,zr("StructArrayLayout1ui2",Xi);var Yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,t},e}(Ci);Yi.prototype.bytesPerElement=16,zr("StructArrayLayout4f16",Yi);var Ki=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,n),e}(Ei);Ki.prototype.size=20;var Qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ki(this,t)},e}(Fi);zr("CollisionBoxArray",Qi);var Ji=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},n.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},n.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},n.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},n.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,n),e}(Ei);Ji.prototype.size=48;var $i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ji(this,t)},e}(Zi);zr("PlacedSymbolArray",$i);var to=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},n.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},n.key.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},n.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},n.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},n.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},n.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},n.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},n.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},n.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,n),e}(Ei);to.prototype.size=68;var eo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new to(this,t)},e}(Vi);zr("SymbolInstanceArray",eo);var no=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(Gi);zr("GlyphOffsetArray",no);var ro=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Hi);zr("SymbolLineVertexArray",ro);var io=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,n),e}(Ei);io.prototype.size=8;var oo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new io(this,t)},e}(Wi);zr("FeatureIndexArray",oo);var ao=Mi([{name:"a_pos",components:2,type:"Int16"}],4).members,so=function(t){void 0===t&&(t=[]),this.segments=t};function uo(t,e){return 256*(t=c(Math.floor(t),0,255))+c(Math.floor(e),0,255)}so.prototype.prepareSegment=function(t,e,n,r){var i=this.segments[this.segments.length-1];return t>so.MAX_VERTEX_ARRAY_LENGTH&&S("Max vertices per segment is "+so.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>so.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i},so.prototype.get=function(){return this.segments},so.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var n=e[t];for(var r in n.vaos)n.vaos[r].destroy()}},so.simpleSegment=function(t,e,n,r){return new so([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])},so.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zr("SegmentVector",so);var lo=Mi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),co=e((function(t){t.exports=function(t,e){var n,r,i,o,a,s,u,l;for(r=t.length-(n=3&t.length),i=e,a=3432918353,s=461845907,l=0;l<r;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),ho=e((function(t){t.exports=function(t,e){for(var n,r=t.length,i=e^r,o=0;r>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),po=co,fo=ho;po.murmur3=co,po.murmur2=fo;var mo=function(){this.ids=[],this.positions=[],this.indexed=!1};mo.prototype.add=function(t,e,n,r){this.ids.push(yo(t)),this.positions.push(e,n,r)},mo.prototype.getPositions=function(t){for(var e=yo(t),n=0,r=this.ids.length-1;n<r;){var i=n+r>>1;this.ids[i]>=e?r=i:n=i+1}for(var o=[];this.ids[n]===e;)o.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return o},mo.serialize=function(t,e){var n=new Float64Array(t.ids),r=new Uint32Array(t.positions);return function t(e,n,r,i){for(;r<i;){for(var o=e[r+i>>1],a=r-1,s=i+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;vo(e,a,s),vo(n,3*a,3*s),vo(n,3*a+1,3*s+1),vo(n,3*a+2,3*s+2)}s-r<i-s?(t(e,n,r,s),r=s+1):(t(e,n,s+1,i),i=s)}}(n,r,0,n.length-1),e&&e.push(n.buffer,r.buffer),{ids:n,positions:r}},mo.deserialize=function(t){var e=new mo;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var go=Math.pow(2,53)-1;function yo(t){var e=+t;return!isNaN(e)&&e<=go?e:po(String(t))}function vo(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}zr("FeaturePositionMap",mo);var _o=function(t,e){this.gl=t.gl,this.location=e},xo=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(_o),bo=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(_o),wo=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(_o),So=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(_o),Eo=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(_o),Co=function(t){function e(e,n){t.call(this,e,n),this.current=te.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(_o),Mo=new Float32Array(16),To=function(t){function e(e,n){t.call(this,e,n),this.current=Mo}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(_o);function Ao(t){return[uo(255*t.r,255*t.g),uo(255*t.b,255*t.a)]}var Po=function(t,e,n){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=n};Po.prototype.setUniform=function(t,e,n){t.set(n.constantOr(this.value))},Po.prototype.getBinding=function(t,e,n){return"color"===this.type?new Co(t,e):new bo(t,e)};var Lo=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Lo.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Lo.prototype.setUniform=function(t,e,n,r){var i="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;i&&t.set(i)},Lo.prototype.getBinding=function(t,e,n){return"u_pattern"===n.substr(0,9)?new Eo(t,e):new bo(t,e)};var Io=function(t,e,n,r){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?2:1,offset:0}})),this.paintVertexArray=new r};Io.prototype.populatePaintArray=function(t,e,n,r,i){var o=this.paintVertexArray.length,a=this.expression.evaluate(new si(0),e,{},r,[],i);this.paintVertexArray.resize(t),this._setPaintValue(o,t,a)},Io.prototype.updatePaintArray=function(t,e,n,r){var i=this.expression.evaluate({zoom:0},n,r);this._setPaintValue(t,e,i)},Io.prototype._setPaintValue=function(t,e,n){if("color"===this.type)for(var r=Ao(n),i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1]);else{for(var o=t;o<e;o++)this.paintVertexArray.emplace(o,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}},Io.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Io.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ko=function(t,e,n,r,i,o){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?4:2,offset:0}})),this.paintVertexArray=new o};ko.prototype.populatePaintArray=function(t,e,n,r,i){var o=this.expression.evaluate(new si(this.zoom),e,{},r,[],i),a=this.expression.evaluate(new si(this.zoom+1),e,{},r,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,o,a)},ko.prototype.updatePaintArray=function(t,e,n,r){var i=this.expression.evaluate({zoom:this.zoom},n,r),o=this.expression.evaluate({zoom:this.zoom+1},n,r);this._setPaintValue(t,e,i,o)},ko.prototype._setPaintValue=function(t,e,n,r){if("color"===this.type)for(var i=Ao(n),o=Ao(r),a=t;a<e;a++)this.paintVertexArray.emplace(a,i[0],i[1],o[0],o[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}},ko.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ko.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ko.prototype.setUniform=function(t,e){var n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=c(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(r)},ko.prototype.getBinding=function(t,e,n){return new bo(t,e)};var Oo=function(t,e,n,r,i,o){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i};Oo.prototype.populatePaintArray=function(t,e,n){var r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],n)},Oo.prototype.updatePaintArray=function(t,e,n,r,i){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],i)},Oo.prototype._setPaintValues=function(t,e,n,r){if(r&&n){var i=r[n.min],o=r[n.mid],a=r[n.max];if(i&&o&&a)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],o.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio)}},Oo.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,lo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,lo.members,this.expression.isStateDependent))},Oo.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Ro=function(t,e,n){this.binders={},this._buffers=[];var r=[];for(var i in t.paint._values)if(n(i)){var o=t.paint.get(i);if(o instanceof di&&Rn(o.property.specification)){var a=No(i,t.type),s=o.value,u=o.property.specification.type,l=o.property.useIntegerZoom,c=o.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===s.kind)this.binders[i]=h?new Lo(s.value,a):new Po(s.value,a,u),r.push("/u_"+i);else if("source"===s.kind||h){var p=Fo(i,u,"source");this.binders[i]=h?new Oo(s,u,l,e,p,t.id):new Io(s,a,u,p),r.push("/a_"+i)}else{var f=Fo(i,u,"composite");this.binders[i]=new ko(s,a,u,l,e,f),r.push("/z_"+i)}}}this.cacheKey=r.sort().join("")};Ro.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Io||e instanceof ko?e.maxValue:0},Ro.prototype.populatePaintArrays=function(t,e,n,r,i){for(var o in this.binders){var a=this.binders[o];(a instanceof Io||a instanceof ko||a instanceof Oo)&&a.populatePaintArray(t,e,n,r,i)}},Ro.prototype.setConstantPatternPositions=function(t,e){for(var n in this.binders){var r=this.binders[n];r instanceof Lo&&r.setConstantPatternPositions(t,e)}},Ro.prototype.updatePaintArrays=function(t,e,n,r,i){var o=!1;for(var a in t)for(var s=0,u=e.getPositions(a);s<u.length;s+=1){var l=u[s],c=n.feature(l.index);for(var h in this.binders){var p=this.binders[h];if((p instanceof Io||p instanceof ko||p instanceof Oo)&&!0===p.expression.isStateDependent){var f=r.paint.get(h);p.expression=f.value,p.updatePaintArray(l.start,l.end,c,t[a],i),o=!0}}}return o},Ro.prototype.defines=function(){var t=[];for(var e in this.binders){var n=this.binders[e];(n instanceof Po||n instanceof Lo)&&t.push.apply(t,n.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},Ro.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Io||n instanceof ko)for(var r=0;r<n.paintVertexAttributes.length;r++)t.push(n.paintVertexAttributes[r].name);else if(n instanceof Oo)for(var i=0;i<lo.members.length;i++)t.push(lo.members[i].name)}return t},Ro.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Po||n instanceof Lo||n instanceof ko)for(var r=0,i=n.uniformNames;r<i.length;r+=1)t.push(i[r])}return t},Ro.prototype.getPaintVertexBuffers=function(){return this._buffers},Ro.prototype.getUniforms=function(t,e){var n=[];for(var r in this.binders){var i=this.binders[r];if(i instanceof Po||i instanceof Lo||i instanceof ko)for(var o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var u=i.getBinding(t,e[s],s);n.push({name:s,property:r,binding:u})}}}return n},Ro.prototype.setUniforms=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.name,u=a.property;this.binders[u].setUniform(a.binding,r,n.get(u),s)}},Ro.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var n=this.binders[e];if(t&&n instanceof Oo){var r=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else(n instanceof Io||n instanceof ko)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}},Ro.prototype.upload=function(t){for(var e in this.binders){var n=this.binders[e];(n instanceof Io||n instanceof ko||n instanceof Oo)&&n.upload(t)}this.updatePaintBuffers()},Ro.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Io||e instanceof ko||e instanceof Oo)&&e.destroy()}};var Do=function(t,e,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var r=0,i=t;r<i.length;r+=1){var o=i[r];this.programConfigurations[o.id]=new Ro(o,e,n)}this.needsUpload=!1,this._featureMap=new mo,this._bufferOffset=0};function No(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Fo(t,e,n){var r={color:{source:ki,composite:Yi},number:{source:Gi,composite:ki}},i=function(t){return{"line-pattern":{source:Oi,composite:Oi},"fill-pattern":{source:Oi,composite:Oi},"fill-extrusion-pattern":{source:Oi,composite:Oi}}[t]}(t);return i&&i[n]||r[e][n]}Do.prototype.populatePaintArrays=function(t,e,n,r,i,o){for(var a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,r,i,o);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Do.prototype.updatePaintArrays=function(t,e,n,r){for(var i=0,o=n;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,e,a,r)||this.needsUpload}},Do.prototype.get=function(t){return this.programConfigurations[t]},Do.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},Do.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},zr("ConstantBinder",Po),zr("CrossFadedConstantBinder",Lo),zr("SourceExpressionBinder",Io),zr("CrossFadedCompositeBinder",Oo),zr("CompositeExpressionBinder",ko),zr("ProgramConfiguration",Ro,{omit:["_buffers"]}),zr("ProgramConfigurationSet",Do);var zo=Math.pow(2,14)-1,Bo=-zo-1;function jo(t){for(var e=8192/t.extent,n=t.loadGeometry(),r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.length;o++){var a=i[o],s=Math.round(a.x*e),u=Math.round(a.y*e);a.x=c(s,Bo,zo),a.y=c(u,Bo,zo),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&S("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function Uo(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?jo(t):[]}}function Zo(t,e,n,r,i){t.emplaceBack(2*e+(r+1)/2,2*n+(i+1)/2)}var Vo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ai,this.indexArray=new Ui,this.segments=new so,this.programConfigurations=new Do(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Go(t,e){for(var n=0;n<t.length;n++)if($o(e,t[n]))return!0;for(var r=0;r<e.length;r++)if($o(t,e[r]))return!0;return!!Xo(t,e)}function Ho(t,e,n){return!!$o(t,e)||!!Ko(e,t,n)}function Wo(t,e){if(1===t.length)return Jo(e,t[0]);for(var n=0;n<e.length;n++)for(var r=e[n],i=0;i<r.length;i++)if($o(t,r[i]))return!0;for(var o=0;o<t.length;o++)if(Jo(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(Xo(t,e[a]))return!0;return!1}function qo(t,e,n){if(t.length>1){if(Xo(t,e))return!0;for(var r=0;r<e.length;r++)if(Ko(e[r],t,n))return!0}for(var i=0;i<t.length;i++)if(Ko(t[i],e,n))return!0;return!1}function Xo(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var r=t[n],i=t[n+1],o=0;o<e.length-1;o++)if(Yo(r,i,e[o],e[o+1]))return!0;return!1}function Yo(t,e,n,r){return E(t,n,r)!==E(e,n,r)&&E(t,e,n)!==E(t,e,r)}function Ko(t,e,n){var r=n*n;if(1===e.length)return t.distSqr(e[0])<r;for(var i=1;i<e.length;i++)if(Qo(t,e[i-1],e[i])<r)return!0;return!1}function Qo(t,e,n){var r=e.distSqr(n);if(0===r)return t.distSqr(e);var i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return t.distSqr(i<0?e:i>1?n:n.sub(e)._mult(i)._add(e))}function Jo(t,e){for(var n,r,i,o=!1,a=0;a<t.length;a++)for(var s=0,u=(n=t[a]).length-1;s<n.length;u=s++)(r=n[s]).y>e.y!=(i=n[u]).y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(o=!o);return o}function $o(t,e){for(var n=!1,r=0,i=t.length-1;r<t.length;i=r++){var o=t[r],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function ta(t,e,n){var r=n[0],i=n[2];if(t.x<r.x&&e.x<r.x||t.x>i.x&&e.x>i.x||t.y<r.y&&e.y<r.y||t.y>i.y&&e.y>i.y)return!1;var o=E(t,e,n[0]);return o!==E(t,e,n[1])||o!==E(t,e,n[2])||o!==E(t,e,n[3])}function ea(t,e,n){var r=e.paint.get(t).value;return"constant"===r.kind?r.value:n.programConfigurations.get(e.id).getMaxValue(t)}function na(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ra(t,e,n,r,o){if(!e[0]&&!e[1])return t;var a=i.convert(e)._mult(o);"viewport"===n&&a._rotate(-r);for(var s=[],u=0;u<t.length;u++)s.push(t[u].sub(a));return s}Vo.prototype.populate=function(t,e,n){var r=this.layers[0],i=[],o=null;"circle"===r.type&&(o=r.layout.get("circle-sort-key"));for(var a=0,s=t;a<s.length;a+=1){var u=s[a],l=u.feature,c=u.id,h=u.index,p=u.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,d=Uo(l,f);if(this.layers[0]._featureFilter.filter(new si(this.zoom),d,n)){var m=o?o.evaluate(d,{},n):void 0,g={id:c,properties:l.properties,type:l.type,sourceLayerIndex:p,index:h,geometry:f?d.geometry:jo(l),patterns:{},sortKey:m};i.push(g)}}o&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var y=0,v=i;y<v.length;y+=1){var _=v[y],x=_.geometry,b=_.index,w=_.sourceLayerIndex,S=t[b].feature;this.addFeature(_,x,b,n),e.featureIndex.insert(S,x,b,w,this.index)}},Vo.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Vo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Vo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Vo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ao),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Vo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Vo.prototype.addFeature=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1)for(var a=0,s=o[i];a<s.length;a+=1){var u=s[a],l=u.x,c=u.y;if(!(l<0||l>=8192||c<0||c>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),p=h.vertexLength;Zo(this.layoutVertexArray,l,c,-1,-1),Zo(this.layoutVertexArray,l,c,1,-1),Zo(this.layoutVertexArray,l,c,1,1),Zo(this.layoutVertexArray,l,c,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},r)},zr("CircleBucket",Vo,{omit:["layers"]});var ia=new bi({"circle-sort-key":new yi(Pt.layout_circle["circle-sort-key"])}),oa={paint:new bi({"circle-radius":new yi(Pt.paint_circle["circle-radius"]),"circle-color":new yi(Pt.paint_circle["circle-color"]),"circle-blur":new yi(Pt.paint_circle["circle-blur"]),"circle-opacity":new yi(Pt.paint_circle["circle-opacity"]),"circle-translate":new gi(Pt.paint_circle["circle-translate"]),"circle-translate-anchor":new gi(Pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gi(Pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gi(Pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yi(Pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yi(Pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yi(Pt.paint_circle["circle-stroke-opacity"])}),layout:ia},aa="undefined"!=typeof Float32Array?Float32Array:Array;function sa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ua(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],g=e[13],y=e[14],v=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*h+w*m,t[1]=_*i+x*u+b*p+w*g,t[2]=_*o+x*l+b*f+w*y,t[3]=_*a+x*c+b*d+w*v,t[4]=(_=n[4])*r+(x=n[5])*s+(b=n[6])*h+(w=n[7])*m,t[5]=_*i+x*u+b*p+w*g,t[6]=_*o+x*l+b*f+w*y,t[7]=_*a+x*c+b*d+w*v,t[8]=(_=n[8])*r+(x=n[9])*s+(b=n[10])*h+(w=n[11])*m,t[9]=_*i+x*u+b*p+w*g,t[10]=_*o+x*l+b*f+w*y,t[11]=_*a+x*c+b*d+w*v,t[12]=(_=n[12])*r+(x=n[13])*s+(b=n[14])*h+(w=n[15])*m,t[13]=_*i+x*u+b*p+w*g,t[14]=_*o+x*l+b*f+w*y,t[15]=_*a+x*c+b*d+w*v,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,n=arguments.length;n--;)e+=t[n]*t[n];return Math.sqrt(e)});var la,ca=ua;function ha(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}la=new aa(3),aa!=Float32Array&&(la[0]=0,la[1]=0,la[2]=0),function(){var t=new aa(4);aa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var pa=(function(){var t=new aa(2);aa!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(e){t.call(this,e,oa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Vo(t)},e.prototype.queryRadius=function(t){var e=t;return ea("circle-radius",this,e)+ea("circle-stroke-width",this,e)+na(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a,s){for(var u=ra(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),l=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),c="map"===this.paint.get("circle-pitch-alignment"),h=c?u:function(t,e){return t.map((function(t){return fa(t,e)}))}(u,s),p=c?l*a:l,f=0,d=r;f<d.length;f+=1)for(var m=0,g=d[f];m<g.length;m+=1){var y=g[m],v=c?y:fa(y,s),_=p,x=ha([],[y.x,y.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=x[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=o.cameraToCenterDistance/x[3]),Ho(h,v,_))return!0}return!1},e}(wi));function fa(t,e){var n=ha([],[t.x,t.y,0,1],e);return new i(n[0]/n[3],n[1]/n[3])}var da=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Vo);function ma(t,e,n,r){var i=e.width,o=e.height;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return t.width=i,t.height=o,t.data=r,t}function ga(t,e,n){var r=e.width,i=e.height;if(r!==t.width||i!==t.height){var o=ma({},{width:r,height:i},n);ya(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,i)},n),t.width=r,t.height=i,t.data=o.data}}function ya(t,e,n,r,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<i.height;u++)for(var l=((n.y+u)*t.width+n.x)*o,c=((r.y+u)*e.width+r.x)*o,h=0;h<i.width*o;h++)s[c+h]=a[l+h];return e}zr("HeatmapBucket",da,{omit:["layers"]});var va=function(t,e){ma(this,t,1,e)};va.prototype.resize=function(t){ga(this,t,1)},va.prototype.clone=function(){return new va({width:this.width,height:this.height},new Uint8Array(this.data))},va.copy=function(t,e,n,r,i){ya(t,e,n,r,i,1)};var _a=function(t,e){ma(this,t,4,e)};_a.prototype.resize=function(t){ga(this,t,4)},_a.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},_a.prototype.clone=function(){return new _a({width:this.width,height:this.height},new Uint8Array(this.data))},_a.copy=function(t,e,n,r,i){ya(t,e,n,r,i,4)},zr("AlphaImage",va),zr("RGBAImage",_a);var xa={paint:new bi({"heatmap-radius":new yi(Pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yi(Pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gi(Pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xi(Pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gi(Pt.paint_heatmap["heatmap-opacity"])})};function ba(t){var e={},n=t.resolution||256,r=t.clips?t.clips.length:1,i=t.image||new _a({width:n,height:r}),o=function(n,r,o){e[t.evaluationKey]=o;var a=t.expression.evaluate(e);i.data[n+r+0]=Math.floor(255*a.r/a.a),i.data[n+r+1]=Math.floor(255*a.g/a.a),i.data[n+r+2]=Math.floor(255*a.b/a.a),i.data[n+r+3]=Math.floor(255*a.a)};if(t.clips)for(var a=0,s=0;a<r;++a,s+=4*n)for(var u=0,l=0;u<n;u++,l+=4){var c=u/(n-1),h=t.clips[a];o(s,l,h.start*(1-c)+h.end*c)}else for(var p=0,f=0;p<n;p++,f+=4)o(0,f,p/(n-1));return i}var wa=function(t){function e(e){t.call(this,e,xa),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new da(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=ba({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(wi),Sa={paint:new bi({"hillshade-illumination-direction":new gi(Pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gi(Pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gi(Pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gi(Pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gi(Pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gi(Pt.paint_hillshade["hillshade-accent-color"])})},Ea=function(t){function e(e){t.call(this,e,Sa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(wi),Ca=Mi([{name:"a_pos",components:2,type:"Int16"}],4).members,Ma=Aa,Ta=Aa;function Aa(t,e,n){n=n||2;var r,i,o,a,s,u,l,c=e&&e.length,h=c?e[0]*n:t.length,p=Pa(t,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Pa(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(ja(a));for(s.sort(Na),i=0;i<s.length;i++)Fa(s[i],n),n=La(n,n.next);return n}(t,e,p,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var d=n;d<h;d+=n)(s=t[d])<r&&(r=s),(u=t[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-r,a-i))?1/l:0}return Ia(p,f,n,r,i,l),f}function Pa(t,e,n,r,i){var o,a;if(i===$a(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Ka(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Ka(o,t[o],t[o+1],a);return a&&Ga(a,a.next)&&(Qa(a),a=a.next),a}function La(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Ga(r,r.next)&&0!==Va(r.prev,r,r.next))r=r.next;else{if(Qa(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Ia(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=Ba(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,r,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Oa(t,r,i,o):ka(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),Qa(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?Ia(t=Ra(La(t),e,n),e,n,r,i,o,2):2===a&&Da(t,e,n,r,i,o):Ia(La(t),e,n,r,i,o,1);break}}}function ka(t){var e=t.prev,n=t,r=t.next;if(Va(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Ua(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Va(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Oa(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Va(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,l=Ba(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),c=Ba(s,u,e,n,r),h=t.prevZ,p=t.nextZ;h&&h.z>=l&&p&&p.z<=c;){if(h!==t.prev&&h!==t.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Va(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Va(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=l;){if(h!==t.prev&&h!==t.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Va(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Va(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Ra(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Ga(i,o)&&Ha(i,r,r.next,o)&&Xa(i,o)&&Xa(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Qa(r),Qa(r.next),r=t=o),r=r.next}while(r!==t);return La(r)}function Da(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Za(a,s)){var u=Ya(a,s);return a=La(a,a.next),u=La(u,u.next),Ia(a,e,n,r,i,o),void Ia(u,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function Na(t,e){return t.x-e.x}function Fa(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,l=n,c=n.x,h=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&Ua(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),Xa(r,t)&&(u<p||u===p&&(r.x>n.x||r.x===n.x&&za(n,r)))&&(n=r,p=u)),r=r.next}while(r!==l);return n}(t,e)){var n=Ya(e,t);La(e,e.next),La(n,n.next)}}function za(t,e){return Va(t.prev,t,e.prev)<0&&Va(e.next,t,t.next)<0}function Ba(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ja(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Ua(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Za(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Ha(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Xa(t,e)&&Xa(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Va(t.prev,t,e.prev)||Va(t,e.prev,e))||Ga(t,e)&&Va(t.prev,t,t.next)>0&&Va(e.prev,e,e.next)>0)}function Va(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ga(t,e){return t.x===e.x&&t.y===e.y}function Ha(t,e,n,r){var i=qa(Va(t,e,n)),o=qa(Va(t,e,r)),a=qa(Va(n,r,t)),s=qa(Va(n,r,e));return i!==o&&a!==s||!(0!==i||!Wa(t,n,e))||!(0!==o||!Wa(t,r,e))||!(0!==a||!Wa(n,t,r))||!(0!==s||!Wa(n,e,r))}function Wa(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function qa(t){return t>0?1:t<0?-1:0}function Xa(t,e){return Va(t.prev,t,t.next)<0?Va(t,e,t.next)>=0&&Va(t,t.prev,e)>=0:Va(t,e,t.prev)<0||Va(t,t.next,e)<0}function Ya(t,e){var n=new Ja(t.i,t.x,t.y),r=new Ja(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ka(t,e,n,r){var i=new Ja(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Qa(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ja(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $a(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function ts(t,e,n,r,i){!function t(e,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1);t(e,n,Math.max(r,Math.floor(n-s*l/a+c)),Math.min(i,Math.floor(n+(a-s)*l/a+c)),o)}var h=e[n],p=r,f=i;for(es(e,r,n),o(e[i],h)>0&&es(e,r,i);p<f;){for(es(e,p,f),p++,f--;o(e[p],h)<0;)p++;for(;o(e[f],h)>0;)f--}0===o(e[r],h)?es(e,r,f):es(e,++f,i),f<=n&&(r=f+1),n<=f&&(i=f-1)}}(t,e,n||0,r||t.length-1,i||ns)}function es(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function ns(t,e){return t<e?-1:t>e?1:0}function rs(t,e){var n=t.length;if(n<=1)return[t];for(var r,i,o=[],a=0;a<n;a++){var s=C(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(r&&o.push(r),r=[t[a]]):r.push(t[a]))}if(r&&o.push(r),e>1)for(var u=0;u<o.length;u++)o[u].length<=e||(ts(o[u],e,1,o[u].length-1,is),o[u]=o[u].slice(0,e));return o}function is(t,e){return e.area-t.area}function os(t,e,n){for(var r=n.patternDependencies,i=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,r[u.to]=!0,r[u.from]=!0)}return i}function as(t,e,n,r,i){for(var o=i.patternDependencies,a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:r-1},n,{},i.availableImages),h=l.evaluate({zoom:r},n,{},i.availableImages),p=l.evaluate({zoom:r+1},n,{},i.availableImages);h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,o[c=c&&c.name?c.name:c]=!0,o[h]=!0,o[p]=!0,n.patterns[u.id]={min:c,mid:h,max:p}}}return n}Aa.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs($a(t,0,i?e[0]*n:t.length,n));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs($a(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n));var u=0;for(a=0;a<r.length;a+=3){var l=r[a]*n,c=r[a+1]*n,h=r[a+2]*n;u+=Math.abs((t[l]-t[h])*(t[c+1]-t[l+1])-(t[l]-t[c])*(t[h+1]-t[l+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},Aa.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&n.holes.push(r+=t[i-1].length)}return n},Ma.default=Ta;var ss=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ai,this.indexArray=new Ui,this.indexArray2=new qi,this.programConfigurations=new Do(t.layers,t.zoom),this.segments=new so,this.segments2=new so,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};ss.prototype.populate=function(t,e,n){this.hasPattern=os("fill",this.layers,e);for(var r=this.layers[0].layout.get("fill-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.id,c=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,f=Uo(u,p);if(this.layers[0]._featureFilter.filter(new si(this.zoom),f,n)){var d=r?r.evaluate(f,{},n,e.availableImages):void 0,m={id:l,properties:u.properties,type:u.type,sourceLayerIndex:h,index:c,geometry:p?f.geometry:jo(u),patterns:{},sortKey:d};i.push(m)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,y=i;g<y.length;g+=1){var v=y[g],_=v.geometry,x=v.index,b=v.sourceLayerIndex;if(this.hasPattern){var w=as("fill",this.layers,v,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(v,_,x,n,{});e.featureIndex.insert(t[x].feature,_,x,b,this.index)}},ss.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},ss.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},ss.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ca),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ss.prototype.addFeature=function(t,e,n,r,i){for(var o=0,a=rs(e,500);o<a.length;o+=1){for(var s=a[o],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),p=h.vertexLength,f=[],d=[],m=0,g=s;m<g.length;m+=1){var y=g[m];if(0!==y.length){y!==s[0]&&d.push(f.length/2);var v=this.segments2.prepareSegment(y.length,this.layoutVertexArray,this.indexArray2),_=v.vertexLength;this.layoutVertexArray.emplaceBack(y[0].x,y[0].y),this.indexArray2.emplaceBack(_+y.length-1,_),f.push(y[0].x),f.push(y[0].y);for(var x=1;x<y.length;x++)this.layoutVertexArray.emplaceBack(y[x].x,y[x].y),this.indexArray2.emplaceBack(_+x-1,_+x),f.push(y[x].x),f.push(y[x].y);v.vertexLength+=y.length,v.primitiveLength+=y.length}}for(var b=Ma(f,d),w=0;w<b.length;w+=3)this.indexArray.emplaceBack(p+b[w],p+b[w+1],p+b[w+2]);h.vertexLength+=u,h.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},zr("FillBucket",ss,{omit:["layers","patternFeatures"]});var us=new bi({"fill-sort-key":new yi(Pt.layout_fill["fill-sort-key"])}),ls={paint:new bi({"fill-antialias":new gi(Pt.paint_fill["fill-antialias"]),"fill-opacity":new yi(Pt.paint_fill["fill-opacity"]),"fill-color":new yi(Pt.paint_fill["fill-color"]),"fill-outline-color":new yi(Pt.paint_fill["fill-outline-color"]),"fill-translate":new gi(Pt.paint_fill["fill-translate"]),"fill-translate-anchor":new gi(Pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new vi(Pt.paint_fill["fill-pattern"])}),layout:us},cs=function(t){function e(e){t.call(this,e,ls)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new ss(t)},e.prototype.queryRadius=function(){return na(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a){return Wo(ra(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),r)},e.prototype.isTileClipped=function(){return!0},e}(wi),hs=Mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,ps=fs;function fs(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(ds,this,e)}function ds(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function ms(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)r+=((n=t[a]).x-(e=t[i]).x)*(e.y+n.y);return r}fs.types=["Unknown","Point","LineString","Polygon"],fs.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,o=0,a=0,s=0,u=[];t.pos<n;){if(o<=0){var l=t.readVarint();r=7&l,o=l>>3}if(o--,1===r||2===r)a+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&u.push(e),e=[]),e.push(new i(a,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&u.push(e),u},fs.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(r<=0){var c=t.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},fs.prototype.toGeoJSON=function(t,e,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=fs.types[this.type];function c(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];c(u=h);break;case 2:for(r=0;r<u.length;r++)c(u[r]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=ms(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)c(u[r][i])}1===u.length?u=u[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p};var gs=ys;function ys(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(vs,this,e),this.length=this._features.length}function vs(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}function _s(t,e,n){if(3===t){var r=new gs(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}ys.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ps(this._pbf,e,this.extent,this._keys,this._values)};var xs={VectorTile:function(t,e){this.layers=t.readFields(_s,{},e)},VectorTileFeature:ps,VectorTileLayer:gs},bs=xs.VectorTileFeature.types,ws=Math.pow(2,13);function Ss(t,e,n,r,i,o,a,s){t.emplaceBack(e,n,2*Math.floor(r*ws)+a,i*ws*2,o*ws*2,Math.round(s))}var Es=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Li,this.indexArray=new Ui,this.programConfigurations=new Do(t.layers,t.zoom),this.segments=new so,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Cs(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}Es.prototype.populate=function(t,e,n){this.features=[],this.hasPattern=os("fill-extrusion",this.layers,e);for(var r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.feature,s=o.id,u=o.index,l=o.sourceLayerIndex,c=this.layers[0]._featureFilter.needGeometry,h=Uo(a,c);if(this.layers[0]._featureFilter.filter(new si(this.zoom),h,n)){var p={id:s,sourceLayerIndex:l,index:u,geometry:c?h.geometry:jo(a),properties:a.properties,type:a.type,patterns:{}};this.hasPattern?this.features.push(as("fill-extrusion",this.layers,p,this.zoom,e)):this.addFeature(p,p.geometry,u,n,{}),e.featureIndex.insert(a,p.geometry,u,l,this.index,!0)}}},Es.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.features;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},Es.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Es.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Es.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Es.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Es.prototype.addFeature=function(t,e,n,r,i){for(var o=0,a=rs(e,500);o<a.length;o+=1){for(var s=a[o],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,f=s;p<f.length;p+=1){var d=f[p];if(0!==d.length&&!((k=d).every((function(t){return t.x<0}))||k.every((function(t){return t.x>8192}))||k.every((function(t){return t.y<0}))||k.every((function(t){return t.y>8192}))))for(var m=0,g=0;g<d.length;g++){var y=d[g];if(g>=1){var v=d[g-1];if(!Cs(y,v)){h.vertexLength+4>so.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=y.sub(v)._perp()._unit(),x=v.dist(y);m+x>32768&&(m=0),Ss(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,m),Ss(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,m),Ss(this.layoutVertexArray,v.x,v.y,_.x,_.y,0,0,m+=x),Ss(this.layoutVertexArray,v.x,v.y,_.x,_.y,0,1,m);var b=h.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+u>so.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray)),"Polygon"===bs[t.type]){for(var w=[],S=[],E=h.vertexLength,C=0,M=s;C<M.length;C+=1){var T=M[C];if(0!==T.length){T!==s[0]&&S.push(w.length/2);for(var A=0;A<T.length;A++){var P=T[A];Ss(this.layoutVertexArray,P.x,P.y,0,0,1,1,0),w.push(P.x),w.push(P.y)}}}for(var L=Ma(w,S),I=0;I<L.length;I+=3)this.indexArray.emplaceBack(E+L[I],E+L[I+2],E+L[I+1]);h.primitiveLength+=L.length/3,h.vertexLength+=u}}var k;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},zr("FillExtrusionBucket",Es,{omit:["layers","features"]});var Ms={paint:new bi({"fill-extrusion-opacity":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yi(Pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vi(Pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yi(Pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yi(Pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ts=function(t){function e(e){t.call(this,e,Ms)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Es(t)},e.prototype.queryRadius=function(){return na(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,n,r,o,a,s,u){var l=ra(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,n),h=this.paint.get("fill-extrusion-base").evaluate(e,n),p=function(t,e,n,r){for(var o=[],a=0,s=t;a<s.length;a+=1){var u=s[a],l=[u.x,u.y,0,1];ha(l,l,e),o.push(new i(l[0]/l[3],l[1]/l[3]))}return o}(l,u),f=function(t,e,n,r){for(var o=[],a=[],s=r[8]*e,u=r[9]*e,l=r[10]*e,c=r[11]*e,h=r[8]*n,p=r[9]*n,f=r[10]*n,d=r[11]*n,m=0,g=t;m<g.length;m+=1){for(var y=[],v=[],_=0,x=g[m];_<x.length;_+=1){var b=x[_],w=b.x,S=b.y,E=r[0]*w+r[4]*S+r[12],C=r[1]*w+r[5]*S+r[13],M=r[2]*w+r[6]*S+r[14],T=r[3]*w+r[7]*S+r[15],A=M+l,P=T+c,L=E+h,I=C+p,k=M+f,O=T+d,R=new i((E+s)/P,(C+u)/P);R.z=A/P,y.push(R);var D=new i(L/O,I/O);D.z=k/O,v.push(D)}o.push(y),a.push(v)}return[o,a]}(r,h,c,u);return function(t,e,n){var r=1/0;Wo(n,e)&&(r=Ps(n,e[0]));for(var i=0;i<e.length;i++)for(var o=e[i],a=t[i],s=0;s<o.length-1;s++){var u=o[s],l=[u,o[s+1],a[s+1],a[s],u];Go(n,l)&&(r=Math.min(r,Ps(n,l)))}return r!==1/0&&r}(f[0],f[1],p)},e}(wi);function As(t,e){return t.x*e.x+t.y*e.y}function Ps(t,e){if(1===t.length){for(var n,r=0,i=e[r++];!n||i.equals(n);)if(!(n=e[r++]))return 1/0;for(;r<e.length;r++){var o=e[r],a=t[0],s=n.sub(i),u=o.sub(i),l=a.sub(i),c=As(s,s),h=As(s,u),p=As(u,u),f=As(l,s),d=As(l,u),m=c*p-h*h,g=(p*f-h*d)/m,y=(c*d-h*f)/m,v=i.z*(1-g-y)+n.z*g+o.z*y;if(isFinite(v))return v}return 1/0}for(var _=1/0,x=0,b=e;x<b.length;x+=1)_=Math.min(_,b[x].z);return _}var Ls=Mi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Is=Mi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,ks=xs.VectorTileFeature.types,Os=Math.cos(Math.PI/180*37.5),Rs=Math.pow(2,14)/.5,Ds=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new Ii,this.layoutVertexArray2=new ki,this.indexArray=new Ui,this.programConfigurations=new Do(t.layers,t.zoom),this.segments=new so,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};Ds.prototype.populate=function(t,e,n){this.hasPattern=os("line",this.layers,e);for(var r=this.layers[0].layout.get("line-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.id,c=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,f=Uo(u,p);if(this.layers[0]._featureFilter.filter(new si(this.zoom),f,n)){var d=r?r.evaluate(f,{},n):void 0,m={id:l,properties:u.properties,type:u.type,sourceLayerIndex:h,index:c,geometry:p?f.geometry:jo(u),patterns:{},sortKey:d};i.push(m)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,y=i;g<y.length;g+=1){var v=y[g],_=v.geometry,x=v.index,b=v.sourceLayerIndex;if(this.hasPattern){var w=as("line",this.layers,v,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(v,_,x,n,{});e.featureIndex.insert(t[x].feature,_,x,b,this.index)}},Ds.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Ds.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},Ds.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ds.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ds.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Is)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ls),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ds.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ds.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ds.prototype.addFeature=function(t,e,n,r,i){var o=this.layers[0].layout,a=o.get("line-join").evaluate(t,{}),s=o.get("line-cap"),u=o.get("line-miter-limit"),l=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var c=0,h=e;c<h.length;c+=1)this.addLine(h[c],t,a,s,u,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Ds.prototype.addLine=function(t,e,n,r,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var a=0;a<t.length-1;a++)this.totalDistance+=t[a].dist(t[a+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===ks[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var l=0;l<u-1&&t[l].equals(t[l+1]);)l++;if(!(u<(s?3:2))){"bevel"===n&&(i=1.05);var c,h=this.overscaling<=16?122880/(512*this.overscaling):0,p=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray),f=void 0,d=void 0,m=void 0,g=void 0;this.e1=this.e2=-1,s&&(g=t[l].sub(c=t[u-2])._unit()._perp());for(var y=l;y<u;y++)if(!(d=y===u-1?s?t[l+1]:void 0:t[y+1])||!t[y].equals(d)){g&&(m=g),c&&(f=c),c=t[y],g=d?d.sub(c)._unit()._perp():m;var v=(m=m||g).add(g);0===v.x&&0===v.y||v._unit();var _=m.x*g.x+m.y*g.y,x=v.x*g.x+v.y*g.y,b=0!==x?1/x:1/0,w=2*Math.sqrt(2-2*x),S=x<Os&&f&&d,E=m.x*g.y-m.y*g.x>0;if(S&&y>l){var C=c.dist(f);if(C>2*h){var M=c.sub(c.sub(f)._mult(h/C)._round());this.updateDistance(f,M),this.addCurrentVertex(M,m,0,0,p),f=M}}var T=f&&d,A=T?n:s?"butt":r;if(T&&"round"===A&&(b<o?A="miter":b<=2&&(A="fakeround")),"miter"===A&&b>i&&(A="bevel"),"bevel"===A&&(b>2&&(A="flipbevel"),b<i&&(A="miter")),f&&this.updateDistance(f,c),"miter"===A)v._mult(b),this.addCurrentVertex(c,v,0,0,p);else if("flipbevel"===A){if(b>100)v=g.mult(-1);else{var P=b*m.add(g).mag()/m.sub(g).mag();v._perp()._mult(P*(E?-1:1))}this.addCurrentVertex(c,v,0,0,p),this.addCurrentVertex(c,v.mult(-1),0,0,p)}else if("bevel"===A||"fakeround"===A){var L=-Math.sqrt(b*b-1),I=E?L:0,k=E?0:L;if(f&&this.addCurrentVertex(c,m,I,k,p),"fakeround"===A)for(var O=Math.round(180*w/Math.PI/20),R=1;R<O;R++){var D=R/O;if(.5!==D){var N=D-.5;D+=D*N*(D-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*N*N+(.848013+_*(.215638*_-1.06021)))}var F=g.sub(m)._mult(D)._add(m)._unit()._mult(E?-1:1);this.addHalfVertex(c,F.x,F.y,!1,E,0,p)}d&&this.addCurrentVertex(c,g,-I,-k,p)}else if("butt"===A)this.addCurrentVertex(c,v,0,0,p);else if("square"===A){var z=f?1:-1;this.addCurrentVertex(c,v,z,z,p)}else"round"===A&&(f&&(this.addCurrentVertex(c,m,0,0,p),this.addCurrentVertex(c,m,1,1,p,!0)),d&&(this.addCurrentVertex(c,g,-1,-1,p,!0),this.addCurrentVertex(c,g,0,0,p)));if(S&&y<u-1){var B=c.dist(d);if(B>2*h){var j=c.add(d.sub(c)._mult(h/B)._round());this.updateDistance(c,j),this.addCurrentVertex(j,g,0,0,p),c=j}}}}},Ds.prototype.addCurrentVertex=function(t,e,n,r,i,o){void 0===o&&(o=!1);var a=e.y*r-e.x,s=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,o,!1,n,i),this.addHalfVertex(t,a,s,o,!0,-r,i),this.distance>Rs/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,n,r,i,o))},Ds.prototype.addHalfVertex=function(t,e,n,r,i,o,a){var s=.5*(this.lineClips?this.scaledDistance*(Rs-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(r?1:0),(t.y<<1)+(i?1:0),Math.round(63*e)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),i?this.e2=u:this.e1=u},Ds.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ds.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},zr("LineBucket",Ds,{omit:["layers","patternFeatures"]});var Ns=new bi({"line-cap":new gi(Pt.layout_line["line-cap"]),"line-join":new yi(Pt.layout_line["line-join"]),"line-miter-limit":new gi(Pt.layout_line["line-miter-limit"]),"line-round-limit":new gi(Pt.layout_line["line-round-limit"]),"line-sort-key":new yi(Pt.layout_line["line-sort-key"])}),Fs={paint:new bi({"line-opacity":new yi(Pt.paint_line["line-opacity"]),"line-color":new yi(Pt.paint_line["line-color"]),"line-translate":new gi(Pt.paint_line["line-translate"]),"line-translate-anchor":new gi(Pt.paint_line["line-translate-anchor"]),"line-width":new yi(Pt.paint_line["line-width"]),"line-gap-width":new yi(Pt.paint_line["line-gap-width"]),"line-offset":new yi(Pt.paint_line["line-offset"]),"line-blur":new yi(Pt.paint_line["line-blur"]),"line-dasharray":new _i(Pt.paint_line["line-dasharray"]),"line-pattern":new vi(Pt.paint_line["line-pattern"]),"line-gradient":new xi(Pt.paint_line["line-gradient"])}),layout:Ns},zs=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,n){return n=new si(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),t.prototype.possiblyEvaluate.call(this,e,n)},e.prototype.evaluate=function(e,n,r,i){return n=p({},n,{zoom:Math.floor(n.zoom)}),t.prototype.evaluate.call(this,e,n,r,i)},e}(yi))(Fs.paint.properties["line-width"].specification);zs.useIntegerZoom=!0;var Bs=function(t){function e(e){t.call(this,e,Fs),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ve,this.gradientVersion=(this.gradientVersion+1)%s)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n),this.paint._values["line-floorwidth"]=zs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Ds(t)},e.prototype.queryRadius=function(t){var e=t,n=js(ea("line-width",this,e),ea("line-gap-width",this,e)),r=ea("line-offset",this,e);return n/2+Math.abs(r)+na(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,o,a,s){var u=ra(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),l=s/2*js(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(r=function(t,e){for(var n=[],r=new i(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],u=0;u<a.length;u++){var l=a[u],c=a[u+1],h=0===u?r:l.sub(a[u-1])._unit()._perp(),p=u===a.length-1?r:c.sub(l)._unit()._perp(),f=h._add(p)._unit();f._mult(1/(f.x*p.x+f.y*p.y)),s.push(f._mult(e)._add(l))}n.push(s)}return n}(r,c*s)),function(t,e,n){for(var r=0;r<e.length;r++){var i=e[r];if(t.length>=3)for(var o=0;o<i.length;o++)if($o(t,i[o]))return!0;if(qo(t,i,n))return!0}return!1}(u,r,l)},e.prototype.isTileClipped=function(){return!0},e}(wi);function js(t,e){return e>0?e+2*t:t}var Us=Mi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zs=Mi([{name:"a_projected_pos",components:3,type:"Float32"}],4),Vs=(Mi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Mi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Gs=(Mi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Hs=Mi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ws(t,e,n){return t.sections.forEach((function(t){t.text=function(t,e,n){var r=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),ai.applyArabicShaping&&(t=ai.applyArabicShaping(t)),t}(t.text,e,n)})),t}Mi([{name:"triangle",components:3,type:"Uint16"}]),Mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mi([{type:"Float32",name:"offsetX"}]),Mi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var qs={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Xs=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,p=n?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},Ys=function(t,e,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+f]=255&a,f+=d,a/=256,l-=8);t[n+f-d]|=128*m},Ks=Qs;function Qs(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Qs.Varint=0,Qs.Fixed64=1,Qs.Bytes=2,Qs.Fixed32=5;var Js="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function $s(t){return t.type===Qs.Bytes?t.readVarint()+t.pos:t.pos+1}function tu(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function eu(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function nu(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function ru(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function iu(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function ou(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function au(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function su(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function uu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function lu(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function cu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function hu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function pu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function fu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function du(t,e,n){1===t&&n.readMessage(mu,e)}function mu(t,e,n){if(3===t){var r=n.readMessage(gu,{}),i=r.width,o=r.height,a=r.left,s=r.top,u=r.advance;e.push({id:r.id,bitmap:new va({width:i+6,height:o+6},r.bitmap),metrics:{width:i,height:o,left:a,top:s,advance:u}})}}function gu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function yu(t){for(var e=0,n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];e+=o.w*o.h,n=Math.max(n,o.w)}t.sort((function(t,e){return e.h-t.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,u=0,l=0,c=t;l<c.length;l+=1)for(var h=c[l],p=a.length-1;p>=0;p--){var f=a[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===f.w&&h.h===f.h){var d=a.pop();p<a.length&&(a[p]=d)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(a.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}Qs.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=hu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=fu(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hu(this.buf,this.pos)+4294967296*hu(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=hu(this.buf,this.pos)+4294967296*fu(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Xs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Xs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return tu(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return tu(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Js?function(t,e,n){return Js.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var r="",i=e;i<n;){var o,a,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Qs.Bytes)return t.push(this.readVarint(e));var n=$s(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Qs.Bytes)return t.push(this.readSVarint());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Qs.Bytes)return t.push(this.readBoolean());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Qs.Bytes)return t.push(this.readFloat());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Qs.Bytes)return t.push(this.readDouble());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Qs.Bytes)return t.push(this.readFixed32());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Qs.Bytes)return t.push(this.readSFixed32());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Qs.Bytes)return t.push(this.readFixed64());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Qs.Bytes)return t.push(this.readSFixed64());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Qs.Varint)for(;this.buf[this.pos++]>127;);else if(e===Qs.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Qs.Fixed32)this.pos+=4;else{if(e!==Qs.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),pu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),pu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),pu(this.buf,-1&t,this.pos),pu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),pu(this.buf,-1&t,this.pos),pu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&eu(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Ys(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ys(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&eu(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Qs.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,nu,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,ru,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,au,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,iu,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ou,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,su,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,uu,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,lu,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,cu,e)},writeBytesField:function(t,e){this.writeTag(t,Qs.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Qs.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Qs.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Qs.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Qs.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Qs.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Qs.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Qs.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Qs.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Qs.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var vu=function(t,e){var n=e.pixelRatio,r=e.version,i=e.stretchX,o=e.stretchY,a=e.content;this.paddedRect=t,this.pixelRatio=n,this.stretchX=i,this.stretchY=o,this.content=a,this.version=r},_u={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};_u.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},_u.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},_u.tlbr.get=function(){return this.tl.concat(this.br)},_u.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(vu.prototype,_u);var xu=function(t,e){var n={},r={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,n,i),this.addImages(e,r,i);var o=yu(i),a=new _a({width:o.w||1,height:o.h||1});for(var s in t){var u=t[s],l=n[s].paddedRect;_a.copy(u.data,a,{x:0,y:0},{x:l.x+1,y:l.y+1},u.data)}for(var c in e){var h=e[c],p=r[c].paddedRect,f=p.x+1,d=p.y+1,m=h.data.width,g=h.data.height;_a.copy(h.data,a,{x:0,y:0},{x:f,y:d},h.data),_a.copy(h.data,a,{x:0,y:g-1},{x:f,y:d-1},{width:m,height:1}),_a.copy(h.data,a,{x:0,y:0},{x:f,y:d+g},{width:m,height:1}),_a.copy(h.data,a,{x:m-1,y:0},{x:f-1,y:d},{width:1,height:g}),_a.copy(h.data,a,{x:0,y:0},{x:f+m,y:d},{width:1,height:g})}this.image=a,this.iconPositions=n,this.patternPositions=r};xu.prototype.addImages=function(t,e,n){for(var r in t){var i=t[r],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(o),e[r]=new vu(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}},xu.prototype.patchUpdatedImages=function(t,e){for(var n in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)},xu.prototype.patchUpdatedImage=function(t,e,n){if(t&&e&&t.version!==e.version){t.version=e.version;var r=t.tl;n.update(e.data,void 0,{x:r[0],y:r[1]})}},zr("ImagePosition",vu),zr("ImageAtlas",xu);var bu={horizontal:1,vertical:2,horizontalOnly:3},wu=function(){this.scale=1,this.fontStack="",this.imageName=null};wu.forText=function(t,e){var n=new wu;return n.scale=t||1,n.fontStack=e,n},wu.forImage=function(t){var e=new wu;return e.imageName=t,e};var Su=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Eu(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m){var g,y=Su.fromFeature(t,i);h===bu.vertical&&y.verticalizePunctuation();var v=ai.processBidirectionalText,_=ai.processStyledBidirectionalText;if(v&&1===y.sections.length){g=[];for(var x=0,b=v(y.toString(),Iu(y,l,o,e,r,f,d));x<b.length;x+=1){var w=b[x],S=new Su;S.text=w,S.sections=y.sections;for(var E=0;E<w.length;E++)S.sectionIndex.push(0);g.push(S)}}else if(_){g=[];for(var C=0,M=_(y.text,y.sectionIndex,Iu(y,l,o,e,r,f,d));C<M.length;C+=1){var T=M[C],A=new Su;A.text=T[0],A.sectionIndex=T[1],A.sections=y.sections,g.push(A)}}else g=function(t,e){for(var n=[],r=t.text,i=0,o=0,a=e;o<a.length;o+=1){var s=a[o];n.push(t.substring(i,s)),i=s}return i<r.length&&n.push(t.substring(i,r.length)),n}(y,Iu(y,l,o,e,r,f,d));var P=[],L={positionedLines:P,text:y.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,n,r,i,o,a,s,u,l,c,h){for(var p=0,f=-17,d=0,m=0,g="right"===s?1:"left"===s?0:.5,y=0,v=0,_=i;v<_.length;v+=1){var x=_[v];x.trim();var b=x.getMaxScale(),w=24*(b-1),S={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=S;var E=S.positionedGlyphs,C=0;if(x.length()){for(var M=0;M<x.length();M++){var T=x.getSection(M),A=x.getSectionIndex(M),P=x.getCharCode(M),L=0,I=null,k=null,O=null,R=24,D=!(u===bu.horizontal||!c&&!qr(P)||c&&(Cu[P]||(G=P,Hr.Arabic(G)||Hr["Arabic Supplement"](G)||Hr["Arabic Extended-A"](G)||Hr["Arabic Presentation Forms-A"](G)||Hr["Arabic Presentation Forms-B"](G))));if(T.imageName){var N=r[T.imageName];if(!N)continue;O=T.imageName,t.iconsInText=t.iconsInText||!0,k=N.paddedRect;var F=N.displaySize;T.scale=24*T.scale/h,L=w+(24-F[1]*T.scale),R=(I={width:F[0],height:F[1],left:1,top:-3,advance:D?F[1]:F[0]}).advance;var z=D?F[0]*T.scale-24*b:F[1]*T.scale-24*b;z>0&&z>C&&(C=z)}else{var B=n[T.fontStack],j=B&&B[P];if(j&&j.rect)k=j.rect,I=j.metrics;else{var U=e[T.fontStack],Z=U&&U[P];if(!Z)continue;I=Z.metrics}L=24*(b-T.scale)}D?(t.verticalizable=!0,E.push({glyph:P,imageName:O,x:p,y:f+L,vertical:D,scale:T.scale,fontStack:T.fontStack,sectionIndex:A,metrics:I,rect:k}),p+=R*T.scale+l):(E.push({glyph:P,imageName:O,x:p,y:f+L,vertical:D,scale:T.scale,fontStack:T.fontStack,sectionIndex:A,metrics:I,rect:k}),p+=I.advance*T.scale+l)}0!==E.length&&(d=Math.max(p-l,d),Ou(E,0,E.length-1,g,C)),p=0;var V=o*b+C;S.lineOffset=Math.max(C,w),f+=V,m=Math.max(V,m),++y}else f+=o,++y}var G,H=f- -17,W=ku(a),q=W.horizontalAlign,X=W.verticalAlign;(function(t,e,n,r,i,o,a,s,u){var l,c=(e-n)*i;l=o!==a?-s*r- -17:(-r*u+.5)*a;for(var h=0,p=t;h<p.length;h+=1)for(var f=0,d=p[h].positionedGlyphs;f<d.length;f+=1){var m=d[f];m.x+=c,m.y+=l}})(t.positionedLines,g,q,X,d,m,o,H,i.length),t.top+=-X*H,t.bottom=t.top+H,t.left+=-q*d,t.right=t.left+d}(L,e,n,r,g,a,s,u,h,l,p,m),!function(t){for(var e=0,n=t;e<n.length;e+=1)if(0!==n[e].positionedGlyphs.length)return!1;return!0}(P)&&L}Su.fromFeature=function(t,e){for(var n=new Su,r=0;r<t.sections.length;r++){var i=t.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,e)}return n},Su.prototype.length=function(){return this.text.length},Su.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Su.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Su.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Su.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n+1)||null,i=t.charCodeAt(n-1)||null;e+=r&&Xr(r)&&!qs[t[n+1]]||i&&Xr(i)&&!qs[t[n-1]]||!qs[t[n]]?t[n]:qs[t[n]]}return e}(this.text)},Su.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Cu[this.text.charCodeAt(e)];e++)t++;for(var n=this.text.length,r=this.text.length-1;r>=0&&r>=t&&Cu[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)},Su.prototype.substring=function(t,e){var n=new Su;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n},Su.prototype.toString=function(){return this.text},Su.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,n){return Math.max(e,t.sections[n].scale)}),0)},Su.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(wu.forText(t.scale,t.fontStack||e));for(var n=this.sections.length-1,r=0;r<t.text.length;++r)this.sectionIndex.push(n)},Su.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(wu.forImage(e)),this.sectionIndex.push(this.sections.length-1)):S("Reached maximum number of images 6401")}else S("Can't add FormattedSection with an empty image.")},Su.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Cu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Mu={};function Tu(t,e,n,r,i,o){if(e.imageName){var a=r[e.imageName];return a?a.displaySize[0]*e.scale*24/o+i:0}var s=n[e.fontStack],u=s&&s[t];return u?u.metrics.advance*e.scale+i:0}function Au(t,e,n,r){var i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(n)*n}function Pu(t,e,n){var r=0;return 10===t&&(r-=1e4),n&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Lu(t,e,n,r,i,o){for(var a=null,s=Au(e,n,i,o),u=0,l=r;u<l.length;u+=1){var c=l[u],h=Au(e-c.x,n,i,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function Iu(t,e,n,r,i,o,a){if("point"!==o)return[];if(!t)return[];for(var s,u=[],l=function(t,e,n,r,i,o){for(var a=0,s=0;s<t.length();s++){var u=t.getSection(s);a+=Tu(t.getCharCode(s),u,r,i,e,o)}return a/Math.max(1,Math.ceil(a/n))}(t,e,n,r,i,a),c=t.text.indexOf("​")>=0,h=0,p=0;p<t.length();p++){var f=t.getSection(p),d=t.getCharCode(p);if(Cu[d]||(h+=Tu(d,f,r,i,e,a)),p<t.length()-1){var m=!((s=d)<11904||!(Hr["Bopomofo Extended"](s)||Hr.Bopomofo(s)||Hr["CJK Compatibility Forms"](s)||Hr["CJK Compatibility Ideographs"](s)||Hr["CJK Compatibility"](s)||Hr["CJK Radicals Supplement"](s)||Hr["CJK Strokes"](s)||Hr["CJK Symbols and Punctuation"](s)||Hr["CJK Unified Ideographs Extension A"](s)||Hr["CJK Unified Ideographs"](s)||Hr["Enclosed CJK Letters and Months"](s)||Hr["Halfwidth and Fullwidth Forms"](s)||Hr.Hiragana(s)||Hr["Ideographic Description Characters"](s)||Hr["Kangxi Radicals"](s)||Hr["Katakana Phonetic Extensions"](s)||Hr.Katakana(s)||Hr["Vertical Forms"](s)||Hr["Yi Radicals"](s)||Hr["Yi Syllables"](s)));(Mu[d]||m||f.imageName)&&u.push(Lu(p+1,h,l,u,Pu(d,t.getCharCode(p+1),m&&c),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Lu(t.length(),h,l,u,0,!0))}function ku(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Ou(t,e,n,r,i){if(r||i)for(var o=t[n],a=(t[n].x+o.metrics.advance*o.scale)*r,s=e;s<=n;s++)t[s].x-=a,t[s].y+=i}function Ru(t,e,n,r,i,o){var a,s=t.image;if(s.content){var u=s.content,l=s.pixelRatio||1;a=[u[0]/l,u[1]/l,s.displaySize[0]-u[2]/l,s.displaySize[1]-u[3]/l]}var c,h,p,f,d=e.left*o,m=e.right*o;"width"===n||"both"===n?(f=i[0]+d-r[3],h=i[0]+m+r[1]):h=(f=i[0]+(d+m-s.displaySize[0])/2)+s.displaySize[0];var g=e.top*o,y=e.bottom*o;return"height"===n||"both"===n?(c=i[1]+g-r[0],p=i[1]+y+r[2]):p=(c=i[1]+(g+y-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:h,bottom:p,left:f,collisionPadding:a}}Mu[10]=!0,Mu[32]=!0,Mu[38]=!0,Mu[40]=!0,Mu[41]=!0,Mu[43]=!0,Mu[45]=!0,Mu[47]=!0,Mu[173]=!0,Mu[183]=!0,Mu[8203]=!0,Mu[8208]=!0,Mu[8211]=!0,Mu[8231]=!0;var Du=function(t){function e(e,n,r,i){t.call(this,e,n),this.angle=r,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(i);function Nu(t,e){var n=e.expression;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new si(t+1))};if("source"===n.kind)return{kind:"source"};for(var r=n.zoomStops,i=n.interpolationType,o=0;o<r.length&&r[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<r.length&&r[a]<t+1;)a++;a=Math.min(r.length-1,a);var s=r[o],u=r[a];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:n.evaluate(new si(s)),maxSize:n.evaluate(new si(u)),interpolationType:i}}function Fu(t,e,n){var r=e.uSize,i=n.lowerSize;return"source"===t.kind?i/128:"composite"===t.kind?Ge(i/128,n.upperSize/128,e.uSizeT):r}function zu(t,e){var n=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){var i=t.interpolationType,o=i?c(an.interpolationFactor(i,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?r=Ge(t.minSize,t.maxSize,o):n=o}return{uSizeT:n,uSize:r}}zr("Anchor",Du);var Bu=Object.freeze({__proto__:null,getSizeData:Nu,evaluateSizeForFeature:Fu,evaluateSizeForZoom:zu,SIZE_PACK_FACTOR:128});function ju(t,e,n,r,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-n/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var u=[],l=0;s<n/2;){var c=t[a],h=t[a+1];if(!h)return!1;var p=t[a-1].angleTo(c)-c.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:p}),l+=p;s-u[0].distance>r;)l-=u.shift().angleDelta;if(l>i)return!1;a++,s+=c.dist(h)}return!0}function Uu(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Zu(t,e,n){return t?.6*e*n:0}function Vu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Gu(t,e,n,r,i,o){for(var a=Zu(n,i,o),s=Vu(n,r)*o,u=0,l=Uu(t)/2,c=0;c<t.length-1;c++){var h=t[c],p=t[c+1],f=h.dist(p);if(u+f>l){var d=(l-u)/f,m=Ge(h.x,p.x,d),g=Ge(h.y,p.y,d),y=new Du(m,g,p.angleTo(h),c);return y._round(),!a||ju(t,y,s,a,e)?y:void 0}u+=f}}function Hu(t,e,n,r,i,o,a,s,u){var l=Zu(r,o,a),c=Vu(r,i),h=c*a,p=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,n,r,i,o,a,s,u,l){for(var c=a/2,h=Uu(e),p=0,f=n-r,d=[],m=0;m<e.length-1;m++){for(var g=e[m],y=e[m+1],v=g.dist(y),_=y.angleTo(g);f+r<p+v;){var x=((f+=r)-p)/v,b=Ge(g.x,y.x,x),w=Ge(g.y,y.y,x);if(b>=0&&b<l&&w>=0&&w<l&&f-c>=0&&f+c<=h){var S=new Du(b,w,_,m);S._round(),i&&!ju(e,S,a,i,o)||d.push(S)}}p+=v}return u||d.length||s||(d=t(e,p/2,r,i,o,a,s,!0,l)),d}(t,p?e/2*s%e:(c/2+2*o)*a*s%e,e,l,n,h,p,!1,u)}function Wu(t,e,n,r,o){for(var a=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,c=0;c<u.length-1;c++){var h=u[c],p=u[c+1];h.x<e&&p.x<e||(h.x<e?h=new i(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<e&&(p=new i(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<n&&p.y<n||(h.y<n?h=new i(h.x+(n-h.y)/(p.y-h.y)*(p.x-h.x),n)._round():p.y<n&&(p=new i(h.x+(n-h.y)/(p.y-h.y)*(p.x-h.x),n)._round()),h.x>=r&&p.x>=r||(h.x>=r?h=new i(r,h.y+(r-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=r&&(p=new i(r,h.y+(r-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=o&&p.y>=o||(h.y>=o?h=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round():p.y>=o&&(p=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round()),l&&h.equals(l[l.length-1])||a.push(l=[h]),l.push(p)))))}return a}function qu(t,e,n,r){var o=[],a=t.image,s=a.pixelRatio,u=a.paddedRect.w-2,l=a.paddedRect.h-2,c=t.right-t.left,h=t.bottom-t.top,p=a.stretchX||[[0,u]],f=a.stretchY||[[0,l]],d=function(t,e){return t+e[1]-e[0]},m=p.reduce(d,0),g=f.reduce(d,0),y=u-m,v=l-g,_=0,x=m,b=0,w=g,S=0,E=y,C=0,M=v;if(a.content&&r){var T=a.content;_=Xu(p,0,T[0]),b=Xu(f,0,T[1]),x=Xu(p,T[0],T[2]),w=Xu(f,T[1],T[3]),S=T[0]-_,C=T[1]-b,E=T[2]-T[0]-x,M=T[3]-T[1]-w}var A=function(r,o,u,l){var p=Ku(r.stretch-_,x,c,t.left),f=Qu(r.fixed-S,E,r.stretch,m),d=Ku(o.stretch-b,w,h,t.top),y=Qu(o.fixed-C,M,o.stretch,g),v=Ku(u.stretch-_,x,c,t.left),T=Qu(u.fixed-S,E,u.stretch,m),A=Ku(l.stretch-b,w,h,t.top),P=Qu(l.fixed-C,M,l.stretch,g),L=new i(p,d),I=new i(v,d),k=new i(v,A),O=new i(p,A),R=new i(f/s,y/s),D=new i(T/s,P/s),N=e*Math.PI/180;if(N){var F=Math.sin(N),z=Math.cos(N),B=[z,-F,F,z];L._matMult(B),I._matMult(B),O._matMult(B),k._matMult(B)}var j=r.stretch+r.fixed,U=o.stretch+o.fixed;return{tl:L,tr:I,bl:O,br:k,tex:{x:a.paddedRect.x+1+j,y:a.paddedRect.y+1+U,w:u.stretch+u.fixed-j,h:l.stretch+l.fixed-U},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:D,minFontScaleX:E/s/c,minFontScaleY:M/s/h,isSDF:n}};if(r&&(a.stretchX||a.stretchY))for(var P=Yu(p,y,m),L=Yu(f,v,g),I=0;I<P.length-1;I++)for(var k=P[I],O=P[I+1],R=0;R<L.length-1;R++)o.push(A(k,L[R],O,L[R+1]));else o.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:l+1}));return o}function Xu(t,e,n){for(var r=0,i=0,o=t;i<o.length;i+=1){var a=o[i];r+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]))}return r}function Yu(t,e,n){for(var r=[{fixed:-1,stretch:0}],i=0,o=t;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],l=r[r.length-1];r.push({fixed:s-l.stretch,stretch:l.stretch}),r.push({fixed:s-l.stretch,stretch:l.stretch+(u-s)})}return r.push({fixed:e+1,stretch:n}),r}function Ku(t,e,n,r){return t/e*n+r}function Qu(t,e,n,r){return t-e*n/r}var Ju=function(t,e,n,r,o,a,s,u,l,c){if(this.boxStartIndex=t.length,l){var h=a.top,p=a.bottom,f=a.collisionPadding;f&&(h-=f[1],p+=f[3]);var d=p-h;d>0&&(d=Math.max(10,d),this.circleDiameter=d)}else{var m=a.top*s-u,g=a.bottom*s+u,y=a.left*s-u,v=a.right*s+u,_=a.collisionPadding;if(_&&(y-=_[0]*s,m-=_[1]*s,v+=_[2]*s,g+=_[3]*s),c){var x=new i(y,m),b=new i(v,m),w=new i(y,g),S=new i(v,g),E=c*Math.PI/180;x._rotate(E),b._rotate(E),w._rotate(E),S._rotate(E),y=Math.min(x.x,b.x,w.x,S.x),v=Math.max(x.x,b.x,w.x,S.x),m=Math.min(x.y,b.y,w.y,S.y),g=Math.max(x.y,b.y,w.y,S.y)}t.emplaceBack(e.x,e.y,y,m,v,g,n,r,o)}this.boxEndIndex=t.length},$u=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=tl),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function tl(t,e){return t<e?-1:t>e?1:0}function el(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var r=1/0,o=1/0,a=-1/0,s=-1/0,u=t[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<r)&&(r=c.x),(!l||c.y<o)&&(o=c.y),(!l||c.x>a)&&(a=c.x),(!l||c.y>s)&&(s=c.y)}var h=Math.min(a-r,s-o),p=h/2,f=new $u([],nl);if(0===h)return new i(r,o);for(var d=r;d<a;d+=h)for(var m=o;m<s;m+=h)f.push(new rl(d+p,m+p,p,t));for(var g=function(t){for(var e=0,n=0,r=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],l=i[s],c=u.x*l.y-l.x*u.y;n+=(u.x+l.x)*c,r+=(u.y+l.y)*c,e+=3*c}return new rl(n/e,r/e,0,t)}(t),y=f.length;f.length;){var v=f.pop();(v.d>g.d||!g.d)&&(g=v,n&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,y)),v.max-g.d<=e||(f.push(new rl(v.p.x-(p=v.h/2),v.p.y-p,p,t)),f.push(new rl(v.p.x+p,v.p.y-p,p,t)),f.push(new rl(v.p.x-p,v.p.y+p,p,t)),f.push(new rl(v.p.x+p,v.p.y+p,p,t)),y+=4)}return n&&(console.log("num probes: "+y),console.log("best distance: "+g.d)),g.p}function nl(t,e){return e.max-t.max}function rl(t,e,n,r){this.p=new i(t,e),this.h=n,this.d=function(t,e){for(var n=!1,r=1/0,i=0;i<e.length;i++)for(var o=e[i],a=0,s=o.length,u=s-1;a<s;u=a++){var l=o[a],c=o[u];l.y>t.y!=c.y>t.y&&t.x<(c.x-l.x)*(t.y-l.y)/(c.y-l.y)+l.x&&(n=!n),r=Math.min(r,Qo(t,l,c))}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}$u.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},$u.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},$u.prototype.peek=function(){return this.data[0]},$u.prototype._up=function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r},$u.prototype._down=function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i};var il=Number.POSITIVE_INFINITY;function ol(t,e){return e[1]!==il?function(t,e,n){var r=0,i=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,i]}(t,e[0],e[1]):function(t,e){var n=0,r=0;e<0&&(e=0);var i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-e;break;case"top":r=e-7}switch(t){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=e;break;case"right":n=-e}return[n,r]}(t,e[0])}function al(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sl(t,e,n,r,o,a,s,u,l,c,h,p,f,d,m){var g=function(t,e,n,r,o,a,s,u){for(var l=r.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=[],h=0,p=e.positionedLines;h<p.length;h+=1)for(var f=p[h],d=0,m=f.positionedGlyphs;d<m.length;d+=1){var g=m[d];if(g.rect){var y=g.rect||{},v=4,_=!0,x=1,b=0,w=(o||u)&&g.vertical,S=g.metrics.advance*g.scale/2;if(u&&e.verticalizable&&(b=f.lineOffset/2-(g.imageName?-(24-g.metrics.width*g.scale)/2:24*(g.scale-1))),g.imageName){var E=s[g.imageName];_=E.sdf,v=1/(x=E.pixelRatio)}var C=o?[g.x+S,g.y]:[0,0],M=o?[0,0]:[g.x+S+n[0],g.y+n[1]-b],T=[0,0];w&&(T=M,M=[0,0]);var A=(g.metrics.left-v)*g.scale-S+M[0],P=(-g.metrics.top-v)*g.scale+M[1],L=A+y.w*g.scale/x,I=P+y.h*g.scale/x,k=new i(A,P),O=new i(L,P),R=new i(A,I),D=new i(L,I);if(w){var N=new i(-S,S- -17),F=-Math.PI/2,z=12-S,B=new i(22-z,-(g.imageName?z:0)),j=new(Function.prototype.bind.apply(i,[null].concat(T)));k._rotateAround(F,N)._add(B)._add(j),O._rotateAround(F,N)._add(B)._add(j),R._rotateAround(F,N)._add(B)._add(j),D._rotateAround(F,N)._add(B)._add(j)}if(l){var U=Math.sin(l),Z=Math.cos(l),V=[Z,-U,U,Z];k._matMult(V),O._matMult(V),R._matMult(V),D._matMult(V)}var G=new i(0,0),H=new i(0,0);c.push({tl:k,tr:O,bl:R,br:D,tex:y,writingMode:e.writingMode,glyphOffset:C,sectionIndex:g.sectionIndex,isSDF:_,pixelOffsetTL:G,pixelOffsetBR:H,minFontScaleX:0,minFontScaleY:0})}}return c}(0,n,u,o,a,s,r,t.allowVerticalPlacement),y=t.textSizeData,v=null;"source"===y.kind?(v=[128*o.layout.get("text-size").evaluate(s,{})])[0]>32640&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===y.kind&&((v=[128*d.compositeTextSizes[0].evaluate(s,{},m),128*d.compositeTextSizes[1].evaluate(s,{},m)])[0]>32640||v[1]>32640)&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,g,v,u,a,s,c,e,l.lineStartIndex,l.lineLength,f,m);for(var _=0,x=h;_<x.length;_+=1)p[x[_]]=t.text.placedSymbolArray.length-1;return 4*g.length}function ul(t){for(var e in t)return t[e];return null}function ll(t,e,n,r){var i=t.compareText;if(e in i){for(var o=i[e],a=o.length-1;a>=0;a--)if(r.dist(o[a])<n)return!0}else i[e]=[];return i[e].push(r),!1}var cl=xs.VectorTileFeature.types,hl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pl(t,e,n,r,i,o,a,s,u,l,c,h,p){var f=s?Math.min(32640,Math.round(s[0])):0,d=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,n,Math.round(32*r),Math.round(32*i),o,a,(f<<1)+(u?1:0),d,16*l,16*c,256*h,256*p)}function fl(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function dl(t){for(var e=0,n=t.sections;e<n.length;e+=1)if(Qr(n[e].text))return!0;return!1}var ml=function(t){this.layoutVertexArray=new Ri,this.indexArray=new Ui,this.programConfigurations=t,this.segments=new so,this.dynamicLayoutVertexArray=new Di,this.opacityVertexArray=new Ni,this.placedSymbolArray=new $i};ml.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},ml.prototype.upload=function(t,e,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Us.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Zs.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,hl,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(t))},ml.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},zr("SymbolBuffers",ml);var gl=function(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new so,this.collisionVertexArray=new ji};gl.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Vs.members,!0)},gl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},zr("CollisionBuffers",gl);var yl=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sa([]),this.placementViewportMatrix=sa([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nu(this.zoom,e["text-size"]),this.iconSizeData=Nu(this.zoom,e["icon-size"]);var n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((function(t){return bu[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};yl.prototype.createArrays=function(){this.text=new ml(new Do(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new ml(new Do(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new no,this.lineVertexArray=new ro,this.symbolInstances=new eo},yl.prototype.calculateGlyphDependencies=function(t,e,n,r,i){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(n||r)&&i){var a=qs[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},yl.prototype.populate=function(t,e,n){var r=this.layers[0],i=r.layout,o=i.get("text-font"),a=i.get("text-field"),s=i.get("icon-image"),u=("constant"!==a.value.kind||a.value.value instanceof re&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),l="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,c=i.get("symbol-sort-key");if(this.features=[],u||l){for(var h=e.iconDependencies,p=e.glyphDependencies,f=e.availableImages,d=new si(this.zoom),m=0,g=t;m<g.length;m+=1){var y=g[m],v=y.feature,_=y.id,x=y.index,b=y.sourceLayerIndex,w=r._featureFilter.needGeometry,S=Uo(v,w);if(r._featureFilter.filter(d,S,n)){w||(S.geometry=jo(v));var E=void 0;if(u){var C=r.getValueAndResolveTokens("text-field",S,n,f),M=re.factory(C);dl(M)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ii()||this.hasRTLText&&ai.isParsed())&&(E=Ws(M,r,S))}var T=void 0;if(l){var A=r.getValueAndResolveTokens("icon-image",S,n,f);T=A instanceof ie?A:ie.fromString(A)}if(E||T){var P=this.sortFeaturesByKey?c.evaluate(S,{},n):void 0;if(this.features.push({id:_,text:E,icon:T,index:x,sourceLayerIndex:b,geometry:S.geometry,properties:v.properties,type:cl[v.type],sortKey:P}),T&&(h[T.name]=!0),E){var L=o.evaluate(S,{},n).join(","),I="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bu.vertical)>=0;for(var k=0,O=E.sections;k<O.length;k+=1){var R=O[k];if(R.image)h[R.image.name]=!0;else{var D=Wr(E.toString()),N=R.fontStack||L,F=p[N]=p[N]||{};this.calculateGlyphDependencies(R.text,F,I,this.allowVerticalPlacement,D)}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},n={},r=[],i=0;function o(e){r.push(t[e]),i++}function a(t,e,i){var o=n[t];return delete n[t],n[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function s(t,n,i){var o=e[n];return delete e[n],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function u(t,e,n){var r=n?e[0][e[0].length-1]:e[0][0];return t+":"+r.x+":"+r.y}for(var l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.text?c.text.toString():null;if(p){var f=u(p,h),d=u(p,h,!0);if(f in n&&d in e&&n[f]!==e[d]){var m=s(f,d,h),g=a(f,d,r[m].geometry);delete e[f],delete n[d],n[u(p,r[g].geometry,!0)]=g,r[m].geometry=null}else f in n?a(f,d,h):d in e?s(f,d,h):(o(l),e[f]=i-1,n[d]=i-1)}else o(l)}return r.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},yl.prototype.update=function(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))},yl.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},yl.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},yl.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},yl.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},yl.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},yl.prototype.addToLineVertexArray=function(t,e){var n=this.lineVertexArray.length;if(void 0!==t.segment){for(var r=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:r},a<e.length-1&&(r+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=o[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},yl.prototype.addSymbols=function(t,e,n,r,i,o,a,s,u,l,c,h){for(var p=t.indexArray,f=t.layoutVertexArray,d=t.segments.prepareSegment(4*e.length,f,p,this.canOverlap?o.sortKey:void 0),m=this.glyphOffsetArray.length,g=d.vertexLength,y=this.allowVerticalPlacement&&a===bu.vertical?Math.PI/2:0,v=o.text&&o.text.sections,_=0;_<e.length;_++){var x=e[_],b=x.tl,w=x.tr,S=x.bl,E=x.br,C=x.tex,M=x.pixelOffsetTL,T=x.pixelOffsetBR,A=x.minFontScaleX,P=x.minFontScaleY,L=x.glyphOffset,I=x.isSDF,k=x.sectionIndex,O=d.vertexLength,R=L[1];pl(f,s.x,s.y,b.x,R+b.y,C.x,C.y,n,I,M.x,M.y,A,P),pl(f,s.x,s.y,w.x,R+w.y,C.x+C.w,C.y,n,I,T.x,M.y,A,P),pl(f,s.x,s.y,S.x,R+S.y,C.x,C.y+C.h,n,I,M.x,T.y,A,P),pl(f,s.x,s.y,E.x,R+E.y,C.x+C.w,C.y+C.h,n,I,T.x,T.y,A,P),fl(t.dynamicLayoutVertexArray,s,y),p.emplaceBack(O,O+1,O+2),p.emplaceBack(O+1,O+2,O+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(L[0]),_!==e.length-1&&k===e[_+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,o,o.index,{},h,v&&v[k])}t.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,g,u,l,s.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],a,0,!1,0,c)},yl.prototype._addCollisionDebugVertex=function(t,e,n,r,i,o){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,r,i,Math.round(o.x),Math.round(o.y))},yl.prototype.addCollisionDebugVertices=function(t,e,n,r,o,a,s){var u=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),l=u.vertexLength,c=o.layoutVertexArray,h=o.collisionVertexArray,p=s.anchorX,f=s.anchorY;this._addCollisionDebugVertex(c,h,a,p,f,new i(t,e)),this._addCollisionDebugVertex(c,h,a,p,f,new i(n,e)),this._addCollisionDebugVertex(c,h,a,p,f,new i(n,r)),this._addCollisionDebugVertex(c,h,a,p,f,new i(t,r)),u.vertexLength+=4;var d=o.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),u.primitiveLength+=4},yl.prototype.addDebugCollisionBoxes=function(t,e,n,r){for(var i=t;i<e;i++){var o=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,r?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,n)}},yl.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gl(zi,Gs.members,qi),this.iconCollisionBox=new gl(zi,Gs.members,qi);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},yl.prototype._deserializeCollisionBoxesForSymbol=function(t,e,n,r,i,o,a,s,u){for(var l={},c=e;c<n;c++){var h=t.get(c);l.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},l.textFeatureIndex=h.featureIndex;break}for(var p=r;p<i;p++){var f=t.get(p);l.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},l.verticalTextFeatureIndex=f.featureIndex;break}for(var d=o;d<a;d++){var m=t.get(d);l.iconBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},l.iconFeatureIndex=m.featureIndex;break}for(var g=s;g<u;g++){var y=t.get(g);l.verticalIconBox={x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2,anchorPointX:y.anchorPointX,anchorPointY:y.anchorPointY},l.verticalIconFeatureIndex=y.featureIndex;break}return l},yl.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}},yl.prototype.hasTextData=function(){return this.text.segments.get().length>0},yl.prototype.hasIconData=function(){return this.icon.segments.get().length>0},yl.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},yl.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},yl.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},yl.prototype.addIndicesForPlacedSymbol=function(t,e){for(var n=t.placedSymbolArray.get(e),r=n.vertexStartIndex+4*n.numGlyphs,i=n.vertexStartIndex;i<r;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)},yl.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),n=Math.cos(t),r=[],i=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);r.push(0|Math.round(e*s.anchorX+n*s.anchorY)),i.push(s.featureIndex)}return o.sort((function(t,e){return r[t]-r[e]||i[e]-i[t]})),o},yl.prototype.addToSortKeyRanges=function(t,e){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},yl.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var n=0,r=this.symbolInstanceIndexes;n<r.length;n+=1){var i=this.symbolInstances.get(r[n]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((function(t,n,r){t>=0&&r.indexOf(t)===n&&e.addIndicesForPlacedSymbol(e.text,t)})),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},zr("SymbolBucket",yl,{omit:["layers","collisionBoxArray","features","compareText"]}),yl.MAX_GLYPHS=65535,yl.addDynamicAttributes=fl;var vl=new bi({"symbol-placement":new gi(Pt.layout_symbol["symbol-placement"]),"symbol-spacing":new gi(Pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gi(Pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yi(Pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gi(Pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gi(Pt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gi(Pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new gi(Pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gi(Pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new yi(Pt.layout_symbol["icon-size"]),"icon-text-fit":new gi(Pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gi(Pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new yi(Pt.layout_symbol["icon-image"]),"icon-rotate":new yi(Pt.layout_symbol["icon-rotate"]),"icon-padding":new gi(Pt.layout_symbol["icon-padding"]),"icon-keep-upright":new gi(Pt.layout_symbol["icon-keep-upright"]),"icon-offset":new yi(Pt.layout_symbol["icon-offset"]),"icon-anchor":new yi(Pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gi(Pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gi(Pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gi(Pt.layout_symbol["text-rotation-alignment"]),"text-field":new yi(Pt.layout_symbol["text-field"]),"text-font":new yi(Pt.layout_symbol["text-font"]),"text-size":new yi(Pt.layout_symbol["text-size"]),"text-max-width":new yi(Pt.layout_symbol["text-max-width"]),"text-line-height":new gi(Pt.layout_symbol["text-line-height"]),"text-letter-spacing":new yi(Pt.layout_symbol["text-letter-spacing"]),"text-justify":new yi(Pt.layout_symbol["text-justify"]),"text-radial-offset":new yi(Pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gi(Pt.layout_symbol["text-variable-anchor"]),"text-anchor":new yi(Pt.layout_symbol["text-anchor"]),"text-max-angle":new gi(Pt.layout_symbol["text-max-angle"]),"text-writing-mode":new gi(Pt.layout_symbol["text-writing-mode"]),"text-rotate":new yi(Pt.layout_symbol["text-rotate"]),"text-padding":new gi(Pt.layout_symbol["text-padding"]),"text-keep-upright":new gi(Pt.layout_symbol["text-keep-upright"]),"text-transform":new yi(Pt.layout_symbol["text-transform"]),"text-offset":new yi(Pt.layout_symbol["text-offset"]),"text-allow-overlap":new gi(Pt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gi(Pt.layout_symbol["text-ignore-placement"]),"text-optional":new gi(Pt.layout_symbol["text-optional"])}),_l={paint:new bi({"icon-opacity":new yi(Pt.paint_symbol["icon-opacity"]),"icon-color":new yi(Pt.paint_symbol["icon-color"]),"icon-halo-color":new yi(Pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new yi(Pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yi(Pt.paint_symbol["icon-halo-blur"]),"icon-translate":new gi(Pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new gi(Pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new yi(Pt.paint_symbol["text-opacity"]),"text-color":new yi(Pt.paint_symbol["text-color"],{runtimeType:Ut,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new yi(Pt.paint_symbol["text-halo-color"]),"text-halo-width":new yi(Pt.paint_symbol["text-halo-width"]),"text-halo-blur":new yi(Pt.paint_symbol["text-halo-blur"]),"text-translate":new gi(Pt.paint_symbol["text-translate"]),"text-translate-anchor":new gi(Pt.paint_symbol["text-translate-anchor"])}),layout:vl},xl=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ft,this.defaultValue=t};xl.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},xl.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},xl.prototype.outputDefined=function(){return!1},xl.prototype.serialize=function(){return null},zr("FormatSectionOverride",xl,{omit:["defaultValue"]});var bl=function(t){function e(e){t.call(this,e,_l)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){if(t.prototype.recalculate.call(this,e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var r=this.layout.get("text-writing-mode");if(r){for(var i=[],o=0,a=r;o<a.length;o+=1){var s=a[o];i.indexOf(s)<0&&i.push(s)}this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,n,r){var i=this.layout.get(t).evaluate(e,{},n,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||Wn(o.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,n){return n in t?String(t[n]):""}))}(e.properties,i)},e.prototype.createBucket=function(t){return new yl(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,n=_l.paint.overridableProperties;t<n.length;t+=1){var r=n[t];if(e.hasPaintOverride(this.layout,r)){var i,o=this.paint.get(r),a=new xl(o),s=new Hn(a,o.property.specification);i="constant"===o.value.kind||"source"===o.value.kind?new Xn("source",s):new Yn("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new di(o.property,i,o.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var n=t.get("text-field"),r=_l.paint.properties[e],i=!1,o=function(t){for(var e=0,n=t;e<n.length;e+=1)if(r.overrides&&r.overrides.hasOverride(n[e]))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof re)o(n.value.value.sections);else if("source"===n.value.kind){var a=function(t){i||(t instanceof le&&se(t.value)===Ht?o(t.value.sections):t instanceof fe?o(t.sections):t.eachChild(a))},s=n.value;s._styleExpression&&a(s._styleExpression.expression)}return i},e}(wi),wl={paint:new bi({"background-color":new gi(Pt.paint_background["background-color"]),"background-pattern":new _i(Pt.paint_background["background-pattern"]),"background-opacity":new gi(Pt.paint_background["background-opacity"])})},Sl=function(t){function e(e){t.call(this,e,wl)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wi),El={paint:new bi({"raster-opacity":new gi(Pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new gi(Pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gi(Pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gi(Pt.paint_raster["raster-brightness-max"]),"raster-saturation":new gi(Pt.paint_raster["raster-saturation"]),"raster-contrast":new gi(Pt.paint_raster["raster-contrast"]),"raster-resampling":new gi(Pt.paint_raster["raster-resampling"]),"raster-fade-duration":new gi(Pt.paint_raster["raster-fade-duration"])})},Cl=function(t){function e(e){t.call(this,e,El)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wi),Ml=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(wi),Tl={circle:pa,heatmap:wa,hillshade:Ea,fill:cs,"fill-extrusion":Ts,line:Bs,symbol:bl,background:Sl,raster:Cl},Al=a.HTMLImageElement,Pl=a.HTMLCanvasElement,Ll=a.HTMLVideoElement,Il=a.ImageData,kl=a.ImageBitmap,Ol=function(t,e,n,r){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,r)};Ol.prototype.update=function(t,e,n){var r=t.width,i=t.height,o=!(this.size&&this.size[0]===r&&this.size[1]===i||n),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[r,i],t instanceof Al||t instanceof Pl||t instanceof Ll||t instanceof Il||kl&&t instanceof kl?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=n||{x:0,y:0},l=u.x,c=u.y;t instanceof Al||t instanceof Pl||t instanceof Ll||t instanceof Il||kl&&t instanceof kl?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,c,r,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Ol.prototype.bind=function(t,e,n){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)},Ol.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Ol.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Rl=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};Rl.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},Rl.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Dl=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},y(["receive","process"],this),this.invoker=new Rl(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=M()?t:a};function Nl(t,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}Dl.prototype.send=function(t,e,n,r,i){var o=this;void 0===i&&(i=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[a]=n);var s=P(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:Zr(e,s)},s),{cancel:function(){n&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:r,sourceMapId:o.mapId})}}},Dl.prototype.receive=function(t){var e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[n];var r=this.cancelCallbacks[n];delete this.cancelCallbacks[n],r&&r()}else M()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)},Dl.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Dl.prototype.processTask=function(t,e){var n=this;if("<response>"===e.type){var r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(Vr(e.error)):r(null,Vr(e.data)))}else{var i=!1,o=P(this.globalScope)?void 0:[],a=e.hasCallback?function(e,r){i=!0,delete n.cancelCallbacks[t],n.target.postMessage({id:t,type:"<response>",sourceMapId:n.mapId,error:e?Zr(e):null,data:Zr(r,o)},o)}:function(t){i=!0},s=null,u=Vr(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){var l=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,l[0],u.source)[l[1]](u,a)}else a(new Error("Could not find function "+e.type));!i&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},Dl.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Fl=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Fl.prototype.setNorthEast=function(t){return this._ne=t instanceof zl?new zl(t.lng,t.lat):zl.convert(t),this},Fl.prototype.setSouthWest=function(t){return this._sw=t instanceof zl?new zl(t.lng,t.lat):zl.convert(t),this},Fl.prototype.extend=function(t){var e,n,r=this._sw,i=this._ne;if(t instanceof zl)e=t,n=t;else{if(!(t instanceof Fl))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Fl.convert(t)):this.extend(zl.convert(t)):this;if(n=t._ne,!(e=t._sw)||!n)return this}return r||i?(r.lng=Math.min(e.lng,r.lng),r.lat=Math.min(e.lat,r.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new zl(e.lng,e.lat),this._ne=new zl(n.lng,n.lat)),this},Fl.prototype.getCenter=function(){return new zl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Fl.prototype.getSouthWest=function(){return this._sw},Fl.prototype.getNorthEast=function(){return this._ne},Fl.prototype.getNorthWest=function(){return new zl(this.getWest(),this.getNorth())},Fl.prototype.getSouthEast=function(){return new zl(this.getEast(),this.getSouth())},Fl.prototype.getWest=function(){return this._sw.lng},Fl.prototype.getSouth=function(){return this._sw.lat},Fl.prototype.getEast=function(){return this._ne.lng},Fl.prototype.getNorth=function(){return this._ne.lat},Fl.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Fl.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Fl.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Fl.prototype.contains=function(t){var e=zl.convert(t),n=e.lng,r=e.lat,i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i},Fl.convert=function(t){return!t||t instanceof Fl?t:new Fl(t)};var zl=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};zl.prototype.wrap=function(){return new zl(h(this.lng,-180,180),this.lat)},zl.prototype.toArray=function(){return[this.lng,this.lat]},zl.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},zl.prototype.distanceTo=function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(i,1))},zl.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new Fl(new zl(this.lng-n,this.lat-e),new zl(this.lng+n,this.lat+e))},zl.convert=function(t){if(t instanceof zl)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new zl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new zl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Bl=2*Math.PI*6371008.8;function jl(t){return Bl*Math.cos(t*Math.PI/180)}function Ul(t){return(180+t)/360}function Zl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Vl(t,e){return t/jl(e)}function Gl(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Hl=function(t,e,n){void 0===n&&(n=0),this.x=+t,this.y=+e,this.z=+n};Hl.fromLngLat=function(t,e){void 0===e&&(e=0);var n=zl.convert(t);return new Hl(Ul(n.lng),Zl(n.lat),Vl(e,n.lat))},Hl.prototype.toLngLat=function(){return new zl(360*this.x-180,Gl(this.y))},Hl.prototype.toAltitude=function(){return this.z*jl(Gl(this.y))},Hl.prototype.meterInMercatorCoordinateUnits=function(){return 1/Bl*(t=Gl(this.y),1/Math.cos(t*Math.PI/180));var t};var Wl=function(t,e,n){this.z=t,this.x=e,this.y=n,this.key=Yl(0,t,t,e,n)};Wl.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Wl.prototype.url=function(t,e){var n,r,i,o,a,s=(r=this.y,i=this.z,o=Nl(256*(n=this.x),256*(r=Math.pow(2,i)-r-1),i),a=Nl(256*(n+1),256*(r+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),u=function(t,e,n){for(var r,i="",o=t;o>0;o--)i+=(e&(r=1<<o-1)?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},Wl.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new i(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},Wl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var ql=function(t,e){this.wrap=t,this.canonical=e,this.key=Yl(t,e.z,e.z,e.x,e.y)},Xl=function(t,e,n,r,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Wl(n,+r,+i),this.key=Yl(e,t,n,r,i)};function Yl(t,e,n,r,i){(t*=2)<0&&(t=-1*t-1);var o=1<<n;return(o*o*t+o*i+r).toString(36)+n.toString(36)+e.toString(36)}Xl.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Xl.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Xl(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xl(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Xl.prototype.calculateScaledKey=function(t,e){var n=this.canonical.z-t;return t>this.canonical.z?Yl(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Yl(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)},Xl.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Xl.prototype.children=function(t){if(this.overscaledZ>=t)return[new Xl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Xl(e,this.wrap,e,n,r),new Xl(e,this.wrap,e,n+1,r),new Xl(e,this.wrap,e,n,r+1),new Xl(e,this.wrap,e,n+1,r+1)]},Xl.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Xl.prototype.wrapped=function(){return new Xl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xl.prototype.unwrapTo=function(t){return new Xl(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Xl.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xl.prototype.toUnwrapped=function(){return new ql(this.wrap,this.canonical)},Xl.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xl.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Hl(t.x-this.wrap,t.y))},zr("CanonicalTileID",Wl),zr("OverscaledTileID",Xl,{omit:["posMatrix"]});var Kl=function(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return S('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var r=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox";for(var i=0;i<r;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(r,i)]=this.data[this._idx(r-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,r)]=this.data[this._idx(i,r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(r,-1)]=this.data[this._idx(r-1,0)],this.data[this._idx(-1,r)]=this.data[this._idx(0,r-1)],this.data[this._idx(r,r)]=this.data[this._idx(r-1,r-1)]};Kl.prototype.get=function(t,e){var n=new Uint8Array(this.data.buffer),r=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[r],n[r+1],n[r+2])},Kl.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Kl.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Kl.prototype._unpackMapbox=function(t,e,n){return(256*t*256+256*e+n)/10-1e4},Kl.prototype._unpackTerrarium=function(t,e,n){return 256*t+e+n/256-32768},Kl.prototype.getPixels=function(){return new _a({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Kl.prototype.backfillBorder=function(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var r=e*this.dim,i=e*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(e){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,u=-n*this.dim,l=o;l<a;l++)for(var c=r;c<i;c++)this.data[this._idx(c,l)]=t.data[this._idx(c+s,l+u)]},zr("DEMData",Kl);var Ql=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}};Ql.prototype.encode=function(t){return this._stringToNumber[t]},Ql.prototype.decode=function(t){return this._numberToString[t]};var Jl=function(t,e,n,r,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=r,this.properties=t.properties,this.id=i},$l={geometry:{configurable:!0}};$l.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},$l.geometry.set=function(t){this._geometry=t},Jl.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Jl.prototype,$l);var tc=function(){this.state={},this.stateChanges={},this.deletedStates={}};tc.prototype.updateState=function(t,e,n){var r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},p(this.stateChanges[t][r],n),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==r&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][r])for(var o in this.deletedStates[t][r]={},this.state[t][r])n[o]||(this.deletedStates[t][r][o]=null);else for(var a in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][a]&&delete this.deletedStates[t][r][a]},tc.prototype.removeFeatureState=function(t,e,n){if(null!==this.deletedStates[t]){var r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(n in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][n]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}},tc.prototype.getState=function(t,e){var n=String(e),r=p({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return{};for(var o in i)delete r[o]}return r},tc.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},tc.prototype.coalesceChanges=function(t,e){var n={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var i={};for(var o in this.stateChanges[r])this.state[r][o]||(this.state[r][o]={}),p(this.state[r][o],this.stateChanges[r][o]),i[o]=this.state[r][o];n[r]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var u in this.state[a])s[u]={},this.state[a][u]={};else for(var l in this.deletedStates[a]){if(null===this.deletedStates[a][l])this.state[a][l]={};else for(var c=0,h=Object.keys(this.deletedStates[a][l]);c<h.length;c+=1)delete this.state[a][l][h[c]];s[l]=this.state[a][l]}n[a]=n[a]||{},p(n[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var f in t)t[f].setFeatureState(n,e)};var ec=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Or(8192,16,0),this.grid3D=new Or(8192,16,0),this.featureIndexArray=new oo,this.promoteId=e};function nc(t,e,n,r,i){return _(t,(function(t,o){var a=e instanceof mi?e.get(o):null;return a&&a.evaluate?a.evaluate(n,r,i):a}))}function rc(t){for(var e=1/0,n=1/0,r=-1/0,i=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}return{minX:e,minY:n,maxX:r,maxY:i}}function ic(t,e){return e-t}ec.prototype.insert=function(t,e,n,r,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);for(var s=o?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var p=l[h];c[0]=Math.min(c[0],p.x),c[1]=Math.min(c[1],p.y),c[2]=Math.max(c[2],p.x),c[3]=Math.max(c[3],p.y)}c[0]<8192&&c[1]<8192&&c[2]>=0&&c[3]>=0&&s.insert(a,c[0],c[1],c[2],c[3])}},ec.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new xs.VectorTile(new Ks(this.rawTileData)).layers,this.sourceLayerCoder=new Ql(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ec.prototype.query=function(t,e,n,r){var o=this;this.loadVTLayers();for(var a=t.params||{},s=8192/t.tileSize/t.scale,u=ar(a.filter),l=t.queryGeometry,c=t.queryPadding*s,h=rc(l),p=this.grid.query(h.minX-c,h.minY-c,h.maxX+c,h.maxY+c),f=rc(t.cameraQueryGeometry),d=this.grid3D.query(f.minX-c,f.minY-c,f.maxX+c,f.maxY+c,(function(e,n,r,o){return function(t,e,n,r,o){for(var a=0,s=t;a<s.length;a+=1){var u=s[a];if(e<=u.x&&n<=u.y&&r>=u.x&&o>=u.y)return!0}var l=[new i(e,n),new i(e,o),new i(r,o),new i(r,n)];if(t.length>2)for(var c=0,h=l;c<h.length;c+=1)if($o(t,h[c]))return!0;for(var p=0;p<t.length-1;p++)if(ta(t[p],t[p+1],l))return!0;return!1}(t.cameraQueryGeometry,e-c,n-c,r+c,o+c)})),m=0,g=d;m<g.length;m+=1)p.push(g[m]);p.sort(ic);for(var y,v={},_=function(i){var c=p[i];if(c!==y){y=c;var h=o.featureIndexArray.get(c),f=null;o.loadMatchingFeature(v,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,u,a.layers,a.availableImages,e,n,r,(function(e,n,r){return f||(f=jo(e)),n.queryIntersectsFeature(l,e,r,f,o.z,t.transform,s,t.pixelPosMatrix)}))}},x=0;x<p.length;x++)_(x);return v},ec.prototype.loadMatchingFeature=function(t,e,n,r,i,o,a,s,u,l,c){var h=this.bucketLayerIDs[e];if(!o||function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(o,h)){var f=this.sourceLayerCoder.decode(n),d=this.vtLayers[f].feature(r);if(i.needGeometry){var m=Uo(d,!0);if(!i.filter(new si(this.tileID.overscaledZ),m,this.tileID.canonical))return}else if(!i.filter(new si(this.tileID.overscaledZ),d))return;for(var g=this.getId(d,f),y=0;y<h.length;y++){var v=h[y];if(!(o&&o.indexOf(v)<0)){var _=s[v];if(_){var x={};void 0!==g&&l&&(x=l.getState(_.sourceLayer||"_geojsonTileLayer",g));var b=p({},u[v]);b.paint=nc(b.paint,_.paint,d,x,a),b.layout=nc(b.layout,_.layout,d,x,a);var w=!c||c(d,_,x);if(w){var S=new Jl(d,this.z,this.x,this.y,g);S.layer=b;var E=t[v];void 0===E&&(E=t[v]=[]),E.push({featureIndex:r,feature:S,intersectionZ:w})}}}}}},ec.prototype.lookupSymbolFeatures=function(t,e,n,r,i,o,a,s){var u={};this.loadVTLayers();for(var l=ar(i),c=0,h=t;c<h.length;c+=1)this.loadMatchingFeature(u,n,r,h[c],l,o,a,s,e);return u},ec.prototype.hasLayer=function(t){for(var e=0,n=this.bucketLayerIDs;e<n.length;e+=1)for(var r=0,i=n[e];r<i.length;r+=1)if(t===i[r])return!0;return!1},ec.prototype.getId=function(t,e){var n=t.id;return this.promoteId&&"boolean"==typeof(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(n=Number(n)),n},zr("FeatureIndex",ec,{omit:["rawTileData","sourceLayerCoder"]});var oc=function(t,e){this.tileID=t,this.uid=d(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};oc.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<z.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},oc.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},oc.prototype.loadVectorData=function(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var r in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var n={};if(!e)return n;for(var r=function(){var t=o[i],r=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==r.length){t.layers=r,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return r.filter((function(e){return e.id===t}))[0]})));for(var a=0,s=r;a<s.length;a+=1)n[s[a].id]=t}},i=0,o=t;i<o.length;i+=1)r();return n}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[r];if(i instanceof yl){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof yl&&a.hasRTLText){this.hasRTLText=!0,ai.isLoading()||ai.isLoaded()||"deferred"!==ii()||oi();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(u))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Qi},oc.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},oc.prototype.getBucket=function(t){return this.buckets[t.id]},oc.prototype.upload=function(t){for(var e in this.buckets){var n=this.buckets[e];n.uploadPending()&&n.upload(t)}var r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ol(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ol(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)},oc.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},oc.prototype.queryRenderedFeatures=function(t,e,n,r,i,o,a,s,u,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:o,tileSize:this.tileSize,pixelPosMatrix:l,transform:s,params:a,queryPadding:this.queryPadding*u},t,e,n):{}},oc.prototype.querySourceFeatures=function(t,e){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var r=n.loadVTLayers(),i=e?e.sourceLayer:"",o=r._geojsonTileLayer||r[i];if(o)for(var a=ar(e&&e.filter),s=this.tileID.canonical,u=s.z,l=s.x,c=s.y,h={z:u,x:l,y:c},p=0;p<o.length;p++){var f=o.feature(p);if(a.needGeometry){var d=Uo(f,!0);if(!a.filter(new si(this.tileID.overscaledZ),d,this.tileID.canonical))continue}else if(!a.filter(new si(this.tileID.overscaledZ),f))continue;var m=n.getId(f,i),g=new Jl(f,u,l,c,m);g.tile=h,t.push(g)}}},oc.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},oc.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},oc.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=T(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),i=!1;if(this.expirationTime>r)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var o=this.expirationTime-e;o?this.expirationTime=r+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},oc.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},oc.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var n=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets)if(e.style.hasLayer(r)){var i=this.buckets[r],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=n[o],s=t[o];if(a&&s&&0!==Object.keys(s).length){i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});var u=e&&e.style&&e.style.getLayer(r);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(i)))}}}},oc.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},oc.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<z.now()},oc.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},oc.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=z.now()+t},oc.prototype.setDependencies=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1)n[i[r]]=!0;this.dependencies[t]=n},oc.prototype.hasDependency=function(t,e){for(var n=0,r=t;n<r.length;n+=1){var i=this.dependencies[r[n]];if(i)for(var o=0,a=e;o<a.length;o+=1)if(i[a[o]])return!0}return!1};var ac=a.performance,sc=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},ac.mark(this._marks.start)};sc.prototype.finish=function(){ac.mark(this._marks.end);var t=ac.getEntriesByName(this._marks.measure);return 0===t.length&&(ac.measure(this._marks.measure,this._marks.start,this._marks.end),t=ac.getEntriesByName(this._marks.measure),ac.clearMarks(this._marks.start),ac.clearMarks(this._marks.end),ac.clearMeasures(this._marks.measure)),t},t.Actor=Dl,t.AlphaImage=va,t.CanonicalTileID=Wl,t.CollisionBoxArray=Qi,t.Color=te,t.DEMData=Kl,t.DataConstantProperty=gi,t.DictionaryCoder=Ql,t.EXTENT=8192,t.ErrorEvent=Tt,t.EvaluationParameters=si,t.Event=Mt,t.Evented=At,t.FeatureIndex=ec,t.FillBucket=ss,t.FillExtrusionBucket=Es,t.ImageAtlas=xu,t.ImagePosition=vu,t.LineBucket=Ds,t.LngLat=zl,t.LngLatBounds=Fl,t.MercatorCoordinate=Hl,t.ONE_EM=24,t.OverscaledTileID=Xl,t.Point=i,t.Point$1=i,t.Properties=bi,t.Protobuf=Ks,t.RGBAImage=_a,t.RequestManager=H,t.RequestPerformance=sc,t.ResourceType=dt,t.SegmentVector=so,t.SourceFeatureState=tc,t.StructArrayLayout1ui2=Xi,t.StructArrayLayout2f1f2i16=Bi,t.StructArrayLayout2i4=Ai,t.StructArrayLayout3ui6=Ui,t.StructArrayLayout4i8=Pi,t.SymbolBucket=yl,t.Texture=Ol,t.Tile=oc,t.Transitionable=ci,t.Uniform1f=bo,t.Uniform1i=xo,t.Uniform2f=wo,t.Uniform3f=So,t.Uniform4f=Eo,t.UniformColor=Co,t.UniformMatrix4f=To,t.UnwrappedTileID=ql,t.ValidationError=Lt,t.WritingMode=bu,t.ZoomHistory=Gr,t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},t.addDynamicAttributes=fl,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var r=t.length,i=new Array(t.length),o=null;t.forEach((function(t,a){e(t,(function(t,e){t&&(o=t),i[a]=e,0==--r&&n(o,i)}))}))},t.bezier=u,t.bindAll=y,t.browser=z,t.cacheEntryPossiblyAdded=function(t){++pt>ut&&(t.getActor().send("enforceCacheSizeLimit",st),pt=0)},t.clamp=c,t.clearTileCache=function(t){var e=a.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=Wu,t.clone=function(t){var e=new aa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=b,t.clone$2=function(t){var e=new aa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=Hs,t.config=B,t.create=function(){var t=new aa(16);return aa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new aa(9);return aa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new aa(4);return aa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=qn,t.createLayout=Mi,t.createStyleLayer=function(t){return"custom"===t.type?new Ml(t):new Tl[t.type](t)},t.cross=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t},t.deepEqual=function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var i in e)if(!t(e[i],n[i]))return!1;return!0}return e===n},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=l,t.emitValidationErrors=kr,t.endsWith=v,t.enforceCacheSizeLimit=function(t){lt(),tt&&tt.then((function(e){e.keys().then((function(n){for(var r=0;r<n.length-t;r++)e.delete(n[r])}))}))},t.evaluateSizeForFeature=Fu,t.evaluateSizeForZoom=zu,t.evaluateVariableOffset=ol,t.evented=ri,t.extend=p,t.featureFilter=ar,t.filterObject=x,t.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=ku,t.getAnchorJustification=al,t.getArrayBuffer=xt,t.getImage=St,t.getJSON=function(t,e){return _t(p(t,{type:"json"}),e)},t.getRTLTextPluginStatus=ii,t.getReferrer=vt,t.getVideo=function(t,e){var n,r,i=a.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var s=a.document.createElement("source");n=t[o],r=void 0,(r=a.document.createElement("a")).href=n,(r.protocol!==a.document.location.protocol||r.host!==a.document.location.host)&&(i.crossOrigin="Anonymous"),s.src=t[o],i.appendChild(s)}return{cancel:function(){}}},t.identity=sa,t.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],g=e[14],y=e[15],v=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,w=r*l-o*s,S=i*l-o*u,E=c*m-h*d,C=c*g-p*d,M=c*y-f*d,T=h*g-p*m,A=h*y-f*m,P=p*y-f*g,L=v*P-_*A+x*T+b*M-w*C+S*E;return L?(t[0]=(s*P-u*A+l*T)*(L=1/L),t[1]=(i*A-r*P-o*T)*L,t[2]=(m*S-g*w+y*b)*L,t[3]=(p*w-h*S-f*b)*L,t[4]=(u*M-a*P-l*C)*L,t[5]=(n*P-i*M+o*C)*L,t[6]=(g*x-d*S-y*_)*L,t[7]=(c*S-p*x+f*_)*L,t[8]=(a*A-s*M+l*E)*L,t[9]=(r*M-n*A-o*E)*L,t[10]=(d*w-m*x+y*v)*L,t[11]=(h*x-c*w-f*v)*L,t[12]=(s*C-a*T-u*E)*L,t[13]=(n*T-r*C+i*E)*L,t[14]=(m*_-d*b-g*v)*L,t[15]=(c*b-h*_+p*v)*L,t):null},t.isChar=Hr,t.isMapboxURL=W,t.keysDifference=function(t,e){var n=[];for(var r in t)r in e||n.push(r);return n},t.makeRequest=_t,t.mapObject=_,t.mercatorXfromLng=Ul,t.mercatorYfromLat=Zl,t.mercatorZfromAltitude=Vl,t.mul=ca,t.multiply=ua,t.mvt=xs,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},t.number=Ge,t.offscreenCanvasSupported=ft,t.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new Ks(t).readFields(du,[])},t.pbf=Ks,t.performSymbolLayout=function(t,e,n,r,i,o,a){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.kind){var c=t.textSizeData,h=c.maxZoom;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new si(c.minZoom),a),u["text-size"].possiblyEvaluate(new si(h),a)]}if("composite"===t.iconSizeData.kind){var p=t.iconSizeData,f=p.maxZoom;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new si(p.minZoom),a),u["icon-size"].possiblyEvaluate(new si(f),a)]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new si(t.zoom+1),a),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new si(t.zoom+1),a),l.textMaxSize=u["text-size"].possiblyEvaluate(new si(18));for(var d=24*s.get("text-line-height"),m="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),g=s.get("text-keep-upright"),y=s.get("text-size"),v=function(){var o=x[_],u=s.get("text-font").evaluate(o,{},a).join(","),c=y.evaluate(o,{},a),h=l.layoutTextSize.evaluate(o,{},a),p=l.layoutIconSize.evaluate(o,{},a),f={horizontal:{},vertical:void 0},v=o.text,b=[0,0];if(v){var w=v.toString(),E=24*s.get("text-letter-spacing").evaluate(o,{},a),C=function(t){for(var e=0,n=t;e<n.length;e+=1)if(r=n[e].charCodeAt(0),Hr.Arabic(r)||Hr["Arabic Supplement"](r)||Hr["Arabic Extended-A"](r)||Hr["Arabic Presentation Forms-A"](r)||Hr["Arabic Presentation Forms-B"](r))return!1;var r;return!0}(w)?E:0,M=s.get("text-anchor").evaluate(o,{},a),T=s.get("text-variable-anchor");if(!T){var A=s.get("text-radial-offset").evaluate(o,{},a);b=A?ol(M,[24*A,il]):s.get("text-offset").evaluate(o,{},a).map((function(t){return 24*t}))}var P=m?"center":s.get("text-justify").evaluate(o,{},a),L=s.get("symbol-placement"),I="point"===L?24*s.get("text-max-width").evaluate(o,{},a):0,k=function(){t.allowVerticalPlacement&&Wr(w)&&(f.vertical=Eu(v,e,n,i,u,I,d,M,"left",C,b,bu.vertical,!0,L,h,c))};if(!m&&T){for(var O="auto"===P?T.map((function(t){return al(t)})):[P],R=!1,D=0;D<O.length;D++){var N=O[D];if(!f.horizontal[N])if(R)f.horizontal[N]=f.horizontal[0];else{var F=Eu(v,e,n,i,u,I,d,"center",N,C,b,bu.horizontal,!1,L,h,c);F&&(f.horizontal[N]=F,R=1===F.positionedLines.length)}}k()}else{"auto"===P&&(P=al(M));var z=Eu(v,e,n,i,u,I,d,M,P,C,b,bu.horizontal,!1,L,h,c);z&&(f.horizontal[P]=z),k(),Wr(w)&&m&&g&&(f.vertical=Eu(v,e,n,i,u,I,d,M,P,C,b,bu.vertical,!1,L,h,c))}}var B=void 0,j=!1;if(o.icon&&o.icon.name){var U=r[o.icon.name];U&&(B=function(t,e,n){var r=ku(n),i=e[0]-t.displaySize[0]*r.horizontalAlign,o=e[1]-t.displaySize[1]*r.verticalAlign;return{image:t,top:o,bottom:o+t.displaySize[1],left:i,right:i+t.displaySize[0]}}(i[o.icon.name],s.get("icon-offset").evaluate(o,{},a),s.get("icon-anchor").evaluate(o,{},a)),j=U.sdf,void 0===t.sdfIcons?t.sdfIcons=U.sdf:t.sdfIcons!==U.sdf&&S("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(U.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var Z=ul(f.horizontal)||f.vertical;t.iconsInText=!!Z&&Z.iconsInText,(Z||B)&&function(t,e,n,r,i,o,a,s,u,l,c){var h=o.textMaxSize.evaluate(e,{});void 0===h&&(h=a);var p,f=t.layers[0].layout,d=f.get("icon-offset").evaluate(e,{},c),m=ul(n.horizontal),g=a/24,y=t.tilePixelRatio*g,v=t.tilePixelRatio*h/24,_=t.tilePixelRatio*s,x=t.tilePixelRatio*f.get("symbol-spacing"),b=f.get("text-padding")*t.tilePixelRatio,w=f.get("icon-padding")*t.tilePixelRatio,E=f.get("text-max-angle")/180*Math.PI,C="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),M="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),T=f.get("symbol-placement"),A=x/2,P=f.get("icon-text-fit");r&&"none"!==P&&(t.allowVerticalPlacement&&n.vertical&&(p=Ru(r,n.vertical,P,f.get("icon-text-fit-padding"),d,g)),m&&(r=Ru(r,m,P,f.get("icon-text-fit-padding"),d,g)));var L=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g,y,v,_,x,b,w,E,C){var M,T,A,P,L,I=t.addToLineVertexArray(e,n),k=0,O=0,R=0,D=0,N=-1,F=-1,z={},B=po(""),j=0,U=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(j=(M=s.layout.get("text-offset").evaluate(x,{},E).map((function(t){return 24*t})))[0],U=M[1]):(j=24*s.layout.get("text-radial-offset").evaluate(x,{},E),U=il),t.allowVerticalPlacement&&r.vertical){var Z=s.layout.get("text-rotate").evaluate(x,{},E)+90;P=new Ju(u,e,l,c,h,r.vertical,p,f,d,Z),a&&(L=new Ju(u,e,l,c,h,a,g,y,d,Z))}if(i){var V=s.layout.get("icon-rotate").evaluate(x,{}),G="none"!==s.layout.get("icon-text-fit"),H=qu(i,V,w,G),W=a?qu(a,V,w,G):void 0;A=new Ju(u,e,l,c,h,i,g,y,!1,V),k=4*H.length;var q=t.iconSizeData,X=null;"source"===q.kind?(X=[128*s.layout.get("icon-size").evaluate(x,{})])[0]>32640&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===q.kind&&((X=[128*b.compositeIconSizes[0].evaluate(x,{},E),128*b.compositeIconSizes[1].evaluate(x,{},E)])[0]>32640||X[1]>32640)&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,H,X,_,v,x,!1,e,I.lineStartIndex,I.lineLength,-1,E),N=t.icon.placedSymbolArray.length-1,W&&(O=4*W.length,t.addSymbols(t.icon,W,X,_,v,x,bu.vertical,e,I.lineStartIndex,I.lineLength,-1,E),F=t.icon.placedSymbolArray.length-1)}for(var Y in r.horizontal){var K=r.horizontal[Y];if(!T){B=po(K.text);var Q=s.layout.get("text-rotate").evaluate(x,{},E);T=new Ju(u,e,l,c,h,K,p,f,d,Q)}var J=1===K.positionedLines.length;if(R+=sl(t,e,K,o,s,d,x,m,I,r.vertical?bu.horizontal:bu.horizontalOnly,J?Object.keys(r.horizontal):[Y],z,N,b,E),J)break}r.vertical&&(D+=sl(t,e,r.vertical,o,s,d,x,m,I,bu.vertical,["vertical"],z,F,b,E));var $=T?T.boxStartIndex:t.collisionBoxArray.length,tt=T?T.boxEndIndex:t.collisionBoxArray.length,et=P?P.boxStartIndex:t.collisionBoxArray.length,nt=P?P.boxEndIndex:t.collisionBoxArray.length,rt=A?A.boxStartIndex:t.collisionBoxArray.length,it=A?A.boxEndIndex:t.collisionBoxArray.length,ot=L?L.boxStartIndex:t.collisionBoxArray.length,at=L?L.boxEndIndex:t.collisionBoxArray.length,st=-1,ut=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=ut(T,st),st=ut(P,st),st=ut(A,st);var lt=(st=ut(L,st))>-1?1:0;lt&&(st*=C/24),t.glyphOffsetArray.length>=yl.MAX_GLYPHS&&S("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,z.right>=0?z.right:-1,z.center>=0?z.center:-1,z.left>=0?z.left:-1,z.vertical||-1,N,F,B,$,tt,et,nt,rt,it,ot,at,l,R,D,k,O,lt,0,p,j,U,st)}(t,h,s,n,r,i,p,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,y,b,C,u,_,w,M,d,e,o,l,c,a)};if("line"===T)for(var I=0,k=Wu(e.geometry,0,0,8192,8192);I<k.length;I+=1)for(var O=k[I],R=0,D=Hu(O,x,E,n.vertical||m,r,24,v,t.overscaling,8192);R<D.length;R+=1){var N=D[R];m&&ll(t,m.text,A,N)||L(O,N)}else if("line-center"===T)for(var F=0,z=e.geometry;F<z.length;F+=1){var B=z[F];if(B.length>1){var j=Gu(B,E,n.vertical||m,r,24,v);j&&L(B,j)}}else if("Polygon"===e.type)for(var U=0,Z=rs(e.geometry,0);U<Z.length;U+=1){var V=Z[U],G=el(V,16);L(V[0],new Du(G.x,G.y,0))}else if("LineString"===e.type)for(var H=0,W=e.geometry;H<W.length;H+=1){var q=W[H];L(q,new Du(q[0].x,q[0].y,0))}else if("Point"===e.type)for(var X=0,Y=e.geometry;X<Y.length;X+=1)for(var K=0,Q=Y[X];K<Q.length;K+=1){var J=Q[K];L([J],new Du(J.x,J.y,0))}}(t,o,f,B,r,l,h,p,b,j,a)},_=0,x=t.features;_<x.length;_+=1)v();o&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+r)*(o=1/(r-i)),t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t},t.pick=function(t,e){for(var n={},r=0;r<e.length;r++){var i=e[r];i in t&&(n[i]=t[i])}return n},t.plugin=ai,t.polygonIntersectsPolygon=Go,t.postMapLoadEvent=at,t.postTurnstileEvent=it,t.potpack=yu,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=zr,t.registerForPluginStateChange=function(t){return t({pluginStatus:$r,pluginURL:ti}),ri.on("pluginStateChange",t),t},t.renderColorRamp=ba,t.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t},t.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=u*i+p*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=p*i-u*r,t},t.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=u*i+p*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=p*i-u*r,t},t.scale=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.scale$2=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},t.setCacheLimits=function(t,e){st=t,ut=e},t.setRTLTextPlugin=function(t,e,n){if(void 0===n&&(n=!1),"deferred"===$r||"loading"===$r||"loaded"===$r)throw new Error("setRTLTextPlugin cannot be called multiple times.");ti=z.resolveURL(t),$r="deferred",Jr=e,ni(),n||oi()},t.sphericalToCartesian=function(t){var e=t[0],n=t[1],r=t[2];return n+=90,n*=Math.PI/180,r*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(r),y:e*Math.sin(n)*Math.sin(r),z:e*Math.cos(r)}},t.sqrLen=function(t){var e=t[0],n=t[1];return e*e+n*n},t.styleSpec=Pt,t.sub=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},t.symbolSize=Bu,t.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},t.transformMat4=ha,t.translate=function(t,e,n){var r,i,o,a,s,u,l,c,h,p,f,d,m=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=r=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=r*m+s*g+h*y+e[12],t[13]=i*m+u*g+p*y+e[13],t[14]=o*m+l*g+f*y+e[14],t[15]=a*m+c*g+d*y+e[15]),t},t.triggerPluginCompletionEvent=ei,t.uniqueId=d,t.validateCustomStyleLayer=function(t){var e=[],n=t.id;return void 0===n&&e.push({message:"layers."+n+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+n+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=Pr,t.validateStyle=Ar,t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.vectorTile=xs,t.version="1.13.2",t.warnOnce=S,t.webpSupported=j,t.window=a,t.wrap=h})),r(0,(function(t){function e(t){var n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var r="[",i=0,o=t;i<o.length;i+=1)r+=e(o[i])+",";return r+"]"}for(var a=Object.keys(t).sort(),s="{",u=0;u<a.length;u++)s+=JSON.stringify(a[u])+":"+e(t[a[u]])+",";return s+"}"}function n(n){for(var r="",i=0,o=t.refProperties;i<o.length;i+=1)r+="/"+e(n[o[i]]);return r}var r=function(t){this.keyCache={},t&&this.replace(t)};r.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},r.prototype.update=function(e,r){for(var i=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var l=0,c=r;l<c.length;l+=1){var h=c[l];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,f=function(t,e){for(var r={},i=0;i<t.length;i++){var o=e&&e[t[i].id]||n(t[i]);e&&(e[t[i].id]=o);var a=r[o];a||(a=r[o]=[]),a.push(t[i])}var s=[];for(var u in r)s.push(r[u]);return s}(t.values(this._layerConfigs),this.keyCache);p<f.length;p+=1){var d=f[p].map((function(t){return i._layers[t.id]})),m=d[0];if("none"!==m.visibility){var g=m.source||"",y=this.familiesBySource[g];y||(y=this.familiesBySource[g]={});var v=m.sourceLayer||"_geojsonTileLayer",_=y[v];_||(_=y[v]=[]),_.push(d)}}};var i=function(e){var n={},r=[];for(var i in e){var o=e[i],a=n[i]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(l),a[s]={rect:l,metrics:u.metrics}}}}var c=t.potpack(r),h=new t.AlphaImage({width:c.w||1,height:c.h||1});for(var p in e){var f=e[p];for(var d in f){var m=f[+d];if(m&&0!==m.bitmap.width&&0!==m.bitmap.height){var g=n[p][d].rect;t.AlphaImage.copy(m.bitmap,h,{x:0,y:0},{x:g.x+1,y:g.y+1},m.bitmap)}}}this.image=h,this.positions=n};t.register("GlyphAtlas",i);var o=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function a(e,n,r){for(var i=new t.EvaluationParameters(n),o=0,a=e;o<a.length;o+=1)a[o].recalculate(i,r)}function s(e,n){var r=t.getArrayBuffer(e.request,(function(e,r,i,o){e?n(e):r&&n(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(r)),rawData:r,cacheControl:i,expires:o})}));return function(){r.cancel(),n()}}o.prototype.parse=function(e,n,r,o,s){var u=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var l=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];var h,p,f,d,m={},g={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:r},y=n.familiesBySource[this.source];for(var v in y){var _=e.layers[v];if(_){1===_.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+v+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var x=l.encode(v),b=[],w=0;w<_.length;w++){var S=_.feature(w),E=c.getId(S,v);b.push({feature:S,id:E,index:w,sourceLayerIndex:x})}for(var C=0,M=y[v];C<M.length;C+=1){var T=M[C],A=T[0];A.minzoom&&this.zoom<Math.floor(A.minzoom)||A.maxzoom&&this.zoom>=A.maxzoom||"none"!==A.visibility&&(a(T,this.zoom,r),(m[A.id]=A.createBucket({index:c.bucketLayerIDs.length,layers:T,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:x,sourceID:this.source})).populate(b,g,this.tileID.canonical),c.bucketLayerIDs.push(T.map((function(t){return t.id}))))}}}var P=t.mapObject(g.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(P).length?o.send("getGlyphs",{uid:this.uid,stacks:P},(function(t,e){h||(h=t,p=e,k.call(u))})):p={};var L=Object.keys(g.iconDependencies);L.length?o.send("getImages",{icons:L,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,f=e,k.call(u))})):f={};var I=Object.keys(g.patternDependencies);function k(){if(h)return s(h);if(p&&f&&d){var e=new i(p),n=new t.ImageAtlas(f,d);for(var o in m){var u=m[o];u instanceof t.SymbolBucket?(a(u.layers,this.zoom,r),t.performSymbolLayout(u,p,e.positions,f,n.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):u.hasPattern&&(u instanceof t.LineBucket||u instanceof t.FillBucket||u instanceof t.FillExtrusionBucket)&&(a(u.layers,this.zoom,r),u.addFeatures(g,this.tileID.canonical,n.patternPositions))}this.status="done",s(null,{buckets:t.values(m).filter((function(t){return!t.isEmpty()})),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:n,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}}I.length?o.send("getImages",{icons:I,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,d=e,k.call(u))})):d={},k.call(this)};var u=function(t,e,n,r){this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=r||s,this.loading={},this.loaded={}};u.prototype.loadTile=function(e,n){var r=this,i=e.uid;this.loading||(this.loading={});var a=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[i]=new o(e);s.abort=this.loadVectorData(e,(function(e,o){if(delete r.loading[i],e||!o)return s.status="done",r.loaded[i]=s,n(e);var u=o.rawData,l={};o.expires&&(l.expires=o.expires),o.cacheControl&&(l.cacheControl=o.cacheControl);var c={};if(a){var h=a.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,r.layerIndex,r.availableImages,r.actor,(function(e,r){if(e||!r)return n(e);n(null,t.extend({rawTileData:u.slice(0)},r,l,c))})),r.loaded=r.loaded||{},r.loaded[i]=s}))},u.prototype.reloadTile=function(t,e){var n=this,r=this.loaded,i=t.uid,o=this;if(r&&r[i]){var a=r[i];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,r){var i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,n.availableImages,o.actor,i)),e(t,r)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},u.prototype.abortTile=function(t,e){var n=this.loading,r=t.uid;n&&n[r]&&n[r].abort&&(n[r].abort(),delete n[r]),e()},u.prototype.removeTile=function(t,e){var n=this.loaded,r=t.uid;n&&n[r]&&delete n[r],e()};var l=t.window.ImageBitmap,c=function(){this.loaded={}};function h(t,e){if(0!==t.length){p(t[0],e);for(var n=1;n<t.length;n++)p(t[n],!e)}}function p(t,e){for(var n=0,r=0,i=t.length,o=i-1;r<i;o=r++)n+=(t[r][0]-t[o][0])*(t[o][1]+t[r][1]);n>=0!=!!e&&t.reverse()}c.prototype.loadTile=function(e,n){var r=e.uid,i=e.encoding,o=e.rawImageData,a=l&&o instanceof l?this.getImageData(o):o,s=new t.DEMData(r,a,i);this.loaded=this.loaded||{},this.loaded[r]=s,n(null,s)},c.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var n=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:n.width,height:n.height},n.data)},c.prototype.removeTile=function(t){var e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]};var f=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,d=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};d.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],n=0,r=this._feature.geometry;n<r.length;n+=1){var i=r[n];e.push([new t.Point$1(i[0],i[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var u=[],l=0,c=s[a];l<c.length;l+=1){var h=c[l];u.push(new t.Point$1(h[0],h[1]))}o.push(u)}return o},d.prototype.toGeoJSON=function(t,e,n){return f.call(this,t,e,n)};var m=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};m.prototype.feature=function(t){return new d(this._features[t])};var g=t.vectorTile.VectorTileFeature,y=v;function v(t,e){this.options=e||{},this.features=t,this.length=t.length}function _(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}v.prototype.feature=function(t){return new _(this.features[t],this.options.extent)},_.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<r.length;o++)i.push(new t.Point$1(r[o][0],r[o][1]));this.geometry.push(i)}return this.geometry},_.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),n=Math.max(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.y)}return[e,r,n,i]},_.prototype.toGeoJSON=g.prototype.toGeoJSON;var x=w,b=y;function w(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,S,t.layers[n])}(e,n),n.finish()}function S(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)r.feature=t.feature(n),e.writeMessage(2,E,r);var i=r.keys;for(n=0;n<i.length;n++)e.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)e.writeMessage(4,P,o[n])}function E(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,C,t),e.writeVarintField(3,n.type),e.writeMessage(4,A,n)}function C(t,e){var n=t.feature,r=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in n.properties){var u=o[s];void 0===u&&(r.push(s),o[s]=u=r.length-1),e.writeVarint(u);var l=n.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,p=a[h];void 0===p&&(i.push(l),a[h]=p=i.length-1),e.writeVarint(p)}}function M(t,e){return(e<<3)+(7&t)}function T(t){return t<<1^t>>31}function A(t,e){for(var n=t.loadGeometry(),r=t.type,i=0,o=0,a=n.length,s=0;s<a;s++){var u=n[s],l=1;1===r&&(l=u.length),e.writeVarint(M(1,l));for(var c=3===r?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==r&&e.writeVarint(M(2,c-1));var p=u[h].x-i,f=u[h].y-o;e.writeVarint(T(p)),e.writeVarint(T(f)),i+=p,o+=f}3===r&&e.writeVarint(M(7,1))}}function P(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function L(t,e,n,r){I(t,n,r),I(e,2*n,2*r),I(e,2*n+1,2*r+1)}function I(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function k(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}x.fromVectorTileJs=w,x.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var r in t)n[r]=new y(t[r].features,e),n[r].name=r,n[r].version=e.version,n[r].extent=e.extent;return w({layers:n})},x.GeoJSONWrapper=b;var O=function(t){return t[0]},R=function(t){return t[1]},D=function(t,e,n,r,i){void 0===e&&(e=O),void 0===n&&(n=R),void 0===r&&(r=64),void 0===i&&(i=Float64Array),this.nodeSize=r,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=n(t[u]);!function t(e,n,r,i,o,a){if(!(o-i<=r)){var s=i+o>>1;!function t(e,n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(e,n,r,Math.max(i,Math.floor(r-u*c/s+h)),Math.min(o,Math.floor(r+(s-u)*c/s+h)),a)}var p=n[2*r+a],f=i,d=o;for(L(e,n,i,r),n[2*o+a]>p&&L(e,n,i,o);f<d;){for(L(e,n,f,d),f++,d--;n[2*f+a]<p;)f++;for(;n[2*d+a]>p;)d--}n[2*i+a]===p?L(e,n,i,d):L(e,n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}(e,n,s,i,o,a%2),t(e,n,r,i,s-1,a+1),t(e,n,r,s+1,o,a+1)}}(a,s,r,0,a.length-1,0)};D.prototype.range=function(t,e,n,r){return function(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),p=l.pop(),f=l.pop();if(p-f<=a)for(var d=f;d<=p;d++)u=e[2*d+1],(s=e[2*d])>=n&&s<=i&&u>=r&&u<=o&&c.push(t[d]);else{var m=Math.floor((f+p)/2);u=e[2*m+1],(s=e[2*m])>=n&&s<=i&&u>=r&&u<=o&&c.push(t[m]);var g=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(f),l.push(m-1),l.push(g)),(0===h?i>=s:o>=u)&&(l.push(m+1),l.push(p),l.push(g))}}return c}(this.ids,this.coords,t,e,n,r,this.nodeSize)},D.prototype.within=function(t,e,n){return function(t,e,n,r,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)k(e[2*p],e[2*p+1],n,r)<=u&&s.push(t[p]);else{var f=Math.floor((h+c)/2),d=e[2*f],m=e[2*f+1];k(d,m,n,r)<=u&&s.push(t[f]);var g=(l+1)%2;(0===l?n-i<=d:r-i<=m)&&(a.push(h),a.push(f-1),a.push(g)),(0===l?n+i>=d:r+i>=m)&&(a.push(f+1),a.push(c),a.push(g))}}return s}(this.ids,this.coords,t,e,n,this.nodeSize)};var N={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},F=function(t){this.options=G(Object.create(N),t),this.trees=new Array(this.options.maxZoom+1)};function z(t,e,n,r,i){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function B(t,e){var n=t.geometry.coordinates,r=n[1];return{x:Z(n[0]),y:V(r),zoom:1/0,index:e,parentId:-1}}function j(t){return{type:"Feature",id:t.id,properties:U(t),geometry:{type:"Point",coordinates:[(r=t.x,360*(r-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,r}function U(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return G(G({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function Z(t){return t/360+.5}function V(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function G(t,e){for(var n in e)t[n]=e[n];return t}function H(t){return t.x}function W(t){return t.y}function q(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((t-n)*a+(e-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=t-n)*a+(s=e-r)*s}function X(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)Y(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)Y(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)Y(t,e[r][i])}(i),i}function Y(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function K(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)Q(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)Q(i[l],s);else if("LineString"===o)J(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)J(i[l],s=[],a,!1),t.push(X(u,"LineString",s,e.properties));return}$(i,s,a,!1)}else if("Polygon"===o)$(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)K(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];$(i[l],c,a,!0),s.push(c)}}t.push(X(u,o,s,e.properties))}}function Q(t,e){e.push(tt(t[0])),e.push(et(t[1])),e.push(0)}function J(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var u=tt(t[s][0]),l=et(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=e.length-3;e[2]=1,function t(e,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,l=e[n],c=e[n+1],h=e[r],p=e[r+1],f=n+3;f<r;f+=3){var d=q(e[f],e[f+1],l,c,h,p);if(d>a)o=f,a=d;else if(d===a){var m=Math.abs(f-s);m<u&&(o=f,u=m)}}a>i&&(o-n>3&&t(e,n,o,i),e[o+2]=a,r-o>3&&t(e,o,r,i))}(e,0,c,n),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function $(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];J(t[i],o,n,r),e.push(o)}}function tt(t){return t/360+.5}function et(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function nt(t,e,n,r,i,o,a,s){if(r/=e,o>=(n/=e)&&a<r)return t;if(a<n||o>=r)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=n&&d<r)u.push(c);else if(!(d<n||f>=r)){var m=[];if("Point"===p||"MultiPoint"===p)rt(h,m,n,r,i);else if("LineString"===p)it(h,m,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===p)at(h,m,n,r,i,!1);else if("Polygon"===p)at(h,m,n,r,i,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var y=[];at(h[g],y,n,r,i,!0),y.length&&m.push(y)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)u.push(X(c.id,p,m[g],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),u.push(X(c.id,p,m,c.tags))}}}return u.length?u:null}function rt(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function it(t,e,n,r,i,o,a){for(var s,u,l=ot(t),c=0===i?ut:lt,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],m=t[p+2],g=t[p+3],y=t[p+4],v=0===i?f:d,_=0===i?g:y,x=!1;a&&(s=Math.sqrt(Math.pow(f-g,2)+Math.pow(d-y,2))),v<n?_>n&&(u=c(l,f,d,g,y,n),a&&(l.start=h+s*u)):v>r?_<r&&(u=c(l,f,d,g,y,r),a&&(l.start=h+s*u)):st(l,f,d,m),_<n&&v>=n&&(u=c(l,f,d,g,y,n),x=!0),_>r&&v<=r&&(u=c(l,f,d,g,y,r),x=!0),!o&&x&&(a&&(l.end=h+s*u),e.push(l),l=ot(t)),a&&(h+=s)}var b=t.length-3;f=t[b],d=t[b+1],m=t[b+2],(v=0===i?f:d)>=n&&v<=r&&st(l,f,d,m),b=l.length-3,o&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&st(l,l[0],l[1],l[2]),l.length&&e.push(l)}function ot(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function at(t,e,n,r,i,o){for(var a=0;a<t.length;a++)it(t[a],e,n,r,i,o,!1)}function st(t,e,n,r){t.push(e),t.push(n),t.push(r)}function ut(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function lt(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function ct(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=ht(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(ht(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(ht(o.geometry[s][l],e));i.push(u)}n.push(X(o.id,a,i,o.tags))}return n}function ht(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function pt(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(ft(l[r],l[r+1],e,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(ft(l[r][i],l[r][i+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function ft(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function dt(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,mt(a,t[s],o,i);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function mt(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)gt(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)gt(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)gt(a,l[s],t,n,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function gt(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===r||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}(s,o),t.push(s)}}function yt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)K(n,t.features[r],e,r);else K(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var n=e.buffer/e.extent,r=t,i=nt(t,1,-1-n,n,0,-1,2,e),o=nt(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=nt(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=ct(i,1).concat(r)),o&&(r=r.concat(ct(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vt(t,e,n){return 32*((1<<t)*n+e)+t}function _t(t,e){var n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return e(null,null);var i=new m(r.features),o=x(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}F.prototype.load=function(t){var e=this.options,n=e.log,r=e.minZoom,i=e.maxZoom,o=e.nodeSize;n&&console.time("total time");var a="prepare "+t.length+" points";n&&console.time(a),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(B(t[u],u));this.trees[i+1]=new D(s,H,W,o,Float32Array),n&&console.timeEnd(a);for(var l=i;l>=r;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new D(s,H,W,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return n&&console.timeEnd("total time"),this},F.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(Z(n),V(o),Z(i),V(r));c<h.length;c+=1){var p=u.points[h[c]];l.push(p.numPoints?j(p):this.points[p.index])}return l},F.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=i.points[l[u]];c.parentId===t&&s.push(c.numPoints?j(c):this.points[c.index])}if(0===s.length)throw new Error(r);return s},F.prototype.getLeaves=function(t,e,n){var r=[];return this._appendLeaves(r,t,e=e||10,n=n||0,0),r},F.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(n-a)/i,u=(n+1+a)/i,l={features:[]};return this._addTileFeatures(r.range((e-a)/i,s,(e+1+a)/i,u),r.points,e,n,i,l),0===e&&this._addTileFeatures(r.range(1-a/i,s,1,u),r.points,i,n,i,l),e===i-1&&this._addTileFeatures(r.range(0,s,a/i,u),r.points,-1,n,i,l),l.features.length?l:null},F.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},F.prototype._appendLeaves=function(t,e,n,r,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},F.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l=u.numPoints,c={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-r))]],tags:l?U(u):this.points[u.index].properties},h=void 0;l?h=u.id:this.options.generateId?h=u.index:this.points[u.index].id&&(h=this.points[u.index].id),void 0!==h&&(c.id=h),o.features.push(c)}},F.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},F.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.reduce,o=r.minPoints,a=r.radius/(r.extent*Math.pow(2,e)),s=0;s<t.length;s++){var u=t[s];if(!(u.zoom<=e)){u.zoom=e;for(var l=this.trees[e+1],c=l.within(u.x,u.y,a),h=u.numPoints||1,p=h,f=0,d=c;f<d.length;f+=1){var m=l.points[d[f]];m.zoom>e&&(p+=m.numPoints||1)}if(p>=o){for(var g=u.x*h,y=u.y*h,v=i&&h>1?this._map(u,!0):null,_=(s<<5)+(e+1)+this.points.length,x=0,b=c;x<b.length;x+=1){var w=l.points[b[x]];if(!(w.zoom<=e)){w.zoom=e;var S=w.numPoints||1;g+=w.x*S,y+=w.y*S,w.parentId=_,i&&(v||(v=this._map(u,!0)),i(v,this._map(w)))}}u.parentId=_,n.push(z(g/p,y/p,_,p,v))}else if(n.push(u),p>1)for(var E=0,C=c;E<C.length;E+=1){var M=l.points[C[E]];M.zoom<=e||(M.zoom=e,n.push(M))}}}return n},F.prototype._getOriginId=function(t){return t-this.points.length>>5},F.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},F.prototype._map=function(t,e){if(t.numPoints)return e?G({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?G({},r):r},yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(t,e,n,r,i,o,a){for(var s=[t,e,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=vt(e,n,r),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=dt(t,e,n,r,u),this.tileCoords.push({z:e,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){l>1&&console.time("clipping");var m,g,y,v,_,x,b=.5*u.buffer/u.extent,w=.5-b,S=.5+b,E=1+b;m=g=y=v=null,_=nt(t,c,n-b,n+S,0,p.minX,p.maxX,u),x=nt(t,c,n+w,n+E,0,p.minX,p.maxX,u),t=null,_&&(m=nt(_,c,r-b,r+S,1,p.minY,p.maxY,u),g=nt(_,c,r+w,r+E,1,p.minY,p.maxY,u),_=null),x&&(y=nt(x,c,r-b,r+S,1,p.minY,p.maxY,u),v=nt(x,c,r+w,r+E,1,p.minY,p.maxY,u),x=null),l>1&&console.timeEnd("clipping"),s.push(m||[],e+1,2*n,2*r),s.push(g||[],e+1,2*n,2*r+1),s.push(y||[],e+1,2*n+1,2*r),s.push(v||[],e+1,2*n+1,2*r+1)}}},yt.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var a=1<<t,s=vt(t,e=(e%a+a)%a,n);if(this.tiles[s])return pt(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,l=t,c=e,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[vt(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?pt(this.tiles[s],i):null):null};var xt=function(e){function n(t,n,r,i){e.call(this,t,n,r,_t),i&&(this.loadGeoJSON=i)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},n.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(r&&r.request&&r.request.collectResourceTiming)&&new t.RequestPerformance(r.request);this.loadGeoJSON(r,(function(o,a){if(o||!a)return n(o);if("object"!=typeof a)return n(new Error("Input data given to '"+r.source+"' is not a valid GeoJSON object."));!function t(e,n){var r,i=e&&e.type;if("FeatureCollection"===i)for(r=0;r<e.features.length;r++)t(e.features[r],n);else if("GeometryCollection"===i)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],n);else if("Feature"===i)t(e.geometry,n);else if("Polygon"===i)h(e.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<e.coordinates.length;r++)h(e.coordinates[r],n);return e}(a,!0);try{if(r.filter){var s=t.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(t){return t.key+": "+t.message})).join(", "));var u=a.features.filter((function(t){return s.value.evaluate({zoom:0},t)}));a={type:"FeatureCollection",features:u}}e._geoJSONIndex=r.cluster?new F(function(e){var n=e.superclusterOptions,r=e.clusterProperties;if(!r||!n)return n;for(var i={},o={},a={accumulated:null,zoom:0},s={properties:null},u=Object.keys(r),l=0,c=u;l<c.length;l+=1){var h=c[l],p=r[h],f=p[0],d=t.createExpression(p[1]),m=t.createExpression("string"==typeof f?[f,["accumulated"],["get",h]]:f);i[h]=d.value,o[h]=m.value}return n.map=function(t){s.properties=t;for(var e={},n=0,r=u;n<r.length;n+=1){var o=r[n];e[o]=i[o].evaluate(a,s)}return e},n.reduce=function(t,e){s.properties=e;for(var n=0,r=u;n<r.length;n+=1){var i=r[n];a.accumulated=t[i],t[i]=o[i].evaluate(a,s)}},n}(r)).load(a.features):function(t,e){return new yt(t,e)}(a,r.geojsonVtOptions)}catch(o){return n(o)}e.loaded={};var l={};if(i){var c=i.finish();c&&(l.resourceTiming={},l.resourceTiming[r.source]=JSON.parse(JSON.stringify(c)))}n(null,l)}))}},n.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},n.prototype.reloadTile=function(t,n){var r=this.loaded;return r&&r[t.uid]?e.prototype.reloadTile.call(this,t,n):this.loadTile(t,n)},n.prototype.loadGeoJSON=function(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},n.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},n.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},n}(u),bt=function(e){var n=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:u,geojson:xt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(n.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');n.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return bt.prototype.setReferrer=function(t,e){this.referrer=e},bt.prototype.setImages=function(t,e,n){for(var r in this.availableImages[t]=e,this.workerSources[t]){var i=this.workerSources[t][r];for(var o in i)i[o].availableImages=e}n()},bt.prototype.setLayers=function(t,e,n){this.getLayerIndex(t).replace(e),n()},bt.prototype.updateLayers=function(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()},bt.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)},bt.prototype.loadDEMTile=function(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)},bt.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)},bt.prototype.abortTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)},bt.prototype.removeTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)},bt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},bt.prototype.removeSource=function(t,e,n){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,n):n()}},bt.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}},bt.prototype.syncRTLPluginState=function(e,n,r){try{t.plugin.setState(n);var i=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=i){this.self.importScripts(i);var o=t.plugin.isParsed();r(o?void 0:new Error("RTL Text Plugin failed to import scripts from "+i),o)}}catch(t){r(t.toString())}},bt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},bt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e},bt.prototype.getWorkerSource=function(t,e,n){var r=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][n]||(this.workerSources[t][e][n]=new this.workerSourceTypes[e]({send:function(e,n,i){r.actor.send(e,n,i,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][n]},bt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new c),this.demWorkerSources[t][e]},bt.prototype.enforceCacheSizeLimit=function(e,n){t.enforceCacheSizeLimit(n)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new bt(self)),bt})),r(0,(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!n(t)}function n(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()?(void 0===r[n=t&&t.failIfMajorPerformanceCaveat]&&(r[n]=function(t){var n=function(t){var n=document.createElement("canvas"),r=Object.create(e.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,n.probablySupportsContext?n.probablySupportsContext("webgl",r)||n.probablySupportsContext("experimental-webgl",r):n.supportsContext?n.supportsContext("webgl",r)||n.supportsContext("experimental-webgl",r):n.getContext("webgl",r)||n.getContext("experimental-webgl",r)}(t);if(!n)return!1;var r=n.createShader(n.VERTEX_SHADER);return!(!r||n.isContextLost())&&(n.shaderSource(r,"void main() {}"),n.compileShader(r),!0===n.getShaderParameter(r,n.COMPILE_STATUS))}(n)),r[n]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=n);var r={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),n={create:function(e,n,r){var i=t.window.document.createElement(e);return void 0!==n&&(i.className=n),r&&r.appendChild(i),i},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},r=t.window.document&&t.window.document.documentElement.style;function i(t){if(!r)return t[0];for(var e=0;e<t.length;e++)if(t[e]in r)return t[e];return t[0]}var o,a=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){r&&a&&(o=r[a],r[a]="none")},n.enableDrag=function(){r&&a&&(r[a]=o)};var s=i(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[s]=e};var u=!1;try{var l=Object.defineProperty({},"passive",{get:function(){u=!0}});t.window.addEventListener("test",l,l),t.window.removeEventListener("test",l,l)}catch(t){u=!1}n.addEventListener=function(t,e,n,r){void 0===r&&(r={}),t.addEventListener(e,n,"passive"in r&&u?r:r.capture)},n.removeEventListener=function(t,e,n,r){void 0===r&&(r={}),t.removeEventListener(e,n,"passive"in r&&u?r:r.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}n.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",c,!0)}),0)},n.mousePos=function(e,n){var r=e.getBoundingClientRect();return new t.Point(n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop)},n.touchPos=function(e,n){for(var r=e.getBoundingClientRect(),i=[],o=0;o<n.length;o++)i.push(new t.Point(n[o].clientX-r.left-e.clientLeft,n[o].clientY-r.top-e.clientTop));return i},n.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function n(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,n=this.requestors;e<n.length;e+=1){var r=n[e];this._notify(r.ids,r.callback)}this.requestors=[]}},n.prototype.getImage=function(t){return this.images[t]},n.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},n.prototype._validate=function(e,n){var r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),r=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),r=!1),r},n.prototype._validateStretch=function(t,e){if(!t)return!0;for(var n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];if(o[0]<n||o[1]<o[0]||e<o[1])return!1;n=o[1]}return!0},n.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},n.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},n.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(t,e){var n=!0;if(!this.isLoaded())for(var r=0,i=t;r<i.length;r+=1)this.images[i[r]]||(n=!1);this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})},n.prototype._notify=function(e,n){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?r[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}n(null,r)},n.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},n.prototype.getPattern=function(e){var n=this.patterns[e],r=this.getImage(e);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{var i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new t.ImagePosition(i,r);this.patterns[e]={bin:i,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},n.prototype.bind=function(e){var n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var e=[];for(var n in this.patterns)e.push(this.patterns[n].bin);var r=t.potpack(e),i=r.w,o=r.h,a=this.atlasImage;for(var s in a.resize({width:i||1,height:o||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,h=this.images[s].data,p=h.width,f=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c},{width:p,height:f}),t.RGBAImage.copy(h,a,{x:0,y:f-1},{x:l,y:c-1},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c+f},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:p-1,y:0},{x:l-1,y:c},{width:1,height:f}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:l+p,y:c},{width:1,height:f})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var i=this.images[r];h(i)&&this.updateImage(r,i)}}},n}(t.Evented),f=g,d=g,m=1e20;function g(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function y(t,e,n,r,i,o,a){for(var s=0;s<e;s++){for(var u=0;u<n;u++)r[u]=t[u*e+s];for(v(r,i,o,a,n),u=0;u<n;u++)t[u*e+s]=i[u]}for(u=0;u<n;u++){for(s=0;s<e;s++)r[s]=t[u*e+s];for(v(r,i,o,a,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(i[s])}}function v(t,e,n,r,i){n[0]=0,r[0]=-m,r[1]=+m;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=r[a];)a--,s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=s,r[a+1]=+m}for(o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++;e[o]=(o-n[a])*(o-n[a])+t[n[a]]}}g.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=e.data[4*r+3]/255;this.gridOuter[r]=1===i?0:0===i?m:Math.pow(Math.max(0,.5-i),2),this.gridInner[r]=1===i?m:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(y(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),y(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)n[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return n},f.default=d;var _=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};_.prototype.setURL=function(t){this.url=t},_.prototype.getGlyphs=function(e,n){var r=this,i=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1)i.push({stack:o,id:s[a]});t.asyncAll(i,(function(t,e){var n=t.stack,i=t.id,o=r.entries[n];o||(o=r.entries[n]={glyphs:{},requests:{},ranges:{}});var a=o.glyphs[i];if(void 0===a){if(a=r._tinySDF(o,n,i))return o.glyphs[i]=a,void e(null,{stack:n,id:i,glyph:a});var s=Math.floor(i/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(o.ranges[s])e(null,{stack:n,id:i,glyph:a});else{var u=o.requests[s];u||(u=o.requests[s]=[],_.loadGlyphRange(n,s,r.url,r.requestManager,(function(t,e){if(e){for(var n in e)r._doesCharSupportLocalGlyph(+n)||(o.glyphs[+n]=e[+n]);o.ranges[s]=!0}for(var i=0,a=u;i<a.length;i+=1)(0,a[i])(t,e);delete o.requests[s]}))),u.push((function(t,r){t?e(t):r&&e(null,{stack:n,id:i,glyph:r[i]||null})}))}}else e(null,{stack:n,id:i,glyph:a})}),(function(t,e){if(t)n(t);else if(e){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.stack,u=a.id,l=a.glyph;(r[s]||(r[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}n(null,r)}}))},_.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},_.prototype._tinySDF=function(e,n,r){var i=this.localIdeographFontFamily;if(i&&this._doesCharSupportLocalGlyph(r)){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(n)?a="900":/medium/i.test(n)?a="500":/light/i.test(n)&&(a="200"),o=e.tinySDF=new _.TinySDF(24,3,8,.25,i,a)}return{id:r,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_.loadGlyphRange=function(e,n,r,i,o){var a=256*n,s=a+255,u=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,(function(e,n){if(e)o(e);else if(n){for(var r={},i=0,a=t.parseGlyphPBF(n);i<a.length;i+=1){var s=a[i];r[s.id]=s}o(null,r)}}))},_.TinySDF=f;var x=function(){this.specification=t.styleSpec.light.position};x.prototype.possiblyEvaluate=function(e,n){return t.sphericalToCartesian(e.expression.evaluate(n))},x.prototype.interpolate=function(e,n,r){return{x:t.number(e.x,n.x,r),y:t.number(e.y,n.y,r),z:t.number(e.z,n.z,r)}};var b=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new x,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),w=function(e){function n(n){e.call(this),this._transitionable=new t.Transitionable(b),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(e,n){if(void 0===n&&(n={}),!this._validate(t.validateLight,e,n))for(var r in e){var i=e[r];t.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-"-transition".length),i):this._transitionable.setValue(r,i)}},n.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},n.prototype._validate=function(e,n,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},n}(t.Evented),S=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};S.prototype.getDash=function(t,e){var n=t.join(",")+String(e);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(t,e)),this.dashEntry[n]},S.prototype.getDashRanges=function(t,e,n){var r=[],i=t.length%2==1?-t[t.length-1]*n:0,o=t[0]*n,a=!0;r.push({left:i,right:o,isDash:a,zeroLength:0===t[0]});for(var s=t[0],u=1;u<t.length;u++){var l=t[u];r.push({left:i=s*n,right:o=(s+=l)*n,isDash:a=!a,zeroLength:0===l})}return r},S.prototype.addRoundDash=function(t,e,n){for(var r=e/2,i=-n;i<=n;i++)for(var o=this.width*(this.nextRow+n+i),a=0,s=t[a],u=0;u<this.width;u++){u/s.right>1&&(s=t[++a]);var l=Math.abs(u-s.left),c=Math.abs(u-s.right),h=Math.min(l,c),p=void 0,f=i/n*(r+1);if(s.isDash){var d=r-Math.abs(f);p=Math.sqrt(h*h+d*d)}else p=r-Math.sqrt(h*h+f*f);this.data[o+u]=Math.max(0,Math.min(255,p+128))}},S.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var n=t[e],r=t[e+1];n.zeroLength?t.splice(e,1):r&&r.isDash===n.isDash&&(r.left=n.left,t.splice(e,1))}var i=t[0],o=t[t.length-1];i.isDash===o.isDash&&(i.left=o.left-this.width,o.right=i.right+this.width);for(var a=this.width*this.nextRow,s=0,u=t[s],l=0;l<this.width;l++){l/u.right>1&&(u=t[++s]);var c=Math.abs(l-u.left),h=Math.abs(l-u.right),p=Math.min(c,h);this.data[a+l]=Math.max(0,Math.min(255,(u.isDash?p:-p)+128))}},S.prototype.addDash=function(e,n){var r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];if(0!==o){var s=this.width/o,u=this.getDashRanges(e,this.width,s);n?this.addRoundDash(u,s,r):this.addRegularDash(u)}var l={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=i,this.dirty=!0,l},S.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var E=function e(n,r){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=new e.Actor(i[o],r,this.id);a.name="Worker "+o,this.actors.push(a)}};function C(e,n,r){var i=function(i,o){if(i)return r(i);if(o){var a=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map((function(t){return t.id}))),a.tiles=n.canonicalizeTileset(a,e.url),r(null,a)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame((function(){return i(null,e)}))}E.prototype.broadcast=function(e,n,r){t.asyncAll(this.actors,(function(t,r){t.send(e,n,r)}),r=r||function(){})},E.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},E.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},E.Actor=t.Actor;var M=function(e,n,r){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=r||24};M.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},M.prototype.contains=function(e){var n=Math.pow(2,e.z),r=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=r&&e.x<o&&e.y>=i&&e.y<a};var T=function(e){function n(n,r,i,o){if(e.call(this),this.id=n,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(r,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,(function(n,r){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new M(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},n.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},n.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.loadTile=function(e,n){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function o(r,i){return delete e.request,e.aborted?n(null):r&&404!==r.status?n(r):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",i,o.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,o.bind(this)))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.hasTransition=function(){return!1},n}(t.Evented),A=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},r),t.extend(this,t.pick(r,["url","scheme","tileSize"]))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,(function(n,r){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new M(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.loadTile=function(e,n){var r=this,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(function(i,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(o){r.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=r.map.painter.context,s=a.gl;e.texture=r.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(r.dispatcher),n(null)}}))},n.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},n.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},n.prototype.hasTransition=function(){return!1},n}(t.Evented),P=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(e,n){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function i(t,r){t&&(e.state="errored",n(t)),r&&(e.dem=r,e.needsHillshadePrepare=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),function(r,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?o:t.browser.getImageData(o,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,i.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},n.prototype._getNeighboringTiles=function(e){var n=e.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?e.wrap-1:e.wrap,a=(n.x+1+r)%r,s=n.x+1===r?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<r&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),u},n.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},n}(A),L=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=r.data,this._options=t.extend({},r),this._collectResourceTiming=r.collectResourceTiming,this._resourceTiming=[],void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*a,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?Math.min(r.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.EXTENT,radius:(r.clusterRadius||50)*a,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(n){if(n)e.fire(new t.ErrorEvent(n));else{var r={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(r.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",r))}}))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setData=function(e){var n=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)n.fire(new t.ErrorEvent(e));else{var r={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(r.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new t.Event("data",r))}})),this},n.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},n.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},n.prototype.getClusterLeaves=function(t,e,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},r),this},n.prototype._updateWorkerData=function(e){var n=this;this._loaded=!1;var r=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(r.request=this.map._requestManager.transformRequest(t.browser.resolveURL(i),t.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(i),this.actor.send(this.type+".loadData",r,(function(t,i){n._removed||i&&i.abandoned||(n._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[n.id]&&(n._resourceTiming=i.resourceTiming[n.id].slice(0)),n.actor.send(n.type+".coalesce",{source:r.source},null),e(t))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.loadTile=function(e,n){var r=this,i=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(i,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,o){return delete e.request,e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(o,r.map.painter,"reloadTile"===i),n(null))}))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},n.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},n.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},n.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(t.Evented),I=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),k=function(e){function n(t,n,r,i){e.call(this),this.id=t,this.dispatcher=r,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(e,n){var r=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(i,o){r._loaded=!0,i?r.fire(new t.ErrorEvent(i)):o&&(r.image=o,e&&(r.coordinates=e),n&&n(),r._finishLoading())}))},n.prototype.loaded=function(){return this._loaded},n.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setCoordinates=function(e){var n=this;this.coordinates=e;var r=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var n=1/0,r=1/0,i=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var u=s[a];n=Math.min(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.x),o=Math.max(o,u.y)}var l=Math.max(i-n,o-r),c=Math.max(0,Math.floor(-Math.log(l)/Math.LN2)),h=Math.pow(2,c);return new t.CanonicalTileID(c,Math.floor((n+i)/2*h),Math.floor((r+o)/2*h))}(r),this.minzoom=this.maxzoom=this.tileID.z;var i=r.map((function(t){return n.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},n.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},n.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(t.Evented),O=function(e){function n(t,n,r,i){e.call(this,t,n,r,i),this.roundZoom=!0,this.type="video",this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1;var n=this.options;this.urls=[];for(var r=0,i=n.urls;r<i.length;r+=1)this.urls.push(this.map._requestManager.transformRequest(i[r],t.ResourceType.Source).url);t.getVideo(this.urls,(function(n,r){e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(e.video=r,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},n.prototype.pause=function(){this.video&&this.video.pause()},n.prototype.play=function(){this.video&&this.video.play()},n.prototype.seek=function(e){if(this.video){var n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+n.start(0)+" and "+n.end(0)+"-second mark."))):this.video.currentTime=e}},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(k),R=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,r=n.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},n}(k),D={vector:T,raster:A,"raster-dem":P,geojson:L,video:O,image:k,canvas:R};function N(e,n){var r=t.identity([]);return t.translate(r,r,[1,1,0]),t.scale(r,r,[.5*e.width,.5*e.height,1]),t.multiply(r,r,e.calculatePosMatrix(n.toUnwrapped()))}function F(t,e,n,r,i,o){var a=function(t,e,n){if(t)for(var r=0,i=t;r<i.length;r+=1){var o=e[i[r]];if(o&&o.source===n&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===n&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,e,t.id),s=o.maxPitchScaleFactor(),u=t.tilesIn(r,s,a);u.sort(z);for(var l=[],c=0,h=u;c<h.length;c+=1){var p=h[c];l.push({wrappedTileID:p.tileID.wrapped().key,queryResults:p.tile.queryRenderedFeatures(e,n,t._state,p.queryGeometry,p.cameraQueryGeometry,p.scale,i,o,s,N(t.transform,p.tileID))})}var f=function(t){for(var e={},n={},r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.queryResults,s=o.wrappedTileID,u=n[s]=n[s]||{};for(var l in a)for(var c=a[l],h=u[l]=u[l]||{},p=e[l]=e[l]||[],f=0,d=c;f<d.length;f+=1){var m=d[f];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m))}}return e}(l);for(var d in f)f[d].forEach((function(e){var n=e.feature,r=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r}));return f}function z(t,e){var n=t.tileID,r=e.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}var B=function(t,e){this.max=t,this.onRemove=e,this.reset()};B.prototype.reset=function(){for(var t in this.data)for(var e=0,n=this.data[t];e<n.length;e+=1){var r=n[e];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}return this.data={},this.order=[],this},B.prototype.add=function(t,e,n){var r=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:e,timeout:void 0};if(void 0!==n&&(o.timeout=setTimeout((function(){r.remove(t,o)}),n)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},B.prototype.has=function(t){return t.wrapped().key in this.data},B.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},B.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},B.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},B.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},B.prototype.remove=function(t,e){if(!this.has(t))return this;var n=t.wrapped().key,r=void 0===e?0:this.data[n].indexOf(e),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this},B.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},B.prototype.filter=function(t){var e=[];for(var n in this.data)for(var r=0,i=this.data[n];r<i.length;r+=1){var o=i[r];t(o.value)||e.push(o)}for(var a=0,s=e;a<s.length;a+=1){var u=s[a];this.remove(u.value.tileID,u)}};var j=function(t,e,n){this.context=t;var r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};j.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},j.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},j.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var U={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Z=function(t,e,n,r){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;var i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};Z.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Z.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},Z.prototype.enableAttributes=function(t,e){for(var n=0;n<this.attributes.length;n++){var r=e.attributes[this.attributes[n].name];void 0!==r&&t.enableVertexAttribArray(r)}},Z.prototype.setVertexAttribPointers=function(t,e,n){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[U[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}},Z.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var V=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};V.prototype.get=function(){return this.current},V.prototype.set=function(t){},V.prototype.getDefault=function(){return this.default},V.prototype.setDefault=function(){this.set(this.default)};var G=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(V),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(V),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(V),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(V),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(V),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(V),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(V),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(V),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(V),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(V),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(V),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),it=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(V),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(V),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(V),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(V),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(V),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(V),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(V),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(V),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(V),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(V),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(V),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(V),yt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(V),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(V),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),bt=function(t){function e(e,n){t.call(this,e),this.context=e,this.parent=n}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(V),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(bt),St=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(bt),Et=function(t,e,n,r){this.context=t,this.width=e,this.height=n;var i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new wt(t,i),r&&(this.depthAttachment=new St(t,i))};Et.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}t.deleteFramebuffer(this.framebuffer)};var Ct=function(t,e,n){this.func=t,this.mask=e,this.range=n};Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);var Mt=function(t,e,n,r,i,o){this.test=t,this.ref=e,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o};Mt.disabled=new Mt({func:519,mask:0},0,0,7680,7680,7680);var Tt=function(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n};Tt.disabled=new Tt(Tt.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Tt.unblended=new Tt(Tt.Replace,t.Color.transparent,[!0,!0,!0,!0]),Tt.alphaBlended=new Tt([1,771],t.Color.transparent,[!0,!0,!0,!0]);var At=function(t,e,n){this.enable=t,this.mode=e,this.frontFace=n};At.disabled=new At(!1,1029,2305),At.backCCW=new At(!0,1029,2305);var Pt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G(this),this.clearDepth=new H(this),this.clearStencil=new W(this),this.colorMask=new q(this),this.depthMask=new X(this),this.stencilMask=new Y(this),this.stencilFunc=new K(this),this.stencilOp=new Q(this),this.stencilTest=new J(this),this.depthRange=new $(this),this.depthTest=new tt(this),this.depthFunc=new et(this),this.blend=new nt(this),this.blendFunc=new rt(this),this.blendColor=new it(this),this.blendEquation=new ot(this),this.cullFace=new at(this),this.cullFaceSide=new st(this),this.frontFace=new ut(this),this.program=new lt(this),this.activeTexture=new ct(this),this.viewport=new ht(this),this.bindFramebuffer=new pt(this),this.bindRenderbuffer=new ft(this),this.bindTexture=new dt(this),this.bindVertexBuffer=new mt(this),this.bindElementBuffer=new gt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yt(this),this.pixelStoreUnpack=new vt(this),this.pixelStoreUnpackPremultiplyAlpha=new _t(this),this.pixelStoreUnpackFlipY=new xt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};Pt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Pt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Pt.prototype.createIndexBuffer=function(t,e){return new j(this,t,e)},Pt.prototype.createVertexBuffer=function(t,e,n){return new Z(this,t,e,n)},Pt.prototype.createRenderbuffer=function(t,e,n){var r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),i},Pt.prototype.createFramebuffer=function(t,e,n){return new Et(this,t,e,n)},Pt.prototype.clear=function(t){var e=t.color,n=t.depth,r=this.gl,i=0;e&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),r.clear(i)},Pt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},Pt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Pt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Pt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Tt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},Pt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Lt=function(e){function n(n,r,i){var o=this;e.call(this),this.id=n,this.dispatcher=i,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=function(e,n,r,i){var o=new D[n.type](e,n,r,i);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o}(n,r,i,this),this._tiles={},this._cache=new B(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},n.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},n.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},n.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(It).map((function(t){return t.key}))},n.prototype.getRenderableIds=function(e){var n=this,r=[];for(var i in this._tiles)this._isIdRenderable(i,e)&&r.push(this._tiles[i]);return e?r.sort((function(e,r){var i=e.tileID,o=r.tileID,a=new t.Point(i.canonical.x,i.canonical.y)._rotate(n.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(n.transform.angle);return i.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})).map((function(t){return t.tileID.key})):r.map((function(t){return t.tileID})).sort(It).map((function(t){return t.key}))},n.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},n.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},n.prototype._reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))},n.prototype._tileLoaded=function(e,n,r,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new t.ErrorEvent(i,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},n.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),n=0;n<e.length;n++){var r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){var i=this.getTileByID(r);o(t,i),o(i,t)}}function o(t,e){t.needsHillshadePrepare=!0;var n=e.tileID.canonical.x-t.tileID.canonical.x,r=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},n.prototype.getTile=function(t){return this.getTileByID(t.key)},n.prototype.getTileByID=function(t){return this._tiles[t]},n.prototype._retainLoadedChildren=function(t,e,n,r){for(var i in this._tiles){var o=this._tiles[i];if(!(r[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>n)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var u=a;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){r[a.key]=a;break}}}},n.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(var r=t.overscaledZ-1;r>=e;r--){var i=t.scaledTo(r),o=this._getLoadedTile(i);if(o)return o}},n.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},n.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,n=Math.ceil(t.height/this._source.tileSize)+1,r=Math.floor(e*n*5),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(i)},n.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var n={};for(var r in this._tiles){var i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),n[i.tileID.key]=i}for(var o in this._tiles=n,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},n.prototype.update=function(e){var r=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter((function(t){return r._source.hasTile(t)})))):i=[];var o=e.coveringZoomLevel(this._source),a=Math.max(o-n.maxOverzooming,this._source.minzoom),s=Math.max(o+n.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(i,o);if(kt(this._source.type)){for(var l={},c={},h=0,p=Object.keys(u);h<p.length;h+=1){var f=p[h],d=u[f],m=this._tiles[f];if(m&&!(m.fadeEndTime&&m.fadeEndTime<=t.browser.now())){var g=this.findLoadedParent(d,a);g&&(this._addTile(g.tileID),l[g.tileID.key]=g.tileID),c[f]=d}}for(var y in this._retainLoadedChildren(c,o,s,u),l)u[y]||(this._coveredTiles[y]=!0,u[y]=l[y])}for(var v in u)this._tiles[v].clearFadeHold();for(var _=0,x=t.keysDifference(this._tiles,u);_<x.length;_+=1){var b=x[_],w=this._tiles[b];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(b)}this._updateLoadedParentTileCache()}},n.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},n.prototype._updateRetainedTiles=function(t,e){for(var r={},i={},o=Math.max(e-n.maxOverzooming,this._source.minzoom),a=Math.max(e+n.maxUnderzooming,this._source.minzoom),s={},u=0,l=t;u<l.length;u+=1){var c=l[u],h=this._addTile(c);r[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,a,r);for(var p=0,f=t;p<f.length;p+=1){var d=f[p],m=this._tiles[d.key];if(!m.hasData()){if(e+1>this._source.maxzoom){var g=d.children(this._source.maxzoom)[0],y=this.getTile(g);if(y&&y.hasData()){r[g.key]=g;continue}}else{var v=d.children(this._source.maxzoom);if(r[v[0].key]&&r[v[1].key]&&r[v[2].key]&&r[v[3].key])continue}for(var _=m.wasRequested(),x=d.overscaledZ-1;x>=o;--x){var b=d.scaledTo(x);if(i[b.key])break;if(i[b.key]=!0,!(m=this.getTile(b))&&_&&(m=this._addTile(b)),m&&(r[b.key]=b,_=m.wasRequested(),m.hasData()))break}}}return r},n.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],n=void 0,r=this._tiles[t].tileID;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}e.push(r.key);var i=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(i))break;r=i}for(var o=0,a=e;o<a.length;o+=1)this._loadedParentTiles[a[o]]=n}},n.prototype._addTile=function(e){var n=this._tiles[e.key];if(n)return n;(n=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));var r=Boolean(n);return r||(n=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n?(n.uses++,this._tiles[e.key]=n,r||this._source.fire(new t.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null},n.prototype._setTileReloadTimer=function(t,e){var n=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout((function(){n._reloadTile(t,"expired"),delete n._timers[t]}),r))},n.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},n.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},n.prototype.tilesIn=function(e,n,r){var i=this,o=[],a=this.transform;if(!a)return o;for(var s=r?a.getCameraQueryGeometry(e):e,u=e.map((function(t){return a.pointCoordinate(t)})),l=s.map((function(t){return a.pointCoordinate(t)})),c=this.getIds(),h=1/0,p=1/0,f=-1/0,d=-1/0,m=0,g=l;m<g.length;m+=1){var y=g[m];h=Math.min(h,y.x),p=Math.min(p,y.y),f=Math.max(f,y.x),d=Math.max(d,y.y)}for(var v=function(e){var r=i._tiles[c[e]];if(!r.holdingForFade()){var s=r.tileID,m=Math.pow(2,a.zoom-r.tileID.overscaledZ),g=n*r.queryPadding*t.EXTENT/r.tileSize/m,y=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(f,d))];if(y[0].x-g<t.EXTENT&&y[0].y-g<t.EXTENT&&y[1].x+g>=0&&y[1].y+g>=0){var v=u.map((function(t){return s.getTilePoint(t)})),_=l.map((function(t){return s.getTilePoint(t)}));o.push({tile:r,tileID:s,queryGeometry:v,cameraQueryGeometry:_,scale:m})}}},_=0;_<c.length;_++)v(_);return o},n.prototype.getVisibleCoordinates=function(t){for(var e=this,n=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),r=0,i=n;r<i.length;r+=1){var o=i[r];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(kt(this._source.type))for(var e in this._tiles){var n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=t.browser.now())return!0}return!1},n.prototype.setFeatureState=function(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)},n.prototype.removeFeatureState=function(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)},n.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},n.prototype.setDependencies=function(t,e,n){var r=this._tiles[t];r&&r.setDependencies(e,n)},n.prototype.reloadTilesForDependencies=function(t,e){for(var n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(n,"reloading");this._cache.filter((function(n){return!n.hasDependency(t,e)}))},n}(t.Evented);function It(t,e){var n=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function kt(t){return"raster"===t||"image"===t||"video"===t}function Ot(){return new t.window.Worker(Yi.workerUrl)}Lt.maxOverzooming=10,Lt.maxUnderzooming=3;var Rt="mapboxgl_preloaded_worker_pool",Dt=function(){this.active={}};Dt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Ot);return this.active[t]=!0,this.workers.slice()},Dt.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},Dt.prototype.isPreloaded=function(){return!!this.active[Rt]},Dt.prototype.numActive=function(){return Object.keys(this.active).length};var Nt,Ft=Math.floor(t.browser.hardwareConcurrency/2);function zt(){return Nt||(Nt=new Dt),Nt}function Bt(e,n){var r={};for(var i in e)"ref"!==i&&(r[i]=e[i]);return t.refProperties.forEach((function(t){t in n&&(r[t]=n[t])})),r}function jt(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=Bt(t[r],e[t[r].ref]));return t}Dt.workerCount=Math.max(Math.min(Ft,6),1);var Ut={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Zt(t,e,n){n.push({command:Ut.addSource,args:[t,e[t]]})}function Vt(t,e,n){e.push({command:Ut.removeSource,args:[t]}),n[t]=!0}function Gt(t,e,n,r){Vt(t,n,r),Zt(t,e,n)}function Ht(e,n,r){var i;for(i in e[r])if(e[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;return!0}function Wt(e,n,r,i,o,a){var s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}))}function qt(t){return t.id}function Xt(t,e){return t[e.id]=e,t}var Yt=function(t,e){this.reset(t,e)};Yt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Yt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var n=1,r=this._distances[n],i=e*this.paddedLength+this.padding;r<i&&n<this._distances.length;)r=this._distances[++n];var o=n-1,a=this._distances[o],s=r-a,u=s>0?(i-a)/s:0;return this.points[o].mult(1-u).add(this.points[n].mult(u))};var Kt=function(t,e,n){var r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Qt(e,n,r,i,o){var a=t.create();return n?(t.scale(a,a,[1/o,1/o,1]),r||t.rotateZ(a,a,i.angle)):t.multiply(a,i.labelPlaneMatrix,e),a}function Jt(e,n,r,i,o){if(n){var a=t.clone(e);return t.scale(a,a,[o,o,1]),r||t.rotateZ(a,a,-i.angle),a}return i.glCoordMatrix}function $t(e,n){var r=[e.x,e.y,0,1];ce(r,r,n);var i=r[3];return{point:new t.Point(r[0]/i,r[1]/i),signedDistanceFromCamera:i}}function te(t,e){return.5+t/e*.5}function ee(t,e){var n=t[0]/t[3],r=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&r>=-e[1]&&r<=e[1]}function ne(e,n,r,i,o,a,s,u){var l=i?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(l,r.transform.zoom),h=[256/r.width*2+1,256/r.height*2+1],p=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var f=e.lineVertexArray,d=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,m=r.transform.width/r.transform.height,g=!1,y=0;y<d.length;y++){var v=d.get(y);if(v.hidden||v.writingMode===t.WritingMode.vertical&&!g)le(v.numGlyphs,p);else{g=!1;var _=[v.anchorX,v.anchorY,0,1];if(t.transformMat4(_,_,n),ee(_,h)){var x=te(r.transform.cameraToCenterDistance,_[3]),b=t.evaluateSizeForFeature(l,c,v),w=s?b/x:b*x,S=new t.Point(v.anchorX,v.anchorY),E=$t(S,o).point,C={},M=oe(v,w,!1,u,n,o,a,e.glyphOffsetArray,f,p,E,S,C,m);g=M.useVertical,(M.notEnoughRoom||g||M.needsFlipping&&oe(v,w,!0,u,n,o,a,e.glyphOffsetArray,f,p,E,S,C,m).notEnoughRoom)&&le(v.numGlyphs,p)}else le(v.numGlyphs,p)}}i?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function re(t,e,n,r,i,o,a,s,u,l,c){var h=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,f=s.lineStartIndex+s.lineLength,d=e.getoffsetX(s.glyphStartIndex),m=e.getoffsetX(h-1),g=se(t*d,n,r,i,o,a,s.segment,p,f,u,l,c);if(!g)return null;var y=se(t*m,n,r,i,o,a,s.segment,p,f,u,l,c);return y?{first:g,last:y}:null}function ie(e,n,r,i){return e===t.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function oe(e,n,r,i,o,a,s,u,l,c,h,p,f,d){var m,g=n/24,y=e.lineOffsetX*g,v=e.lineOffsetY*g;if(e.numGlyphs>1){var _=e.glyphStartIndex+e.numGlyphs,x=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,w=re(g,u,y,v,r,h,p,e,l,a,f);if(!w)return{notEnoughRoom:!0};var S=$t(w.first.point,s).point,E=$t(w.last.point,s).point;if(i&&!r){var C=ie(e.writingMode,S,E,d);if(C)return C}m=[w.first];for(var M=e.glyphStartIndex+1;M<_-1;M++)m.push(se(g*u.getoffsetX(M),y,v,r,h,p,e.segment,x,b,l,a,f));m.push(w.last)}else{if(i&&!r){var T=$t(p,o).point,A=e.lineStartIndex+e.segment+1,P=new t.Point(l.getx(A),l.gety(A)),L=$t(P,o),I=L.signedDistanceFromCamera>0?L.point:ae(p,P,T,1,o),k=ie(e.writingMode,T,I,d);if(k)return k}var O=se(g*u.getoffsetX(e.glyphStartIndex),y,v,r,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,a,f);if(!O)return{notEnoughRoom:!0};m=[O]}for(var R=0,D=m;R<D.length;R+=1){var N=D[R];t.addDynamicAttributes(c,N.point,N.angle)}return{}}function ae(t,e,n,r,i){var o=$t(t.add(t.sub(e)._unit()),i).point,a=n.sub(o);return n.add(a._mult(r/a.mag()))}function se(e,n,r,i,o,a,s,u,l,c,h,p){var f=i?e-n:e+n,d=f>0?1:-1,m=0;i&&(d*=-1,m=Math.PI),d<0&&(m+=Math.PI);for(var g=d>0?u+s:u+s+1,y=o,v=o,_=0,x=0,b=Math.abs(f),w=[];_+x<=b;){if((g+=d)<u||g>=l)return null;if(v=y,w.push(y),void 0===(y=p[g])){var S=new t.Point(c.getx(g),c.gety(g)),E=$t(S,h);if(E.signedDistanceFromCamera>0)y=p[g]=E.point;else{var C=g-d;y=ae(0===_?a:new t.Point(c.getx(C),c.gety(C)),S,v,b-_+1,h)}}_+=x,x=v.dist(y)}var M=(b-_)/x,T=y.sub(v),A=T.mult(M)._add(v);A._add(T._unit()._perp()._mult(r*d));var P=m+Math.atan2(y.y-v.y,y.x-v.x);return w.push(A),{point:A,angle:P,path:w}}Kt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Kt.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Kt.prototype.insertCircle=function(t,e,n,r){this._forEachCell(e-r,n-r,e+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(r)},Kt.prototype._insertBoxCell=function(t,e,n,r,i,o){this.boxCells[i].push(o)},Kt.prototype._insertCircleCell=function(t,e,n,r,i,o){this.circleCells[i].push(o)},Kt.prototype._query=function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],h=this.circles[3*u+2];a.push({key:this.circleKeys[u],x1:l-h,y1:c-h,x2:l+h,y2:c+h})}return o?a.filter(o):a}return this._forEachCell(t,e,n,r,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a},Kt.prototype._queryCircle=function(t,e,n,r,i){var o=t-n,a=t+n,s=e-n,u=e+n;if(a<0||o>this.width||u<0||s>this.height)return!r&&[];var l=[];return this._forEachCell(o,s,a,u,this._queryCellCircle,l,{hitTest:r,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},i),r?l.length>0:l},Kt.prototype.query=function(t,e,n,r,i){return this._query(t,e,n,r,!1,i)},Kt.prototype.hitTest=function(t,e,n,r,i){return this._query(t,e,n,r,!0,i)},Kt.prototype.hitTestCircle=function(t,e,n,r){return this._queryCircle(t,e,n,!0,r)},Kt.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l)for(var c=this.bboxes,h=0,p=l;h<p.length;h+=1){var f=p[h];if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=c[d+2]&&e<=c[d+3]&&n>=c[d+0]&&r>=c[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}var m=this.circleCells[i];if(null!==m)for(var g=this.circles,y=0,v=m;y<v.length;y+=1){var _=v[y];if(!u.circle[_]){u.circle[_]=!0;var x=3*_;if(this._circleAndRectCollide(g[x],g[x+1],g[x+2],t,e,n,r)&&(!s||s(this.circleKeys[_]))){if(a.hitTest)return o.push(!0),!0;var b=g[x],w=g[x+1],S=g[x+2];o.push({key:this.circleKeys[_],x1:b-S,y1:w-S,x2:b+S,y2:w+S})}}}},Kt.prototype._queryCellCircle=function(t,e,n,r,i,o,a,s){var u=a.circle,l=a.seenUids,c=this.boxCells[i];if(null!==c)for(var h=this.bboxes,p=0,f=c;p<f.length;p+=1){var d=f[p];if(!l.box[d]){l.box[d]=!0;var m=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[m+0],h[m+1],h[m+2],h[m+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var g=this.circleCells[i];if(null!==g)for(var y=this.circles,v=0,_=g;v<_.length;v+=1){var x=_[v];if(!l.circle[x]){l.circle[x]=!0;var b=3*x;if(this._circlesCollide(y[b],y[b+1],y[b+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[x])))return o.push(!0),!0}}},Kt.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++)if(i.call(this,t,e,n,r,this.xCellCount*f+p,o,a,s))return},Kt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Kt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Kt.prototype._circlesCollide=function(t,e,n,r,i,o){var a=r-t,s=i-e,u=n+o;return u*u>a*a+s*s},Kt.prototype._circleAndRectCollide=function(t,e,n,r,i,o,a){var s=(o-r)/2,u=Math.abs(t-(r+s));if(u>s+n)return!1;var l=(a-i)/2,c=Math.abs(e-(i+l));if(c>l+n)return!1;if(u<=s||c<=l)return!0;var h=u-s,p=c-l;return h*h+p*p<=n*n};var ue=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function le(t,e){for(var n=0;n<t;n++){var r=e.length;e.resize(r+4),e.float32.set(ue,3*r)}}function ce(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t[3]=n[3]*r+n[7]*i+n[15],t}var he=function(t,e,n){void 0===e&&(e=new Kt(t.width+200,t.height+200,25)),void 0===n&&(n=new Kt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function pe(e,n,r){return n*(t.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}he.prototype.placeCollisionBox=function(t,e,n,r,i){var o=this.projectAndGetPerspectiveRatio(r,t.anchorPointX,t.anchorPointY),a=n*o.perspectiveRatio,s=t.x1*a+o.point.x,u=t.y1*a+o.point.y,l=t.x2*a+o.point.x,c=t.y2*a+o.point.y;return!this.isInsideGrid(s,u,l,c)||!e&&this.grid.hitTest(s,u,l,c,i)?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},he.prototype.placeCollisionCircles=function(e,n,r,i,o,a,s,u,l,c,h,p,f){var d=[],m=new t.Point(n.anchorX,n.anchorY),g=$t(m,a),y=te(this.transform.cameraToCenterDistance,g.signedDistanceFromCamera),v=(c?o/y:o*y)/t.ONE_EM,_=$t(m,s).point,x=re(v,i,n.lineOffsetX*v,n.lineOffsetY*v,!1,_,m,n,r,s,{}),b=!1,w=!1,S=!0;if(x){for(var E=.5*p*y+f,C=new t.Point(-100,-100),M=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),T=new Yt,A=x.first,P=x.last,L=[],I=A.path.length-1;I>=1;I--)L.push(A.path[I]);for(var k=1;k<P.path.length;k++)L.push(P.path[k]);var O=2.5*E;if(u){var R=L.map((function(t){return $t(t,u)}));L=R.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:R.map((function(t){return t.point}))}var D=[];if(L.length>0){for(var N=L[0].clone(),F=L[0].clone(),z=1;z<L.length;z++)N.x=Math.min(N.x,L[z].x),N.y=Math.min(N.y,L[z].y),F.x=Math.max(F.x,L[z].x),F.y=Math.max(F.y,L[z].y);D=N.x>=C.x&&F.x<=M.x&&N.y>=C.y&&F.y<=M.y?[L]:F.x<C.x||N.x>M.x||F.y<C.y||N.y>M.y?[]:t.clipLine([L],C.x,C.y,M.x,M.y)}for(var B=0,j=D;B<j.length;B+=1){var U;T.reset(j[B],.25*E),U=T.length<=.5*E?1:Math.ceil(T.paddedLength/O)+1;for(var Z=0;Z<U;Z++){var V=Z/Math.max(U-1,1),G=T.lerp(V),H=G.x+100,W=G.y+100;d.push(H,W,E,0);var q=H-E,X=W-E,Y=H+E,K=W+E;if(S=S&&this.isOffscreen(q,X,Y,K),w=w||this.isInsideGrid(q,X,Y,K),!e&&this.grid.hitTestCircle(H,W,E,h)&&(b=!0,!l))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!l&&b||!w?[]:d,offscreen:S,collisionDetected:b}},he.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var n=[],r=1/0,i=1/0,o=-1/0,a=-1/0,s=0,u=e;s<u.length;s+=1){var l=u[s],c=new t.Point(l.x+100,l.y+100);r=Math.min(r,c.x),i=Math.min(i,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y),n.push(c)}for(var h={},p={},f=0,d=this.grid.query(r,i,o,a).concat(this.ignoredGrid.query(r,i,o,a));f<d.length;f+=1){var m=d[f],g=m.key;if(void 0===h[g.bucketInstanceId]&&(h[g.bucketInstanceId]={}),!h[g.bucketInstanceId][g.featureIndex]){var y=[new t.Point(m.x1,m.y1),new t.Point(m.x2,m.y1),new t.Point(m.x2,m.y2),new t.Point(m.x1,m.y2)];t.polygonIntersectsPolygon(n,y)&&(h[g.bucketInstanceId][g.featureIndex]=!0,void 0===p[g.bucketInstanceId]&&(p[g.bucketInstanceId]=[]),p[g.bucketInstanceId].push(g.featureIndex))}}return p},he.prototype.insertCollisionBox=function(t,e,n,r,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},t[0],t[1],t[2],t[3])},he.prototype.insertCollisionCircles=function(t,e,n,r,i){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:r,collisionGroupID:i},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},he.prototype.projectAndGetPerspectiveRatio=function(e,n,r){var i=[n,r,0,1];return ce(i,i,e),{point:new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},he.prototype.isOffscreen=function(t,e,n,r){return n<100||t>=this.screenRightBoundary||r<100||e>this.screenBottomBoundary},he.prototype.isInsideGrid=function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary},he.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var fe=function(t,e,n,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&n?1:0,this.placed=n};fe.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var de=function(t,e,n,r,i){this.text=new fe(t?t.text:null,e,n,i),this.icon=new fe(t?t.icon:null,e,r,i)};de.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var me=function(t,e,n){this.text=t,this.icon=e,this.skipFade=n},ge=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},ye=function(t,e,n,r,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i},ve=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function _e(e,n,r,i,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*n,u=-(a.verticalAlign-.5)*r,l=t.evaluateVariableOffset(e,i);return new t.Point(s+l[0]*o,u+l[1]*o)}function xe(e,n,r,i,o,a){var s=e.x1,u=e.x2,l=e.y1,c=e.y2,h=e.anchorPointX,p=e.anchorPointY,f=new t.Point(n,r);return i&&f._rotate(o?a:-a),{x1:s+f.x,y1:l+f.y,x2:u+f.x,y2:c+f.y,anchorPointX:h,anchorPointY:p}}ve.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var be=function(t,e,n,r){this.transform=t.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new ve(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}};function we(t,e,n,r,i){t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0)}be.prototype.getBucketParts=function(e,n,r,i){var o=r.getBucket(n),a=r.latestFeatureIndex;if(o&&a&&n.id===o.layerIds[0]){var s=r.collisionBoxArray,u=o.layers[0].layout,l=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),p="map"===u.get("text-pitch-alignment"),f="map"===u.get("text-rotation-alignment"),d=pe(r,1,this.transform.zoom),m=Qt(h,p,f,this.transform,d),g=null;if(p){var y=Jt(h,p,f,this.transform,d);g=t.multiply([],this.transform.labelPlaneMatrix,y)}this.retainedQueryData[o.bucketInstanceId]=new ye(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID);var v={bucket:o,layout:u,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:l,textPixelRatio:c,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(var _=0,x=o.sortKeyRanges;_<x.length;_+=1){var b=x[_];e.push({sortKey:b.sortKey,symbolInstanceStart:b.symbolInstanceStart,symbolInstanceEnd:b.symbolInstanceEnd,parameters:v})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:v})}},be.prototype.attemptAnchorPlacement=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d){var m,g=[h.textOffset0,h.textOffset1],y=_e(t,n,r,g,i),v=this.collisionIndex.placeCollisionBox(xe(e,y.x,y.y,o,a,this.transform.angle),c,s,u,l.predicate);if(!d||0!==this.collisionIndex.placeCollisionBox(xe(d,y.x,y.y,o,a,this.transform.angle),c,s,u,l.predicate).box.length)return v.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(m=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:g,width:n,height:r,anchor:t,textBoxScale:i,prevAnchor:m},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:y,placedGlyphBoxes:v}):void 0},be.prototype.placeLayerBucketPart=function(e,n,r){var i=this,o=e.parameters,a=o.bucket,s=o.layout,u=o.posMatrix,l=o.textLabelPlaneMatrix,c=o.labelToScreenMatrix,h=o.textPixelRatio,p=o.holdingForFade,f=o.collisionBoxArray,d=o.partiallyEvaluatedTextSize,m=o.collisionGroup,g=s.get("text-optional"),y=s.get("icon-optional"),v=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),S="viewport-y"===s.get("symbol-z-order"),E=v&&(_||!a.hasIconData()||y),C=_&&(v||!a.hasTextData()||g);!a.collisionArrays&&f&&a.deserializeCollisionBoxes(f);var M=function(e,o){if(!n[e.crossTileID])if(p)i.placements[e.crossTileID]=new me(!1,!1,!1);else{var f,S=!1,M=!1,T=!0,A=null,P={box:null,offscreen:null},L={box:null,offscreen:null},I=null,k=null,O=0,R=0,D=0;o.textFeatureIndex?O=o.textFeatureIndex:e.useRuntimeCollisionCircles&&(O=e.featureIndex),o.verticalTextFeatureIndex&&(R=o.verticalTextFeatureIndex);var N=o.textBox;if(N){var F=function(n){var r=t.WritingMode.horizontal;if(a.allowVerticalPlacement&&!n&&i.prevPlacement){var o=i.prevPlacement.placedOrientations[e.crossTileID];o&&(i.placedOrientations[e.crossTileID]=o,i.markUsedOrientation(a,r=o,e))}return r},z=function(n,r){if(a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&o.verticalTextBox)for(var i=0,s=a.writingModes;i<s.length&&(s[i]===t.WritingMode.vertical?(P=r(),L=P):P=n(),!(P&&P.box&&P.box.length));i+=1);else P=n()};if(s.get("text-variable-anchor")){var B=s.get("text-variable-anchor");if(i.prevPlacement&&i.prevPlacement.variableOffsets[e.crossTileID]){var j=i.prevPlacement.variableOffsets[e.crossTileID];B.indexOf(j.anchor)>0&&(B=B.filter((function(t){return t!==j.anchor}))).unshift(j.anchor)}var U=function(t,n,r){for(var o=t.x2-t.x1,s=t.y2-t.y1,l=e.textBoxScale,c=w&&!_?n:null,p={box:[],offscreen:!1},f=v?2*B.length:B.length,d=0;d<f;++d){var g=i.attemptAnchorPlacement(B[d%B.length],t,o,s,l,x,b,h,u,m,d>=B.length,e,a,r,c);if(g&&(p=g.placedGlyphBoxes)&&p.box&&p.box.length){S=!0,A=g.shift;break}}return p};z((function(){return U(N,o.iconBox,t.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&!(P&&P.box&&P.box.length)&&e.numVerticalGlyphVertices>0&&n?U(n,o.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),P&&(S=P.box,T=P.offscreen);var Z=F(P&&P.box);if(!S&&i.prevPlacement){var V=i.prevPlacement.variableOffsets[e.crossTileID];V&&(i.variableOffsets[e.crossTileID]=V,i.markUsedJustification(a,V.anchor,e,Z))}}else{var G=function(t,n){var r=i.collisionIndex.placeCollisionBox(t,v,h,u,m.predicate);return r&&r.box&&r.box.length&&(i.markUsedOrientation(a,n,e),i.placedOrientations[e.crossTileID]=n),r};z((function(){return G(N,t.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?G(n,t.WritingMode.vertical):{box:null,offscreen:null}})),F(P&&P.box&&P.box.length)}}if(S=(f=P)&&f.box&&f.box.length>0,T=f&&f.offscreen,e.useRuntimeCollisionCircles){var H=a.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),W=t.evaluateSizeForFeature(a.textSizeData,d,H),q=s.get("text-padding");I=i.collisionIndex.placeCollisionCircles(v,H,a.lineVertexArray,a.glyphOffsetArray,W,u,l,c,r,b,m.predicate,e.collisionCircleDiameter,q),S=v||I.circles.length>0&&!I.collisionDetected,T=T&&I.offscreen}if(o.iconFeatureIndex&&(D=o.iconFeatureIndex),o.iconBox){var X=function(t){var e=w&&A?xe(t,A.x,A.y,x,b,i.transform.angle):t;return i.collisionIndex.placeCollisionBox(e,_,h,u,m.predicate)};M=L&&L.box&&L.box.length&&o.verticalIconBox?(k=X(o.verticalIconBox)).box.length>0:(k=X(o.iconBox)).box.length>0,T=T&&k.offscreen}var Y=g||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,K=y||0===e.numIconVertices;if(Y||K?K?Y||(M=M&&S):S=M&&S:M=S=M&&S,S&&f&&f.box&&i.collisionIndex.insertCollisionBox(f.box,s.get("text-ignore-placement"),a.bucketInstanceId,L&&L.box&&R?R:O,m.ID),M&&k&&i.collisionIndex.insertCollisionBox(k.box,s.get("icon-ignore-placement"),a.bucketInstanceId,D,m.ID),I&&(S&&i.collisionIndex.insertCollisionCircles(I.circles,s.get("text-ignore-placement"),a.bucketInstanceId,O,m.ID),r)){var Q=a.bucketInstanceId,J=i.collisionCircleArrays[Q];void 0===J&&(J=i.collisionCircleArrays[Q]=new ge);for(var $=0;$<I.circles.length;$+=4)J.circles.push(I.circles[$+0]),J.circles.push(I.circles[$+1]),J.circles.push(I.circles[$+2]),J.circles.push(I.collisionDetected?1:0)}i.placements[e.crossTileID]=new me(S||E,M||C,T||a.justReloaded),n[e.crossTileID]=!0}};if(S)for(var T=a.getSortedSymbolIndexes(this.transform.angle),A=T.length-1;A>=0;--A){var P=T[A];M(a.symbolInstances.get(P),a.collisionArrays[P])}else for(var L=e.symbolInstanceStart;L<e.symbolInstanceEnd;L++)M(a.symbolInstances.get(L),a.collisionArrays[L]);if(r&&a.bucketInstanceId in this.collisionCircleArrays){var I=this.collisionCircleArrays[a.bucketInstanceId];t.invert(I.invProjMatrix,u),I.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1},be.prototype.markUsedJustification=function(e,n,r,i){var o;o=i===t.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(n)];for(var a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];a<s.length;a+=1){var u=s[a];u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=o>=0&&u!==o?0:r.crossTileID)}},be.prototype.markUsedOrientation=function(e,n,r){for(var i=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,o=n===t.WritingMode.vertical?n:0,a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];a<s.length;a+=1)e.text.placedSymbolArray.get(s[a]).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)},be.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var r=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],l=i[s];l?(this.opacities[s]=new de(l,r,u.text,u.icon),n=n||u.text!==l.text.placed||u.icon!==l.icon.placed):(this.opacities[s]=new de(null,r,u.text,u.icon,u.skipFade),n=n||u.text||u.icon)}for(var c in i){var h=i[c];if(!this.opacities[c]){var p=new de(h,r,!1,!1);p.isHidden()||(this.opacities[c]=p,n=n||h.text.placed||h.icon.placed)}}for(var f in o)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=o[f]);for(var d in a)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=a[d]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},be.prototype.updateLayerOpacities=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1){var o=i[r],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,n,o.collisionBoxArray)}},be.prototype.updateBucketOpacities=function(e,n,r){var i=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var o=e.layers[0].layout,a=new de(null,0,!1,!1,!0),s=o.get("text-allow-overlap"),u=o.get("icon-allow-overlap"),l=o.get("text-variable-anchor"),c="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),p="none"!==o.get("icon-text-fit"),f=new de(null,0,s&&(u||!e.hasIconData()||o.get("icon-optional")),u&&(s||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);for(var d=function(t,e,n){for(var r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(n)},m=function(r){var o=e.symbolInstances.get(r),s=o.numHorizontalGlyphVertices,u=o.numVerticalGlyphVertices,m=o.crossTileID,g=i.opacities[m];n[m]?g=a:g||(i.opacities[m]=g=f),n[m]=!0;var y=o.numIconVertices>0,v=i.placedOrientations[o.crossTileID],_=v===t.WritingMode.vertical,x=v===t.WritingMode.horizontal||v===t.WritingMode.horizontalOnly;if(s>0||u>0){var b=Le(g.text);d(e.text,s,_?Ie:b),d(e.text,u,x?Ie:b);var w=g.text.isHidden();[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=w||_?1:0)})),o.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).hidden=w||x?1:0);var S=i.variableOffsets[o.crossTileID];S&&i.markUsedJustification(e,S.anchor,o,v);var E=i.placedOrientations[o.crossTileID];E&&(i.markUsedJustification(e,"left",o,E),i.markUsedOrientation(e,E,o))}if(y){var C=Le(g.icon),M=!(p&&o.verticalPlacedIconSymbolIndex&&_);o.placedIconSymbolIndex>=0&&(d(e.icon,o.numIconVertices,M?C:Ie),e.icon.placedSymbolArray.get(o.placedIconSymbolIndex).hidden=g.icon.isHidden()),o.verticalPlacedIconSymbolIndex>=0&&(d(e.icon,o.numVerticalIconVertices,M?Ie:C),e.icon.placedSymbolArray.get(o.verticalPlacedIconSymbolIndex).hidden=g.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var T=e.collisionArrays[r];if(T){var A=new t.Point(0,0);if(T.textBox||T.verticalTextBox){var P=!0;if(l){var L=i.variableOffsets[m];L?(A=_e(L.anchor,L.width,L.height,L.textOffset,L.textBoxScale),c&&A._rotate(h?i.transform.angle:-i.transform.angle)):P=!1}T.textBox&&we(e.textCollisionBox.collisionVertexArray,g.text.placed,!P||_,A.x,A.y),T.verticalTextBox&&we(e.textCollisionBox.collisionVertexArray,g.text.placed,!P||x,A.x,A.y)}var I=Boolean(!x&&T.verticalIconBox);T.iconBox&&we(e.iconCollisionBox.collisionVertexArray,g.icon.placed,I,p?A.x:0,p?A.y:0),T.verticalIconBox&&we(e.iconCollisionBox.collisionVertexArray,g.icon.placed,!I,p?A.x:0,p?A.y:0)}}},g=0;g<e.symbolInstances.length;g++)m(g);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var y=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=y.invProjMatrix,e.placementViewportMatrix=y.viewportMatrix,e.collisionCircleArray=y.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},be.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},be.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},be.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},be.prototype.stillRecent=function(t,e){var n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t},be.prototype.setStale=function(){this.stale=!0};var Se=Math.pow(2,25),Ee=Math.pow(2,24),Ce=Math.pow(2,17),Me=Math.pow(2,16),Te=Math.pow(2,9),Ae=Math.pow(2,8),Pe=Math.pow(2,1);function Le(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*Se+e*Ee+n*Ce+e*Me+n*Te+e*Ae+n*Pe+e}var Ie=0,ke=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ke.prototype.continuePlacement=function(t,e,n,r,i){for(var o=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1};var Oe=function(t,e,n,r,i,o,a){this.placement=new be(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1};Oe.prototype.isDone=function(){return this._done},Oe.prototype.continuePlacement=function(e,n,r){for(var i=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!i._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=n[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new ke(s)),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Oe.prototype.commit=function(t){return this.placement.commit(t),this.placement};var Re=512/t.EXTENT/2,De=function(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var r=0;r<e.length;r++){var i=e.get(r),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}};De.prototype.getScaledCoordinates=function(e,n){var r=Re/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*r),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*r)}},De.prototype.findMatches=function(t,e,n){for(var r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var o=t.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),u=0,l=a;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=r&&Math.abs(c.coord.y-s.y)<=r&&!n[c.crossTileID]){n[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var Ne=function(){this.maxCrossTileID=0};Ne.prototype.generate=function(){return++this.maxCrossTileID};var Fe=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Fe.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var n in this.indexes){var r=this.indexes[n],i={};for(var o in r){var a=r[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),i[a.tileID.key]=a}this.indexes[n]=i}this.lng=t},Fe.prototype.addBucket=function(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var u=a[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,i)}else{var l=a[t.scaledTo(Number(o)).key];l&&l.findMatches(e.symbolInstances,t,i)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=n.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new De(t,e.symbolInstances,e.bucketInstanceId),!0},Fe.prototype.removeBucketCrossTileIDs=function(t,e){for(var n in e.indexedSymbolInstances)for(var r=0,i=e.indexedSymbolInstances[n];r<i.length;r+=1)delete this.usedCrossTileIDs[t][i[r].crossTileID]},Fe.prototype.removeStaleBuckets=function(t){var e=!1;for(var n in this.indexes){var r=this.indexes[n];for(var i in r)t[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],e=!0)}return e};var ze=function(){this.layerIndexes={},this.crossTileIDs=new Ne,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ze.prototype.addLayer=function(t,e,n){var r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new Fe);var i=!1,o={};r.handleWrapJump(n);for(var a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(u.tileID,l,this.crossTileIDs)&&(i=!0),o[l.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(i=!0),i},ze.prototype.pruneUnusedLayers=function(t){var e={};for(var n in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[n]||delete this.layerIndexes[n]};var Be=function(e,n){return t.emitValidationErrors(e,n&&n.filter((function(t){return"source.canvas"!==t.identifier})))},je=t.pick(Ut,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ue=t.pick(Ut,["setCenter","setZoom","setBearing","setPitch"]),Ze=function(){var e={},n=t.styleSpec.$version;for(var r in t.styleSpec.$root){var i,o=t.styleSpec.$root[r];o.required&&null!=(i="version"===r?n:"array"===o.type?[]:{})&&(e[r]=i)}return e}(),Ve=function(e){function n(r,i){var o=this;void 0===i&&(i={}),e.call(this),this.map=r,this.dispatcher=new E(zt(),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new _(r._requestManager,i.localIdeographFontFamily),this.lineAtlas=new S(256,512),this.crossTileSymbolIndex=new ze,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=n.registerForPluginStateChange((function(e){a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,n){if(t.triggerPluginCompletionEvent(e),n&&n.every((function(t){return t})))for(var r in a.sourceCaches)a.sourceCaches[r].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var n=e.getSource();if(n&&n.vectorLayerIds)for(var r in o._layers){var i=o._layers[r];i.source===n.id&&o._validateLayer(i)}}}}))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadURL=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,(function(e,n){r._request=null,e?r.fire(new t.ErrorEvent(e)):n&&r._load(n,i)}))},n.prototype.loadJSON=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){r._request=null,r._load(e,!1!==n.validate)}))},n.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ze,!1)},n.prototype._load=function(e,n){if(!n||!Be(this,t.validateStyle(e))){for(var r in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(r,e.sources[r],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var i=jt(this.stylesheet.layers);this._order=i.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var o=0,a=i;o<a.length;o+=1){var s=a[o];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},n.prototype._loadSprite=function(e){var n=this;this._spriteRequest=function(e,n,r){var i,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){u=null,a||(a=t,i=e,c())})),l=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){l=null,a||(a=t,o=e,c())}));function c(){if(a)r(a);else if(i&&o){var e=t.browser.getImageData(o),n={};for(var s in i){var u=i[s],l=u.width,c=u.height,h=u.x,p=u.y,f=u.sdf,d=u.pixelRatio,m=u.stretchX,g=u.stretchY,y=u.content,v=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,v,{x:h,y:p},{x:0,y:0},{width:l,height:c}),n[s]={data:v,pixelRatio:d,sdf:f,stretchX:m,stretchY:g,content:y}}r(null,n)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,(function(e,r){if(n._spriteRequest=null,e)n.fire(new t.ErrorEvent(e));else if(r)for(var i in r)n.imageManager.addImage(i,r[i]);n.imageManager.setLoaded(!0),n._availableImages=n.imageManager.listImages(),n.dispatcher.broadcast("setImages",n._availableImages),n.fire(new t.Event("data",{dataType:"style"}))}))},n.prototype._validateLayer=function(e){var n=this.sourceCaches[e.source];if(n){var r=e.sourceLayer;if(r){var i=n.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')))}}},n.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=this._layers[r[n]];"custom"!==i.type&&e.push(i.serialize())}return e},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},n.prototype.update=function(e){if(this._loaded){var n=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var o in(r.length||i.length)&&this._updateWorkerLayers(r,i),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}var u={};for(var l in this.sourceCaches){var c=this.sourceCaches[l];u[l]=c.used,c.used=!1}for(var h=0,p=this._order;h<p.length;h+=1){var f=this._layers[p[h]];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(var d in u){var m=this.sourceCaches[d];u[d]!==m.used&&m.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}},n.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},n.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},n.prototype.setState=function(e){var n=this;if(this._checkLoaded(),Be(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=jt(e.layers);var r=function(e,n){if(!e)return[{command:Ut.setStyle,args:[n]}];var r=[];try{if(!t.deepEqual(e.version,n.version))return[{command:Ut.setStyle,args:[n]}];t.deepEqual(e.center,n.center)||r.push({command:Ut.setCenter,args:[n.center]}),t.deepEqual(e.zoom,n.zoom)||r.push({command:Ut.setZoom,args:[n.zoom]}),t.deepEqual(e.bearing,n.bearing)||r.push({command:Ut.setBearing,args:[n.bearing]}),t.deepEqual(e.pitch,n.pitch)||r.push({command:Ut.setPitch,args:[n.pitch]}),t.deepEqual(e.sprite,n.sprite)||r.push({command:Ut.setSprite,args:[n.sprite]}),t.deepEqual(e.glyphs,n.glyphs)||r.push({command:Ut.setGlyphs,args:[n.glyphs]}),t.deepEqual(e.transition,n.transition)||r.push({command:Ut.setTransition,args:[n.transition]}),t.deepEqual(e.light,n.light)||r.push({command:Ut.setLight,args:[n.light]});var i={},o=[];!function(e,n,r,i){var o;for(o in n=n||{},e=e||{})e.hasOwnProperty(o)&&(n.hasOwnProperty(o)||Vt(o,r,i));for(o in n)n.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],n[o])||("geojson"===e[o].type&&"geojson"===n[o].type&&Ht(e,n,o)?r.push({command:Ut.setGeoJSONSourceData,args:[o,n[o].data]}):Gt(o,n,r,i)):Zt(o,n,r))}(e.sources,n.sources,o,i);var a=[];e.layers&&e.layers.forEach((function(t){i[t.source]?r.push({command:Ut.removeLayer,args:[t.id]}):a.push(t)})),r=r.concat(o),function(e,n,r){n=n||[];var i,o,a,s,u,l,c,h=(e=e||[]).map(qt),p=n.map(qt),f=e.reduce(Xt,{}),d=n.reduce(Xt,{}),m=h.slice(),g=Object.create(null);for(i=0,o=0;i<h.length;i++)d.hasOwnProperty(a=h[i])?o++:(r.push({command:Ut.removeLayer,args:[a]}),m.splice(m.indexOf(a,o),1));for(i=0,o=0;i<p.length;i++)m[m.length-1-i]!==(a=p[p.length-1-i])&&(f.hasOwnProperty(a)?(r.push({command:Ut.removeLayer,args:[a]}),m.splice(m.lastIndexOf(a,m.length-o),1)):o++,r.push({command:Ut.addLayer,args:[d[a],l=m[m.length-i]]}),m.splice(m.length-i,0,a),g[a]=!0);for(i=0;i<p.length;i++)if(s=f[a=p[i]],u=d[a],!g[a]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(c in Wt(s.layout,u.layout,r,a,null,Ut.setLayoutProperty),Wt(s.paint,u.paint,r,a,null,Ut.setPaintProperty),t.deepEqual(s.filter,u.filter)||r.push({command:Ut.setFilter,args:[a,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||r.push({command:Ut.setLayerZoomRange,args:[a,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Wt(s[c],u[c],r,a,c.slice(6),Ut.setPaintProperty):t.deepEqual(s[c],u[c])||r.push({command:Ut.setLayerProperty,args:[a,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Wt(s[c],u[c],r,a,c.slice(6),Ut.setPaintProperty):t.deepEqual(s[c],u[c])||r.push({command:Ut.setLayerProperty,args:[a,c,u[c]]}))}else r.push({command:Ut.removeLayer,args:[a]}),l=m[m.lastIndexOf(a)+1],r.push({command:Ut.addLayer,args:[u,l]})}(a,n.layers,r)}catch(t){console.warn("Unable to compute style diff:",t),r=[{command:Ut.setStyle,args:[n]}]}return r}(this.serialize(),e).filter((function(t){return!(t.command in Ue)}));if(0===r.length)return!1;var i=r.filter((function(t){return!(t.command in je)}));if(i.length>0)throw new Error("Unimplemented: "+i.map((function(t){return t.command})).join(", ")+".");return r.forEach((function(t){"setTransition"!==t.command&&n[t.command].apply(n,t.args)})),this.stylesheet=e,!0},n.prototype.addImage=function(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this._afterImageUpdated(e)},n.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},n.prototype.getImage=function(t){return this.imageManager.getImage(t)},n.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},n.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(e,n,r){var i=this;if(void 0===r&&(r={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(n).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,n,null,r))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var o=this.sourceCaches[e]=new Lt(e,n,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:i.loaded(),source:o.serialize(),sourceId:e}})),o.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var n in this._layers)if(this._layers[n].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+n+'" is using it.')));var r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},n.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},n.prototype.addLayer=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=e.id;if(this.getLayer(i))this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var o;if("custom"===e.type){if(Be(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},r))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[o.id]=o.serialize()}var a=n?this._order.indexOf(n):this._order.length;if(n&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.')));else{if(this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o,this._removedLayers[i]&&o.source&&"custom"!==o.type){var s=this._removedLayers[i];delete this._removedLayers[i],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},n.prototype.moveLayer=function(e,n){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==n){var r=this._order.indexOf(e);this._order.splice(r,1);var i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.'))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},n.prototype.removeLayer=function(e){this._checkLoaded();var n=this._layers[e];if(n){n.setEventedParent(null);var r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},n.prototype.getLayer=function(t){return this._layers[t]},n.prototype.hasLayer=function(t){return t in this._layers},n.prototype.setLayerZoomRange=function(e,n,r){this._checkLoaded();var i=this.getLayer(e);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},n.prototype.setFilter=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,n))return null==n?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,"layers."+i.id+".filter",n,null,r)||(i.filter=t.clone$1(n),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},n.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},n.prototype.setLayoutProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(n),r)||(o.setLayoutProperty(n,r,i),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getLayoutProperty=function(e,n){var r=this.getLayer(e);if(r)return r.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},n.prototype.setPaintProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(n),r)||(o.setPaintProperty(n,r,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},n.prototype.setFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=e.sourceLayer,o=this.sourceCaches[r];if(void 0!==o){var a=o.getSource().type;"geojson"===a&&i?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==a||i?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),o.setFeatureState(i,e.id,n)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.removeFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=this.sourceCaches[r];if(void 0!==i){var o=i.getSource().type,a="vector"===o?e.sourceLayer:void 0;"vector"!==o||a?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):i.removeFeatureState(a,e.id,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.getFeatureState=function(e){this._checkLoaded();var n=e.source,r=e.sourceLayer,i=this.sourceCaches[n];if(void 0!==i){if("vector"!==i.getSource().type||r)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),i.getFeatureState(r,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},n.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},n.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,n=function(t){return"fill-extrusion"===e._layers[t].type},r={},i=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(n(a)){r[a]=o;for(var s=0,u=t;s<u.length;s+=1){var l=u[s][a];if(l)for(var c=0,h=l;c<h.length;c+=1)i.push(h[c])}}}i.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var p=[],f=this._order.length-1;f>=0;f--){var d=this._order[f];if(n(d))for(var m=i.length-1;m>=0;m--){var g=i[m].feature;if(r[g.layer.id]<f)break;p.push(g),i.pop()}else for(var y=0,v=t;y<v.length;y+=1){var _=v[y][d];if(_)for(var x=0,b=_;x<b.length;x+=1)p.push(b[x].feature)}}return p},n.prototype.queryRenderedFeatures=function(e,n,r){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);var i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=n.layers;o<a.length;o+=1){var s=a[o],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[u.source]=!0}}var l=[];for(var c in n.availableImages=this._availableImages,this.sourceCaches)n.layers&&!i[c]||l.push(F(this.sourceCaches[c],this._layers,this._serializedLayers,e,n,r));return this.placement&&l.push(function(t,e,n,r,i,o,a){for(var s={},u=o.queryRenderedSymbols(r),l=[],c=0,h=Object.keys(u).map(Number);c<h.length;c+=1)l.push(a[h[c]]);l.sort(z);for(var p=function(){var n=d[f],r=n.featureIndex.lookupSymbolFeatures(u[n.bucketInstanceId],e,n.bucketIndex,n.sourceLayerIndex,i.filter,i.layers,i.availableImages,t);for(var o in r){var a=s[o]=s[o]||[],l=r[o];l.sort((function(t,e){var r=n.featureSortOrder;if(r){var i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(var c=0,h=l;c<h.length;c+=1)a.push(h[c])}},f=0,d=l;f<d.length;f+=1)p();var m=function(e){s[e].forEach((function(r){var i=r.feature,o=n[t[e].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}))};for(var g in s)m(g);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},n.prototype.querySourceFeatures=function(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);var r=this.sourceCaches[e];return r?function(t,e){for(var n=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),r=[],i={},o=0;o<n.length;o++){var a=n[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(r,e))}return r}(r,n):[]},n.prototype.addSourceType=function(t,e,r){return n.getSourceType(t)?r(new Error('A source type called "'+t+'" already exists.')):(n.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},r):r(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(e,n){void 0===n&&(n={}),this._checkLoaded();var r=this.light.getLight(),i=!1;for(var o in e)if(!t.deepEqual(e[o],r[o])){i=!0;break}if(i){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(a)}},n.prototype._validate=function(e,n,r,i,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&Be(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:r,styleSpec:t.styleSpec},i)))},n.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var n in this.sourceCaches)this.sourceCaches[n].clearTiles(),this.sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},n.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},n.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},n.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},n.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},n.prototype._updatePlacement=function(e,n,r,i,o){void 0===o&&(o=!1);for(var a=!1,s=!1,u={},l=0,c=this._order;l<c.length;l+=1){var h=this._layers[c[l]];if("symbol"===h.type){if(!u[h.source]){var p=this.sourceCaches[h.source];u[h.source]=p.getRenderableIds(!0).map((function(t){return p.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var f=this.crossTileSymbolIndex.addLayer(h,u[h.source],e.center.lng);a=a||f}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Oe(e,this._order,o,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,u),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(var d=0,m=this._order;d<m.length;d+=1){var g=this._layers[m[d]];"symbol"===g.type&&this.placement.updateLayerOpacities(g,u[g.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},n.prototype.getImages=function(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();var r=this.sourceCaches[e.source];r&&r.setDependencies(e.tileID.key,e.type,e.icons)},n.prototype.getGlyphs=function(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)},n.prototype.getResource=function(e,n,r){return t.makeRequest(n,r)},n}(t.Evented);Ve.getSourceType=function(t){return D[t]},Ve.setSourceType=function(t,e){D[t]=e},Ve.registerForPluginStateChange=t.registerForPluginStateChange;var Ge=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),He=vn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),We=vn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),qe=vn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Xe=vn("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ye=vn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ke=vn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Qe=vn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Je=vn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),$e=vn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),tn=vn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),en=vn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),nn=vn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),rn=vn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),on=vn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),an=vn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),sn=vn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),un=vn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ln=vn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cn=vn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hn=vn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),pn=vn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),fn=vn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),dn=vn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),mn=vn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),gn=vn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),yn=vn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function vn(t,e){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/attribute ([\w]+) ([\w]+)/g),i=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=o?o.concat(i):i,s={};return{fragmentSource:t=t.replace(n,(function(t,e,n,r,i){return s[i]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),vertexSource:e=e.replace(n,(function(t,e,n,r,i){var o="float"===r?"vec2":"vec4",a=i.match(/color/)?"color":o;return s[i]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),staticAttributes:r,staticUniforms:a}}var _n=Object.freeze({__proto__:null,prelude:He,background:We,backgroundPattern:qe,circle:Xe,clippingMask:Ye,heatmap:Ke,heatmapTexture:Qe,collisionBox:Je,collisionCircle:$e,debug:tn,fill:en,fillOutline:nn,fillOutlinePattern:rn,fillPattern:on,fillExtrusion:an,fillExtrusionPattern:sn,hillshadePrepare:un,hillshade:ln,line:cn,lineGradient:hn,linePattern:pn,lineSDF:fn,raster:dn,symbolIcon:mn,symbolSDF:gn,symbolTextAndIcon:yn}),xn=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function bn(t){for(var e=[],n=0;n<t.length;n++)if(null!==t[n]){var r=t[n].split(" ");e.push(r.pop())}return e}xn.prototype.bind=function(t,e,n,r,i,o,a,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==r.length,l=0;!u&&l<r.length;l++)this.boundPaintVertexBuffers[l]!==r[l]&&(u=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===n&&!u&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(e,n,r,i,o,a,s)},xn.prototype.freshBind=function(t,e,n,r,i,o,a){var s,u=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=l.currentNumAttributes||0;for(var h=u;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,f=n;p<f.length;p+=1)f[p].enableAttributes(c,t);o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,i);for(var d=0,m=n;d<m.length;d+=1){var g=m[d];g.bind(),g.setVertexAttribPointers(c,t,i)}o&&(o.bind(),o.setVertexAttribPointers(c,t,i)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,i)),l.currentNumAttributes=u},xn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var wn=function(t,e,n,r,i,o){var a=t.gl;this.program=a.createProgram();for(var s=bn(n.staticAttributes),u=r?r.getBinderAttributes():[],l=s.concat(u),c=n.staticUniforms?bn(n.staticUniforms):[],h=r?r.getBinderUniforms():[],p=[],f=0,d=c.concat(h);f<d.length;f+=1){var m=d[f];p.indexOf(m)<0&&p.push(m)}var g=r?r.defines():[];o&&g.push("#define OVERDRAW_INSPECTOR;");var y=g.concat(He.fragmentSource,n.fragmentSource).join("\n"),v=g.concat(He.vertexSource,n.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(_,y),a.compileShader(_),a.attachShader(this.program,_);var x=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(x,v),a.compileShader(x),a.attachShader(this.program,x),this.attributes={};var b={};this.numAttributes=l.length;for(var w=0;w<this.numAttributes;w++)l[w]&&(a.bindAttribLocation(this.program,w,l[w]),this.attributes[l[w]]=w);a.linkProgram(this.program),a.deleteShader(x),a.deleteShader(_);for(var S=0;S<p.length;S++){var E=p[S];if(E&&!b[E]){var C=a.getUniformLocation(this.program,E);C&&(b[E]=C)}}this.fixedUniforms=i(t,b),this.binderUniforms=r?r.getUniforms(t,b):[]}}};function Sn(t,e,n){var r=1/pe(n,1,e.transform.tileZoom),i=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,e.transform.tileZoom)/i,a=o*(n.tileID.canonical.x+n.tileID.wrap*i),s=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}wn.prototype.draw=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m){var g,y=t.gl;if(!this.failedToCreate){for(var v in t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(r),t.setColorMode(i),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[v].set(a[v]);f&&f.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var _=(g={},g[y.LINES]=2,g[y.TRIANGLES]=3,g[y.LINE_STRIP]=1,g)[e],x=0,b=c.get();x<b.length;x+=1){var w=b[x],S=w.vaos||(w.vaos={});(S[s]||(S[s]=new xn)).bind(t,this,u,f?f.getPaintVertexBuffers():[],l,w.vertexOffset,d,m),y.drawElements(e,w.primitiveLength*_,y.UNSIGNED_SHORT,w.primitiveOffset*_*2)}}};var En=function(e,n,r,i){var o=n.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],u=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(u,-n.transform.angle),t.transformMat3(s,s,u);var l=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+r,u_opacity:i}},Cn=function(e,n,r,i,o,a,s){return t.extend(En(e,n,r,i),Sn(a,n,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},Mn=function(t){return{u_matrix:t}},Tn=function(e,n,r,i){return t.extend(Mn(e),Sn(r,n,i))},An=function(t,e){return{u_matrix:t,u_world:e}},Pn=function(e,n,r,i,o){return t.extend(Tn(e,n,r,i),{u_world:o})},Ln=function(e,n,r,i){var o,a,s=e.transform;if("map"===i.paint.get("circle-pitch-alignment")){var u=pe(r,1,s.zoom);o=!0,a=[u,u]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(n.posMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},In=function(t,e,n){var r=pe(n,1,e.zoom),i=Math.pow(2,e.zoom-n.tileID.overscaledZ),o=n.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[e.pixelsToGLUnits[0]/(r*i),e.pixelsToGLUnits[1]/(r*i)],u_overscale_factor:o}},kn=function(t,e,n){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}},On=function(t,e,n){return void 0===n&&(n=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}},Rn=function(t){return{u_matrix:t}},Dn=function(t,e,n,r){return{u_matrix:t,u_extrude_scale:pe(e,1,n),u_intensity:r}},Nn=function(e,n,r){var i=e.transform;return{u_matrix:Un(e,n,r),u_ratio:1/pe(n,1,i.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},Fn=function(e,n,r,i){return t.extend(Nn(e,n,r),{u_image:0,u_image_height:i})},zn=function(e,n,r,i){var o=e.transform,a=jn(n,o);return{u_matrix:Un(e,n,r),u_texsize:n.imageAtlasTexture.size,u_ratio:1/pe(n,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[a,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Bn=function(e,n,r,i,o){var a=e.lineAtlas,s=jn(n,e.transform),u="round"===r.layout.get("line-cap"),l=a.getDash(i.from,u),c=a.getDash(i.to,u),h=l.width*o.fromScale,p=c.width*o.toScale;return t.extend(Nn(e,n,r),{u_patternscale_a:[s/h,-l.height/2],u_patternscale_b:[s/p,-c.height/2],u_sdfgamma:a.width/(256*Math.min(h,p)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:l.y,u_tex_y_b:c.y,u_mix:o.t})};function jn(t,e){return 1/pe(t,1,e.tileZoom)}function Un(t,e,n){return t.translatePosMatrix(e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Zn=function(t,e,n,r,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Vn(i.paint.get("raster-hue-rotate"))};var o,a};function Vn(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}var Gn,Hn=function(t,e,n,r,i,o,a,s,u,l){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+r,u_texsize:l,u_texture:0}},Wn=function(e,n,r,i,o,a,s,u,l,c,h){var p=o.transform;return t.extend(Hn(e,n,r,i,o,a,s,u,l,c),{u_gamma_scale:i?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},qn=function(e,n,r,i,o,a,s,u,l,c){return t.extend(Wn(e,n,r,i,o,a,s,u,!0,l,!0),{u_texsize_icon:c,u_texture_icon:1})},Xn=function(t,e,n){return{u_matrix:t,u_opacity:e,u_color:n}},Yn=function(e,n,r,i,o,a){return t.extend(function(t,e,n,r){var i=n.imageManager.getPattern(t.from.toString()),o=n.imageManager.getPattern(t.to.toString()),a=n.imageManager.getPixelSize(),s=a.width,u=a.height,l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,n.transform.tileZoom)/l,h=c*(r.tileID.canonical.x+r.tileID.wrap*l),p=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/pe(r,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(i,a,r,o),{u_matrix:e,u_opacity:n})},Kn={fillExtrusion:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fillExtrusionPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fill:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},fillPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},fillOutline:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}},fillOutlinePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},circle:function(e,n){return{u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,n.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},collisionBox:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,n.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,n.u_overscale_factor)}},collisionCircle:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,n.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,n.u_viewport_size)}},debug:function(e,n){return{u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_overlay:new t.Uniform1i(e,n.u_overlay),u_overlay_scale:new t.Uniform1f(e,n.u_overlay_scale)}},clippingMask:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmap:function(e,n){return{u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmapTexture:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}},hillshade:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}},hillshadePrepare:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}},line:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels)}},lineGradient:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image),u_image_height:new t.Uniform1f(e,n.u_image_height)}},linePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},lineSDF:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}},raster:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}},symbolIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}},symbolSDF:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},symbolTextAndIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},background:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}},backgroundPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}}};function Qn(e,n,r,i,o,a,s){for(var u=e.context,l=u.gl,c=e.useProgram("collisionBox"),h=[],p=0,f=0,d=0;d<i.length;d++){var m=i[d],g=n.getTile(m),y=g.getBucket(r);if(y){var v=m.posMatrix;0===o[0]&&0===o[1]||(v=e.translatePosMatrix(m.posMatrix,g,o,a));var _=s?y.textCollisionBox:y.iconCollisionBox,x=y.collisionCircleArray;if(x.length>0){var b=t.create(),w=v;t.mul(b,y.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(b,b,y.placementViewportMatrix),h.push({circleArray:x,circleOffset:f,transform:w,invTransform:b}),f=p+=x.length/4}_&&c.draw(u,l.LINES,Ct.disabled,Mt.disabled,e.colorModeForRenderPass(),At.disabled,In(v,e.transform,g),r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,null,_.collisionVertexBuffer)}}if(s&&h.length){var S=e.useProgram("collisionCircle"),E=new t.StructArrayLayout2f1f2i16;E.resize(4*p),E._trim();for(var C=0,M=0,T=h;M<T.length;M+=1)for(var A=T[M],P=0;P<A.circleArray.length/4;P++){var L=4*P,I=A.circleArray[L+0],k=A.circleArray[L+1],O=A.circleArray[L+2],R=A.circleArray[L+3];E.emplace(C++,I,k,O,R,0),E.emplace(C++,I,k,O,R,1),E.emplace(C++,I,k,O,R,2),E.emplace(C++,I,k,O,R,3)}(!Gn||Gn.length<2*p)&&(Gn=function(e){var n=2*e,r=new t.StructArrayLayout3ui6;r.resize(n),r._trim();for(var i=0;i<n;i++){var o=6*i;r.uint16[o+0]=4*i+0,r.uint16[o+1]=4*i+1,r.uint16[o+2]=4*i+2,r.uint16[o+3]=4*i+2,r.uint16[o+4]=4*i+3,r.uint16[o+5]=4*i+0}return r}(p));for(var D=u.createIndexBuffer(Gn,!0),N=u.createVertexBuffer(E,t.collisionCircleLayout.members,!0),F=0,z=h;F<z.length;F+=1){var B=z[F],j=kn(B.transform,B.invTransform,e.transform);S.draw(u,l.TRIANGLES,Ct.disabled,Mt.disabled,e.colorModeForRenderPass(),At.disabled,j,r.id,N,D,t.SegmentVector.simpleSegment(0,2*B.circleOffset,B.circleArray.length,B.circleArray.length/2),null,e.transform.zoom,null,null,null)}N.destroy(),D.destroy()}}var Jn=t.identity(new Float32Array(16));function $n(e,n,r,i,o,a){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*n,l=-(s.verticalAlign-.5)*r,c=t.evaluateVariableOffset(e,i);return new t.Point((u/o+c[0])*a,(l/o+c[1])*a)}function tr(e,n,r,i,o,a,s,u,l,c,h){var p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,d=e.icon.dynamicLayoutVertexArray,m={};f.clear();for(var g=0;g<p.length;g++){var y=p.get(g),v=y.hidden||!y.crossTileID||e.allowVerticalPlacement&&!y.placedOrientation?null:i[y.crossTileID];if(v){var _=new t.Point(y.anchorX,y.anchorY),x=$t(_,r?u:s),b=te(a.cameraToCenterDistance,x.signedDistanceFromCamera),w=o.evaluateSizeForFeature(e.textSizeData,c,y)*b/t.ONE_EM;r&&(w*=e.tilePixelRatio/l);for(var S=$n(v.anchor,v.width,v.height,v.textOffset,v.textBoxScale,w),E=r?$t(_.add(S),s).point:x.point.add(n?S.rotate(-a.angle):S),C=e.allowVerticalPlacement&&y.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,M=0;M<y.numGlyphs;M++)t.addDynamicAttributes(f,E,C);h&&y.associatedIconIndex>=0&&(m[y.associatedIconIndex]={shiftedAnchor:E,angle:C})}else le(y.numGlyphs,f)}if(h){d.clear();for(var T=e.icon.placedSymbolArray,A=0;A<T.length;A++){var P=T.get(A);if(P.hidden)le(P.numGlyphs,d);else{var L=m[A];if(L)for(var I=0;I<P.numGlyphs;I++)t.addDynamicAttributes(d,L.shiftedAnchor,L.angle);else le(P.numGlyphs,d)}}e.icon.dynamicLayoutVertexBuffer.updateData(d)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function er(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function nr(e,n,r,i,o,a,s,u,l,c,h,p){for(var f=e.context,d=f.gl,m=e.transform,g="map"===u,y="map"===l,v=g&&"point"!==r.layout.get("symbol-placement"),_=g&&!y&&!v,x=void 0!==r.layout.get("symbol-sort-key").constantOr(1),b=!1,w=e.depthModeForSublayer(0,Ct.ReadOnly),S=r.layout.get("text-variable-anchor"),E=[],C=0,M=i;C<M.length;C+=1){var T=M[C],A=n.getTile(T),P=A.getBucket(r);if(P){var L=o?P.text:P.icon;if(L&&L.segments.get().length){var I=L.programConfigurations.get(r.id),k=o||P.sdfIcons,O=o?P.textSizeData:P.iconSizeData,R=y||0!==m.pitch,D=e.useProgram(er(k,o,P),I),N=t.evaluateSizeForZoom(O,m.zoom),F=void 0,z=[0,0],B=void 0,j=void 0,U=null,Z=void 0;if(o)B=A.glyphAtlasTexture,j=d.LINEAR,F=A.glyphAtlasTexture.size,P.iconsInText&&(z=A.imageAtlasTexture.size,U=A.imageAtlasTexture,Z=R||e.options.rotating||e.options.zooming||"composite"===O.kind||"camera"===O.kind?d.LINEAR:d.NEAREST);else{var V=1!==r.layout.get("icon-size").constantOr(0)||P.iconsNeedLinear;B=A.imageAtlasTexture,j=k||e.options.rotating||e.options.zooming||V||R?d.LINEAR:d.NEAREST,F=A.imageAtlasTexture.size}var G=pe(A,1,e.transform.zoom),H=Qt(T.posMatrix,y,g,e.transform,G),W=Jt(T.posMatrix,y,g,e.transform,G),q=S&&P.hasTextData(),X="none"!==r.layout.get("icon-text-fit")&&q&&P.hasIconData();v&&ne(P,T.posMatrix,e,o,H,W,y,c);var Y=e.translatePosMatrix(T.posMatrix,A,a,s),K=v||o&&S||X?Jn:H,Q=e.translatePosMatrix(W,A,a,s,!0),J=k&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),$={program:D,buffers:L,uniformValues:k?P.iconsInText?qn(O.kind,N,_,y,e,Y,K,Q,F,z):Wn(O.kind,N,_,y,e,Y,K,Q,o,F,!0):Hn(O.kind,N,_,y,e,Y,K,Q,o,F),atlasTexture:B,atlasTextureIcon:U,atlasInterpolation:j,atlasInterpolationIcon:Z,isSDF:k,hasHalo:J};if(x&&P.canOverlap){b=!0;for(var tt=0,et=L.segments.get();tt<et.length;tt+=1){var nt=et[tt];E.push({segments:new t.SegmentVector([nt]),sortKey:nt.sortKey,state:$})}}else E.push({segments:L.segments,sortKey:0,state:$})}}}b&&E.sort((function(t,e){return t.sortKey-e.sortKey}));for(var rt=0,it=E;rt<it.length;rt+=1){var ot=it[rt],at=ot.state;if(f.activeTexture.set(d.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,d.CLAMP_TO_EDGE),at.atlasTextureIcon&&(f.activeTexture.set(d.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,d.CLAMP_TO_EDGE)),at.isSDF){var st=at.uniformValues;at.hasHalo&&(st.u_is_halo=1,rr(at.buffers,ot.segments,r,e,at.program,w,h,p,st)),st.u_is_halo=0}rr(at.buffers,ot.segments,r,e,at.program,w,h,p,at.uniformValues)}}function rr(t,e,n,r,i,o,a,s,u){var l=r.context;i.draw(l,l.gl.TRIANGLES,o,a,s,At.disabled,u,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,r.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function ir(t,e,n,r,i,o,a){var s,u,l,c,h,p=t.context.gl,f=n.paint.get("fill-pattern"),d=f&&f.constantOr(1),m=n.getCrossfadeParameters();a?(u=d&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(u=d?"fillPattern":"fill",s=p.TRIANGLES);for(var g=0,y=r;g<y.length;g+=1){var v=y[g],_=e.getTile(v);if(!d||_.patternsLoaded()){var x=_.getBucket(n);if(x){var b=x.programConfigurations.get(n.id),w=t.useProgram(u,b);d&&(t.context.activeTexture.set(p.TEXTURE0),_.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),b.updatePaintBuffers(m));var S=f.constantOr(null);if(S&&_.imageAtlas){var E=_.imageAtlas,C=E.patternPositions[S.to.toString()],M=E.patternPositions[S.from.toString()];C&&M&&b.setConstantPatternPositions(C,M)}var T=t.translatePosMatrix(v.posMatrix,_,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){c=x.indexBuffer2,h=x.segments2;var A=[p.drawingBufferWidth,p.drawingBufferHeight];l="fillOutlinePattern"===u&&d?Pn(T,t,m,_,A):An(T,A)}else c=x.indexBuffer,h=x.segments,l=d?Tn(T,t,m,_):Mn(T);w.draw(t.context,s,i,t.stencilModeForClipping(v),o,At.disabled,l,n.id,x.layoutVertexBuffer,c,h,n.paint,t.transform.zoom,b)}}}}function or(t,e,n,r,i,o,a){for(var s=t.context,u=s.gl,l=n.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),h=n.getCrossfadeParameters(),p=n.paint.get("fill-extrusion-opacity"),f=0,d=r;f<d.length;f+=1){var m=d[f],g=e.getTile(m),y=g.getBucket(n);if(y){var v=y.programConfigurations.get(n.id),_=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",v);c&&(t.context.activeTexture.set(u.TEXTURE0),g.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),v.updatePaintBuffers(h));var x=l.constantOr(null);if(x&&g.imageAtlas){var b=g.imageAtlas,w=b.patternPositions[x.to.toString()],S=b.patternPositions[x.from.toString()];w&&S&&v.setConstantPatternPositions(w,S)}var E=t.translatePosMatrix(m.posMatrix,g,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),C=n.paint.get("fill-extrusion-vertical-gradient"),M=c?Cn(E,t,C,p,m,h,g):En(E,t,C,p);_.draw(s,s.gl.TRIANGLES,i,o,a,At.backCCW,M,n.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,n.paint,t.transform.zoom,v)}}}function ar(e,n,r,i,o,a){var s=e.context,u=s.gl,l=n.fbo;if(l){var c=e.useProgram("hillshade");s.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,l.colorAttachment.get());var h=function(e,n,r){var i=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),a=r.paint.get("hillshade-accent-color"),s=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var u,l,c,h=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(n.tileID.toUnwrapped(),h),u_image:0,u_latrange:(u=n.tileID,l=Math.pow(2,u.canonical.z),c=u.canonical.y,[new t.MercatorCoordinate(0,c/l).toLngLat().lat,new t.MercatorCoordinate(0,(c+1)/l).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:o,u_accent:a}}(e,n,r);c.draw(s,u.TRIANGLES,i,o,a,At.disabled,h,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function sr(e,n,r,i,o,a){var s=e.context,u=s.gl,l=n.dem;if(l&&l.data){var c=l.dim,h=l.stride,p=l.getPixels();if(s.activeTexture.set(u.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(h),n.demTexture){var f=n.demTexture;f.update(p,{premultiply:!1}),f.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else n.demTexture=new t.Texture(s,p,u.RGBA,{premultiply:!1}),n.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);s.activeTexture.set(u.TEXTURE0);var d=n.fbo;if(!d){var m=new t.Texture(s,{width:c,height:c,data:null},u.RGBA);m.bind(u.LINEAR,u.CLAMP_TO_EDGE),(d=n.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(m.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(s,u.TRIANGLES,i,o,a,At.disabled,function(e,n){var r=n.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}}(n.tileID,l),r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function ur(e,n,r,i,o){var a=i.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),u=(s-e.timeAdded)/a,l=n?(s-n.timeAdded)/a:-1,c=r.getSource(),h=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),f=p&&e.refreshedUponExpiration?1:t.clamp(p?u:1-l,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}var lr=new t.Color(1,0,0,1),cr=new t.Color(0,1,0,1),hr=new t.Color(0,0,1,1),pr=new t.Color(1,0,1,1),fr=new t.Color(0,1,1,1);function dr(t,e,n,r){gr(t,0,e+n/2,t.transform.width,n,r)}function mr(t,e,n,r){gr(t,e-n/2,0,n,t.transform.height,r)}function gr(e,n,r,i,o,a){var s=e.context,u=s.gl;u.enable(u.SCISSOR_TEST),u.scissor(n*t.browser.devicePixelRatio,r*t.browser.devicePixelRatio,i*t.browser.devicePixelRatio,o*t.browser.devicePixelRatio),s.clear({color:a}),u.disable(u.SCISSOR_TEST)}function yr(e,n,r){var i=e.context,o=i.gl,a=r.posMatrix,s=e.useProgram("debug"),u=Ct.disabled,l=Mt.disabled,c=e.colorModeForRenderPass();i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.draw(i,o.LINE_STRIP,u,l,c,At.disabled,On(a,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=n.getTileByID(r.key).latestRawTileData,p=Math.floor((h&&h.byteLength||0)/1024),f=n.getTile(r).tileSize,d=512/Math.min(f,512)*(r.overscaledZ/e.transform.zoom)*.5,m=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(m+=" => "+r.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var n=t.debugOverlayCanvas,r=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,m+" "+p+"kb"),s.draw(i,o.TRIANGLES,u,l,Tt.alphaBlended,At.disabled,On(a,t.Color.transparent,d),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var vr={symbol:function(e,n,r,i,o){if("translucent"===e.renderPass){var a=Mt.disabled,s=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,n,r,i,o,a,s){for(var u=n.transform,l="map"===o,c="map"===a,h=0,p=e;h<p.length;h+=1){var f=p[h],d=i.getTile(f),m=d.getBucket(r);if(m&&m.text&&m.text.segments.get().length){var g=t.evaluateSizeForZoom(m.textSizeData,u.zoom),y=pe(d,1,n.transform.zoom),v=Qt(f.posMatrix,c,l,n.transform,y),_="none"!==r.layout.get("icon-text-fit")&&m.hasIconData();if(g){var x=Math.pow(2,u.zoom-d.tileID.overscaledZ);tr(m,l,c,s,t.symbolSize,u,v,f.posMatrix,x,g,_)}}}}(i,e,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&nr(e,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,s),0!==r.paint.get("text-opacity").constantOr(1)&&nr(e,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,s),n.map.showCollisionBoxes&&(Qn(e,n,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Qn(e,n,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),u=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var l=e.context,c=l.gl,h=e.depthModeForSublayer(0,Ct.ReadOnly),p=Mt.disabled,f=e.colorModeForRenderPass(),d=[],m=0;m<i.length;m++){var g=i[m],y=n.getTile(g),v=y.getBucket(r);if(v){var _=v.programConfigurations.get(r.id),x={programConfiguration:_,program:e.useProgram("circle",_),layoutVertexBuffer:v.layoutVertexBuffer,indexBuffer:v.indexBuffer,uniformValues:Ln(e,g,y,r)};if(u)for(var b=0,w=v.segments.get();b<w.length;b+=1){var S=w[b];d.push({segments:new t.SegmentVector([S]),sortKey:S.sortKey,state:x})}else d.push({segments:v.segments,sortKey:0,state:x})}}u&&d.sort((function(t,e){return t.sortKey-e.sortKey}));for(var E=0,C=d;E<C.length;E+=1){var M=C[E],T=M.state;T.program.draw(l,c.TRIANGLES,h,p,f,At.disabled,T.uniformValues,r.id,T.layoutVertexBuffer,T.indexBuffer,M.segments,r.paint,e.transform.zoom,T.programConfiguration)}}}},heatmap:function(e,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=Mt.disabled,u=new Tt([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){var r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,n,r){var i=t.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width/4,e.height/4,0,i.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(t,e,o,i)}}(o,e,r),o.clear({color:t.Color.transparent});for(var l=0;l<i.length;l++){var c=i[l];if(!n.hasRenderableParent(c)){var h=n.getTile(c),p=h.getBucket(r);if(p){var f=p.programConfigurations.get(r.id);e.useProgram("heatmap",f).draw(o,a.TRIANGLES,Ct.disabled,s,u,At.disabled,Dn(c.posMatrix,h,e.transform.zoom,r.paint.get("heatmap-intensity")),r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,r.paint,e.transform.zoom,f)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){var r=e.context,i=r.gl,o=n.heatmapFbo;if(o){r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);var a=n.colorRampTexture;a||(a=n.colorRampTexture=new t.Texture(r,n.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,i.TRIANGLES,Ct.disabled,Mt.disabled,e.colorModeForRenderPass(),At.disabled,function(e,n,r,i){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}}(e,n),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}}(e,r))},line:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=e.depthModeForSublayer(0,Ct.ReadOnly),u=e.colorModeForRenderPass(),l=r.paint.get("line-dasharray"),c=r.paint.get("line-pattern"),h=c.constantOr(1),p=r.paint.get("line-gradient"),f=r.getCrossfadeParameters(),d=h?"linePattern":l?"lineSDF":p?"lineGradient":"line",m=e.context,g=m.gl,y=!0,v=0,_=i;v<_.length;v+=1){var x=_[v],b=n.getTile(x);if(!h||b.patternsLoaded()){var w=b.getBucket(r);if(w){var S=w.programConfigurations.get(r.id),E=e.context.program.get(),C=e.useProgram(d,S),M=y||C.program!==E,T=c.constantOr(null);if(T&&b.imageAtlas){var A=b.imageAtlas,P=A.patternPositions[T.to.toString()],L=A.patternPositions[T.from.toString()];P&&L&&S.setConstantPatternPositions(P,L)}var I=h?zn(e,b,r,f):l?Bn(e,b,r,l,f):p?Fn(e,b,r,w.lineClipsArray.length):Nn(e,b,r);if(h)m.activeTexture.set(g.TEXTURE0),b.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),S.updatePaintBuffers(f);else if(l&&(M||e.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),e.lineAtlas.bind(m);else if(p){var k=w.gradients[r.id],O=k.texture;if(r.gradientVersion!==k.version){var R=256;if(r.stepInterpolant){var D=n.getSource().maxzoom,N=x.canonical.z===D?Math.ceil(1<<e.transform.maxZoom-x.canonical.z):1;R=t.clamp(t.nextPowerOfTwo(w.maxLineLength/t.EXTENT*1024*N),256,m.maxTextureSize)}k.gradient=t.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:R,image:k.gradient||void 0,clips:w.lineClipsArray}),k.texture?k.texture.update(k.gradient):k.texture=new t.Texture(m,k.gradient,g.RGBA),k.version=r.gradientVersion,O=k.texture}m.activeTexture.set(g.TEXTURE0),O.bind(r.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}C.draw(m,g.TRIANGLES,s,e.stencilModeForClipping(x),u,At.disabled,I,r.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,r.paint,e.transform.zoom,S,w.layoutVertexBuffer2),y=!1}}}}},fill:function(e,n,r,i){var o=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?Ct.ReadWrite:Ct.ReadOnly);ir(e,n,r,i,c,s,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){var h=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly);ir(e,n,r,i,h,s,!0)}}},"fill-extrusion":function(t,e,n,r){var i=n.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var o=new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);if(1!==i||n.paint.get("fill-extrusion-pattern").constantOr(1))or(t,e,n,r,o,Mt.disabled,Tt.disabled),or(t,e,n,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();or(t,e,n,r,o,Mt.disabled,a)}}},hillshade:function(t,e,n,r){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,o=t.depthModeForSublayer(0,Ct.ReadOnly),a=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(r):[{},r],u=s[0],l=0,c=s[1];l<c.length;l+=1){var h=c[l],p=e.getTile(h);p.needsHillshadePrepare&&"offscreen"===t.renderPass?sr(t,p,n,o,Mt.disabled,a):"translucent"===t.renderPass&&ar(t,p,n,o,u[h.overscaledZ],a)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,n,r){if("translucent"===t.renderPass&&0!==n.paint.get("raster-opacity")&&r.length)for(var i=t.context,o=i.gl,a=e.getSource(),s=t.useProgram("raster"),u=t.colorModeForRenderPass(),l=a instanceof k?[{},r]:t.stencilConfigForOverlap(r),c=l[0],h=l[1],p=h[h.length-1].overscaledZ,f=!t.options.moving,d=0,m=h;d<m.length;d+=1){var g=m[d],y=t.depthModeForSublayer(g.overscaledZ-p,1===n.paint.get("raster-opacity")?Ct.ReadWrite:Ct.ReadOnly,o.LESS),v=e.getTile(g),_=t.transform.calculatePosMatrix(g.toUnwrapped(),f);v.registerFadeDuration(n.paint.get("raster-fade-duration"));var x=e.findLoadedParent(g,0),b=ur(v,x,e,n,t.transform),w=void 0,S=void 0,E="nearest"===n.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),v.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),x?(x.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,x.tileID.overscaledZ-v.tileID.overscaledZ),S=[v.tileID.canonical.x*w%1,v.tileID.canonical.y*w%1]):v.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var C=Zn(_,S||[0,0],w||1,b,n);a instanceof k?s.draw(i,o.TRIANGLES,y,Mt.disabled,u,At.disabled,C,n.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):s.draw(i,o.TRIANGLES,y,c[g.overscaledZ],u,At.disabled,C,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,n){var r=n.paint.get("background-color"),i=n.paint.get("background-opacity");if(0!==i){var o=t.context,a=o.gl,s=t.transform,u=s.tileSize,l=n.paint.get("background-pattern");if(!t.isPatternMissing(l)){var c=!l&&1===r.a&&1===i&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===c){var h=Mt.disabled,p=t.depthModeForSublayer(0,"opaque"===c?Ct.ReadWrite:Ct.ReadOnly),f=t.colorModeForRenderPass(),d=t.useProgram(l?"backgroundPattern":"background"),m=s.coveringTiles({tileSize:u});l&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var g=n.getCrossfadeParameters(),y=0,v=m;y<v.length;y+=1){var _=v[y],x=t.transform.calculatePosMatrix(_.toUnwrapped()),b=l?Yn(x,i,t,l,{tileID:_,tileSize:u},g):Xn(x,i,r);d.draw(o,a.TRIANGLES,p,h,f,At.disabled,b,n.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,n){for(var r=0;r<n.length;r++)yr(t,e,n[r])},custom:function(t,e,n){var r=t.context,i=n.implementation;if("offscreen"===t.renderPass){var o=i.prerender;o&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),o.call(i,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(Mt.disabled);var a="3d"===i.renderingMode?new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Ct.ReadOnly);r.setDepthMode(a),i.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}},_r=function(t,e){this.context=new Pt(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=Lt.maxUnderzooming+Lt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ze,this.gpuTimers={}};_r.prototype.resize=function(e,n){if(this.width=e*t.browser.devicePixelRatio,this.height=n*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,i=this.style._order;r<i.length;r+=1)this.style._layers[i[r]].resize()},_r.prototype.setup=function(){var e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,Ge.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(r,Ge.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,I.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,Ge.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var u=this.context.gl;this.stencilClearMode=new Mt({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},_r.prototype.clearStencil=function(){var e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=t.create();t.ortho(r,0,this.width,this.height,0,0,1),t.scale(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Ct.disabled,this.stencilClearMode,Tt.disabled,At.disabled,Rn(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},_r.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var n=this.context,r=n.gl;this.nextStencilID+e.length>256&&this.clearStencil(),n.setColorMode(Tt.disabled),n.setDepthMode(Ct.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(n,r.TRIANGLES,Ct.disabled,new Mt({func:r.ALWAYS,mask:0},u,255,r.KEEP,r.KEEP,r.REPLACE),Tt.disabled,At.disabled,Rn(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},_r.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new Mt({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},_r.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Mt({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},_r.prototype.stencilConfigForOverlap=function(t){var e,n=this.context.gl,r=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),i=r[r.length-1].overscaledZ,o=r[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var a={},s=0;s<o;s++)a[s+i]=new Mt({func:n.GEQUAL,mask:255},s+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[a,r]}return[(e={},e[i]=Mt.disabled,e),r]},_r.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Tt([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Tt.unblended:Tt.alphaBlended},_r.prototype.depthModeForSublayer=function(t,e,n){if(!this.opaquePassEnabledForLayer())return Ct.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ct(n||this.context.gl.LEQUAL,e,[r,r])},_r.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},_r.prototype.render=function(e,n){var r=this;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var i=this.style._order,o=this.style.sourceCaches;for(var a in o){var s=o[a];s.used&&s.prepare(this.context)}var u,l,c={},h={},p={};for(var f in o){var d=o[f];c[f]=d.getVisibleCoordinates(),h[f]=c[f].slice().reverse(),p[f]=d.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var m=0;m<i.length;m++)if(this.style._layers[i[m]].is3D()){this.opaquePassCutoff=m;break}this.renderPass="offscreen";for(var g=0,y=i;g<y.length;g+=1){var v=this.style._layers[y[g]];if(v.hasOffscreenPass()&&!v.isHidden(this.transform.zoom)){var _=h[v.source];("custom"===v.type||_.length)&&this.renderLayer(this,o[v.source],v,_)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var x=this.style._layers[i[this.currentLayer]],b=o[x.source],w=c[x.source];this._renderTileClippingMasks(x,w),this.renderLayer(this,b,x,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var S=this.style._layers[i[this.currentLayer]],E=o[S.source],C=("symbol"===S.type?p:h)[S.source];this._renderTileClippingMasks(S,c[S.source]),this.renderLayer(this,E,S,C)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(r.transform.zoom)&&(t.source!==(l&&l.id)&&(l=r.style.sourceCaches[t.source]),(!u||u.getSource().maxzoom<l.getSource().maxzoom)&&(u=l))})),u&&vr.debug(this,u,u.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;dr(t,t.transform.height-(e.top||0),3,lr),dr(t,e.bottom||0,3,cr),mr(t,e.left||0,3,hr),mr(t,t.transform.width-(e.right||0),3,pr);var n=t.transform.centerPoint;!function(t,e,n,r){gr(t,e-1,n-10,2,20,r),gr(t,e-10,n-1,20,2,r)}(t,n.x,t.transform.height-n.y,fr)}(this),this.context.setDefault()},_r.prototype.renderLayer=function(t,e,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||r.length)&&(this.id=n.id,this.gpuTimingStart(n),vr[n.type](t,e,n,r,this.style.placement.variableOffsets),this.gpuTimingEnd())},_r.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}},_r.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},_r.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},_r.prototype.queryGpuTimers=function(t){var e={};for(var n in t){var r=t[n],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(r.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r.query),e[n]=o}return e},_r.prototype.translatePosMatrix=function(e,n,r,i,o){if(!r[0]&&!r[1])return e;var a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var s=Math.sin(a),u=Math.cos(a);r=[r[0]*u-r[1]*s,r[0]*s+r[1]*u]}var l=[o?r[0]:pe(n,r[0],this.transform.zoom),o?r[1]:pe(n,r[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,l),c},_r.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},_r.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},_r.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n},_r.prototype.useProgram=function(t,e){this.cache=this.cache||{};var n=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new wn(this.context,t,_n[t],e,Kn[t],this._showOverdrawInspector)),this.cache[n]},_r.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},_r.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},_r.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},_r.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var xr=function(t,e){this.points=t,this.planes=e};xr.fromInvProjectionMatrix=function(e,n,r){var i=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(n){return t.transformMat4([],n,e)})).map((function(e){return t.scale$1([],e,1/e[3]/n*i)})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var n=t.sub([],o[e[0]],o[e[1]]),r=t.sub([],o[e[2]],o[e[1]]),i=t.normalize([],t.cross([],n,r)),a=-t.dot(i,o[e[1]]);return i.concat(a)}));return new xr(o,a)};var br=function(e,n){this.min=e,this.max=n,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};br.prototype.quadrant=function(e){for(var n=[e%2==0,e<2],r=t.clone$2(this.min),i=t.clone$2(this.max),o=0;o<n.length;o++)r[o]=n[o]?this.min[o]:this.center[o],i[o]=n[o]?this.center[o]:this.max[o];return i[2]=this.max[2],new br(r,i)},br.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},br.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},br.prototype.intersects=function(e){for(var n=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],r=!0,i=0;i<e.planes.length;i++){for(var o=e.planes[i],a=0,s=0;s<n.length;s++)a+=t.dot$1(o,n[s])>=0;if(0===a)return 0;a!==n.length&&(r=!1)}if(r)return 2;for(var u=0;u<3;u++){for(var l=Number.MAX_VALUE,c=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var p=e.points[h][u]-this.min[u];l=Math.min(l,p),c=Math.max(c,p)}if(c<0||l>this.max[u]-this.min[u])return 0}return 1};var wr=function(t,e,n,r){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=r};wr.prototype.interpolate=function(e,n,r){return null!=n.top&&null!=e.top&&(this.top=t.number(e.top,n.top,r)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,n.bottom,r)),null!=n.left&&null!=e.left&&(this.left=t.number(e.left,n.left,r)),null!=n.right&&null!=e.right&&(this.right=t.number(e.right,n.right,r)),this},wr.prototype.getCenter=function(e,n){var r=t.clamp((this.left+e-this.right)/2,0,e),i=t.clamp((this.top+n-this.bottom)/2,0,n);return new t.Point(r,i)},wr.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},wr.prototype.clone=function(){return new wr(this.top,this.bottom,this.left,this.right)},wr.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Sr=function(e,n,r,i,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wr,this._posMatrixCache={},this._alignedPosMatrixCache={}},Er={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Sr.prototype.clone=function(){var t=new Sr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},Er.minZoom.get=function(){return this._minZoom},Er.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Er.maxZoom.get=function(){return this._maxZoom},Er.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Er.minPitch.get=function(){return this._minPitch},Er.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},Er.maxPitch.get=function(){return this._maxPitch},Er.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},Er.renderWorldCopies.get=function(){return this._renderWorldCopies},Er.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Er.worldSize.get=function(){return this.tileSize*this.scale},Er.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Er.size.get=function(){return new t.Point(this.width,this.height)},Er.bearing.get=function(){return-this.angle/Math.PI*180},Er.bearing.set=function(e){var n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Er.pitch.get=function(){return this._pitch/Math.PI*180},Er.pitch.set=function(e){var n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},Er.fov.get=function(){return this._fov/Math.PI*180},Er.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Er.zoom.get=function(){return this._zoom},Er.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Er.center.get=function(){return this._center},Er.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Er.padding.get=function(){return this._edgeInsets.toJSON()},Er.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},Er.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Sr.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},Sr.prototype.interpolatePadding=function(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()},Sr.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},Sr.prototype.getVisibleUnwrappedCoordinates=function(e){var n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(r.x,i.x,o.x,a.x)),u=Math.floor(Math.max(r.x,i.x,o.x,a.x)),l=s-1;l<=u+1;l++)0!==l&&n.push(new t.UnwrappedTileID(l,e));return n},Sr.prototype.coveringTiles=function(e){var n=this.coveringZoomLevel(e),r=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);var i=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,n),a=[o*i.x,o*i.y,0],s=xr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),u=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(u=n);var l=function(t){return{aabb:new br([t*o,0,0],[(t+1)*o,o,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},c=[],h=[],p=n,f=e.reparseOverscaled?r:n;if(this._renderWorldCopies)for(var d=1;d<=3;d++)c.push(l(-d)),c.push(l(d));for(c.push(l(0));c.length>0;){var m=c.pop(),g=m.x,y=m.y,v=m.fullyVisible;if(!v){var _=m.aabb.intersects(s);if(0===_)continue;v=2===_}var x=m.aabb.distanceX(a),b=m.aabb.distanceY(a),w=Math.max(Math.abs(x),Math.abs(b));if(m.zoom===p||w>3+(1<<p-m.zoom)-2&&m.zoom>=u)h.push({tileID:new t.OverscaledTileID(m.zoom===p?f:m.zoom,m.wrap,m.zoom,g,y),distanceSq:t.sqrLen([a[0]-.5-g,a[1]-.5-y])});else for(var S=0;S<4;S++){var E=(g<<1)+S%2,C=(y<<1)+(S>>1);c.push({aabb:m.aabb.quadrant(S),zoom:m.zoom+1,x:E,y:C,wrap:m.wrap,fullyVisible:v})}}return h.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},Sr.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Er.unmodified.get=function(){return this._unmodified},Sr.prototype.zoomScale=function(t){return Math.pow(2,t)},Sr.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Sr.prototype.project=function(e){var n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)},Sr.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},Er.point.get=function(){return this.project(this.center)},Sr.prototype.setLocationAtPoint=function(e,n){var r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(r.x-i.x),o.y-(r.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},Sr.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Sr.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Sr.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},Sr.prototype.coordinateLocation=function(t){return t.toLngLat()},Sr.prototype.pointCoordinate=function(e){var n=[e.x,e.y,0,1],r=[e.x,e.y,1,1];t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(r,r,this.pixelMatrixInverse);var i=n[3],o=r[3],a=n[1]/i,s=r[1]/o,u=n[2]/i,l=r[2]/o,c=u===l?0:(0-u)/(l-u);return new t.MercatorCoordinate(t.number(n[0]/i,r[0]/o,c)/this.worldSize,t.number(a,s,c)/this.worldSize)},Sr.prototype.coordinatePoint=function(e){var n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix),new t.Point(n[0]/n[3],n[1]/n[3])},Sr.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},Sr.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Sr.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Sr.prototype.calculatePosMatrix=function(e,n){void 0===n&&(n=!1);var r=e.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*a,o.y*a,0]),t.scale(u,u,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(u,n?this.alignedProjMatrix:this.projMatrix,u),i[r]=new Float32Array(u),i[r]},Sr.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Sr.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,n,r,i,o=-90,a=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<l.y?l.y/(a-o):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,n=(u=t.mercatorXfromLng(p[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var f=this.point,d=Math.max(n||0,e||0);if(d)return this.center=this.unproject(new t.Point(n?(u+s)/2:f.x,e?(a+o)/2:f.y)),this.zoom+=this.scaleZoom(d),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var m=f.y,g=l.y/2;m-g<o&&(i=o+g),m+g>a&&(i=a-g)}if(this.lngRange){var y=f.x,v=l.x/2;y-v<s&&(r=s+v),y+v>u&&(r=u-v)}void 0===r&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==r?r:f.x,void 0!==i?i:f.y))),this._unmodified=c,this._constraining=!1}},Sr.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);t.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,t.scale(c,c,[1,-1,1]),t.translate(c,c,[0,0,-this.cameraToCenterDistance]),t.rotateX(c,c,this._pitch),t.rotateZ(c,c,this.angle),t.translate(c,c,[-a,-s,0]),this.mercatorMatrix=t.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),t.scale(c,c,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=t.invert([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,f=Math.cos(this.angle),d=Math.sin(this.angle),m=a-Math.round(a)+f*h+d*p,g=s-Math.round(s)+f*p+d*h,y=new Float64Array(c);if(t.translate(y,y,[m>.5?m-1:m,g>.5?g-1:g,0]),this.alignedProjMatrix=y,c=t.create(),t.scale(c,c,[this.width/2,-this.height/2,1]),t.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=t.create(),t.scale(c,c,[1,-1,1]),t.translate(c,c,[-1,-1,0]),t.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Sr.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},Sr.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},Sr.prototype.getCameraQueryGeometry=function(e){var n=this.getCameraPoint();if(1===e.length)return[e[0],n];for(var r=n.x,i=n.y,o=n.x,a=n.y,s=0,u=e;s<u.length;s+=1){var l=u[s];r=Math.min(r,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),a=Math.max(a,l.y)}return[new t.Point(r,i),new t.Point(o,i),new t.Point(o,a),new t.Point(r,a),new t.Point(r,i)]},Object.defineProperties(Sr.prototype,Er);var Cr=function(e){var n,r,i,o;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(n=this._updateHashUnthrottled.bind(this),r=!1,i=null,o=function(){i=null,r&&(n(),i=setTimeout(o,300),r=!1)},function(){return r=!0,i||o(),i})};Cr.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Cr.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Cr.prototype.getHashString=function(e){var n=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),a=Math.round(n.lng*o)/o,s=Math.round(n.lat*o)/o,u=this._map.getBearing(),l=this._map.getPitch(),c="";if(c+=e?"/"+a+"/"+s+"/"+r:r+"/"+s+"/"+a,(u||l)&&(c+="/"+Math.round(10*u)/10),l&&(c+="/"+Math.round(l)),this._hashName){var h=this._hashName,p=!1,f=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(p=!0,e+"="+c):t})).filter((function(t){return t}));return p||f.push(h+"="+c),"#"+f.join("&")}return"#"+c},Cr.prototype._getCurrentHash=function(){var e,n=this,r=t.window.location.hash.replace("#","");return this._hashName?(r.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===n._hashName&&(e=t)})),(e&&e[1]||"").split("/")):r.split("/")},Cr.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},Cr.prototype._updateHashUnthrottled=function(){var e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());try{t.window.history.replaceState(t.window.history.state,null,e)}catch(t){}};var Mr={linearity:.3,easing:t.bezier(0,0,.3,1)},Tr=t.extend({deceleration:2500,maxSpeed:1400},Mr),Ar=t.extend({deceleration:20,maxSpeed:1400},Mr),Pr=t.extend({deceleration:1e3,maxSpeed:360},Mr),Lr=t.extend({deceleration:1e3,maxSpeed:90},Mr),Ir=function(t){this._map=t,this.clear()};function kr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Or(e,n,r){var i=r.maxSpeed,o=r.linearity,a=r.deceleration,s=t.clamp(e*o/(n/1e3),-i,i),u=Math.abs(s)/(a*o);return{easing:r.easing,duration:1e3*u,amount:s*(u/2)}}Ir.prototype.clear=function(){this._inertiaBuffer=[]},Ir.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},Ir.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,n=t.browser.now();e.length>0&&n-e[0].time>160;)e.shift()},Ir.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var n={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},r=0,i=this._inertiaBuffer;r<i.length;r+=1){var o=i[r].settings;n.zoom+=o.zoomDelta||0,n.bearing+=o.bearingDelta||0,n.pitch+=o.pitchDelta||0,o.panDelta&&n.pan._add(o.panDelta),o.around&&(n.around=o.around),o.pinchAround&&(n.pinchAround=o.pinchAround)}var a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){var u=Or(n.pan.mag(),a,t.extend({},Tr,e||{}));s.offset=n.pan.mult(u.amount/n.pan.mag()),s.center=this._map.transform.center,kr(s,u)}if(n.zoom){var l=Or(n.zoom,a,Ar);s.zoom=this._map.transform.zoom+l.amount,kr(s,l)}if(n.bearing){var c=Or(n.bearing,a,Pr);s.bearing=this._map.transform.bearing+t.clamp(c.amount,-179,179),kr(s,c)}if(n.pitch){var h=Or(n.pitch,a,Lr);s.pitch=this._map.transform.pitch+h.amount,kr(s,h)}if(s.zoom||s.bearing){var p=void 0===n.pinchAround?n.around:n.pinchAround;s.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Rr=function(e){function r(r,i,o,a){void 0===a&&(a={});var s=n.mousePos(i.getCanvasContainer(),o),u=i.unproject(s);e.call(this,r,t.extend({point:s,lngLat:u,originalEvent:o},a)),this._defaultPrevented=!1,this.target=i}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),Dr=function(e){function r(r,i,o){var a="touchend"===r?o.changedTouches:o.touches,s=n.touchPos(i.getCanvasContainer(),a),u=s.map((function(t){return i.unproject(t)})),l=s.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new t.Point(0,0)),c=i.unproject(l);e.call(this,r,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:o}),this._defaultPrevented=!1}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),Nr=function(t){function e(e,n,r){t.call(this,e,{originalEvent:r}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,n),e}(t.Event),Fr=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};Fr.prototype.reset=function(){delete this._mousedownPos},Fr.prototype.wheel=function(t){return this._firePreventable(new Nr(t.type,this._map,t))},Fr.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Rr(t.type,this._map,t))},Fr.prototype.mouseup=function(t){this._map.fire(new Rr(t.type,this._map,t))},Fr.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Rr(t.type,this._map,t))},Fr.prototype.dblclick=function(t){return this._firePreventable(new Rr(t.type,this._map,t))},Fr.prototype.mouseover=function(t){this._map.fire(new Rr(t.type,this._map,t))},Fr.prototype.mouseout=function(t){this._map.fire(new Rr(t.type,this._map,t))},Fr.prototype.touchstart=function(t){return this._firePreventable(new Dr(t.type,this._map,t))},Fr.prototype.touchmove=function(t){this._map.fire(new Dr(t.type,this._map,t))},Fr.prototype.touchend=function(t){this._map.fire(new Dr(t.type,this._map,t))},Fr.prototype.touchcancel=function(t){this._map.fire(new Dr(t.type,this._map,t))},Fr.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},Fr.prototype.isEnabled=function(){return!0},Fr.prototype.isActive=function(){return!1},Fr.prototype.enable=function(){},Fr.prototype.disable=function(){};var zr=function(t){this._map=t};zr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},zr.prototype.mousemove=function(t){this._map.fire(new Rr(t.type,this._map,t))},zr.prototype.mousedown=function(){this._delayContextMenu=!0},zr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},zr.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Rr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},zr.prototype.isEnabled=function(){return!0},zr.prototype.isActive=function(){return!1},zr.prototype.enable=function(){},zr.prototype.disable=function(){};var Br=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function jr(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}Br.prototype.isEnabled=function(){return!!this._enabled},Br.prototype.isActive=function(){return!!this._active},Br.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Br.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Br.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(n.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},Br.prototype.mousemoveWindow=function(t,e){if(this._active){var r=e;if(!(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=r,this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var o=Math.min(i.x,r.x),a=Math.max(i.x,r.x),s=Math.min(i.y,r.y),u=Math.max(i.y,r.y);n.setTransform(this._box,"translate("+o+"px,"+s+"px)"),this._box.style.width=a-o+"px",this._box.style.height=u-s+"px"}}},Br.prototype.mouseupWindow=function(e,r){var i=this;if(this._active&&0===e.button){var o=this._startPos,a=r;if(this.reset(),n.suppressClick(),o.x!==a.x||o.y!==a.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(o,a,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},Br.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},Br.prototype.blur=function(){this.reset()},Br.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos},Br.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))};var Ur=function(t){this.reset(),this.numTouches=t.numTouches};Ur.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ur.prototype.touchstart=function(e,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){for(var n=new t.Point(0,0),r=0,i=e;r<i.length;r+=1)n._add(i[r]);return n.div(e.length)}(n),this.touches=jr(r,n)))},Ur.prototype.touchmove=function(t,e,n){if(!this.aborted&&this.centroid){var r=jr(n,e);for(var i in this.touches){var o=r[i];(!o||o.dist(this.touches[i])>30)&&(this.aborted=!0)}}},Ur.prototype.touchend=function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}};var Zr=function(t){this.singleTap=new Ur(t),this.numTaps=t.numTaps,this.reset()};Zr.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Zr.prototype.touchstart=function(t,e,n){this.singleTap.touchstart(t,e,n)},Zr.prototype.touchmove=function(t,e,n){this.singleTap.touchmove(t,e,n)},Zr.prototype.touchend=function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}};var Vr=function(){this._zoomIn=new Zr({numTouches:1,numTaps:2}),this._zoomOut=new Zr({numTouches:2,numTaps:1}),this.reset()};Vr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Vr.prototype.touchstart=function(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)},Vr.prototype.touchmove=function(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)},Vr.prototype.touchend=function(t,e,n){var r=this,i=this._zoomIn.touchend(t,e,n),o=this._zoomOut.touchend(t,e,n);return i?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0},Vr.prototype.touchcancel=function(){this.reset()},Vr.prototype.enable=function(){this._enabled=!0},Vr.prototype.disable=function(){this._enabled=!1,this.reset()},Vr.prototype.isEnabled=function(){return this._enabled},Vr.prototype.isActive=function(){return this._active};var Gr={0:1,2:2},Hr=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};Hr.prototype.blur=function(){this.reset()},Hr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Hr.prototype._correctButton=function(t,e){return!1},Hr.prototype._move=function(t,e){return{}},Hr.prototype.mousedown=function(t,e){if(!this._lastPoint){var r=n.mouseButton(t);this._correctButton(t,r)&&(this._lastPoint=e,this._eventButton=r)}},Hr.prototype.mousemoveWindow=function(t,e){var n=this._lastPoint;if(n)if(t.preventDefault(),function(t,e){var n=Gr[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(n,e)},Hr.prototype.mouseupWindow=function(t){this._lastPoint&&n.mouseButton(t)===this._eventButton&&(this._moved&&n.suppressClick(),this.reset())},Hr.prototype.enable=function(){this._enabled=!0},Hr.prototype.disable=function(){this._enabled=!1,this.reset()},Hr.prototype.isEnabled=function(){return this._enabled},Hr.prototype.isActive=function(){return this._active};var Wr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,n){t.prototype.mousedown.call(this,e,n),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(Hr),qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=.8*(e.x-t.x);if(n)return this._active=!0,{bearingDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Hr),Xr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=-.5*(e.y-t.y);if(n)return this._active=!0,{pitchDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Hr),Yr=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};Yr.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},Yr.prototype.touchstart=function(t,e,n){return this._calculateTransform(t,e,n)},Yr.prototype.touchmove=function(t,e,n){if(this._active&&!(n.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,n)},Yr.prototype.touchend=function(t,e,n){this._calculateTransform(t,e,n),this._active&&n.length<this._minTouches&&this.reset()},Yr.prototype.touchcancel=function(){this.reset()},Yr.prototype._calculateTransform=function(e,n,r){r.length>0&&(this._active=!0);var i=jr(r,n),o=new t.Point(0,0),a=new t.Point(0,0),s=0;for(var u in i){var l=i[u],c=this._touches[u];c&&(o._add(l),a._add(l.sub(c)),s++,i[u]=l)}if(this._touches=i,!(s<this._minTouches)&&a.mag()){var h=a.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:o.div(s),panDelta:h}}},Yr.prototype.enable=function(){this._enabled=!0},Yr.prototype.disable=function(){this._enabled=!1,this.reset()},Yr.prototype.isEnabled=function(){return this._enabled},Yr.prototype.isActive=function(){return this._active};var Kr=function(){this.reset()};function Qr(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function Jr(t,e){return Math.log(t/e)/Math.LN2}Kr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Kr.prototype._start=function(t){},Kr.prototype._move=function(t,e,n){return{}},Kr.prototype.touchstart=function(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))},Kr.prototype.touchmove=function(t,e,n){if(this._firstTwoTouches){t.preventDefault();var r=this._firstTwoTouches,i=r[1],o=Qr(n,e,r[0]),a=Qr(n,e,i);if(o&&a){var s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,t)}}},Kr.prototype.touchend=function(t,e,r){if(this._firstTwoTouches){var i=this._firstTwoTouches,o=i[1],a=Qr(r,e,i[0]),s=Qr(r,e,o);a&&s||(this._active&&n.suppressClick(),this.reset())}},Kr.prototype.touchcancel=function(){this.reset()},Kr.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var $r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Jr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jr(this._distance,n),pinchAround:e}},e}(Kr);function ti(t,e){return 180*t.angleWith(e)/Math.PI}var ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ti(this._vector,n),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,n=ti(t,this._startVector);return Math.abs(n)<e},e}(Kr);function ni(t){return Math.abs(t.y)>Math.abs(t.x)}var ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,ni(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,n){var r=t[0].sub(this._lastPoints[0]),i=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,n){if(void 0!==this._valid)return this._valid;var r=t.mag()>=2,i=e.mag()>=2;if(r||i){if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;var o=t.y>0==e.y>0;return ni(t)&&ni(e)&&o}},e}(Kr),ii={panStep:100,bearingStep:15,pitchStep:10},oi=function(){var t=ii;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1};function ai(t){return t*(2-t)}oi.prototype.blur=function(){this.reset()},oi.prototype.reset=function(){this._active=!1},oi.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:ai,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e._bearingStep,pitch:s.getPitch()+i*e._pitchStep,offset:[-o*e._panStep,-a*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},oi.prototype.enable=function(){this._enabled=!0},oi.prototype.disable=function(){this._enabled=!1,this.reset()},oi.prototype.isEnabled=function(){return this._enabled},oi.prototype.isActive=function(){return this._active},oi.prototype.disableRotation=function(){this._rotationDisabled=!0},oi.prototype.enableRotation=function(){this._rotationDisabled=!1};var si=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};si.prototype.setZoomRate=function(t){this._defaultZoomRate=t},si.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},si.prototype.isEnabled=function(){return!!this._enabled},si.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},si.prototype.isZooming=function(){return!!this._zooming},si.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},si.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},si.prototype.wheel=function(e){if(this.isEnabled()){var n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,r=t.browser.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}},si.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},si.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var r=n.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},si.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var n=this._map.transform;if(0!==this._delta){var r="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==i&&(i=1/i);var o="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a,s="number"==typeof this._targetZoom?this._targetZoom:n.zoom,u=this._startZoom,l=this._easing,c=!1;if("wheel"===this._type&&u&&l){var h=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),p=l(h);a=t.number(u,s,p),h<1?this._frameId||(this._frameId=!0):c=!0}else a=s,c=!0;return this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:a-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},si.prototype._smoothOutEasing=function(e){var n=t.ease;if(this._prevEase){var r=this._prevEase,i=(t.browser.now()-r.start)/r.duration,o=r.easing(i+.01)-r.easing(i),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:n},n},si.prototype.blur=function(){this.reset()},si.prototype.reset=function(){this._active=!1};var ui=function(t,e){this._clickZoom=t,this._tapZoom=e};ui.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ui.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ui.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ui.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var li=function(){this.reset()};li.prototype.reset=function(){this._active=!1},li.prototype.blur=function(){this.reset()},li.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}},li.prototype.enable=function(){this._enabled=!0},li.prototype.disable=function(){this._enabled=!1,this.reset()},li.prototype.isEnabled=function(){return this._enabled},li.prototype.isActive=function(){return this._active};var ci=function(){this._tap=new Zr({numTouches:1,numTaps:1}),this.reset()};ci.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ci.prototype.touchstart=function(t,e,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=e[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,e,n))},ci.prototype.touchmove=function(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var r=e[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,n)},ci.prototype.touchend=function(t,e,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(t,e,n)&&(this._tapTime=t.timeStamp)},ci.prototype.touchcancel=function(){this.reset()},ci.prototype.enable=function(){this._enabled=!0},ci.prototype.disable=function(){this._enabled=!1,this.reset()},ci.prototype.isEnabled=function(){return this._enabled},ci.prototype.isActive=function(){return this._active};var hi=function(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n};hi.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hi.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hi.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hi.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pi=function(t,e,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=n};pi.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pi.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pi.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pi.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var fi=function(t,e,n,r){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0};fi.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},fi.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},fi.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},fi.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},fi.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},fi.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var di=function(t){return t.zoom||t.drag||t.pitch||t.rotate},mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event);function gi(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var yi=function(e,r){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ir(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),t.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[t.window,"blur",void 0]];for(var o=0,a=this._listeners;o<a.length;o+=1){var s=a[o],u=s[0];n.addEventListener(u,s[1],u===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};yi.prototype.destroy=function(){for(var e=0,r=this._listeners;e<r.length;e+=1){var i=r[e],o=i[0];n.removeEventListener(o,i[1],o===t.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},yi.prototype._addDefaultHandlers=function(t){var e=this._map,n=e.getCanvasContainer();this._add("mapEvent",new Fr(e,t));var r=e.boxZoom=new Br(e,t);this._add("boxZoom",r);var i=new Vr,o=new li;e.doubleClickZoom=new ui(o,i),this._add("tapZoom",i),this._add("clickZoom",o);var a=new ci;this._add("tapDragZoom",a);var s=e.touchPitch=new ri;this._add("touchPitch",s);var u=new qr(t),l=new Xr(t);e.dragRotate=new pi(t,u,l),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",l,["mouseRotate"]);var c=new Wr(t),h=new Yr(t);e.dragPan=new hi(n,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);var p=new ei,f=new $r;e.touchZoomRotate=new fi(n,f,p,a),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]);var d=e.scrollZoom=new si(e,this);this._add("scrollZoom",d,["mousePan"]);var m=e.keyboard=new oi;this._add("keyboard",m),this._add("blockableMapEvent",new zr(e));for(var g=0,y=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<y.length;g+=1){var v=y[g];t.interactive&&t[v]&&e[v].enable(t[v])}},yi.prototype._add=function(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e},yi.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,n=this._handlers;e<n.length;e+=1)n[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},yi.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},yi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},yi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},yi.prototype.isMoving=function(){return Boolean(di(this._eventsInProgress))||this.isZooming()},yi.prototype._blockedByActive=function(t,e,n){for(var r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1},yi.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},yi.prototype._getMapTouches=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=r[n];this._el.contains(i.target)&&e.push(i)}return e},yi.prototype.handleEvent=function(t,e){this._updatingCamera=!0;for(var r="renderFrame"===t.type?void 0:t,i={needsRenderFrame:!1},o={},a={},s=t.touches?this._getMapTouches(t.touches):void 0,u=s?n.touchPos(this._el,s):n.mousePos(this._el,t),l=0,c=this._handlers;l<c.length;l+=1){var h=c[l],p=h.handlerName,f=h.handler,d=h.allowed;if(f.isEnabled()){var m=void 0;this._blockedByActive(a,d,p)?f.reset():f[e||t.type]&&(m=f[e||t.type](t,u,s),this.mergeHandlerResult(i,o,m,p,r),m&&m.needsRenderFrame&&this._triggerRenderFrame()),(m||f.isActive())&&(a[p]=f)}}var g={};for(var y in this._previousActiveHandlers)a[y]||(g[y]=r);this._previousActiveHandlers=a,(Object.keys(g).length||gi(i))&&(this._changes.push([i,o,g]),this._triggerRenderFrame()),(Object.keys(a).length||gi(i))&&this._map._stop(!0),this._updatingCamera=!1;var v=i.cameraAnimation;v&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],v(this._map))},yi.prototype.mergeHandlerResult=function(e,n,r,i,o){if(r){t.extend(e,r);var a={handlerName:i,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(n.zoom=a),void 0!==r.panDelta&&(n.drag=a),void 0!==r.pitchDelta&&(n.pitch=a),void 0!==r.bearingDelta&&(n.rotate=a)}},yi.prototype._applyChanges=function(){for(var e={},n={},r={},i=0,o=this._changes;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],l=a[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(n,u),t.extend(r,l)}this._updateMapTransform(e,n,r),this._changes=[]},yi.prototype._updateMapTransform=function(t,e,n){var r=this._map,i=r.transform;if(!gi(t))return this._fireEvents(e,n,!0);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,l=t.around,c=t.pinchAround;void 0!==c&&(l=c),r._stop(!0),l=l||r.transform.centerPoint;var h=i.pointLocation(o?l.sub(o):l);s&&(i.bearing+=s),u&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,l),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,n,!0)},yi.prototype._fireEvents=function(e,n,r){var i=this,o=di(this._eventsInProgress),a=di(e),s={};for(var u in e)this._eventsInProgress[u]||(s[u+"start"]=e[u].originalEvent),this._eventsInProgress[u]=e[u];for(var l in!o&&a&&this._fireEvent("movestart",a.originalEvent),s)this._fireEvent(l,s[l]);for(var c in a&&this._fireEvent("move",a.originalEvent),e)this._fireEvent(c,e[c].originalEvent);var h,p={};for(var f in this._eventsInProgress){var d=this._eventsInProgress[f],m=d.handlerName,g=d.originalEvent;this._handlersById[m].isActive()||(delete this._eventsInProgress[f],p[f+"end"]=h=n[m]||g)}for(var y in p)this._fireEvent(y,p[y]);var v=di(this._eventsInProgress);if(r&&(o||a)&&!v){this._updatingCamera=!0;var _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),x=function(t){return 0!==t&&-i._bearingSnap<t&&t<i._bearingSnap};_?(x(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:h})):(this._map.fire(new t.Event("moveend",{originalEvent:h})),x(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},yi.prototype._fireEvent=function(e,n){this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},yi.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new mi("renderFrame",{timeStamp:e})),t._applyChanges()}))},yi.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var vi=function(e){function n(n,r){e.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=r.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},n.prototype.panBy=function(e,n,r){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),r)},n.prototype.panTo=function(e,n,r){return this.easeTo(t.extend({center:e},n),r)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},n.prototype.zoomTo=function(e,n,r){return this.easeTo(t.extend({zoom:e},n),r)},n.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},n.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},n.prototype.getPadding=function(){return this.transform.padding},n.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},n.prototype.rotateTo=function(e,n,r){return this.easeTo(t.extend({bearing:e},n),r)},n.prototype.resetNorth=function(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this},n.prototype.resetNorthPitch=function(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this},n.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},n.prototype.cameraForBounds=function(e,n){e=t.LngLatBounds.convert(e);var r=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),r,n)},n.prototype._cameraForBoxAndBearing=function(e,n,r,i){var o={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=t.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var a=i.padding;i.padding={top:a,bottom:a,right:a,left:a}}i.padding=t.extend(o,i.padding);var s=this.transform,u=s.padding,l=s.project(t.LngLat.convert(e)),c=s.project(t.LngLat.convert(n)),h=l.rotate(-r*Math.PI/180),p=c.rotate(-r*Math.PI/180),f=new t.Point(Math.max(h.x,p.x),Math.max(h.y,p.y)),d=new t.Point(Math.min(h.x,p.x),Math.min(h.y,p.y)),m=f.sub(d),g=(s.width-(u.left+u.right+i.padding.left+i.padding.right))/m.x,y=(s.height-(u.top+u.bottom+i.padding.top+i.padding.bottom))/m.y;if(!(y<0||g<0)){var v=Math.min(s.scaleZoom(s.scale*Math.min(g,y)),i.maxZoom),_="number"==typeof i.offset.x?new t.Point(i.offset.x,i.offset.y):t.Point.convert(i.offset),x=new t.Point((i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2).rotate(r*Math.PI/180),b=_.add(x).mult(s.scale/s.zoomScale(v));return{center:s.unproject(l.add(c).div(2).sub(b)),zoom:v,bearing:r}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},n.prototype.fitBounds=function(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)},n.prototype.fitScreenCoordinates=function(e,n,r,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(n)),r,i),i,o)},n.prototype._fitInternal=function(e,n,r){return e?(delete(n=t.extend(e,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this},n.prototype.jumpTo=function(e,n){this.stop();var r=this.transform,i=!1,o=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(i=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),i&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),o&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),a&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))},n.prototype.easeTo=function(e,n){var r=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l="zoom"in e?+e.zoom:o,c="bearing"in e?this._normalizeBearing(e.bearing,a):a,h="pitch"in e?+e.pitch:s,p="padding"in e?e.padding:i.padding,f=t.Point.convert(e.offset),d=i.centerPoint.add(f),m=i.pointLocation(d),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);var y,v,_=i.project(m),x=i.project(g).sub(_),b=i.zoomScale(l-o);e.around&&(y=t.LngLat.convert(e.around),v=i.locationPoint(y));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==o,this._rotating=this._rotating||a!==c,this._pitching=this._pitching||h!==s,this._padding=!i.isPaddingEqual(p),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,w),this._ease((function(e){if(r._zooming&&(i.zoom=t.number(o,l,e)),r._rotating&&(i.bearing=t.number(a,c,e)),r._pitching&&(i.pitch=t.number(s,h,e)),r._padding&&(i.interpolatePadding(u,p,e),d=i.centerPoint.add(f)),y)i.setLocationAtPoint(y,v);else{var m=i.zoomScale(i.zoom-o),g=l>o?Math.min(2,b):Math.max(.5,b),w=Math.pow(g,1-e),S=i.unproject(_.add(x.mult(e*w)).mult(m));i.setLocationAtPoint(i.renderWorldCopies?S.wrap():S,d)}r._fireMoveEvents(n)}),(function(t){r._afterEase(n,t)}),e),this},n.prototype._prepareEase=function(e,n,r){void 0===r&&(r={}),this._moving=!0,n||r.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.Event("pitchstart",e))},n.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},n.prototype._afterEase=function(e,n){if(!this._easeId||!n||this._easeId!==n){delete this._easeId;var r=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},n.prototype.flyTo=function(e,n){var r=this;if(!e.essential&&t.browser.prefersReducedMotion){var i=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,a=this.getZoom(),s=this.getBearing(),u=this.getPitch(),l=this.getPadding(),c="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):a,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,p="pitch"in e?+e.pitch:u,f="padding"in e?e.padding:o.padding,d=o.zoomScale(c-a),m=t.Point.convert(e.offset),g=o.centerPoint.add(m),y=o.pointLocation(g),v=t.LngLat.convert(e.center||y);this._normalizeCenter(v);var _=o.project(y),x=o.project(v).sub(_),b=e.curve,w=Math.max(o.width,o.height),S=w/d,E=x.mag();if("minZoom"in e){var C=t.clamp(Math.min(e.minZoom,a,c),o.minZoom,o.maxZoom),M=w/o.zoomScale(C-a);b=Math.sqrt(M/E*2)}var T=b*b;function A(t){var e=(S*S-w*w+(t?-1:1)*T*T*E*E)/(2*(t?S:w)*T*E);return Math.log(Math.sqrt(e*e+1)-e)}function P(t){return(Math.exp(t)-Math.exp(-t))/2}function L(t){return(Math.exp(t)+Math.exp(-t))/2}var I=A(0),k=function(t){return L(I)/L(I+b*t)},O=function(t){return w*((L(I)*(P(e=I+b*t)/L(e))-P(I))/T)/E;var e},R=(A(1)-I)/b;if(Math.abs(E)<1e-6||!isFinite(R)){if(Math.abs(w-S)<1e-6)return this.easeTo(e,n);var D=S<w?-1:1;R=Math.abs(Math.log(S/w))/b,O=function(){return 0},k=function(t){return Math.exp(D*b*t)}}return e.duration="duration"in e?+e.duration:1e3*R/("screenSpeed"in e?+e.screenSpeed/b:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=p!==u,this._padding=!o.isPaddingEqual(f),this._prepareEase(n,!1),this._ease((function(e){var i=e*R,d=1/k(i);o.zoom=1===e?c:a+o.scaleZoom(d),r._rotating&&(o.bearing=t.number(s,h,e)),r._pitching&&(o.pitch=t.number(u,p,e)),r._padding&&(o.interpolatePadding(l,f,e),g=o.centerPoint.add(m));var y=1===e?v:o.unproject(_.add(x.mult(O(i))).mult(d));o.setLocationAtPoint(o.renderWorldCopies?y.wrap():y,g),r._fireMoveEvents(n)}),(function(){return r._afterEase(n)}),e),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){return this._stop()},n.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,e)}if(!t){var r=this.handlers;r&&r.stop(!1)}return this},n.prototype._ease=function(e,n,r){!1===r.animate||0===r.duration?(e(1),n()):(this._easeStart=t.browser.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(e,n){e=t.wrap(e,-180,180);var r=Math.abs(e-n);return Math.abs(e-360-n)<r&&(e-=360),Math.abs(e+360-n)<r&&(e+=360),e},n.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}},n}(t.Evented),_i=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};_i.prototype.getDefaultPosition=function(){return"bottom-right"},_i.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=n.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=n.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},_i.prototype.onRemove=function(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},_i.prototype._setElementTitle=function(t,e){var n=this._map._getUIString("AttributionControl."+e);t.title=n,t.setAttribute("aria-label",n)},_i.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},_i.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var r=n.reduce((function(t,e,r){return e.value&&(t+=e.key+"="+e.value+(r<n.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+r+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}},_i.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},_i.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var n=this._map.style.sourceCaches;for(var r in n){var i=n[r];if(i.used){var o=i.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((function(t,e){return t.length-e.length}));var a=(t=t.filter((function(e,n){for(var r=n+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}))).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},_i.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var xi=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};xi.prototype.onAdd=function(t){this._map=t,this._container=n.create("div","mapboxgl-ctrl");var e=n.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},xi.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},xi.prototype.getDefaultPosition=function(){return"bottom-left"},xi.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},xi.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},xi.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var bi=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};bi.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},bi.prototype.remove=function(t){for(var e=this._currentlyRunning,n=0,r=e?this._queue.concat(e):this._queue;n<r.length;n+=1){var i=r[n];if(i.id===t)return void(i.cancelled=!0)}},bi.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var n=0,r=e;n<r.length;n+=1){var i=r[n];if(!i.cancelled&&(i.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},bi.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var wi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Si=t.window.HTMLImageElement,Ei=t.window.HTMLElement,Ci=t.window.ImageBitmap,Mi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ti=function(r){function i(e){var n=this;if(null!=(e=t.extend({},Mi,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var i=new Sr(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(r.call(this,i,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new bi,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},wi,e.locale),this._clickTolerance=e.clickTolerance,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Ei))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return n._update(!1)})),this.on("moveend",(function(){return n._update(!1)})),this.on("zoom",(function(){return n._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new yi(this,e),this._hash=e.hash&&new Cr("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new _i({customAttribution:e.customAttribution})),this.addControl(new xi,e.logoPosition),this.on("style.load",(function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)})),this.on("data",(function(e){n._update("style"===e.dataType),n.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){n.fire(new t.Event(e.dataType+"dataloading",e))}))}r&&(i.__proto__=r),(i.prototype=Object.create(r&&r.prototype)).constructor=i;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=e.onAdd(this);this._controls.push(e);var i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this},i.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this},i.prototype.hasControl=function(t){return this._controls.indexOf(t)>-1},i.prototype.resize=function(e){var n=this._containerDimensions(),r=n[0],i=n[1];if(r===this.transform.width&&i===this.transform.height)return this;this._resizeCanvas(r,i),this.transform.resize(r,i),this.painter.resize(r,i);var o=!this._moving;return o&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),o&&this.fire(new t.Event("moveend",e)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},i.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},i.prototype.getMinPitch=function(){return this.transform.minPitch},i.prototype.setMaxPitch=function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},i.prototype.getMaxPitch=function(){return this.transform.maxPitch},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},i.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},i.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},i.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},i.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},i.prototype._createDelegatedListener=function(t,e,n){var r,i=this;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){var a=i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[];a.length?o||(o=!0,n.call(i,new Rr(t,i,r.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){(i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,n.call(i,new Rr(t,i,r.originalEvent)))},mouseout:function(e){a&&(a=!1,n.call(i,new Rr(t,i,e.originalEvent)))}}}}return{layer:e,listener:n,delegates:(r={},r[t]=function(t){var r=i.getLayer(e)?i.queryRenderedFeatures(t.point,{layers:[e]}):[];r.length&&(t.features=r,n.call(i,t),delete t.features)},r)}},i.prototype.on=function(t,e,n){if(void 0===n)return r.prototype.on.call(this,t,e);var i=this._createDelegatedListener(t,e,n);for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i),i.delegates)this.on(o,i.delegates[o]);return this},i.prototype.once=function(t,e,n){if(void 0===n)return r.prototype.once.call(this,t,e);var i=this._createDelegatedListener(t,e,n);for(var o in i.delegates)this.once(o,i.delegates[o]);return this},i.prototype.off=function(t,e,n){var i=this;return void 0===n?r.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(r){for(var o=r[t],a=0;a<o.length;a++){var s=o[a];if(s.layer===e&&s.listener===n){for(var u in s.delegates)i.off(u,s.delegates[u]);return o.splice(a,1),i}}}(this._delegatedListeners),this)},i.prototype.queryRenderedFeatures=function(e,n){if(!this.style)return[];var r;if(void 0!==n||void 0===e||e instanceof t.Point||Array.isArray(e)||(n=e,e=void 0),n=n||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])r=[t.Point.convert(e)];else{var i=t.Point.convert(e[0]),o=t.Point.convert(e[1]);r=[i,new t.Point(o.x,i.y),o,new t.Point(i.x,o.y),i]}return this.style.queryRenderedFeatures(r,n,this.transform)},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))},i.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},i.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Ve(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ve(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},i.prototype._diffStyle=function(e,n){var r=this;if("string"==typeof e){var i=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(i,t.ResourceType.Style);t.getJSON(o,(function(e,i){e?r.fire(new t.ErrorEvent(e)):i&&r._updateDiff(i,n)}))}else"object"==typeof e&&this._updateDiff(e,n)},i.prototype._updateDiff=function(e,n){try{this.style.setState(e)&&this._update(!0)}catch(r){t.warnOnce("Unable to perform style diff: "+(r.message||r.error||r)+".  Rebuilding the style from scratch."),this._updateStyle(e,n)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},i.prototype.isSourceLoaded=function(e){var n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var n=t[e]._tiles;for(var r in n){var i=n[r];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(e,n,r){void 0===r&&(r={});var i=r.pixelRatio;void 0===i&&(i=1);var o=r.sdf;void 0===o&&(o=!1);var a=r.stretchX,s=r.stretchY,u=r.content;if(this._lazyInitEmptyStyle(),n instanceof Si||Ci&&n instanceof Ci){var l=t.browser.getImageData(n);this.style.addImage(e,{data:new t.RGBAImage({width:l.width,height:l.height},l.data),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=n;this.style.addImage(e,{data:new t.RGBAImage({width:n.width,height:n.height},new Uint8Array(n.data)),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}},i.prototype.updateImage=function(e,n){var r=this.style.getImage(e);if(!r)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=n instanceof Si||Ci&&n instanceof Ci?t.browser.getImageData(n):n,o=i.width,a=i.height,s=i.data;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==r.data.width||a!==r.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(n instanceof Si||Ci&&n instanceof Ci)),void this.style.updateImage(e,r))},i.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),n)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)},i.prototype.setFilter=function(t,e,n){return void 0===n&&(n={}),this.style.setFilter(t,e,n),this._update(!0)},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setPaintProperty(t,e,n,r),this._update(!0)},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setLayoutProperty(t,e,n,r),this._update(!0)},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},i.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},i.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=n.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=n.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=n.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var i=this._controlContainer=n.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){o[t]=n.create("div","mapboxgl-ctrl-"+t,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},i.prototype._resizeCanvas=function(e,n){var r=t.browser.devicePixelRatio||1;this._canvas.width=r*e,this._canvas.height=r*n,this._canvas.style.width=e+"px",this._canvas.style.height=n+"px"},i.prototype._setupPainter=function(){var n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);r?(this.painter=new _r(r,this.transform),t.webpSupported.testSupport(r)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},i.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},i.prototype._onMapScroll=function(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},i.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},i.prototype._render=function(e){var n,r=this,i=0,o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,n),i=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,u=t.browser.now();this.style.zoomHistory.update(s,u);var l=new t.EvaluationParameters(s,{now:u,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=l.crossFadingFactor();1===c&&c===this._crossFadingFactor||(a=!0,this._crossFadingFactor=c),this.style.update(l)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=t.browser.now()-i;o.endQueryEXT(o.TIME_ELAPSED_EXT,n),setTimeout((function(){var e=o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(n),r.fire(new t.Event("gpu-timing-frame",{cpuTime:h,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var p=this.painter.collectGpuTimers();setTimeout((function(){var e=r.painter.queryGpuTimers(p);r.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0),this}},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,n=this._controls;e<n.length;e+=1)n[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),Ai(this._canvasContainer),Ai(this._controlContainer),Ai(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},i.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},i.prototype._setCacheLimits=function(e,n){t.setCacheLimits(e,n)},o.version.get=function(){return t.version},Object.defineProperties(i.prototype,o),i}(vi);function Ai(t){t.parentNode&&t.parentNode.removeChild(t)}var Pi={showCompass:!0,showZoom:!0,visualizePitch:!1},Li=function(e){var r=this;this.options=t.extend({},Pi,e),this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return r._map.zoomIn({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return r._map.zoomOut({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){r.options.visualizePitch?r._map.resetNorthPitch({},{originalEvent:t}):r._map.resetNorth({},{originalEvent:t})})),this._compassIcon=n.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Li.prototype._updateZoomButtons=function(){var t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},Li.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},Li.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ii(this._map,this._compass,this.options.visualizePitch)),this._container},Li.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Li.prototype._createButton=function(t,e){var r=n.create("button",t,this._container);return r.type="button",r.addEventListener("click",e),r},Li.prototype._setButtonTitle=function(t,e){var n=this._map._getUIString("NavigationControl."+e);t.title=n,t.setAttribute("aria-label",n)};var Ii=function(e,r,i){void 0===i&&(i=!1),this._clickTolerance=10,this.element=r,this.mouseRotate=new qr({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new Xr({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener(r,"mousedown",this.mousedown),n.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),n.addEventListener(r,"touchmove",this.touchmove),n.addEventListener(r,"touchend",this.touchend),n.addEventListener(r,"touchcancel",this.reset)};function ki(e,n,r){if(e=new t.LngLat(e.lng,e.lat),n){var i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=r.locationPoint(e).distSqr(n);r.locationPoint(i).distSqr(n)<a?e=i:r.locationPoint(o).distSqr(n)<a&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){var s=r.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}Ii.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),n.disableDrag()},Ii.prototype.move=function(t,e){var n=this.map,r=this.mouseRotate.mousemoveWindow(t,e);if(r&&r.bearingDelta&&n.setBearing(n.getBearing()+r.bearingDelta),this.mousePitch){var i=this.mousePitch.mousemoveWindow(t,e);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}},Ii.prototype.off=function(){var t=this.element;n.removeEventListener(t,"mousedown",this.mousedown),n.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),n.removeEventListener(t,"touchmove",this.touchmove),n.removeEventListener(t,"touchend",this.touchend),n.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},Ii.prototype.offTemp=function(){n.enableDrag(),n.removeEventListener(t.window,"mousemove",this.mousemove),n.removeEventListener(t.window,"mouseup",this.mouseup)},Ii.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),n.mousePos(this.element,e)),n.addEventListener(t.window,"mousemove",this.mousemove),n.addEventListener(t.window,"mouseup",this.mouseup)},Ii.prototype.mousemove=function(t){this.move(t,n.mousePos(this.element,t))},Ii.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},Ii.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},Ii.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},Ii.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ii.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Oi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ri(t,e,n){var r=t.classList;for(var i in Oi)r.remove("mapboxgl-"+n+"-anchor-"+i);r.add("mapboxgl-"+n+"-anchor-"+e)}var Di,Ni=function(e){function r(r,i){if(e.call(this),(r instanceof t.window.HTMLElement||i)&&(r=t.extend({element:r},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=t.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div"),this._element.setAttribute("aria-label","Map marker");var o=n.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=n.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=n.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var h=c[l],p=n.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),u.appendChild(p)}var f=n.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill",this._color);var d=n.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),f.appendChild(d);var m=n.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"fill","#000000");var g=n.createNS("http://www.w3.org/2000/svg","path");g.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),m.appendChild(g);var y=n.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),y.setAttributeNS(null,"fill","#FFFFFF");var v=n.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=n.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var x=n.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#FFFFFF"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962"),v.appendChild(_),v.appendChild(x),s.appendChild(u),s.appendChild(f),s.appendChild(m),s.appendChild(y),s.appendChild(v),o.appendChild(s),o.setAttributeNS(null,"height",41*this._scale+"px"),o.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(o),this._offset=t.Point.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),Ri(this._element,this._anchor,"marker"),this._popup=null}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},r.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},r.prototype.getElement=function(){return this._element},r.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},r.prototype._onKeyPress=function(t){var e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()},r.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},r.prototype.getPopup=function(){return this._popup},r.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},r.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ki(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),n.setTransform(this._element,Oi[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+r+" "+e)}},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},r.prototype._onMove=function(e){if(!this._isDragging){var n=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))},r.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},r.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},r.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},r.prototype.isDraggable=function(){return this._draggable},r.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},r.prototype.getRotation=function(){return this._rotation},r.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},r.prototype.getRotationAlignment=function(){return this._rotationAlignment},r.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},r.prototype.getPitchAlignment=function(){return this._pitchAlignment},r}(t.Evented),Fi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},zi=0,Bi=!1,ji=function(e){function r(n){e.call(this),this.options=t.extend({},Fi,n),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(e){var r;return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Di?r(Di):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){r(Di="denied"!==t.state)})):r(Di=!!t.window.navigator.geolocation),this._container},r.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zi=0,Bi=!1},r.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())},r.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},r.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},r.prototype._updateCamera=function(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),o,{geolocateSource:!0})},r.prototype._updateMarker=function(e){if(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},r.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),n=this._map.unproject([1,t]),r=e.distanceTo(n),i=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"},r.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},r.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Bi)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},r.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},r.prototype._setupUI=function(e){var r=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=n.create("button","mapboxgl-ctrl-geolocate",this._container),n.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{var o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ni(this._dotElement),this._circleElement=n.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ni({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==r._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(r._watchState="BACKGROUND",r._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),r._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),r.fire(new t.Event("trackuserlocationend")))}))},r.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zi--,Bi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++zi>1?(e={maximumAge:6e5,timeout:0},Bi=!0):(e=this.options.positionOptions,Bi=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},r.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},r}(t.Evented),Ui={maxWidth:100,unit:"metric"},Zi=function(e){this.options=t.extend({},Ui,e),t.bindAll(["_onMove","setUnit"],this)};function Vi(t,e,n){var r=n&&n.maxWidth||100,i=t._container.clientHeight/2,o=t.unproject([0,i]),a=t.unproject([r,i]),s=o.distanceTo(a);if(n&&"imperial"===n.unit){var u=3.2808*s;u>5280?Gi(e,r,u/5280,t._getUIString("ScaleControl.Miles")):Gi(e,r,u,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?Gi(e,r,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?Gi(e,r,s/1e3,t._getUIString("ScaleControl.Kilometers")):Gi(e,r,s,t._getUIString("ScaleControl.Meters"))}function Gi(t,e,n,r){var i,o,a,s=(i=n,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=(a=i/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a)));t.style.width=e*(s/n)+"px",t.innerHTML=s+"&nbsp;"+r}Zi.prototype.getDefaultPosition=function(){return"bottom-left"},Zi.prototype._onMove=function(){Vi(this._map,this._container,this.options)},Zi.prototype.onAdd=function(t){return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Zi.prototype.onRemove=function(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Zi.prototype.setUnit=function(t){this.options.unit=t,Vi(this._map,this._container,this.options)};var Hi=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};Hi.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Hi.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Hi.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Hi.prototype._setupUI=function(){var e=this._fullscreenButton=n.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);n.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Hi.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Hi.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Hi.prototype._isFullscreen=function(){return this._fullscreen},Hi.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Hi.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Wi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Xi=function(e){function r(n){e.call(this),this.options=t.extend(Object.create(Wi),n),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},r.prototype.isOpen=function(){return!!this._map},r.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},r.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},r.prototype.getElement=function(){return this._container},r.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},r.prototype.setHTML=function(e){var n,r=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");for(i.innerHTML=e;n=i.firstChild;)r.appendChild(n);return this.setDOMContent(r)},r.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},r.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},r.prototype.setDOMContent=function(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this},r.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},r.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},r.prototype.setOffset=function(t){return this.options.offset=t,this._update(),this},r.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},r.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=n.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},r.prototype._onMouseUp=function(t){this._update(t.point)},r.prototype._onMouseMove=function(t){this._update(t.point)},r.prototype._onDrag=function(t){this._update(t.point)},r.prototype._update=function(e){var r=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=n.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return r._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ki(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var i=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),o=this.options.anchor,a=function e(n){if(n){if("number"==typeof n){var r=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new t.Point(0,0),top:new t.Point(0,n),"top-left":new t.Point(r,r),"top-right":new t.Point(-r,r),bottom:new t.Point(0,-n),"bottom-left":new t.Point(r,-r),"bottom-right":new t.Point(-r,-r),left:new t.Point(n,0),right:new t.Point(-n,0)}}if(n instanceof t.Point||Array.isArray(n)){var i=t.Point.convert(n);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.Point.convert(n.center||[0,0]),top:t.Point.convert(n.top||[0,0]),"top-left":t.Point.convert(n["top-left"]||[0,0]),"top-right":t.Point.convert(n["top-right"]||[0,0]),bottom:t.Point.convert(n.bottom||[0,0]),"bottom-left":t.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(n["bottom-right"]||[0,0]),left:t.Point.convert(n.left||[0,0]),right:t.Point.convert(n.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!o){var s,u=this._container.offsetWidth,l=this._container.offsetHeight;s=i.y+a.bottom.y<l?["top"]:i.y>this._map.transform.height-l?["bottom"]:[],i.x<u/2?s.push("left"):i.x>this._map.transform.width-u/2&&s.push("right"),o=0===s.length?"bottom":s.join("-")}var c=i.add(a[o]).round();n.setTransform(this._container,Oi[o]+" translate("+c.x+"px,"+c.y+"px)"),Ri(this._container,o,"popup")}},r.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var t=this._container.querySelector(qi);t&&t.focus()}},r.prototype._onClose=function(){this.remove()},r}(t.Evented),Yi={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:Ti,NavigationControl:Li,GeolocateControl:ji,AttributionControl:_i,ScaleControl:Zi,FullscreenControl:Hi,Popup:Xi,Marker:Ni,Style:Ve,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,prewarm:function(){zt().acquire(Rt)},clearPrewarmedResources:function(){var t=Nt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Rt),Nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Dt.workerCount},set workerCount(t){Dt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return Yi})),n}()},7909:t=>{t.exports=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(n,r,i){if("function"!=typeof r)throw new Error("callback is expected to be a function");var o=e[n];return o||(o=e[n]=[]),o.push({callback:r,ctx:i}),t},off:function(n,r){if(void 0===n)return e=Object.create(null),t;if(e[n])if("function"!=typeof r)delete e[n];else for(var i=e[n],o=0;o<i.length;++o)i[o].callback===r&&i.splice(o,1);return t},fire:function(n){var r,i=e[n];if(!i)return t;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var o=0;o<i.length;++o){var a=i[o];a.callback.apply(a.ctx,r)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t}},201:(t,e,n)=>{t.exports=function(t,e){if(!t)throw new Error("Graph structure cannot be undefined");var o=(e&&e.createSimulator||n(9931))(e);if(Array.isArray(e))throw new Error("Physics settings is expected to be an object");var a=t.version>19?function(e){var n=t.getLinks(e);return n?1+n.size/3:1}:function(e){var n=t.getLinks(e);return n?1+n.length/3:1};e&&"function"==typeof e.nodeMass&&(a=e.nodeMass);var s=new Map,u={},l=0,c=o.settings.springTransform||i;l=0,t.forEachNode((function(t){g(t.id),l+=1})),t.forEachLink(y),t.on("changed",m);var h=!1,p={step:function(){if(0===l)return f(!0),!0;var t=o.step();p.lastMove=t,p.fire("step");var e=t/l<=.01;return f(e),e},getNodePosition:function(t){return x(t).pos},setNodePosition:function(t){var e=x(t);e.setPosition.apply(e,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(t){var e=u[t];if(e)return{from:e.from.pos,to:e.to.pos}},getGraphRect:function(){return o.getBBox()},forEachBody:d,pinNode:function(t,e){x(t.id).isPinned=!!e},isNodePinned:function(t){return x(t.id).isPinned},dispose:function(){t.off("changed",m),p.fire("disposed")},getBody:function(t){return s.get(t)},getSpring:function(e,n){var r;if(void 0===n)r="object"!=typeof e?e:e.id;else{var i=t.hasLink(e,n);if(!i)return;r=i.id}return u[r]},getForceVectorLength:function(){var t=0,e=0;return d((function(n){t+=Math.abs(n.force.x),e+=Math.abs(n.force.y)})),Math.sqrt(t*t+e*e)},simulator:o,graph:t,lastMove:0};return r(p),p;function f(t){var e;h!==t&&(h=t,e=t,p.fire("stable",e))}function d(t){s.forEach(t)}function m(e){for(var n=0;n<e.length;++n){var r=e[n];"add"===r.changeType?(r.node&&g(r.node.id),r.link&&y(r.link)):"remove"===r.changeType&&(r.node&&(i=r.node,a=void 0,u=void 0,a=i.id,(u=s.get(a))&&(s.delete(a),o.removeBody(u))),r.link&&v(r.link))}var i,a,u;l=t.getNodesCount()}function g(e){var n=s.get(e);if(!n){var r=t.getNode(e);if(!r)throw new Error("initBody() was called with unknown node id");var i=r.position;if(!i){var a=function(t){var e=[];if(!t.links)return e;for(var n=Math.min(t.links.length,2),r=0;r<n;++r){var i=t.links[r],o=i.fromId!==t.id?s.get(i.fromId):s.get(i.toId);o&&o.pos&&e.push(o)}return e}(r);i=o.getBestNewBodyPosition(a)}(n=o.addBodyAt(i)).id=e,s.set(e,n),_(e),function(t){return t&&(t.isPinned||t.data&&t.data.isPinned)}(r)&&(n.isPinned=!0)}}function y(t){_(t.fromId),_(t.toId);var e=s.get(t.fromId),n=s.get(t.toId),r=o.addSpring(e,n,t.length);c(t,r),u[t.id]=r}function v(e){var n=u[e.id];if(n){var r=t.getNode(e.fromId),i=t.getNode(e.toId);r&&_(r.id),i&&_(i.id),delete u[e.id],o.removeSpring(n)}}function _(t){var e=s.get(t);if(e.mass=a(t),Number.isNaN(e.mass))throw new Error("Node mass should be a number")}function x(t){var e=s.get(t);return e||(g(t),e=s.get(t)),e}},t.exports.simulator=n(9931);var r=n(7909);function i(){}},8135:(t,e,n)=>{const r=n(8418);t.exports=function(t){return function(e,n){let i=n&&n.indent||0,o=n&&void 0!==n.join?n.join:"\n",a=Array(i+1).join(" "),s=[];for(let n=0;n<t;++n){let t=r(n),i=0===n?"":a;s.push(i+e.replace(/{var}/g,t))}return s.join(o)}}},8392:(t,e,n)=>{t.exports=function(t){let e=i(t);return new Function("bodies","settings","random",e)},t.exports.generateFunctionBody=i;const r=n(8135);function i(t){let e=r(t);return`\n  var boundingBox = {\n    ${e("min_{var}: 0, max_{var}: 0,",{indent:4})}\n  };\n\n  return {\n    box: boundingBox,\n\n    update: updateBoundingBox,\n\n    reset: resetBoundingBox,\n\n    getBestNewPosition: function (neighbors) {\n      var ${e("base_{var} = 0",{join:", "})};\n\n      if (neighbors.length) {\n        for (var i = 0; i < neighbors.length; ++i) {\n          let neighborPos = neighbors[i].pos;\n          ${e("base_{var} += neighborPos.{var};",{indent:10})}\n        }\n\n        ${e("base_{var} /= neighbors.length;",{indent:8})}\n      } else {\n        ${e("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}\n      }\n\n      var springLength = settings.springLength;\n      return {\n        ${e("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}\n      };\n    }\n  };\n\n  function updateBoundingBox() {\n    var i = bodies.length;\n    if (i === 0) return; // No bodies - no borders.\n\n    ${e("var max_{var} = -Infinity;",{indent:4})}\n    ${e("var min_{var} = Infinity;",{indent:4})}\n\n    while(i--) {\n      // this is O(n), it could be done faster with quadtree, if we check the root node bounds\n      var bodyPos = bodies[i].pos;\n      ${e("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}\n      ${e("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}\n    }\n\n    ${e("boundingBox.min_{var} = min_{var};",{indent:4})}\n    ${e("boundingBox.max_{var} = max_{var};",{indent:4})}\n  }\n\n  function resetBoundingBox() {\n    ${e("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}\n  }\n`}},6928:(t,e,n)=>{const r=n(8135);function i(t,e){return`\n${a(t,e)}\n${o(t)}\nreturn {Body: Body, Vector: Vector};\n`}function o(t){let e=r(t),n=e("{var}",{join:", "});return`\nfunction Body(${n}) {\n  this.isPinned = false;\n  this.pos = new Vector(${n});\n  this.force = new Vector();\n  this.velocity = new Vector();\n  this.mass = 1;\n\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.reset = function() {\n  this.force.reset();\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.setPosition = function (${n}) {\n  ${e("this.pos.{var} = {var} || 0;",{indent:2})}\n};`}function a(t,e){let n=r(t),i="";return e&&(i=`${n("\n   var v{var};\nObject.defineProperty(this, '{var}', {\n  set: function(v) { \n    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');\n    v{var} = v; \n  },\n  get: function() { return v{var}; }\n});")}`),`function Vector(${n("{var}",{join:", "})}) {\n  ${i}\n    if (typeof arguments[0] === 'object') {\n      // could be another vector\n      let v = arguments[0];\n      ${n('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}\n      ${n("this.{var} = v.{var};",{indent:4})}\n    } else {\n      ${n('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}\n    }\n  }\n  \n  Vector.prototype.reset = function () {\n    ${n("this.{var} = ",{join:""})}0;\n  };`}t.exports=function(t,e){let n=i(t,e),{Body:r}=new Function(n)();return r},t.exports.generateCreateBodyFunctionBody=i,t.exports.getVectorCode=a,t.exports.getBodyCode=o},2054:(t,e,n)=>{const r=n(8135);function i(t){return`\n  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');\n\n  return {\n    update: function(body) {\n      ${r(t)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}\n    }\n  };\n`}t.exports=function(t){let e=i(t);return new Function("options",e)},t.exports.generateCreateDragForceFunctionBody=i},8237:(t,e,n)=>{const r=n(8135);function i(t){let e=r(t);return`\n  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');\n  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');\n\n  return {\n    /**\n     * Updates forces acting on a spring\n     */\n    update: function (spring) {\n      var body1 = spring.from;\n      var body2 = spring.to;\n      var length = spring.length < 0 ? options.springLength : spring.length;\n      ${e("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}\n      var r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n\n      if (r === 0) {\n        ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}\n        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n      }\n\n      var d = r - length;\n      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;\n\n      ${e("body1.force.{var} += coefficient * d{var}",{indent:6})};\n      body1.springCount += 1;\n      body1.springLength += r;\n\n      ${e("body2.force.{var} -= coefficient * d{var}",{indent:6})};\n      body2.springCount += 1;\n      body2.springLength += r;\n    }\n  };\n`}t.exports=function(t){let e=i(t);return new Function("options","random",e)},t.exports.generateCreateSpringForceFunctionBody=i},6851:(t,e,n)=>{const r=n(8135);function i(t){let e=r(t);return`\n  var length = bodies.length;\n  if (length === 0) return 0;\n\n  ${e("var d{var} = 0, t{var} = 0;",{indent:2})}\n\n  for (var i = 0; i < length; ++i) {\n    var body = bodies[i];\n    if (body.isPinned) continue;\n\n    if (adaptiveTimeStepWeight && body.springCount) {\n      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);\n    }\n\n    var coeff = timeStep / body.mass;\n\n    ${e("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}\n    ${e("var v{var} = body.velocity.{var};",{indent:4})}\n    var v = Math.sqrt(${e("v{var} * v{var}",{join:" + "})});\n\n    if (v > 1) {\n      // We normalize it so that we move within timeStep range. \n      // for the case when v <= 1 - we let velocity to fade out.\n      ${e("body.velocity.{var} = v{var} / v;",{indent:6})}\n    }\n\n    ${e("d{var} = timeStep * body.velocity.{var};",{indent:4})}\n\n    ${e("body.pos.{var} += d{var};",{indent:4})}\n\n    ${e("t{var} += Math.abs(d{var});",{indent:4})}\n  }\n\n  return (${e("t{var} * t{var}",{join:" + "})})/length;\n`}t.exports=function(t){let e=i(t);return new Function("bodies","timeStep","adaptiveTimeStepWeight",e)},t.exports.generateIntegratorFunctionBody=i},9905:(t,e,n)=>{const r=n(8135),i=n(8418);function o(t){let e=r(t),n=Math.pow(2,t);return`\n\n/**\n * Our implementation of QuadTree is non-recursive to avoid GC hit\n * This data structure represent stack of elements\n * which we are trying to insert into quad tree.\n */\nfunction InsertStack () {\n    this.stack = [];\n    this.popIdx = 0;\n}\n\nInsertStack.prototype = {\n    isEmpty: function() {\n        return this.popIdx === 0;\n    },\n    push: function (node, body) {\n        var item = this.stack[this.popIdx];\n        if (!item) {\n            // we are trying to avoid memory pressure: create new element\n            // only when absolutely necessary\n            this.stack[this.popIdx] = new InsertStackElement(node, body);\n        } else {\n            item.node = node;\n            item.body = body;\n        }\n        ++this.popIdx;\n    },\n    pop: function () {\n        if (this.popIdx > 0) {\n            return this.stack[--this.popIdx];\n        }\n    },\n    reset: function () {\n        this.popIdx = 0;\n    }\n};\n\nfunction InsertStackElement(node, body) {\n    this.node = node; // QuadTree node\n    this.body = body; // physical body which needs to be inserted to node\n}\n\n${l(t)}\n${a(t)}\n${u(t)}\n${s(t)}\n\nfunction createQuadTree(options, random) {\n  options = options || {};\n  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;\n  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;\n\n  var gravity = options.gravity;\n  var updateQueue = [];\n  var insertStack = new InsertStack();\n  var theta = options.theta;\n\n  var nodesCache = [];\n  var currentInCache = 0;\n  var root = newNode();\n\n  return {\n    insertBodies: insertBodies,\n\n    /**\n     * Gets root node if it is present\n     */\n    getRoot: function() {\n      return root;\n    },\n\n    updateBodyForce: update,\n\n    options: function(newOptions) {\n      if (newOptions) {\n        if (typeof newOptions.gravity === 'number') {\n          gravity = newOptions.gravity;\n        }\n        if (typeof newOptions.theta === 'number') {\n          theta = newOptions.theta;\n        }\n\n        return this;\n      }\n\n      return {\n        gravity: gravity,\n        theta: theta\n      };\n    }\n  };\n\n  function newNode() {\n    // To avoid pressure on GC we reuse nodes.\n    var node = nodesCache[currentInCache];\n    if (node) {\n${function(t){let e=[];for(let t=0;t<n;++t)e.push(`      node.quad${t} = null;`);return e.join("\n")}()}\n      node.body = null;\n      node.mass = ${e("node.mass_{var} = ",{join:""})}0;\n      ${e("node.min_{var} = node.max_{var} = ",{join:""})}0;\n    } else {\n      node = new QuadNode();\n      nodesCache[currentInCache] = node;\n    }\n\n    ++currentInCache;\n    return node;\n  }\n\n  function update(sourceBody) {\n    var queue = updateQueue;\n    var v;\n    ${e("var d{var};",{indent:4})}\n    var r; \n    ${e("var f{var} = 0;",{indent:4})}\n    var queueLength = 1;\n    var shiftIdx = 0;\n    var pushIdx = 1;\n\n    queue[0] = root;\n\n    while (queueLength) {\n      var node = queue[shiftIdx];\n      var body = node.body;\n\n      queueLength -= 1;\n      shiftIdx += 1;\n      var differentBody = (body !== sourceBody);\n      if (body && differentBody) {\n        // If the current node is a leaf node (and it is not source body),\n        // calculate the force exerted by the current node on body, and add this\n        // amount to body's net force.\n        ${e("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Poor man's protection against zero distance.\n          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n        }\n\n        // This is standard gravitation force calculation but we divide\n        // by r^3 to save two operations when normalizing force vector.\n        v = gravity * body.mass * sourceBody.mass / (r * r * r);\n        ${e("f{var} += v * d{var};",{indent:8})}\n      } else if (differentBody) {\n        // Otherwise, calculate the ratio s / r,  where s is the width of the region\n        // represented by the internal node, and r is the distance between the body\n        // and the node's center-of-mass\n        ${e("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Sorry about code duplication. I don't want to create many functions\n          // right away. Just want to see performance first.\n          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n        }\n        // If s / r < θ, treat this internal node as a single body, and calculate the\n        // force it exerts on sourceBody, and add this amount to sourceBody's net force.\n        if ((node.max_${i(0)} - node.min_${i(0)}) / r < theta) {\n          // in the if statement above we consider node's width only\n          // because the region was made into square during tree creation.\n          // Thus there is no difference between using width or height.\n          v = gravity * node.mass * sourceBody.mass / (r * r * r);\n          ${e("f{var} += v * d{var};",{indent:10})}\n        } else {\n          // Otherwise, run the procedure recursively on each of the current node's children.\n\n          // I intentionally unfolded this loop, to save several CPU cycles.\n${function(){let t=Array(11).join(" "),e=[];for(let r=0;r<n;++r)e.push(t+`if (node.quad${r}) {`),e.push(t+`  queue[pushIdx] = node.quad${r};`),e.push(t+"  queueLength += 1;"),e.push(t+"  pushIdx += 1;"),e.push(t+"}");return e.join("\n")}()}\n        }\n      }\n    }\n\n    ${e("sourceBody.force.{var} += f{var};",{indent:4})}\n  }\n\n  function insertBodies(bodies) {\n    ${e("var {var}min = Number.MAX_VALUE;",{indent:4})}\n    ${e("var {var}max = Number.MIN_VALUE;",{indent:4})}\n    var i = bodies.length;\n\n    // To reduce quad tree depth we are looking for exact bounding box of all particles.\n    while (i--) {\n      var pos = bodies[i].pos;\n      ${e("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}\n      ${e("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}\n    }\n\n    // Makes the bounds square.\n    var maxSideLength = -Infinity;\n    ${e("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}\n\n    currentInCache = 0;\n    root = newNode();\n    ${e("root.min_{var} = {var}min;",{indent:4})}\n    ${e("root.max_{var} = {var}min + maxSideLength;",{indent:4})}\n\n    i = bodies.length - 1;\n    if (i >= 0) {\n      root.body = bodies[i];\n    }\n    while (i--) {\n      insert(bodies[i], root);\n    }\n  }\n\n  function insert(newBody) {\n    insertStack.reset();\n    insertStack.push(root, newBody);\n\n    while (!insertStack.isEmpty()) {\n      var stackItem = insertStack.pop();\n      var node = stackItem.node;\n      var body = stackItem.body;\n\n      if (!node.body) {\n        // This is internal node. Update the total mass of the node and center-of-mass.\n        ${e("var {var} = body.pos.{var};",{indent:8})}\n        node.mass += body.mass;\n        ${e("node.mass_{var} += body.mass * {var};",{indent:8})}\n\n        // Recursively insert the body in the appropriate quadrant.\n        // But first find the appropriate quadrant.\n        var quadIdx = 0; // Assume we are in the 0's quad.\n        ${e("var min_{var} = node.min_{var};",{indent:8})}\n        ${e("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}\n\n${function(e){let n=[],r=Array(9).join(" ");for(let e=0;e<t;++e)n.push(r+`if (${i(e)} > max_${i(e)}) {`),n.push(r+`  quadIdx = quadIdx + ${Math.pow(2,e)};`),n.push(r+`  min_${i(e)} = max_${i(e)};`),n.push(r+`  max_${i(e)} = node.max_${i(e)};`),n.push(r+"}");return n.join("\n")}()}\n\n        var child = getChild(node, quadIdx);\n\n        if (!child) {\n          // The node is internal but this quadrant is not taken. Add\n          // subnode to it.\n          child = newNode();\n          ${e("child.min_{var} = min_{var};",{indent:10})}\n          ${e("child.max_{var} = max_{var};",{indent:10})}\n          child.body = body;\n\n          setChild(node, quadIdx, child);\n        } else {\n          // continue searching in this quadrant.\n          insertStack.push(child, body);\n        }\n      } else {\n        // We are trying to add to the leaf node.\n        // We have to convert current leaf into internal node\n        // and continue adding two nodes.\n        var oldBody = node.body;\n        node.body = null; // internal nodes do not cary bodies\n\n        if (isSamePosition(oldBody.pos, body.pos)) {\n          // Prevent infinite subdivision by bumping one node\n          // anywhere in this quadrant\n          var retriesCount = 3;\n          do {\n            var offset = random.nextDouble();\n            ${e("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}\n\n            ${e("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}\n            retriesCount -= 1;\n            // Make sure we don't bump it out of the box. If we do, next iteration should fix it\n          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));\n\n          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {\n            // This is very bad, we ran out of precision.\n            // if we do not return from the method we'll get into\n            // infinite loop here. So we sacrifice correctness of layout, and keep the app running\n            // Next layout iteration should get larger bounding box in the first step and fix this\n            return;\n          }\n        }\n        // Next iteration should subdivide node further.\n        insertStack.push(node, oldBody);\n        insertStack.push(node, body);\n      }\n    }\n  }\n}\nreturn createQuadTree;\n\n`}function a(t){let e=r(t);return`\n  function isSamePosition(point1, point2) {\n    ${e("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}\n  \n    return ${e("d{var} < 1e-8",{join:" && "})};\n  }  \n`}function s(t){var e=Math.pow(2,t);return`\nfunction setChild(node, idx, child) {\n  ${function(){let t=[];for(let n=0;n<e;++n){let e=0===n?"  ":"  else ";t.push(`${e}if (idx === ${n}) node.quad${n} = child;`)}return t.join("\n")}()}\n}`}function u(t){return`function getChild(node, idx) {\n${function(){let e=[],n=Math.pow(2,t);for(let t=0;t<n;++t)e.push(`  if (idx === ${t}) return node.quad${t};`);return e.join("\n")}()}\n  return null;\n}`}function l(t){let e=r(t),n=Math.pow(2,t);return`\nfunction QuadNode() {\n  // body stored inside this node. In quad tree only leaf nodes (by construction)\n  // contain bodies:\n  this.body = null;\n\n  // Child nodes are stored in quads. Each quad is presented by number:\n  // 0 | 1\n  // -----\n  // 2 | 3\n${function(t){let e=[];for(let t=0;t<n;++t)e.push(`  this.quad${t} = null;`);return e.join("\n")}()}\n\n  // Total mass of current node\n  this.mass = 0;\n\n  // Center of mass coordinates\n  ${e("this.mass_{var} = 0;",{indent:2})}\n\n  // bounding box coordinates\n  ${e("this.min_{var} = 0;",{indent:2})}\n  ${e("this.max_{var} = 0;",{indent:2})}\n}\n`}function c(){return"\n/**\n * Our implementation of QuadTree is non-recursive to avoid GC hit\n * This data structure represent stack of elements\n * which we are trying to insert into quad tree.\n */\nfunction InsertStack () {\n    this.stack = [];\n    this.popIdx = 0;\n}\n\nInsertStack.prototype = {\n    isEmpty: function() {\n        return this.popIdx === 0;\n    },\n    push: function (node, body) {\n        var item = this.stack[this.popIdx];\n        if (!item) {\n            // we are trying to avoid memory pressure: create new element\n            // only when absolutely necessary\n            this.stack[this.popIdx] = new InsertStackElement(node, body);\n        } else {\n            item.node = node;\n            item.body = body;\n        }\n        ++this.popIdx;\n    },\n    pop: function () {\n        if (this.popIdx > 0) {\n            return this.stack[--this.popIdx];\n        }\n    },\n    reset: function () {\n        this.popIdx = 0;\n    }\n};\n\nfunction InsertStackElement(node, body) {\n    this.node = node; // QuadTree node\n    this.body = body; // physical body which needs to be inserted to node\n}\n"}t.exports=function(t){let e=o(t);return new Function(e)()},t.exports.generateQuadTreeFunctionBody=o,t.exports.getInsertStackCode=c,t.exports.getQuadNodeCode=l,t.exports.isSamePosition=a,t.exports.getChildBodyCode=u,t.exports.setChildBodyCode=s},8418:t=>{t.exports=function(t){return 0===t?"x":1===t?"y":2===t?"z":"c"+(t+1)}},9931:(t,e,n)=>{t.exports=function(t){var e=n(8443),h=n(8103),p=n(7909);if(t){if(void 0!==t.springCoeff)throw new Error("springCoeff was renamed to springCoefficient");if(void 0!==t.dragCoeff)throw new Error("dragCoeff was renamed to dragCoefficient")}t=h(t,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var f=l[t.dimensions];if(!f){var d=t.dimensions;f={Body:r(d,t.debug),createQuadTree:i(d),createBounds:o(d),createDragForce:a(d),createSpringForce:s(d),integrate:u(d)},l[d]=f}var m=f.Body,g=f.createQuadTree,y=f.createBounds,v=f.createDragForce,_=f.createSpringForce,x=f.integrate,b=n(6171).random(42),w=[],S=[],E=g(t,b),C=y(w,t,b),M=_(t,b),T=v(t),A=[],P=new Map,L=0;O("nbody",(function(){if(0!==w.length){E.insertBodies(w);for(var t=w.length;t--;){var e=w[t];e.isPinned||(e.reset(),E.updateBodyForce(e),T.update(e))}}})),O("spring",(function(){for(var t=S.length;t--;)M.update(S[t])}));var I={bodies:w,quadTree:E,springs:S,settings:t,addForce:O,removeForce:function(t){var e=A.indexOf(P.get(t));e<0||(A.splice(e,1),P.delete(t))},getForces:function(){return P},step:function(){for(var e=0;e<A.length;++e)A[e](L);var n=x(w,t.timeStep,t.adaptiveTimeStepWeight);return L+=1,n},addBody:function(t){if(!t)throw new Error("Body is required");return w.push(t),t},addBodyAt:function(t){if(!t)throw new Error("Body position is required");var e=(t=>new m(t))(t);return w.push(e),e},removeBody:function(t){if(t){var e=w.indexOf(t);if(!(e<0))return w.splice(e,1),0===w.length&&C.reset(),!0}},addSpring:function(t,n,r,i){if(!t||!n)throw new Error("Cannot add null spring to force simulator");"number"!=typeof r&&(r=-1);var o=new e(t,n,r,i>=0?i:-1);return S.push(o),o},getTotalMovement:function(){return 0},removeSpring:function(t){if(t){var e=S.indexOf(t);return e>-1?(S.splice(e,1),!0):void 0}},getBestNewBodyPosition:function(t){return C.getBestNewPosition(t)},getBBox:k,getBoundingBox:k,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(e){return void 0!==e?(t.gravity=e,E.options({gravity:e}),this):t.gravity},theta:function(e){return void 0!==e?(t.theta=e,E.options({theta:e}),this):t.theta},random:b};return function(t,e){for(var n in t)c(t,e,n)}(t,I),p(I),I;function k(){return C.update(),C.box}function O(t,e){if(P.has(t))throw new Error("Force "+t+" is already added");P.set(t,e),A.push(e)}};var r=n(6928),i=n(9905),o=n(8392),a=n(2054),s=n(8237),u=n(6851),l={};function c(t,e,n){if(t.hasOwnProperty(n)&&"function"!=typeof e[n]){var r=Number.isFinite(t[n]);e[n]=r?function(r){if(void 0!==r){if(!Number.isFinite(r))throw new Error("Value of "+n+" should be a valid number.");return t[n]=r,e}return t[n]}:function(r){return void 0!==r?(t[n]=r,e):t[n]}}}},8443:t=>{t.exports=function(t,e,n,r){this.from=t,this.to=e,this.length=n,this.coefficient=r}},7926:(t,e,n)=>{t.exports=function(t){if("uniqueLinkId"in(t=t||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),t.multigraph=t.uniqueLinkId),void 0===t.multigraph&&(t.multigraph=!1),"function"!=typeof Map)throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e,n=new Map,u=new Map,l={},c=0,h=t.multigraph?function(t,e,n){var r=s(t,e),i=l.hasOwnProperty(r);if(i||M(t,e)){i||(l[r]=0);var o="@"+ ++l[r];r=s(t+o,e+o)}return new a(t,e,n,r)}:function(t,e,n){var r=s(t,e),i=u.get(r);return i?(i.data=n,i):new a(t,e,n,r)},p=[],f=T,d=T,m=T,g=T,y={version:20,addNode:x,addLink:function(t,e,n){m();var r=b(t)||x(t),i=b(e)||x(e),a=h(t,e,n),s=u.has(a.id);return u.set(a.id,a),o(r,a),t!==e&&o(i,a),f(a,s?"update":"add"),g(),a},removeLink:function(t,e){return void 0!==e&&(t=M(t,e)),C(t)},removeNode:w,getNode:b,getNodeCount:S,getLinkCount:E,getEdgeCount:E,getLinksCount:E,getNodesCount:S,getLinks:function(t){var e=b(t);return e?e.links:null},forEachNode:L,forEachLinkedNode:function(t,e,r){var i=b(t);if(i&&i.links&&"function"==typeof e)return r?function(t,e,r){for(var i=t.values(),o=i.next();!o.done;){var a=o.value;if(a.fromId===e&&r(n.get(a.toId),a))return!0;o=i.next()}}(i.links,t,e):function(t,e,r){for(var i=t.values(),o=i.next();!o.done;){var a=o.value,s=a.fromId===e?a.toId:a.fromId;if(r(n.get(s),a))return!0;o=i.next()}}(i.links,t,e)},forEachLink:function(t){if("function"==typeof t)for(var e=u.values(),n=e.next();!n.done;){if(t(n.value))return!0;n=e.next()}},beginUpdate:m,endUpdate:g,clear:function(){m(),L((function(t){w(t.id)})),g()},hasLink:M,hasNode:b,getLink:M};return r(y),e=y.on,y.on=function(){return y.beginUpdate=m=A,y.endUpdate=g=P,f=v,d=_,y.on=e,e.apply(y,arguments)},y;function v(t,e){p.push({link:t,changeType:e})}function _(t,e){p.push({node:t,changeType:e})}function x(t,e){if(void 0===t)throw new Error("Invalid node identifier");m();var r=b(t);return r?(r.data=e,d(r,"update")):(r=new i(t,e),d(r,"add")),n.set(t,r),g(),r}function b(t){return n.get(t)}function w(t){var e=b(t);if(!e)return!1;m();var r=e.links;return r&&(r.forEach(C),e.links=null),n.delete(t),d(e,"remove"),g(),!0}function S(){return n.size}function E(){return u.size}function C(t){if(!t)return!1;if(!u.get(t.id))return!1;m(),u.delete(t.id);var e=b(t.fromId),n=b(t.toId);return e&&e.links.delete(t),n&&n.links.delete(t),f(t,"remove"),g(),!0}function M(t,e){if(void 0!==t&&void 0!==e)return u.get(s(t,e))}function T(){}function A(){c+=1}function P(){0==(c-=1)&&p.length>0&&(y.fire("changed",p),p.length=0)}function L(t){if("function"!=typeof t)throw new Error("Function is expected to iterate over graph nodes. You passed "+t);for(var e=n.values(),r=e.next();!r.done;){if(t(r.value))return!0;r=e.next()}}};var r=n(7909);function i(t,e){this.id=t,this.links=null,this.data=e}function o(t,e){t.links?t.links.add(e):t.links=new Set([e])}function a(t,e,n,r){this.fromId=t,this.toId=e,this.data=n,this.id=r}function s(t,e){return t.toString()+"👉 "+e.toString()}},8103:t=>{t.exports=function t(e,n){var r;if(e||(e={}),n)for(r in n)if(n.hasOwnProperty(r)){var i=e.hasOwnProperty(r),o=typeof n[r];i&&typeof e[r]===o?"object"===o&&(e[r]=t(e[r],n[r])):e[r]=n[r]}return e}},6171:t=>{function e(t){return new n("number"==typeof t?t:+new Date)}function n(t){this.seed=t}function r(t){return Math.sqrt(2*Math.PI/t)*Math.pow(1/Math.E*(t+1/(12*t-1/(10*t))),t)}function i(){var t=this.seed;return t=4294967295&(3042594569^(t=4251993797+(t=4294967295&(3550635116+(t=374761393+(t=4294967295&(3345072700^(t=t+2127912214+(t<<12)&4294967295)^t>>>19))+(t<<5)&4294967295)^t<<9))+(t<<3)&4294967295)^t>>>16),this.seed=t,(268435455&t)/268435456}t.exports=e,t.exports.random=e,t.exports.randomIterator=function(t,n){var r=n||e();if("function"!=typeof r.next)throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:function(e){var n,i,o;for(n=t.length-1;n>0;--n)i=r.next(n+1),o=t[i],t[i]=t[n],t[n]=o,e(o);t.length&&e(t[0])},shuffle:function(){var e,n,i;for(e=t.length-1;e>0;--e)n=r.next(e+1),i=t[n],t[n]=t[e],t[e]=i;return t}}},n.prototype.next=function(t){return Math.floor(this.nextDouble()*t)},n.prototype.nextDouble=i,n.prototype.uniform=i,n.prototype.gaussian=function(){var t,e,n;do{t=(e=2*this.nextDouble()-1)*e+(n=2*this.nextDouble()-1)*n}while(t>=1||0===t);return e*Math.sqrt(-2*Math.log(t)/t)},n.prototype.levy=function(){var t=1.5,e=Math.pow(r(2.5)*Math.sin(Math.PI*t/2)/(r(1.25)*t*Math.pow(2,.25)),1/t);return this.gaussian()*e/Math.pow(Math.abs(this.gaussian()),1/t)}},2458:t=>{"use strict";var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function i(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,o){for(var a,s,u=i(t),l=1;l<arguments.length;l++){for(var c in a=Object(arguments[l]))n.call(a,c)&&(u[c]=a[c]);if(e){s=e(a);for(var h=0;h<s.length;h++)r.call(a,s[h])&&(u[s[h]]=a[s[h]])}}return u}},6434:t=>{"use strict";var e=function(t){return t!=t};t.exports=function(t,n){return 0===t&&0===n?1/t==1/n:t===n||!(!e(t)||!e(n))}},2641:(t,e,n)=>{"use strict";var r=n(6699),i=n(5592),o=n(6434),a=n(5669),s=n(9525),u=i(a(),Object);r(u,{getPolyfill:a,implementation:o,shim:s}),t.exports=u},5669:(t,e,n)=>{"use strict";var r=n(6434);t.exports=function(){return"function"==typeof Object.is?Object.is:r}},9525:(t,e,n)=>{"use strict";var r=n(5669),i=n(6699);t.exports=function(){var t=r();return i(Object,{is:t},{is:function(){return Object.is!==t}}),t}},3032:(t,e,n)=>{"use strict";var r;if(!Object.keys){var i=Object.prototype.hasOwnProperty,o=Object.prototype.toString,a=n(9473),s=Object.prototype.propertyIsEnumerable,u=!s.call({toString:null},"toString"),l=s.call((function(){}),"prototype"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(t){var e=t.constructor;return e&&e.prototype===t},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!p["$"+t]&&i.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{h(window[t])}catch(t){return!0}}catch(t){return!0}return!1}();r=function(t){var e=null!==t&&"object"==typeof t,n="[object Function]"===o.call(t),r=a(t),s=e&&"[object String]"===o.call(t),p=[];if(!e&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var d=l&&n;if(s&&t.length>0&&!i.call(t,0))for(var m=0;m<t.length;++m)p.push(String(m));if(r&&t.length>0)for(var g=0;g<t.length;++g)p.push(String(g));else for(var y in t)d&&"prototype"===y||!i.call(t,y)||p.push(String(y));if(u)for(var v=function(t){if("undefined"==typeof window||!f)return h(t);try{return h(t)}catch(t){return!1}}(t),_=0;_<c.length;++_)v&&"constructor"===c[_]||!i.call(t,c[_])||p.push(c[_]);return p}}t.exports=r},3571:(t,e,n)=>{"use strict";var r=Array.prototype.slice,i=n(9473),o=Object.keys,a=o?function(t){return o(t)}:n(3032),s=Object.keys;a.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return i(t)?s(r.call(t)):s(t)})}else Object.keys=a;return Object.keys||a},t.exports=a},9473:t=>{"use strict";var e=Object.prototype.toString;t.exports=function(t){var n=e.call(t),r="[object Arguments]"===n;return r||(r="[object Array]"!==n&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===e.call(t.callee)),r}},997:(t,e,n)=>{"use strict";t.exports=i;var r=n(7164);function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,a=1/o,s="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function u(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function l(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function c(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function h(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function p(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function f(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function d(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function m(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function g(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function y(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function v(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function _(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function x(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function b(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=x(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=x(this.buf,this.pos)+x(this.buf,this.pos+4)*o;return this.pos+=8,t},readSFixed64:function(){var t=x(this.buf,this.pos)+w(this.buf,this.pos+4)*o;return this.pos+=8,t},readFloat:function(){var t=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return l(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return l(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return l(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return l(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return l(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return l(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&s?function(t,e,n){return s.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var r="",i=e;i<n;){var o,a,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==i.Bytes)return t.push(this.readVarint(e));var n=u(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==i.Bytes)return t.push(this.readSVarint());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==i.Bytes)return t.push(this.readBoolean());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==i.Bytes)return t.push(this.readFloat());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==i.Bytes)return t.push(this.readDouble());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed32());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed32());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed64());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed64());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&c(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),r.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),r.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&c(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,i.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,v,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,_,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},2980:t=>{t.exports=function(t,e,n,r){var i=t[0],o=t[1],a=!1;void 0===n&&(n=0),void 0===r&&(r=e.length);for(var s=(r-n)/2,u=0,l=s-1;u<s;l=u++){var c=e[n+2*u+0],h=e[n+2*u+1],p=e[n+2*l+0],f=e[n+2*l+1];h>o!=f>o&&i<(p-c)*(o-h)/(f-h)+c&&(a=!a)}return a}},1807:(t,e,n)=>{var r=n(2980),i=n(375);t.exports=function(t,e,n,o){return e.length>0&&Array.isArray(e[0])?i(t,e,n,o):r(t,e,n,o)},t.exports.nested=i,t.exports.flat=r},375:t=>{t.exports=function(t,e,n,r){var i=t[0],o=t[1],a=!1;void 0===n&&(n=0),void 0===r&&(r=e.length);for(var s=r-n,u=0,l=s-1;u<s;l=u++){var c=e[u+n][0],h=e[u+n][1],p=e[l+n][0],f=e[l+n][1];h>o!=f>o&&i<(p-c)*(o-h)/(f-h)+c&&(a=!a)}return a}},7516:function(t){t.exports=function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}var r=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function i(t,e){return t>e?1:t<e?-1:0}function o(t,e,n){for(var i=new r(null,null),o=i,a=i;;){var s=n(t,e.key);if(s<0){if(null===e.left)break;if(n(t,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,null===(e=u).left)break}a.left=e,a=e,e=e.left}else{if(!(s>0))break;if(null===e.right)break;if(n(t,e.right.key)>0&&(u=e.right,e.right=u.left,u.left=e,null===(e=u).right))break;o.right=e,o=e,e=e.right}}return o.right=e.left,a.left=e.right,e.left=i.right,e.right=i.left,e}function a(t,e,n,i){var a=new r(t,e);if(null===n)return a.left=a.right=null,a;var s=i(t,(n=o(t,n,i)).key);return s<0?(a.left=n.left,a.right=n,n.left=null):s>=0&&(a.right=n.right,a.left=n,n.right=null),a}function s(t,e,n){var r=null,i=null;if(e){var a=n((e=o(t,e,n)).key,t);0===a?(r=e.left,i=e.right):a<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function u(t,e,n,r,i){if(t){r(e+(n?"└── ":"├── ")+i(t)+"\n");var o=e+(n?"    ":"│   ");t.left&&u(t.left,o,!1,r,i),t.right&&u(t.right,o,!0,r,i)}}var l=function(){function t(t){void 0===t&&(t=i),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=a(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var n=new r(t,e);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,a=o(t,this._root,i),s=i(t,a.key);return 0===s?this._root=a:(s<0?(n.left=a.left,n.right=a,a.left=null):s>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,n){var r;return null===e?null:0===n(t,(e=o(t,e,n)).key)?(null===e.left?r=e.right:(r=o(t,e.left,n)).right=e.right,this._size--,r):e},t.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=o(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=o(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this},t.prototype.range=function(t,e,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,e)>0)break;if(o(a.key,t)>=0&&n.call(r,a))return this;a=a.right}return this},t.prototype.keys=function(){var t=[];return this.forEach((function(e){var n=e.key;return t.push(n)})),t},t.prototype.values=function(){var t=[];return this.forEach((function(e){var n=e.data;return t.push(n)})),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},t.prototype.at=function(t){for(var e=this._root,n=!1,r=0,i=[];!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null},t.prototype.next=function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n},t.prototype.prev=function(t){var e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return function(t){for(var e=t,n=[],i=!1,o=new r(null,null),a=o;!i;)e?(n.push(e),e=e.left):n.length>0?e=(e=a=a.next=n.pop()).right:i=!0;return a.next=null,o.next}(this._root)},t.prototype.load=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!1);var i=t.length,o=this._comparator;if(n&&p(t,e,0,i-1,o),null===this._root)this._root=c(t,e,0,i),this._size=i;else{var a=function(t,e,n){for(var i=new r(null,null),o=i,a=t,s=e;null!==a&&null!==s;)n(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}(this.toList(),function(t,e){for(var n=new r(null,null),i=n,o=0;o<t.length;o++)i=i.next=new r(t[o],e[o]);return i.next=null,n.next}(t,e),o);i=this._size+i,this._root=h({head:a},0,i)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return u(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},t.prototype.update=function(t,e,n){var r=this._comparator,i=s(t,this._root,r),u=i.left,l=i.right;r(t,e)<0?l=a(e,n,l,r):u=a(e,n,u,r),this._root=function(t,e,n){return null===e?t:(null===t||((e=o(t.key,e,n)).left=t),e)}(u,l,r)},t.prototype.split=function(t){return s(t,this._root,this._comparator)},t}();function c(t,e,n,i){var o=i-n;if(o>0){var a=n+Math.floor(o/2),s=t[a],u=e[a],l=new r(s,u);return l.left=c(t,e,n,a),l.right=c(t,e,a+1,i),l}return null}function h(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),o=h(t,e,i),a=t.head;return a.left=o,t.head=t.head.next,a.right=h(t,i+1,n),a}return null}function p(t,e,n,r,i){if(!(n>=r)){for(var o=t[n+r>>1],a=n-1,s=r+1;;){do{a++}while(i(t[a],o)<0);do{s--}while(i(t[s],o)>0);if(a>=s)break;var u=t[a];t[a]=t[s],t[s]=u,u=e[a],e[a]=e[s],e[s]=u}p(t,e,n,s,i),p(t,e,s+1,r,i)}}var f=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},d=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},m=Number.EPSILON;void 0===m&&(m=Math.pow(2,-52));var g=m*m,y=function(t,e){if(-m<t&&t<m&&-m<e&&e<m)return 0;var n=t-e;return n*n<g*t*e?0:t<e?-1:1},v=function(){function e(){t(this,e),this.reset()}return n(e,[{key:"reset",value:function(){this.xRounder=new _,this.yRounder=new _}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),e}(),_=function(){function e(){t(this,e),this.tree=new l,this.round(0)}return n(e,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===y(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===y(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),e}(),x=new v,b=function(t,e){return t.x*e.y-t.y*e.x},w=function(t,e){return t.x*e.x+t.y*e.y},S=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=b(r,i);return y(o,0)},E=function(t){return Math.sqrt(w(t,t))},C=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return w(i,r)/E(i)/E(r)},M=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},T=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},A=function(){function e(n,r){t(this,e),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=r}return n(e,null,[{key:"compare",value:function(t,n){var r=e.comparePoints(t.point,n.point);return 0!==r?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:L.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),n(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i,o,a,s,u,l=r.otherSE;n.set(r,{sine:(i=e.point,o=t.point,a=l.point,s={x:o.x-i.x,y:o.y-i.y},u={x:a.x-i.x,y:a.y-i.y},b(u,s)/E(u)/E(s)),cosine:C(e.point,t.point,l.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,a=i.cosine,s=n.get(e),u=s.sine,l=s.cosine;return o>=0&&u>=0?a<l?1:a>l?-1:0:o<0&&u<0?a<l?-1:a>l?1:0:u<o?-1:u>o?1:0}}}]),e}(),P=0,L=function(){function e(n,r,i,o){t(this,e),this.id=++P,this.leftSE=n,n.segment=this,n.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=n,this.rings=i,this.windings=o}return n(e,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var a=t.leftSE.point.y,s=e.leftSE.point.y,u=t.rightSE.point.y,l=e.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;var c=t.comparePoint(e.leftSE.point);if(c<0)return 1;if(c>0)return-1;var h=e.comparePoint(t.rightSE.point);return 0!==h?h:-1}if(n>r){if(a<s&&a<l)return-1;if(a>s&&a>l)return 1;var p=e.comparePoint(t.leftSE.point);if(0!==p)return p;var f=t.comparePoint(e.rightSE.point);return f<0?1:f>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){var d=e.comparePoint(t.rightSE.point);if(0!==d)return d}if(i>o){var m=t.comparePoint(e.rightSE.point);if(m<0)return 1;if(m>0)return-1}if(i!==o){var g=u-a,y=i-n,v=l-s,_=o-r;if(g>y&&v<_)return 1;if(g<y&&v>_)return-1}return i>o?1:i<o||u<l?-1:u>l?1:t.id<e.id?-1:t.id>e.id?1:0}}]),n(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;var a=(t.x-e.x)/r.x,s=e.y+a*r.y;return t.y===s?0:t.y<s?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),n=t.bbox(),r=d(e,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,s=t.rightSE.point,u=f(e,a)&&0===this.comparePoint(a),l=f(n,i)&&0===t.comparePoint(i),c=f(e,s)&&0===this.comparePoint(s),h=f(n,o)&&0===t.comparePoint(o);if(l&&u)return h&&!c?o:!h&&c?s:null;if(l)return c&&i.x===s.x&&i.y===s.y?null:i;if(u)return h&&o.x===a.x&&o.y===a.y?null:a;if(h&&c)return null;if(h)return o;if(c)return s;var p=function(t,e,n,r){if(0===e.x)return T(n,r,t.x);if(0===r.x)return T(t,e,n.x);if(0===e.y)return M(n,r,t.y);if(0===r.y)return M(t,e,n.y);var i=b(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},a=b(o,e)/i,s=b(o,r)/i;return{x:(t.x+s*e.x+(n.x+a*r.x))/2,y:(t.y+s*e.y+(n.y+a*r.y))/2}}(i,this.vector(),a,t.vector());return null===p?null:f(r,p)?x.round(p.x,p.y):null}},{key:"split",value:function(t){var n=[],r=void 0!==t.events,i=new A(t,!0),o=new A(t,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var s=new e(i,a,this.rings.slice(),this.windings.slice());return A.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),A.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(t){for(var n=this,r=t;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=e.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var a=n;n=r,r=a}for(var s=0,u=r.rings.length;s<u;s++){var l=r.rings[s],c=r.windings[s],h=n.rings.indexOf(l);-1===h?(n.rings.push(l),n.windings.push(c)):n.windings[h]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var a=this.rings[i],s=this.windings[i],u=e.indexOf(a);-1===u?(e.push(a),n.push(s)):n[u]+=s}for(var l=[],c=[],h=0,p=e.length;h<p;h++)if(0!==n[h]){var f=e[h],d=f.poly;if(-1===c.indexOf(d))if(f.isExterior)l.push(d);else{-1===c.indexOf(d)&&c.push(d);var m=l.indexOf(f.poly);-1!==m&&l.splice(m,1)}}for(var g=0,y=l.length;g<y;g++){var v=l[g].multiPoly;-1===r.indexOf(v)&&r.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(j.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===j.numMultiPolys&&i<o;break;case"xor":var a=Math.abs(t.length-e.length);this._isInResult=a%2==1;break;case"difference":var s=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=s(t)!==s(e);break;default:throw new Error("Unrecognized operation type found ".concat(j.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,r){var i,o,a,s=A.comparePoints(t,n);if(s<0)i=t,o=n,a=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));i=n,o=t,a=-1}return new e(new A(i,!0),new A(o,!1),[r],[a])}}]),e}(),I=function(){function e(n,r,i){if(t(this,e),!Array.isArray(n)||0===n.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],"number"!=typeof n[0][0]||"number"!=typeof n[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=x.round(n[0][0],n[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var a=o,s=1,u=n.length;s<u;s++){if("number"!=typeof n[s][0]||"number"!=typeof n[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=x.round(n[s][0],n[s][1]);l.x===a.x&&l.y===a.y||(this.segments.push(L.fromRing(a,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),a=l)}o.x===a.x&&o.y===a.y||this.segments.push(L.fromRing(a,o,this))}return n(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),e}(),k=function(){function e(n,r){if(t(this,e),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new I(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,o=n.length;i<o;i++){var a=new I(n[i],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=r}return n(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),e}(),O=function(){function e(n,r){if(t(this,e),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof n[0][0][0]&&(n=[n])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,o=n.length;i<o;i++){var a=new k(n[i],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=r}return n(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),e}(),R=function(){function e(n){t(this,e),this.events=n;for(var r=0,i=n.length;r<i;r++)n[r].segment.ringOut=this;this.poly=null}return n(e,null,[{key:"factory",value:function(t){for(var n=[],r=0,i=t.length;r<i;r++){var o=t[r];if(o.isInResult()&&!o.ringOut){for(var a=null,s=o.leftSE,u=o.rightSE,l=[s],c=s.point,h=[];a=s,s=u,l.push(s),s.point!==c;)for(;;){var p=s.getAvailableLinkedEvents();if(0===p.length){var f=l[0].point,d=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(f.x,",")+" ".concat(f.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===p.length){u=p[0].otherSE;break}for(var m=null,g=0,y=h.length;g<y;g++)if(h[g].point===s.point){m=g;break}if(null===m){h.push({index:l.length,point:s.point});var v=s.getLeftmostComparator(a);u=p.sort(v)[0].otherSE;break}var _=h.splice(m)[0],x=l.splice(_.index);x.unshift(x[0].otherSE),n.push(new e(x.reverse()))}n.push(new e(l))}}return n}}]),n(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==S(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var a=e[0],s=e[1];0===S(a,t,s)&&e.shift(),e.push(e[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:e.length-1,c=this.isExteriorRing()?e.length:-1,h=[],p=l;p!=c;p+=u)h.push([e[p].x,e[p].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];A.compare(t,r)>0&&(t=r)}for(var i=t.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),e}(),D=function(){function e(n){t(this,e),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),e}(),N=function(){function e(n){t(this,e),this.rings=n,this.polys=this._composePolys(n)}return n(e,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new D(i));else{var o=i.enclosingRing();o.poly||e.push(new D(o)),o.poly.addInterior(i)}}return e}}]),e}(),F=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L.compare;t(this,e),this.queue=n,this.tree=new l(r),this.segments=[]}return n(e,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,a=void 0,s=void 0;void 0===a;)null===(i=this.tree.prev(i))?a=null:void 0===i.key.consumedBy&&(a=i.key);for(;void 0===s;)null===(o=this.tree.next(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);if(t.isLeft){var u=null;if(a){var l=a.getIntersection(e);if(null!==l&&(e.isAnEndpoint(l)||(u=l),!a.isAnEndpoint(l)))for(var c=this._splitSafely(a,l),h=0,p=c.length;h<p;h++)n.push(c[h])}var f=null;if(s){var d=s.getIntersection(e);if(null!==d&&(e.isAnEndpoint(d)||(f=d),!s.isAnEndpoint(d)))for(var m=this._splitSafely(s,d),g=0,y=m.length;g<y;g++)n.push(m[g])}if(null!==u||null!==f){var v;v=null===u?f:null===f||A.comparePoints(u,f)<=0?u:f,this.queue.remove(e.rightSE),n.push(e.rightSE);for(var _=e.split(v),x=0,b=_.length;x<b;x++)n.push(_[x])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=a)}else{if(a&&s){var w=a.getIntersection(s);if(null!==w){if(!a.isAnEndpoint(w))for(var S=this._splitSafely(a,w),E=0,C=S.length;E<C;E++)n.push(S[E]);if(!s.isAnEndpoint(w))for(var M=this._splitSafely(s,w),T=0,P=M.length;T<P;T++)n.push(M[T])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),e}(),z="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,B="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,j=new(function(){function e(){t(this,e)}return n(e,[{key:"run",value:function(t,e,n){j.type=t,x.reset();for(var r=[new O(e,!0)],i=0,o=n.length;i<o;i++)r.push(new O(n[i],!1));if(j.numMultiPolys=r.length,"difference"===j.type)for(var a=r[0],s=1;s<r.length;)null!==d(r[s].bbox,a.bbox)?s++:r.splice(s,1);if("intersection"===j.type)for(var u=0,c=r.length;u<c;u++)for(var h=r[u],p=u+1,f=r.length;p<f;p++)if(null===d(h.bbox,r[p].bbox))return[];for(var m=new l(A.compare),g=0,y=r.length;g<y;g++)for(var v=r[g].getSweepEvents(),_=0,b=v.length;_<b;_++)if(m.insert(v[_]),m.size>z)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var w=new F(m),S=m.size,E=m.pop();E;){var C=E.key;if(m.size===S){var M=C.segment;throw new Error("Unable to pop() ".concat(C.isLeft?"left":"right"," SweepEvent ")+"[".concat(C.point.x,", ").concat(C.point.y,"] from segment #").concat(M.id," ")+"[".concat(M.leftSE.point.x,", ").concat(M.leftSE.point.y,"] -> ")+"[".concat(M.rightSE.point.x,", ").concat(M.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(m.size>z)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(w.segments.length>B)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=w.process(C),P=0,L=T.length;P<L;P++){var I=T[P];void 0===I.consumedBy&&m.insert(I)}S=m.size,E=m.pop()}x.reset();var k=R.factory(w.segments);return new N(k).getGeom()}}]),e}());return{union:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return j.run("union",t,n)},intersection:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return j.run("intersection",t,n)},xor:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return j.run("xor",t,n)},difference:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return j.run("difference",t,n)}}}()},9499:function(t){t.exports=function(){"use strict";function t(n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(n,r,Math.max(i,Math.floor(r-u*c/s+h)),Math.min(o,Math.floor(r+(s-u)*c/s+h)),a)}var p=n[r],f=i,d=o;for(e(n,i,r),a(n[o],p)>0&&e(n,i,o);f<d;){for(e(n,f,d),f++,d--;a(n[f],p)<0;)f++;for(;a(n[d],p)>0;)d--}0===a(n[i],p)?e(n,i,d):e(n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}function e(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function n(t,e){return t<e?-1:t>e?1:0}return function(e,r,i,o,a){t(e,r,i||0,o||e.length-1,a||n)}}()},6690:(t,e,n)=>{"use strict";t.exports=i,t.exports.default=i;var r=n(9499);function i(t,e){if(!(this instanceof i))return new i(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,n,r,i){i||(i=m(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<n;a++)o=t.children[a],u(i,t.leaf?r(o):o);return i}function u(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function h(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,e,n,i,o){for(var a,s=[e,n];s.length;)(n=s.pop())-(e=s.pop())<=i||(a=e+Math.ceil((n-e)/i/2)*i,r(t,a,e,n,o),s.push(e,a,a,n))}i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],r=this.toBBox;if(!d(t,e))return n;for(var i,o,a,s,u=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],d(t,s=e.leaf?r(a):a)&&(e.leaf?n.push(a):f(t,s)?this._all(a,n):u.push(a));e=u.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!d(t,e))return!1;for(var r,i,o,a,s=[];e;){for(r=0,i=e.children.length;r<i;r++)if(o=e.children[r],d(t,a=e.leaf?n(o):o)){if(e.leaf||f(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(t,e){if(!t)return this;for(var n,r,i,a,s=this.data,u=this.toBBox(t),l=[],c=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],n=c.pop(),a=!0),s.leaf&&-1!==(i=o(t,s.children,e)))return s.children.splice(i,1),l.push(s),this._condense(l),this;a||s.leaf||!f(s,u)?r?(n++,s=r.children[n],a=!1):s=null:(l.push(s),c.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:l,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,r){var i,o=n-e+1,s=this._maxEntries;if(o<=s)return a(i=m(t.slice(e,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=m([])).leaf=!1,i.height=r;var u,l,c,h,p=Math.ceil(o/s),f=p*Math.ceil(Math.sqrt(s));for(g(t,e,n,f,this.compareMinX),u=e;u<=n;u+=f)for(g(t,u,c=Math.min(u+f-1,n),p,this.compareMinY),l=u;l<=c;l+=p)h=Math.min(l+p-1,c),i.children.push(this._build(t,l,h,r-1));return a(i,this.toBBox),i},_chooseSubtree:function(t,e,n,r){for(var i,o,a,s,u,l,c,p,f,d;r.push(e),!e.leaf&&r.length-1!==n;){for(c=p=1/0,i=0,o=e.children.length;i<o;i++)u=h(a=e.children[i]),f=t,d=a,(l=(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-u)<p?(p=l,c=u<c?u:c,s=a):l===p&&u<c&&(c=u,s=a);e=s||e.children[0]}return e},_insert:function(t,e,n){var r=this.toBBox,i=n?t:r(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),u(a,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=m(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,a(n,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var r,i,o,a,u,l,c,p,f,d,m,g,y,v;for(l=c=1/0,r=e;r<=n-e;r++)f=i=s(t,0,r,this.toBBox),d=o=s(t,r,n,this.toBBox),void 0,void 0,void 0,void 0,m=Math.max(f.minX,d.minX),g=Math.max(f.minY,d.minY),y=Math.min(f.maxX,d.maxX),v=Math.min(f.maxY,d.maxY),a=Math.max(0,y-m)*Math.max(0,v-g),u=h(i)+h(o),a<l?(l=a,p=r,c=u<c?u:c):a===l&&u<c&&(c=u,p=r);return p},_chooseSplitAxis:function(t,e,n){var r=t.leaf?this.compareMinX:l,i=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},_allDistMargin:function(t,e,n,r){t.children.sort(r);var i,o,a=this.toBBox,l=s(t,0,e,a),c=s(t,n-e,n,a),h=p(l)+p(c);for(i=e;i<n-e;i++)o=t.children[i],u(l,t.leaf?a(o):o),h+=p(l);for(i=n-e-1;i>=e;i--)o=t.children[i],u(c,t.leaf?a(o):o),h+=p(c);return h},_adjustParentBBoxes:function(t,e,n){for(var r=n;r>=0;r--)u(e[r],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():a(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},8346:function(t){t.exports=function(){"use strict";function t(t,r,i,o,a){!function t(n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(n,r,Math.max(i,Math.floor(r-u*c/s+h)),Math.min(o,Math.floor(r+(s-u)*c/s+h)),a)}var p=n[r],f=i,d=o;for(e(n,i,r),a(n[o],p)>0&&e(n,i,o);f<d;){for(e(n,f,d),f++,d--;a(n[f],p)<0;)f++;for(;a(n[d],p)>0;)d--}0===a(n[i],p)?e(n,i,d):e(n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}(t,r,i||0,o||t.length-1,a||n)}function e(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function n(t,e){return t<e?-1:t>e?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function o(t,e){a(t,0,t.children.length,e,t)}function a(t,e,n,r,i){i||(i=d(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=e;o<n;o++){var a=t.children[o];s(i,t.leaf?r(a):a)}return i}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function d(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,n,r,i,o){for(var a=[n,r];a.length;)if(!((r=a.pop())-(n=a.pop())<=i)){var s=n+Math.ceil((r-n)/i/2)*i;t(e,s,n,r,o),a.push(n,s,s,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var e=this.data,n=[];if(!f(t,e))return n;for(var r=this.toBBox,i=[];e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],s=e.leaf?r(a):a;f(t,s)&&(e.leaf?n.push(a):p(t,s)?this._all(a,n):i.push(a))}e=i.pop()}return n},r.prototype.collides=function(t){var e=this.data;if(!f(t,e))return!1;for(var n=[];e;){for(var r=0;r<e.children.length;r++){var i=e.children[r],o=e.leaf?this.toBBox(i):i;if(f(t,o)){if(e.leaf||p(t,o))return!0;n.push(i)}}e=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=d([]),this},r.prototype.remove=function(t,e){if(!t)return this;for(var n,r,o,a=this.data,s=this.toBBox(t),u=[],l=[];a||u.length;){if(a||(a=u.pop(),r=u[u.length-1],n=l.pop(),o=!0),a.leaf){var c=i(t,a.children,e);if(-1!==c)return a.children.splice(c,1),u.push(a),this._condense(u),this}o||a.leaf||!p(a,s)?r?(n++,a=r.children[n],o=!1):a=null:(u.push(a),l.push(n),n=0,r=a,a=a.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,e){return t.minX-e.minX},r.prototype.compareMinY=function(t,e){return t.minY-e.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},r.prototype._build=function(t,e,n,r){var i,a=n-e+1,s=this._maxEntries;if(a<=s)return o(i=d(t.slice(e,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),(i=d([])).leaf=!1,i.height=r;var u=Math.ceil(a/s),l=u*Math.ceil(Math.sqrt(s));m(t,e,n,l,this.compareMinX);for(var c=e;c<=n;c+=l){var h=Math.min(c+l-1,n);m(t,c,h,u,this.compareMinY);for(var p=c;p<=h;p+=u){var f=Math.min(p+u-1,h);i.children.push(this._build(t,p,f,r-1))}}return o(i,this.toBBox),i},r.prototype._chooseSubtree=function(t,e,n,r){for(;r.push(e),!e.leaf&&r.length-1!==n;){for(var i=1/0,o=1/0,a=void 0,s=0;s<e.children.length;s++){var u=e.children[s],l=c(u),h=(p=t,f=u,(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-l);h<o?(o=h,i=l<i?l:i,a=u):h===o&&l<i&&(i=l,a=u)}e=a||e.children[0]}var p,f;return e},r.prototype._insert=function(t,e,n){var r=n?t:this.toBBox(t),i=[],o=this._chooseSubtree(r,this.data,e,i);for(o.children.push(t),s(o,r);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(r,i,e)},r.prototype._split=function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var a=this._chooseSplitIndex(n,i,r),s=d(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,o(n,this.toBBox),o(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},r.prototype._splitRoot=function(t,e){this.data=d([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,e,n){for(var r,i,o,s,u,l,h,p=1/0,f=1/0,d=e;d<=n-e;d++){var m=a(t,0,d,this.toBBox),g=a(t,d,n,this.toBBox),y=(i=m,o=g,void 0,void 0,void 0,void 0,s=Math.max(i.minX,o.minX),u=Math.max(i.minY,o.minY),l=Math.min(i.maxX,o.maxX),h=Math.min(i.maxY,o.maxY),Math.max(0,l-s)*Math.max(0,h-u)),v=c(m)+c(g);y<p?(p=y,r=d,f=v<f?v:f):y===p&&v<f&&(f=v,r=d)}return r||n-e},r.prototype._chooseSplitAxis=function(t,e,n){var r=t.leaf?this.compareMinX:u,i=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,e,n,r){t.children.sort(r);for(var i=this.toBBox,o=a(t,0,e,i),u=a(t,n-e,n,i),l=h(o)+h(u),c=e;c<n-e;c++){var p=t.children[c];s(o,t.leaf?i(p):p),l+=h(o)}for(var f=n-e-1;f>=e;f--){var d=t.children[f];s(u,t.leaf?i(d):d),l+=h(u)}return l},r.prototype._adjustParentBBoxes=function(t,e,n){for(var r=n;r>=0;r--)s(e[r],t)},r.prototype._condense=function(t){for(var e=t.length-1,n=void 0;e>=0;e--)0===t[e].children.length?e>0?(n=t[e-1].children).splice(n.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},r}()},171:(t,e,n)=>{var r;!function(t){!function(e){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(t);function o(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===r.Reflect?r.Reflect=t:i=o(r.Reflect,i),function(t){var e=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return D(Object.create(null))}:a?function(){return D({__proto__:null})}:function(){return D({})},has:s?function(t,n){return e.call(t,n)}:function(t,e){return e in t},get:s?function(t,n){return e.call(t,n)?t[n]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),c="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=c||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[i]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,o)},e.prototype.entries=function(){return new n(this._keys,this._values,a)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[i]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function o(t,e){return e}function a(t,e){return[t,e]}}():Map,p=c||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new h}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[i]=function(){return this.keys()},t}():Set,f=new(c||"function"!=typeof WeakMap?function(){var t=u.create(),n=r();return function(){function t(){this._key=r()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&u.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?u.get(e,this._key):void 0},t.prototype.set=function(t,e){return i(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=r()},t}();function r(){var e;do{e="@@WeakMap@@"+a()}while(u.has(t,e));return t[e]=!0,e}function i(t,r){if(!e.call(t,n)){if(!r)return;Object.defineProperty(t,n,{value:u.create()})}return t[n]}function o(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function a(){var t,e=(t=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):o(new Uint8Array(t),t):o(new Array(t),t));e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<16;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function d(t,e,n){var r=f.get(t);if(S(r)){if(!n)return;r=new h,f.set(t,r)}var i=r.get(e);if(S(i)){if(!n)return;i=new h,r.set(e,i)}return i}function m(t,e,n){if(g(t,e,n))return!0;var r=R(e);return!E(r)&&m(t,r,n)}function g(t,e,n){var r=d(e,n,!1);return!S(r)&&!!r.has(t)}function y(t,e,n){if(g(t,e,n))return v(t,e,n);var r=R(e);return E(r)?void 0:y(t,r,n)}function v(t,e,n){var r=d(e,n,!1);if(!S(r))return r.get(t)}function _(t,e,n,r){d(n,r,!0).set(t,e)}function x(t,e){var n=b(t,e),r=R(t);if(null===r)return n;var i=x(r,e);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new p,a=[],s=0,u=n;s<u.length;s++){var l=u[s];o.has(l)||(o.add(l),a.push(l))}for(var c=0,h=i;c<h.length;c++)l=h[c],o.has(l)||(o.add(l),a.push(l));return a}function b(t,e){var n=[],r=d(t,e,!1);if(S(r))return n;for(var o=function(t){var e=I(t,i);if(!P(e))throw new TypeError;var n=e.call(t);if(!C(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=k(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(t){try{O(o)}finally{throw t}}a++}}function w(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function S(t){return void 0===t}function E(t){return null===t}function C(t){return"object"==typeof t?null!==t:"function"==typeof t}function M(t,e){switch(w(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",i=I(t,r);if(void 0!==i){var o=i.call(t,n);if(C(o))throw new TypeError;return o}return function(t,e){if("string"===e){var n=t.toString;if(P(n)&&!C(i=n.call(t)))return i;if(P(r=t.valueOf)&&!C(i=r.call(t)))return i}else{var r;if(P(r=t.valueOf)&&!C(i=r.call(t)))return i;var i,o=t.toString;if(P(o)&&!C(i=o.call(t)))return i}throw new TypeError}(t,"default"===n?"number":n)}function T(t){var e=M(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function A(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function P(t){return"function"==typeof t}function L(t){return"function"==typeof t}function I(t,e){var n=t[e];if(null!=n){if(!P(n))throw new TypeError;return n}}function k(t){var e=t.next();return!e.done&&e}function O(t){var e=t.return;e&&e.call(t)}function R(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l)return e;if(e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i||i===t?e:i}function D(t){return t.__=void 0,delete t.__,t}t("decorate",(function(t,e,n,r){if(S(n)){if(!A(t))throw new TypeError;if(!L(e))throw new TypeError;return function(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!S(r)&&!E(r)){if(!L(r))throw new TypeError;e=r}}return e}(t,e)}if(!A(t))throw new TypeError;if(!C(e))throw new TypeError;if(!C(r)&&!S(r)&&!E(r))throw new TypeError;return E(r)&&(r=void 0),function(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=(0,t[i])(e,n,r);if(!S(o)&&!E(o)){if(!C(o))throw new TypeError;r=o}}return r}(t,e,n=T(n),r)})),t("metadata",(function(t,e){return function(n,r){if(!C(n))throw new TypeError;if(!S(r)&&!function(t){switch(w(t)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;_(t,e,n,r)}})),t("defineMetadata",(function(t,e,n,r){if(!C(n))throw new TypeError;return S(r)||(r=T(r)),_(t,e,n,r)})),t("hasMetadata",(function(t,e,n){if(!C(e))throw new TypeError;return S(n)||(n=T(n)),m(t,e,n)})),t("hasOwnMetadata",(function(t,e,n){if(!C(e))throw new TypeError;return S(n)||(n=T(n)),g(t,e,n)})),t("getMetadata",(function(t,e,n){if(!C(e))throw new TypeError;return S(n)||(n=T(n)),y(t,e,n)})),t("getOwnMetadata",(function(t,e,n){if(!C(e))throw new TypeError;return S(n)||(n=T(n)),v(t,e,n)})),t("getMetadataKeys",(function(t,e){if(!C(t))throw new TypeError;return S(e)||(e=T(e)),x(t,e)})),t("getOwnMetadataKeys",(function(t,e){if(!C(t))throw new TypeError;return S(e)||(e=T(e)),b(t,e)})),t("deleteMetadata",(function(t,e,n){if(!C(e))throw new TypeError;S(n)||(n=T(n));var r=d(e,n,!1);if(S(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=f.get(e);return i.delete(n),i.size>0||f.delete(e),!0}))}(i)}()}(r||(r={}))},4212:(t,e,n)=>{"use strict";var r=n(9879).functionsHaveConfigurableNames(),i=Object,o=TypeError;t.exports=function(){if(null!=this&&this!==i(this))throw new o("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.sticky&&(t+="y"),t},r&&Object.defineProperty&&Object.defineProperty(t.exports,"name",{value:"get flags"})},7483:(t,e,n)=>{"use strict";var r=n(6699),i=n(5592),o=n(4212),a=n(6232),s=n(3619),u=i(a());r(u,{getPolyfill:a,implementation:o,shim:s}),t.exports=u},6232:(t,e,n)=>{"use strict";var r=n(4212),i=n(6699).supportsDescriptors,o=Object.getOwnPropertyDescriptor;t.exports=function(){if(i&&"gim"===/a/gim.flags){var t=o(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(n,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return r}},3619:(t,e,n)=>{"use strict";var r=n(6699).supportsDescriptors,i=n(6232),o=Object.getOwnPropertyDescriptor,a=Object.defineProperty,s=TypeError,u=Object.getPrototypeOf,l=/a/;t.exports=function(){if(!r||!u)throw new s("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=i(),e=u(l),n=o(e,"flags");return n&&n.get===t||a(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}},8935:function(t,e){!function(t){"use strict";const e=134217729;function n(t,e,n,r,i){let o,a,s,u,l=e[0],c=r[0],h=0,p=0;c>l==c>-l?(o=l,l=e[++h]):(o=c,c=r[++p]);let f=0;if(h<t&&p<n)for(c>l==c>-l?(s=o-((a=l+o)-l),l=e[++h]):(s=o-((a=c+o)-c),c=r[++p]),o=a,0!==s&&(i[f++]=s);h<t&&p<n;)c>l==c>-l?(s=o-((a=o+l)-(u=a-o))+(l-u),l=e[++h]):(s=o-((a=o+c)-(u=a-o))+(c-u),c=r[++p]),o=a,0!==s&&(i[f++]=s);for(;h<t;)s=o-((a=o+l)-(u=a-o))+(l-u),l=e[++h],o=a,0!==s&&(i[f++]=s);for(;p<n;)s=o-((a=o+c)-(u=a-o))+(c-u),c=r[++p],o=a,0!==s&&(i[f++]=s);return 0===o&&0!==f||(i[f++]=o),f}function r(t){return new Float64Array(t)}const i=r(4),o=r(8),a=r(12),s=r(16),u=r(4);t.orient2d=function(t,r,l,c,h,p){const f=(r-p)*(l-h),d=(t-h)*(c-p),m=f-d;if(0===f||0===d||f>0!=d>0)return m;const g=Math.abs(f+d);return Math.abs(m)>=33306690738754716e-32*g?m:-function(t,r,l,c,h,p,f){let d,m,g,y,v,_,x,b,w,S,E,C,M,T,A,P,L,I;const k=t-h,O=l-h,R=r-p,D=c-p;v=(A=(b=k-(x=(_=e*k)-(_-k)))*(S=D-(w=(_=e*D)-(_-D)))-((T=k*D)-x*w-b*w-x*S))-(E=A-(L=(b=R-(x=(_=e*R)-(_-R)))*(S=O-(w=(_=e*O)-(_-O)))-((P=R*O)-x*w-b*w-x*S))),i[0]=A-(E+v)+(v-L),v=(M=T-((C=T+E)-(v=C-T))+(E-v))-(E=M-P),i[1]=M-(E+v)+(v-P),v=(I=C+E)-C,i[2]=C-(I-v)+(E-v),i[3]=I;let N=function(t,e){let n=e[0];for(let t=1;t<4;t++)n+=e[t];return n}(0,i),F=22204460492503146e-32*f;if(N>=F||-N>=F)return N;if(d=t-(k+(v=t-k))+(v-h),g=l-(O+(v=l-O))+(v-h),m=r-(R+(v=r-R))+(v-p),y=c-(D+(v=c-D))+(v-p),0===d&&0===m&&0===g&&0===y)return N;if(F=11093356479670487e-47*f+33306690738754706e-32*Math.abs(N),(N+=k*y+D*d-(R*g+O*m))>=F||-N>=F)return N;v=(A=(b=d-(x=(_=e*d)-(_-d)))*(S=D-(w=(_=e*D)-(_-D)))-((T=d*D)-x*w-b*w-x*S))-(E=A-(L=(b=m-(x=(_=e*m)-(_-m)))*(S=O-(w=(_=e*O)-(_-O)))-((P=m*O)-x*w-b*w-x*S))),u[0]=A-(E+v)+(v-L),v=(M=T-((C=T+E)-(v=C-T))+(E-v))-(E=M-P),u[1]=M-(E+v)+(v-P),v=(I=C+E)-C,u[2]=C-(I-v)+(E-v),u[3]=I;const z=n(4,i,4,u,o);v=(A=(b=k-(x=(_=e*k)-(_-k)))*(S=y-(w=(_=e*y)-(_-y)))-((T=k*y)-x*w-b*w-x*S))-(E=A-(L=(b=R-(x=(_=e*R)-(_-R)))*(S=g-(w=(_=e*g)-(_-g)))-((P=R*g)-x*w-b*w-x*S))),u[0]=A-(E+v)+(v-L),v=(M=T-((C=T+E)-(v=C-T))+(E-v))-(E=M-P),u[1]=M-(E+v)+(v-P),v=(I=C+E)-C,u[2]=C-(I-v)+(E-v),u[3]=I;const B=n(z,o,4,u,a);v=(A=(b=d-(x=(_=e*d)-(_-d)))*(S=y-(w=(_=e*y)-(_-y)))-((T=d*y)-x*w-b*w-x*S))-(E=A-(L=(b=m-(x=(_=e*m)-(_-m)))*(S=g-(w=(_=e*g)-(_-g)))-((P=m*g)-x*w-b*w-x*S))),u[0]=A-(E+v)+(v-L),v=(M=T-((C=T+E)-(v=C-T))+(E-v))-(E=M-P),u[1]=M-(E+v)+(v-P),v=(I=C+E)-C,u[2]=C-(I-v)+(E-v),u[3]=I;const j=n(B,a,4,u,s);return s[j-1]}(t,r,l,c,h,p,g)},t.orient2dfast=function(t,e,n,r,i,o){return(e-o)*(n-i)-(t-i)*(r-o)},Object.defineProperty(t,"__esModule",{value:!0})}(e)},382:t=>{"use strict";t.exports={eudist:function(t,e,n){for(var r=t.length,i=0,o=0;o<r;o++){var a=(t[o]||0)-(e[o]||0);i+=a*a}return n?Math.sqrt(i):i},mandist:function(t,e,n){for(var r=t.length,i=0,o=0;o<r;o++)i+=Math.abs((t[o]||0)-(e[o]||0));return n?Math.sqrt(i):i},dist:function(t,e,n){var r=Math.abs(t-e);return n?r:r*r}}},5040:(t,e,n)=>{"use strict";var r=n(382),i=r.eudist,o=r.dist;t.exports={kmrand:function(t,e){for(var n={},r=[],i=e<<2,o=t.length,a=t[0].length>0;r.length<e&&i-- >0;){var s=t[Math.floor(Math.random()*o)],u=a?s.join("_"):""+s;n[u]||(n[u]=!0,r.push(s))}if(r.length<e)throw new Error("Error initializating clusters");return r},kmpp:function(t,e){var n=t[0].length?i:o,r=[],a=t.length,s=t[0].length>0,u=t[Math.floor(Math.random()*a)];for(s&&u.join("_"),r.push(u);r.length<e;){for(var l=[],c=r.length,h=0,p=[],f=0;f<a;f++){for(var d=1/0,m=0;m<c;m++){var g=n(t[f],r[m]);g<=d&&(d=g)}l[f]=d}for(var y=0;y<a;y++)h+=l[y];for(var v=0;v<a;v++)p[v]={i:v,v:t[v],pr:l[v]/h,cs:0};p.sort((function(t,e){return t.pr-e.pr})),p[0].cs=p[0].pr;for(var _=1;_<a;_++)p[_].cs=p[_-1].cs+p[_].pr;for(var x=Math.random(),b=0;b<a-1&&p[b++].cs<x;);r.push(p[b-1].v)}return r}}},2087:(t,e,n)=>{"use strict";var r=n(382),i=n(5040),o=r.eudist,a=(r.mandist,r.dist,i.kmrand),s=i.kmpp;function u(t,e,n){n=n||[];for(var r=0;r<t;r++)n[r]=e;return n}t.exports=function(t,e,n,r){var i=[],l=[],c=[],h=[],p=!1,f=r||1e4,d=t.length,m=t[0].length,g=m>0,y=[];if(n)i="kmrand"==n?a(t,e):"kmpp"==n?s(t,e):n;else for(var v={};i.length<e;){var _=Math.floor(Math.random()*d);v[_]||(v[_]=!0,i.push(t[_]))}do{u(e,0,y);for(var x=0;x<d;x++){for(var b=1/0,w=0,S=0;S<e;S++)(h=g?o(t[x],i[S]):Math.abs(t[x]-i[S]))<=b&&(b=h,w=S);c[x]=w,y[w]++}for(var E=[],C=(l=[],0);C<e;C++)E[C]=g?u(m,0,E[C]):0,l[C]=i[C];if(g){for(var M=0;M<e;M++)i[M]=[];for(var T=0;T<d;T++)for(var A=E[c[T]],P=t[T],L=0;L<m;L++)A[L]+=P[L];p=!0;for(var I=0;I<e;I++){for(var k=i[I],O=E[I],R=l[I],D=y[I],N=0;N<m;N++)k[N]=O[N]/D||0;if(p)for(var F=0;F<m;F++)if(R[F]!=k[F]){p=!1;break}}}else{for(var z=0;z<d;z++)E[c[z]]+=t[z];for(var B=0;B<e;B++)i[B]=E[B]/y[B]||0;p=!0;for(var j=0;j<e;j++)if(l[j]!=i[j]){p=!1;break}}p=p||--f<=0}while(!p);return{it:1e4-f,k:e,idxs:c,centroids:i}}},1469:function(t){t.exports=function(){"use strict";function t(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;e(n,r,u,o,a,s%2),t(n,r,i,o,u-1,s+1),t(n,r,i,u+1,a,s+1)}}function e(t,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,l=i-o+1,c=Math.log(u),h=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*h*(u-h)/u)*(l-u/2<0?-1:1);e(t,r,i,Math.max(o,Math.floor(i-l*h/u+p)),Math.min(a,Math.floor(i+(u-l)*h/u+p)),s)}var f=r[2*i+s],d=o,m=a;for(n(t,r,o,i),r[2*a+s]>f&&n(t,r,o,a);d<m;){for(n(t,r,d,m),d++,m--;r[2*d+s]<f;)d++;for(;r[2*m+s]>f;)m--}r[2*o+s]===f?n(t,r,o,m):n(t,r,++m,a),m<=i&&(o=m+1),i<=m&&(a=m-1)}}function n(t,e,n,i){r(t,n,i),r(e,2*n,2*i),r(e,2*n+1,2*i+1)}function r(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function i(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}var o=function(t){return t[0]},a=function(t){return t[1]},s=function(e,n,r,i,s){void 0===n&&(n=o),void 0===r&&(r=a),void 0===i&&(i=64),void 0===s&&(s=Float64Array),this.nodeSize=i,this.points=e;for(var u=e.length<65536?Uint16Array:Uint32Array,l=this.ids=new u(e.length),c=this.coords=new s(2*e.length),h=0;h<e.length;h++)l[h]=h,c[2*h]=n(e[h]),c[2*h+1]=r(e[h]);t(l,c,i,0,l.length-1,0)};s.prototype.range=function(t,e,n,r){return function(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),p=l.pop(),f=l.pop();if(p-f<=a)for(var d=f;d<=p;d++)s=e[2*d],u=e[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[d]);else{var m=Math.floor((f+p)/2);s=e[2*m],u=e[2*m+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[m]);var g=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(f),l.push(m-1),l.push(g)),(0===h?i>=s:o>=u)&&(l.push(m+1),l.push(p),l.push(g))}}return c}(this.ids,this.coords,t,e,n,r,this.nodeSize)},s.prototype.within=function(t,e,n){return function(t,e,n,r,o,a){for(var s=[0,t.length-1,0],u=[],l=o*o;s.length;){var c=s.pop(),h=s.pop(),p=s.pop();if(h-p<=a)for(var f=p;f<=h;f++)i(e[2*f],e[2*f+1],n,r)<=l&&u.push(t[f]);else{var d=Math.floor((p+h)/2),m=e[2*d],g=e[2*d+1];i(m,g,n,r)<=l&&u.push(t[d]);var y=(c+1)%2;(0===c?n-o<=m:r-o<=g)&&(s.push(p),s.push(d-1),s.push(y)),(0===c?n+o>=m:r+o>=g)&&(s.push(d+1),s.push(h),s.push(y))}}return u}(this.ids,this.coords,t,e,n,this.nodeSize)};var u,l={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},c=Math.fround||(u=new Float32Array(1),function(t){return u[0]=+t,u[0]}),h=function(t){this.options=v(Object.create(l),t),this.trees=new Array(this.options.maxZoom+1)};function p(t,e,n,r,i){return{x:c(t),y:c(e),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function f(t,e){var n=t.geometry.coordinates,r=n[0],i=n[1];return{x:c(g(r)),y:c(y(i)),zoom:1/0,index:e,parentId:-1}}function d(t){return{type:"Feature",id:t.id,properties:m(t),geometry:{type:"Point",coordinates:[(r=t.x,360*(r-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,r}function m(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return v(v({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function g(t){return t/360+.5}function y(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function v(t,e){for(var n in e)t[n]=e[n];return t}function _(t){return t.x}function x(t){return t.y}return h.prototype.load=function(t){var e=this.options,n=e.log,r=e.minZoom,i=e.maxZoom,o=e.nodeSize;n&&console.time("total time");var a="prepare "+t.length+" points";n&&console.time(a),this.points=t;for(var u=[],l=0;l<t.length;l++)t[l].geometry&&u.push(f(t[l],l));this.trees[i+1]=new s(u,_,x,o,Float32Array),n&&console.timeEnd(a);for(var c=i;c>=r;c--){var h=+Date.now();u=this._cluster(u,c),this.trees[c]=new s(u,_,x,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,u.length,+Date.now()-h)}return n&&console.timeEnd("total time"),this},h.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(g(n),y(o),g(i),y(r));c<h.length;c+=1){var p=h[c],f=u.points[p];l.push(f.numPoints?d(f):this.points[f.index])}return l},h.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=l[u],h=i.points[c];h.parentId===t&&s.push(h.numPoints?d(h):this.points[h.index])}if(0===s.length)throw new Error(r);return s},h.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,n,0),r},h.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((e-s)/i,u,(e+1+s)/i,l),r.points,e,n,i,c),0===e&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),e===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},h.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},h.prototype._appendLeaves=function(t,e,n,r,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},h.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l=u.numPoints,c=void 0,h=void 0,p=void 0;if(l)c=m(u),h=u.x,p=u.y;else{var f=this.points[u.index];c=f.properties,h=g(f.geometry.coordinates[0]),p=y(f.geometry.coordinates[1])}var d={type:1,geometry:[[Math.round(this.options.extent*(h*i-n)),Math.round(this.options.extent*(p*i-r))]],tags:c},v=void 0;l?v=u.id:this.options.generateId?v=u.index:this.points[u.index].id&&(v=this.points[u.index].id),void 0!==v&&(d.id=v),o.features.push(d)}},h.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))},h.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,e)),l=0;l<t.length;l++){var c=t[l];if(!(c.zoom<=e)){c.zoom=e;for(var h=this.trees[e+1],f=h.within(c.x,c.y,u),d=c.numPoints||1,m=d,g=0,y=f;g<y.length;g+=1){var v=y[g],_=h.points[v];_.zoom>e&&(m+=_.numPoints||1)}if(m>d&&m>=s){for(var x=c.x*d,b=c.y*d,w=a&&d>1?this._map(c,!0):null,S=(l<<5)+(e+1)+this.points.length,E=0,C=f;E<C.length;E+=1){var M=C[E],T=h.points[M];if(!(T.zoom<=e)){T.zoom=e;var A=T.numPoints||1;x+=T.x*A,b+=T.y*A,T.parentId=S,a&&(w||(w=this._map(c,!0)),a(w,this._map(T)))}}c.parentId=S,n.push(p(x/m,b/m,S,m,w))}else if(n.push(c),m>1)for(var P=0,L=f;P<L.length;P+=1){var I=L[P],k=h.points[I];k.zoom<=e||(k.zoom=e,n.push(k))}}}return n},h.prototype._getOriginId=function(t){return t-this.points.length>>5},h.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},h.prototype._map=function(t,e){if(t.numPoints)return e?v({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?v({},r):r},h}()},2086:(t,e,n)=>{var r;!function(i){var o=/^\s+/,a=/\s+$/,s=0,u=i.round,l=i.min,c=i.max,h=i.random;function p(t,e){if(e=e||{},(t=t||"")instanceof p)return t;if(!(this instanceof p))return new p(t,e);var n=function(t){var e,n,r,s={r:0,g:0,b:0},u=1,h=null,p=null,f=null,d=!1,m=!1;return"string"==typeof t&&(t=function(t){t=t.replace(o,"").replace(a,"").toLowerCase();var e,n=!1;if(L[t])t=L[t],n=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};return(e=V.rgb.exec(t))?{r:e[1],g:e[2],b:e[3]}:(e=V.rgba.exec(t))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=V.hsl.exec(t))?{h:e[1],s:e[2],l:e[3]}:(e=V.hsla.exec(t))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=V.hsv.exec(t))?{h:e[1],s:e[2],v:e[3]}:(e=V.hsva.exec(t))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=V.hex8.exec(t))?{r:D(e[1]),g:D(e[2]),b:D(e[3]),a:B(e[4]),format:n?"name":"hex8"}:(e=V.hex6.exec(t))?{r:D(e[1]),g:D(e[2]),b:D(e[3]),format:n?"name":"hex"}:(e=V.hex4.exec(t))?{r:D(e[1]+""+e[1]),g:D(e[2]+""+e[2]),b:D(e[3]+""+e[3]),a:B(e[4]+""+e[4]),format:n?"name":"hex8"}:!!(e=V.hex3.exec(t))&&{r:D(e[1]+""+e[1]),g:D(e[2]+""+e[2]),b:D(e[3]+""+e[3]),format:n?"name":"hex"}}(t)),"object"==typeof t&&(G(t.r)&&G(t.g)&&G(t.b)?(e=t.r,n=t.g,r=t.b,s={r:255*O(e,255),g:255*O(n,255),b:255*O(r,255)},d=!0,m="%"===String(t.r).substr(-1)?"prgb":"rgb"):G(t.h)&&G(t.s)&&G(t.v)?(h=F(t.s),p=F(t.v),s=function(t,e,n){t=6*O(t,360),e=O(e,100),n=O(n,100);var r=i.floor(t),o=t-r,a=n*(1-e),s=n*(1-o*e),u=n*(1-(1-o)*e),l=r%6;return{r:255*[n,s,a,a,u,n][l],g:255*[u,n,n,s,a,a][l],b:255*[a,a,u,n,n,s][l]}}(t.h,h,p),d=!0,m="hsv"):G(t.h)&&G(t.s)&&G(t.l)&&(h=F(t.s),f=F(t.l),s=function(t,e,n){var r,i,o;function a(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}if(t=O(t,360),e=O(e,100),n=O(n,100),0===e)r=i=o=n;else{var s=n<.5?n*(1+e):n+e-n*e,u=2*n-s;r=a(u,s,t+1/3),i=a(u,s,t),o=a(u,s,t-1/3)}return{r:255*r,g:255*i,b:255*o}}(t.h,h,f),d=!0,m="hsl"),t.hasOwnProperty("a")&&(u=t.a)),u=k(u),{ok:d,format:t.format||m,r:l(255,c(s.r,0)),g:l(255,c(s.g,0)),b:l(255,c(s.b,0)),a:u}}(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=u(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=u(this._r)),this._g<1&&(this._g=u(this._g)),this._b<1&&(this._b=u(this._b)),this._ok=n.ok,this._tc_id=s++}function f(t,e,n){t=O(t,255),e=O(e,255),n=O(n,255);var r,i,o=c(t,e,n),a=l(t,e,n),s=(o+a)/2;if(o==a)r=i=0;else{var u=o-a;switch(i=s>.5?u/(2-o-a):u/(o+a),o){case t:r=(e-n)/u+(e<n?6:0);break;case e:r=(n-t)/u+2;break;case n:r=(t-e)/u+4}r/=6}return{h:r,s:i,l:s}}function d(t,e,n){t=O(t,255),e=O(e,255),n=O(n,255);var r,i,o=c(t,e,n),a=l(t,e,n),s=o,u=o-a;if(i=0===o?0:u/o,o==a)r=0;else{switch(o){case t:r=(e-n)/u+(e<n?6:0);break;case e:r=(n-t)/u+2;break;case n:r=(t-e)/u+4}r/=6}return{h:r,s:i,v:s}}function m(t,e,n,r){var i=[N(u(t).toString(16)),N(u(e).toString(16)),N(u(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function g(t,e,n,r){return[N(z(r)),N(u(t).toString(16)),N(u(e).toString(16)),N(u(n).toString(16))].join("")}function y(t,e){e=0===e?0:e||10;var n=p(t).toHsl();return n.s-=e/100,n.s=R(n.s),p(n)}function v(t,e){e=0===e?0:e||10;var n=p(t).toHsl();return n.s+=e/100,n.s=R(n.s),p(n)}function _(t){return p(t).desaturate(100)}function x(t,e){e=0===e?0:e||10;var n=p(t).toHsl();return n.l+=e/100,n.l=R(n.l),p(n)}function b(t,e){e=0===e?0:e||10;var n=p(t).toRgb();return n.r=c(0,l(255,n.r-u(-e/100*255))),n.g=c(0,l(255,n.g-u(-e/100*255))),n.b=c(0,l(255,n.b-u(-e/100*255))),p(n)}function w(t,e){e=0===e?0:e||10;var n=p(t).toHsl();return n.l-=e/100,n.l=R(n.l),p(n)}function S(t,e){var n=p(t).toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,p(n)}function E(t){var e=p(t).toHsl();return e.h=(e.h+180)%360,p(e)}function C(t){var e=p(t).toHsl(),n=e.h;return[p(t),p({h:(n+120)%360,s:e.s,l:e.l}),p({h:(n+240)%360,s:e.s,l:e.l})]}function M(t){var e=p(t).toHsl(),n=e.h;return[p(t),p({h:(n+90)%360,s:e.s,l:e.l}),p({h:(n+180)%360,s:e.s,l:e.l}),p({h:(n+270)%360,s:e.s,l:e.l})]}function T(t){var e=p(t).toHsl(),n=e.h;return[p(t),p({h:(n+72)%360,s:e.s,l:e.l}),p({h:(n+216)%360,s:e.s,l:e.l})]}function A(t,e,n){e=e||6,n=n||30;var r=p(t).toHsl(),i=360/n,o=[p(t)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,o.push(p(r));return o}function P(t,e){e=e||6;for(var n=p(t).toHsv(),r=n.h,i=n.s,o=n.v,a=[],s=1/e;e--;)a.push(p({h:r,s:i,v:o})),o=(o+s)%1;return a}p.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,n,r=this.toRgb();return t=r.r/255,e=r.g/255,n=r.b/255,.2126*(t<=.03928?t/12.92:i.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:i.pow((e+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:i.pow((n+.055)/1.055,2.4))},setAlpha:function(t){return this._a=k(t),this._roundA=u(100*this._a)/100,this},toHsv:function(){var t=d(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=d(this._r,this._g,this._b),e=u(360*t.h),n=u(100*t.s),r=u(100*t.v);return 1==this._a?"hsv("+e+", "+n+"%, "+r+"%)":"hsva("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var t=f(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=f(this._r,this._g,this._b),e=u(360*t.h),n=u(100*t.s),r=u(100*t.l);return 1==this._a?"hsl("+e+", "+n+"%, "+r+"%)":"hsla("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(t){return m(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return function(t,e,n,r,i){var o=[N(u(t).toString(16)),N(u(e).toString(16)),N(u(n).toString(16)),N(z(r))];return i&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:u(this._r),g:u(this._g),b:u(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+u(this._r)+", "+u(this._g)+", "+u(this._b)+")":"rgba("+u(this._r)+", "+u(this._g)+", "+u(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:u(100*O(this._r,255))+"%",g:u(100*O(this._g,255))+"%",b:u(100*O(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+u(100*O(this._r,255))+"%, "+u(100*O(this._g,255))+"%, "+u(100*O(this._b,255))+"%)":"rgba("+u(100*O(this._r,255))+"%, "+u(100*O(this._g,255))+"%, "+u(100*O(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(I[m(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+g(this._r,this._g,this._b,this._a),n=e,r=this._gradientType?"GradientType = 1, ":"";if(t){var i=p(t);n="#"+g(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+e+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var n=!1,r=this._a<1&&this._a>=0;return e||!r||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return p(this.toString())},_applyModification:function(t,e){var n=t.apply(null,[this].concat([].slice.call(e)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(x,arguments)},brighten:function(){return this._applyModification(b,arguments)},darken:function(){return this._applyModification(w,arguments)},desaturate:function(){return this._applyModification(y,arguments)},saturate:function(){return this._applyModification(v,arguments)},greyscale:function(){return this._applyModification(_,arguments)},spin:function(){return this._applyModification(S,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(A,arguments)},complement:function(){return this._applyCombination(E,arguments)},monochromatic:function(){return this._applyCombination(P,arguments)},splitcomplement:function(){return this._applyCombination(T,arguments)},triad:function(){return this._applyCombination(C,arguments)},tetrad:function(){return this._applyCombination(M,arguments)}},p.fromRatio=function(t,e){if("object"==typeof t){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]="a"===r?t[r]:F(t[r]));t=n}return p(t,e)},p.equals=function(t,e){return!(!t||!e)&&p(t).toRgbString()==p(e).toRgbString()},p.random=function(){return p.fromRatio({r:h(),g:h(),b:h()})},p.mix=function(t,e,n){n=0===n?0:n||50;var r=p(t).toRgb(),i=p(e).toRgb(),o=n/100;return p({r:(i.r-r.r)*o+r.r,g:(i.g-r.g)*o+r.g,b:(i.b-r.b)*o+r.b,a:(i.a-r.a)*o+r.a})},p.readability=function(t,e){var n=p(t),r=p(e);return(i.max(n.getLuminance(),r.getLuminance())+.05)/(i.min(n.getLuminance(),r.getLuminance())+.05)},p.isReadable=function(t,e,n){var r,i,o,a,s,u=p.readability(t,e);switch(i=!1,(o=n,"AA"!==(a=((o=o||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==a&&(a="AA"),"small"!==(s=(o.size||"small").toLowerCase())&&"large"!==s&&(s="small"),r={level:a,size:s}).level+r.size){case"AAsmall":case"AAAlarge":i=u>=4.5;break;case"AAlarge":i=u>=3;break;case"AAAsmall":i=u>=7}return i},p.mostReadable=function(t,e,n){var r,i,o,a,s=null,u=0;i=(n=n||{}).includeFallbackColors,o=n.level,a=n.size;for(var l=0;l<e.length;l++)(r=p.readability(t,e[l]))>u&&(u=r,s=p(e[l]));return p.isReadable(t,s,{level:o,size:a})||!i?s:(n.includeFallbackColors=!1,p.mostReadable(t,["#fff","#000"],n))};var L=p.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},I=p.hexNames=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}(L);function k(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function O(t,e){(function(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var n=function(t){return"string"==typeof t&&-1!=t.indexOf("%")}(t);return t=l(e,c(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),i.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function R(t){return l(1,c(0,t))}function D(t){return parseInt(t,16)}function N(t){return 1==t.length?"0"+t:""+t}function F(t){return t<=1&&(t=100*t+"%"),t}function z(t){return i.round(255*parseFloat(t)).toString(16)}function B(t){return D(t)/255}var j,U,Z,V=(U="[\\s|\\(]+("+(j="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+j+")[,|\\s]+("+j+")\\s*\\)?",Z="[\\s|\\(]+("+j+")[,|\\s]+("+j+")[,|\\s]+("+j+")[,|\\s]+("+j+")\\s*\\)?",{CSS_UNIT:new RegExp(j),rgb:new RegExp("rgb"+U),rgba:new RegExp("rgba"+Z),hsl:new RegExp("hsl"+U),hsla:new RegExp("hsla"+Z),hsv:new RegExp("hsv"+U),hsva:new RegExp("hsva"+Z),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function G(t){return!!V.CSS_UNIT.exec(t)}t.exports?t.exports=p:void 0===(r=function(){return p}.call(e,n,e,t))||(t.exports=r)}(Math)},1048:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});class r{constructor(t=[],e=i){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,r=e[t];for(;t>0;){const i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r}_down(t){const{data:e,compare:n}=this,r=this.length>>1,i=e[t];for(;t<r;){let r=1+(t<<1),o=e[r];const a=r+1;if(a<this.length&&n(e[a],o)<0&&(r=a,o=e[a]),n(o,i)>=0)break;e[t]=o,t=r}e[t]=i}}function i(t,e){return t<e?-1:t>e?1:0}},3273:(t,e,n)=>{"use strict";function r(t){return t}function i(t){if(null==t)return r;var e,n,i=t.scale[0],o=t.scale[1],a=t.translate[0],s=t.translate[1];return function(t,r){r||(e=n=0);var u=2,l=t.length,c=new Array(l);for(c[0]=(e+=t[0])*i+a,c[1]=(n+=t[1])*o+s;u<l;)c[u]=t[u],++u;return c}}function o(t){var e,n=i(t.transform),r=1/0,o=r,a=-r,s=-r;function u(t){(t=n(t))[0]<r&&(r=t[0]),t[0]>a&&(a=t[0]),t[1]<o&&(o=t[1]),t[1]>s&&(s=t[1])}function l(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(l);break;case"Point":u(t.coordinates);break;case"MultiPoint":t.coordinates.forEach(u)}}for(e in t.arcs.forEach((function(t){for(var e,i=-1,u=t.length;++i<u;)(e=n(t[i],i))[0]<r&&(r=e[0]),e[0]>a&&(a=e[0]),e[1]<o&&(o=e[1]),e[1]>s&&(s=e[1])})),t.objects)l(t.objects[e]);return[r,o,a,s]}function a(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return s(t,e)}))}:s(t,e)}function s(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,o=u(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:n,properties:i,geometry:o}:{type:"Feature",id:n,bbox:r,properties:i,geometry:o}}function u(t,e){var n=i(t.transform),r=t.arcs;function o(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],o=0,a=i.length;o<a;++o)e.push(n(i[o],o));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,a)}function a(t){return n(t)}function s(t){for(var e=[],n=0,r=t.length;n<r;++n)o(t[n],e);return e.length<2&&e.push(e[0]),e}function u(t){for(var e=s(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(u)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=a(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(a);break;case"LineString":n=s(e.arcs);break;case"MultiLineString":n=e.arcs.map(s);break;case"Polygon":n=l(e.arcs);break;case"MultiPolygon":n=e.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(e)}function l(t,e){var n={},r={},i={},o=[],a=-1;function s(t,e){for(var r in t){var i=t[r];delete e[i.start],delete i.start,delete i.end,i.forEach((function(t){n[t<0?~t:t]=1})),o.push(i)}}return e.forEach((function(n,r){var i,o=t.arcs[n<0?~n:n];o.length<3&&!o[1][0]&&!o[1][1]&&(i=e[++a],e[a]=n,e[r]=i)})),e.forEach((function(e){var n,o,a=function(e){var n,r=t.arcs[e<0?~e:e],i=r[0];return t.transform?(n=[0,0],r.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=r[r.length-1],e<0?[n,i]:[i,n]}(e),s=a[0],u=a[1];if(n=i[s])if(delete i[n.end],n.push(e),n.end=u,o=r[u]){delete r[o.start];var l=o===n?n:n.concat(o);r[l.start=n.start]=i[l.end=o.end]=l}else r[n.start]=i[n.end]=n;else if(n=r[u])if(delete r[n.start],n.unshift(e),n.start=s,o=i[s]){delete i[o.end];var c=o===n?n:o.concat(n);r[c.start=o.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[e]).start=s]=i[n.end=u]=n})),s(i,r),s(r,i),e.forEach((function(t){n[t<0?~t:t]||o.push([t])})),o}function c(t){return u(t,h.apply(this,arguments))}function h(t,e,n){var r,i,o;if(arguments.length>1)r=p(0,e,n);else for(i=0,r=new Array(o=t.arcs.length);i<o;++i)r[i]=i;return{type:"MultiLineString",arcs:l(t,r)}}function p(t,e,n){var r,i=[],o=[];function a(t){var e=t<0?~t:t;(o[e]||(o[e]=[])).push({i:t,g:r})}function s(t){t.forEach(a)}function u(t){t.forEach(s)}return function t(e){switch(r=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":s(e.arcs);break;case"MultiLineString":case"Polygon":u(e.arcs);break;case"MultiPolygon":!function(t){t.forEach(u)}(e.arcs)}}(e),o.forEach(null==n?function(t){i.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&i.push(t[0].i)}),i}function f(t){return u(t,d.apply(this,arguments))}function d(t,e){var n={},r=[],i=[];function o(t){t.forEach((function(e){e.forEach((function(e){(n[e=e<0?~e:e]||(n[e]=[])).push(t)}))})),r.push(t)}function a(e){return function(t){for(var e,n=-1,r=t.length,i=t[r-1],o=0;++n<r;)e=i,i=t[n],o+=e[0]*i[1]-e[1]*i[0];return Math.abs(o)}(u(t,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach((function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":o(e.arcs);break;case"MultiPolygon":e.arcs.forEach(o)}})),r.forEach((function(t){if(!t._){var e=[],r=[t];for(t._=1,i.push(e);t=r.pop();)e.push(t),t.forEach((function(t){t.forEach((function(t){n[t<0?~t:t].forEach((function(t){t._||(t._=1,r.push(t))}))}))}))}})),r.forEach((function(t){delete t._})),{type:"MultiPolygon",arcs:i.map((function(e){var r,i=[];if(e.forEach((function(t){t.forEach((function(t){t.forEach((function(t){n[t<0?~t:t].length<2&&i.push(t)}))}))})),(r=(i=l(t,i)).length)>1)for(var o,s,u=1,c=a(i[0]);u<r;++u)(o=a(i[u]))>c&&(s=i[0],i[0]=i[u],i[u]=s,c=o);return i})).filter((function(t){return t.length>0}))}}function m(t,e){for(var n=0,r=t.length;n<r;){var i=n+r>>>1;t[i]<e?n=i+1:r=i}return n}function g(t){var e={},n=t.map((function(){return[]}));function r(t,n){t.forEach((function(t){t<0&&(t=~t);var r=e[t];r?r.push(n):e[t]=[n]}))}function i(t,e){t.forEach((function(t){r(t,e)}))}var o={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(t,e){t.forEach((function(t){i(t,e)}))}};for(var a in t.forEach((function t(e,n){"GeometryCollection"===e.type?e.geometries.forEach((function(e){t(e,n)})):e.type in o&&o[e.type](e.arcs,n)})),e)for(var s=e[a],u=s.length,l=0;l<u;++l)for(var c=l+1;c<u;++c){var h,p=s[l],f=s[c];(h=n[p])[a=m(h,f)]!==f&&h.splice(a,0,f),(h=n[f])[a=m(h,p)]!==p&&h.splice(a,0,p)}return n}function y(t){if(null==t)return r;var e,n,i=t.scale[0],o=t.scale[1],a=t.translate[0],s=t.translate[1];return function(t,r){r||(e=n=0);var u=2,l=t.length,c=new Array(l),h=Math.round((t[0]-a)/i),p=Math.round((t[1]-s)/o);for(c[0]=h-e,e=h,c[1]=p-n,n=p;u<l;)c[u]=t[u],++u;return c}}function v(t,e){if(t.transform)throw new Error("already quantized");if(e&&e.scale)u=t.bbox;else{if(!((n=Math.floor(e))>=2))throw new Error("n must be ≥2");var n,r=(u=t.bbox||o(t))[0],i=u[1],a=u[2],s=u[3];e={scale:[a-r?(a-r)/(n-1):1,s-i?(s-i)/(n-1):1],translate:[r,i]}}var u,l,c=y(e),h=t.objects,p={};function f(t){return c(t)}function d(t){var e;switch(t.type){case"GeometryCollection":e={type:"GeometryCollection",geometries:t.geometries.map(d)};break;case"Point":e={type:"Point",coordinates:f(t.coordinates)};break;case"MultiPoint":e={type:"MultiPoint",coordinates:t.coordinates.map(f)};break;default:return t}return null!=t.id&&(e.id=t.id),null!=t.bbox&&(e.bbox=t.bbox),null!=t.properties&&(e.properties=t.properties),e}for(l in h)p[l]=d(h[l]);return{type:"Topology",bbox:u,transform:e,objects:p,arcs:t.arcs.map((function(t){var e,n=0,r=1,i=t.length,o=new Array(i);for(o[0]=c(t[0],0);++n<i;)((e=c(t[n],n))[0]||e[1])&&(o[r++]=e);return 1===r&&(o[r++]=[0,0]),o.length=r,o}))}}n.r(e),n.d(e,{bbox:()=>o,feature:()=>a,merge:()=>f,mergeArcs:()=>d,mesh:()=>c,meshArcs:()=>h,neighbors:()=>g,quantize:()=>v,transform:()=>i,untransform:()=>y})},6898:(t,e,n)=>{"use strict";n.r(e),n.d(e,{__assign:()=>o,__asyncDelegator:()=>b,__asyncGenerator:()=>x,__asyncValues:()=>w,__await:()=>_,__awaiter:()=>c,__classPrivateFieldGet:()=>T,__classPrivateFieldIn:()=>P,__classPrivateFieldSet:()=>A,__createBinding:()=>p,__decorate:()=>s,__exportStar:()=>f,__extends:()=>i,__generator:()=>h,__importDefault:()=>M,__importStar:()=>C,__makeTemplateObject:()=>S,__metadata:()=>l,__param:()=>u,__read:()=>m,__rest:()=>a,__spread:()=>g,__spreadArray:()=>v,__spreadArrays:()=>y,__values:()=>d});var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},o.apply(this,arguments)};function a(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function s(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function u(t,e){return function(n,r){e(n,r,t)}}function l(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function h(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}var p=Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]};function f(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||p(e,t,n)}function d(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function m(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function g(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(m(arguments[e]));return t}function y(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function v(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function _(t){return this instanceof _?(this.v=t,this):new _(t)}function x(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||s(t,e)}))})}function s(t,e){try{(n=i[t](e)).value instanceof _?Promise.resolve(n.value.v).then(u,l):c(o[0][2],n)}catch(t){c(o[0][3],t)}var n}function u(t){s("next",t)}function l(t){s("throw",t)}function c(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function b(t){var e,n;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:_(t[r](e)),done:"return"===r}:i?i(e):e}:i}}function w(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=d(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){!function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)}(r,i,(e=t[n](e)).done,e.value)}))}}}function S(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var E=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};function C(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&p(e,t,n);return E(e,t),e}function M(t){return t&&t.__esModule?t:{default:t}}function T(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)}function A(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n}function P(t,e){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof t?e===t:t.has(e)}},9055:function(t,e){!function(t){"use strict";function e(){}function n(t){this.message=t||""}function r(t){this.message=t||""}function i(t){this.message=t||""}function o(){}function a(t){return null===t?Rt:t.color}function s(t){return null===t?null:t.parent}function u(t,e){null!==t&&(t.color=e)}function l(t){return null===t?null:t.left}function c(t){return null===t?null:t.right}function h(){this.root_=null,this.size_=0}function p(){}function f(){this.array_=[],arguments[0]instanceof xt&&this.addAll(arguments[0])}function d(){}function m(t){this.message=t||""}function g(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var i=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(i=i<0?Math.max(n+arguments[2],0):Math.min(i,n);r<i;)e[r]=t,++r;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var y=function(){};y.prototype.interfaces_=function(){return[]},y.prototype.getClass=function(){return y},y.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var v=function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),_=function(){},x={MAX_VALUE:{configurable:!0}};_.isNaN=function(t){return Number.isNaN(t)},_.doubleToLongBits=function(t){return t},_.longBitsToDouble=function(t){return t},_.isInfinite=function(t){return!Number.isFinite(t)},x.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(_,x);var b=function(){},w=function(){},S=function(){},E=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},C={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};E.prototype.setOrdinate=function(t,e){switch(t){case E.X:this.x=e;break;case E.Y:this.y=e;break;case E.Z:this.z=e;break;default:throw new v("Invalid ordinate index: "+t)}},E.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!y.equalsWithTolerance(this.x,e.x,n)&&!!y.equalsWithTolerance(this.y,e.y,n)}},E.prototype.getOrdinate=function(t){switch(t){case E.X:return this.x;case E.Y:return this.y;case E.Z:return this.z}throw new v("Invalid ordinate index: "+t)},E.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||_.isNaN(this.z))&&_.isNaN(t.z)},E.prototype.equals=function(t){return t instanceof E&&this.equals2D(t)},E.prototype.equalInZ=function(t,e){return y.equalsWithTolerance(this.z,t.z,e)},E.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},E.prototype.clone=function(){},E.prototype.copy=function(){return new E(this)},E.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},E.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+n*n+r*r)},E.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},E.prototype.hashCode=function(){var t=17;return 37*(t=37*t+E.hashCode(this.x))+E.hashCode(this.y)},E.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},E.prototype.interfaces_=function(){return[b,w,e]},E.prototype.getClass=function(){return E},E.hashCode=function(){if(1===arguments.length){var t=arguments[0],e=_.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}},C.DimensionalComparator.get=function(){return M},C.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},C.NULL_ORDINATE.get=function(){return _.NaN},C.X.get=function(){return 0},C.Y.get=function(){return 1},C.Z.get=function(){return 2},Object.defineProperties(E,C);var M=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new v("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};M.prototype.compare=function(t,e){var n=t,r=e,i=M.compare(n.x,r.x);if(0!==i)return i;var o=M.compare(n.y,r.y);return 0!==o?o:this._dimensionsToTest<=2?0:M.compare(n.z,r.z)},M.prototype.interfaces_=function(){return[S]},M.prototype.getClass=function(){return M},M.compare=function(t,e){return t<e?-1:t>e?1:_.isNaN(t)?_.isNaN(e)?0:-1:_.isNaN(e)?1:0};var T=function(){};T.prototype.create=function(){},T.prototype.interfaces_=function(){return[]},T.prototype.getClass=function(){return T};var A=function(){},P={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};A.prototype.interfaces_=function(){return[]},A.prototype.getClass=function(){return A},A.toLocationSymbol=function(t){switch(t){case A.EXTERIOR:return"e";case A.BOUNDARY:return"b";case A.INTERIOR:return"i";case A.NONE:return"-"}throw new v("Unknown location value: "+t)},P.INTERIOR.get=function(){return 0},P.BOUNDARY.get=function(){return 1},P.EXTERIOR.get=function(){return 2},P.NONE.get=function(){return-1},Object.defineProperties(A,P);var L=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},I=function(){},k={LOG_10:{configurable:!0}};I.prototype.interfaces_=function(){return[]},I.prototype.getClass=function(){return I},I.log10=function(t){var e=Math.log(t);return _.isInfinite(e)||_.isNaN(e)?e:e/I.LOG_10},I.min=function(t,e,n,r){var i=t;return e<i&&(i=e),n<i&&(i=n),r<i&&(i=r),i},I.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],o=arguments[2];return r<i?i:r>o?o:r}},I.wrap=function(t,e){return t<0?e- -t%e:t%e},I.max=function(){if(3===arguments.length){var t=arguments[1],e=arguments[2],n=arguments[0];return t>n&&(n=t),e>n&&(n=e),n}if(4===arguments.length){var r=arguments[1],i=arguments[2],o=arguments[3],a=arguments[0];return r>a&&(a=r),i>a&&(a=i),o>a&&(a=o),a}},I.average=function(t,e){return(t+e)/2},k.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(I,k);var O=function(t){this.str=t};O.prototype.append=function(t){this.str+=t},O.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},O.prototype.toString=function(t){return this.str};var R=function(t){this.value=t};R.prototype.intValue=function(){return this.value},R.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},R.isNaN=function(t){return Number.isNaN(t)};var D=function(){};D.isWhitespace=function(t){return t<=32&&t>=0||127===t},D.toUpperCase=function(t){return t.toUpperCase()};var N=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length)if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else"string"==typeof arguments[0]&&t.call(this,t.parse(arguments[0]));else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.init(r,i)}},F={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};N.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},N.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),r=N.magnitude(n._hi),i=N.TEN.pow(r);(n=n.divide(i)).gt(N.TEN)?(n=n.divide(N.TEN),r+=1):n.lt(N.ONE)&&(n=n.multiply(N.TEN),r-=1);for(var o=r+1,a=new O,s=N.MAX_PRINT_DIGITS-1,u=0;u<=s;u++){t&&u===o&&a.append(".");var l=Math.trunc(n._hi);if(l<0)break;var c=!1,h=0;l>9?(c=!0,h="9"):h="0"+l,a.append(h),n=n.subtract(N.valueOf(l)).multiply(N.TEN),c&&n.selfAdd(N.TEN);var p=!0,f=N.magnitude(n._hi);if(f<0&&Math.abs(f)>=s-u&&(p=!1),!p)break}return e[0]=r,a.toString()},N.prototype.sqr=function(){return this.multiply(this)},N.prototype.doubleValue=function(){return this._hi+this._lo},N.prototype.subtract=function(){if(arguments[0]instanceof N){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},N.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},N.prototype.isZero=function(){return 0===this._hi&&0===this._lo},N.prototype.selfSubtract=function(){if(arguments[0]instanceof N){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},N.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},N.prototype.min=function(t){return this.le(t)?this:t},N.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof N){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=null,o=null,a=null,s=null,u=null,l=null,c=null,h=null;return u=this._hi/n,h=(i=(l=N.SPLIT*u)-(i=l-u))*(a=(h=N.SPLIT*n)-(a=h-n))-(c=u*n)+i*(s=n-a)+(o=u-i)*a+o*s,h=u+(l=(this._hi-c-h+this._lo-u*r)/n),this._hi=h,this._lo=u-h+l,this}},N.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},N.prototype.divide=function(){if(arguments[0]instanceof N){var t=arguments[0],e=null,n=null,r=null,i=null,o=null,a=null,s=null,u=null;return n=(o=this._hi/t._hi)-(e=(a=N.SPLIT*o)-(e=a-o)),u=e*(r=(u=N.SPLIT*t._hi)-(r=u-t._hi))-(s=o*t._hi)+e*(i=t._hi-r)+n*r+n*i,a=(this._hi-s-u+this._lo-o*t._lo)/t._hi,new N(u=o+a,o-u+a)}if("number"==typeof arguments[0]){var l=arguments[0];return _.isNaN(l)?N.createNaN():N.copy(this).selfDivide(l,0)}},N.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},N.prototype.pow=function(t){if(0===t)return N.valueOf(1);var e=new N(this),n=N.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2==1&&n.selfMultiply(e),(r/=2)>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n},N.prototype.ceil=function(){if(this.isNaN())return N.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new N(t,e)},N.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},N.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},N.prototype.setValue=function(){if(arguments[0]instanceof N){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},N.prototype.max=function(t){return this.ge(t)?this:t},N.prototype.sqrt=function(){if(this.isZero())return N.valueOf(0);if(this.isNegative())return N.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=N.valueOf(e),r=this.subtract(n.sqr())._hi*(.5*t);return n.add(r)},N.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof N){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0],n=null,r=null,i=null,o=null,a=null,s=null;return o=(i=this._hi+e)-(a=i-this._hi),r=(s=(o=e-a+(this._hi-o))+this._lo)+(i-(n=i+s)),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(2===arguments.length){var u=arguments[0],l=arguments[1],c=null,h=null,p=null,f=null,d=null,m=null,g=null;f=this._hi+u,h=this._lo+l,d=f-(m=f-this._hi),p=h-(g=h-this._lo);var y=(c=f+(m=(d=u-m+(this._hi-d))+h))+(m=(p=l-g+(this._lo-p))+(m+(f-c))),v=m+(c-y);return this._hi=y,this._lo=v,this}},N.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof N){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=null,o=null,a=null,s=null,u=null,l=null;i=(u=N.SPLIT*this._hi)-this._hi,l=N.SPLIT*n,i=u-i,o=this._hi-i,a=l-n;var c=(u=this._hi*n)+(l=i*(a=l-a)-u+i*(s=n-a)+o*a+o*s+(this._hi*r+this._lo*n)),h=l+(i=u-c);return this._hi=c,this._lo=h,this}},N.prototype.selfSqr=function(){return this.selfMultiply(this)},N.prototype.floor=function(){if(this.isNaN())return N.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new N(t,e)},N.prototype.negate=function(){return this.isNaN()?this:new N(-this._hi,-this._lo)},N.prototype.clone=function(){},N.prototype.multiply=function(){if(arguments[0]instanceof N){var t=arguments[0];return t.isNaN()?N.createNaN():N.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return _.isNaN(e)?N.createNaN():N.copy(this).selfMultiply(e,0)}},N.prototype.isNaN=function(){return _.isNaN(this._hi)},N.prototype.intValue=function(){return Math.trunc(this._hi)},N.prototype.toString=function(){var t=N.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},N.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),r=e[0]+1,i=n;if("."===n.charAt(0))i="0"+n;else if(r<0)i="0."+N.stringOfChar("0",-r)+n;else if(-1===n.indexOf(".")){var o=r-n.length;i=n+N.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+i:i},N.prototype.reciprocal=function(){var t,e,n,r,i=null,o=null,a=null,s=null;t=(n=1/this._hi)-(i=(a=N.SPLIT*n)-(i=a-n)),o=(s=N.SPLIT*this._hi)-this._hi;var u=n+(a=(1-(r=n*this._hi)-(s=i*(o=s-o)-r+i*(e=this._hi-o)+t*o+t*e)-n*this._lo)/this._hi);return new N(u,n-u+a)},N.prototype.toSciNotation=function(){if(this.isZero())return N.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),r=N.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var i="";n.length>1&&(i=n.substring(1));var o=n.charAt(0)+"."+i;return this.isNegative()?"-"+o+r:o+r},N.prototype.abs=function(){return this.isNaN()?N.NaN:this.isNegative()?this.negate():new N(this)},N.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},N.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},N.prototype.add=function(){if(arguments[0]instanceof N){var t=arguments[0];return N.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return N.copy(this).selfAdd(e)}},N.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof N){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}},N.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},N.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},N.prototype.trunc=function(){return this.isNaN()?N.NaN:this.isPositive()?this.floor():this.ceil()},N.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},N.prototype.interfaces_=function(){return[e,b,w]},N.prototype.getClass=function(){return N},N.sqr=function(t){return N.valueOf(t).selfMultiply(t)},N.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return N.parse(t)}if("number"==typeof arguments[0])return new N(arguments[0])},N.sqrt=function(t){return N.valueOf(t).sqrt()},N.parse=function(t){for(var e=0,n=t.length;D.isWhitespace(t.charAt(e));)e++;var r=!1;if(e<n){var i=t.charAt(e);"-"!==i&&"+"!==i||(e++,"-"===i&&(r=!0))}for(var o=new N,a=0,s=0,u=0;!(e>=n);){var l=t.charAt(e);if(e++,D.isDigit(l)){var c=l-"0";o.selfMultiply(N.TEN),o.selfAdd(c),a++}else{if("."!==l){if("e"===l||"E"===l){var h=t.substring(e);try{u=R.parseInt(h)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+h+" in string "+t):e}break}throw new Error("Unexpected character '"+l+"' at position "+e+" in string "+t)}s=a}}var p=o,f=a-s-u;if(0===f)p=o;else if(f>0){var d=N.TEN.pow(f);p=o.divide(d)}else if(f<0){var m=N.TEN.pow(-f);p=o.multiply(m)}return r?p.negate():p},N.createNaN=function(){return new N(_.NaN,_.NaN)},N.copy=function(t){return new N(t)},N.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),r=Math.trunc(Math.floor(n));return 10*Math.pow(10,r)<=e&&(r+=1),r},N.stringOfChar=function(t,e){for(var n=new O,r=0;r<e;r++)n.append(t);return n.toString()},F.PI.get=function(){return new N(3.141592653589793,12246467991473532e-32)},F.TWO_PI.get=function(){return new N(6.283185307179586,24492935982947064e-32)},F.PI_2.get=function(){return new N(1.5707963267948966,6123233995736766e-32)},F.E.get=function(){return new N(2.718281828459045,14456468917292502e-32)},F.NaN.get=function(){return new N(_.NaN,_.NaN)},F.EPS.get=function(){return 123259516440783e-46},F.SPLIT.get=function(){return 134217729},F.MAX_PRINT_DIGITS.get=function(){return 32},F.TEN.get=function(){return N.valueOf(10)},F.ONE.get=function(){return N.valueOf(1)},F.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},F.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(N,F);var z=function(){},B={DP_SAFE_EPSILON:{configurable:!0}};z.prototype.interfaces_=function(){return[]},z.prototype.getClass=function(){return z},z.orientationIndex=function(t,e,n){var r=z.orientationIndexFilter(t,e,n);if(r<=1)return r;var i=N.valueOf(e.x).selfAdd(-t.x),o=N.valueOf(e.y).selfAdd(-t.y),a=N.valueOf(n.x).selfAdd(-e.x),s=N.valueOf(n.y).selfAdd(-e.y);return i.selfMultiply(s).selfSubtract(o.selfMultiply(a)).signum()},z.signOfDet2x2=function(t,e,n,r){return t.multiply(r).selfSubtract(e.multiply(n)).signum()},z.intersection=function(t,e,n,r){var i=N.valueOf(r.y).selfSubtract(n.y).selfMultiply(N.valueOf(e.x).selfSubtract(t.x)),o=N.valueOf(r.x).selfSubtract(n.x).selfMultiply(N.valueOf(e.y).selfSubtract(t.y)),a=i.subtract(o),s=N.valueOf(r.x).selfSubtract(n.x).selfMultiply(N.valueOf(t.y).selfSubtract(n.y)),u=N.valueOf(r.y).selfSubtract(n.y).selfMultiply(N.valueOf(t.x).selfSubtract(n.x)),l=s.subtract(u).selfDivide(a).doubleValue(),c=N.valueOf(t.x).selfAdd(N.valueOf(e.x).selfSubtract(t.x).selfMultiply(l)).doubleValue(),h=N.valueOf(e.x).selfSubtract(t.x).selfMultiply(N.valueOf(t.y).selfSubtract(n.y)),p=N.valueOf(e.y).selfSubtract(t.y).selfMultiply(N.valueOf(t.x).selfSubtract(n.x)),f=h.subtract(p).selfDivide(a).doubleValue(),d=N.valueOf(n.y).selfAdd(N.valueOf(r.y).selfSubtract(n.y).selfMultiply(f)).doubleValue();return new E(c,d)},z.orientationIndexFilter=function(t,e,n){var r=null,i=(t.x-n.x)*(e.y-n.y),o=(t.y-n.y)*(e.x-n.x),a=i-o;if(i>0){if(o<=0)return z.signum(a);r=i+o}else{if(!(i<0))return z.signum(a);if(o>=0)return z.signum(a);r=-i-o}var s=z.DP_SAFE_EPSILON*r;return a>=s||-a>=s?z.signum(a):2},z.signum=function(t){return t>0?1:t<0?-1:0},B.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(z,B);var j=function(){},U={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};U.X.get=function(){return 0},U.Y.get=function(){return 1},U.Z.get=function(){return 2},U.M.get=function(){return 3},j.prototype.setOrdinate=function(t,e,n){},j.prototype.size=function(){},j.prototype.getOrdinate=function(t,e){},j.prototype.getCoordinate=function(){},j.prototype.getCoordinateCopy=function(t){},j.prototype.getDimension=function(){},j.prototype.getX=function(t){},j.prototype.clone=function(){},j.prototype.expandEnvelope=function(t){},j.prototype.copy=function(){},j.prototype.getY=function(t){},j.prototype.toCoordinateArray=function(){},j.prototype.interfaces_=function(){return[w]},j.prototype.getClass=function(){return j},Object.defineProperties(j,U);var Z=function(){},V=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Z),G=function(){};G.arraycopy=function(t,e,n,r,i){for(var o=0,a=e;a<e+i;a++)n[r+o]=t[a],o++},G.getProperty=function(t){return{"line.separator":"\n"}[t]};var H=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],o=arguments[1];this.x=i.y*o.w-o.y*i.w,this.y=o.x*i.w-i.x*o.w,this.w=i.x*o.y-o.x*i.y}else if(arguments[0]instanceof E&&arguments[1]instanceof E){var a=arguments[0],s=arguments[1];this.x=a.y-s.y,this.y=s.x-a.x,this.w=a.x*s.y-s.x*a.y}}else if(3===arguments.length){var u=arguments[0],l=arguments[1],c=arguments[2];this.x=u,this.y=l,this.w=c}else if(4===arguments.length){var h=arguments[0],p=arguments[1],f=arguments[2],d=arguments[3],m=h.y-p.y,g=p.x-h.x,y=h.x*p.y-p.x*h.y,v=f.y-d.y,_=d.x-f.x,x=f.x*d.y-d.x*f.y;this.x=g*x-_*y,this.y=v*y-m*x,this.w=m*_-v*g}};H.prototype.getY=function(){var t=this.y/this.w;if(_.isNaN(t)||_.isInfinite(t))throw new V;return t},H.prototype.getX=function(){var t=this.x/this.w;if(_.isNaN(t)||_.isInfinite(t))throw new V;return t},H.prototype.getCoordinate=function(){var t=new E;return t.x=this.getX(),t.y=this.getY(),t},H.prototype.interfaces_=function(){return[]},H.prototype.getClass=function(){return H},H.intersection=function(t,e,n,r){var i=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,s=n.y-r.y,u=r.x-n.x,l=n.x*r.y-r.x*n.y,c=i*u-s*o,h=(o*l-u*a)/c,p=(s*a-i*l)/c;if(_.isNaN(h)||_.isInfinite(h)||_.isNaN(p)||_.isInfinite(p))throw new V;return new E(h,p)};var W=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof E){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(4===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2],u=arguments[3];this.init(o,a,s,u)}},q={serialVersionUID:{configurable:!0}};W.prototype.getArea=function(){return this.getWidth()*this.getHeight()},W.prototype.equals=function(t){if(!(t instanceof W))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},W.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new W;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new W(e,r,n,i)},W.prototype.isNull=function(){return this._maxx<this._minx},W.prototype.getMaxX=function(){return this._maxx},W.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof E){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof W){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}},W.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof W){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof E){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}},W.prototype.getMinY=function(){return this._miny},W.prototype.getMinX=function(){return this._minx},W.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof E){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof W){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}},W.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},W.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},W.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},W.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},W.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},W.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},W.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},W.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},W.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},W.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof W){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof E){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.covers(n,r)}},W.prototype.centre=function(){return this.isNull()?null:new E((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},W.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof E){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof W){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];i<o?(this._minx=i,this._maxx=o):(this._minx=o,this._maxx=i),a<s?(this._miny=a,this._maxy=s):(this._miny=s,this._maxy=a)}},W.prototype.getMaxY=function(){return this._maxy},W.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),0===e?n:0===n?e:Math.sqrt(e*e+n*n)},W.prototype.hashCode=function(){var t=17;return 37*(t=37*(t=37*(t=37*t+E.hashCode(this._minx))+E.hashCode(this._maxx))+E.hashCode(this._miny))+E.hashCode(this._maxy)},W.prototype.interfaces_=function(){return[b,e]},W.prototype.getClass=function(){return W},W.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],s=Math.min(o.x,a.x),u=Math.max(o.x,a.x),l=Math.min(r.x,i.x),c=Math.max(r.x,i.x);return!(l>u||c<s||(s=Math.min(o.y,a.y),u=Math.max(o.y,a.y),l=Math.min(r.y,i.y),c=Math.max(r.y,i.y),l>u||c<s))}},q.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(W,q);var X={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Y=function(t){this.geometryFactory=t||new ye};Y.prototype.read=function(t){var e,n,r;t=t.replace(/[\n\r]/g," ");var i=X.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((i=X.emptyTypeStr.exec(t))[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],Q[n]&&(e=Q[n].apply(this,[r]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},Y.prototype.write=function(t){return this.extractGeometry(t)},Y.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!K[e])return null;var n=e.toUpperCase();return t.isEmpty()?n+" EMPTY":n+"("+K[e].apply(this,[t])+")"};var K={coordinate:function(t){return t.x+" "+t.y},point:function(t){return K.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+K.point.apply(this,[t._geometries[n]])+")");return e.join(",")},linestring:function(t){for(var e=[],n=0,r=t._points._coordinates.length;n<r;++n)e.push(K.coordinate.apply(this,[t._points._coordinates[n]]));return e.join(",")},linearring:function(t){for(var e=[],n=0,r=t._points._coordinates.length;n<r;++n)e.push(K.coordinate.apply(this,[t._points._coordinates[n]]));return e.join(",")},multilinestring:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+K.linestring.apply(this,[t._geometries[n]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+K.linestring.apply(this,[t._shell])+")");for(var n=0,r=t._holes.length;n<r;++n)e.push("("+K.linestring.apply(this,[t._holes[n]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+K.polygon.apply(this,[t._geometries[n]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push(this.extractGeometry(t._geometries[n]));return e.join(",")}},Q={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(X.spaces);return this.geometryFactory.createPoint(new E(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){if(void 0===t)return this.geometryFactory.createMultiPoint();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(X.trimParens,"$1"),r.push(Q.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(r)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].trim().split(X.spaces),r.push(new E(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(r)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].trim().split(X.spaces),r.push(new E(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(t){if(void 0===t)return this.geometryFactory.createMultiLineString();for(var e,n=t.trim().split(X.parenComma),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(X.trimParens,"$1"),r.push(Q.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(r)},polygon:function(t){if(void 0===t)return this.geometryFactory.createPolygon();for(var e,n,r,i,o=t.trim().split(X.parenComma),a=[],s=0,u=o.length;s<u;++s)e=o[s].replace(X.trimParens,"$1"),n=Q.linestring.apply(this,[e]),r=this.geometryFactory.createLinearRing(n._points),0===s?i=r:a.push(r);return this.geometryFactory.createPolygon(i,a)},multipolygon:function(t){if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var e,n=t.trim().split(X.doubleParenComma),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(X.trimParens,"$1"),r.push(Q.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],r=0,i=e.length;r<i;++r)n.push(this.read(e[r]));return this.geometryFactory.createGeometryCollection(n)}},J=function(t){this.parser=new Y(t)};J.prototype.write=function(t){return this.parser.write(t)},J.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var $=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),tt=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}($),et=function(){};et.prototype.interfaces_=function(){return[]},et.prototype.getClass=function(){return et},et.shouldNeverReachHere=function(){if(0===arguments.length)et.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new tt("Should never reach here"+(null!==t?": "+t:""))}},et.isTrue=function(){var t;if(1===arguments.length)et.isTrue(arguments[0],null);else if(2===arguments.length&&(t=arguments[1],!arguments[0]))throw null===t?new tt:new tt(t)},et.equals=function(){var t,e,n;if(2===arguments.length)et.equals(t=arguments[0],e=arguments[1],null);else if(3===arguments.length&&(t=arguments[0],n=arguments[2],!(e=arguments[1]).equals(t)))throw new tt("Expected "+t+" but encountered "+e+(null!==n?": "+n:""))};var nt=function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new E,this._intPt[1]=new E,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},rt={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};nt.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},nt.prototype.getTopologySummary=function(){var t=new O;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},nt.prototype.computeIntersection=function(t,e,n,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,n,r)},nt.prototype.getIntersectionNum=function(){return this._result},nt.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},nt.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},nt.prototype.setPrecisionModel=function(t){this._precisionModel=t},nt.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this._result;e++)if(!this._intPt[e].equals2D(this._inputLines[t][0])&&!this._intPt[e].equals2D(this._inputLines[t][1]))return!0;return!1}},nt.prototype.getIntersection=function(t){return this._intPt[t]},nt.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},nt.prototype.hasIntersection=function(){return this._result!==nt.NO_INTERSECTION},nt.prototype.getEdgeDistance=function(t,e){return nt.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},nt.prototype.isCollinear=function(){return this._result===nt.COLLINEAR_INTERSECTION},nt.prototype.toString=function(){return J.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+J.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},nt.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},nt.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},nt.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},nt.prototype.interfaces_=function(){return[]},nt.prototype.getClass=function(){return nt},nt.computeEdgeDistance=function(t,e,n){var r=Math.abs(n.x-e.x),i=Math.abs(n.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(n))o=r>i?r:i;else{var a=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);0!==(o=r>i?a:s)||t.equals(e)||(o=Math.max(a,s))}return et.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},nt.nonRobustComputeEdgeDistance=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,o=Math.sqrt(r*r+i*i);return et.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},rt.DONT_INTERSECT.get=function(){return 0},rt.DO_INTERSECT.get=function(){return 1},rt.COLLINEAR.get=function(){return 2},rt.NO_INTERSECTION.get=function(){return 0},rt.POINT_INTERSECTION.get=function(){return 1},rt.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(nt,rt);var it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new W(this._inputLines[0][0],this._inputLines[0][1]),n=new W(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&n.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],n=arguments[1],r=arguments[2];if(this._isProper=!1,W.intersects(n,r,e)&&0===st.orientationIndex(n,r,e)&&0===st.orientationIndex(r,n,e))return this._isProper=!0,(e.equals(n)||e.equals(r))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,n,r,i){i.x=this.smallestInAbsValue(t.x,e.x,n.x,r.x),i.y=this.smallestInAbsValue(t.y,e.y,n.y,r.y),t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},e.prototype.safeHCoordinateIntersection=function(t,n,r,i){var o=null;try{o=H.intersection(t,n,r,i)}catch(a){if(!(a instanceof V))throw a;o=e.nearestEndpoint(t,n,r,i)}return o},e.prototype.intersection=function(t,n,r,i){var o=this.intersectionWithNormalization(t,n,r,i);return this.isInSegmentEnvelopes(o)||(o=new E(e.nearestEndpoint(t,n,r,i))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,n,r){var i=t,o=Math.abs(i);return Math.abs(e)<o&&(i=e,o=Math.abs(e)),Math.abs(n)<o&&(i=n,o=Math.abs(n)),Math.abs(r)<o&&(i=r),i},e.prototype.checkDD=function(t,e,n,r,i){var o=z.intersection(t,e,n,r),a=this.isInSegmentEnvelopes(o);G.out.println("DD in env = "+a+"  --------------------- "+o),i.distance(o)>1e-4&&G.out.println("Distance = "+i.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,n,r){var i=new E(t),o=new E(e),a=new E(n),s=new E(r),u=new E;this.normalizeToEnvCentre(i,o,a,s,u);var l=this.safeHCoordinateIntersection(i,o,a,s);return l.x+=u.x,l.y+=u.y,l},e.prototype.computeCollinearIntersection=function(e,n,r,i){var o=W.intersects(e,n,r),a=W.intersects(e,n,i),s=W.intersects(r,i,e),u=W.intersects(r,i,n);return o&&a?(this._intPt[0]=r,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):s&&u?(this._intPt[0]=e,this._intPt[1]=n,t.COLLINEAR_INTERSECTION):o&&s?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||a||u?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&u?(this._intPt[0]=r,this._intPt[1]=n,!r.equals(n)||a||s?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):a&&s?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||o||u?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):a&&u?(this._intPt[0]=i,this._intPt[1]=n,!i.equals(n)||o||s?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,n,r,i){var o=t.x<e.x?t.x:e.x,a=t.y<e.y?t.y:e.y,s=t.x>e.x?t.x:e.x,u=t.y>e.y?t.y:e.y,l=n.x<r.x?n.x:r.x,c=n.y<r.y?n.y:r.y,h=n.x>r.x?n.x:r.x,p=n.y>r.y?n.y:r.y,f=((o>l?o:l)+(s<h?s:h))/2,d=((a>c?a:c)+(u<p?u:p))/2;i.x=f,i.y=d,t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},e.prototype.computeIntersect=function(e,n,r,i){if(this._isProper=!1,!W.intersects(e,n,r,i))return t.NO_INTERSECTION;var o=st.orientationIndex(e,n,r),a=st.orientationIndex(e,n,i);if(o>0&&a>0||o<0&&a<0)return t.NO_INTERSECTION;var s=st.orientationIndex(r,i,e),u=st.orientationIndex(r,i,n);return s>0&&u>0||s<0&&u<0?t.NO_INTERSECTION:0===o&&0===a&&0===s&&0===u?this.computeCollinearIntersection(e,n,r,i):(0===o||0===a||0===s||0===u?(this._isProper=!1,e.equals2D(r)||e.equals2D(i)?this._intPt[0]=e:n.equals2D(r)||n.equals2D(i)?this._intPt[0]=n:0===o?this._intPt[0]=new E(r):0===a?this._intPt[0]=new E(i):0===s?this._intPt[0]=new E(e):0===u&&(this._intPt[0]=new E(n))):(this._isProper=!0,this._intPt[0]=this.intersection(e,n,r,i)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,n,r){var i=t,o=st.distancePointLine(t,n,r),a=st.distancePointLine(e,n,r);return a<o&&(o=a,i=e),(a=st.distancePointLine(n,t,e))<o&&(o=a,i=n),(a=st.distancePointLine(r,t,e))<o&&(o=a,i=r),i},e}(nt),ot=function(){};ot.prototype.interfaces_=function(){return[]},ot.prototype.getClass=function(){return ot},ot.orientationIndex=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=n.x-e.x,a=n.y-e.y;return ot.signOfDet2x2(r,i,o,a)},ot.signOfDet2x2=function(t,e,n,r){var i=null,o=null,a=null;if(i=1,0===t||0===r)return 0===e||0===n?0:e>0?n>0?-i:i:n>0?i:-i;if(0===e||0===n)return r>0?t>0?i:-i:t>0?-i:i;if(e>0?r>0?e<=r||(i=-i,o=t,t=n,n=o,o=e,e=r,r=o):e<=-r?(i=-i,n=-n,r=-r):(o=t,t=-n,n=o,o=e,e=-r,r=o):r>0?-e<=r?(i=-i,t=-t,e=-e):(o=-t,t=n,n=o,o=-e,e=r,r=o):e>=r?(t=-t,e=-e,n=-n,r=-r):(i=-i,o=-t,t=-n,n=o,o=-e,e=-r,r=o),t>0){if(!(n>0))return i;if(!(t<=n))return i}else{if(n>0)return-i;if(!(t>=n))return-i;i=-i,t=-t,n=-n}for(;;){if((r-=(a=Math.floor(n/t))*e)<0)return-i;if(r>e)return i;if(t>(n-=a*t)+n){if(e<r+r)return i}else{if(e>r+r)return-i;n=t-n,r=e-r,i=-i}if(0===r)return 0===n?0:-i;if(0===n)return i;if((e-=(a=Math.floor(t/n))*r)<0)return i;if(e>r)return-i;if(n>(t-=a*n)+t){if(r<e+e)return-i}else{if(r>e+e)return i;t=n-t,e=r-e,i=-i}if(0===e)return 0===t?0:i;if(0===t)return-i}};var at=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};at.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,r=e.x;return n>r&&(n=e.x,r=t.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,o=t.y-this._p.y,a=e.x-this._p.x,s=e.y-this._p.y,u=ot.signOfDet2x2(i,o,a,s);if(0===u)return this._isPointOnSegment=!0,null;s<o&&(u=-u),u>0&&this._crossingCount++}},at.prototype.isPointInPolygon=function(){return this.getLocation()!==A.EXTERIOR},at.prototype.getLocation=function(){return this._isPointOnSegment?A.BOUNDARY:this._crossingCount%2==1?A.INTERIOR:A.EXTERIOR},at.prototype.isOnSegment=function(){return this._isPointOnSegment},at.prototype.interfaces_=function(){return[]},at.prototype.getClass=function(){return at},at.locatePointInRing=function(){if(arguments[0]instanceof E&&L(arguments[1],j)){for(var t=arguments[1],e=new at(arguments[0]),n=new E,r=new E,i=1;i<t.size();i++)if(t.getCoordinate(i,n),t.getCoordinate(i-1,r),e.countSegment(n,r),e.isOnSegment())return e.getLocation();return e.getLocation()}if(arguments[0]instanceof E&&arguments[1]instanceof Array){for(var o=arguments[1],a=new at(arguments[0]),s=1;s<o.length;s++){var u=o[s],l=o[s-1];if(a.countSegment(u,l),a.isOnSegment())return a.getLocation()}return a.getLocation()}};var st=function(){},ut={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};st.prototype.interfaces_=function(){return[]},st.prototype.getClass=function(){return st},st.orientationIndex=function(t,e,n){return z.orientationIndex(t,e,n)},st.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,r=1;r<t.length-1;r++){var i=t[r].x-n,o=t[r+1].y;e+=i*(t[r-1].y-o)}return e/2}if(L(arguments[0],j)){var a=arguments[0],s=a.size();if(s<3)return 0;var u=new E,l=new E,c=new E;a.getCoordinate(0,l),a.getCoordinate(1,c);var h=l.x;c.x-=h;for(var p=0,f=1;f<s-1;f++)u.y=l.y,l.x=c.x,l.y=c.y,a.getCoordinate(f+1,c),c.x-=h,p+=l.x*(u.y-c.y);return p/2}},st.distanceLineLine=function(t,e,n,r){if(t.equals(e))return st.distancePointLine(t,n,r);if(n.equals(r))return st.distancePointLine(r,t,e);var i=!1;if(W.intersects(t,e,n,r)){var o=(e.x-t.x)*(r.y-n.y)-(e.y-t.y)*(r.x-n.x);if(0===o)i=!0;else{var a=(t.y-n.y)*(r.x-n.x)-(t.x-n.x)*(r.y-n.y),s=((t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y))/o,u=a/o;(u<0||u>1||s<0||s>1)&&(i=!0)}}else i=!0;return i?I.min(st.distancePointLine(t,n,r),st.distancePointLine(e,n,r),st.distancePointLine(n,t,e),st.distancePointLine(r,t,e)):0},st.isPointInRing=function(t,e){return st.locatePointInRing(t,e)!==A.EXTERIOR},st.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,r=new E;t.getCoordinate(0,r);for(var i=r.x,o=r.y,a=1;a<e;a++){t.getCoordinate(a,r);var s=r.x,u=r.y,l=s-i,c=u-o;n+=Math.sqrt(l*l+c*c),i=s,o=u}return n},st.isCCW=function(t){var e=t.length-1;if(e<3)throw new v("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,i=1;i<=e;i++){var o=t[i];o.y>n.y&&(n=o,r=i)}var a=r;do{(a-=1)<0&&(a=e)}while(t[a].equals2D(n)&&a!==r);var s=r;do{s=(s+1)%e}while(t[s].equals2D(n)&&s!==r);var u=t[a],l=t[s];if(u.equals2D(n)||l.equals2D(n)||u.equals2D(l))return!1;var c=st.computeOrientation(u,n,l);return 0===c?u.x>l.x:c>0},st.locatePointInRing=function(t,e){return at.locatePointInRing(t,e)},st.distancePointLinePerpendicular=function(t,e,n){var r=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),i=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/r;return Math.abs(i)*Math.sqrt(r)},st.computeOrientation=function(t,e,n){return st.orientationIndex(t,e,n)},st.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new v("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var i=st.distancePointLine(t,e[r],e[r+1]);i<n&&(n=i)}return n}if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2];if(a.x===s.x&&a.y===s.y)return o.distance(a);var u=(s.x-a.x)*(s.x-a.x)+(s.y-a.y)*(s.y-a.y),l=((o.x-a.x)*(s.x-a.x)+(o.y-a.y)*(s.y-a.y))/u;if(l<=0)return o.distance(a);if(l>=1)return o.distance(s);var c=((a.y-o.y)*(s.x-a.x)-(a.x-o.x)*(s.y-a.y))/u;return Math.abs(c)*Math.sqrt(u)}},st.isOnLine=function(t,e){for(var n=new it,r=1;r<e.length;r++){var i=e[r-1],o=e[r];if(n.computeIntersection(t,i,o),n.hasIntersection())return!0}return!1},ut.CLOCKWISE.get=function(){return-1},ut.RIGHT.get=function(){return st.CLOCKWISE},ut.COUNTERCLOCKWISE.get=function(){return 1},ut.LEFT.get=function(){return st.COUNTERCLOCKWISE},ut.COLLINEAR.get=function(){return 0},ut.STRAIGHT.get=function(){return st.COLLINEAR},Object.defineProperties(st,ut);var lt=function(){};lt.prototype.filter=function(t){},lt.prototype.interfaces_=function(){return[]},lt.prototype.getClass=function(){return lt};var ct=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},ht={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ct.prototype.isGeometryCollection=function(){return this.getSortIndex()===ct.SORTINDEX_GEOMETRYCOLLECTION},ct.prototype.getFactory=function(){return this._factory},ct.prototype.getGeometryN=function(t){return this},ct.prototype.getArea=function(){return 0},ct.prototype.isRectangle=function(){return!1},ct.prototype.equals=function(){if(arguments[0]instanceof ct){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof ct))return!1;var n=e;return this.equalsExact(n)}},ct.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},ct.prototype.geometryChanged=function(){this.apply(ct.geometryChangedFilter)},ct.prototype.geometryChangedAction=function(){this._envelope=null},ct.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},ct.prototype.getLength=function(){return 0},ct.prototype.getNumGeometries=function(){return 1},ct.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}},ct.prototype.getUserData=function(){return this._userData},ct.prototype.getSRID=function(){return this._SRID},ct.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},ct.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===ct.SORTINDEX_GEOMETRYCOLLECTION)throw new v("This method does not support GeometryCollection arguments")},ct.prototype.equal=function(t,e,n){return 0===n?t.equals(e):t.distance(e)<=n},ct.prototype.norm=function(){var t=this.copy();return t.normalize(),t},ct.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},ct.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new W(this._envelope)},ct.prototype.setSRID=function(t){this._SRID=t},ct.prototype.setUserData=function(t){this._userData=t},ct.prototype.compare=function(t,e){for(var n=t.iterator(),r=e.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),o=r.next(),a=i.compareTo(o);if(0!==a)return a}return n.hasNext()?1:r.hasNext()?-1:0},ct.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},ct.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ct.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ct.SORTINDEX_MULTIPOINT||this.getSortIndex()===ct.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ct.SORTINDEX_MULTIPOLYGON},ct.prototype.interfaces_=function(){return[w,b,e]},ct.prototype.getClass=function(){return ct},ct.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},ct.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},ht.serialVersionUID.get=function(){return 0x799ea46522854c00},ht.SORTINDEX_POINT.get=function(){return 0},ht.SORTINDEX_MULTIPOINT.get=function(){return 1},ht.SORTINDEX_LINESTRING.get=function(){return 2},ht.SORTINDEX_LINEARRING.get=function(){return 3},ht.SORTINDEX_MULTILINESTRING.get=function(){return 4},ht.SORTINDEX_POLYGON.get=function(){return 5},ht.SORTINDEX_MULTIPOLYGON.get=function(){return 6},ht.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},ht.geometryChangedFilter.get=function(){return pt},Object.defineProperties(ct,ht);var pt=function(){};pt.interfaces_=function(){return[lt]},pt.filter=function(t){t.geometryChangedAction()};var ft=function(){};ft.prototype.filter=function(t){},ft.prototype.interfaces_=function(){return[]},ft.prototype.getClass=function(){return ft};var dt=function(){},mt={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};dt.prototype.isInBoundary=function(t){},dt.prototype.interfaces_=function(){return[]},dt.prototype.getClass=function(){return dt},mt.Mod2BoundaryNodeRule.get=function(){return gt},mt.EndPointBoundaryNodeRule.get=function(){return yt},mt.MultiValentEndPointBoundaryNodeRule.get=function(){return vt},mt.MonoValentEndPointBoundaryNodeRule.get=function(){return _t},mt.MOD2_BOUNDARY_RULE.get=function(){return new gt},mt.ENDPOINT_BOUNDARY_RULE.get=function(){return new yt},mt.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new vt},mt.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new _t},mt.OGC_SFS_BOUNDARY_RULE.get=function(){return dt.MOD2_BOUNDARY_RULE},Object.defineProperties(dt,mt);var gt=function(){};gt.prototype.isInBoundary=function(t){return t%2==1},gt.prototype.interfaces_=function(){return[dt]},gt.prototype.getClass=function(){return gt};var yt=function(){};yt.prototype.isInBoundary=function(t){return t>0},yt.prototype.interfaces_=function(){return[dt]},yt.prototype.getClass=function(){return yt};var vt=function(){};vt.prototype.isInBoundary=function(t){return t>1},vt.prototype.interfaces_=function(){return[dt]},vt.prototype.getClass=function(){return vt};var _t=function(){};_t.prototype.isInBoundary=function(t){return 1===t},_t.prototype.interfaces_=function(){return[dt]},_t.prototype.getClass=function(){return _t};var xt=function(){};xt.prototype.add=function(){},xt.prototype.addAll=function(){},xt.prototype.isEmpty=function(){},xt.prototype.iterator=function(){},xt.prototype.size=function(){},xt.prototype.toArray=function(){},xt.prototype.remove=function(){},(n.prototype=new Error).name="IndexOutOfBoundsException";var bt=function(){};bt.prototype.hasNext=function(){},bt.prototype.next=function(){},bt.prototype.remove=function(){};var wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(xt);(r.prototype=new Error).name="NoSuchElementException";var St=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof xt&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,xt]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var n=this.array_[t];return this.array_[t]=e,n},e.prototype.iterator=function(){return new Et(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new n;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,n=0,r=this.array_.length;n<r;n++)if(this.array_[n]===t){this.array_.splice(n,1),e=!0;break}return e},e}(wt),Et=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new r;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(bt),Ct=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.ensureCapacity(n.length),this.add(n,r)}}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){if(2===arguments.length){for(var e=arguments[1],n=!1,r=arguments[0].iterator();r.hasNext();)this.add(r.next(),e),n=!0;return n}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),n=0;n<this.size();n++)e.add(n,this.get(n).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){if(1===arguments.length){var e=arguments[0];t.prototype.add.call(this,e)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var n=arguments[0],r=arguments[1];return this.add(n,r,!0),!0}if(arguments[0]instanceof E&&"boolean"==typeof arguments[1]){var i=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(i))return null;t.prototype.add.call(this,i)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],a=arguments[1];return this.add(o,a),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var s=arguments[0],u=arguments[1];if(arguments[2])for(var l=0;l<s.length;l++)this.add(s[l],u);else for(var c=s.length-1;c>=0;c--)this.add(s[c],u);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof E){var h=arguments[0],p=arguments[1];if(!arguments[2]){var f=this.size();if(f>0){if(h>0&&this.get(h-1).equals2D(p))return null;if(h<f&&this.get(h).equals2D(p))return null}}t.prototype.add.call(this,h,p)}}else if(4===arguments.length){var d=arguments[0],m=arguments[1],g=arguments[2],y=arguments[3],v=1;g>y&&(v=-1);for(var _=g;_!==y;_+=v)this.add(d[_],m);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new E(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(St),Mt=function(){},Tt={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Tt.ForwardComparator.get=function(){return At},Tt.BidirectionalComparator.get=function(){return Pt},Tt.coordArrayType.get=function(){return new Array(0).fill(null)},Mt.prototype.interfaces_=function(){return[]},Mt.prototype.getClass=function(){return Mt},Mt.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))},Mt.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(Mt.indexOf(r,e)<0)return r}return null},Mt.scroll=function(t,e){var n=Mt.indexOf(e,t);if(n<0)return null;var r=new Array(t.length).fill(null);G.arraycopy(t,n,r,0,t.length-n),G.arraycopy(t,0,r,t.length-n,n),G.arraycopy(r,0,t,0,t.length)},Mt.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];if(r===i)return!0;if(null===r||null===i)return!1;if(r.length!==i.length)return!1;for(var a=0;a<r.length;a++)if(0!==o.compare(r[a],i[a]))return!1;return!0}},Mt.intersection=function(t,e){for(var n=new Ct,r=0;r<t.length;r++)e.intersects(t[r])&&n.add(t[r],!0);return n.toCoordinateArray()},Mt.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},Mt.removeRepeatedPoints=function(t){return Mt.hasRepeatedPoints(t)?new Ct(t,!1).toCoordinateArray():t},Mt.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),r=0;r<=n;r++){var i=t[r];t[r]=t[e-r],t[e-r]=i}},Mt.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)null!==t[n]&&e++;var r=new Array(e).fill(null);if(0===e)return r;for(var i=0,o=0;o<t.length;o++)null!==t[o]&&(r[i++]=t[o]);return r},Mt.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new E(t[n]);return e}if(5===arguments.length)for(var r=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],s=arguments[4],u=0;u<s;u++)o[a+u]=new E(r[i+u])},Mt.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[t.length-n-1];if(0!==r.compareTo(i))return!1}return!0},Mt.envelope=function(t){for(var e=new W,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e},Mt.toCoordinateArray=function(t){return t.toArray(Mt.coordArrayType)},Mt.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},Mt.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1},Mt.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,r=t[e].compareTo(t[n]);if(0!==r)return r}return 1},Mt.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var r=t[n].compareTo(e[n]);if(0!==r)return r;n++}return n<e.length?-1:n<t.length?1:0},Mt.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(null===e||e.compareTo(t[n])>0)&&(e=t[n]);return e},Mt.extract=function(t,e,n){e=I.clamp(e,0,t.length);var r=(n=I.clamp(n,-1,t.length))-e+1;n<0&&(r=0),e>=t.length&&(r=0),n<e&&(r=0);var i=new Array(r).fill(null);if(0===r)return i;for(var o=0,a=e;a<=n;a++)i[o++]=t[a];return i},Object.defineProperties(Mt,Tt);var At=function(){};At.prototype.compare=function(t,e){return Mt.compare(t,e)},At.prototype.interfaces_=function(){return[S]},At.prototype.getClass=function(){return At};var Pt=function(){};Pt.prototype.compare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;var i=Mt.compare(n,r);return Mt.isEqualReversed(n,r)?0:i},Pt.prototype.OLDcompare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;for(var i=Mt.increasingDirection(n),o=Mt.increasingDirection(r),a=i>0?0:n.length-1,s=o>0?0:n.length-1,u=0;u<n.length;u++){var l=n[a].compareTo(r[s]);if(0!==l)return l;a+=i,s+=o}return 0},Pt.prototype.interfaces_=function(){return[S]},Pt.prototype.getClass=function(){return Pt};var Lt=function(){};Lt.prototype.get=function(){},Lt.prototype.put=function(){},Lt.prototype.size=function(){},Lt.prototype.values=function(){},Lt.prototype.entrySet=function(){};var It=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Lt);(i.prototype=new Error).name="OperationNotSupported",(o.prototype=new xt).contains=function(){};var kt=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof xt&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(this.array_[e]===t)return!0;return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new Ot(this)},e}(o),Ot=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new r;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new i},e}(bt),Rt=0;(h.prototype=new It).get=function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(n>0))return e.value;e=e.right}}return null},h.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Rt,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,r,i=this.root_;do{if(n=i,(r=t.compareTo(i.key))<0)i=i.left;else{if(!(r>0)){var o=i.value;return i.value=e,o}i=i.right}}while(null!==i);var a={key:t,left:null,right:null,value:e,parent:n,color:Rt,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?n.left=a:n.right=a,this.fixAfterInsertion(a),this.size_++,null},h.prototype.fixAfterInsertion=function(t){for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(s(t)===l(s(s(t)))){var e=c(s(s(t)));1===a(e)?(u(s(t),Rt),u(e,Rt),u(s(s(t)),1),t=s(s(t))):(t===c(s(t))&&(t=s(t),this.rotateLeft(t)),u(s(t),Rt),u(s(s(t)),1),this.rotateRight(s(s(t))))}else{var n=l(s(s(t)));1===a(n)?(u(s(t),Rt),u(n,Rt),u(s(s(t)),1),t=s(s(t))):(t===l(s(t))&&(t=s(t),this.rotateRight(t)),u(s(t),Rt),u(s(s(t)),1),this.rotateLeft(s(s(t))))}this.root_.color=Rt},h.prototype.values=function(){var t=new St,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=h.successor(e));)t.add(e.value);return t},h.prototype.entrySet=function(){var t=new kt,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=h.successor(e));)t.add(e);return t},h.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},h.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},h.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},h.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var n=t.parent,r=t;null!==n&&r===n.right;)r=n,n=n.parent;return n},h.prototype.size=function(){return this.size_};var Dt=function(){};Dt.prototype.interfaces_=function(){return[]},Dt.prototype.getClass=function(){return Dt},p.prototype=new o,(f.prototype=new p).contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},f.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,n=this.array_.length;e<n;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},f.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},f.prototype.remove=function(t){throw new i},f.prototype.size=function(){return this.array_.length},f.prototype.isEmpty=function(){return 0===this.array_.length},f.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},f.prototype.iterator=function(){return new Nt(this)};var Nt=function(t){this.treeSet_=t,this.position_=0};Nt.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new r;return this.treeSet_.array_[this.position_++]},Nt.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Nt.prototype.remove=function(){throw new i};var Ft=function(){};Ft.sort=function(){var t,e,n,r,i=arguments[0];if(1===arguments.length)r=function(t,e){return t.compareTo(e)},i.sort(r);else if(2===arguments.length)n=arguments[1],r=function(t,e){return n.compare(t,e)},i.sort(r);else if(3===arguments.length){(e=i.slice(arguments[1],arguments[2])).sort();var o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length));for(i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])}else if(4===arguments.length)for(e=i.slice(arguments[1],arguments[2]),n=arguments[3],r=function(t,e){return n.compare(t,e)},e.sort(r),o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length)),i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])},Ft.asList=function(t){for(var e=new St,n=0,r=t.length;n<r;n++)e.add(t[n]);return e};var zt=function(){},Bt={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Bt.P.get=function(){return 0},Bt.L.get=function(){return 1},Bt.A.get=function(){return 2},Bt.FALSE.get=function(){return-1},Bt.TRUE.get=function(){return-2},Bt.DONTCARE.get=function(){return-3},Bt.SYM_FALSE.get=function(){return"F"},Bt.SYM_TRUE.get=function(){return"T"},Bt.SYM_DONTCARE.get=function(){return"*"},Bt.SYM_P.get=function(){return"0"},Bt.SYM_L.get=function(){return"1"},Bt.SYM_A.get=function(){return"2"},zt.prototype.interfaces_=function(){return[]},zt.prototype.getClass=function(){return zt},zt.toDimensionSymbol=function(t){switch(t){case zt.FALSE:return zt.SYM_FALSE;case zt.TRUE:return zt.SYM_TRUE;case zt.DONTCARE:return zt.SYM_DONTCARE;case zt.P:return zt.SYM_P;case zt.L:return zt.SYM_L;case zt.A:return zt.SYM_A}throw new v("Unknown dimension value: "+t)},zt.toDimensionValue=function(t){switch(D.toUpperCase(t)){case zt.SYM_FALSE:return zt.FALSE;case zt.SYM_TRUE:return zt.TRUE;case zt.SYM_DONTCARE:return zt.DONTCARE;case zt.SYM_P:return zt.P;case zt.SYM_L:return zt.L;case zt.SYM_A:return zt.A}throw new v("Unknown dimension symbol: "+t)},Object.defineProperties(zt,Bt);var jt=function(){};jt.prototype.filter=function(t){},jt.prototype.interfaces_=function(){return[]},jt.prototype.getClass=function(){return jt};var Ut=function(){};Ut.prototype.filter=function(t,e){},Ut.prototype.isDone=function(){},Ut.prototype.isGeometryChanged=function(){},Ut.prototype.interfaces_=function(){return[]},Ut.prototype.getClass=function(){return Ut};var Zt=function(t){function e(e,n){if(t.call(this,n),this._geometries=e||[],t.hasNullElements(this._geometries))throw new v("geometries must not contain null elements")}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new W,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=0;n<this._geometries.length;n++)for(var r=this._geometries[n].getCoordinates(),i=0;i<r.length;i++)t[++e]=r[i];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!this.isEquivalentClass(e))return!1;var r=e;if(this._geometries.length!==r._geometries.length)return!1;for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].equalsExact(r._geometries[i],n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();Ft.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=zt.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=zt.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[n]=this._geometries[n].reverse();return this.getFactory().createGeometryCollection(e)},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=new f(Ft.asList(this._geometries)),n=new f(Ft.asList(t._geometries));return this.compare(e,n)}if(2===arguments.length){for(var r=arguments[1],i=arguments[0],o=this.getNumGeometries(),a=i.getNumGeometries(),s=0;s<o&&s<a;){var u=this.getGeometryN(s),l=i.getGeometryN(s),c=u.compareToSameClass(l,r);if(0!==c)return c;s++}return s<o?1:s<a?-1:0}},e.prototype.apply=function(){if(L(arguments[0],ft))for(var t=arguments[0],e=0;e<this._geometries.length;e++)this._geometries[e].apply(t);else if(L(arguments[0],Ut)){var n=arguments[0];if(0===this._geometries.length)return null;for(var r=0;r<this._geometries.length&&(this._geometries[r].apply(n),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else if(L(arguments[0],jt)){var i=arguments[0];i.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(i)}else if(L(arguments[0],lt)){var a=arguments[0];a.filter(this);for(var s=0;s<this._geometries.length;s++)this._geometries[s].apply(a)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),et.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var n=0;n<this._geometries.length;n++)e._geometries[n]=this._geometries[n].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,n),e}(ct),Vt=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ct.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?zt.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[t-1-n]=this._geometries[n].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new Gt(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Dt]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,n),e}(Zt),Gt=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=dt.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};Gt.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},Gt.prototype.getBoundary=function(){return this._geom instanceof Yt?this.boundaryLineString(this._geom):this._geom instanceof Vt?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Gt.prototype.boundaryLineString=function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Gt.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Gt.prototype.computeBoundaryCoordinates=function(t){var e=new St;this._endpointMap=new h;for(var n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);0!==r.getNumPoints()&&(this.addEndpoint(r.getCoordinateN(0)),this.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var i=this._endpointMap.entrySet().iterator();i.hasNext();){var o=i.next(),a=o.getValue().count;this._bnRule.isInBoundary(a)&&e.add(o.getKey())}return Mt.toCoordinateArray(e)},Gt.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new Ht,this._endpointMap.put(t,e)),e.count++},Gt.prototype.interfaces_=function(){return[]},Gt.prototype.getClass=function(){return Gt},Gt.getBoundary=function(){return 1===arguments.length?new Gt(arguments[0]).getBoundary():2===arguments.length?new Gt(arguments[0],arguments[1]).getBoundary():void 0};var Ht=function(){this.count=null};Ht.prototype.interfaces_=function(){return[]},Ht.prototype.getClass=function(){return Ht};var Wt=function(){},qt={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Wt.prototype.interfaces_=function(){return[]},Wt.prototype.getClass=function(){return Wt},Wt.chars=function(t,e){for(var n=new Array(e).fill(null),r=0;r<e;r++)n[r]=t;return String(n)},Wt.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new function(){},n=new function(){}(e);return t.printStackTrace(n),e.toString()}if(2===arguments.length){for(var r=arguments[0],i=arguments[1],o="",a=new function(){}(new function(){}(Wt.getStackTrace(r))),s=0;s<i;s++)try{o+=a.readLine()+Wt.NEWLINE}catch(t){if(!(t instanceof d))throw t;et.shouldNeverReachHere()}return o}},Wt.split=function(t,e){for(var n=e.length,r=new St,i=""+t,o=i.indexOf(e);o>=0;){var a=i.substring(0,o);r.add(a),o=(i=i.substring(o+n)).indexOf(e)}i.length>0&&r.add(i);for(var s=new Array(r.size()).fill(null),u=0;u<s.length;u++)s[u]=r.get(u);return s},Wt.toString=function(){if(1===arguments.length){var t=arguments[0];return Wt.SIMPLE_ORDINATE_FORMAT.format(t)}},Wt.spaces=function(t){return Wt.chars(" ",t)},qt.NEWLINE.get=function(){return G.getProperty("line.separator")},qt.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Wt,qt);var Xt=function(){};Xt.prototype.interfaces_=function(){return[]},Xt.prototype.getClass=function(){return Xt},Xt.copyCoord=function(t,e,n,r){for(var i=Math.min(t.getDimension(),n.getDimension()),o=0;o<i;o++)n.setOrdinate(r,o,t.getOrdinate(e,o))},Xt.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,j.X)===t.getOrdinate(e-1,j.X)&&t.getOrdinate(0,j.Y)===t.getOrdinate(e-1,j.Y)},Xt.isEqual=function(t,e){var n=t.size();if(n!==e.size())return!1;for(var r=Math.min(t.getDimension(),e.getDimension()),i=0;i<n;i++)for(var o=0;o<r;o++){var a=t.getOrdinate(i,o),s=e.getOrdinate(i,o);if(!(t.getOrdinate(i,o)===e.getOrdinate(i,o)||_.isNaN(a)&&_.isNaN(s)))return!1}return!0},Xt.extend=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();if(Xt.copy(e,0,r,0,i),i>0)for(var o=i;o<n;o++)Xt.copy(e,i-1,r,o,1);return r},Xt.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),r=0;r<=n;r++)Xt.swap(t,r,e-r)},Xt.swap=function(t,e,n){if(e===n)return null;for(var r=0;r<t.getDimension();r++){var i=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(n,r)),t.setOrdinate(n,r,i)}},Xt.copy=function(t,e,n,r,i){for(var o=0;o<i;o++)Xt.copyCoord(t,e+o,n,r+o)},Xt.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var n=t.getDimension(),r=new O;r.append("(");for(var i=0;i<e;i++){i>0&&r.append(" ");for(var o=0;o<n;o++)o>0&&r.append(","),r.append(Wt.toString(t.getOrdinate(i,o)))}return r.append(")"),r.toString()}},Xt.ensureValidRing=function(t,e){var n=e.size();return 0===n?e:n<=3?Xt.createClosedRing(t,e,4):e.getOrdinate(0,j.X)===e.getOrdinate(n-1,j.X)&&e.getOrdinate(0,j.Y)===e.getOrdinate(n-1,j.Y)?e:Xt.createClosedRing(t,e,n+1)},Xt.createClosedRing=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();Xt.copy(e,0,r,0,i);for(var o=i;o<n;o++)Xt.copy(e,0,r,o,1);return r};var Yt=function(t){function e(e,n){t.call(this,n),this._points=null,this.init(e)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new W:this._points.expandEnvelope(new W)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!this.isEquivalentClass(e))return!1;var r=e;if(this._points.size()!==r._points.size())return!1;for(var i=0;i<this._points.size();i++)if(!this.equal(this._points.getCoordinate(i),r._points.getCoordinate(i),n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<Math.trunc(this._points.size()/2);t++){var e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e)))return this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))>0&&Xt.reverse(this._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?zt.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return st.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return Xt.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){if(1===arguments.length){for(var t=arguments[0],e=0,n=0;e<this._points.size()&&n<t._points.size();){var r=this._points.getCoordinate(e).compareTo(t._points.getCoordinate(n));if(0!==r)return r;e++,n++}return e<this._points.size()?1:n<t._points.size()?-1:0}if(2===arguments.length){var i=arguments[0];return arguments[1].compare(this._points,i._points)}},e.prototype.apply=function(){if(L(arguments[0],ft))for(var t=arguments[0],e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e));else if(L(arguments[0],Ut)){var n=arguments[0];if(0===this._points.size())return null;for(var r=0;r<this._points.size()&&(n.filter(this._points,r),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else(L(arguments[0],jt)||L(arguments[0],lt))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return new Gt(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new v("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[Dt]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(ct),Kt=function(){};Kt.prototype.interfaces_=function(){return[]},Kt.prototype.getClass=function(){return Kt};var Qt=function(t){function e(e,n){t.call(this,n),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new W;var t=new W;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),n))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return zt.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var e=arguments[0];return arguments[1].compare(this._coordinates,e._coordinates)}},e.prototype.apply=function(){if(L(arguments[0],ft)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(L(arguments[0],Ut)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else(L(arguments[0],jt)||L(arguments[0],lt))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),et.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Kt]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,n),e}(ct),Jt=function(){};Jt.prototype.interfaces_=function(){return[]},Jt.prototype.getClass=function(){return Jt};var $t=function(t){function e(e,n,r){if(t.call(this,r),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===n&&(n=[]),t.hasNullElements(n))throw new v("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(n))throw new v("shell is empty but holes are not");this._shell=e,this._holes=n}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=this._shell.getCoordinates(),r=0;r<n.length;r++)t[++e]=n[r];for(var i=0;i<this._holes.length;i++)for(var o=this._holes[i].getCoordinates(),a=0;a<o.length;a++)t[++e]=o[a];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(st.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(st.signedArea(this._holes[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),n=0;n<5;n++){var r=t.getX(n);if(r!==e.getMinX()&&r!==e.getMaxX())return!1;var i=t.getY(n);if(i!==e.getMinY()&&i!==e.getMaxY())return!1}for(var o=t.getX(0),a=t.getY(0),s=1;s<=4;s++){var u=t.getX(s),l=t.getY(s);if(u!==o==(l!==a))return!1;o=u,a=l}return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!this.isEquivalentClass(e))return!1;var r=e,i=this._shell,o=r._shell;if(!i.equalsExact(o,n))return!1;if(this._holes.length!==r._holes.length)return!1;for(var a=0;a<this._holes.length;a++)if(!this._holes[a].equalsExact(r._holes[a],n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var t=0;t<this._holes.length;t++)this.normalize(this._holes[t],!1);Ft.sort(this._holes)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(e.isEmpty())return null;var r=new Array(e.getCoordinates().length-1).fill(null);G.arraycopy(e.getCoordinates(),0,r,0,r.length);var i=Mt.minCoordinate(e.getCoordinates());Mt.scroll(r,i),G.arraycopy(r,0,e.getCoordinates(),0,r.length),e.getCoordinates()[r.length]=r[0],st.isCCW(e.getCoordinates())===n&&Mt.reverse(e.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=this._shell,n=t._shell;return e.compareToSameClass(n)}if(2===arguments.length){var r=arguments[1],i=arguments[0],o=this._shell,a=i._shell,s=o.compareToSameClass(a,r);if(0!==s)return s;for(var u=this.getNumInteriorRing(),l=i.getNumInteriorRing(),c=0;c<u&&c<l;){var h=this.getInteriorRingN(c),p=i.getInteriorRingN(c),f=h.compareToSameClass(p,r);if(0!==f)return f;c++}return c<u?1:c<l?-1:0}},e.prototype.apply=function(t){if(L(t,ft)){this._shell.apply(t);for(var e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(L(t,Ut)){if(this._shell.apply(t),!t.isDone())for(var n=0;n<this._holes.length&&(this._holes[n].apply(t),!t.isDone());n++);t.isGeometryChanged()&&this.geometryChanged()}else if(L(t,jt))t.filter(this);else if(L(t,lt)){t.filter(this),this._shell.apply(t);for(var r=0;r<this._holes.length;r++)this._holes[r].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var n=0;n<this._holes.length;n++)e._holes[n]=this._holes[n].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this._shell.copy(),n=new Array(this._holes.length).fill(null),r=0;r<n.length;r++)n[r]=this._holes[r].copy();return new e(t,n,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[Jt]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(ct),te=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ct.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return zt.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Kt]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,n),e}(Zt),ee=function(t){function e(e,n){e instanceof E&&n instanceof ye&&(e=n.getCoordinateSequenceFactory().create(e)),t.call(this,e,n),this.validateConstruction()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ct.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return zt.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();return Xt.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new v("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new v("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(Yt),ne=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ct.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[n]=this._geometries[n].reverse();return this.getFactory().createMultiPolygon(e)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new St,e=0;e<this._geometries.length;e++)for(var n=this._geometries[e].getBoundary(),r=0;r<n.getNumGeometries();r++)t.add(n.getGeometryN(r));var i=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(i))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Jt]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(Zt),re=function(t){this._factory=t||null,this._isUserDataCopied=!1},ie={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};re.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},re.prototype.edit=function(t,e){if(null===t)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n},re.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof Zt?this.editGeometryCollection(t,e):t instanceof $t?this.editPolygon(t,e):t instanceof Qt||t instanceof Yt?e.edit(t,this._factory):(et.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},re.prototype.editGeometryCollection=function(t,e){for(var n=e.edit(t,this._factory),r=new St,i=0;i<n.getNumGeometries();i++){var o=this.edit(n.getGeometryN(i),e);null===o||o.isEmpty()||r.add(o)}return n.getClass()===te?this._factory.createMultiPoint(r.toArray([])):n.getClass()===Vt?this._factory.createMultiLineString(r.toArray([])):n.getClass()===ne?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))},re.prototype.editPolygon=function(t,e){var n=e.edit(t,this._factory);if(null===n&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var r=this.edit(n.getExteriorRing(),e);if(null===r||r.isEmpty())return this._factory.createPolygon();for(var i=new St,o=0;o<n.getNumInteriorRing();o++){var a=this.edit(n.getInteriorRingN(o),e);null===a||a.isEmpty()||i.add(a)}return this._factory.createPolygon(r,i.toArray([]))},re.prototype.interfaces_=function(){return[]},re.prototype.getClass=function(){return re},re.GeometryEditorOperation=function(){},ie.NoOpGeometryOperation.get=function(){return oe},ie.CoordinateOperation.get=function(){return ae},ie.CoordinateSequenceOperation.get=function(){return se},Object.defineProperties(re,ie);var oe=function(){};oe.prototype.edit=function(t,e){return t},oe.prototype.interfaces_=function(){return[re.GeometryEditorOperation]},oe.prototype.getClass=function(){return oe};var ae=function(){};ae.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return null===n?t:t instanceof ee?e.createLinearRing(n):t instanceof Yt?e.createLineString(n):t instanceof Qt?n.length>0?e.createPoint(n[0]):e.createPoint():t},ae.prototype.interfaces_=function(){return[re.GeometryEditorOperation]},ae.prototype.getClass=function(){return ae};var se=function(){};se.prototype.edit=function(t,e){return t instanceof ee?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Yt?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Qt?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},se.prototype.interfaces_=function(){return[re.GeometryEditorOperation]},se.prototype.getClass=function(){return se};var ue=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var e=0;e<t;e++)this._coordinates[e]=new E}else if(L(arguments[0],j)){var n=arguments[0];if(null===n)return this._coordinates=new Array(0).fill(null),null;this._dimension=n.getDimension(),this._coordinates=new Array(n.size()).fill(null);for(var r=0;r<this._coordinates.length;r++)this._coordinates[r]=n.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var i=arguments[0],o=arguments[1];this._coordinates=i,this._dimension=o,null===i&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],s=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=s;for(var u=0;u<a;u++)this._coordinates[u]=new E}},le={serialVersionUID:{configurable:!0}};ue.prototype.setOrdinate=function(t,e,n){switch(e){case j.X:this._coordinates[t].x=n;break;case j.Y:this._coordinates[t].y=n;break;case j.Z:this._coordinates[t].z=n;break;default:throw new v("invalid ordinateIndex")}},ue.prototype.size=function(){return this._coordinates.length},ue.prototype.getOrdinate=function(t,e){switch(e){case j.X:return this._coordinates[t].x;case j.Y:return this._coordinates[t].y;case j.Z:return this._coordinates[t].z}return _.NaN},ue.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}},ue.prototype.getCoordinateCopy=function(t){return new E(this._coordinates[t])},ue.prototype.getDimension=function(){return this._dimension},ue.prototype.getX=function(t){return this._coordinates[t].x},ue.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new ue(t,this._dimension)},ue.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},ue.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new ue(t,this._dimension)},ue.prototype.toString=function(){if(this._coordinates.length>0){var t=new O(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},ue.prototype.getY=function(t){return this._coordinates[t].y},ue.prototype.toCoordinateArray=function(){return this._coordinates},ue.prototype.interfaces_=function(){return[j,e]},ue.prototype.getClass=function(){return ue},le.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(ue,le);var ce=function(){},he={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ce.prototype.readResolve=function(){return ce.instance()},ce.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new ue(arguments[0]);if(L(arguments[0],j))return new ue(arguments[0])}else if(2===arguments.length){var t=arguments[0],e=arguments[1];return e>3&&(e=3),e<2?new ue(t):new ue(t,e)}},ce.prototype.interfaces_=function(){return[T,e]},ce.prototype.getClass=function(){return ce},ce.instance=function(){return ce.instanceObject},he.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},he.instanceObject.get=function(){return new ce},Object.defineProperties(ce,he);var pe=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new St,e=this.map_.values(),n=e.next();!n.done;)t.add(n.value),n=e.next();return t},e.prototype.entrySet=function(){var t=new kt;return this.map_.entries().forEach((function(e){return t.add(e)})),t},e.prototype.size=function(){return this.map_.size()},e}(Lt),fe=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof me){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}},de={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};fe.prototype.equals=function(t){if(!(t instanceof fe))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},fe.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return new R(n).compareTo(new R(r))},fe.prototype.getScale=function(){return this._scale},fe.prototype.isFloating=function(){return this._modelType===fe.FLOATING||this._modelType===fe.FLOATING_SINGLE},fe.prototype.getType=function(){return this._modelType},fe.prototype.toString=function(){var t="UNKNOWN";return this._modelType===fe.FLOATING?t="Floating":this._modelType===fe.FLOATING_SINGLE?t="Floating-Single":this._modelType===fe.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},fe.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];return _.isNaN(t)||this._modelType===fe.FLOATING_SINGLE?t:this._modelType===fe.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof E){var e=arguments[0];if(this._modelType===fe.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},fe.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===fe.FLOATING?t=16:this._modelType===fe.FLOATING_SINGLE?t=6:this._modelType===fe.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},fe.prototype.setScale=function(t){this._scale=Math.abs(t)},fe.prototype.interfaces_=function(){return[e,b]},fe.prototype.getClass=function(){return fe},fe.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},de.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},de.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(fe,de);var me=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},ge={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};me.prototype.readResolve=function(){return me.nameToTypeMap.get(this._name)},me.prototype.toString=function(){return this._name},me.prototype.interfaces_=function(){return[e]},me.prototype.getClass=function(){return me},ge.serialVersionUID.get=function(){return-552860263173159e4},ge.nameToTypeMap.get=function(){return new pe},Object.defineProperties(me,ge),fe.Type=me,fe.FIXED=new me("FIXED"),fe.FLOATING=new me("FLOATING"),fe.FLOATING_SINGLE=new me("FLOATING SINGLE");var ye=function t(){this._precisionModel=new fe,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?L(arguments[0],T)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof fe&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},ve={serialVersionUID:{configurable:!0}};ye.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new E(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new E(t.getMinX(),t.getMinY()),new E(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new E(t.getMinX(),t.getMinY()),new E(t.getMinX(),t.getMaxY()),new E(t.getMaxX(),t.getMaxY()),new E(t.getMaxX(),t.getMinY()),new E(t.getMinX(),t.getMinY())]),null)},ye.prototype.createLineString=function(t){return t?t instanceof Array?new Yt(this.getCoordinateSequenceFactory().create(t),this):L(t,j)?new Yt(t,this):void 0:new Yt(this.getCoordinateSequenceFactory().create([]),this)},ye.prototype.createMultiLineString=function(){return 0===arguments.length?new Vt(null,this):1===arguments.length?new Vt(arguments[0],this):void 0},ye.prototype.buildGeometry=function(t){for(var e=null,n=!1,r=!1,i=t.iterator();i.hasNext();){var o=i.next(),a=o.getClass();null===e&&(e=a),a!==e&&(n=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(null===e)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(ye.toGeometryArray(t));var s=t.iterator().next();if(t.size()>1){if(s instanceof $t)return this.createMultiPolygon(ye.toPolygonArray(t));if(s instanceof Yt)return this.createMultiLineString(ye.toLineStringArray(t));if(s instanceof Qt)return this.createMultiPoint(ye.toPointArray(t));et.shouldNeverReachHere("Unhandled class: "+s.getClass().getName())}return s},ye.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},ye.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof E){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(L(arguments[0],j))return new Qt(arguments[0],this)}},ye.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},ye.prototype.createPolygon=function(){if(0===arguments.length)return new $t(null,null,this);if(1===arguments.length){if(L(arguments[0],j)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof ee){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length)return new $t(arguments[0],arguments[1],this)},ye.prototype.getSRID=function(){return this._SRID},ye.prototype.createGeometryCollection=function(){return 0===arguments.length?new Zt(null,this):1===arguments.length?new Zt(arguments[0],this):void 0},ye.prototype.createGeometry=function(t){return new re(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},ye.prototype.getPrecisionModel=function(){return this._precisionModel},ye.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(L(arguments[0],j))return new ee(arguments[0],this)}},ye.prototype.createMultiPolygon=function(){return 0===arguments.length?new ne(null,this):1===arguments.length?new ne(arguments[0],this):void 0},ye.prototype.createMultiPoint=function(){if(0===arguments.length)return new te(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new te(arguments[0],this);if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(L(arguments[0],j)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var n=new Array(e.size()).fill(null),r=0;r<e.size();r++){var i=this.getCoordinateSequenceFactory().create(1,e.getDimension());Xt.copy(e,r,i,0,1),n[r]=this.createPoint(i)}return this.createMultiPoint(n)}}},ye.prototype.interfaces_=function(){return[e]},ye.prototype.getClass=function(){return ye},ye.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.getDefaultCoordinateSequenceFactory=function(){return ce.instance()},ye.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},ve.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(ye,ve);var _e=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],xe=function(t){this.geometryFactory=t||new ye};xe.prototype.read=function(t){var e,n=(e="string"==typeof t?JSON.parse(t):t).type;if(!be[n])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==_e.indexOf(n)?be[n].apply(this,[e.coordinates]):"GeometryCollection"===n?be[n].apply(this,[e.geometries]):be[n].apply(this,[e])},xe.prototype.write=function(t){var e=t.getGeometryType();if(!we[e])throw new Error("Geometry is not supported");return we[e].apply(this,[t])};var be={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var r=t.geometry.type;if(!be[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=be.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var n=0;n<t.features.length;++n)e.features.push(this.read(t.features[n]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(new E(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new E(t[0],t[1]),new E(t[2],t[1]),new E(t[2],t[3]),new E(t[0],t[3]),new E(t[0],t[1])])},Point:function(t){var e=new E(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],n=0;n<t.length;++n)e.push(be.Point.apply(this,[t[n]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=be.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],n=0;n<t.length;++n)e.push(be.LineString.apply(this,[t[n]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=be.coordinates.apply(this,[t[0]]),n=this.geometryFactory.createLinearRing(e),r=[],i=1;i<t.length;++i){var o=t[i],a=be.coordinates.apply(this,[o]),s=this.geometryFactory.createLinearRing(a);r.push(s)}return this.geometryFactory.createPolygon(n,r)},MultiPolygon:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(be.Polygon.apply(this,[r]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(this.read(r))}return this.geometryFactory.createGeometryCollection(e)}},we={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:we.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=we.Point.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],n=t.getCoordinates(),r=0;r<n.length;++r){var i=n[r];e.push(we.coordinate.apply(this,[i]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=we.LineString.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],n=we.LineString.apply(this,[t._shell]);e.push(n.coordinates);for(var r=0;r<t._holes.length;++r){var i=t._holes[r],o=we.LineString.apply(this,[i]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=we.Polygon.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=r.getGeometryType();e.push(we[i].apply(this,[r]))}return{type:"GeometryCollection",geometries:e}}},Se=function(t){this.geometryFactory=t||new ye,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new xe(this.geometryFactory)};Se.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===fe.FIXED&&this.reducePrecision(e),e},Se.prototype.reducePrecision=function(t){var e,n;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,n=t.points.length;e<n;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,n=t.geometries.length;e<n;e++)this.reducePrecision(t.geometries[e])};var Ee=function(){this.parser=new xe(this.geometryFactory)};Ee.prototype.write=function(t){return this.parser.write(t)};var Ce=function(){},Me={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Ce.prototype.interfaces_=function(){return[]},Ce.prototype.getClass=function(){return Ce},Ce.opposite=function(t){return t===Ce.LEFT?Ce.RIGHT:t===Ce.RIGHT?Ce.LEFT:t},Me.ON.get=function(){return 0},Me.LEFT.get=function(){return 1},Me.RIGHT.get=function(){return 2},Object.defineProperties(Ce,Me),(m.prototype=new Error).name="EmptyStackException",(g.prototype=new wt).add=function(t){return this.array_.push(t),!0},g.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},g.prototype.push=function(t){return this.array_.push(t),t},g.prototype.pop=function(t){if(0===this.array_.length)throw new m;return this.array_.pop()},g.prototype.peek=function(){if(0===this.array_.length)throw new m;return this.array_[this.array_.length-1]},g.prototype.empty=function(){return 0===this.array_.length},g.prototype.isEmpty=function(){return this.empty()},g.prototype.search=function(t){return this.array_.indexOf(t)},g.prototype.size=function(){return this.array_.length},g.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t};var Te=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Te.prototype.getCoordinate=function(){return this._minCoord},Te.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n},Te.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();et.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],r=st.computeOrientation(this._minCoord,n,e),i=!1;(e.y<this._minCoord.y&&n.y<this._minCoord.y&&r===st.COUNTERCLOCKWISE||e.y>this._minCoord.y&&n.y>this._minCoord.y&&r===st.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)},Te.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge().getCoordinates();if(e<0||e+1>=n.length)return-1;if(n[e].y===n[e+1].y)return-1;var r=Ce.LEFT;return n[e].y<n[e+1].y&&(r=Ce.RIGHT),r},Te.prototype.getEdge=function(){return this._orientedDe},Te.prototype.checkForRightmostCoordinate=function(t){for(var e=t.getEdge().getCoordinates(),n=0;n<e.length-1;n++)(null===this._minCoord||e[n].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=n,this._minCoord=e[n])},Te.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Te.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.isForward()&&this.checkForRightmostCoordinate(n)}et.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ce.LEFT&&(this._orientedDe=this._minDe.getSym())},Te.prototype.interfaces_=function(){return[]},Te.prototype.getClass=function(){return Te};var Ae=function(t){function e(n,r){t.call(this,e.msgWithCoord(n,r)),this.pt=r?new E(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}($),Pe=function(){this.array_=[]};Pe.prototype.addLast=function(t){this.array_.push(t)},Pe.prototype.removeFirst=function(){return this.array_.shift()},Pe.prototype.isEmpty=function(){return 0===this.array_.length};var Le=function(){this._finder=null,this._dirEdgeList=new St,this._nodes=new St,this._rightMostCoord=null,this._env=null,this._finder=new Te};Le.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},Le.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Le.prototype.computeNodeDepth=function(t){for(var e=null,n=t.getEdges().iterator();n.hasNext();){var r=n.next();if(r.isVisited()||r.getSym().isVisited()){e=r;break}}if(null===e)throw new Ae("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var i=t.getEdges().iterator();i.hasNext();){var o=i.next();o.setVisited(!0),this.copySymDepths(o)}},Le.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(Ce.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},Le.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Le.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Ce.RIGHT)>=1&&e.getDepth(Ce.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},Le.prototype.computeDepths=function(t){var e=new kt,n=new Pe,r=t.getNode();for(n.addLast(r),e.add(r),t.setVisited(!0);!n.isEmpty();){var i=n.removeFirst();e.add(i),this.computeNodeDepth(i);for(var o=i.getEdges().iterator();o.hasNext();){var a=o.next().getSym();if(!a.isVisited()){var s=a.getNode();e.contains(s)||(n.addLast(s),e.add(s))}}}},Le.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},Le.prototype.getEnvelope=function(){if(null===this._env){for(var t=new W,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next().getEdge().getCoordinates(),r=0;r<n.length-1;r++)t.expandToInclude(n[r]);this._env=t}return this._env},Le.prototype.addReachable=function(t){var e=new g;for(e.add(t);!e.empty();){var n=e.pop();this.add(n,e)}},Le.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(Ce.LEFT,t.getDepth(Ce.RIGHT)),e.setDepth(Ce.RIGHT,t.getDepth(Ce.LEFT))},Le.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var n=t.getEdges().iterator();n.hasNext();){var r=n.next();this._dirEdgeList.add(r);var i=r.getSym().getNode();i.isVisited()||e.push(i)}},Le.prototype.getNodes=function(){return this._nodes},Le.prototype.getDirectedEdges=function(){return this._dirEdgeList},Le.prototype.interfaces_=function(){return[b]},Le.prototype.getClass=function(){return Le};var Ie=function t(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[Ce.ON]=n}else if(arguments[0]instanceof t){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var i=0;i<this.location.length;i++)this.location[i]=r.location[i]}}else if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2];this.init(3),this.location[Ce.ON]=o,this.location[Ce.LEFT]=a,this.location[Ce.RIGHT]=s}};Ie.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},Ie.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==A.NONE)return!1;return!0},Ie.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===A.NONE&&(this.location[e]=t)},Ie.prototype.isLine=function(){return 1===this.location.length},Ie.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Ce.ON]=this.location[Ce.ON],e[Ce.LEFT]=A.NONE,e[Ce.RIGHT]=A.NONE,this.location=e}for(var n=0;n<this.location.length;n++)this.location[n]===A.NONE&&n<t.location.length&&(this.location[n]=t.location[n])},Ie.prototype.getLocations=function(){return this.location},Ie.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[Ce.LEFT];this.location[Ce.LEFT]=this.location[Ce.RIGHT],this.location[Ce.RIGHT]=t},Ie.prototype.toString=function(){var t=new O;return this.location.length>1&&t.append(A.toLocationSymbol(this.location[Ce.LEFT])),t.append(A.toLocationSymbol(this.location[Ce.ON])),this.location.length>1&&t.append(A.toLocationSymbol(this.location[Ce.RIGHT])),t.toString()},Ie.prototype.setLocations=function(t,e,n){this.location[Ce.ON]=t,this.location[Ce.LEFT]=e,this.location[Ce.RIGHT]=n},Ie.prototype.get=function(t){return t<this.location.length?this.location[t]:A.NONE},Ie.prototype.isArea=function(){return this.location.length>1},Ie.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===A.NONE)return!0;return!1},Ie.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Ce.ON,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.location[e]=n}},Ie.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(A.NONE)},Ie.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},Ie.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},Ie.prototype.interfaces_=function(){return[]},Ie.prototype.getClass=function(){return Ie};var ke=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Ie(e),this.elt[1]=new Ie(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new Ie(n.elt[0]),this.elt[1]=new Ie(n.elt[1])}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.elt[0]=new Ie(A.NONE),this.elt[1]=new Ie(A.NONE),this.elt[r].setLocation(i)}else if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2];this.elt[0]=new Ie(o,a,s),this.elt[1]=new Ie(o,a,s)}else if(4===arguments.length){var u=arguments[0],l=arguments[1],c=arguments[2],h=arguments[3];this.elt[0]=new Ie(A.NONE,A.NONE,A.NONE),this.elt[1]=new Ie(A.NONE,A.NONE,A.NONE),this.elt[u].setLocations(l,c,h)}};ke.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},ke.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},ke.prototype.isNull=function(t){return this.elt[t].isNull()},ke.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}},ke.prototype.isLine=function(t){return this.elt[t].isLine()},ke.prototype.merge=function(t){for(var e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new Ie(t.elt[e]):this.elt[e].merge(t.elt[e])},ke.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},ke.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Ce.ON)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}},ke.prototype.toString=function(){var t=new O;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},ke.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},ke.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},ke.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Ce.ON,e)}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}},ke.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},ke.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},ke.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Ie(this.elt[t].location[0]))},ke.prototype.interfaces_=function(){return[]},ke.prototype.getClass=function(){return ke},ke.toLineLabel=function(t){for(var e=new ke(A.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var Oe=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new St,this._pts=new St,this._label=new ke(A.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new St,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Oe.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=st.isCCW(this._ring.getCoordinates())},Oe.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Oe.prototype.computePoints=function(t){this._startDe=t;var e=t,n=!0;do{if(null===e)throw new Ae("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new Ae("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);var r=e.getLabel();et.isTrue(r.isArea()),this.mergeLabel(r),this.addPoints(e.getEdge(),e.isForward(),n),n=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)},Oe.prototype.getLinearRing=function(){return this._ring},Oe.prototype.getCoordinate=function(t){return this._pts.get(t)},Oe.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var t=this._startDe;do{var e=t.getNode().getEdges().getOutgoingDegree(this);e>this._maxNodeDegree&&(this._maxNodeDegree=e),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2},Oe.prototype.addPoints=function(t,e,n){var r=t.getCoordinates();if(e){var i=1;n&&(i=0);for(var o=i;o<r.length;o++)this._pts.add(r[o])}else{var a=r.length-2;n&&(a=r.length-1);for(var s=a;s>=0;s--)this._pts.add(r[s])}},Oe.prototype.isHole=function(){return this._isHole},Oe.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},Oe.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!st.isPointInRing(t,e.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();)if(n.next().containsPoint(t))return!1;return!0},Oe.prototype.addHole=function(t){this._holes.add(t)},Oe.prototype.isShell=function(){return null===this._shell},Oe.prototype.getLabel=function(){return this._label},Oe.prototype.getEdges=function(){return this._edges},Oe.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Oe.prototype.getShell=function(){return this._shell},Oe.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[1],n=arguments[0].getLocation(e,Ce.RIGHT);if(n===A.NONE)return null;if(this._label.getLocation(e)===A.NONE)return this._label.setLocation(e,n),null}},Oe.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},Oe.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)e[n]=this._holes.get(n).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},Oe.prototype.interfaces_=function(){return[]},Oe.prototype.getClass=function(){return Oe};var Re=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Oe),De=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=new St,e=this._startDe;do{if(null===e.getMinEdgeRing()){var n=new Re(e,this._geometryFactory);t.add(n)}e=e.getNext()}while(e!==this._startDe);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Oe),Ne=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};Ne.prototype.setVisited=function(t){this._isVisited=t},Ne.prototype.setInResult=function(t){this._isInResult=t},Ne.prototype.isCovered=function(){return this._isCovered},Ne.prototype.isCoveredSet=function(){return this._isCoveredSet},Ne.prototype.setLabel=function(t){this._label=t},Ne.prototype.getLabel=function(){return this._label},Ne.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},Ne.prototype.updateIM=function(t){et.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},Ne.prototype.isInResult=function(){return this._isInResult},Ne.prototype.isVisited=function(){return this._isVisited},Ne.prototype.interfaces_=function(){return[]},Ne.prototype.getClass=function(){return Ne};var Fe=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],n=arguments[1];this._coord=e,this._edges=n,this._label=new ke(0,A.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var n=A.NONE;if(n=this._label.getLocation(e),!t.isNull(e)){var r=t.getLocation(e);n!==A.BOUNDARY&&(n=r)}return n},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],n=arguments[1];null===this._label?this._label=new ke(e,n):this._label.setLocation(e,n)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){if(arguments[0]instanceof e){var t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof ke)for(var n=arguments[0],r=0;r<2;r++){var i=this.computeMergedLocation(n,r);this._label.getLocation(r)===A.NONE&&this._label.setLocation(r,i)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=A.NONE;null!==this._label&&(e=this._label.getLocation(t));var n=null;if(e===A.BOUNDARY)n=A.INTERIOR;else n=A.BOUNDARY;this._label.setLocation(t,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ne),ze=function(){this.nodeMap=new h,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};ze.prototype.find=function(t){return this.nodeMap.get(t)},ze.prototype.addNode=function(){if(arguments[0]instanceof E){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Fe){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return null===r?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}},ze.prototype.print=function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},ze.prototype.iterator=function(){return this.nodeMap.values().iterator()},ze.prototype.values=function(){return this.nodeMap.values()},ze.prototype.getBoundaryNodes=function(t){for(var e=new St,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(t)===A.BOUNDARY&&e.add(r)}return e},ze.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},ze.prototype.interfaces_=function(){return[]},ze.prototype.getClass=function(){return ze};var Be=function(){},je={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Be.prototype.interfaces_=function(){return[]},Be.prototype.getClass=function(){return Be},Be.isNorthern=function(t){return t===Be.NE||t===Be.NW},Be.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},Be.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var n=t<e?t:e;return 0===n&&3===(t>e?t:e)?3:n},Be.isInHalfPlane=function(t,e){return e===Be.SE?t===Be.SE||t===Be.SW:t===e||t===e+1},Be.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new v("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Be.NE:Be.SE:e>=0?Be.NW:Be.SW}if(arguments[0]instanceof E&&arguments[1]instanceof E){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new v("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?Be.NE:Be.SE:r.y>=n.y?Be.NW:Be.SW}},je.NE.get=function(){return 0},je.NW.get=function(){return 1},je.SW.get=function(){return 2},je.SE.get=function(){return 3},Object.defineProperties(Be,je);var Ue=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2];this._edge=e,this.init(n,r),this._label=null}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];this._edge=i,this.init(o,a),this._label=s}};Ue.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:st.computeOrientation(t._p0,t._p1,this._p1)},Ue.prototype.getDy=function(){return this._dy},Ue.prototype.getCoordinate=function(){return this._p0},Ue.prototype.setNode=function(t){this._node=t},Ue.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},Ue.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},Ue.prototype.getDirectedCoordinate=function(){return this._p1},Ue.prototype.getDx=function(){return this._dx},Ue.prototype.getLabel=function(){return this._label},Ue.prototype.getEdge=function(){return this._edge},Ue.prototype.getQuadrant=function(){return this._quadrant},Ue.prototype.getNode=function(){return this._node},Ue.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},Ue.prototype.computeLabel=function(t){},Ue.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Be.quadrant(this._dx,this._dy),et.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Ue.prototype.interfaces_=function(){return[b]},Ue.prototype.getClass=function(){return Ue};var Ze=function(t){function e(){var e=arguments[0],n=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var r=e.getNumPoints()-1;this.init(e.getCoordinate(r),e.getCoordinate(r-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new ke(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new Ae("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=!0,e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,Ce.LEFT)===A.INTERIOR&&this._label.getLocation(e,Ce.RIGHT)===A.INTERIOR||(t=!1);return t},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[Ce.LEFT]+"/"+this._depth[Ce.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,A.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,A.EXTERIOR);return t&&e&&n},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var r=1;t===Ce.LEFT&&(r=-1);var i=Ce.opposite(t),o=e+n*r;this.setDepth(t,e),this.setDepth(i,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===A.EXTERIOR&&e===A.INTERIOR?1:t===A.INTERIOR&&e===A.EXTERIOR?-1:0},e}(Ue),Ve=function(){};Ve.prototype.createNode=function(t){return new Fe(t,null)},Ve.prototype.interfaces_=function(){return[]},Ve.prototype.getClass=function(){return Ve};var Ge=function(){if(this._edges=new St,this._nodes=null,this._edgeEndList=new St,0===arguments.length)this._nodes=new ze(new Ve);else if(1===arguments.length){var t=arguments[0];this._nodes=new ze(t)}};Ge.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var n=this._edges.get(e);n.print(t),n.eiList.print(t)}},Ge.prototype.find=function(t){return this._nodes.find(t)},Ge.prototype.addNode=function(){if(arguments[0]instanceof Fe){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof E){var e=arguments[0];return this._nodes.addNode(e)}},Ge.prototype.getNodeIterator=function(){return this._nodes.iterator()},Ge.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},Ge.prototype.debugPrintln=function(t){G.out.println(t)},Ge.prototype.isBoundaryNode=function(t,e){var n=this._nodes.find(e);if(null===n)return!1;var r=n.getLabel();return null!==r&&r.getLocation(t)===A.BOUNDARY},Ge.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},Ge.prototype.matchInSameDirection=function(t,e,n,r){return!!t.equals(n)&&st.computeOrientation(t,e,r)===st.COLLINEAR&&Be.quadrant(t,e)===Be.quadrant(n,r)},Ge.prototype.getEdgeEnds=function(){return this._edgeEndList},Ge.prototype.debugPrint=function(t){G.out.print(t)},Ge.prototype.getEdgeIterator=function(){return this._edges.iterator()},Ge.prototype.findEdgeInSameDirection=function(t,e){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(this.matchInSameDirection(t,e,i[0],i[1]))return r;if(this.matchInSameDirection(t,e,i[i.length-1],i[i.length-2]))return r}return null},Ge.prototype.insertEdge=function(t){this._edges.add(t)},Ge.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null},Ge.prototype.addEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this._edges.add(n);var r=new Ze(n,!0),i=new Ze(n,!1);r.setSym(i),i.setSym(r),this.add(r),this.add(i)}},Ge.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},Ge.prototype.getNodes=function(){return this._nodes.values()},Ge.prototype.findEdge=function(t,e){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(t.equals(i[0])&&e.equals(i[1]))return r}return null},Ge.prototype.interfaces_=function(){return[]},Ge.prototype.getClass=function(){return Ge},Ge.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()};var He=function(){this._geometryFactory=null,this._shellList=new St;var t=arguments[0];this._geometryFactory=t};He.prototype.sortShellsAndHoles=function(t,e,n){for(var r=t.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):e.add(i)}},He.prototype.computePolygons=function(t){for(var e=new St,n=t.iterator();n.hasNext();){var r=n.next().toPolygon(this._geometryFactory);e.add(r)}return e},He.prototype.placeFreeHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();if(null===r.getShell()){var i=this.findEdgeRingContaining(r,t);if(null===i)throw new Ae("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(i)}}},He.prototype.buildMinimalEdgeRings=function(t,e,n){for(var r=new St,i=t.iterator();i.hasNext();){var o=i.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var a=o.buildMinimalRings(),s=this.findShell(a);null!==s?(this.placePolygonHoles(s,a),e.add(s)):n.addAll(a)}else r.add(o)}return r},He.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},He.prototype.buildMaximalEdgeRings=function(t){for(var e=new St,n=t.iterator();n.hasNext();){var r=n.next();if(r.isInResult()&&r.getLabel().isArea()&&null===r.getEdgeRing()){var i=new De(r,this._geometryFactory);e.add(i),i.setInResult()}}return e},He.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(t)}},He.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},He.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),o=null,a=null,s=e.iterator();s.hasNext();){var u=s.next(),l=u.getLinearRing(),c=l.getEnvelopeInternal();null!==o&&(a=o.getLinearRing().getEnvelopeInternal());var h=!1;c.contains(r)&&st.isPointInRing(i,l.getCoordinates())&&(h=!0),h&&(null===o||a.contains(c))&&(o=u)}return o},He.prototype.findShell=function(t){for(var e=0,n=null,r=t.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,e++)}return et.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n},He.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Ge.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(e),i=new St,o=this.buildMinimalEdgeRings(r,this._shellList,i);this.sortShellsAndHoles(o,this._shellList,i),this.placeFreeHoles(this._shellList,i)}},He.prototype.interfaces_=function(){return[]},He.prototype.getClass=function(){return He};var We=function(){};We.prototype.getBounds=function(){},We.prototype.interfaces_=function(){return[]},We.prototype.getClass=function(){return We};var qe=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};qe.prototype.getItem=function(){return this._item},qe.prototype.getBounds=function(){return this._bounds},qe.prototype.interfaces_=function(){return[We,e]},qe.prototype.getClass=function(){return qe};var Xe=function(){this._size=null,this._items=null,this._size=0,this._items=new St,this._items.add(null)};Xe.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},Xe.prototype.size=function(){return this._size},Xe.prototype.reorder=function(t){for(var e=null,n=this._items.get(t);2*t<=this._size&&((e=2*t)!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(n)<0);t=e)this._items.set(t,this._items.get(e));this._items.set(t,n)},Xe.prototype.clear=function(){this._size=0,this._items.clear()},Xe.prototype.isEmpty=function(){return 0===this._size},Xe.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},Xe.prototype.interfaces_=function(){return[]},Xe.prototype.getClass=function(){return Xe};var Ye=function(){};Ye.prototype.visitItem=function(t){},Ye.prototype.interfaces_=function(){return[]},Ye.prototype.getClass=function(){return Ye};var Ke=function(){};Ke.prototype.insert=function(t,e){},Ke.prototype.remove=function(t,e){},Ke.prototype.query=function(){},Ke.prototype.interfaces_=function(){return[]},Ke.prototype.getClass=function(){return Ke};var Qe=function(){if(this._childBoundables=new St,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},Je={serialVersionUID:{configurable:!0}};Qe.prototype.getLevel=function(){return this._level},Qe.prototype.size=function(){return this._childBoundables.size()},Qe.prototype.getChildBoundables=function(){return this._childBoundables},Qe.prototype.addChildBoundable=function(t){et.isTrue(null===this._bounds),this._childBoundables.add(t)},Qe.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Qe.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Qe.prototype.interfaces_=function(){return[We,e]},Qe.prototype.getClass=function(){return Qe},Je.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Qe,Je);var $e=function(){};$e.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},$e.min=function(t){return $e.sort(t),t.get(0)},$e.sort=function(t,e){var n=t.toArray();e?Ft.sort(n,e):Ft.sort(n);for(var r=t.iterator(),i=0,o=n.length;i<o;i++)r.next(),r.set(n[i])},$e.singletonList=function(t){var e=new St;return e.add(t),e};var tn=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()};tn.prototype.expandToQueue=function(t,e){var n=tn.isComposite(this._boundable1),r=tn.isComposite(this._boundable2);if(n&&r)return tn.area(this._boundable1)>tn.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new v("neither boundable is composite")},tn.prototype.isLeaves=function(){return!(tn.isComposite(this._boundable1)||tn.isComposite(this._boundable2))},tn.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},tn.prototype.expand=function(t,e,n,r){for(var i=t.getChildBoundables().iterator();i.hasNext();){var o=i.next(),a=new tn(o,e,this._itemDistance);a.getDistance()<r&&n.add(a)}},tn.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},tn.prototype.getDistance=function(){return this._distance},tn.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},tn.prototype.interfaces_=function(){return[b]},tn.prototype.getClass=function(){return tn},tn.area=function(t){return t.getBounds().getArea()},tn.isComposite=function(t){return t instanceof Qe};var en=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new St,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var n=arguments[0];et.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},nn={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};en.prototype.getNodeCapacity=function(){return this._nodeCapacity},en.prototype.lastNode=function(t){return t.get(t.size()-1)},en.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var n=e.next();n instanceof Qe?t+=this.size(n):n instanceof qe&&(t+=1)}return t}},en.prototype.removeItem=function(t,e){for(var n=null,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof qe&&i.getItem()===e&&(n=i)}return null!==n&&(t.getChildBoundables().remove(n),!0)},en.prototype.itemsTree=function(){if(0===arguments.length){this.build();var t=this.itemsTree(this._root);return null===t?new St:t}if(1===arguments.length){for(var e=arguments[0],n=new St,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof Qe){var o=this.itemsTree(i);null!==o&&n.add(o)}else i instanceof qe?n.add(i.getItem()):et.shouldNeverReachHere()}return n.size()<=0?null:n}},en.prototype.insert=function(t,e){et.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new qe(t,e))},en.prototype.boundablesAtLevel=function(){if(1===arguments.length){var t=arguments[0],e=new St;return this.boundablesAtLevel(t,this._root,e),e}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];if(et.isTrue(n>-2),r.getLevel()===n)return i.add(r),null;for(var o=r.getChildBoundables().iterator();o.hasNext();){var a=o.next();a instanceof Qe?this.boundablesAtLevel(n,a,i):(et.isTrue(a instanceof qe),-1===n&&i.add(a))}return null}},en.prototype.query=function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new St;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,e),e}if(2===arguments.length){var n=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,r)}else if(3===arguments.length)if(L(arguments[2],Ye)&&arguments[0]instanceof Object&&arguments[1]instanceof Qe)for(var i=arguments[0],o=arguments[2],a=arguments[1].getChildBoundables(),s=0;s<a.size();s++){var u=a.get(s);this.getIntersectsOp().intersects(u.getBounds(),i)&&(u instanceof Qe?this.query(i,u,o):u instanceof qe?o.visitItem(u.getItem()):et.shouldNeverReachHere())}else if(L(arguments[2],wt)&&arguments[0]instanceof Object&&arguments[1]instanceof Qe)for(var l=arguments[0],c=arguments[2],h=arguments[1].getChildBoundables(),p=0;p<h.size();p++){var f=h.get(p);this.getIntersectsOp().intersects(f.getBounds(),l)&&(f instanceof Qe?this.query(l,f,c):f instanceof qe?c.add(f.getItem()):et.shouldNeverReachHere())}},en.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},en.prototype.getRoot=function(){return this.build(),this._root},en.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,e)}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=this.removeItem(r,i);if(o)return!0;for(var a=null,s=r.getChildBoundables().iterator();s.hasNext();){var u=s.next();if(this.getIntersectsOp().intersects(u.getBounds(),n)&&u instanceof Qe&&(o=this.remove(n,u,i))){a=u;break}}return null!==a&&a.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(a),o}},en.prototype.createHigherLevels=function(t,e){et.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,e+1)},en.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var n=e.next();if(n instanceof Qe){var r=this.depth(n);r>t&&(t=r)}}return t+1}},en.prototype.createParentBoundables=function(t,e){et.isTrue(!t.isEmpty());var n=new St;n.add(this.createNode(e));var r=new St(t);$e.sort(r,this.getComparator());for(var i=r.iterator();i.hasNext();){var o=i.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(e)),this.lastNode(n).addChildBoundable(o)}return n},en.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},en.prototype.interfaces_=function(){return[e]},en.prototype.getClass=function(){return en},en.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},nn.IntersectsOp.get=function(){return rn},nn.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},nn.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(en,nn);var rn=function(){},on=function(){};on.prototype.distance=function(t,e){},on.prototype.interfaces_=function(){return[]},on.prototype.getClass=function(){return on};var an=function(t){function n(e){e=e||n.DEFAULT_NODE_CAPACITY,t.call(this,e)}t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n;var r={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return n.prototype.createParentBoundablesFromVerticalSlices=function(t,e){et.isTrue(t.length>0);for(var n=new St,r=0;r<t.length;r++)n.addAll(this.createParentBoundablesFromVerticalSlice(t[r],e));return n},n.prototype.createNode=function(t){return new sn(t)},n.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},n.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],n=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,n)},n.prototype.getIntersectsOp=function(){return n.intersectsOp},n.prototype.verticalSlices=function(t,e){for(var n=Math.trunc(Math.ceil(t.size()/e)),r=new Array(e).fill(null),i=t.iterator(),o=0;o<e;o++){r[o]=new St;for(var a=0;i.hasNext()&&a<n;){var s=i.next();r[o].add(s),a++}}return r},n.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var n=arguments[0],r=arguments[1];t.prototype.query.call(this,n,r)}else if(3===arguments.length)if(L(arguments[2],Ye)&&arguments[0]instanceof Object&&arguments[1]instanceof Qe){var i=arguments[0],o=arguments[1],a=arguments[2];t.prototype.query.call(this,i,o,a)}else if(L(arguments[2],wt)&&arguments[0]instanceof Object&&arguments[1]instanceof Qe){var s=arguments[0],u=arguments[1],l=arguments[2];t.prototype.query.call(this,s,u,l)}},n.prototype.getComparator=function(){return n.yComparator},n.prototype.createParentBoundablesFromVerticalSlice=function(e,n){return t.prototype.createParentBoundables.call(this,e,n)},n.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return t.prototype.remove.call(this,e,n)}return t.prototype.remove.apply(this,arguments)},n.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},n.prototype.createParentBoundables=function(t,e){et.isTrue(!t.isEmpty());var r=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new St(t);$e.sort(i,n.xComparator);var o=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(r))));return this.createParentBoundablesFromVerticalSlices(o,e)},n.prototype.nearestNeighbour=function(){if(1===arguments.length){if(L(arguments[0],on)){var t=arguments[0],e=new tn(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof tn){var r=arguments[0];return this.nearestNeighbour(r,_.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof n&&L(arguments[1],on)){var i=arguments[0],o=arguments[1],a=new tn(this.getRoot(),i.getRoot(),o);return this.nearestNeighbour(a)}if(arguments[0]instanceof tn&&"number"==typeof arguments[1]){var s=arguments[0],u=arguments[1],l=null,c=new Xe;for(c.add(s);!c.isEmpty()&&u>0;){var h=c.poll(),p=h.getDistance();if(p>=u)break;h.isLeaves()?(u=p,l=h):h.expandToQueue(c,u)}return[l.getBoundable(0).getItem(),l.getBoundable(1).getItem()]}}else if(3===arguments.length){var f=arguments[2],d=new qe(arguments[0],arguments[1]),m=new tn(this.getRoot(),d,f);return this.nearestNeighbour(m)[0]}},n.prototype.interfaces_=function(){return[Ke,e]},n.prototype.getClass=function(){return n},n.centreX=function(t){return n.avg(t.getMinX(),t.getMaxX())},n.avg=function(t,e){return(t+e)/2},n.centreY=function(t){return n.avg(t.getMinY(),t.getMaxY())},r.STRtreeNode.get=function(){return sn},r.serialVersionUID.get=function(){return 0x39920f7d5f261e0},r.xComparator.get=function(){return{interfaces_:function(){return[S]},compare:function(e,r){return t.compareDoubles(n.centreX(e.getBounds()),n.centreX(r.getBounds()))}}},r.yComparator.get=function(){return{interfaces_:function(){return[S]},compare:function(e,r){return t.compareDoubles(n.centreY(e.getBounds()),n.centreY(r.getBounds()))}}},r.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},r.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(n,r),n}(en),sn=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var n=e.next();null===t?t=new W(n.getBounds()):t.expandToInclude(n.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Qe),un=function(){};un.prototype.interfaces_=function(){return[]},un.prototype.getClass=function(){return un},un.relativeSign=function(t,e){return t<e?-1:t>e?1:0},un.compare=function(t,e,n){if(e.equals2D(n))return 0;var r=un.relativeSign(e.x,n.x),i=un.relativeSign(e.y,n.y);switch(t){case 0:return un.compareValue(r,i);case 1:return un.compareValue(i,r);case 2:return un.compareValue(i,-r);case 3:return un.compareValue(-r,i);case 4:return un.compareValue(-r,-i);case 5:return un.compareValue(-i,-r);case 6:return un.compareValue(-i,r);case 7:return un.compareValue(r,-i)}return et.shouldNeverReachHere("invalid octant value"),0},un.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var ln=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._segString=t,this.coord=new E(e),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(n))};ln.prototype.getCoordinate=function(){return this.coord},ln.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},ln.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:un.compare(this._segmentOctant,this.coord,e.coord)},ln.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},ln.prototype.isInterior=function(){return this._isInterior},ln.prototype.interfaces_=function(){return[b]},ln.prototype.getClass=function(){return ln};var cn=function(){this._nodeMap=new h,this._edge=null;var t=arguments[0];this._edge=t};cn.prototype.getSplitCoordinates=function(){var t=new Ct;this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next();this.addEdgeCoordinates(n,r,t),n=r}return t.toCoordinateArray()},cn.prototype.addCollapsedNodes=function(){var t=new St;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var n=e.next().intValue();this.add(this._edge.getCoordinate(n),n)}},cn.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},cn.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var n=this._edge.getCoordinate(e),r=this._edge.getCoordinate(e+2);n.equals2D(r)&&t.add(new R(e+1))}},cn.prototype.addEdgeCoordinates=function(t,e,n){var r=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(r);n.add(new E(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)n.add(this._edge.getCoordinate(o));i&&n.add(new E(e.coord))},cn.prototype.iterator=function(){return this._nodeMap.values().iterator()},cn.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next(),i=this.createSplitEdge(n,r);t.add(i),n=r}},cn.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,1===r&&(n[0]=t.segmentIndex+1,!0)},cn.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();this.findCollapseIndex(r,i,e)&&t.add(new R(e[0])),r=i}},cn.prototype.getEdge=function(){return this._edge},cn.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},cn.prototype.createSplitEdge=function(t,e){var n=e.segmentIndex-t.segmentIndex+2,r=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),a=0;o[a++]=new E(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)o[a++]=this._edge.getCoordinate(s);return i&&(o[a]=new E(e.coord)),new dn(o,this._edge.getData())},cn.prototype.add=function(t,e){var n=new ln(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(n);return null!==r?(et.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)},cn.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),n=t.get(0).getCoordinate(0);if(!n.equals2D(e[0]))throw new $("bad split edge start point at "+n);var r=t.get(t.size()-1).getCoordinates(),i=r[r.length-1];if(!i.equals2D(e[e.length-1]))throw new $("bad split edge end point at "+i)},cn.prototype.interfaces_=function(){return[]},cn.prototype.getClass=function(){return cn};var hn=function(){};hn.prototype.interfaces_=function(){return[]},hn.prototype.getClass=function(){return hn},hn.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new v("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?n>=r?0:1:n>=r?7:6:e>=0?n>=r?3:2:n>=r?4:5}if(arguments[0]instanceof E&&arguments[1]instanceof E){var i=arguments[0],o=arguments[1],a=o.x-i.x,s=o.y-i.y;if(0===a&&0===s)throw new v("Cannot compute the octant for two identical points "+i);return hn.octant(a,s)}};var pn=function(){};pn.prototype.getCoordinates=function(){},pn.prototype.size=function(){},pn.prototype.getCoordinate=function(t){},pn.prototype.isClosed=function(){},pn.prototype.setData=function(t){},pn.prototype.getData=function(){},pn.prototype.interfaces_=function(){return[]},pn.prototype.getClass=function(){return pn};var fn=function(){};fn.prototype.addIntersection=function(t,e){},fn.prototype.interfaces_=function(){return[pn]},fn.prototype.getClass=function(){return fn};var dn=function(){this._nodeList=new cn(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};dn.prototype.getCoordinates=function(){return this._pts},dn.prototype.size=function(){return this._pts.length},dn.prototype.getCoordinate=function(t){return this._pts[t]},dn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},dn.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},dn.prototype.setData=function(t){this._data=t},dn.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:hn.octant(t,e)},dn.prototype.getData=function(){return this._data},dn.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var n=arguments[1],r=arguments[3],i=new E(arguments[0].getIntersection(r));this.addIntersection(i,n)}},dn.prototype.toString=function(){return J.toLineString(new ue(this._pts))},dn.prototype.getNodeList=function(){return this._nodeList},dn.prototype.addIntersectionNode=function(t,e){var n=e,r=n+1;if(r<this._pts.length){var i=this._pts[r];t.equals2D(i)&&(n=r)}return this._nodeList.add(t,n)},dn.prototype.addIntersections=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,n,r)},dn.prototype.interfaces_=function(){return[fn]},dn.prototype.getClass=function(){return dn},dn.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new St;return dn.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var n=arguments[1],r=arguments[0].iterator();r.hasNext();)r.next().getNodeList().addSplitEdges(n)};var mn=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new E,this.p1=new E;else if(1===arguments.length){var t=arguments[0];this.p0=new E(t.p0),this.p1=new E(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.p0=new E(e,n),this.p1=new E(r,i)}},gn={serialVersionUID:{configurable:!0}};mn.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},mn.prototype.orientationIndex=function(){if(arguments[0]instanceof mn){var t=arguments[0],e=st.orientationIndex(this.p0,this.p1,t.p0),n=st.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0||e<=0&&n<=0?Math.max(e,n):0}if(arguments[0]instanceof E){var r=arguments[0];return st.orientationIndex(this.p0,this.p1,r)}},mn.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},mn.prototype.isVertical=function(){return this.p0.x===this.p1.x},mn.prototype.equals=function(t){if(!(t instanceof mn))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},mn.prototype.intersection=function(t){var e=new it;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},mn.prototype.project=function(){if(arguments[0]instanceof E){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new E(t);var e=this.projectionFactor(t),n=new E;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof mn){var r=arguments[0],i=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(i>=1&&o>=1)return null;if(i<=0&&o<=0)return null;var a=this.project(r.p0);i<0&&(a=this.p0),i>1&&(a=this.p1);var s=this.project(r.p1);return o<0&&(s=this.p0),o>1&&(s=this.p1),new mn(a,s)}},mn.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},mn.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},mn.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},mn.prototype.distancePerpendicular=function(t){return st.distancePointLinePerpendicular(t,this.p0,this.p1)},mn.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},mn.prototype.midPoint=function(){return mn.midPoint(this.p0,this.p1)},mn.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=e*e+n*n;return r<=0?_.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/r},mn.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var n=new Array(2).fill(null),r=_.MAX_VALUE,i=null,o=this.closestPoint(t.p0);r=o.distance(t.p0),n[0]=o,n[1]=t.p0;var a=this.closestPoint(t.p1);(i=a.distance(t.p1))<r&&(r=i,n[0]=a,n[1]=t.p1);var s=t.closestPoint(this.p0);(i=s.distance(this.p0))<r&&(r=i,n[0]=this.p0,n[1]=s);var u=t.closestPoint(this.p1);return(i=u.distance(this.p1))<r&&(r=i,n[0]=this.p1,n[1]=u),n},mn.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},mn.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},mn.prototype.getLength=function(){return this.p0.distance(this.p1)},mn.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return 0!==n?n:this.p1.compareTo(e.p1)},mn.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},mn.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},mn.prototype.lineIntersection=function(t){try{return H.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof V))throw t}return null},mn.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},mn.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,a=Math.sqrt(i*i+o*o),s=0,u=0;if(0!==e){if(a<=0)throw new Error("Cannot compute offset from zero-length line segment");s=e*i/a,u=e*o/a}return new E(n-u,r+s)},mn.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}},mn.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||_.isNaN(e))&&(e=1),e},mn.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},mn.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},mn.prototype.distance=function(){if(arguments[0]instanceof mn){var t=arguments[0];return st.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof E){var e=arguments[0];return st.distancePointLine(e,this.p0,this.p1)}},mn.prototype.pointAlong=function(t){var e=new E;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},mn.prototype.hashCode=function(){var t=_.doubleToLongBits(this.p0.x);t^=31*_.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),n=_.doubleToLongBits(this.p1.x);return n^=31*_.doubleToLongBits(this.p1.y),e^Math.trunc(n)^Math.trunc(n>>32)},mn.prototype.interfaces_=function(){return[b,e]},mn.prototype.getClass=function(){return mn},mn.midPoint=function(t,e){return new E((t.x+e.x)/2,(t.y+e.y)/2)},gn.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(mn,gn);var yn=function(){this.tempEnv1=new W,this.tempEnv2=new W,this._overlapSeg1=new mn,this._overlapSeg2=new mn};yn.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[1],e=arguments[2],n=arguments[3];arguments[0].getLineSegment(t,this._overlapSeg1),e.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},yn.prototype.interfaces_=function(){return[]},yn.prototype.getClass=function(){return yn};var vn=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=r};vn.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},vn.prototype.computeSelect=function(t,e,n,r){var i=this._pts[e],o=this._pts[n];if(r.tempEnv1.init(i,o),n-e==1)return r.select(this,e),null;if(!t.intersects(r.tempEnv1))return null;var a=Math.trunc((e+n)/2);e<a&&this.computeSelect(t,e,a,r),a<n&&this.computeSelect(t,a,n,r)},vn.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,n=this._start;n<=this._end;n++)t[e++]=this._pts[n];return t},vn.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},vn.prototype.setId=function(t){this._id=t},vn.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},vn.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new W(t,e)}return this._env},vn.prototype.getEndIndex=function(){return this._end},vn.prototype.getStartIndex=function(){return this._start},vn.prototype.getContext=function(){return this._context},vn.prototype.getId=function(){return this._id},vn.prototype.computeOverlapsInternal=function(t,e,n,r,i,o){var a=this._pts[t],s=this._pts[e],u=n._pts[r],l=n._pts[i];if(e-t==1&&i-r==1)return o.overlap(this,t,n,r),null;if(o.tempEnv1.init(a,s),o.tempEnv2.init(u,l),!o.tempEnv1.intersects(o.tempEnv2))return null;var c=Math.trunc((t+e)/2),h=Math.trunc((r+i)/2);t<c&&(r<h&&this.computeOverlapsInternal(t,c,n,r,h,o),h<i&&this.computeOverlapsInternal(t,c,n,h,i,o)),c<e&&(r<h&&this.computeOverlapsInternal(c,e,n,r,h,o),h<i&&this.computeOverlapsInternal(c,e,n,h,i,o))},vn.prototype.interfaces_=function(){return[]},vn.prototype.getClass=function(){return vn};var _n=function(){};_n.prototype.interfaces_=function(){return[]},_n.prototype.getClass=function(){return _n},_n.getChainStartIndices=function(t){var e=0,n=new St;n.add(new R(e));do{var r=_n.findChainEnd(t,e);n.add(new R(r)),e=r}while(e<t.length-1);return _n.toIntArray(n)},_n.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var r=Be.quadrant(t[n],t[n+1]),i=e+1;i<t.length&&(t[i-1].equals2D(t[i])||Be.quadrant(t[i-1],t[i])===r);)i++;return i-1},_n.getChains=function(){if(1===arguments.length){var t=arguments[0];return _n.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],n=arguments[1],r=new St,i=_n.getChainStartIndices(e),o=0;o<i.length-1;o++){var a=new vn(e,i[o],i[o+1],n);r.add(a)}return r}},_n.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var xn=function(){};xn.prototype.computeNodes=function(t){},xn.prototype.getNodedSubstrings=function(){},xn.prototype.interfaces_=function(){return[]},xn.prototype.getClass=function(){return xn};var bn=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};bn.prototype.setSegmentIntersector=function(t){this._segInt=t},bn.prototype.interfaces_=function(){return[xn]},bn.prototype.getClass=function(){return bn};var wn=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new St,this._index=new an,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return dn.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=_n.getChains(t.getCoordinates(),t).iterator();e.hasNext();){var n=e.next();n.setId(this._idCounter++),this._index.insert(n.getEnvelope(),n),this._monoChains.add(n)}},e.prototype.computeNodes=function(t){this._nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=new Sn(this._segInt),e=this._monoChains.iterator();e.hasNext();)for(var n=e.next(),r=this._index.query(n.getEnvelope()).iterator();r.hasNext();){var i=r.next();if(i.getId()>n.getId()&&(n.computeOverlaps(i,t),this._nOverlaps++),this._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return Sn},Object.defineProperties(e,n),e}(bn),Sn=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[1],n=arguments[2],r=arguments[3],i=arguments[0].getContext(),o=n.getContext();this._si.processIntersections(i,e,o,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(yn),En=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(o),this.setJoinStyle(a),this.setMitreLimit(s)}},Cn={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};En.prototype.getEndCapStyle=function(){return this._endCapStyle},En.prototype.isSingleSided=function(){return this._isSingleSided},En.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=En.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=En.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==En.JOIN_ROUND&&(this._quadrantSegments=En.DEFAULT_QUADRANT_SEGMENTS)},En.prototype.getJoinStyle=function(){return this._joinStyle},En.prototype.setJoinStyle=function(t){this._joinStyle=t},En.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},En.prototype.getSimplifyFactor=function(){return this._simplifyFactor},En.prototype.getQuadrantSegments=function(){return this._quadrantSegments},En.prototype.setEndCapStyle=function(t){this._endCapStyle=t},En.prototype.getMitreLimit=function(){return this._mitreLimit},En.prototype.setMitreLimit=function(t){this._mitreLimit=t},En.prototype.setSingleSided=function(t){this._isSingleSided=t},En.prototype.interfaces_=function(){return[]},En.prototype.getClass=function(){return En},En.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Cn.CAP_ROUND.get=function(){return 1},Cn.CAP_FLAT.get=function(){return 2},Cn.CAP_SQUARE.get=function(){return 3},Cn.JOIN_ROUND.get=function(){return 1},Cn.JOIN_MITRE.get=function(){return 2},Cn.JOIN_BEVEL.get=function(){return 3},Cn.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Cn.DEFAULT_MITRE_LIMIT.get=function(){return 5},Cn.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(En,Cn);var Mn=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=st.COUNTERCLOCKWISE,this._inputLine=t||null},Tn={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Mn.prototype.isDeletable=function(t,e,n,r){var i=this._inputLine[t],o=this._inputLine[e],a=this._inputLine[n];return!!this.isConcave(i,o,a)&&!!this.isShallow(i,o,a,r)&&this.isShallowSampled(i,o,t,n,r)},Mn.prototype.deleteShallowConcavities=function(){for(var t=1,e=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(e),r=!1;n<this._inputLine.length;){var i=!1;this.isDeletable(t,e,n,this._distanceTol)&&(this._isDeleted[e]=Mn.DELETE,i=!0,r=!0),t=i?n:e,e=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(e)}return r},Mn.prototype.isShallowConcavity=function(t,e,n,r){return st.computeOrientation(t,e,n)===this._angleOrientation&&st.distancePointLine(e,t,n)<r},Mn.prototype.isShallowSampled=function(t,e,n,r,i){var o=Math.trunc((r-n)/Mn.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var a=n;a<r;a+=o)if(!this.isShallow(t,e,this._inputLine[a],i))return!1;return!0},Mn.prototype.isConcave=function(t,e,n){return st.computeOrientation(t,e,n)===this._angleOrientation},Mn.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=st.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},Mn.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Mn.DELETE;)e++;return e},Mn.prototype.isShallow=function(t,e,n,r){return st.distancePointLine(e,t,n)<r},Mn.prototype.collapseLine=function(){for(var t=new Ct,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Mn.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},Mn.prototype.interfaces_=function(){return[]},Mn.prototype.getClass=function(){return Mn},Mn.simplify=function(t,e){return new Mn(t).simplify(e)},Tn.INIT.get=function(){return 0},Tn.DELETE.get=function(){return 1},Tn.KEEP.get=function(){return 1},Tn.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Mn,Tn);var An=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new St},Pn={COORDINATE_ARRAY_TYPE:{configurable:!0}};An.prototype.getCoordinates=function(){return this._ptList.toArray(An.COORDINATE_ARRAY_TYPE)},An.prototype.setPrecisionModel=function(t){this._precisionModel=t},An.prototype.addPt=function(t){var e=new E(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},An.prototype.revere=function(){},An.prototype.addPts=function(t,e){if(e)for(var n=0;n<t.length;n++)this.addPt(t[n]);else for(var r=t.length-1;r>=0;r--)this.addPt(t[r])},An.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},An.prototype.toString=function(){return(new ye).createLineString(this.getCoordinates()).toString()},An.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new E(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},An.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},An.prototype.interfaces_=function(){return[]},An.prototype.getClass=function(){return An},Pn.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(An,Pn);var Ln=function(){},In={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Ln.prototype.interfaces_=function(){return[]},Ln.prototype.getClass=function(){return Ln},Ln.toDegrees=function(t){return 180*t/Math.PI},Ln.normalize=function(t){for(;t>Math.PI;)t-=Ln.PI_TIMES_2;for(;t<=-Math.PI;)t+=Ln.PI_TIMES_2;return t},Ln.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],n=arguments[1],r=n.x-e.x,i=n.y-e.y;return Math.atan2(i,r)}},Ln.isAcute=function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)>0},Ln.isObtuse=function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)<0},Ln.interiorAngle=function(t,e,n){var r=Ln.angle(e,t),i=Ln.angle(e,n);return Math.abs(i-r)},Ln.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Ln.PI_TIMES_2;t>=Ln.PI_TIMES_2&&(t=0)}else{for(;t>=Ln.PI_TIMES_2;)t-=Ln.PI_TIMES_2;t<0&&(t=0)}return t},Ln.angleBetween=function(t,e,n){var r=Ln.angle(e,t),i=Ln.angle(e,n);return Ln.diff(r,i)},Ln.diff=function(t,e){var n=null;return(n=t<e?e-t:t-e)>Math.PI&&(n=2*Math.PI-n),n},Ln.toRadians=function(t){return t*Math.PI/180},Ln.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?Ln.COUNTERCLOCKWISE:n<0?Ln.CLOCKWISE:Ln.NONE},Ln.angleBetweenOriented=function(t,e,n){var r=Ln.angle(e,t),i=Ln.angle(e,n)-r;return i<=-Math.PI?i+Ln.PI_TIMES_2:i>Math.PI?i-Ln.PI_TIMES_2:i},In.PI_TIMES_2.get=function(){return 2*Math.PI},In.PI_OVER_2.get=function(){return Math.PI/2},In.PI_OVER_4.get=function(){return Math.PI/4},In.COUNTERCLOCKWISE.get=function(){return st.COUNTERCLOCKWISE},In.CLOCKWISE.get=function(){return st.CLOCKWISE},In.NONE.get=function(){return st.COLLINEAR},Object.defineProperties(Ln,In);var kn=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new mn,this._seg1=new mn,this._offset0=new mn,this._offset1=new mn,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new it,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===En.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},On={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};kn.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=st.computeOrientation(this._s0,this._s1,this._s2),r=n===st.CLOCKWISE&&this._side===Ce.LEFT||n===st.COUNTERCLOCKWISE&&this._side===Ce.RIGHT;0===n?this.addCollinear(e):r?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)},kn.prototype.addLineEndCap=function(t,e){var n=new mn(t,e),r=new mn;this.computeOffsetSegment(n,Ce.LEFT,this._distance,r);var i=new mn;this.computeOffsetSegment(n,Ce.RIGHT,this._distance,i);var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o);switch(this._bufParams.getEndCapStyle()){case En.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(e,s+Math.PI/2,s-Math.PI/2,st.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case En.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case En.CAP_SQUARE:var u=new E;u.x=Math.abs(this._distance)*Math.cos(s),u.y=Math.abs(this._distance)*Math.sin(s);var l=new E(r.p1.x+u.x,r.p1.y+u.y),c=new E(i.p1.x+u.x,i.p1.y+u.y);this._segList.addPt(l),this._segList.addPt(c)}},kn.prototype.getCoordinates=function(){return this._segList.getCoordinates()},kn.prototype.addMitreJoin=function(t,e,n,r){var i=!0,o=null;try{o=H.intersection(e.p0,e.p1,n.p0,n.p1),(r<=0?1:o.distance(t)/Math.abs(r))>this._bufParams.getMitreLimit()&&(i=!1)}catch(t){if(!(t instanceof V))throw t;o=new E(0,0),i=!1}i?this._segList.addPt(o):this.addLimitedMitreJoin(e,n,r,this._bufParams.getMitreLimit())},kn.prototype.addFilletCorner=function(t,e,n,r,i){var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o),u=n.x-t.x,l=n.y-t.y,c=Math.atan2(l,u);r===st.CLOCKWISE?s<=c&&(s+=2*Math.PI):s>=c&&(s-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,s,c,r,i),this._segList.addPt(n)},kn.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*kn.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===En.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===En.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},kn.prototype.createSquare=function(t){this._segList.addPt(new E(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new E(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new E(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new E(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},kn.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},kn.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},kn.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},kn.prototype.initSideSegments=function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)},kn.prototype.addLimitedMitreJoin=function(t,e,n,r){var i=this._seg0.p1,o=Ln.angle(i,this._seg0.p0),a=Ln.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1)/2,s=Ln.normalize(o+a),u=Ln.normalize(s+Math.PI),l=r*n,c=n-l*Math.abs(Math.sin(a)),h=i.x+l*Math.cos(u),p=i.y+l*Math.sin(u),f=new E(h,p),d=new mn(i,f),m=d.pointAlongOffset(1,c),g=d.pointAlongOffset(1,-c);this._side===Ce.LEFT?(this._segList.addPt(m),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(m))},kn.prototype.computeOffsetSegment=function(t,e,n,r){var i=e===Ce.LEFT?1:-1,o=t.p1.x-t.p0.x,a=t.p1.y-t.p0.y,s=Math.sqrt(o*o+a*a),u=i*n*o/s,l=i*n*a/s;r.p0.x=t.p0.x-l,r.p0.y=t.p0.y+u,r.p1.x=t.p1.x-l,r.p1.y=t.p1.y+u},kn.prototype.addFilletArc=function(t,e,n,r,i){var o=r===st.CLOCKWISE?-1:1,a=Math.abs(e-n),s=Math.trunc(a/this._filletAngleQuantum+.5);if(s<1)return null;for(var u=a/s,l=0,c=new E;l<a;){var h=e+o*l;c.x=t.x+i*Math.cos(h),c.y=t.y+i*Math.sin(h),this._segList.addPt(c),l+=u}},kn.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*kn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new E((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new E((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},kn.prototype.createCircle=function(t){var e=new E(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},kn.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},kn.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new An,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*kn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},kn.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===En.JOIN_BEVEL||this._bufParams.getJoinStyle()===En.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,st.CLOCKWISE,this._distance))},kn.prototype.closeRing=function(){this._segList.closeRing()},kn.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},kn.prototype.interfaces_=function(){return[]},kn.prototype.getClass=function(){return kn},On.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},On.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},On.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},On.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(kn,On);var Rn=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};Rn.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var n=e<0,r=Math.abs(e),i=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,n,i);var o=i.getCoordinates();return n&&Mt.reverse(o),o},Rn.prototype.computeSingleSidedBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var i=Mn.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],Ce.LEFT),n.addFirstSegment();for(var a=o-2;a>=0;a--)n.addNextSegment(i[a],!0)}else{n.addSegments(t,!1);var s=Mn.simplify(t,r),u=s.length-1;n.initSideSegments(s[0],s[1],Ce.LEFT),n.addFirstSegment();for(var l=2;l<=u;l++)n.addNextSegment(s[l],!0)}n.addLastSegment(),n.closeRing()},Rn.prototype.computeRingBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);e===Ce.RIGHT&&(r=-r);var i=Mn.simplify(t,r),o=i.length-1;n.initSideSegments(i[o-1],i[0],e);for(var a=1;a<=o;a++){var s=1!==a;n.addNextSegment(i[a],s)}n.closeRing()},Rn.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this._distance),r=Mn.simplify(t,n),i=r.length-1;e.initSideSegments(r[0],r[1],Ce.LEFT);for(var o=2;o<=i;o++)e.addNextSegment(r[o],!0);e.addLastSegment(),e.addLineEndCap(r[i-1],r[i]);var a=Mn.simplify(t,-n),s=a.length-1;e.initSideSegments(a[s],a[s-1],Ce.LEFT);for(var u=s-2;u>=0;u--)e.addNextSegment(a[u],!0);e.addLastSegment(),e.addLineEndCap(a[1],a[0]),e.closeRing()},Rn.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case En.CAP_ROUND:e.createCircle(t);break;case En.CAP_SQUARE:e.createSquare(t)}},Rn.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var n=Math.abs(e),r=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,r)}else this.computeLineBufferCurve(t,r);return r.getCoordinates()},Rn.prototype.getBufferParameters=function(){return this._bufParams},Rn.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},Rn.prototype.getRingCurve=function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(0===n)return Rn.copyCoordinates(t);var r=this.getSegGen(n);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()},Rn.prototype.computeOffsetCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){var i=Mn.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],Ce.LEFT),n.addFirstSegment();for(var a=o-2;a>=0;a--)n.addNextSegment(i[a],!0)}else{var s=Mn.simplify(t,r),u=s.length-1;n.initSideSegments(s[0],s[1],Ce.LEFT),n.addFirstSegment();for(var l=2;l<=u;l++)n.addNextSegment(s[l],!0)}n.addLastSegment()},Rn.prototype.getSegGen=function(t){return new kn(this._precisionModel,this._bufParams,t)},Rn.prototype.interfaces_=function(){return[]},Rn.prototype.getClass=function(){return Rn},Rn.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new E(t[n]);return e};var Dn=function(){this._subgraphs=null,this._seg=new mn,this._cga=new st;var t=arguments[0];this._subgraphs=t},Nn={DepthSegment:{configurable:!0}};Dn.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var t=arguments[0],e=new St,n=this._subgraphs.iterator();n.hasNext();){var r=n.next(),i=r.getEnvelope();t.y<i.getMinY()||t.y>i.getMaxY()||this.findStabbedSegments(t,r.getDirectedEdges(),e)}return e}if(3===arguments.length)if(L(arguments[2],wt)&&arguments[0]instanceof E&&arguments[1]instanceof Ze){for(var o=arguments[0],a=arguments[1],s=arguments[2],u=a.getEdge().getCoordinates(),l=0;l<u.length-1;l++)if(this._seg.p0=u[l],this._seg.p1=u[l+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<o.x||this._seg.isHorizontal()||o.y<this._seg.p0.y||o.y>this._seg.p1.y||st.computeOrientation(this._seg.p0,this._seg.p1,o)===st.RIGHT)){var c=a.getDepth(Ce.LEFT);this._seg.p0.equals(u[l])||(c=a.getDepth(Ce.RIGHT));var h=new Fn(this._seg,c);s.add(h)}}else if(L(arguments[2],wt)&&arguments[0]instanceof E&&L(arguments[1],wt))for(var p=arguments[0],f=arguments[2],d=arguments[1].iterator();d.hasNext();){var m=d.next();m.isForward()&&this.findStabbedSegments(p,m,f)}},Dn.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:$e.min(e)._leftDepth},Dn.prototype.interfaces_=function(){return[]},Dn.prototype.getClass=function(){return Dn},Nn.DepthSegment.get=function(){return Fn},Object.defineProperties(Dn,Nn);var Fn=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new mn(t),this._leftDepth=e};Fn.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==n||0!=(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?n:this._upwardSeg.compareTo(e._upwardSeg)},Fn.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return 0!==n?n:t.p1.compareTo(e.p1)},Fn.prototype.toString=function(){return this._upwardSeg.toString()},Fn.prototype.interfaces_=function(){return[b]},Fn.prototype.getClass=function(){return Fn};var zn=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};zn.prototype.area=function(){return zn.area(this.p0,this.p1,this.p2)},zn.prototype.signedArea=function(){return zn.signedArea(this.p0,this.p1,this.p2)},zn.prototype.interpolateZ=function(t){if(null===t)throw new v("Supplied point is null.");return zn.interpolateZ(t,this.p0,this.p1,this.p2)},zn.prototype.longestSideLength=function(){return zn.longestSideLength(this.p0,this.p1,this.p2)},zn.prototype.isAcute=function(){return zn.isAcute(this.p0,this.p1,this.p2)},zn.prototype.circumcentre=function(){return zn.circumcentre(this.p0,this.p1,this.p2)},zn.prototype.area3D=function(){return zn.area3D(this.p0,this.p1,this.p2)},zn.prototype.centroid=function(){return zn.centroid(this.p0,this.p1,this.p2)},zn.prototype.inCentre=function(){return zn.inCentre(this.p0,this.p1,this.p2)},zn.prototype.interfaces_=function(){return[]},zn.prototype.getClass=function(){return zn},zn.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)},zn.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2},zn.det=function(t,e,n,r){return t*r-e*n},zn.interpolateZ=function(t,e,n,r){var i=e.x,o=e.y,a=n.x-i,s=r.x-i,u=n.y-o,l=r.y-o,c=a*l-s*u,h=t.x-i,p=t.y-o,f=(l*h-s*p)/c,d=(-u*h+a*p)/c;return e.z+f*(n.z-e.z)+d*(r.z-e.z)},zn.longestSideLength=function(t,e,n){var r=t.distance(e),i=e.distance(n),o=n.distance(t),a=r;return i>a&&(a=i),o>a&&(a=o),a},zn.isAcute=function(t,e,n){return!!Ln.isAcute(t,e,n)&&!!Ln.isAcute(e,n,t)&&!!Ln.isAcute(n,t,e)},zn.circumcentre=function(t,e,n){var r=n.x,i=n.y,o=t.x-r,a=t.y-i,s=e.x-r,u=e.y-i,l=2*zn.det(o,a,s,u),c=zn.det(a,o*o+a*a,u,s*s+u*u),h=zn.det(o,o*o+a*a,s,s*s+u*u);return new E(r-c/l,i+h/l)},zn.perpendicularBisector=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=new H(t.x+n/2,t.y+r/2,1),o=new H(t.x-r+n/2,t.y+n+r/2,1);return new H(i,o)},zn.angleBisector=function(t,e,n){var r=e.distance(t),i=r/(r+e.distance(n)),o=n.x-t.x,a=n.y-t.y;return new E(t.x+i*o,t.y+i*a)},zn.area3D=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=e.z-t.z,a=n.x-t.x,s=n.y-t.y,u=n.z-t.z,l=i*u-o*s,c=o*a-r*u,h=r*s-i*a,p=l*l+c*c+h*h;return Math.sqrt(p)/2},zn.centroid=function(t,e,n){var r=(t.x+e.x+n.x)/3,i=(t.y+e.y+n.y)/3;return new E(r,i)},zn.inCentre=function(t,e,n){var r=e.distance(n),i=t.distance(n),o=t.distance(e),a=r+i+o,s=(r*t.x+i*e.x+o*n.x)/a,u=(r*t.y+i*e.y+o*n.y)/a;return new E(s,u)};var Bn=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new St;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n};Bn.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,A.EXTERIOR,A.INTERIOR)},Bn.prototype.addPolygon=function(t){var e=this._distance,n=Ce.LEFT;this._distance<0&&(e=-this._distance,n=Ce.RIGHT);var r=t.getExteriorRing(),i=Mt.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance))return null;if(this._distance<=0&&i.length<3)return null;this.addPolygonRing(i,e,n,A.EXTERIOR,A.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var a=t.getInteriorRingN(o),s=Mt.removeRepeatedPoints(a.getCoordinates());this._distance>0&&this.isErodedCompletely(a,-this._distance)||this.addPolygonRing(s,e,Ce.opposite(n),A.INTERIOR,A.EXTERIOR)}},Bn.prototype.isTriangleErodedCompletely=function(t,e){var n=new zn(t[0],t[1],t[2]),r=n.inCentre();return st.distancePointLine(r,n.p0,n.p1)<Math.abs(e)},Bn.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=Mt.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,A.EXTERIOR,A.INTERIOR)},Bn.prototype.addCurve=function(t,e,n){if(null===t||t.length<2)return null;var r=new dn(t,new ke(0,A.BOUNDARY,e,n));this._curveList.add(r)},Bn.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Bn.prototype.addPolygonRing=function(t,e,n,r,i){if(0===e&&t.length<ee.MINIMUM_VALID_SIZE)return null;var o=r,a=i;t.length>=ee.MINIMUM_VALID_SIZE&&st.isCCW(t)&&(o=i,a=r,n=Ce.opposite(n));var s=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(s,o,a)},Bn.prototype.add=function(t){if(t.isEmpty())return null;t instanceof $t?this.addPolygon(t):t instanceof Yt?this.addLineString(t):t instanceof Qt?this.addPoint(t):(t instanceof te||t instanceof Vt||t instanceof ne||t instanceof Zt)&&this.addCollection(t)},Bn.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(4===n.length)return this.isTriangleErodedCompletely(n,e);var r=t.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>i},Bn.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},Bn.prototype.interfaces_=function(){return[]},Bn.prototype.getClass=function(){return Bn};var jn=function(){};jn.prototype.locate=function(t){},jn.prototype.interfaces_=function(){return[]},jn.prototype.getClass=function(){return jn};var Un=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};Un.prototype.next=function(){if(this._atStart)return this._atStart=!1,Un.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new r;var t=this._parent.getGeometryN(this._index++);return t instanceof Zt?(this._subcollectionIterator=new Un(t),this._subcollectionIterator.next()):t},Un.prototype.remove=function(){throw new Error(this.getClass().getName())},Un.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Un.prototype.interfaces_=function(){return[bt]},Un.prototype.getClass=function(){return Un},Un.isAtomic=function(t){return!(t instanceof Zt)};var Zn=function(){this._geom=null;var t=arguments[0];this._geom=t};Zn.prototype.locate=function(t){return Zn.locate(t,this._geom)},Zn.prototype.interfaces_=function(){return[jn]},Zn.prototype.getClass=function(){return Zn},Zn.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&st.isPointInRing(t,e.getCoordinates())},Zn.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!Zn.isPointInRing(t,n))return!1;for(var r=0;r<e.getNumInteriorRing();r++){var i=e.getInteriorRingN(r);if(Zn.isPointInRing(t,i))return!1}return!0},Zn.containsPoint=function(t,e){if(e instanceof $t)return Zn.containsPointInPolygon(t,e);if(e instanceof Zt)for(var n=new Un(e);n.hasNext();){var r=n.next();if(r!==e&&Zn.containsPoint(t,r))return!0}return!1},Zn.locate=function(t,e){return e.isEmpty()?A.EXTERIOR:Zn.containsPoint(t,e)?A.INTERIOR:A.EXTERIOR};var Vn=function(){this._edgeMap=new h,this._edgeList=null,this._ptInAreaLocation=[A.NONE,A.NONE]};Vn.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return 0===e&&(n=this._edgeList.size()-1),this._edgeList.get(n)},Vn.prototype.propagateSideLabels=function(t){for(var e=A.NONE,n=this.iterator();n.hasNext();){var r=n.next().getLabel();r.isArea(t)&&r.getLocation(t,Ce.LEFT)!==A.NONE&&(e=r.getLocation(t,Ce.LEFT))}if(e===A.NONE)return null;for(var i=e,o=this.iterator();o.hasNext();){var a=o.next(),s=a.getLabel();if(s.getLocation(t,Ce.ON)===A.NONE&&s.setLocation(t,Ce.ON,i),s.isArea(t)){var u=s.getLocation(t,Ce.LEFT),l=s.getLocation(t,Ce.RIGHT);if(l!==A.NONE){if(l!==i)throw new Ae("side location conflict",a.getCoordinate());u===A.NONE&&et.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),i=u}else et.isTrue(s.getLocation(t,Ce.LEFT)===A.NONE,"found single null side"),s.setLocation(t,Ce.RIGHT,i),s.setLocation(t,Ce.LEFT,i)}}},Vn.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},Vn.prototype.print=function(t){G.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},Vn.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Vn.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,r=e.get(n).getLabel().getLocation(t,Ce.LEFT);et.isTrue(r!==A.NONE,"Found unlabelled area edge");for(var i=r,o=this.iterator();o.hasNext();){var a=o.next().getLabel();et.isTrue(a.isArea(t),"Found non-area edge");var s=a.getLocation(t,Ce.LEFT),u=a.getLocation(t,Ce.RIGHT);if(s===u)return!1;if(u!==i)return!1;i=s}return!0},Vn.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1},Vn.prototype.iterator=function(){return this.getEdges().iterator()},Vn.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new St(this._edgeMap.values())),this._edgeList},Vn.prototype.getLocation=function(t,e,n){return this._ptInAreaLocation[t]===A.NONE&&(this._ptInAreaLocation[t]=Zn.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]},Vn.prototype.toString=function(){var t=new O;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append("\n")}return t.toString()},Vn.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},Vn.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],n=this.iterator();n.hasNext();)for(var r=n.next().getLabel(),i=0;i<2;i++)r.isLine(i)&&r.getLocation(i)===A.BOUNDARY&&(e[i]=!0);for(var o=this.iterator();o.hasNext();)for(var a=o.next(),s=a.getLabel(),u=0;u<2;u++)if(s.isAnyNull(u)){var l=A.NONE;if(e[u])l=A.EXTERIOR;else{var c=a.getCoordinate();l=this.getLocation(u,c,t)}s.setAllLocationsIfNull(u,l)}},Vn.prototype.getDegree=function(){return this._edgeMap.size()},Vn.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},Vn.prototype.interfaces_=function(){return[]},Vn.prototype.getClass=function(){return Vn};var Gn=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var t=null,e=null,n=this._SCANNING_FOR_INCOMING,r=0;r<this._resultAreaEdgeList.size();r++){var i=this._resultAreaEdgeList.get(r),o=i.getSym();if(i.getLabel().isArea())switch(null===t&&i.isInResult()&&(t=i),n){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;e=o,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!i.isInResult())continue;e.setNext(i),n=this._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===t)throw new Ae("no outgoing dirEdge found",this.getCoordinate());et.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var n=t.get(0);if(1===e)return n;var r=t.get(e-1),i=n.getQuadrant(),o=r.getQuadrant();return Be.isNorthern(i)&&Be.isNorthern(o)?n:Be.isNorthern(i)||Be.isNorthern(o)?0!==n.getDy()?n:0!==r.getDy()?r:(et.shouldNeverReachHere("found two horizontal edges incident on node"),null):r},e.prototype.print=function(t){G.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new St;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next().getLabel();n.setAllLocationsIfNull(0,t.getLocation(0)),n.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,n=this._edgeList.size()-1;n>=0;n--){var r=this._edgeList.get(n),i=r.getSym();null===e&&(e=i),null!==t&&i.setNext(t),t=r}e.setNext(t)},e.prototype.computeDepths=function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),n=t.getDepth(Ce.LEFT),r=t.getDepth(Ce.RIGHT),i=this.computeDepths(e+1,this._edgeList.size(),n);if(this.computeDepths(0,e,i)!==r)throw new Ae("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var o=arguments[1],a=arguments[2],s=arguments[0];s<o;s++){var u=this._edgeList.get(s);u.setEdgeDepths(Ce.RIGHT,a),a=u.getDepth(Ce.LEFT)}return a}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=null,n=null,r=this._SCANNING_FOR_INCOMING,i=this._resultAreaEdgeList.size()-1;i>=0;i--){var o=this._resultAreaEdgeList.get(i),a=o.getSym();switch(null===e&&o.getEdgeRing()===t&&(e=o),r){case this._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==t)continue;n=a,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==t)continue;n.setNextMin(o),r=this._SCANNING_FOR_INCOMING}}r===this._LINKING_TO_OUTGOING&&(et.isTrue(null!==e,"found null for first outgoing dirEdge"),et.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),n.setNextMin(e))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}if(1===arguments.length){for(var n=arguments[0],r=0,i=this.iterator();i.hasNext();)i.next().getEdgeRing()===n&&r++;return r}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=A.NONE,e=this.iterator();e.hasNext();){var n=e.next(),r=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){t=A.INTERIOR;break}if(r.isInResult()){t=A.EXTERIOR;break}}}if(t===A.NONE)return null;for(var i=t,o=this.iterator();o.hasNext();){var a=o.next(),s=a.getSym();a.isLineEdge()?a.getEdge().setCovered(i===A.INTERIOR):(a.isInResult()&&(i=A.EXTERIOR),s.isInResult()&&(i=A.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this._label=new ke(A.NONE);for(var n=this.iterator();n.hasNext();)for(var r=n.next().getEdge().getLabel(),i=0;i<2;i++){var o=r.getLocation(i);o!==A.INTERIOR&&o!==A.BOUNDARY||this._label.setLocation(i,A.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Vn),Hn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new Fe(t,new Gn)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ve),Wn=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Wn.prototype.compareTo=function(t){var e=t;return Wn.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},Wn.prototype.interfaces_=function(){return[b]},Wn.prototype.getClass=function(){return Wn},Wn.orientation=function(t){return 1===Mt.increasingDirection(t)},Wn.compareOriented=function(t,e,n,r){for(var i=e?1:-1,o=r?1:-1,a=e?t.length:-1,s=r?n.length:-1,u=e?0:t.length-1,l=r?0:n.length-1;;){var c=t[u].compareTo(n[l]);if(0!==c)return c;var h=(u+=i)===a,p=(l+=o)===s;if(h&&!p)return-1;if(!h&&p)return 1;if(h&&p)return 0}};var qn=function(){this._edges=new St,this._ocaMap=new h};qn.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var n=this._edges.get(e);e>0&&t.print(","),t.print("(");for(var r=n.getCoordinates(),i=0;i<r.length;i++)i>0&&t.print(","),t.print(r[i].x+" "+r[i].y);t.println(")")}t.print(")  ")},qn.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},qn.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},qn.prototype.iterator=function(){return this._edges.iterator()},qn.prototype.getEdges=function(){return this._edges},qn.prototype.get=function(t){return this._edges.get(t)},qn.prototype.findEqualEdge=function(t){var e=new Wn(t.getCoordinates());return this._ocaMap.get(e)},qn.prototype.add=function(t){this._edges.add(t);var e=new Wn(t.getCoordinates());this._ocaMap.put(e,t)},qn.prototype.interfaces_=function(){return[]},qn.prototype.getClass=function(){return qn};var Xn=function(){};Xn.prototype.processIntersections=function(t,e,n,r){},Xn.prototype.isDone=function(){},Xn.prototype.interfaces_=function(){return[]},Xn.prototype.getClass=function(){return Xn};var Yn=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Yn.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&1===this._li.getIntersectionNum()){if(Yn.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.size()-1;if(0===e&&r===i||0===r&&e===i)return!0}}return!1},Yn.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Yn.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Yn.prototype.getLineIntersector=function(){return this._li},Yn.prototype.hasProperIntersection=function(){return this._hasProper},Yn.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Yn.prototype.hasIntersection=function(){return this._hasIntersection},Yn.prototype.isDone=function(){return!1},Yn.prototype.hasInteriorIntersection=function(){return this._hasInterior},Yn.prototype.interfaces_=function(){return[Xn]},Yn.prototype.getClass=function(){return Yn},Yn.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var Kn=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new E(t),this.segmentIndex=e,this.dist=n};Kn.prototype.getSegmentIndex=function(){return this.segmentIndex},Kn.prototype.getCoordinate=function(){return this.coord},Kn.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},Kn.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},Kn.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},Kn.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Kn.prototype.getDistance=function(){return this.dist},Kn.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},Kn.prototype.interfaces_=function(){return[b]},Kn.prototype.getClass=function(){return Kn};var Qn=function(){this._nodeMap=new h,this.edge=null;var t=arguments[0];this.edge=t};Qn.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},Qn.prototype.iterator=function(){return this._nodeMap.values().iterator()},Qn.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next(),i=this.createSplitEdge(n,r);t.add(i),n=r}},Qn.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},Qn.prototype.createSplitEdge=function(t,e){var n=e.segmentIndex-t.segmentIndex+2,r=this.edge.pts[e.segmentIndex],i=e.dist>0||!e.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),a=0;o[a++]=new E(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)o[a++]=this.edge.pts[s];return i&&(o[a]=e.coord),new nr(o,new ke(this.edge._label))},Qn.prototype.add=function(t,e,n){var r=new Kn(t,e,n),i=this._nodeMap.get(r);return null!==i?i:(this._nodeMap.put(r,r),r)},Qn.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},Qn.prototype.interfaces_=function(){return[]},Qn.prototype.getClass=function(){return Qn};var Jn=function(){};Jn.prototype.getChainStartIndices=function(t){var e=0,n=new St;n.add(new R(e));do{var r=this.findChainEnd(t,e);n.add(new R(r)),e=r}while(e<t.length-1);return Jn.toIntArray(n)},Jn.prototype.findChainEnd=function(t,e){for(var n=Be.quadrant(t[e],t[e+1]),r=e+1;r<t.length&&Be.quadrant(t[r-1],t[r])===n;)r++;return r-1},Jn.prototype.interfaces_=function(){return[]},Jn.prototype.getClass=function(){return Jn},Jn.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var $n=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new W,this.env2=new W;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Jn;this.startIndex=e.getChainStartIndices(this.pts)};$n.prototype.getCoordinates=function(){return this.pts},$n.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n},$n.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n},$n.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],r)}else if(6===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3],u=arguments[4],l=arguments[5],c=this.pts[i],h=this.pts[o],p=a.pts[s],f=a.pts[u];if(o-i==1&&u-s==1)return l.addIntersections(this.e,i,a.e,s),null;if(this.env1.init(c,h),this.env2.init(p,f),!this.env1.intersects(this.env2))return null;var d=Math.trunc((i+o)/2),m=Math.trunc((s+u)/2);i<d&&(s<m&&this.computeIntersectsForChain(i,d,a,s,m,l),m<u&&this.computeIntersectsForChain(i,d,a,m,u,l)),d<o&&(s<m&&this.computeIntersectsForChain(d,o,a,s,m,l),m<u&&this.computeIntersectsForChain(d,o,a,m,u,l))}},$n.prototype.getStartIndexes=function(){return this.startIndex},$n.prototype.computeIntersects=function(t,e){for(var n=0;n<this.startIndex.length-1;n++)for(var r=0;r<t.startIndex.length-1;r++)this.computeIntersectsForChain(n,t,r,e)},$n.prototype.interfaces_=function(){return[]},$n.prototype.getClass=function(){return $n};var tr=function t(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var e=0;e<2;e++)for(var n=0;n<3;n++)this._depth[e][n]=t.NULL_VALUE},er={NULL_VALUE:{configurable:!0}};tr.prototype.getDepth=function(t,e){return this._depth[t][e]},tr.prototype.setDepth=function(t,e,n){this._depth[t][e]=n},tr.prototype.isNull=function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(this._depth[t][e]!==tr.NULL_VALUE)return!1;return!0}if(1===arguments.length){var n=arguments[0];return this._depth[n][1]===tr.NULL_VALUE}if(2===arguments.length){var r=arguments[0],i=arguments[1];return this._depth[r][i]===tr.NULL_VALUE}},tr.prototype.normalize=function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(var n=1;n<3;n++){var r=0;this._depth[t][n]>e&&(r=1),this._depth[t][n]=r}}},tr.prototype.getDelta=function(t){return this._depth[t][Ce.RIGHT]-this._depth[t][Ce.LEFT]},tr.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?A.EXTERIOR:A.INTERIOR},tr.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},tr.prototype.add=function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<2;e++)for(var n=1;n<3;n++){var r=t.getLocation(e,n);r!==A.EXTERIOR&&r!==A.INTERIOR||(this.isNull(e,n)?this._depth[e][n]=tr.depthAtLocation(r):this._depth[e][n]+=tr.depthAtLocation(r))}else if(3===arguments.length){var i=arguments[0],o=arguments[1];arguments[2]===A.INTERIOR&&this._depth[i][o]++}},tr.prototype.interfaces_=function(){return[]},tr.prototype.getClass=function(){return tr},tr.depthAtLocation=function(t){return t===A.EXTERIOR?0:t===A.INTERIOR?1:tr.NULL_VALUE},er.NULL_VALUE.get=function(){return-1},Object.defineProperties(tr,er);var nr=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new Qn(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new tr,this._depthDelta=0,1===arguments.length){var n=arguments[0];e.call(this,n,null)}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,ke.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var n=t;if(this.pts.length!==n.pts.length)return!1;for(var r=!0,i=!0,o=this.pts.length,a=0;a<this.pts.length;a++)if(this.pts[a].equals2D(n.pts[a])||(r=!1),this.pts[a].equals2D(n.pts[--o])||(i=!1),!r&&!i)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new $n(this)),this._mce},e.prototype.getEnvelope=function(){if(null===this._env){this._env=new W;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},e.prototype.addIntersection=function(t,e,n,r){var i=new E(t.getIntersection(r)),o=e,a=t.getEdgeDistance(n,r),s=o+1;if(s<this.pts.length){var u=this.pts[s];i.equals2D(u)&&(o=s,a=0)}this.eiList.add(i,o,a)},e.prototype.toString=function(){var t=new O;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,n,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],n=arguments[1];n.setAtLeastIfValid(e.getLocation(0,Ce.ON),e.getLocation(1,Ce.ON),1),e.isArea()&&(n.setAtLeastIfValid(e.getLocation(0,Ce.LEFT),e.getLocation(1,Ce.LEFT),2),n.setAtLeastIfValid(e.getLocation(0,Ce.RIGHT),e.getLocation(1,Ce.RIGHT),2))},e}(Ne),rr=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new qn,this._bufParams=t||null};rr.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},rr.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new ke(t.getLabel())).flip(),n.merge(r);var i=rr.depthDelta(r),o=e.getDepthDelta()+i;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(rr.depthDelta(t.getLabel()))},rr.prototype.buildSubgraphs=function(t,e){for(var n=new St,r=t.iterator();r.hasNext();){var i=r.next(),o=i.getRightmostCoordinate(),a=new Dn(n).getDepth(o);i.computeDepth(a),i.findResultEdges(),n.add(i),e.add(i.getDirectedEdges(),i.getNodes())}},rr.prototype.createSubgraphs=function(t){for(var e=new St,n=t.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new Le;i.create(r),e.add(i)}}return $e.sort(e,$e.reverseOrder()),e},rr.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},rr.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new wn,n=new it;return n.setPrecisionModel(t),e.setSegmentIntersector(new Yn(n)),e},rr.prototype.buffer=function(t,e){var n=this._workingPrecisionModel;null===n&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var r=new Rn(n,this._bufParams),i=new Bn(t,e,r).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,n),this._graph=new Ge(new Hn),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),a=new He(this._geomFact);this.buildSubgraphs(o,a);var s=a.getPolygons();return s.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(s)},rr.prototype.computeNodedEdges=function(t,e){var n=this.getNoder(e);n.computeNodes(t);for(var r=n.getNodedSubstrings().iterator();r.hasNext();){var i=r.next(),o=i.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var a=i.getData(),s=new nr(i.getCoordinates(),new ke(a));this.insertUniqueEdge(s)}}},rr.prototype.setNoder=function(t){this._workingNoder=t},rr.prototype.interfaces_=function(){return[]},rr.prototype.getClass=function(){return rr},rr.depthDelta=function(t){var e=t.getLocation(0,Ce.LEFT),n=t.getLocation(0,Ce.RIGHT);return e===A.INTERIOR&&n===A.EXTERIOR?1:e===A.EXTERIOR&&n===A.INTERIOR?-1:0},rr.convertSegStrings=function(t){for(var e=new ye,n=new St;t.hasNext();){var r=t.next(),i=e.createLineString(r.getCoordinates());n.add(i)}return e.buildGeometry(n)};var ir=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=i,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};ir.prototype.rescale=function(){if(L(arguments[0],xt))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.rescale(e.getCoordinates())}else if(arguments[0]instanceof Array){for(var n=arguments[0],r=0;r<n.length;r++)n[r].x=n[r].x/this._scaleFactor+this._offsetX,n[r].y=n[r].y/this._scaleFactor+this._offsetY;2===n.length&&n[0].equals2D(n[1])&&G.out.println(n)}},ir.prototype.scale=function(){if(L(arguments[0],xt)){for(var t=arguments[0],e=new St,n=t.iterator();n.hasNext();){var r=n.next();e.add(new dn(this.scale(r.getCoordinates()),r.getData()))}return e}if(arguments[0]instanceof Array){for(var i=arguments[0],o=new Array(i.length).fill(null),a=0;a<i.length;a++)o[a]=new E(Math.round((i[a].x-this._offsetX)*this._scaleFactor),Math.round((i[a].y-this._offsetY)*this._scaleFactor),i[a].z);return Mt.removeRepeatedPoints(o)}},ir.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},ir.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},ir.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},ir.prototype.interfaces_=function(){return[xn]},ir.prototype.getClass=function(){return ir};var or=function(){this._li=new it,this._segStrings=null;var t=arguments[0];this._segStrings=t},ar={fact:{configurable:!0}};or.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next().getCoordinates();this.checkEndPtVertexIntersections(e[0],this._segStrings),this.checkEndPtVertexIntersections(e[e.length-1],this._segStrings)}else if(2===arguments.length)for(var n=arguments[0],r=arguments[1].iterator();r.hasNext();)for(var i=r.next().getCoordinates(),o=1;o<i.length-1;o++)if(i[o].equals(n))throw new $("found endpt/interior pt intersection at index "+o+" :pt "+n)},or.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();)for(var e=t.next(),n=this._segStrings.iterator();n.hasNext();){var r=n.next();this.checkInteriorIntersections(e,r)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],a=i.getCoordinates(),s=o.getCoordinates(),u=0;u<a.length-1;u++)for(var l=0;l<s.length-1;l++)this.checkInteriorIntersections(i,u,o,l);else if(4===arguments.length){var c=arguments[0],h=arguments[1],p=arguments[2],f=arguments[3];if(c===p&&h===f)return null;var d=c.getCoordinates()[h],m=c.getCoordinates()[h+1],g=p.getCoordinates()[f],y=p.getCoordinates()[f+1];if(this._li.computeIntersection(d,m,g,y),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,d,m)||this.hasInteriorIntersection(this._li,g,y)))throw new $("found non-noded intersection at "+d+"-"+m+" and "+g+"-"+y)}},or.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},or.prototype.checkCollapses=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var n=arguments[0].getCoordinates(),r=0;r<n.length-2;r++)this.checkCollapse(n[r],n[r+1],n[r+2])},or.prototype.hasInteriorIntersection=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++){var i=t.getIntersection(r);if(!i.equals(e)&&!i.equals(n))return!0}return!1},or.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new $("found non-noded collapse at "+or.fact.createLineString([t,e,n]))},or.prototype.interfaces_=function(){return[]},or.prototype.getClass=function(){return or},ar.fact.get=function(){return new ye},Object.defineProperties(or,ar);var sr=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new v("Scale factor must be non-zero");1!==e&&(this._pt=new E(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new E,this._p1Scaled=new E),this.initCorners(this._pt)},ur={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};sr.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),i=Math.min(t.y,e.y),o=Math.max(t.y,e.y),a=this._maxx<n||this._minx>r||this._maxy<i||this._miny>o;if(a)return!1;var s=this.intersectsToleranceSquare(t,e);return et.isTrue(!(a&&s),"Found bad envelope test"),s},sr.prototype.initCorners=function(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new E(this._maxx,this._maxy),this._corner[1]=new E(this._minx,this._maxy),this._corner[2]=new E(this._minx,this._miny),this._corner[3]=new E(this._maxx,this._miny)},sr.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},sr.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},sr.prototype.getCoordinate=function(){return this._originalPt},sr.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},sr.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=sr.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new W(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},sr.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},sr.prototype.intersectsToleranceSquare=function(t,e){var n=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper()||n&&r||t.equals(this._pt)||e.equals(this._pt)))))},sr.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),r=t.getCoordinate(e+1);return!!this.intersects(n,r)&&(t.addIntersection(this.getCoordinate(),e),!0)},sr.prototype.interfaces_=function(){return[]},sr.prototype.getClass=function(){return sr},ur.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(sr,ur);var lr=function(){this.tempEnv1=new W,this.selectedSegment=new mn};lr.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[1];arguments[0].getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},lr.prototype.interfaces_=function(){return[]},lr.prototype.getClass=function(){return lr};var cr=function(){this._index=null;var t=arguments[0];this._index=t},hr={HotPixelSnapAction:{configurable:!0}};cr.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=e.getSafeEnvelope(),o=new pr(e,n,r);return this._index.query(i,{interfaces_:function(){return[Ye]},visitItem:function(t){t.select(i,o)}}),o.isNodeAdded()}},cr.prototype.interfaces_=function(){return[]},cr.prototype.getClass=function(){return cr},hr.HotPixelSnapAction.get=function(){return pr},Object.defineProperties(cr,hr);var pr=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._hotPixel=e,this._parentEdge=n,this._hotPixelVertexIndex=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[1],n=arguments[0].getContext();if(null!==this._parentEdge&&n===this._parentEdge&&e===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(n,e)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(lr),fr=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new St};fr.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];if(this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var u=0;u<this._li.getIntersectionNum();u++)this._interiorIntersections.add(this._li.getIntersection(u));t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)}},fr.prototype.isDone=function(){return!1},fr.prototype.getInteriorIntersections=function(){return this._interiorIntersections},fr.prototype.interfaces_=function(){return[Xn]},fr.prototype.getClass=function(){return fr};var dr=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new it,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};dr.prototype.checkCorrectness=function(t){var e=dn.getNodedSubstrings(t),n=new or(e);try{n.checkValid()}catch(t){if(!(t instanceof Z))throw t;t.printStackTrace()}},dr.prototype.getNodedSubstrings=function(){return dn.getNodedSubstrings(this._nodedSegStrings)},dr.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)},dr.prototype.findInteriorIntersections=function(t,e){var n=new fr(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()},dr.prototype.computeVertexSnaps=function(){if(L(arguments[0],xt))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof dn)for(var n=arguments[0],r=n.getCoordinates(),i=0;i<r.length;i++){var o=new sr(r[i],this._scaleFactor,this._li);this._pointSnapper.snap(o,n,i)&&n.addIntersection(r[i],i)}},dr.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new wn,this._pointSnapper=new cr(this._noder.getIndex()),this.snapRound(t,this._li)},dr.prototype.computeIntersectionSnaps=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),r=new sr(n,this._scaleFactor,this._li);this._pointSnapper.snap(r)}},dr.prototype.interfaces_=function(){return[xn]},dr.prototype.getClass=function(){return dr};var mr=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new En,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}},gr={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};mr.prototype.bufferFixedPrecision=function(t){var e=new ir(new dr(new fe(1)),t.getScale()),n=new rr(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)},mr.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=mr.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof Ae))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var n=arguments[0],r=mr.precisionScaleFactor(this._argGeom,this._distance,n),i=new fe(r);this.bufferFixedPrecision(i)}},mr.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===fe.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},mr.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},mr.prototype.bufferOriginalPrecision=function(){try{var t=new rr(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof $))throw t;this._saveException=t}},mr.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},mr.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},mr.prototype.interfaces_=function(){return[]},mr.prototype.getClass=function(){return mr},mr.bufferOp=function(){if(2===arguments.length){var t=arguments[1];return new mr(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ct&&"number"==typeof arguments[1]){var e=arguments[1],n=arguments[2],r=new mr(arguments[0]);return r.setQuadrantSegments(n),r.getResultGeometry(e)}if(arguments[2]instanceof En&&arguments[0]instanceof ct&&"number"==typeof arguments[1]){var i=arguments[1];return new mr(arguments[0],arguments[2]).getResultGeometry(i)}}else if(4===arguments.length){var o=arguments[1],a=arguments[2],s=arguments[3],u=new mr(arguments[0]);return u.setQuadrantSegments(a),u.setEndCapStyle(s),u.getResultGeometry(o)}},mr.precisionScaleFactor=function(t,e,n){var r=t.getEnvelopeInternal(),i=I.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(e>0?e:0),o=n-Math.trunc(Math.log(i)/Math.log(10)+1);return Math.pow(10,o)},gr.CAP_ROUND.get=function(){return En.CAP_ROUND},gr.CAP_BUTT.get=function(){return En.CAP_FLAT},gr.CAP_FLAT.get=function(){return En.CAP_FLAT},gr.CAP_SQUARE.get=function(){return En.CAP_SQUARE},gr.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(mr,gr);var yr=function(){this._pt=[new E,new E],this._distance=_.NaN,this._isNull=!0};yr.prototype.getCoordinates=function(){return this._pt},yr.prototype.getCoordinate=function(t){return this._pt[t]},yr.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}},yr.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},yr.prototype.getDistance=function(){return this._distance},yr.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}},yr.prototype.interfaces_=function(){return[]},yr.prototype.getClass=function(){return yr};var vr=function(){};vr.prototype.interfaces_=function(){return[]},vr.prototype.getClass=function(){return vr},vr.computeDistance=function(){if(arguments[2]instanceof yr&&arguments[0]instanceof Yt&&arguments[1]instanceof E)for(var t=arguments[1],e=arguments[2],n=arguments[0].getCoordinates(),r=new mn,i=0;i<n.length-1;i++){r.setCoordinates(n[i],n[i+1]);var o=r.closestPoint(t);e.setMinimum(o,t)}else if(arguments[2]instanceof yr&&arguments[0]instanceof $t&&arguments[1]instanceof E){var a=arguments[0],s=arguments[1],u=arguments[2];vr.computeDistance(a.getExteriorRing(),s,u);for(var l=0;l<a.getNumInteriorRing();l++)vr.computeDistance(a.getInteriorRingN(l),s,u)}else if(arguments[2]instanceof yr&&arguments[0]instanceof ct&&arguments[1]instanceof E){var c=arguments[0],h=arguments[1],p=arguments[2];if(c instanceof Yt)vr.computeDistance(c,h,p);else if(c instanceof $t)vr.computeDistance(c,h,p);else if(c instanceof Zt)for(var f=c,d=0;d<f.getNumGeometries();d++){var m=f.getGeometryN(d);vr.computeDistance(m,h,p)}else p.setMinimum(c.getCoordinate(),h)}else if(arguments[2]instanceof yr&&arguments[0]instanceof mn&&arguments[1]instanceof E){var g=arguments[1],y=arguments[2],v=arguments[0].closestPoint(g);y.setMinimum(v,g)}};var _r=function(t){this._maxPtDist=new yr,this._inputGeom=t||null},xr={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};_r.prototype.computeMaxMidpointDistance=function(t){var e=new wr(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},_r.prototype.computeMaxVertexDistance=function(t){var e=new br(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},_r.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},_r.prototype.getDistancePoints=function(){return this._maxPtDist},_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r},xr.MaxPointDistanceFilter.get=function(){return br},xr.MaxMidpointDistanceFilter.get=function(){return wr},Object.defineProperties(_r,xr);var br=function(t){this._maxPtDist=new yr,this._minPtDist=new yr,this._geom=t||null};br.prototype.filter=function(t){this._minPtDist.initialize(),vr.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},br.prototype.getMaxPointDistance=function(){return this._maxPtDist},br.prototype.interfaces_=function(){return[ft]},br.prototype.getClass=function(){return br};var wr=function(t){this._maxPtDist=new yr,this._minPtDist=new yr,this._geom=t||null};wr.prototype.filter=function(t,e){if(0===e)return null;var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=new E((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),vr.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},wr.prototype.isDone=function(){return!1},wr.prototype.isGeometryChanged=function(){return!1},wr.prototype.getMaxPointDistance=function(){return this._maxPtDist},wr.prototype.interfaces_=function(){return[Ut]},wr.prototype.getClass=function(){return wr};var Sr=function(t){this._comps=t||null};Sr.prototype.filter=function(t){t instanceof $t&&this._comps.add(t)},Sr.prototype.interfaces_=function(){return[jt]},Sr.prototype.getClass=function(){return Sr},Sr.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return Sr.getPolygons(t,new St)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof $t?n.add(e):e instanceof Zt&&e.apply(new Sr(n)),n}};var Er=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}};Er.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof ee){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Yt&&this._lines.add(t)},Er.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},Er.prototype.interfaces_=function(){return[lt]},Er.prototype.getClass=function(){return Er},Er.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(Er.getLines(t))}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(Er.getLines(e,n))}},Er.getLines=function(){if(1===arguments.length){var t=arguments[0];return Er.getLines(t,!1)}if(2===arguments.length){if(L(arguments[0],xt)&&L(arguments[1],xt)){for(var e=arguments[1],n=arguments[0].iterator();n.hasNext();){var r=n.next();Er.getLines(r,e)}return e}if(arguments[0]instanceof ct&&"boolean"==typeof arguments[1]){var i=arguments[0],o=arguments[1],a=new St;return i.apply(new Er(a,o)),a}if(arguments[0]instanceof ct&&L(arguments[1],xt)){var s=arguments[0],u=arguments[1];return s instanceof Yt?u.add(s):s.apply(new Er(u)),u}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&L(arguments[0],xt)&&L(arguments[1],xt)){for(var l=arguments[1],c=arguments[2],h=arguments[0].iterator();h.hasNext();){var p=h.next();Er.getLines(p,l,c)}return l}if("boolean"==typeof arguments[2]&&arguments[0]instanceof ct&&L(arguments[1],xt)){var f=arguments[1],d=arguments[2];return arguments[0].apply(new Er(f,d)),f}}};var Cr=function(){if(this._boundaryRule=dt.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new v("Rule must be non-null");this._boundaryRule=t}};Cr.prototype.locateInternal=function(){if(arguments[0]instanceof E&&arguments[1]instanceof $t){var t=arguments[0],e=arguments[1];if(e.isEmpty())return A.EXTERIOR;var n=e.getExteriorRing(),r=this.locateInPolygonRing(t,n);if(r===A.EXTERIOR)return A.EXTERIOR;if(r===A.BOUNDARY)return A.BOUNDARY;for(var i=0;i<e.getNumInteriorRing();i++){var o=e.getInteriorRingN(i),a=this.locateInPolygonRing(t,o);if(a===A.INTERIOR)return A.EXTERIOR;if(a===A.BOUNDARY)return A.BOUNDARY}return A.INTERIOR}if(arguments[0]instanceof E&&arguments[1]instanceof Yt){var s=arguments[0],u=arguments[1];if(!u.getEnvelopeInternal().intersects(s))return A.EXTERIOR;var l=u.getCoordinates();return u.isClosed()||!s.equals(l[0])&&!s.equals(l[l.length-1])?st.isOnLine(s,l)?A.INTERIOR:A.EXTERIOR:A.BOUNDARY}if(arguments[0]instanceof E&&arguments[1]instanceof Qt){var c=arguments[0];return arguments[1].getCoordinate().equals2D(c)?A.INTERIOR:A.EXTERIOR}},Cr.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?st.locatePointInRing(t,e.getCoordinates()):A.EXTERIOR},Cr.prototype.intersects=function(t,e){return this.locate(t,e)!==A.EXTERIOR},Cr.prototype.updateLocationInfo=function(t){t===A.INTERIOR&&(this._isIn=!0),t===A.BOUNDARY&&this._numBoundaries++},Cr.prototype.computeLocation=function(t,e){if(e instanceof Qt&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Yt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof $t)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Vt)for(var n=e,r=0;r<n.getNumGeometries();r++){var i=n.getGeometryN(r);this.updateLocationInfo(this.locateInternal(t,i))}else if(e instanceof ne)for(var o=e,a=0;a<o.getNumGeometries();a++){var s=o.getGeometryN(a);this.updateLocationInfo(this.locateInternal(t,s))}else if(e instanceof Zt)for(var u=new Un(e);u.hasNext();){var l=u.next();l!==e&&this.computeLocation(t,l)}},Cr.prototype.locate=function(t,e){return e.isEmpty()?A.EXTERIOR:e instanceof Yt||e instanceof $t?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?A.BOUNDARY:this._numBoundaries>0||this._isIn?A.INTERIOR:A.EXTERIOR)},Cr.prototype.interfaces_=function(){return[]},Cr.prototype.getClass=function(){return Cr};var Mr=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)t.call(this,arguments[0],t.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2];this._component=e,this._segIndex=n,this._pt=r}},Tr={INSIDE_AREA:{configurable:!0}};Mr.prototype.isInsideArea=function(){return this._segIndex===Mr.INSIDE_AREA},Mr.prototype.getCoordinate=function(){return this._pt},Mr.prototype.getGeometryComponent=function(){return this._component},Mr.prototype.getSegmentIndex=function(){return this._segIndex},Mr.prototype.interfaces_=function(){return[]},Mr.prototype.getClass=function(){return Mr},Tr.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Mr,Tr);var Ar=function(t){this._pts=t||null};Ar.prototype.filter=function(t){t instanceof Qt&&this._pts.add(t)},Ar.prototype.interfaces_=function(){return[jt]},Ar.prototype.getClass=function(){return Ar},Ar.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Qt?$e.singletonList(t):Ar.getPoints(t,new St)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Qt?n.add(e):e instanceof Zt&&e.apply(new Ar(n)),n}};var Pr=function(){this._locations=null;var t=arguments[0];this._locations=t};Pr.prototype.filter=function(t){(t instanceof Qt||t instanceof Yt||t instanceof $t)&&this._locations.add(new Mr(t,0,t.getCoordinate()))},Pr.prototype.interfaces_=function(){return[jt]},Pr.prototype.getClass=function(){return Pr},Pr.getLocations=function(t){var e=new St;return t.apply(new Pr(e)),e};var Lr=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Cr,this._minDistanceLocation=null,this._minDistance=_.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=i}};Lr.prototype.computeContainmentDistance=function(){if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=1-e,i=Sr.getPolygons(this._geom[e]);if(i.size()>0){var o=Pr.getLocations(this._geom[r]);if(this.computeContainmentDistance(o,i,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=n[0],this._minDistanceLocation[e]=n[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&L(arguments[0],wt)&&L(arguments[1],wt)){for(var a=arguments[0],s=arguments[1],u=arguments[2],l=0;l<a.size();l++)for(var c=a.get(l),h=0;h<s.size();h++)if(this.computeContainmentDistance(c,s.get(h),u),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Mr&&arguments[1]instanceof $t){var p=arguments[0],f=arguments[1],d=arguments[2],m=p.getCoordinate();if(A.EXTERIOR!==this._ptLocator.locate(m,f))return this._minDistance=0,d[0]=p,d[1]=new Mr(f,m),null}},Lr.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var r=0;r<t.size();r++)for(var i=t.get(r),o=0;o<e.size();o++){var a=e.get(o);if(this.computeMinDistance(i,a,n),this._minDistance<=this._terminateDistance)return null}},Lr.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=Er.getLines(this._geom[0]),n=Er.getLines(this._geom[1]),r=Ar.getPoints(this._geom[0]),i=Ar.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,r,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(r,i,t),void this.updateMinDistance(t,!1))))},Lr.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Lr.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},Lr.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Lr.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Yt&&arguments[1]instanceof Qt){var t=arguments[0],e=arguments[1],n=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;for(var r=t.getCoordinates(),i=e.getCoordinate(),o=0;o<r.length-1;o++){var a=st.distancePointLine(i,r[o],r[o+1]);if(a<this._minDistance){this._minDistance=a;var s=new mn(r[o],r[o+1]).closestPoint(i);n[0]=new Mr(t,o,s),n[1]=new Mr(e,0,i)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Yt&&arguments[1]instanceof Yt){var u=arguments[0],l=arguments[1],c=arguments[2];if(u.getEnvelopeInternal().distance(l.getEnvelopeInternal())>this._minDistance)return null;for(var h=u.getCoordinates(),p=l.getCoordinates(),f=0;f<h.length-1;f++)for(var d=0;d<p.length-1;d++){var m=st.distanceLineLine(h[f],h[f+1],p[d],p[d+1]);if(m<this._minDistance){this._minDistance=m;var g=new mn(h[f],h[f+1]),y=new mn(p[d],p[d+1]),v=g.closestPoints(y);c[0]=new Mr(u,f,v[0]),c[1]=new Mr(l,d,v[1])}if(this._minDistance<=this._terminateDistance)return null}}},Lr.prototype.computeMinDistancePoints=function(t,e,n){for(var r=0;r<t.size();r++)for(var i=t.get(r),o=0;o<e.size();o++){var a=e.get(o),s=i.getCoordinate().distance(a.getCoordinate());if(s<this._minDistance&&(this._minDistance=s,n[0]=new Mr(i,0,i.getCoordinate()),n[1]=new Mr(a,0,a.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Lr.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new v("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Lr.prototype.computeMinDistanceLines=function(t,e,n){for(var r=0;r<t.size();r++)for(var i=t.get(r),o=0;o<e.size();o++){var a=e.get(o);if(this.computeMinDistance(i,a,n),this._minDistance<=this._terminateDistance)return null}},Lr.prototype.interfaces_=function(){return[]},Lr.prototype.getClass=function(){return Lr},Lr.distance=function(t,e){return new Lr(t,e).distance()},Lr.isWithinDistance=function(t,e,n){return new Lr(t,e,n).distance()<=n},Lr.nearestPoints=function(t,e){return new Lr(t,e).nearestPoints()};var Ir=function(){this._pt=[new E,new E],this._distance=_.NaN,this._isNull=!0};Ir.prototype.getCoordinates=function(){return this._pt},Ir.prototype.getCoordinate=function(t){return this._pt[t]},Ir.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}},Ir.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},Ir.prototype.toString=function(){return J.toLineString(this._pt[0],this._pt[1])},Ir.prototype.getDistance=function(){return this._distance},Ir.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}},Ir.prototype.interfaces_=function(){return[]},Ir.prototype.getClass=function(){return Ir};var kr=function(){};kr.prototype.interfaces_=function(){return[]},kr.prototype.getClass=function(){return kr},kr.computeDistance=function(){if(arguments[2]instanceof Ir&&arguments[0]instanceof Yt&&arguments[1]instanceof E)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=new mn,i=t.getCoordinates(),o=0;o<i.length-1;o++){r.setCoordinates(i[o],i[o+1]);var a=r.closestPoint(e);n.setMinimum(a,e)}else if(arguments[2]instanceof Ir&&arguments[0]instanceof $t&&arguments[1]instanceof E){var s=arguments[0],u=arguments[1],l=arguments[2];kr.computeDistance(s.getExteriorRing(),u,l);for(var c=0;c<s.getNumInteriorRing();c++)kr.computeDistance(s.getInteriorRingN(c),u,l)}else if(arguments[2]instanceof Ir&&arguments[0]instanceof ct&&arguments[1]instanceof E){var h=arguments[0],p=arguments[1],f=arguments[2];if(h instanceof Yt)kr.computeDistance(h,p,f);else if(h instanceof $t)kr.computeDistance(h,p,f);else if(h instanceof Zt)for(var d=h,m=0;m<d.getNumGeometries();m++){var g=d.getGeometryN(m);kr.computeDistance(g,p,f)}else f.setMinimum(h.getCoordinate(),p)}else if(arguments[2]instanceof Ir&&arguments[0]instanceof mn&&arguments[1]instanceof E){var y=arguments[1],v=arguments[2],_=arguments[0].closestPoint(y);v.setMinimum(_,y)}};var Or=function(){this._g0=null,this._g1=null,this._ptDist=new Ir,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},Rr={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Or.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},Or.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new v("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},Or.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},Or.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},Or.prototype.computeOrientedDistance=function(t,e,n){var r=new Dr(e);if(t.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var i=new Nr(e,this._densifyFrac);t.apply(i),n.setMaximum(i.getMaxPointDistance())}},Or.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},Or.prototype.interfaces_=function(){return[]},Or.prototype.getClass=function(){return Or},Or.distance=function(){if(2===arguments.length)return new Or(arguments[0],arguments[1]).distance();if(3===arguments.length){var t=arguments[2],e=new Or(arguments[0],arguments[1]);return e.setDensifyFraction(t),e.distance()}},Rr.MaxPointDistanceFilter.get=function(){return Dr},Rr.MaxDensifiedByFractionDistanceFilter.get=function(){return Nr},Object.defineProperties(Or,Rr);var Dr=function(){this._maxPtDist=new Ir,this._minPtDist=new Ir,this._euclideanDist=new kr,this._geom=null;var t=arguments[0];this._geom=t};Dr.prototype.filter=function(t){this._minPtDist.initialize(),kr.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Dr.prototype.getMaxPointDistance=function(){return this._maxPtDist},Dr.prototype.interfaces_=function(){return[ft]},Dr.prototype.getClass=function(){return Dr};var Nr=function(){this._maxPtDist=new Ir,this._minPtDist=new Ir,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};Nr.prototype.filter=function(t,e){if(0===e)return null;for(var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=(r.x-n.x)/this._numSubSegs,o=(r.y-n.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var s=n.x+a*i,u=n.y+a*o,l=new E(s,u);this._minPtDist.initialize(),kr.computeDistance(this._geom,l,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},Nr.prototype.isDone=function(){return!1},Nr.prototype.isGeometryChanged=function(){return!1},Nr.prototype.getMaxPointDistance=function(){return this._maxPtDist},Nr.prototype.interfaces_=function(){return[Ut]},Nr.prototype.getClass=function(){return Nr};var Fr=function(t,e,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=n||null},zr={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Fr.prototype.checkMaximumDistance=function(t,e,n){var r=new Or(e,t);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var i=r.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+J.toLineString(i[0],i[1])+")"}},Fr.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Fr.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Fr.VERBOSE&&G.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Fr.prototype.checkNegativeValid=function(){if(!(this._input instanceof $t||this._input instanceof ne||this._input instanceof Zt))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},Fr.prototype.getErrorIndicator=function(){return this._errorIndicator},Fr.prototype.checkMinimumDistance=function(t,e,n){var r=new Lr(t,e,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var i=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+J.toLineString(i[0],i[1])+" )"}},Fr.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},Fr.prototype.getErrorLocation=function(){return this._errorLocation},Fr.prototype.getPolygonLines=function(t){for(var e=new St,n=new Er(e),r=Sr.getPolygons(t).iterator();r.hasNext();)r.next().apply(n);return t.getFactory().buildGeometry(e)},Fr.prototype.getErrorMessage=function(){return this._errMsg},Fr.prototype.interfaces_=function(){return[]},Fr.prototype.getClass=function(){return Fr},zr.VERBOSE.get=function(){return!1},zr.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Fr,zr);var Br=function(t,e,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=n||null},jr={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Br.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},Br.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Br.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new W(this._input.getEnvelopeInternal());e.expandBy(this._distance);var n=new W(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")},Br.prototype.checkDistance=function(){var t=new Fr(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},Br.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Br.prototype.checkPolygonal=function(){this._result instanceof $t||this._result instanceof ne||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Br.prototype.getErrorIndicator=function(){return this._errorIndicator},Br.prototype.getErrorLocation=function(){return this._errorLocation},Br.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Br.prototype.report=function(t){if(!Br.VERBOSE)return null;G.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},Br.prototype.getErrorMessage=function(){return this._errorMsg},Br.prototype.interfaces_=function(){return[]},Br.prototype.getClass=function(){return Br},Br.isValidMsg=function(t,e,n){var r=new Br(t,e,n);return r.isValid()?null:r.getErrorMessage()},Br.isValid=function(t,e,n){return!!new Br(t,e,n).isValid()},jr.VERBOSE.get=function(){return!1},jr.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Br,jr);var Ur=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Ur.prototype.getCoordinates=function(){return this._pts},Ur.prototype.size=function(){return this._pts.length},Ur.prototype.getCoordinate=function(t){return this._pts[t]},Ur.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Ur.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:hn.octant(this.getCoordinate(t),this.getCoordinate(t+1))},Ur.prototype.setData=function(t){this._data=t},Ur.prototype.getData=function(){return this._data},Ur.prototype.toString=function(){return J.toLineString(new ue(this._pts))},Ur.prototype.interfaces_=function(){return[pn]},Ur.prototype.getClass=function(){return Ur};var Zr=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new St,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Zr.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Zr.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},Zr.prototype.getIntersectionSegments=function(){return this._intSegments},Zr.prototype.count=function(){return this._intersectionCount},Zr.prototype.getIntersections=function(){return this._intersections},Zr.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Zr.prototype.setKeepIntersections=function(t){this._keepIntersections=t},Zr.prototype.processIntersections=function(t,e,n,r){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===n&&e===r)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(n,r))return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=i,this._intSegments[1]=o,this._intSegments[2]=a,this._intSegments[3]=s,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Zr.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},Zr.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Zr.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Zr.prototype.interfaces_=function(){return[Xn]},Zr.prototype.getClass=function(){return Zr},Zr.createAllIntersectionsFinder=function(t){var e=new Zr(t);return e.setFindAllIntersections(!0),e},Zr.createAnyIntersectionFinder=function(t){return new Zr(t)},Zr.createIntersectionCounter=function(t){var e=new Zr(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var Vr=function(){this._li=new it,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};Vr.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Vr.prototype.getIntersections=function(){return this._segInt.getIntersections()},Vr.prototype.isValid=function(){return this.execute(),this._isValid},Vr.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Vr.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Zr(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new wn;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Vr.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Ae(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Vr.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+J.toLineString(t[0],t[1])+" and "+J.toLineString(t[2],t[3])},Vr.prototype.interfaces_=function(){return[]},Vr.prototype.getClass=function(){return Vr},Vr.computeIntersections=function(t){var e=new Vr(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Gr=function t(){this._nv=null;var e=arguments[0];this._nv=new Vr(t.toSegmentStrings(e))};Gr.prototype.checkValid=function(){this._nv.checkValid()},Gr.prototype.interfaces_=function(){return[]},Gr.prototype.getClass=function(){return Gr},Gr.toSegmentStrings=function(t){for(var e=new St,n=t.iterator();n.hasNext();){var r=n.next();e.add(new Ur(r.getCoordinates(),r))}return e},Gr.checkValid=function(t){new Gr(t).checkValid()};var Hr=function(t){this._mapOp=t};Hr.prototype.map=function(t){for(var e=new St,n=0;n<t.getNumGeometries();n++){var r=this._mapOp.map(t.getGeometryN(n));r.isEmpty()||e.add(r)}return t.getFactory().createGeometryCollection(ye.toGeometryArray(e))},Hr.prototype.interfaces_=function(){return[]},Hr.prototype.getClass=function(){return Hr},Hr.map=function(t,e){return new Hr(e).map(t)};var Wr=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new St,this._resultLineList=new St;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n};Wr.prototype.collectLines=function(t){for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next();this.collectLineEdge(n,t,this._lineEdgesList),this.collectBoundaryTouchEdge(n,t,this._lineEdgesList)}},Wr.prototype.labelIsolatedLine=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)},Wr.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},Wr.prototype.collectLineEdge=function(t,e,n){var r=t.getLabel(),i=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Mi.isResultOfOp(r,e)||i.isCovered()||(n.add(i),t.setVisitedEdge(!0)))},Wr.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next(),r=n.getEdge();if(n.isLineEdge()&&!r.isCoveredSet()){var i=this._op.isCoveredByA(n.getCoordinate());r.setCovered(i)}}},Wr.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),r=n.getLabel();n.isIsolated()&&(r.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},Wr.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var n=e.next(),r=this._geometryFactory.createLineString(n.getCoordinates());this._resultLineList.add(r),n.setInResult(!0)}},Wr.prototype.collectBoundaryTouchEdge=function(t,e,n){var r=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(et.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Mi.isResultOfOp(r,e)&&e===Mi.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))))},Wr.prototype.interfaces_=function(){return[]},Wr.prototype.getClass=function(){return Wr};var qr=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new St;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};qr.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}},qr.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();if(!(n.isInResult()||n.isIncidentEdgeInResult()||0!==n.getEdges().getDegree()&&t!==Mi.INTERSECTION)){var r=n.getLabel();Mi.isResultOfOp(r,t)&&this.filterCoveredNodeToPoint(n)}}},qr.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},qr.prototype.interfaces_=function(){return[]},qr.prototype.getClass=function(){return qr};var Xr=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Xr.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},Xr.prototype.transformPolygon=function(t,e){var n=!0,r=this.transformLinearRing(t.getExteriorRing(),t);null!==r&&r instanceof ee&&!r.isEmpty()||(n=!1);for(var i=new St,o=0;o<t.getNumInteriorRing();o++){var a=this.transformLinearRing(t.getInteriorRingN(o),t);null===a||a.isEmpty()||(a instanceof ee||(n=!1),i.add(a))}if(n)return this._factory.createPolygon(r,i.toArray([]));var s=new St;return null!==r&&s.add(r),s.addAll(i),this._factory.buildGeometry(s)},Xr.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},Xr.prototype.getInputGeometry=function(){return this._inputGeom},Xr.prototype.transformMultiLineString=function(t,e){for(var n=new St,r=0;r<t.getNumGeometries();r++){var i=this.transformLineString(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Xr.prototype.transformCoordinates=function(t,e){return this.copy(t)},Xr.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},Xr.prototype.transformMultiPoint=function(t,e){for(var n=new St,r=0;r<t.getNumGeometries();r++){var i=this.transformPoint(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Xr.prototype.transformMultiPolygon=function(t,e){for(var n=new St,r=0;r<t.getNumGeometries();r++){var i=this.transformPolygon(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Xr.prototype.copy=function(t){return t.copy()},Xr.prototype.transformGeometryCollection=function(t,e){for(var n=new St,r=0;r<t.getNumGeometries();r++){var i=this.transform(t.getGeometryN(r));null!==i&&(this._pruneEmptyGeometry&&i.isEmpty()||n.add(i))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(ye.toGeometryArray(n)):this._factory.buildGeometry(n)},Xr.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Qt)return this.transformPoint(t,null);if(t instanceof te)return this.transformMultiPoint(t,null);if(t instanceof ee)return this.transformLinearRing(t,null);if(t instanceof Yt)return this.transformLineString(t,null);if(t instanceof Vt)return this.transformMultiLineString(t,null);if(t instanceof $t)return this.transformPolygon(t,null);if(t instanceof ne)return this.transformMultiPolygon(t,null);if(t instanceof Zt)return this.transformGeometryCollection(t,null);throw new v("Unknown Geometry subtype: "+t.getClass().getName())},Xr.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===n)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)},Xr.prototype.interfaces_=function(){return[]},Xr.prototype.getClass=function(){return Xr};var Yr=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new mn,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Yt&&"number"==typeof arguments[1]){var e=arguments[1];t.call(this,arguments[0].getCoordinates(),e)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1];this._srcPts=n,this._isClosed=t.isClosed(n),this._snapTolerance=r}};Yr.prototype.snapVertices=function(t,e){for(var n=this._isClosed?t.size()-1:t.size(),r=0;r<n;r++){var i=t.get(r),o=this.findSnapForVertex(i,e);null!==o&&(t.set(r,new E(o)),0===r&&this._isClosed&&t.set(t.size()-1,new E(o)))}},Yr.prototype.findSnapForVertex=function(t,e){for(var n=0;n<e.length;n++){if(t.equals2D(e[n]))return null;if(t.distance(e[n])<this._snapTolerance)return e[n]}return null},Yr.prototype.snapTo=function(t){var e=new Ct(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},Yr.prototype.snapSegments=function(t,e){if(0===e.length)return null;var n=e.length;e[0].equals2D(e[e.length-1])&&(n=e.length-1);for(var r=0;r<n;r++){var i=e[r],o=this.findSegmentIndexToSnap(i,t);o>=0&&t.add(o+1,new E(i),!1)}},Yr.prototype.findSegmentIndexToSnap=function(t,e){for(var n=_.MAX_VALUE,r=-1,i=0;i<e.size()-1;i++){if(this._seg.p0=e.get(i),this._seg.p1=e.get(i+1),this._seg.p0.equals2D(t)||this._seg.p1.equals2D(t)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(t);o<this._snapTolerance&&o<n&&(n=o,r=i)}return r},Yr.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},Yr.prototype.interfaces_=function(){return[]},Yr.prototype.getClass=function(){return Yr},Yr.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var Kr=function(t){this._srcGeom=t||null},Qr={SNAP_PRECISION_FACTOR:{configurable:!0}};Kr.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t);return new Jr(e,n).transform(this._srcGeom)},Kr.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this._srcGeom),r=new Jr(t,n,!0).transform(this._srcGeom),i=r;return e&&L(i,Jt)&&(i=r.buffer(0)),i},Kr.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},Kr.prototype.extractTargetCoordinates=function(t){for(var e=new f,n=t.getCoordinates(),r=0;r<n.length;r++)e.add(n[r]);return e.toArray(new Array(0).fill(null))},Kr.prototype.computeMinimumSegmentLength=function(t){for(var e=_.MAX_VALUE,n=0;n<t.length-1;n++){var r=t[n].distance(t[n+1]);r<e&&(e=r)}return e},Kr.prototype.interfaces_=function(){return[]},Kr.prototype.getClass=function(){return Kr},Kr.snap=function(t,e,n){var r=new Array(2).fill(null),i=new Kr(t);r[0]=i.snapTo(e,n);var o=new Kr(e);return r[1]=o.snapTo(r[0],n),r},Kr.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=Kr.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===fe.FIXED){var r=1/n.getScale()*2/1.415;r>e&&(e=r)}return e}if(2===arguments.length){var i=arguments[0],o=arguments[1];return Math.min(Kr.computeOverlaySnapTolerance(i),Kr.computeOverlaySnapTolerance(o))}},Kr.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*Kr.SNAP_PRECISION_FACTOR},Kr.snapToSelf=function(t,e,n){return new Kr(t).snapToSelf(e,n)},Qr.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Kr,Qr);var Jr=function(t){function e(e,n,r){t.call(this),this._snapTolerance=e||null,this._snapPts=n||null,this._isSelfSnap=void 0!==r&&r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var n=new Yr(t,this._snapTolerance);return n.setAllowSnappingToSourceVertices(this._isSelfSnap),n.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var n=t.toCoordinateArray(),r=this.snapLine(n,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Xr),$r=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};$r.prototype.getCommon=function(){return _.longBitsToDouble(this._commonBits)},$r.prototype.add=function(t){var e=_.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=$r.signExpBits(this._commonBits),this._isFirst=!1,null):$r.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=$r.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=$r.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},$r.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=_.longBitsToDouble(t),n="0000000000000000000000000000000000000000000000000000000000000000"+_.toBinaryString(t),r=n.substring(n.length-64);return r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+e+" ]"}},$r.prototype.interfaces_=function(){return[]},$r.prototype.getClass=function(){return $r},$r.getBit=function(t,e){return 0!=(t&1<<e)?1:0},$r.signExpBits=function(t){return t>>52},$r.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},$r.numCommonMostSigMantissaBits=function(t,e){for(var n=0,r=52;r>=0;r--){if($r.getBit(t,r)!==$r.getBit(e,r))return n;n++}return 52};var ti=function(){this._commonCoord=null,this._ccFilter=new ni},ei={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};ti.prototype.addCommonBits=function(t){var e=new ri(this._commonCoord);t.apply(e),t.geometryChanged()},ti.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new E(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new ri(e);return t.apply(n),t.geometryChanged(),t},ti.prototype.getCommonCoordinate=function(){return this._commonCoord},ti.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},ti.prototype.interfaces_=function(){return[]},ti.prototype.getClass=function(){return ti},ei.CommonCoordinateFilter.get=function(){return ni},ei.Translater.get=function(){return ri},Object.defineProperties(ti,ei);var ni=function(){this._commonBitsX=new $r,this._commonBitsY=new $r};ni.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},ni.prototype.getCommonCoordinate=function(){return new E(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},ni.prototype.interfaces_=function(){return[ft]},ni.prototype.getClass=function(){return ni};var ri=function(){this.trans=null;var t=arguments[0];this.trans=t};ri.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,r=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,r)},ri.prototype.isDone=function(){return!1},ri.prototype.isGeometryChanged=function(){return!0},ri.prototype.interfaces_=function(){return[Ut]},ri.prototype.getClass=function(){return ri};var ii=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};ii.prototype.selfSnap=function(t){return new Kr(t).snapTo(t,this._snapTolerance)},ii.prototype.removeCommonBits=function(t){this._cbr=new ti,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},ii.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},ii.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),n=Mi.overlayOp(e[0],e[1],t);return this.prepareResult(n)},ii.prototype.checkValid=function(t){t.isValid()||G.out.println("Snapped geometry is invalid")},ii.prototype.computeSnapTolerance=function(){this._snapTolerance=Kr.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},ii.prototype.snap=function(t){var e=this.removeCommonBits(t);return Kr.snap(e[0],e[1],this._snapTolerance)},ii.prototype.interfaces_=function(){return[]},ii.prototype.getClass=function(){return ii},ii.overlayOp=function(t,e,n){return new ii(t,e).getResultGeometry(n)},ii.union=function(t,e){return ii.overlayOp(t,e,Mi.UNION)},ii.intersection=function(t,e){return ii.overlayOp(t,e,Mi.INTERSECTION)},ii.symDifference=function(t,e){return ii.overlayOp(t,e,Mi.SYMDIFFERENCE)},ii.difference=function(t,e){return ii.overlayOp(t,e,Mi.DIFFERENCE)};var oi=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};oi.prototype.getResultGeometry=function(t){var e=null,n=!1,r=null;try{e=Mi.overlayOp(this._geom[0],this._geom[1],t),n=!0}catch(t){if(!(t instanceof $))throw t;r=t}if(!n)try{e=ii.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof $?r:t}return e},oi.prototype.interfaces_=function(){return[]},oi.prototype.getClass=function(){return oi},oi.overlayOp=function(t,e,n){return new oi(t,e).getResultGeometry(n)},oi.union=function(t,e){return oi.overlayOp(t,e,Mi.UNION)},oi.intersection=function(t,e){return oi.overlayOp(t,e,Mi.INTERSECTION)},oi.symDifference=function(t,e){return oi.overlayOp(t,e,Mi.SYMDIFFERENCE)},oi.difference=function(t,e){return oi.overlayOp(t,e,Mi.DIFFERENCE)};var ai=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};ai.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},ai.prototype.interfaces_=function(){return[]},ai.prototype.getClass=function(){return ai};var si=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=i,this._obj=o}},ui={INSERT:{configurable:!0},DELETE:{configurable:!0}};si.prototype.isDelete=function(){return this._eventType===si.DELETE},si.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},si.prototype.getObject=function(){return this._obj},si.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},si.prototype.getInsertEvent=function(){return this._insertEvent},si.prototype.isInsert=function(){return this._eventType===si.INSERT},si.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},si.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},si.prototype.interfaces_=function(){return[b]},si.prototype.getClass=function(){return si},ui.INSERT.get=function(){return 1},ui.DELETE.get=function(){return 2},Object.defineProperties(si,ui);var li=function(){};li.prototype.interfaces_=function(){return[]},li.prototype.getClass=function(){return li};var ci=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n};ci.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&1===this._li.getIntersectionNum()){if(ci.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(0===e&&r===i||0===r&&e===i)return!0}}return!1},ci.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},ci.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},ci.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},ci.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next().getCoordinate();if(t.isIntersection(r))return!0}return!1},ci.prototype.hasProperIntersection=function(){return this._hasProper},ci.prototype.hasIntersection=function(){return this._hasIntersection},ci.prototype.isDone=function(){return this._isDone},ci.prototype.isBoundaryPoint=function(t,e){return!(null===e||!this.isBoundaryPointInternal(t,e[0])&&!this.isBoundaryPointInternal(t,e[1]))},ci.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},ci.prototype.addIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},ci.prototype.interfaces_=function(){return[]},ci.prototype.getClass=function(){return ci},ci.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var hi=function(t){function e(){t.call(this),this.events=new St,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){$e.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var n=this.events.get(e);if(n.isInsert()&&this.processOverlaps(e,n.getDeleteEventIndex(),n,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof ci&&L(arguments[0],wt)&&L(arguments[1],wt)){var r=arguments[0],i=arguments[1],o=arguments[2];this.addEdges(r,r),this.addEdges(i,i),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&L(arguments[0],wt)&&arguments[1]instanceof ci){var a=arguments[0],s=arguments[1];arguments[2]?this.addEdges(a,null):this.addEdges(a),this.computeIntersections(s)}},e.prototype.addEdge=function(t,e){for(var n=t.getMonotoneChainEdge(),r=n.getStartIndexes(),i=0;i<r.length-1;i++){var o=new ai(n,i),a=new si(e,n.getMinX(i),o);this.events.add(a),this.events.add(new si(n.getMaxX(i),a))}},e.prototype.processOverlaps=function(t,e,n,r){for(var i=n.getObject(),o=t;o<e;o++){var a=this.events.get(o);if(a.isInsert()){var s=a.getObject();n.isSameLabel(a)||(i.computeIntersections(s,r),this.nOverlaps++)}}},e.prototype.addEdges=function(){if(1===arguments.length)for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.addEdge(e,e)}else if(2===arguments.length)for(var n=arguments[1],r=arguments[0].iterator();r.hasNext();){var i=r.next();this.addEdge(i,n)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(li),pi=function(){this._min=_.POSITIVE_INFINITY,this._max=_.NEGATIVE_INFINITY},fi={NodeComparator:{configurable:!0}};pi.prototype.getMin=function(){return this._min},pi.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},pi.prototype.getMax=function(){return this._max},pi.prototype.toString=function(){return J.toLineString(new E(this._min,0),new E(this._max,0))},pi.prototype.interfaces_=function(){return[]},pi.prototype.getClass=function(){return pi},fi.NodeComparator.get=function(){return di},Object.defineProperties(pi,fi);var di=function(){};di.prototype.compare=function(t,e){var n=t,r=e,i=(n._min+n._max)/2,o=(r._min+r._max)/2;return i<o?-1:i>o?1:0},di.prototype.interfaces_=function(){return[S]},di.prototype.getClass=function(){return di};var mi=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],n=arguments[1],r=arguments[2];this._min=e,this._max=n,this._item=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;n.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pi),gi=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],n=arguments[1];this._node1=e,this._node2=n,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,n),null!==this._node2&&this._node2.query(t,e,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pi),yi=function(){this._leaves=new St,this._root=null,this._level=0};yi.prototype.buildTree=function(){$e.sort(this._leaves,new pi.NodeComparator);for(var t=this._leaves,e=null,n=new St;;){if(this.buildLevel(t,n),1===n.size())return n.get(0);e=t,t=n,n=e}},yi.prototype.insert=function(t,e,n){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new mi(t,e,n))},yi.prototype.query=function(t,e,n){this.init(),this._root.query(t,e,n)},yi.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},yi.prototype.printNode=function(t){G.out.println(J.toLineString(new E(t._min,this._level),new E(t._max,this._level)))},yi.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},yi.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var r=t.get(n);if(null===(n+1<t.size()?t.get(n):null))e.add(r);else{var i=new gi(t.get(n),t.get(n+1));e.add(i)}}},yi.prototype.interfaces_=function(){return[]},yi.prototype.getClass=function(){return yi};var vi=function(){this._items=new St};vi.prototype.visitItem=function(t){this._items.add(t)},vi.prototype.getItems=function(){return this._items},vi.prototype.interfaces_=function(){return[Ye]},vi.prototype.getClass=function(){return vi};var _i=function(){this._index=null;var t=arguments[0];if(!L(t,Jt))throw new v("Argument must be Polygonal");this._index=new wi(t)},xi={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};_i.prototype.locate=function(t){var e=new at(t),n=new bi(e);return this._index.query(t.y,t.y,n),e.getLocation()},_i.prototype.interfaces_=function(){return[jn]},_i.prototype.getClass=function(){return _i},xi.SegmentVisitor.get=function(){return bi},xi.IntervalIndexedGeometry.get=function(){return wi},Object.defineProperties(_i,xi);var bi=function(){this._counter=null;var t=arguments[0];this._counter=t};bi.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},bi.prototype.interfaces_=function(){return[Ye]},bi.prototype.getClass=function(){return bi};var wi=function(){this._index=new yi;var t=arguments[0];this.init(t)};wi.prototype.init=function(t){for(var e=Er.getLines(t).iterator();e.hasNext();){var n=e.next().getCoordinates();this.addLine(n)}},wi.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var n=new mn(t[e-1],t[e]),r=Math.min(n.p0.y,n.p1.y),i=Math.max(n.p0.y,n.p1.y);this._index.insert(r,i,n)}},wi.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new vi;return this._index.query(t,e,n),n.getItems()}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._index.query(r,i,o)}},wi.prototype.interfaces_=function(){return[]},wi.prototype.getClass=function(){return wi};var Si=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new pe,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Cr,2===arguments.length){var e=arguments[0],n=arguments[1],r=dt.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=n,this._boundaryNodeRule=r,null!==n&&this.add(n)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];this._argIndex=i,this._parentGeom=o,this._boundaryNodeRule=a,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,n){var r=this._nodes.addNode(n).getLabel(),i=1;r.getLocation(t,Ce.ON)===A.BOUNDARY&&i++;var o=e.determineBoundary(this._boundaryNodeRule,i);r.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var n=arguments[1],r=arguments[2],i=new ci(arguments[0],!0,!1);i.setIsDoneIfProperInt(r);var o=this.createEdgeSetIntersector(),a=this._parentGeom instanceof ee||this._parentGeom instanceof $t||this._parentGeom instanceof ne,s=n||!a;return o.computeIntersections(this._edges,i,s),this.addSelfIntersectionNodes(this._argIndex),i}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},e.prototype.computeEdgeIntersections=function(t,e,n){var r=new ci(e,n,!0);return r.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,r),r},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Qt){var t=arguments[0].getCoordinate();this.insertPoint(this._argIndex,t,A.INTERIOR)}else if(arguments[0]instanceof E){var e=arguments[0];this.insertPoint(this._argIndex,e,A.INTERIOR)}},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),A.EXTERIOR,A.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var n=t.getInteriorRingN(e);this.addPolygonRing(n,A.INTERIOR,A.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],A.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],A.BOUNDARY)},e.prototype.addLineString=function(t){var e=Mt.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var n=new nr(e,new ke(this._argIndex,A.INTERIOR));this._lineEdgeMap.put(t,n),this.insertEdge(n),et.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),n=0,r=t.iterator();r.hasNext();){var i=r.next();e[n++]=i.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,n){if(this.isBoundaryNode(t,e))return null;n===A.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,n)},e.prototype.addPolygonRing=function(t,e,n){if(t.isEmpty())return null;var r=Mt.removeRepeatedPoints(t.getCoordinates());if(r.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=e,o=n;st.isCCW(r)&&(i=n,o=e);var a=new nr(r,new ke(this._argIndex,A.BOUNDARY,i,o));this._lineEdgeMap.put(t,a),this.insertEdge(a),this.insertPoint(this._argIndex,r[0],A.BOUNDARY)},e.prototype.insertPoint=function(t,e,n){var r=this._nodes.addNode(e),i=r.getLabel();null===i?r._label=new ke(t,n):i.setLocation(t,n)},e.prototype.createEdgeSetIntersector=function(){return new hi},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var n=e.next(),r=n.getLabel().getLocation(t),i=n.eiList.iterator();i.hasNext();){var o=i.next();this.addSelfIntersectionNode(t,o.coord,r)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof ne&&(this._useBoundaryDeterminationRule=!1),e instanceof $t)this.addPolygon(e);else if(e instanceof Yt)this.addLineString(e);else if(e instanceof Qt)this.addPoint(e);else if(e instanceof te)this.addCollection(e);else if(e instanceof Vt)this.addCollection(e);else if(e instanceof ne)this.addCollection(e);else{if(!(e instanceof Zt))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},e.prototype.locate=function(t){return L(this._parentGeom,Jt)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new _i(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?A.BOUNDARY:A.INTERIOR},e}(Ge),Ei=function(){if(this._li=new it,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Si(0,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=dt.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Si(0,e,r),this._arg[1]=new Si(1,n,r)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];i.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Si(0,i,a),this._arg[1]=new Si(1,o,a)}};Ei.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},Ei.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},Ei.prototype.interfaces_=function(){return[]},Ei.prototype.getClass=function(){return Ei};var Ci=function(){};Ci.prototype.interfaces_=function(){return[]},Ci.prototype.getClass=function(){return Ci},Ci.map=function(){if(arguments[0]instanceof ct&&L(arguments[1],Ci.MapOp)){for(var t=arguments[0],e=arguments[1],n=new St,r=0;r<t.getNumGeometries();r++){var i=e.map(t.getGeometryN(r));null!==i&&n.add(i)}return t.getFactory().buildGeometry(n)}if(L(arguments[0],xt)&&L(arguments[1],Ci.MapOp)){for(var o=arguments[0],a=arguments[1],s=new St,u=o.iterator();u.hasNext();){var l=u.next(),c=a.map(l);null!==c&&s.add(c)}return s}},Ci.MapOp=function(){};var Mi=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n),this._ptLocator=new Cr,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new qn,this._resultPolyList=new St,this._resultLineList=new St,this._resultPointList=new St,this._graph=new Ge(new Hn),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new ke(t.getLabel())).flip();var i=e.getDepth();i.isNull()&&i.add(n),i.add(r),n.merge(r)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),n=e.getSym();e.isInResult()&&n.isInResult()&&(e.setInResult(!1),n.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,n,r,i){var o=new St;return o.addAll(t),o.addAll(n),o.addAll(r),o.isEmpty()?e.createEmptyResult(i,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},e.prototype.isCovered=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();if(this._ptLocator.locate(t,r)!==A.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new St,e=this._edgeList.iterator();e.hasNext();){var n=e.next();n.isCollapsed()&&(e.remove(),t.add(n.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getEdges().getLabel();e.getLabel().merge(n)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertUniqueEdge(n)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new St;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Gr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var n=new He(this._geomFact);n.add(this._graph),this._resultPolyList=n.getPolygons();var r=new Wr(this,this._geomFact,this._ptLocator);this._resultLineList=r.build(t);var i=new qr(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,n)},e.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var n=e.next();this._graph.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea()&&!r.isInteriorAreaEdge()&&e.isResultOfOp(i.getLocation(0,Ce.RIGHT),i.getLocation(1,Ce.RIGHT),t)&&r.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),n=e.getLabel(),r=e.getDepth();if(!r.isNull()){r.normalize();for(var i=0;i<2;i++)n.isNull(i)||!n.isArea()||r.isNull(i)||(0===r.getDelta(i)?n.toLine(i):(et.isTrue(!r.isNull(i,Ce.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(i,Ce.LEFT,r.getLocation(i,Ce.LEFT)),et.isTrue(!r.isNull(i,Ce.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(i,Ce.RIGHT,r.getLocation(i,Ce.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getLabel();e.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(n)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ei);Mi.overlayOp=function(t,e,n){return new Mi(t,e).getResultGeometry(n)},Mi.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Mi.createEmptyResult(Mi.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return Hr.map(t,{interfaces_:function(){return[Ci.MapOp]},map:function(t){return t.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),oi.overlayOp(t,e,Mi.INTERSECTION)},Mi.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Mi.createEmptyResult(Mi.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),oi.overlayOp(t,e,Mi.SYMDIFFERENCE)},Mi.resultDimension=function(t,e,n){var r=e.getDimension(),i=n.getDimension(),o=-1;switch(t){case Mi.INTERSECTION:o=Math.min(r,i);break;case Mi.UNION:o=Math.max(r,i);break;case Mi.DIFFERENCE:o=r;break;case Mi.SYMDIFFERENCE:o=Math.max(r,i)}return o},Mi.createEmptyResult=function(t,e,n,r){var i=null;switch(Mi.resultDimension(t,e,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon()}return i},Mi.difference=function(t,e){return t.isEmpty()?Mi.createEmptyResult(Mi.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),oi.overlayOp(t,e,Mi.DIFFERENCE))},Mi.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=t.getLocation(0),r=t.getLocation(1);return Mi.isResultOfOp(n,r,e)}if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];switch(i===A.BOUNDARY&&(i=A.INTERIOR),o===A.BOUNDARY&&(o=A.INTERIOR),a){case Mi.INTERSECTION:return i===A.INTERIOR&&o===A.INTERIOR;case Mi.UNION:return i===A.INTERIOR||o===A.INTERIOR;case Mi.DIFFERENCE:return i===A.INTERIOR&&o!==A.INTERIOR;case Mi.SYMDIFFERENCE:return i===A.INTERIOR&&o!==A.INTERIOR||i!==A.INTERIOR&&o===A.INTERIOR}return!1}},Mi.INTERSECTION=1,Mi.UNION=2,Mi.DIFFERENCE=3,Mi.SYMDIFFERENCE=4;var Ti=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Cr,this._seg=new mn;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};Ti.prototype.isWithinToleranceOfBoundary=function(t){for(var e=0;e<this._linework.getNumGeometries();e++)for(var n=this._linework.getGeometryN(e).getCoordinateSequence(),r=0;r<n.size()-1;r++)if(n.getCoordinate(r,this._seg.p0),n.getCoordinate(r+1,this._seg.p1),this._seg.distance(t)<=this._boundaryDistanceTolerance)return!0;return!1},Ti.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?A.BOUNDARY:this._ptLocator.locate(t,this._g)},Ti.prototype.extractLinework=function(t){var e=new Ai;t.apply(e);var n=e.getLinework(),r=ye.toLineStringArray(n);return t.getFactory().createMultiLineString(r)},Ti.prototype.interfaces_=function(){return[]},Ti.prototype.getClass=function(){return Ti};var Ai=function(){this._linework=null,this._linework=new St};Ai.prototype.getLinework=function(){return this._linework},Ai.prototype.filter=function(t){if(t instanceof $t){var e=t;this._linework.add(e.getExteriorRing());for(var n=0;n<e.getNumInteriorRing();n++)this._linework.add(e.getInteriorRingN(n))}},Ai.prototype.interfaces_=function(){return[jt]},Ai.prototype.getClass=function(){return Ai};var Pi=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};Pi.prototype.extractPoints=function(t,e,n){for(var r=t.getCoordinates(),i=0;i<r.length-1;i++)this.computeOffsetPoints(r[i],r[i+1],e,n)},Pi.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},Pi.prototype.getPoints=function(t){for(var e=new St,n=Er.getLines(this._g).iterator();n.hasNext();){var r=n.next();this.extractPoints(r,t,e)}return e},Pi.prototype.computeOffsetPoints=function(t,e,n,r){var i=e.x-t.x,o=e.y-t.y,a=Math.sqrt(i*i+o*o),s=n*i/a,u=n*o/a,l=(e.x+t.x)/2,c=(e.y+t.y)/2;if(this._doLeft){var h=new E(l-u,c+s);r.add(h)}if(this._doRight){var p=new E(l+u,c-s);r.add(p)}},Pi.prototype.interfaces_=function(){return[]},Pi.prototype.getClass=function(){return Pi};var Li=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new St;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,r],this._locFinder=[new Ti(this._geom[0],this._boundaryDistanceTolerance),new Ti(this._geom[1],this._boundaryDistanceTolerance),new Ti(this._geom[2],this._boundaryDistanceTolerance)]},Ii={TOLERANCE:{configurable:!0}};Li.prototype.reportResult=function(t,e,n){G.out.println("Overlay result invalid - A:"+A.toLocationSymbol(e[0])+" B:"+A.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+A.toLocationSymbol(e[2]))},Li.prototype.isValid=function(t){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(t)},Li.prototype.checkValid=function(){if(1===arguments.length){for(var t=arguments[0],e=0;e<this._testCoords.size();e++){var n=this._testCoords.get(e);if(!this.checkValid(t,n))return this._invalidLocation=n,!1}return!0}if(2===arguments.length){var r=arguments[0],i=arguments[1];return this._location[0]=this._locFinder[0].getLocation(i),this._location[1]=this._locFinder[1].getLocation(i),this._location[2]=this._locFinder[2].getLocation(i),!!Li.hasLocation(this._location,A.BOUNDARY)||this.isValidResult(r,this._location)}},Li.prototype.addTestPts=function(t){var e=new Pi(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},Li.prototype.isValidResult=function(t,e){var n=Mi.isResultOfOp(e[0],e[1],t),r=!(n^e[2]===A.INTERIOR);return r||this.reportResult(t,e,n),r},Li.prototype.getInvalidLocation=function(){return this._invalidLocation},Li.prototype.interfaces_=function(){return[]},Li.prototype.getClass=function(){return Li},Li.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1},Li.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Kr.computeSizeBasedSnapTolerance(t),Kr.computeSizeBasedSnapTolerance(e))},Li.isValid=function(t,e,n,r){return new Li(t,e,r).isValid(n)},Ii.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Li,Ii);var ki=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};ki.prototype.extractElements=function(t,e){if(null===t)return null;for(var n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);this._skipEmpty&&r.isEmpty()||e.add(r)}},ki.prototype.combine=function(){for(var t=new St,e=this._inputGeoms.iterator();e.hasNext();){var n=e.next();this.extractElements(n,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},ki.prototype.interfaces_=function(){return[]},ki.prototype.getClass=function(){return ki},ki.combine=function(){if(1===arguments.length)return new ki(arguments[0]).combine();if(2===arguments.length){var t=arguments[0],e=arguments[1];return new ki(ki.createList(t,e)).combine()}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];return new ki(ki.createList(n,r,i)).combine()}},ki.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},ki.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new St;return n.add(t),n.add(e),n}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],a=new St;return a.add(r),a.add(i),a.add(o),a}};var Oi=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new St)},Ri={STRTREE_NODE_CAPACITY:{configurable:!0}};Oi.prototype.reduceToGeometries=function(t){for(var e=new St,n=t.iterator();n.hasNext();){var r=n.next(),i=null;L(r,wt)?i=this.unionTree(r):r instanceof ct&&(i=r),e.add(i)}return e},Oi.prototype.extractByEnvelope=function(t,e,n){for(var r=new St,i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);o.getEnvelopeInternal().intersects(t)?r.add(o):n.add(o)}return this._geomFactory.buildGeometry(r)},Oi.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),r=e.getEnvelopeInternal();if(!n.intersects(r))return ki.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var i=n.intersection(r);return this.unionUsingEnvelopeIntersection(t,e,i)},Oi.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new an(Oi.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=t.itemsTree();return this.unionTree(r)},Oi.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var i=Oi.getGeometry(e,n);return this.unionSafe(i,null)}if(r-n==2)return this.unionSafe(Oi.getGeometry(e,n),Oi.getGeometry(e,n+1));var o=Math.trunc((r+n)/2),a=this.binaryUnion(e,n,o),s=this.binaryUnion(e,o,r);return this.unionSafe(a,s)}},Oi.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var r=n.next();e=null===e?r.copy():e.union(r)}return e},Oi.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},Oi.prototype.unionActual=function(t,e){return Oi.restrictToPolygons(t.union(e))},Oi.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},Oi.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var r=new St,i=this.extractByEnvelope(n,t,r),o=this.extractByEnvelope(n,e,r),a=this.unionActual(i,o);return r.add(a),ki.combine(r)},Oi.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().createGeometryCollection([e,n]).buffer(0)}},Oi.prototype.interfaces_=function(){return[]},Oi.prototype.getClass=function(){return Oi},Oi.restrictToPolygons=function(t){if(L(t,Jt))return t;var e=Sr.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(ye.toPolygonArray(e))},Oi.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Oi.union=function(t){return new Oi(t).union()},Ri.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Oi,Ri);var Di=function(){};Di.prototype.interfaces_=function(){return[]},Di.prototype.getClass=function(){return Di},Di.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Mi.createEmptyResult(Mi.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),oi.overlayOp(t,e,Mi.UNION)},t.GeoJSONReader=Se,t.GeoJSONWriter=Ee,t.OverlayOp=Mi,t.UnionOp=Di,t.BufferOp=mr,Object.defineProperty(t,"__esModule",{value:!0})}(e)},3618:e=>{"use strict";e.exports=t},1024:t=>{"use strict";t.exports=e},314:t=>{"use strict";t.exports=n},9479:t=>{"use strict";t.exports=r},2721:t=>{"use strict";t.exports=i},4599:(t,e,n)=>{var r=n(9434).default;function i(){"use strict";t.exports=i=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var e={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function p(t,e,n,r){var i=e&&e.prototype instanceof m?e:m,o=Object.create(i.prototype),s=new A(r||[]);return a(o,"_invoke",{value:E(t,n,s)}),o}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=p;var d={};function m(){}function g(){}function y(){}var v={};h(v,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(P([])));x&&x!==n&&o.call(x,u)&&(v=x);var b=y.prototype=m.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(i,a,s,u){var l=f(t[i],t,a);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==r(h)&&o.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):e.resolve(h).then((function(t){c.value=t,s(c)}),(function(t){return n("throw",t,s,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}})}function E(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=C(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=f(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function C(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,C(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=f(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function M(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function P(t){if(t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:L}}function L(){return{value:void 0,done:!0}}return g.prototype=y,a(b,"constructor",{value:y,configurable:!0}),a(y,"constructor",{value:g,configurable:!0}),g.displayName=h(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,h(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},w(S.prototype),h(S.prototype,l,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new S(p(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),h(b,c,"Generator"),h(b,u,(function(){return this})),h(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=P,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},9434:t=>{function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},5814:(t,e,n)=>{var r=n(4599)();t.exports=r;try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},5495:(t,e,n)=>{"use strict";function r(t,e,n,r,i){var o={};return Object.keys(r).forEach((function(t){o[t]=r[t]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(t,e,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}n.d(e,{Z:()=>r})},3977:(t,e,n)=>{"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}n.d(e,{Z:()=>r})},3058:(t,e,n)=>{"use strict";function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.d(e,{Z:()=>r})},7012:(t,e,n)=>{"use strict";function r(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function s(t){r(a,i,o,s,u,"next",t)}function u(t){r(a,i,o,s,u,"throw",t)}s(void 0)}))}}n.d(e,{Z:()=>i})},5683:(t,e,n)=>{"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,{Z:()=>r})},7016:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(4625);function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function o(t,e,n){return o=i()?Reflect.construct.bind():function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&(0,r.Z)(o,n.prototype),o},o.apply(null,arguments)}},89:(t,e,n)=>{"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}n.d(e,{Z:()=>i})},537:(t,e,n)=>{"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,{Z:()=>r})},3080:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(78);function i(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=(0,r.Z)(t)););return t}function o(){return o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=i(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},o.apply(this,arguments)}},78:(t,e,n)=>{"use strict";function r(t){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}n.d(e,{Z:()=>r})},3285:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(4625);function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&(0,r.Z)(t,e)}},6368:(t,e,n)=>{"use strict";function r(t,e,n,r){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}n.d(e,{Z:()=>r})},1517:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(537);function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}},3321:(t,e,n)=>{"use strict";function r(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}n.d(e,{Z:()=>r})},5963:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(5063),i=n(3058);function o(t,e){if(e&&("object"===(0,r.Z)(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return(0,i.Z)(t)}},4625:(t,e,n)=>{"use strict";function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}n.d(e,{Z:()=>r})},596:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(9423);function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(t,e)||(0,r.Z)(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},92:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(3977),i=n(9423);function o(t){return function(t){if(Array.isArray(t))return(0,r.Z)(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||(0,i.Z)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},5063:(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}n.d(e,{Z:()=>r})},9423:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(3977);function i(t,e){if(t){if("string"==typeof t)return(0,r.Z)(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(t,e):void 0}}},1392:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(78),i=n(4625),o=n(7016);function a(t){var e="function"==typeof Map?new Map:void 0;return a=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,a)}function a(){return(0,o.Z)(t,arguments,(0,r.Z)(this).constructor)}return a.prototype=Object.create(t.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,i.Z)(a,t)},a(t)}},5203:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(3959);function i(t,e){void 0===e&&(e={});var n=Number(t[0]),i=Number(t[1]),o=Number(t[2]),a=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[n,i],u=[n,a],l=[o,a],c=[o,i];return(0,r.yu)([[s,c,l,u,s]],e.properties,{bbox:t,id:e.id})}},2512:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(8912);function i(t){var e=[1/0,1/0,-1/0,-1/0];return(0,r.pZ)(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}i.default=i;const o=i},3959:(t,e,n)=>{"use strict";n.d(e,{DL:()=>f,Ht:()=>g,Tu:()=>u,_R:()=>c,lF:()=>d,ot:()=>h,tw:()=>p,uf:()=>l,vi:()=>m,xm:()=>a,yu:()=>s,zL:()=>o});var r=6371008.8,i={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*r,kilometers:6371.0088,kilometres:6371.0088,meters:r,metres:r,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:r/1852,radians:1,yards:6967335.223679999};function o(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function a(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!y(t[0])||!y(t[1]))throw new Error("coordinates must contain numbers");return o({type:"Point",coordinates:t},e,n)}function s(t,e,n){void 0===n&&(n={});for(var r=0,i=t;r<i.length;r++){var a=i[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return o({type:"Polygon",coordinates:t},e,n)}function u(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return o({type:"LineString",coordinates:t},e,n)}function l(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function c(t,e,n){return void 0===n&&(n={}),o({type:"MultiLineString",coordinates:t},e,n)}function h(t,e,n){return void 0===n&&(n={}),o({type:"MultiPoint",coordinates:t},e,n)}function p(t,e,n){return void 0===n&&(n={}),o({type:"MultiPolygon",coordinates:t},e,n)}function f(t,e){void 0===e&&(e="kilometers");var n=i[e];if(!n)throw new Error(e+" units is invalid");return t*n}function d(t,e){void 0===e&&(e="kilometers");var n=i[e];if(!n)throw new Error(e+" units is invalid");return t/n}function m(t){return t%(2*Math.PI)*180/Math.PI}function g(t){return t%360*Math.PI/180}function y(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}},601:(t,e,n)=>{"use strict";function r(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function i(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function o(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}function a(t){return"Feature"===t.type?t.geometry:t}function s(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}n.d(e,{c9:()=>r,nK:()=>o,oL:()=>s,r7:()=>i,wA:()=>a}),n(3959)},8912:(t,e,n)=>{"use strict";n.d(e,{Lo:()=>o,mm:()=>s,nG:()=>u,pZ:()=>i});var r=n(3959);function i(t,e,n){if(null!==t)for(var r,o,a,s,u,l,c,h,p=0,f=0,d=t.type,m="FeatureCollection"===d,g="Feature"===d,y=m?t.features.length:1,v=0;v<y;v++){u=(h=!!(c=m?t.features[v].geometry:g?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<u;_++){var x=0,b=0;if(null!==(s=h?c.geometries[_]:c)){l=s.coordinates;var w=s.type;switch(p=!n||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===e(l,f,v,x,b))return!1;f++,x++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===e(l[r],f,v,x,b))return!1;f++,"MultiPoint"===w&&x++}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(o=0;o<l[r].length-p;o++){if(!1===e(l[r][o],f,v,x,b))return!1;f++}"MultiLineString"===w&&x++,"Polygon"===w&&b++}"Polygon"===w&&x++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(b=0,o=0;o<l[r].length;o++){for(a=0;a<l[r][o].length-p;a++){if(!1===e(l[r][o][a],f,v,x,b))return!1;f++}b++}x++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===i(s.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(t,e,n,r){var o=n;return i(t,(function(t,r,i,a,s){o=0===r&&void 0===n?t:e(o,t,r,i,a,s)}),r),o}function a(t,e){var n,r,i,o,a,s,u,l,c,h,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,m=f?t.features.length:1;for(n=0;n<m;n++){for(s=f?t.features[n].geometry:d?t.geometry:t,l=f?t.features[n].properties:d?t.properties:{},c=f?t.features[n].bbox:d?t.bbox:void 0,h=f?t.features[n].id:d?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,l,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],p,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,l,c,h))return!1;p++}}function s(t,e,n){var r=n;return a(t,(function(t,i,o,a,s){r=0===i&&void 0===n?t:e(r,t,i,o,a,s)})),r}function u(t,e){a(t,(function(t,n,i,o,a){var s,u=null===t?null:t.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==e((0,r.zL)(t,i,{bbox:o,id:a}),n,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<t.coordinates.length;l++){var c={type:s,coordinates:t.coordinates[l]};if(!1===e((0,r.zL)(c,i),n,l))return!1}}))}},1691:(t,e,n)=>{"use strict";n.d(e,{ZP:()=>o});var r=n(3959),i=n(601);function o(t,e){void 0===e&&(e={});var n=(0,i.wA)(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),n.type){case"Polygon":return function(t,e){return void 0===e&&(e={}),a((0,i.wA)(t).coordinates,e.properties?e.properties:"Feature"===t.type?t.properties:{})}(n,e);case"MultiPolygon":return function(t,e){void 0===e&&(e={});var n=(0,i.wA)(t).coordinates,o=e.properties?e.properties:"Feature"===t.type?t.properties:{},s=[];return n.forEach((function(t){s.push(a(t,o))})),(0,r.uf)(s)}(n,e);default:throw new Error("invalid poly")}}function a(t,e){return t.length>1?(0,r._R)(t,e):(0,r.Tu)(t[0],e)}},9349:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(7516),i=n(601),o=n(3959);const a=function(t,e,n){void 0===n&&(n={});var a=(0,i.wA)(t),s=(0,i.wA)(e),u=r.union(a.coordinates,s.coordinates);return 0===u.length?null:1===u.length?(0,o.yu)(u[0],n.properties):(0,o.tw)(u,n.properties)}},3057:(t,e,n)=>{"use strict";n.r(e),n.d(e,{add:()=>S,after:()=>N,ary:()=>oe,assign:()=>Xe,assignIn:()=>$e,assignInWith:()=>en,assignWith:()=>rn,at:()=>Bn,attempt:()=>Yn,before:()=>Kn,bind:()=>Jn,bindAll:()=>$n,bindKey:()=>er,camelCase:()=>Kr,capitalize:()=>_r,castArray:()=>Qr,ceil:()=>ei,chain:()=>ni,chunk:()=>oi,clamp:()=>si,clone:()=>ro,cloneDeep:()=>io,cloneDeepWith:()=>oo,cloneWith:()=>ao,commit:()=>so,compact:()=>uo,concat:()=>lo,cond:()=>Bo,conforms:()=>Uo,conformsTo:()=>Zo,constant:()=>Rt,countBy:()=>Jo,create:()=>$o,curry:()=>ea,curryRight:()=>ra,debounce:()=>sa,deburr:()=>Cr,default:()=>ed,defaultTo:()=>ua,defaults:()=>pa,defaultsDeep:()=>ba,defer:()=>Ea,delay:()=>Ma,difference:()=>Pa,differenceBy:()=>Ia,differenceWith:()=>ka,divide:()=>Oa,drop:()=>Ra,dropRight:()=>Da,dropRightWhile:()=>Fa,dropWhile:()=>za,each:()=>ja,eachRight:()=>Ha,endsWith:()=>Wa,entries:()=>Xa,entriesIn:()=>Ya,eq:()=>se,escape:()=>$a,escapeRegExp:()=>ns,every:()=>os,extend:()=>$e,extendWith:()=>en,fill:()=>ss,filter:()=>ls,find:()=>fs,findIndex:()=>ps,findKey:()=>ms,findLast:()=>_s,findLastIndex:()=>vs,findLastKey:()=>xs,first:()=>bs,flatMap:()=>Es,flatMapDeep:()=>Cs,flatMapDepth:()=>Ms,flatten:()=>Fn,flattenDeep:()=>Ts,flattenDepth:()=>As,flip:()=>Ps,floor:()=>Ls,flow:()=>ks,flowRight:()=>Os,forEach:()=>ja,forEachRight:()=>Ha,forIn:()=>Rs,forInRight:()=>Ds,forOwn:()=>Ns,forOwnRight:()=>Fs,fromPairs:()=>zs,functions:()=>js,functionsIn:()=>Us,get:()=>In,groupBy:()=>Vs,gt:()=>Ws,gte:()=>qs,has:()=>Ks,hasIn:()=>Ro,head:()=>bs,identity:()=>F,inRange:()=>$s,includes:()=>iu,indexOf:()=>au,initial:()=>su,intersection:()=>hu,intersectionBy:()=>pu,intersectionWith:()=>fu,invert:()=>gu,invertBy:()=>xu,invoke:()=>Su,invokeMap:()=>Eu,isArguments:()=>Ce,isArray:()=>v,isArrayBuffer:()=>Mu,isArrayLike:()=>me,isArrayLikeObject:()=>da,isBoolean:()=>Tu,isBuffer:()=>Le,isDate:()=>Pu,isElement:()=>Lu,isEmpty:()=>ku,isEqual:()=>Ou,isEqualWith:()=>Ru,isError:()=>qn,isFinite:()=>Nu,isFunction:()=>z,isInteger:()=>Fu,isLength:()=>de,isMap:()=>Ki,isMatch:()=>zu,isMatchWith:()=>Bu,isNaN:()=>Uu,isNative:()=>Vu,isNil:()=>Gu,isNull:()=>Hu,isNumber:()=>ju,isObject:()=>A,isObjectLike:()=>d,isPlainObject:()=>Wn,isRegExp:()=>qu,isSafeInteger:()=>Xu,isSet:()=>Ji,isString:()=>tu,isSymbol:()=>m,isTypedArray:()=>ze,isUndefined:()=>Yu,isWeakMap:()=>Ku,isWeakSet:()=>Qu,iteratee:()=>Ju,join:()=>tl,kebabCase:()=>el,keyBy:()=>nl,keys:()=>He,keysIn:()=>Qe,last:()=>La,lastIndexOf:()=>ol,lodash:()=>Mt,lowerCase:()=>al,lowerFirst:()=>sl,lt:()=>ll,lte:()=>cl,map:()=>Ss,mapKeys:()=>hl,mapValues:()=>pl,matches:()=>fl,matchesProperty:()=>dl,max:()=>gl,maxBy:()=>yl,mean:()=>xl,meanBy:()=>bl,memoize:()=>wn,merge:()=>Sl,mergeWith:()=>xa,method:()=>El,methodOf:()=>Cl,min:()=>Ml,minBy:()=>Tl,mixin:()=>Al,multiply:()=>Pl,negate:()=>Ll,next:()=>Ol,noop:()=>dt,now:()=>ia,nth:()=>Dl,nthArg:()=>Nl,omit:()=>Bl,omitBy:()=>Vl,once:()=>Gl,orderBy:()=>ql,over:()=>Yl,overArgs:()=>$l,overEvery:()=>tc,overSome:()=>ec,pad:()=>_c,padEnd:()=>xc,padStart:()=>bc,parseInt:()=>Ec,partial:()=>Mc,partialRight:()=>Ac,partition:()=>Pc,pick:()=>Lc,pickBy:()=>Zl,plant:()=>Ic,property:()=>Fo,propertyOf:()=>kc,pull:()=>Fc,pullAll:()=>Nc,pullAllBy:()=>zc,pullAllWith:()=>Bc,pullAt:()=>Zc,random:()=>Yc,range:()=>$c,rangeRight:()=>th,rearg:()=>nh,reduce:()=>ih,reduceRight:()=>ah,reject:()=>sh,remove:()=>uh,repeat:()=>lh,replace:()=>ch,rest:()=>hh,result:()=>ph,reverse:()=>dh,round:()=>mh,sample:()=>vh,sampleSize:()=>wh,set:()=>Sh,setWith:()=>Eh,shuffle:()=>Th,size:()=>Ah,slice:()=>Ph,snakeCase:()=>Lh,some:()=>kh,sortBy:()=>Oh,sortedIndex:()=>zh,sortedIndexBy:()=>Bh,sortedIndexOf:()=>jh,sortedLastIndex:()=>Uh,sortedLastIndexBy:()=>Zh,sortedLastIndexOf:()=>Vh,sortedUniq:()=>Hh,sortedUniqBy:()=>Wh,split:()=>qh,spread:()=>Yh,startCase:()=>Kh,startsWith:()=>Qh,stubArray:()=>yi,stubFalse:()=>Me,stubObject:()=>Jh,stubString:()=>$h,stubTrue:()=>tp,subtract:()=>ep,sum:()=>np,sumBy:()=>rp,tail:()=>ip,take:()=>op,takeRight:()=>ap,takeRightWhile:()=>sp,takeWhile:()=>up,tap:()=>lp,template:()=>Cp,templateSettings:()=>gp,throttle:()=>Mp,thru:()=>Tp,times:()=>Lp,toArray:()=>kl,toFinite:()=>R,toInteger:()=>D,toIterator:()=>Ip,toJSON:()=>Op,toLength:()=>as,toLower:()=>Rp,toNumber:()=>O,toPairs:()=>Xa,toPairsIn:()=>Ya,toPath:()=>Dp,toPlainObject:()=>ga,toSafeInteger:()=>Np,toString:()=>Tn,toUpper:()=>Fp,transform:()=>zp,trim:()=>Up,trimEnd:()=>Zp,trimStart:()=>Gp,truncate:()=>Wp,unary:()=>qp,unescape:()=>Qp,union:()=>tf,unionBy:()=>ef,unionWith:()=>nf,uniq:()=>rf,uniqBy:()=>of,uniqWith:()=>af,uniqueId:()=>uf,unset:()=>lf,unzip:()=>hf,unzipWith:()=>pf,update:()=>df,updateWith:()=>mf,upperCase:()=>gf,upperFirst:()=>vr,value:()=>Op,valueOf:()=>Op,values:()=>nu,valuesIn:()=>yf,without:()=>vf,words:()=>qr,wrap:()=>_f,wrapperAt:()=>xf,wrapperChain:()=>bf,wrapperCommit:()=>so,wrapperLodash:()=>Mt,wrapperNext:()=>Ol,wrapperPlant:()=>Ic,wrapperReverse:()=>wf,wrapperToIterator:()=>Ip,wrapperValue:()=>Op,xor:()=>Ef,xorBy:()=>Cf,xorWith:()=>Mf,zip:()=>Tf,zipObject:()=>Pf,zipObjectDeep:()=>Lf,zipWith:()=>If});const r="object"==typeof global&&global&&global.Object===Object&&global;var i="object"==typeof self&&self&&self.Object===Object&&self;const o=r||i||Function("return this")(),a=o.Symbol;var s=Object.prototype,u=s.hasOwnProperty,l=s.toString,c=a?a.toStringTag:void 0;var h=Object.prototype.toString;var p=a?a.toStringTag:void 0;const f=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":p&&p in Object(t)?function(t){var e=u.call(t,c),n=t[c];try{t[c]=void 0;var r=!0}catch(t){}var i=l.call(t);return r&&(e?t[c]=n:delete t[c]),i}(t):function(t){return h.call(t)}(t)},d=function(t){return null!=t&&"object"==typeof t},m=function(t){return"symbol"==typeof t||d(t)&&"[object Symbol]"==f(t)},g=function(t){return"number"==typeof t?t:m(t)?NaN:+t},y=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i},v=Array.isArray;var _=a?a.prototype:void 0,x=_?_.toString:void 0;const b=function t(e){if("string"==typeof e)return e;if(v(e))return y(e,t)+"";if(m(e))return x?x.call(e):"";var n=e+"";return"0"==n&&1/e==-1/0?"-0":n},w=function(t,e){return function(n,r){var i;if(void 0===n&&void 0===r)return e;if(void 0!==n&&(i=n),void 0!==r){if(void 0===i)return r;"string"==typeof n||"string"==typeof r?(n=b(n),r=b(r)):(n=g(n),r=g(r)),i=t(n,r)}return i}},S=w((function(t,e){return t+e}),0);var E=/\s/;const C=function(t){for(var e=t.length;e--&&E.test(t.charAt(e)););return e};var M=/^\s+/;const T=function(t){return t?t.slice(0,C(t)+1).replace(M,""):t},A=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var P=/^[-+]0x[0-9a-f]+$/i,L=/^0b[01]+$/i,I=/^0o[0-7]+$/i,k=parseInt;const O=function(t){if("number"==typeof t)return t;if(m(t))return NaN;if(A(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=A(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=T(t);var n=L.test(t);return n||I.test(t)?k(t.slice(2),n?2:8):P.test(t)?NaN:+t};const R=function(t){return t?Infinity===(t=O(t))||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},D=function(t){var e=R(t),n=e%1;return e==e?n?e-n:e:0},N=function(t,e){if("function"!=typeof e)throw new TypeError("Expected a function");return t=D(t),function(){if(--t<1)return e.apply(this,arguments)}},F=function(t){return t},z=function(t){if(!A(t))return!1;var e=f(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},B=o["__core-js_shared__"];var j,U=(j=/[^.]+$/.exec(B&&B.keys&&B.keys.IE_PROTO||""))?"Symbol(src)_1."+j:"";var Z=Function.prototype.toString;const V=function(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""};var G=/^\[object .+?Constructor\]$/,H=Function.prototype,W=Object.prototype,q=H.toString,X=W.hasOwnProperty,Y=RegExp("^"+q.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const K=function(t){return!(!A(t)||function(t){return!!U&&U in t}(t))&&(z(t)?Y:G).test(V(t))},Q=function(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return K(n)?n:void 0},J=Q(o,"WeakMap"),$=J&&new J;var tt=$?function(t,e){return $.set(t,e),t}:F;const et=tt;var nt=Object.create;const rt=function(){function t(){}return function(e){if(!A(e))return{};if(nt)return nt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),it=function(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=rt(t.prototype),r=t.apply(n,e);return A(r)?r:n}},ot=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)};var at=Math.max;const st=function(t,e,n,r){for(var i=-1,o=t.length,a=n.length,s=-1,u=e.length,l=at(o-a,0),c=Array(u+l),h=!r;++s<u;)c[s]=e[s];for(;++i<a;)(h||i<o)&&(c[n[i]]=t[i]);for(;l--;)c[s++]=t[i++];return c};var ut=Math.max;const lt=function(t,e,n,r){for(var i=-1,o=t.length,a=-1,s=n.length,u=-1,l=e.length,c=ut(o-s,0),h=Array(c+l),p=!r;++i<c;)h[i]=t[i];for(var f=i;++u<l;)h[f+u]=e[u];for(;++a<s;)(p||i<o)&&(h[f+n[a]]=t[i++]);return h},ct=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r},ht=function(){};function pt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}pt.prototype=rt(ht.prototype),pt.prototype.constructor=pt;const ft=pt,dt=function(){};var mt=$?function(t){return $.get(t)}:dt;const gt=mt,yt={};var vt=Object.prototype.hasOwnProperty;const _t=function(t){for(var e=t.name+"",n=yt[e],r=vt.call(yt,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e};function xt(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}xt.prototype=rt(ht.prototype),xt.prototype.constructor=xt;const bt=xt,wt=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e},St=function(t){if(t instanceof ft)return t.clone();var e=new bt(t.__wrapped__,t.__chain__);return e.__actions__=wt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e};var Et=Object.prototype.hasOwnProperty;function Ct(t){if(d(t)&&!v(t)&&!(t instanceof ft)){if(t instanceof bt)return t;if(Et.call(t,"__wrapped__"))return St(t)}return new bt(t)}Ct.prototype=ht.prototype,Ct.prototype.constructor=Ct;const Mt=Ct,Tt=function(t){var e=_t(t),n=Mt[e];if("function"!=typeof n||!(e in ft.prototype))return!1;if(t===n)return!0;var r=gt(n);return!!r&&t===r[0]};var At=Date.now;const Pt=function(t){var e=0,n=0;return function(){var r=At(),i=16-(r-n);if(n=r,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}},Lt=Pt(et);var It=/\{\n\/\* \[wrapped with (.+)\] \*/,kt=/,? & /;var Ot=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;const Rt=function(t){return function(){return t}};var Dt=function(){try{var t=Q(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();const Nt=Dt;var Ft=Nt?function(t,e){return Nt(t,"toString",{configurable:!0,enumerable:!1,value:Rt(e),writable:!0})}:F;const zt=Pt(Ft),Bt=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t},jt=function(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1},Ut=function(t){return t!=t},Zt=function(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):jt(t,Ut,n)},Vt=function(t,e){return!(null==t||!t.length)&&Zt(t,e,0)>-1};var Gt=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];const Ht=function(t,e,n){var r=e+"";return zt(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(Ot,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Bt(Gt,(function(n){var r="_."+n[0];e&n[1]&&!Vt(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(It);return e?e[1].split(kt):[]}(r),n)))},Wt=function(t,e,n,r,i,o,a,s,u,l){var c=8&e;e|=c?32:64,4&(e&=~(c?64:32))||(e&=-4);var h=[t,e,i,c?o:void 0,c?a:void 0,c?void 0:o,c?void 0:a,s,u,l],p=n.apply(void 0,h);return Tt(t)&&Lt(p,h),p.placeholder=r,Ht(p,t,e)},qt=function(t){return t.placeholder};var Xt=/^(?:0|[1-9]\d*)$/;const Yt=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Xt.test(t))&&t>-1&&t%1==0&&t<e};var Kt=Math.min;const Qt=function(t,e){for(var n=t.length,r=Kt(e.length,n),i=wt(t);r--;){var o=e[r];t[r]=Yt(o,n)?i[o]:void 0}return t};var Jt="__lodash_placeholder__";const $t=function(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];a!==e&&a!==Jt||(t[n]=Jt,o[i++]=n)}return o},te=function t(e,n,r,i,a,s,u,l,c,h){var p=128&n,f=1&n,d=2&n,m=24&n,g=512&n,y=d?void 0:it(e);return function v(){for(var _=arguments.length,x=Array(_),b=_;b--;)x[b]=arguments[b];if(m)var w=qt(v),S=ct(x,w);if(i&&(x=st(x,i,a,m)),s&&(x=lt(x,s,u,m)),_-=S,m&&_<h){var E=$t(x,w);return Wt(e,n,t,v.placeholder,r,x,E,l,c,h-_)}var C=f?r:this,M=d?C[e]:e;return _=x.length,l?x=Qt(x,l):g&&_>1&&x.reverse(),p&&c<_&&(x.length=c),this&&this!==o&&this instanceof v&&(M=y||it(M)),M.apply(C,x)}};var ee="__lodash_placeholder__",ne=Math.min;var re=Math.max;const ie=function(t,e,n,r,i,a,s,u){var l=2&e;if(!l&&"function"!=typeof t)throw new TypeError("Expected a function");var c=r?r.length:0;if(c||(e&=-97,r=i=void 0),s=void 0===s?s:re(D(s),0),u=void 0===u?u:D(u),c-=i?i.length:0,64&e){var h=r,p=i;r=i=void 0}var f=l?void 0:gt(t),d=[t,e,n,r,i,h,p,a,s,u];if(f&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=128==r&&8==n||128==r&&256==n&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var s=e[3];if(s){var u=t[3];t[3]=u?st(u,s,e[4]):s,t[4]=u?$t(t[3],ee):e[4]}(s=e[5])&&(u=t[5],t[5]=u?lt(u,s,e[6]):s,t[6]=u?$t(t[5],ee):e[6]),(s=e[7])&&(t[7]=s),128&r&&(t[8]=null==t[8]?e[8]:ne(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i}(d,f),t=d[0],e=d[1],n=d[2],r=d[3],i=d[4],!(u=d[9]=void 0===d[9]?l?0:t.length:re(d[9]-c,0))&&24&e&&(e&=-25),e&&1!=e)m=8==e||16==e?function(t,e,n){var r=it(t);return function i(){for(var a=arguments.length,s=Array(a),u=a,l=qt(i);u--;)s[u]=arguments[u];var c=a<3&&s[0]!==l&&s[a-1]!==l?[]:$t(s,l);return(a-=c.length)<n?Wt(t,e,te,i.placeholder,void 0,s,c,void 0,void 0,n-a):ot(this&&this!==o&&this instanceof i?r:t,this,s)}}(t,e,u):32!=e&&33!=e||i.length?te.apply(void 0,d):function(t,e,n,r){var i=1&e,a=it(t);return function e(){for(var s=-1,u=arguments.length,l=-1,c=r.length,h=Array(c+u),p=this&&this!==o&&this instanceof e?a:t;++l<c;)h[l]=r[l];for(;u--;)h[l++]=arguments[++s];return ot(p,i?n:this,h)}}(t,e,n,r);else var m=function(t,e,n){var r=1&e,i=it(t);return function e(){return(this&&this!==o&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,n);return Ht((f?et:Lt)(m,d),t,e)},oe=function(t,e,n){return e=n?void 0:e,e=t&&null==e?t.length:e,ie(t,128,void 0,void 0,void 0,void 0,e)},ae=function(t,e,n){"__proto__"==e&&Nt?Nt(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},se=function(t,e){return t===e||t!=t&&e!=e};var ue=Object.prototype.hasOwnProperty;const le=function(t,e,n){var r=t[e];ue.call(t,e)&&se(r,n)&&(void 0!==n||e in t)||ae(t,e,n)},ce=function(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],u=r?r(n[s],t[s],s,n,t):void 0;void 0===u&&(u=t[s]),i?ae(n,s,u):le(n,s,u)}return n};var he=Math.max;const pe=function(t,e,n){return e=he(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=he(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),ot(t,this,s)}},fe=function(t,e){return zt(pe(t,e,F),t+"")},de=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},me=function(t){return null!=t&&de(t.length)&&!z(t)},ge=function(t,e,n){if(!A(n))return!1;var r=typeof e;return!!("number"==r?me(n)&&Yt(e,n.length):"string"==r&&e in n)&&se(n[e],t)},ye=function(t){return fe((function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(i--,o):void 0,a&&ge(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),e=Object(e);++r<i;){var s=n[r];s&&t(e,s,r,o)}return e}))};var ve=Object.prototype;const _e=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ve)},xe=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},be=function(t){return d(t)&&"[object Arguments]"==f(t)};var we=Object.prototype,Se=we.hasOwnProperty,Ee=we.propertyIsEnumerable;const Ce=be(function(){return arguments}())?be:function(t){return d(t)&&Se.call(t,"callee")&&!Ee.call(t,"callee")},Me=function(){return!1};var Te="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ae=Te&&"object"==typeof module&&module&&!module.nodeType&&module,Pe=Ae&&Ae.exports===Te?o.Buffer:void 0;const Le=(Pe?Pe.isBuffer:void 0)||Me;var Ie={};Ie["[object Float32Array]"]=Ie["[object Float64Array]"]=Ie["[object Int8Array]"]=Ie["[object Int16Array]"]=Ie["[object Int32Array]"]=Ie["[object Uint8Array]"]=Ie["[object Uint8ClampedArray]"]=Ie["[object Uint16Array]"]=Ie["[object Uint32Array]"]=!0,Ie["[object Arguments]"]=Ie["[object Array]"]=Ie["[object ArrayBuffer]"]=Ie["[object Boolean]"]=Ie["[object DataView]"]=Ie["[object Date]"]=Ie["[object Error]"]=Ie["[object Function]"]=Ie["[object Map]"]=Ie["[object Number]"]=Ie["[object Object]"]=Ie["[object RegExp]"]=Ie["[object Set]"]=Ie["[object String]"]=Ie["[object WeakMap]"]=!1;const ke=function(t){return function(e){return t(e)}};var Oe="object"==typeof exports&&exports&&!exports.nodeType&&exports,Re=Oe&&"object"==typeof module&&module&&!module.nodeType&&module,De=Re&&Re.exports===Oe&&r.process;const Ne=function(){try{return Re&&Re.require&&Re.require("util").types||De&&De.binding&&De.binding("util")}catch(t){}}();var Fe=Ne&&Ne.isTypedArray;const ze=Fe?ke(Fe):function(t){return d(t)&&de(t.length)&&!!Ie[f(t)]};var Be=Object.prototype.hasOwnProperty;const je=function(t,e){var n=v(t),r=!n&&Ce(t),i=!n&&!r&&Le(t),o=!n&&!r&&!i&&ze(t),a=n||r||i||o,s=a?xe(t.length,String):[],u=s.length;for(var l in t)!e&&!Be.call(t,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Yt(l,u))||s.push(l);return s},Ue=function(t,e){return function(n){return t(e(n))}},Ze=Ue(Object.keys,Object);var Ve=Object.prototype.hasOwnProperty;const Ge=function(t){if(!_e(t))return Ze(t);var e=[];for(var n in Object(t))Ve.call(t,n)&&"constructor"!=n&&e.push(n);return e},He=function(t){return me(t)?je(t):Ge(t)};var We=Object.prototype.hasOwnProperty,qe=ye((function(t,e){if(_e(e)||me(e))ce(e,He(e),t);else for(var n in e)We.call(e,n)&&le(t,n,e[n])}));const Xe=qe;var Ye=Object.prototype.hasOwnProperty;const Ke=function(t){if(!A(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=_e(t),n=[];for(var r in t)("constructor"!=r||!e&&Ye.call(t,r))&&n.push(r);return n},Qe=function(t){return me(t)?je(t,!0):Ke(t)};var Je=ye((function(t,e){ce(e,Qe(e),t)}));const $e=Je;var tn=ye((function(t,e,n,r){ce(e,Qe(e),t,r)}));const en=tn;var nn=ye((function(t,e,n,r){ce(e,He(e),t,r)}));const rn=nn;var on=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,an=/^\w*$/;const sn=function(t,e){if(v(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!m(t))||an.test(t)||!on.test(t)||null!=e&&t in Object(e)},un=Q(Object,"create");var ln=Object.prototype.hasOwnProperty;var cn=Object.prototype.hasOwnProperty;function hn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}hn.prototype.clear=function(){this.__data__=un?un(null):{},this.size=0},hn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},hn.prototype.get=function(t){var e=this.__data__;if(un){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return ln.call(e,t)?e[t]:void 0},hn.prototype.has=function(t){var e=this.__data__;return un?void 0!==e[t]:cn.call(e,t)},hn.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=un&&void 0===e?"__lodash_hash_undefined__":e,this};const pn=hn,fn=function(t,e){for(var n=t.length;n--;)if(se(t[n][0],e))return n;return-1};var dn=Array.prototype.splice;function mn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}mn.prototype.clear=function(){this.__data__=[],this.size=0},mn.prototype.delete=function(t){var e=this.__data__,n=fn(e,t);return!(n<0||(n==e.length-1?e.pop():dn.call(e,n,1),--this.size,0))},mn.prototype.get=function(t){var e=this.__data__,n=fn(e,t);return n<0?void 0:e[n][1]},mn.prototype.has=function(t){return fn(this.__data__,t)>-1},mn.prototype.set=function(t,e){var n=this.__data__,r=fn(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};const gn=mn,yn=Q(o,"Map"),vn=function(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map};function _n(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}_n.prototype.clear=function(){this.size=0,this.__data__={hash:new pn,map:new(yn||gn),string:new pn}},_n.prototype.delete=function(t){var e=vn(this,t).delete(t);return this.size-=e?1:0,e},_n.prototype.get=function(t){return vn(this,t).get(t)},_n.prototype.has=function(t){return vn(this,t).has(t)},_n.prototype.set=function(t,e){var n=vn(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};const xn=_n;function bn(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(bn.Cache||xn),n}bn.Cache=xn;const wn=bn;var Sn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,En=/\\(\\)?/g,Cn=function(t){var e=wn(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Sn,(function(t,n,r,i){e.push(r?i.replace(En,"$1"):n||t)})),e}));const Mn=Cn,Tn=function(t){return null==t?"":b(t)},An=function(t,e){return v(t)?t:sn(t,e)?[t]:Mn(Tn(t))},Pn=function(t){if("string"==typeof t||m(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e},Ln=function(t,e){for(var n=0,r=(e=An(e,t)).length;null!=t&&n<r;)t=t[Pn(e[n++])];return n&&n==r?t:void 0},In=function(t,e,n){var r=null==t?void 0:Ln(t,e);return void 0===r?n:r},kn=function(t,e){for(var n=-1,r=e.length,i=Array(r),o=null==t;++n<r;)i[n]=o?void 0:In(t,e[n]);return i},On=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t};var Rn=a?a.isConcatSpreadable:void 0;const Dn=function(t){return v(t)||Ce(t)||!!(Rn&&t&&t[Rn])},Nn=function t(e,n,r,i,o){var a=-1,s=e.length;for(r||(r=Dn),o||(o=[]);++a<s;){var u=e[a];n>0&&r(u)?n>1?t(u,n-1,r,i,o):On(o,u):i||(o[o.length]=u)}return o},Fn=function(t){return null!=t&&t.length?Nn(t,1):[]},zn=function(t){return zt(pe(t,void 0,Fn),t+"")},Bn=zn(kn),jn=Ue(Object.getPrototypeOf,Object);var Un=Function.prototype,Zn=Object.prototype,Vn=Un.toString,Gn=Zn.hasOwnProperty,Hn=Vn.call(Object);const Wn=function(t){if(!d(t)||"[object Object]"!=f(t))return!1;var e=jn(t);if(null===e)return!0;var n=Gn.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Vn.call(n)==Hn},qn=function(t){if(!d(t))return!1;var e=f(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!Wn(t)};var Xn=fe((function(t,e){try{return ot(t,void 0,e)}catch(t){return qn(t)?t:new Error(t)}}));const Yn=Xn,Kn=function(t,e){var n;if("function"!=typeof e)throw new TypeError("Expected a function");return t=D(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=void 0),n}};var Qn=fe((function(t,e,n){var r=1;if(n.length){var i=$t(n,qt(Qn));r|=32}return ie(t,r,e,n,i)}));Qn.placeholder={};const Jn=Qn,$n=zn((function(t,e){return Bt(e,(function(e){e=Pn(e),ae(t,e,Jn(t[e],t))})),t}));var tr=fe((function(t,e,n){var r=3;if(n.length){var i=$t(n,qt(tr));r|=32}return ie(e,r,t,n,i)}));tr.placeholder={};const er=tr,nr=function(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o},rr=function(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:nr(t,e,n)};var ir=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");const or=function(t){return ir.test(t)};var ar="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",sr="\\ud83c[\\udffb-\\udfff]",ur="[^\\ud800-\\udfff]",lr="(?:\\ud83c[\\udde6-\\uddff]){2}",cr="[\\ud800-\\udbff][\\udc00-\\udfff]",hr="(?:"+ar+"|"+sr+")?",pr="[\\ufe0e\\ufe0f]?",fr=pr+hr+"(?:\\u200d(?:"+[ur,lr,cr].join("|")+")"+pr+hr+")*",dr="(?:"+[ur+ar+"?",ar,lr,cr,"[\\ud800-\\udfff]"].join("|")+")",mr=RegExp(sr+"(?="+sr+")|"+dr+fr,"g");const gr=function(t){return or(t)?function(t){return t.match(mr)||[]}(t):function(t){return t.split("")}(t)},yr=function(t){return function(e){e=Tn(e);var n=or(e)?gr(e):void 0,r=n?n[0]:e.charAt(0),i=n?rr(n,1).join(""):e.slice(1);return r[t]()+i}},vr=yr("toUpperCase"),_r=function(t){return vr(Tn(t).toLowerCase())},xr=function(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n},br=function(t){return function(e){return null==t?void 0:t[e]}},wr=br({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"});var Sr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Er=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");const Cr=function(t){return(t=Tn(t))&&t.replace(Sr,wr).replace(Er,"")};var Mr=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var Tr=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var Ar="a-z\\xdf-\\xf6\\xf8-\\xff",Pr="A-Z\\xc0-\\xd6\\xd8-\\xde",Lr="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ir="["+Lr+"]",kr="\\d+",Or="["+Ar+"]",Rr="[^\\ud800-\\udfff"+Lr+kr+"\\u2700-\\u27bf"+Ar+Pr+"]",Dr="(?:\\ud83c[\\udde6-\\uddff]){2}",Nr="[\\ud800-\\udbff][\\udc00-\\udfff]",Fr="["+Pr+"]",zr="(?:"+Or+"|"+Rr+")",Br="(?:"+Fr+"|"+Rr+")",jr="(?:['’](?:d|ll|m|re|s|t|ve))?",Ur="(?:['’](?:D|LL|M|RE|S|T|VE))?",Zr="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",Vr="[\\ufe0e\\ufe0f]?",Gr=Vr+Zr+"(?:\\u200d(?:"+["[^\\ud800-\\udfff]",Dr,Nr].join("|")+")"+Vr+Zr+")*",Hr="(?:"+["[\\u2700-\\u27bf]",Dr,Nr].join("|")+")"+Gr,Wr=RegExp([Fr+"?"+Or+"+"+jr+"(?="+[Ir,Fr,"$"].join("|")+")",Br+"+"+Ur+"(?="+[Ir,Fr+zr,"$"].join("|")+")",Fr+"?"+zr+"+"+jr,Fr+"+"+Ur,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",kr,Hr].join("|"),"g");const qr=function(t,e,n){return t=Tn(t),void 0===(e=n?void 0:e)?function(t){return Tr.test(t)}(t)?function(t){return t.match(Wr)||[]}(t):function(t){return t.match(Mr)||[]}(t):t.match(e)||[]};var Xr=RegExp("['’]","g");const Yr=function(t){return function(e){return xr(qr(Cr(e).replace(Xr,"")),t,"")}};const Kr=Yr((function(t,e,n){return e=e.toLowerCase(),t+(n?_r(e):e)})),Qr=function(){if(!arguments.length)return[];var t=arguments[0];return v(t)?t:[t]};var Jr=o.isFinite,$r=Math.min;const ti=function(t){var e=Math[t];return function(t,n){if(t=O(t),(n=null==n?0:$r(D(n),292))&&Jr(t)){var r=(Tn(t)+"e").split("e"),i=e(r[0]+"e"+(+r[1]+n));return+((r=(Tn(i)+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}},ei=ti("ceil"),ni=function(t){var e=Mt(t);return e.__chain__=!0,e};var ri=Math.ceil,ii=Math.max;const oi=function(t,e,n){e=(n?ge(t,e,n):void 0===e)?1:ii(D(e),0);var r=null==t?0:t.length;if(!r||e<1)return[];for(var i=0,o=0,a=Array(ri(r/e));i<r;)a[o++]=nr(t,i,i+=e);return a},ai=function(t,e,n){return t==t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t},si=function(t,e,n){return void 0===n&&(n=e,e=void 0),void 0!==n&&(n=(n=O(n))==n?n:0),void 0!==e&&(e=(e=O(e))==e?e:0),ai(O(t),e,n)};function ui(t){var e=this.__data__=new gn(t);this.size=e.size}ui.prototype.clear=function(){this.__data__=new gn,this.size=0},ui.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},ui.prototype.get=function(t){return this.__data__.get(t)},ui.prototype.has=function(t){return this.__data__.has(t)},ui.prototype.set=function(t,e){var n=this.__data__;if(n instanceof gn){var r=n.__data__;if(!yn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new xn(r)}return n.set(t,e),this.size=n.size,this};const li=ui,ci=function(t,e){return t&&ce(e,He(e),t)};var hi="object"==typeof exports&&exports&&!exports.nodeType&&exports,pi=hi&&"object"==typeof module&&module&&!module.nodeType&&module,fi=pi&&pi.exports===hi?o.Buffer:void 0,di=fi?fi.allocUnsafe:void 0;const mi=function(t,e){if(e)return t.slice();var n=t.length,r=di?di(n):new t.constructor(n);return t.copy(r),r},gi=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o},yi=function(){return[]};var vi=Object.prototype.propertyIsEnumerable,_i=Object.getOwnPropertySymbols;const xi=_i?function(t){return null==t?[]:(t=Object(t),gi(_i(t),(function(e){return vi.call(t,e)})))}:yi;const bi=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)On(e,xi(t)),t=jn(t);return e}:yi,wi=function(t,e,n){var r=e(t);return v(t)?r:On(r,n(t))},Si=function(t){return wi(t,He,xi)},Ei=function(t){return wi(t,Qe,bi)},Ci=Q(o,"DataView"),Mi=Q(o,"Promise"),Ti=Q(o,"Set");var Ai="[object Map]",Pi="[object Promise]",Li="[object Set]",Ii="[object WeakMap]",ki="[object DataView]",Oi=V(Ci),Ri=V(yn),Di=V(Mi),Ni=V(Ti),Fi=V(J),zi=f;(Ci&&zi(new Ci(new ArrayBuffer(1)))!=ki||yn&&zi(new yn)!=Ai||Mi&&zi(Mi.resolve())!=Pi||Ti&&zi(new Ti)!=Li||J&&zi(new J)!=Ii)&&(zi=function(t){var e=f(t),n="[object Object]"==e?t.constructor:void 0,r=n?V(n):"";if(r)switch(r){case Oi:return ki;case Ri:return Ai;case Di:return Pi;case Ni:return Li;case Fi:return Ii}return e});const Bi=zi;var ji=Object.prototype.hasOwnProperty;const Ui=o.Uint8Array,Zi=function(t){var e=new t.constructor(t.byteLength);return new Ui(e).set(new Ui(t)),e};var Vi=/\w*$/;var Gi=a?a.prototype:void 0,Hi=Gi?Gi.valueOf:void 0;const Wi=function(t,e){var n=e?Zi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)},qi=function(t,e,n){var r,i,o,a=t.constructor;switch(e){case"[object ArrayBuffer]":return Zi(t);case"[object Boolean]":case"[object Date]":return new a(+t);case"[object DataView]":return function(t,e){var n=e?Zi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Wi(t,n);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(t);case"[object RegExp]":return(o=new(i=t).constructor(i.source,Vi.exec(i))).lastIndex=i.lastIndex,o;case"[object Symbol]":return r=t,Hi?Object(Hi.call(r)):{}}},Xi=function(t){return"function"!=typeof t.constructor||_e(t)?{}:rt(jn(t))};var Yi=Ne&&Ne.isMap;const Ki=Yi?ke(Yi):function(t){return d(t)&&"[object Map]"==Bi(t)};var Qi=Ne&&Ne.isSet;const Ji=Qi?ke(Qi):function(t){return d(t)&&"[object Set]"==Bi(t)};var $i="[object Arguments]",to="[object Function]",eo={};eo[$i]=eo["[object Array]"]=eo["[object ArrayBuffer]"]=eo["[object DataView]"]=eo["[object Boolean]"]=eo["[object Date]"]=eo["[object Float32Array]"]=eo["[object Float64Array]"]=eo["[object Int8Array]"]=eo["[object Int16Array]"]=eo["[object Int32Array]"]=eo["[object Map]"]=eo["[object Number]"]=eo["[object Object]"]=eo["[object RegExp]"]=eo["[object Set]"]=eo["[object String]"]=eo["[object Symbol]"]=eo["[object Uint8Array]"]=eo["[object Uint8ClampedArray]"]=eo["[object Uint16Array]"]=eo["[object Uint32Array]"]=!0,eo["[object Error]"]=eo[to]=eo["[object WeakMap]"]=!1;const no=function t(e,n,r,i,o,a){var s,u=1&n,l=2&n,c=4&n;if(r&&(s=o?r(e,i,o,a):r(e)),void 0!==s)return s;if(!A(e))return e;var h=v(e);if(h){if(s=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&ji.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(e),!u)return wt(e,s)}else{var p=Bi(e),f=p==to||"[object GeneratorFunction]"==p;if(Le(e))return mi(e,u);if("[object Object]"==p||p==$i||f&&!o){if(s=l||f?{}:Xi(e),!u)return l?function(t,e){return ce(t,bi(t),e)}(e,function(t,e){return t&&ce(e,Qe(e),t)}(s,e)):function(t,e){return ce(t,xi(t),e)}(e,ci(s,e))}else{if(!eo[p])return o?e:{};s=qi(e,p,u)}}a||(a=new li);var d=a.get(e);if(d)return d;a.set(e,s),Ji(e)?e.forEach((function(i){s.add(t(i,n,r,i,e,a))})):Ki(e)&&e.forEach((function(i,o){s.set(o,t(i,n,r,o,e,a))}));var m=h?void 0:(c?l?Ei:Si:l?Qe:He)(e);return Bt(m||e,(function(i,o){m&&(i=e[o=i]),le(s,o,t(i,n,r,o,e,a))})),s},ro=function(t){return no(t,4)},io=function(t){return no(t,5)},oo=function(t,e){return no(t,5,e="function"==typeof e?e:void 0)},ao=function(t,e){return no(t,4,e="function"==typeof e?e:void 0)},so=function(){return new bt(this.value(),this.__chain__)},uo=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i},lo=function(){var t=arguments.length;if(!t)return[];for(var e=Array(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return On(v(n)?wt(n):[n],Nn(e,1))};function co(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new xn;++e<n;)this.add(t[e])}co.prototype.add=co.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},co.prototype.has=function(t){return this.__data__.has(t)};const ho=co,po=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1},fo=function(t,e){return t.has(e)},mo=function(t,e,n,r,i,o){var a=1&n,s=t.length,u=e.length;if(s!=u&&!(a&&u>s))return!1;var l=o.get(t),c=o.get(e);if(l&&c)return l==e&&c==t;var h=-1,p=!0,f=2&n?new ho:void 0;for(o.set(t,e),o.set(e,t);++h<s;){var d=t[h],m=e[h];if(r)var g=a?r(m,d,h,e,t,o):r(d,m,h,t,e,o);if(void 0!==g){if(g)continue;p=!1;break}if(f){if(!po(e,(function(t,e){if(!fo(f,e)&&(d===t||i(d,t,n,r,o)))return f.push(e)}))){p=!1;break}}else if(d!==m&&!i(d,m,n,r,o)){p=!1;break}}return o.delete(t),o.delete(e),p},go=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n},yo=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n};var vo=a?a.prototype:void 0,_o=vo?vo.valueOf:void 0;var xo=Object.prototype.hasOwnProperty;var bo="[object Arguments]",wo="[object Array]",So="[object Object]",Eo=Object.prototype.hasOwnProperty;const Co=function(t,e,n,r,i,o){var a=v(t),s=v(e),u=a?wo:Bi(t),l=s?wo:Bi(e),c=(u=u==bo?So:u)==So,h=(l=l==bo?So:l)==So,p=u==l;if(p&&Le(t)){if(!Le(e))return!1;a=!0,c=!1}if(p&&!c)return o||(o=new li),a||ze(t)?mo(t,e,n,r,i,o):function(t,e,n,r,i,o,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new Ui(t),new Ui(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return se(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=go;case"[object Set]":var u=1&r;if(s||(s=yo),t.size!=e.size&&!u)return!1;var l=a.get(t);if(l)return l==e;r|=2,a.set(t,e);var c=mo(s(t),s(e),r,i,o,a);return a.delete(t),c;case"[object Symbol]":if(_o)return _o.call(t)==_o.call(e)}return!1}(t,e,u,n,r,i,o);if(!(1&n)){var f=c&&Eo.call(t,"__wrapped__"),d=h&&Eo.call(e,"__wrapped__");if(f||d){var m=f?t.value():t,g=d?e.value():e;return o||(o=new li),i(m,g,n,r,o)}}return!!p&&(o||(o=new li),function(t,e,n,r,i,o){var a=1&n,s=Si(t),u=s.length;if(u!=Si(e).length&&!a)return!1;for(var l=u;l--;){var c=s[l];if(!(a?c in e:xo.call(e,c)))return!1}var h=o.get(t),p=o.get(e);if(h&&p)return h==e&&p==t;var f=!0;o.set(t,e),o.set(e,t);for(var d=a;++l<u;){var m=t[c=s[l]],g=e[c];if(r)var y=a?r(g,m,c,e,t,o):r(m,g,c,t,e,o);if(!(void 0===y?m===g||i(m,g,n,r,o):y)){f=!1;break}d||(d="constructor"==c)}if(f&&!d){var v=t.constructor,_=e.constructor;v==_||!("constructor"in t)||!("constructor"in e)||"function"==typeof v&&v instanceof v&&"function"==typeof _&&_ instanceof _||(f=!1)}return o.delete(t),o.delete(e),f}(t,e,n,r,i,o))},Mo=function t(e,n,r,i,o){return e===n||(null==e||null==n||!d(e)&&!d(n)?e!=e&&n!=n:Co(e,n,r,i,t,o))},To=function(t,e,n,r){var i=n.length,o=i,a=!r;if(null==t)return!o;for(t=Object(t);i--;){var s=n[i];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++i<o;){var u=(s=n[i])[0],l=t[u],c=s[1];if(a&&s[2]){if(void 0===l&&!(u in t))return!1}else{var h=new li;if(r)var p=r(l,c,u,t,e,h);if(!(void 0===p?Mo(c,l,3,r,h):p))return!1}}return!0},Ao=function(t){return t==t&&!A(t)},Po=function(t){for(var e=He(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Ao(i)]}return e},Lo=function(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}},Io=function(t){var e=Po(t);return 1==e.length&&e[0][2]?Lo(e[0][0],e[0][1]):function(n){return n===t||To(n,t,e)}},ko=function(t,e){return null!=t&&e in Object(t)},Oo=function(t,e,n){for(var r=-1,i=(e=An(e,t)).length,o=!1;++r<i;){var a=Pn(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&de(i)&&Yt(a,i)&&(v(t)||Ce(t))},Ro=function(t,e){return null!=t&&Oo(t,e,ko)},Do=function(t,e){return sn(t)&&Ao(e)?Lo(Pn(t),e):function(n){var r=In(n,t);return void 0===r&&r===e?Ro(n,t):Mo(e,r,3)}},No=function(t){return function(e){return null==e?void 0:e[t]}},Fo=function(t){return sn(t)?No(Pn(t)):function(t){return function(e){return Ln(e,t)}}(t)},zo=function(t){return"function"==typeof t?t:null==t?F:"object"==typeof t?v(t)?Do(t[0],t[1]):Io(t):Fo(t)},Bo=function(t){var e=null==t?0:t.length,n=zo;return t=e?y(t,(function(t){if("function"!=typeof t[1])throw new TypeError("Expected a function");return[n(t[0]),t[1]]})):[],fe((function(n){for(var r=-1;++r<e;){var i=t[r];if(ot(i[0],this,n))return ot(i[1],this,n)}}))},jo=function(t,e,n){var r=n.length;if(null==t)return!r;for(t=Object(t);r--;){var i=n[r],o=e[i],a=t[i];if(void 0===a&&!(i in t)||!o(a))return!1}return!0},Uo=function(t){return function(t){var e=He(t);return function(n){return jo(n,t,e)}}(no(t,1))},Zo=function(t,e){return null==e||jo(t,e,He(e))},Vo=function(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r},Go=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}},Ho=Go(),Wo=function(t,e){return t&&Ho(t,e,He)},qo=function(t,e){return function(n,r){if(null==n)return n;if(!me(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Object(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}},Xo=qo(Wo),Yo=function(t,e,n,r){return Xo(t,(function(t,i,o){e(r,t,n(t),o)})),r},Ko=function(t,e){return function(n,r){var i=v(n)?Vo:Yo,o=e?e():{};return i(n,t,zo(r),o)}};var Qo=Object.prototype.hasOwnProperty;const Jo=Ko((function(t,e,n){Qo.call(t,n)?++t[n]:ae(t,n,1)})),$o=function(t,e){var n=rt(t);return null==e?n:ci(n,e)};function ta(t,e,n){var r=ie(t,8,void 0,void 0,void 0,void 0,void 0,e=n?void 0:e);return r.placeholder=ta.placeholder,r}ta.placeholder={};const ea=ta;function na(t,e,n){var r=ie(t,16,void 0,void 0,void 0,void 0,void 0,e=n?void 0:e);return r.placeholder=na.placeholder,r}na.placeholder={};const ra=na,ia=function(){return o.Date.now()};var oa=Math.max,aa=Math.min;const sa=function(t,e,n){var r,i,o,a,s,u,l=0,c=!1,h=!1,p=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function f(e){var n=r,o=i;return r=i=void 0,l=e,a=t.apply(o,n)}function d(t){return l=t,s=setTimeout(g,e),c?f(t):a}function m(t){var n=t-u;return void 0===u||n>=e||n<0||h&&t-l>=o}function g(){var t=ia();if(m(t))return y(t);s=setTimeout(g,function(t){var n=e-(t-u);return h?aa(n,o-(t-l)):n}(t))}function y(t){return s=void 0,p&&r?f(t):(r=i=void 0,a)}function v(){var t=ia(),n=m(t);if(r=arguments,i=this,u=t,n){if(void 0===s)return d(u);if(h)return clearTimeout(s),s=setTimeout(g,e),f(u)}return void 0===s&&(s=setTimeout(g,e)),a}return e=O(e)||0,A(n)&&(c=!!n.leading,o=(h="maxWait"in n)?oa(O(n.maxWait)||0,e):o,p="trailing"in n?!!n.trailing:p),v.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=u=i=s=void 0},v.flush=function(){return void 0===s?a:y(ia())},v},ua=function(t,e){return null==t||t!=t?e:t};var la=Object.prototype,ca=la.hasOwnProperty,ha=fe((function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&ge(e[0],e[1],i)&&(r=1);++n<r;)for(var o=e[n],a=Qe(o),s=-1,u=a.length;++s<u;){var l=a[s],c=t[l];(void 0===c||se(c,la[l])&&!ca.call(t,l))&&(t[l]=o[l])}return t}));const pa=ha,fa=function(t,e,n){(void 0!==n&&!se(t[e],n)||void 0===n&&!(e in t))&&ae(t,e,n)},da=function(t){return d(t)&&me(t)},ma=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},ga=function(t){return ce(t,Qe(t))},ya=function t(e,n,r,i,o){e!==n&&Ho(n,(function(a,s){if(o||(o=new li),A(a))!function(t,e,n,r,i,o,a){var s=ma(t,n),u=ma(e,n),l=a.get(u);if(l)fa(t,n,l);else{var c=o?o(s,u,n+"",t,e,a):void 0,h=void 0===c;if(h){var p=v(u),f=!p&&Le(u),d=!p&&!f&&ze(u);c=u,p||f||d?v(s)?c=s:da(s)?c=wt(s):f?(h=!1,c=mi(u,!0)):d?(h=!1,c=Wi(u,!0)):c=[]:Wn(u)||Ce(u)?(c=s,Ce(s)?c=ga(s):A(s)&&!z(s)||(c=Xi(u))):h=!1}h&&(a.set(u,c),i(c,u,r,o,a),a.delete(u)),fa(t,n,c)}}(e,n,s,r,t,i,o);else{var u=i?i(ma(e,s),a,s+"",e,n,o):void 0;void 0===u&&(u=a),fa(e,s,u)}}),Qe)},va=function t(e,n,r,i,o,a){return A(e)&&A(n)&&(a.set(n,e),ya(e,n,void 0,t,a),a.delete(n)),e};var _a=ye((function(t,e,n,r){ya(t,e,n,r)}));const xa=_a,ba=fe((function(t){return t.push(void 0,va),ot(xa,void 0,t)})),wa=function(t,e,n){if("function"!=typeof t)throw new TypeError("Expected a function");return setTimeout((function(){t.apply(void 0,n)}),e)};var Sa=fe((function(t,e){return wa(t,1,e)}));const Ea=Sa;var Ca=fe((function(t,e,n){return wa(t,O(e)||0,n)}));const Ma=Ca,Ta=function(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1},Aa=function(t,e,n,r){var i=-1,o=Vt,a=!0,s=t.length,u=[],l=e.length;if(!s)return u;n&&(e=y(e,ke(n))),r?(o=Ta,a=!1):e.length>=200&&(o=fo,a=!1,e=new ho(e));t:for(;++i<s;){var c=t[i],h=null==n?c:n(c);if(c=r||0!==c?c:0,a&&h==h){for(var p=l;p--;)if(e[p]===h)continue t;u.push(c)}else o(e,h,r)||u.push(c)}return u};const Pa=fe((function(t,e){return da(t)?Aa(t,Nn(e,1,da,!0)):[]})),La=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0};const Ia=fe((function(t,e){var n=La(e);return da(n)&&(n=void 0),da(t)?Aa(t,Nn(e,1,da,!0),zo(n)):[]}));const ka=fe((function(t,e){var n=La(e);return da(n)&&(n=void 0),da(t)?Aa(t,Nn(e,1,da,!0),void 0,n):[]})),Oa=w((function(t,e){return t/e}),1),Ra=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||void 0===e?1:D(e),nr(t,e<0?0:e,r)):[]},Da=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||void 0===e?1:D(e),nr(t,0,(e=r-e)<0?0:e)):[]},Na=function(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?nr(t,r?0:o,r?o+1:i):nr(t,r?o+1:0,r?i:o)},Fa=function(t,e){return t&&t.length?Na(t,zo(e),!0,!0):[]},za=function(t,e){return t&&t.length?Na(t,zo(e),!0):[]},Ba=function(t){return"function"==typeof t?t:F},ja=function(t,e){return(v(t)?Bt:Xo)(t,Ba(e))},Ua=function(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t},Za=Go(!0),Va=function(t,e){return t&&Za(t,e,He)},Ga=qo(Va,!0),Ha=function(t,e){return(v(t)?Ua:Ga)(t,Ba(e))},Wa=function(t,e,n){t=Tn(t),e=b(e);var r=t.length,i=n=void 0===n?r:ai(D(n),0,r);return(n-=e.length)>=0&&t.slice(n,i)==e},qa=function(t){return function(e){var n,r,i,o=Bi(e);return"[object Map]"==o?go(e):"[object Set]"==o?(n=e,r=-1,i=Array(n.size),n.forEach((function(t){i[++r]=[t,t]})),i):function(t,e){return y(e,(function(e){return[e,t[e]]}))}(e,t(e))}},Xa=qa(He),Ya=qa(Qe),Ka=br({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});var Qa=/[&<>"']/g,Ja=RegExp(Qa.source);const $a=function(t){return(t=Tn(t))&&Ja.test(t)?t.replace(Qa,Ka):t};var ts=/[\\^$.*+?()[\]{}|]/g,es=RegExp(ts.source);const ns=function(t){return(t=Tn(t))&&es.test(t)?t.replace(ts,"\\$&"):t},rs=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0},is=function(t,e){var n=!0;return Xo(t,(function(t,r,i){return n=!!e(t,r,i)})),n},os=function(t,e,n){var r=v(t)?rs:is;return n&&ge(t,e,n)&&(e=void 0),r(t,zo(e))},as=function(t){return t?ai(D(t),0,4294967295):0},ss=function(t,e,n,r){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&ge(t,e,n)&&(n=0,r=i),function(t,e,n,r){var i=t.length;for((n=D(n))<0&&(n=-n>i?0:i+n),(r=void 0===r||r>i?i:D(r))<0&&(r+=i),r=n>r?0:as(r);n<r;)t[n++]=e;return t}(t,e,n,r)):[]},us=function(t,e){var n=[];return Xo(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n},ls=function(t,e){return(v(t)?gi:us)(t,zo(e))},cs=function(t){return function(e,n,r){var i=Object(e);if(!me(e)){var o=zo(n);e=He(e),n=function(t){return o(i[t],t,i)}}var a=t(e,n,r);return a>-1?i[o?e[a]:a]:void 0}};var hs=Math.max;const ps=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:D(n);return i<0&&(i=hs(r+i,0)),jt(t,zo(e),i)},fs=cs(ps),ds=function(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r},ms=function(t,e){return ds(t,zo(e),Wo)};var gs=Math.max,ys=Math.min;const vs=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r-1;return void 0!==n&&(i=D(n),i=n<0?gs(r+i,0):ys(i,r-1)),jt(t,zo(e),i,!0)},_s=cs(vs),xs=function(t,e){return ds(t,zo(e),Va)},bs=function(t){return t&&t.length?t[0]:void 0},ws=function(t,e){var n=-1,r=me(t)?Array(t.length):[];return Xo(t,(function(t,i,o){r[++n]=e(t,i,o)})),r},Ss=function(t,e){return(v(t)?y:ws)(t,zo(e))},Es=function(t,e){return Nn(Ss(t,e),1)},Cs=function(t,e){return Nn(Ss(t,e),1/0)},Ms=function(t,e,n){return n=void 0===n?1:D(n),Nn(Ss(t,e),n)},Ts=function(t){return null!=t&&t.length?Nn(t,1/0):[]},As=function(t,e){return null!=t&&t.length?(e=void 0===e?1:D(e),Nn(t,e)):[]},Ps=function(t){return ie(t,512)},Ls=ti("floor"),Is=function(t){return zn((function(e){var n=e.length,r=n,i=bt.prototype.thru;for(t&&e.reverse();r--;){var o=e[r];if("function"!=typeof o)throw new TypeError("Expected a function");if(i&&!a&&"wrapper"==_t(o))var a=new bt([],!0)}for(r=a?r:n;++r<n;){o=e[r];var s=_t(o),u="wrapper"==s?gt(o):void 0;a=u&&Tt(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?a[_t(u[0])].apply(a,u[3]):1==o.length&&Tt(o)?a[s]():a.thru(o)}return function(){var t=arguments,r=t[0];if(a&&1==t.length&&v(r))return a.plant(r).value();for(var i=0,o=n?e[i].apply(this,t):r;++i<n;)o=e[i].call(this,o);return o}}))},ks=Is(),Os=Is(!0),Rs=function(t,e){return null==t?t:Ho(t,Ba(e),Qe)},Ds=function(t,e){return null==t?t:Za(t,Ba(e),Qe)},Ns=function(t,e){return t&&Wo(t,Ba(e))},Fs=function(t,e){return t&&Va(t,Ba(e))},zs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Bs=function(t,e){return gi(e,(function(e){return z(t[e])}))},js=function(t){return null==t?[]:Bs(t,He(t))},Us=function(t){return null==t?[]:Bs(t,Qe(t))};var Zs=Object.prototype.hasOwnProperty;const Vs=Ko((function(t,e,n){Zs.call(t,n)?t[n].push(e):ae(t,n,[e])})),Gs=function(t,e){return t>e},Hs=function(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=O(e),n=O(n)),t(e,n)}},Ws=Hs(Gs),qs=Hs((function(t,e){return t>=e}));var Xs=Object.prototype.hasOwnProperty;const Ys=function(t,e){return null!=t&&Xs.call(t,e)},Ks=function(t,e){return null!=t&&Oo(t,e,Ys)};var Qs=Math.max,Js=Math.min;const $s=function(t,e,n){return e=R(e),void 0===n?(n=e,e=0):n=R(n),function(t,e,n){return t>=Js(e,n)&&t<Qs(e,n)}(t=O(t),e,n)},tu=function(t){return"string"==typeof t||!v(t)&&d(t)&&"[object String]"==f(t)},eu=function(t,e){return y(e,(function(e){return t[e]}))},nu=function(t){return null==t?[]:eu(t,He(t))};var ru=Math.max;const iu=function(t,e,n,r){t=me(t)?t:nu(t),n=n&&!r?D(n):0;var i=t.length;return n<0&&(n=ru(i+n,0)),tu(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Zt(t,e,n)>-1};var ou=Math.max;const au=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:D(n);return i<0&&(i=ou(r+i,0)),Zt(t,e,i)},su=function(t){return null!=t&&t.length?nr(t,0,-1):[]};var uu=Math.min;const lu=function(t,e,n){for(var r=n?Ta:Vt,i=t[0].length,o=t.length,a=o,s=Array(o),u=1/0,l=[];a--;){var c=t[a];a&&e&&(c=y(c,ke(e))),u=uu(c.length,u),s[a]=!n&&(e||i>=120&&c.length>=120)?new ho(a&&c):void 0}c=t[0];var h=-1,p=s[0];t:for(;++h<i&&l.length<u;){var f=c[h],d=e?e(f):f;if(f=n||0!==f?f:0,!(p?fo(p,d):r(l,d,n))){for(a=o;--a;){var m=s[a];if(!(m?fo(m,d):r(t[a],d,n)))continue t}p&&p.push(d),l.push(f)}}return l},cu=function(t){return da(t)?t:[]},hu=fe((function(t){var e=y(t,cu);return e.length&&e[0]===t[0]?lu(e):[]}));const pu=fe((function(t){var e=La(t),n=y(t,cu);return e===La(n)?e=void 0:n.pop(),n.length&&n[0]===t[0]?lu(n,zo(e)):[]})),fu=fe((function(t){var e=La(t),n=y(t,cu);return(e="function"==typeof e?e:void 0)&&n.pop(),n.length&&n[0]===t[0]?lu(n,void 0,e):[]})),du=function(t,e){return function(n,r){return function(t,e,n,r){return Wo(t,(function(t,i,o){e(r,n(t),i,o)})),r}(n,t,e(r),{})}};var mu=Object.prototype.toString;const gu=du((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=mu.call(e)),t[e]=n}),Rt(F));var yu=Object.prototype,vu=yu.hasOwnProperty,_u=yu.toString;const xu=du((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=_u.call(e)),vu.call(t,e)?t[e].push(n):t[e]=[n]}),zo),bu=function(t,e){return e.length<2?t:Ln(t,nr(e,0,-1))},wu=function(t,e,n){e=An(e,t);var r=null==(t=bu(t,e))?t:t[Pn(La(e))];return null==r?void 0:ot(r,t,n)},Su=fe(wu);const Eu=fe((function(t,e,n){var r=-1,i="function"==typeof e,o=me(t)?Array(t.length):[];return Xo(t,(function(t){o[++r]=i?ot(e,t,n):wu(t,e,n)})),o}));var Cu=Ne&&Ne.isArrayBuffer;const Mu=Cu?ke(Cu):function(t){return d(t)&&"[object ArrayBuffer]"==f(t)},Tu=function(t){return!0===t||!1===t||d(t)&&"[object Boolean]"==f(t)};var Au=Ne&&Ne.isDate;const Pu=Au?ke(Au):function(t){return d(t)&&"[object Date]"==f(t)},Lu=function(t){return d(t)&&1===t.nodeType&&!Wn(t)};var Iu=Object.prototype.hasOwnProperty;const ku=function(t){if(null==t)return!0;if(me(t)&&(v(t)||"string"==typeof t||"function"==typeof t.splice||Le(t)||ze(t)||Ce(t)))return!t.length;var e=Bi(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(_e(t))return!Ge(t).length;for(var n in t)if(Iu.call(t,n))return!1;return!0},Ou=function(t,e){return Mo(t,e)},Ru=function(t,e,n){var r=(n="function"==typeof n?n:void 0)?n(t,e):void 0;return void 0===r?Mo(t,e,void 0,n):!!r};var Du=o.isFinite;const Nu=function(t){return"number"==typeof t&&Du(t)},Fu=function(t){return"number"==typeof t&&t==D(t)},zu=function(t,e){return t===e||To(t,e,Po(e))},Bu=function(t,e,n){return n="function"==typeof n?n:void 0,To(t,e,Po(e),n)},ju=function(t){return"number"==typeof t||d(t)&&"[object Number]"==f(t)},Uu=function(t){return ju(t)&&t!=+t},Zu=B?z:Me,Vu=function(t){if(Zu(t))throw new Error("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return K(t)},Gu=function(t){return null==t},Hu=function(t){return null===t};var Wu=Ne&&Ne.isRegExp;const qu=Wu?ke(Wu):function(t){return d(t)&&"[object RegExp]"==f(t)};const Xu=function(t){return Fu(t)&&t>=-9007199254740991&&t<=9007199254740991},Yu=function(t){return void 0===t},Ku=function(t){return d(t)&&"[object WeakMap]"==Bi(t)},Qu=function(t){return d(t)&&"[object WeakSet]"==f(t)},Ju=function(t){return zo("function"==typeof t?t:no(t,1))};var $u=Array.prototype.join;const tl=function(t,e){return null==t?"":$u.call(t,e)};const el=Yr((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}));const nl=Ko((function(t,e,n){ae(t,n,e)}));var rl=Math.max,il=Math.min;const ol=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r;return void 0!==n&&(i=(i=D(n))<0?rl(r+i,0):il(i,r-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,i):jt(t,Ut,i,!0)};const al=Yr((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),sl=yr("toLowerCase"),ul=function(t,e){return t<e},ll=Hs(ul),cl=Hs((function(t,e){return t<=e})),hl=function(t,e){var n={};return e=zo(e),Wo(t,(function(t,r,i){ae(n,e(t,r,i),t)})),n},pl=function(t,e){var n={};return e=zo(e),Wo(t,(function(t,r,i){ae(n,r,e(t,r,i))})),n},fl=function(t){return Io(no(t,1))},dl=function(t,e){return Do(t,no(e,1))},ml=function(t,e,n){for(var r=-1,i=t.length;++r<i;){var o=t[r],a=e(o);if(null!=a&&(void 0===s?a==a&&!m(a):n(a,s)))var s=a,u=o}return u},gl=function(t){return t&&t.length?ml(t,F,Gs):void 0},yl=function(t,e){return t&&t.length?ml(t,zo(e),Gs):void 0},vl=function(t,e){for(var n,r=-1,i=t.length;++r<i;){var o=e(t[r]);void 0!==o&&(n=void 0===n?o:n+o)}return n},_l=function(t,e){var n=null==t?0:t.length;return n?vl(t,e)/n:NaN},xl=function(t){return _l(t,F)},bl=function(t,e){return _l(t,zo(e))};var wl=ye((function(t,e,n){ya(t,e,n)}));const Sl=wl,El=fe((function(t,e){return function(n){return wu(n,t,e)}})),Cl=fe((function(t,e){return function(n){return wu(t,n,e)}})),Ml=function(t){return t&&t.length?ml(t,F,ul):void 0},Tl=function(t,e){return t&&t.length?ml(t,zo(e),ul):void 0},Al=function(t,e,n){var r=He(e),i=Bs(e,r),o=!(A(n)&&"chain"in n&&!n.chain),a=z(t);return Bt(i,(function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__),i=n.__actions__=wt(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,On([this.value()],arguments))})})),t},Pl=w((function(t,e){return t*e}),1),Ll=function(t){if("function"!=typeof t)throw new TypeError("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}};var Il=a?a.iterator:void 0;const kl=function(t){if(!t)return[];if(me(t))return tu(t)?gr(t):wt(t);if(Il&&t[Il])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Il]());var e=Bi(t);return("[object Map]"==e?go:"[object Set]"==e?yo:nu)(t)},Ol=function(){void 0===this.__values__&&(this.__values__=kl(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?void 0:this.__values__[this.__index__++]}},Rl=function(t,e){var n=t.length;if(n)return Yt(e+=e<0?n:0,n)?t[e]:void 0},Dl=function(t,e){return t&&t.length?Rl(t,D(e)):void 0},Nl=function(t){return t=D(t),fe((function(e){return Rl(e,t)}))},Fl=function(t,e){return e=An(e,t),null==(t=bu(t,e))||delete t[Pn(La(e))]},zl=function(t){return Wn(t)?void 0:t};const Bl=zn((function(t,e){var n={};if(null==t)return n;var r=!1;e=y(e,(function(e){return e=An(e,t),r||(r=e.length>1),e})),ce(t,Ei(t),n),r&&(n=no(n,7,zl));for(var i=e.length;i--;)Fl(n,e[i]);return n})),jl=function(t,e,n,r){if(!A(t))return t;for(var i=-1,o=(e=An(e,t)).length,a=o-1,s=t;null!=s&&++i<o;){var u=Pn(e[i]),l=n;if("__proto__"===u||"constructor"===u||"prototype"===u)return t;if(i!=a){var c=s[u];void 0===(l=r?r(c,u,s):void 0)&&(l=A(c)?c:Yt(e[i+1])?[]:{})}le(s,u,l),s=s[u]}return t},Ul=function(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],s=Ln(t,a);n(s,a)&&jl(o,An(a,t),s)}return o},Zl=function(t,e){if(null==t)return{};var n=y(Ei(t),(function(t){return[t]}));return e=zo(e),Ul(t,n,(function(t,n){return e(t,n[0])}))},Vl=function(t,e){return Zl(t,Ll(zo(e)))},Gl=function(t){return Kn(2,t)},Hl=function(t,e){if(t!==e){var n=void 0!==t,r=null===t,i=t==t,o=m(t),a=void 0!==e,s=null===e,u=e==e,l=m(e);if(!s&&!l&&!o&&t>e||o&&a&&u&&!s&&!l||r&&a&&u||!n&&u||!i)return 1;if(!r&&!o&&!l&&t<e||l&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!u)return-1}return 0},Wl=function(t,e,n){e=e.length?y(e,(function(t){return v(t)?function(e){return Ln(e,1===t.length?t[0]:t)}:t})):[F];var r=-1;return e=y(e,ke(zo)),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(ws(t,(function(t,n,i){return{criteria:y(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;++r<a;){var u=Hl(i[r],o[r]);if(u)return r>=s?u:u*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))},ql=function(t,e,n,r){return null==t?[]:(v(e)||(e=null==e?[]:[e]),v(n=r?void 0:n)||(n=null==n?[]:[n]),Wl(t,e,n))},Xl=function(t){return zn((function(e){return e=y(e,ke(zo)),fe((function(n){var r=this;return t(e,(function(t){return ot(t,r,n)}))}))}))},Yl=Xl(y),Kl=fe;var Ql=Math.min,Jl=Kl((function(t,e){var n=(e=1==e.length&&v(e[0])?y(e[0],ke(zo)):y(Nn(e,1),ke(zo))).length;return fe((function(r){for(var i=-1,o=Ql(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return ot(t,this,r)}))}));const $l=Jl,tc=Xl(rs),ec=Xl(po);var nc=Math.floor;const rc=function(t,e){var n="";if(!t||e<1||e>9007199254740991)return n;do{e%2&&(n+=t),(e=nc(e/2))&&(t+=t)}while(e);return n},ic=No("length");var oc="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",ac="[^\\ud800-\\udfff]",sc="(?:\\ud83c[\\udde6-\\uddff]){2}",uc="[\\ud800-\\udbff][\\udc00-\\udfff]",lc="(?:"+oc+"|\\ud83c[\\udffb-\\udfff])?",cc="[\\ufe0e\\ufe0f]?",hc=cc+lc+"(?:\\u200d(?:"+[ac,sc,uc].join("|")+")"+cc+lc+")*",pc="(?:"+[ac+oc+"?",oc,sc,uc,"[\\ud800-\\udfff]"].join("|")+")",fc=RegExp("\\ud83c[\\udffb-\\udfff](?=\\ud83c[\\udffb-\\udfff])|"+pc+hc,"g");const dc=function(t){return or(t)?function(t){for(var e=fc.lastIndex=0;fc.test(t);)++e;return e}(t):ic(t)};var mc=Math.ceil;const gc=function(t,e){var n=(e=void 0===e?" ":b(e)).length;if(n<2)return n?rc(e,t):e;var r=rc(e,mc(t/dc(e)));return or(e)?rr(gr(r),0,t).join(""):r.slice(0,t)};var yc=Math.ceil,vc=Math.floor;const _c=function(t,e,n){t=Tn(t);var r=(e=D(e))?dc(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return gc(vc(i),n)+t+gc(yc(i),n)},xc=function(t,e,n){t=Tn(t);var r=(e=D(e))?dc(t):0;return e&&r<e?t+gc(e-r,n):t},bc=function(t,e,n){t=Tn(t);var r=(e=D(e))?dc(t):0;return e&&r<e?gc(e-r,n)+t:t};var wc=/^\s+/,Sc=o.parseInt;const Ec=function(t,e,n){return n||null==e?e=0:e&&(e=+e),Sc(Tn(t).replace(wc,""),e||0)};var Cc=fe((function(t,e){var n=$t(e,qt(Cc));return ie(t,32,void 0,e,n)}));Cc.placeholder={};const Mc=Cc;var Tc=fe((function(t,e){var n=$t(e,qt(Tc));return ie(t,64,void 0,e,n)}));Tc.placeholder={};const Ac=Tc;const Pc=Ko((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]})),Lc=zn((function(t,e){return null==t?{}:function(t,e){return Ul(t,e,(function(e,n){return Ro(t,n)}))}(t,e)})),Ic=function(t){for(var e,n=this;n instanceof ht;){var r=St(n);r.__index__=0,r.__values__=void 0,e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}return i.__wrapped__=t,e},kc=function(t){return function(e){return null==t?void 0:Ln(t,e)}},Oc=function(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1};var Rc=Array.prototype.splice;const Dc=function(t,e,n,r){var i=r?Oc:Zt,o=-1,a=e.length,s=t;for(t===e&&(e=wt(e)),n&&(s=y(t,ke(n)));++o<a;)for(var u=0,l=e[o],c=n?n(l):l;(u=i(s,c,u,r))>-1;)s!==t&&Rc.call(s,u,1),Rc.call(t,u,1);return t},Nc=function(t,e){return t&&t.length&&e&&e.length?Dc(t,e):t},Fc=fe(Nc),zc=function(t,e,n){return t&&t.length&&e&&e.length?Dc(t,e,zo(n)):t},Bc=function(t,e,n){return t&&t.length&&e&&e.length?Dc(t,e,void 0,n):t};var jc=Array.prototype.splice;const Uc=function(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;Yt(i)?jc.call(t,i,1):Fl(t,i)}}return t};const Zc=zn((function(t,e){var n=null==t?0:t.length,r=kn(t,e);return Uc(t,y(e,(function(t){return Yt(t,n)?+t:t})).sort(Hl)),r}));var Vc=Math.floor,Gc=Math.random;const Hc=function(t,e){return t+Vc(Gc()*(e-t+1))};var Wc=parseFloat,qc=Math.min,Xc=Math.random;const Yc=function(t,e,n){if(n&&"boolean"!=typeof n&&ge(t,e,n)&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):(t=R(t),void 0===e?(e=t,t=0):e=R(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var i=Xc();return qc(t+i*(e-t+Wc("1e-"+((i+"").length-1))),e)}return Hc(t,e)};var Kc=Math.ceil,Qc=Math.max;const Jc=function(t){return function(e,n,r){return r&&"number"!=typeof r&&ge(e,n,r)&&(n=r=void 0),e=R(e),void 0===n?(n=e,e=0):n=R(n),function(t,e,n,r){for(var i=-1,o=Qc(Kc((e-t)/(n||1)),0),a=Array(o);o--;)a[r?o:++i]=t,t+=n;return a}(e,n,r=void 0===r?e<n?1:-1:R(r),t)}},$c=Jc(),th=Jc(!0);var eh=zn((function(t,e){return ie(t,256,void 0,void 0,void 0,e)}));const nh=eh,rh=function(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)})),n},ih=function(t,e,n){var r=v(t)?xr:rh,i=arguments.length<3;return r(t,zo(e),n,i,Xo)},oh=function(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n},ah=function(t,e,n){var r=v(t)?oh:rh,i=arguments.length<3;return r(t,zo(e),n,i,Ga)},sh=function(t,e){return(v(t)?gi:us)(t,Ll(zo(e)))},uh=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=zo(e);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return Uc(t,i),n},lh=function(t,e,n){return e=(n?ge(t,e,n):void 0===e)?1:D(e),rc(Tn(t),e)},ch=function(){var t=arguments,e=Tn(t[0]);return t.length<3?e:e.replace(t[1],t[2])},hh=function(t,e){if("function"!=typeof t)throw new TypeError("Expected a function");return e=void 0===e?e:D(e),fe(t,e)},ph=function(t,e,n){var r=-1,i=(e=An(e,t)).length;for(i||(i=1,t=void 0);++r<i;){var o=null==t?void 0:t[Pn(e[r])];void 0===o&&(r=i,o=n),t=z(o)?o.call(t):o}return t};var fh=Array.prototype.reverse;const dh=function(t){return null==t?t:fh.call(t)},mh=ti("round"),gh=function(t){var e=t.length;return e?t[Hc(0,e-1)]:void 0},yh=function(t){return gh(nu(t))},vh=function(t){return(v(t)?gh:yh)(t)},_h=function(t,e){var n=-1,r=t.length,i=r-1;for(e=void 0===e?r:e;++n<e;){var o=Hc(n,i),a=t[o];t[o]=t[n],t[n]=a}return t.length=e,t},xh=function(t,e){return _h(wt(t),ai(e,0,t.length))},bh=function(t,e){var n=nu(t);return _h(n,ai(e,0,n.length))},wh=function(t,e,n){return e=(n?ge(t,e,n):void 0===e)?1:D(e),(v(t)?xh:bh)(t,e)},Sh=function(t,e,n){return null==t?t:jl(t,e,n)},Eh=function(t,e,n,r){return r="function"==typeof r?r:void 0,null==t?t:jl(t,e,n,r)},Ch=function(t){return _h(wt(t))},Mh=function(t){return _h(nu(t))},Th=function(t){return(v(t)?Ch:Mh)(t)},Ah=function(t){if(null==t)return 0;if(me(t))return tu(t)?dc(t):t.length;var e=Bi(t);return"[object Map]"==e||"[object Set]"==e?t.size:Ge(t).length},Ph=function(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&ge(t,e,n)?(e=0,n=r):(e=null==e?0:D(e),n=void 0===n?r:D(n)),nr(t,e,n)):[]};const Lh=Yr((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()})),Ih=function(t,e){var n;return Xo(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n},kh=function(t,e,n){var r=v(t)?po:Ih;return n&&ge(t,e,n)&&(e=void 0),r(t,zo(e))},Oh=fe((function(t,e){if(null==t)return[];var n=e.length;return n>1&&ge(t,e[0],e[1])?e=[]:n>2&&ge(e[0],e[1],e[2])&&(e=[e[0]]),Wl(t,Nn(e,1),[])}));var Rh=Math.floor,Dh=Math.min;const Nh=function(t,e,n,r){var i=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=n(e))!=e,s=null===e,u=m(e),l=void 0===e;i<o;){var c=Rh((i+o)/2),h=n(t[c]),p=void 0!==h,f=null===h,d=h==h,g=m(h);if(a)var y=r||d;else y=l?d&&(r||p):s?d&&p&&(r||!f):u?d&&p&&!f&&(r||!g):!f&&!g&&(r?h<=e:h<e);y?i=c+1:o=c}return Dh(o,4294967294)},Fh=function(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!m(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return Nh(t,e,F,n)},zh=function(t,e){return Fh(t,e)},Bh=function(t,e,n){return Nh(t,e,zo(n))},jh=function(t,e){var n=null==t?0:t.length;if(n){var r=Fh(t,e);if(r<n&&se(t[r],e))return r}return-1},Uh=function(t,e){return Fh(t,e,!0)},Zh=function(t,e,n){return Nh(t,e,zo(n),!0)},Vh=function(t,e){if(null!=t&&t.length){var n=Fh(t,e,!0)-1;if(se(t[n],e))return n}return-1},Gh=function(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],s=e?e(a):a;if(!n||!se(s,u)){var u=s;o[i++]=0===a?0:a}}return o},Hh=function(t){return t&&t.length?Gh(t):[]},Wh=function(t,e){return t&&t.length?Gh(t,zo(e)):[]},qh=function(t,e,n){return n&&"number"!=typeof n&&ge(t,e,n)&&(e=n=void 0),(n=void 0===n?4294967295:n>>>0)?(t=Tn(t))&&("string"==typeof e||null!=e&&!qu(e))&&!(e=b(e))&&or(t)?rr(gr(t),0,n):t.split(e,n):[]};var Xh=Math.max;const Yh=function(t,e){if("function"!=typeof t)throw new TypeError("Expected a function");return e=null==e?0:Xh(D(e),0),fe((function(n){var r=n[e],i=rr(n,0,e);return r&&On(i,r),ot(t,this,i)}))};const Kh=Yr((function(t,e,n){return t+(n?" ":"")+vr(e)})),Qh=function(t,e,n){return t=Tn(t),n=null==n?0:ai(D(n),0,t.length),e=b(e),t.slice(n,n+e.length)==e},Jh=function(){return{}},$h=function(){return""},tp=function(){return!0},ep=w((function(t,e){return t-e}),0),np=function(t){return t&&t.length?vl(t,F):0},rp=function(t,e){return t&&t.length?vl(t,zo(e)):0},ip=function(t){var e=null==t?0:t.length;return e?nr(t,1,e):[]},op=function(t,e,n){return t&&t.length?(e=n||void 0===e?1:D(e),nr(t,0,e<0?0:e)):[]},ap=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||void 0===e?1:D(e),nr(t,(e=r-e)<0?0:e,r)):[]},sp=function(t,e){return t&&t.length?Na(t,zo(e),!1,!0):[]},up=function(t,e){return t&&t.length?Na(t,zo(e)):[]},lp=function(t,e){return e(t),t};var cp=Object.prototype,hp=cp.hasOwnProperty;const pp=function(t,e,n,r){return void 0===t||se(t,cp[n])&&!hp.call(r,n)?e:t};var fp={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};const dp=function(t){return"\\"+fp[t]},mp=/<%=([\s\S]+?)%>/g,gp={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:mp,variable:"",imports:{_:{escape:$a}}};var yp=/\b__p \+= '';/g,vp=/\b(__p \+=) '' \+/g,_p=/(__e\(.*?\)|\b__t\)) \+\n'';/g,xp=/[()=,{}\[\]\/\s]/,bp=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,wp=/($^)/,Sp=/['\n\r\u2028\u2029\\]/g,Ep=Object.prototype.hasOwnProperty;const Cp=function(t,e,n){var r=gp.imports._.templateSettings||gp;n&&ge(t,e,n)&&(e=void 0),t=Tn(t),e=en({},e,r,pp);var i,o,a=en({},e.imports,r.imports,pp),s=He(a),u=eu(a,s),l=0,c=e.interpolate||wp,h="__p += '",p=RegExp((e.escape||wp).source+"|"+c.source+"|"+(c===mp?bp:wp).source+"|"+(e.evaluate||wp).source+"|$","g"),f=Ep.call(e,"sourceURL")?"//# sourceURL="+(e.sourceURL+"").replace(/\s/g," ")+"\n":"";t.replace(p,(function(e,n,r,a,s,u){return r||(r=a),h+=t.slice(l,u).replace(Sp,dp),n&&(i=!0,h+="' +\n__e("+n+") +\n'"),s&&(o=!0,h+="';\n"+s+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=u+e.length,e})),h+="';\n";var d=Ep.call(e,"variable")&&e.variable;if(d){if(xp.test(d))throw new Error("Invalid `variable` option passed into `_.template`")}else h="with (obj) {\n"+h+"\n}\n";h=(o?h.replace(yp,""):h).replace(vp,"$1").replace(_p,"$1;"),h="function("+(d||"obj")+") {\n"+(d?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var m=Yn((function(){return Function(s,f+"return "+h).apply(void 0,u)}));if(m.source=h,qn(m))throw m;return m},Mp=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return A(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),sa(t,e,{leading:r,maxWait:e,trailing:i})},Tp=function(t,e){return e(t)};var Ap=4294967295,Pp=Math.min;const Lp=function(t,e){if((t=D(t))<1||t>9007199254740991)return[];var n=Ap,r=Pp(t,Ap);e=Ba(e),t-=Ap;for(var i=xe(r,e);++n<t;)e(n);return i},Ip=function(){return this},kp=function(t,e){var n=t;return n instanceof ft&&(n=n.value()),xr(e,(function(t,e){return e.func.apply(e.thisArg,On([t],e.args))}),n)},Op=function(){return kp(this.__wrapped__,this.__actions__)},Rp=function(t){return Tn(t).toLowerCase()},Dp=function(t){return v(t)?y(t,Pn):m(t)?[t]:wt(Mn(Tn(t)))};const Np=function(t){return t?ai(D(t),-9007199254740991,9007199254740991):0===t?t:0},Fp=function(t){return Tn(t).toUpperCase()},zp=function(t,e,n){var r=v(t),i=r||Le(t)||ze(t);if(e=zo(e),null==n){var o=t&&t.constructor;n=i?r?new o:[]:A(t)&&z(o)?rt(jn(t)):{}}return(i?Bt:Wo)(t,(function(t,r,i){return e(n,t,r,i)})),n},Bp=function(t,e){for(var n=t.length;n--&&Zt(e,t[n],0)>-1;);return n},jp=function(t,e){for(var n=-1,r=t.length;++n<r&&Zt(e,t[n],0)>-1;);return n},Up=function(t,e,n){if((t=Tn(t))&&(n||void 0===e))return T(t);if(!t||!(e=b(e)))return t;var r=gr(t),i=gr(e),o=jp(r,i),a=Bp(r,i)+1;return rr(r,o,a).join("")},Zp=function(t,e,n){if((t=Tn(t))&&(n||void 0===e))return t.slice(0,C(t)+1);if(!t||!(e=b(e)))return t;var r=gr(t),i=Bp(r,gr(e))+1;return rr(r,0,i).join("")};var Vp=/^\s+/;const Gp=function(t,e,n){if((t=Tn(t))&&(n||void 0===e))return t.replace(Vp,"");if(!t||!(e=b(e)))return t;var r=gr(t),i=jp(r,gr(e));return rr(r,i).join("")};var Hp=/\w*$/;const Wp=function(t,e){var n=30,r="...";if(A(e)){var i="separator"in e?e.separator:i;n="length"in e?D(e.length):n,r="omission"in e?b(e.omission):r}var o=(t=Tn(t)).length;if(or(t)){var a=gr(t);o=a.length}if(n>=o)return t;var s=n-dc(r);if(s<1)return r;var u=a?rr(a,0,s).join(""):t.slice(0,s);if(void 0===i)return u+r;if(a&&(s+=u.length-s),qu(i)){if(t.slice(s).search(i)){var l,c=u;for(i.global||(i=RegExp(i.source,Tn(Hp.exec(i))+"g")),i.lastIndex=0;l=i.exec(c);)var h=l.index;u=u.slice(0,void 0===h?s:h)}}else if(t.indexOf(b(i),s)!=s){var p=u.lastIndexOf(i);p>-1&&(u=u.slice(0,p))}return u+r},qp=function(t){return oe(t,1)},Xp=br({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Yp=/&(?:amp|lt|gt|quot|#39);/g,Kp=RegExp(Yp.source);const Qp=function(t){return(t=Tn(t))&&Kp.test(t)?t.replace(Yp,Xp):t};const Jp=Ti&&1/yo(new Ti([,-0]))[1]==1/0?function(t){return new Ti(t)}:dt,$p=function(t,e,n){var r=-1,i=Vt,o=t.length,a=!0,s=[],u=s;if(n)a=!1,i=Ta;else if(o>=200){var l=e?null:Jp(t);if(l)return yo(l);a=!1,i=fo,u=new ho}else u=e?[]:s;t:for(;++r<o;){var c=t[r],h=e?e(c):c;if(c=n||0!==c?c:0,a&&h==h){for(var p=u.length;p--;)if(u[p]===h)continue t;e&&u.push(h),s.push(c)}else i(u,h,n)||(u!==s&&u.push(h),s.push(c))}return s},tf=fe((function(t){return $p(Nn(t,1,da,!0))}));const ef=fe((function(t){var e=La(t);return da(e)&&(e=void 0),$p(Nn(t,1,da,!0),zo(e))})),nf=fe((function(t){var e=La(t);return e="function"==typeof e?e:void 0,$p(Nn(t,1,da,!0),void 0,e)})),rf=function(t){return t&&t.length?$p(t):[]},of=function(t,e){return t&&t.length?$p(t,zo(e)):[]},af=function(t,e){return e="function"==typeof e?e:void 0,t&&t.length?$p(t,void 0,e):[]};var sf=0;const uf=function(t){var e=++sf;return Tn(t)+e},lf=function(t,e){return null==t||Fl(t,e)};var cf=Math.max;const hf=function(t){if(!t||!t.length)return[];var e=0;return t=gi(t,(function(t){if(da(t))return e=cf(t.length,e),!0})),xe(e,(function(e){return y(t,No(e))}))},pf=function(t,e){if(!t||!t.length)return[];var n=hf(t);return null==e?n:y(n,(function(t){return ot(e,void 0,t)}))},ff=function(t,e,n,r){return jl(t,e,n(Ln(t,e)),r)},df=function(t,e,n){return null==t?t:ff(t,e,Ba(n))},mf=function(t,e,n,r){return r="function"==typeof r?r:void 0,null==t?t:ff(t,e,Ba(n),r)};const gf=Yr((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),yf=function(t){return null==t?[]:eu(t,Qe(t))};const vf=fe((function(t,e){return da(t)?Aa(t,e):[]})),_f=function(t,e){return Mc(Ba(e),t)},xf=zn((function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,i=function(e){return kn(e,t)};return!(e>1||this.__actions__.length)&&r instanceof ft&&Yt(n)?((r=r.slice(n,+n+(e?1:0))).__actions__.push({func:Tp,args:[i],thisArg:void 0}),new bt(r,this.__chain__).thru((function(t){return e&&!t.length&&t.push(void 0),t}))):this.thru(i)})),bf=function(){return ni(this)},wf=function(){var t=this.__wrapped__;if(t instanceof ft){var e=t;return this.__actions__.length&&(e=new ft(this)),(e=e.reverse()).__actions__.push({func:Tp,args:[dh],thisArg:void 0}),new bt(e,this.__chain__)}return this.thru(dh)},Sf=function(t,e,n){var r=t.length;if(r<2)return r?$p(t[0]):[];for(var i=-1,o=Array(r);++i<r;)for(var a=t[i],s=-1;++s<r;)s!=i&&(o[i]=Aa(o[i]||a,t[s],e,n));return $p(Nn(o,1),e,n)},Ef=fe((function(t){return Sf(gi(t,da))}));const Cf=fe((function(t){var e=La(t);return da(e)&&(e=void 0),Sf(gi(t,da),zo(e))})),Mf=fe((function(t){var e=La(t);return e="function"==typeof e?e:void 0,Sf(gi(t,da),void 0,e)})),Tf=fe(hf),Af=function(t,e,n){for(var r=-1,i=t.length,o=e.length,a={};++r<i;){var s=r<o?e[r]:void 0;n(a,t[r],s)}return a},Pf=function(t,e){return Af(t||[],e||[],le)},Lf=function(t,e){return Af(t||[],e||[],jl)};const If=fe((function(t){var e=t.length,n=e>1?t[e-1]:void 0;return n="function"==typeof n?(t.pop(),n):void 0,pf(t,n)})),kf={chunk:oi,compact:uo,concat:lo,difference:Pa,differenceBy:Ia,differenceWith:ka,drop:Ra,dropRight:Da,dropRightWhile:Fa,dropWhile:za,fill:ss,findIndex:ps,findLastIndex:vs,first:bs,flatten:Fn,flattenDeep:Ts,flattenDepth:As,fromPairs:zs,head:bs,indexOf:au,initial:su,intersection:hu,intersectionBy:pu,intersectionWith:fu,join:tl,last:La,lastIndexOf:ol,nth:Dl,pull:Fc,pullAll:Nc,pullAllBy:zc,pullAllWith:Bc,pullAt:Zc,remove:uh,reverse:dh,slice:Ph,sortedIndex:zh,sortedIndexBy:Bh,sortedIndexOf:jh,sortedLastIndex:Uh,sortedLastIndexBy:Zh,sortedLastIndexOf:Vh,sortedUniq:Hh,sortedUniqBy:Wh,tail:ip,take:op,takeRight:ap,takeRightWhile:sp,takeWhile:up,union:tf,unionBy:ef,unionWith:nf,uniq:rf,uniqBy:of,uniqWith:af,unzip:hf,unzipWith:pf,without:vf,xor:Ef,xorBy:Cf,xorWith:Mf,zip:Tf,zipObject:Pf,zipObjectDeep:Lf,zipWith:If},Of={countBy:Jo,each:ja,eachRight:Ha,every:os,filter:ls,find:fs,findLast:_s,flatMap:Es,flatMapDeep:Cs,flatMapDepth:Ms,forEach:ja,forEachRight:Ha,groupBy:Vs,includes:iu,invokeMap:Eu,keyBy:nl,map:Ss,orderBy:ql,partition:Pc,reduce:ih,reduceRight:ah,reject:sh,sample:vh,sampleSize:wh,shuffle:Th,size:Ah,some:kh,sortBy:Oh},Rf={now:ia},Df={after:N,ary:oe,before:Kn,bind:Jn,bindKey:er,curry:ea,curryRight:ra,debounce:sa,defer:Ea,delay:Ma,flip:Ps,memoize:wn,negate:Ll,once:Gl,overArgs:$l,partial:Mc,partialRight:Ac,rearg:nh,rest:hh,spread:Yh,throttle:Mp,unary:qp,wrap:_f},Nf={castArray:Qr,clone:ro,cloneDeep:io,cloneDeepWith:oo,cloneWith:ao,conformsTo:Zo,eq:se,gt:Ws,gte:qs,isArguments:Ce,isArray:v,isArrayBuffer:Mu,isArrayLike:me,isArrayLikeObject:da,isBoolean:Tu,isBuffer:Le,isDate:Pu,isElement:Lu,isEmpty:ku,isEqual:Ou,isEqualWith:Ru,isError:qn,isFinite:Nu,isFunction:z,isInteger:Fu,isLength:de,isMap:Ki,isMatch:zu,isMatchWith:Bu,isNaN:Uu,isNative:Vu,isNil:Gu,isNull:Hu,isNumber:ju,isObject:A,isObjectLike:d,isPlainObject:Wn,isRegExp:qu,isSafeInteger:Xu,isSet:Ji,isString:tu,isSymbol:m,isTypedArray:ze,isUndefined:Yu,isWeakMap:Ku,isWeakSet:Qu,lt:ll,lte:cl,toArray:kl,toFinite:R,toInteger:D,toLength:as,toNumber:O,toPlainObject:ga,toSafeInteger:Np,toString:Tn},Ff={add:S,ceil:ei,divide:Oa,floor:Ls,max:gl,maxBy:yl,mean:xl,meanBy:bl,min:Ml,minBy:Tl,multiply:Pl,round:mh,subtract:ep,sum:np,sumBy:rp},zf={clamp:si,inRange:$s,random:Yc},Bf={assign:Xe,assignIn:$e,assignInWith:en,assignWith:rn,at:Bn,create:$o,defaults:pa,defaultsDeep:ba,entries:Xa,entriesIn:Ya,extend:$e,extendWith:en,findKey:ms,findLastKey:xs,forIn:Rs,forInRight:Ds,forOwn:Ns,forOwnRight:Fs,functions:js,functionsIn:Us,get:In,has:Ks,hasIn:Ro,invert:gu,invertBy:xu,invoke:Su,keys:He,keysIn:Qe,mapKeys:hl,mapValues:pl,merge:Sl,mergeWith:xa,omit:Bl,omitBy:Vl,pick:Lc,pickBy:Zl,result:ph,set:Sh,setWith:Eh,toPairs:Xa,toPairsIn:Ya,transform:zp,unset:lf,update:df,updateWith:mf,values:nu,valuesIn:yf},jf={at:xf,chain:ni,commit:so,lodash:Mt,next:Ol,plant:Ic,reverse:wf,tap:lp,thru:Tp,toIterator:Ip,toJSON:Op,value:Op,valueOf:Op,wrapperChain:bf},Uf={camelCase:Kr,capitalize:_r,deburr:Cr,endsWith:Wa,escape:$a,escapeRegExp:ns,kebabCase:el,lowerCase:al,lowerFirst:sl,pad:_c,padEnd:xc,padStart:bc,parseInt:Ec,repeat:lh,replace:ch,snakeCase:Lh,split:qh,startCase:Kh,startsWith:Qh,template:Cp,templateSettings:gp,toLower:Rp,toUpper:Fp,trim:Up,trimEnd:Zp,trimStart:Gp,truncate:Wp,unescape:Qp,upperCase:gf,upperFirst:vr,words:qr},Zf={attempt:Yn,bindAll:$n,cond:Bo,conforms:Uo,constant:Rt,defaultTo:ua,flow:ks,flowRight:Os,identity:F,iteratee:Ju,matches:fl,matchesProperty:dl,method:El,methodOf:Cl,mixin:Al,noop:dt,nthArg:Nl,over:Yl,overEvery:tc,overSome:ec,property:Fo,propertyOf:kc,range:$c,rangeRight:th,stubArray:yi,stubFalse:Me,stubObject:Jh,stubString:$h,stubTrue:tp,times:Lp,toPath:Dp,uniqueId:uf};var Vf=Math.max,Gf=Math.min;var Hf=Math.min;var Wf,qf,Xf=4294967295,Yf=Array.prototype,Kf=Object.prototype.hasOwnProperty,Qf=a?a.iterator:void 0,Jf=Math.max,$f=Math.min,td=(Wf=Al,function(t,e,n){if(null==n){var r=A(e),i=r&&He(e),o=i&&i.length&&Bs(e,i);(o?o.length:r)||(n=e,e=t,t=this)}return Wf(t,e,n)});Mt.after=Df.after,Mt.ary=Df.ary,Mt.assign=Bf.assign,Mt.assignIn=Bf.assignIn,Mt.assignInWith=Bf.assignInWith,Mt.assignWith=Bf.assignWith,Mt.at=Bf.at,Mt.before=Df.before,Mt.bind=Df.bind,Mt.bindAll=Zf.bindAll,Mt.bindKey=Df.bindKey,Mt.castArray=Nf.castArray,Mt.chain=jf.chain,Mt.chunk=kf.chunk,Mt.compact=kf.compact,Mt.concat=kf.concat,Mt.cond=Zf.cond,Mt.conforms=Zf.conforms,Mt.constant=Zf.constant,Mt.countBy=Of.countBy,Mt.create=Bf.create,Mt.curry=Df.curry,Mt.curryRight=Df.curryRight,Mt.debounce=Df.debounce,Mt.defaults=Bf.defaults,Mt.defaultsDeep=Bf.defaultsDeep,Mt.defer=Df.defer,Mt.delay=Df.delay,Mt.difference=kf.difference,Mt.differenceBy=kf.differenceBy,Mt.differenceWith=kf.differenceWith,Mt.drop=kf.drop,Mt.dropRight=kf.dropRight,Mt.dropRightWhile=kf.dropRightWhile,Mt.dropWhile=kf.dropWhile,Mt.fill=kf.fill,Mt.filter=Of.filter,Mt.flatMap=Of.flatMap,Mt.flatMapDeep=Of.flatMapDeep,Mt.flatMapDepth=Of.flatMapDepth,Mt.flatten=kf.flatten,Mt.flattenDeep=kf.flattenDeep,Mt.flattenDepth=kf.flattenDepth,Mt.flip=Df.flip,Mt.flow=Zf.flow,Mt.flowRight=Zf.flowRight,Mt.fromPairs=kf.fromPairs,Mt.functions=Bf.functions,Mt.functionsIn=Bf.functionsIn,Mt.groupBy=Of.groupBy,Mt.initial=kf.initial,Mt.intersection=kf.intersection,Mt.intersectionBy=kf.intersectionBy,Mt.intersectionWith=kf.intersectionWith,Mt.invert=Bf.invert,Mt.invertBy=Bf.invertBy,Mt.invokeMap=Of.invokeMap,Mt.iteratee=Zf.iteratee,Mt.keyBy=Of.keyBy,Mt.keys=He,Mt.keysIn=Bf.keysIn,Mt.map=Of.map,Mt.mapKeys=Bf.mapKeys,Mt.mapValues=Bf.mapValues,Mt.matches=Zf.matches,Mt.matchesProperty=Zf.matchesProperty,Mt.memoize=Df.memoize,Mt.merge=Bf.merge,Mt.mergeWith=Bf.mergeWith,Mt.method=Zf.method,Mt.methodOf=Zf.methodOf,Mt.mixin=td,Mt.negate=Ll,Mt.nthArg=Zf.nthArg,Mt.omit=Bf.omit,Mt.omitBy=Bf.omitBy,Mt.once=Df.once,Mt.orderBy=Of.orderBy,Mt.over=Zf.over,Mt.overArgs=Df.overArgs,Mt.overEvery=Zf.overEvery,Mt.overSome=Zf.overSome,Mt.partial=Df.partial,Mt.partialRight=Df.partialRight,Mt.partition=Of.partition,Mt.pick=Bf.pick,Mt.pickBy=Bf.pickBy,Mt.property=Zf.property,Mt.propertyOf=Zf.propertyOf,Mt.pull=kf.pull,Mt.pullAll=kf.pullAll,Mt.pullAllBy=kf.pullAllBy,Mt.pullAllWith=kf.pullAllWith,Mt.pullAt=kf.pullAt,Mt.range=Zf.range,Mt.rangeRight=Zf.rangeRight,Mt.rearg=Df.rearg,Mt.reject=Of.reject,Mt.remove=kf.remove,Mt.rest=Df.rest,Mt.reverse=kf.reverse,Mt.sampleSize=Of.sampleSize,Mt.set=Bf.set,Mt.setWith=Bf.setWith,Mt.shuffle=Of.shuffle,Mt.slice=kf.slice,Mt.sortBy=Of.sortBy,Mt.sortedUniq=kf.sortedUniq,Mt.sortedUniqBy=kf.sortedUniqBy,Mt.split=Uf.split,Mt.spread=Df.spread,Mt.tail=kf.tail,Mt.take=kf.take,Mt.takeRight=kf.takeRight,Mt.takeRightWhile=kf.takeRightWhile,Mt.takeWhile=kf.takeWhile,Mt.tap=jf.tap,Mt.throttle=Df.throttle,Mt.thru=Tp,Mt.toArray=Nf.toArray,Mt.toPairs=Bf.toPairs,Mt.toPairsIn=Bf.toPairsIn,Mt.toPath=Zf.toPath,Mt.toPlainObject=Nf.toPlainObject,Mt.transform=Bf.transform,Mt.unary=Df.unary,Mt.union=kf.union,Mt.unionBy=kf.unionBy,Mt.unionWith=kf.unionWith,Mt.uniq=kf.uniq,Mt.uniqBy=kf.uniqBy,Mt.uniqWith=kf.uniqWith,Mt.unset=Bf.unset,Mt.unzip=kf.unzip,Mt.unzipWith=kf.unzipWith,Mt.update=Bf.update,Mt.updateWith=Bf.updateWith,Mt.values=Bf.values,Mt.valuesIn=Bf.valuesIn,Mt.without=kf.without,Mt.words=Uf.words,Mt.wrap=Df.wrap,Mt.xor=kf.xor,Mt.xorBy=kf.xorBy,Mt.xorWith=kf.xorWith,Mt.zip=kf.zip,Mt.zipObject=kf.zipObject,Mt.zipObjectDeep=kf.zipObjectDeep,Mt.zipWith=kf.zipWith,Mt.entries=Bf.toPairs,Mt.entriesIn=Bf.toPairsIn,Mt.extend=Bf.assignIn,Mt.extendWith=Bf.assignInWith,td(Mt,Mt),Mt.add=Ff.add,Mt.attempt=Zf.attempt,Mt.camelCase=Uf.camelCase,Mt.capitalize=Uf.capitalize,Mt.ceil=Ff.ceil,Mt.clamp=zf.clamp,Mt.clone=Nf.clone,Mt.cloneDeep=Nf.cloneDeep,Mt.cloneDeepWith=Nf.cloneDeepWith,Mt.cloneWith=Nf.cloneWith,Mt.conformsTo=Nf.conformsTo,Mt.deburr=Uf.deburr,Mt.defaultTo=Zf.defaultTo,Mt.divide=Ff.divide,Mt.endsWith=Uf.endsWith,Mt.eq=Nf.eq,Mt.escape=Uf.escape,Mt.escapeRegExp=Uf.escapeRegExp,Mt.every=Of.every,Mt.find=Of.find,Mt.findIndex=kf.findIndex,Mt.findKey=Bf.findKey,Mt.findLast=Of.findLast,Mt.findLastIndex=kf.findLastIndex,Mt.findLastKey=Bf.findLastKey,Mt.floor=Ff.floor,Mt.forEach=Of.forEach,Mt.forEachRight=Of.forEachRight,Mt.forIn=Bf.forIn,Mt.forInRight=Bf.forInRight,Mt.forOwn=Bf.forOwn,Mt.forOwnRight=Bf.forOwnRight,Mt.get=Bf.get,Mt.gt=Nf.gt,Mt.gte=Nf.gte,Mt.has=Bf.has,Mt.hasIn=Bf.hasIn,Mt.head=kf.head,Mt.identity=F,Mt.includes=Of.includes,Mt.indexOf=kf.indexOf,Mt.inRange=zf.inRange,Mt.invoke=Bf.invoke,Mt.isArguments=Nf.isArguments,Mt.isArray=v,Mt.isArrayBuffer=Nf.isArrayBuffer,Mt.isArrayLike=Nf.isArrayLike,Mt.isArrayLikeObject=Nf.isArrayLikeObject,Mt.isBoolean=Nf.isBoolean,Mt.isBuffer=Nf.isBuffer,Mt.isDate=Nf.isDate,Mt.isElement=Nf.isElement,Mt.isEmpty=Nf.isEmpty,Mt.isEqual=Nf.isEqual,Mt.isEqualWith=Nf.isEqualWith,Mt.isError=Nf.isError,Mt.isFinite=Nf.isFinite,Mt.isFunction=Nf.isFunction,Mt.isInteger=Nf.isInteger,Mt.isLength=Nf.isLength,Mt.isMap=Nf.isMap,Mt.isMatch=Nf.isMatch,Mt.isMatchWith=Nf.isMatchWith,Mt.isNaN=Nf.isNaN,Mt.isNative=Nf.isNative,Mt.isNil=Nf.isNil,Mt.isNull=Nf.isNull,Mt.isNumber=Nf.isNumber,Mt.isObject=A,Mt.isObjectLike=Nf.isObjectLike,Mt.isPlainObject=Nf.isPlainObject,Mt.isRegExp=Nf.isRegExp,Mt.isSafeInteger=Nf.isSafeInteger,Mt.isSet=Nf.isSet,Mt.isString=Nf.isString,Mt.isSymbol=Nf.isSymbol,Mt.isTypedArray=Nf.isTypedArray,Mt.isUndefined=Nf.isUndefined,Mt.isWeakMap=Nf.isWeakMap,Mt.isWeakSet=Nf.isWeakSet,Mt.join=kf.join,Mt.kebabCase=Uf.kebabCase,Mt.last=La,Mt.lastIndexOf=kf.lastIndexOf,Mt.lowerCase=Uf.lowerCase,Mt.lowerFirst=Uf.lowerFirst,Mt.lt=Nf.lt,Mt.lte=Nf.lte,Mt.max=Ff.max,Mt.maxBy=Ff.maxBy,Mt.mean=Ff.mean,Mt.meanBy=Ff.meanBy,Mt.min=Ff.min,Mt.minBy=Ff.minBy,Mt.stubArray=Zf.stubArray,Mt.stubFalse=Zf.stubFalse,Mt.stubObject=Zf.stubObject,Mt.stubString=Zf.stubString,Mt.stubTrue=Zf.stubTrue,Mt.multiply=Ff.multiply,Mt.nth=kf.nth,Mt.noop=Zf.noop,Mt.now=Rf.now,Mt.pad=Uf.pad,Mt.padEnd=Uf.padEnd,Mt.padStart=Uf.padStart,Mt.parseInt=Uf.parseInt,Mt.random=zf.random,Mt.reduce=Of.reduce,Mt.reduceRight=Of.reduceRight,Mt.repeat=Uf.repeat,Mt.replace=Uf.replace,Mt.result=Bf.result,Mt.round=Ff.round,Mt.sample=Of.sample,Mt.size=Of.size,Mt.snakeCase=Uf.snakeCase,Mt.some=Of.some,Mt.sortedIndex=kf.sortedIndex,Mt.sortedIndexBy=kf.sortedIndexBy,Mt.sortedIndexOf=kf.sortedIndexOf,Mt.sortedLastIndex=kf.sortedLastIndex,Mt.sortedLastIndexBy=kf.sortedLastIndexBy,Mt.sortedLastIndexOf=kf.sortedLastIndexOf,Mt.startCase=Uf.startCase,Mt.startsWith=Uf.startsWith,Mt.subtract=Ff.subtract,Mt.sum=Ff.sum,Mt.sumBy=Ff.sumBy,Mt.template=Uf.template,Mt.times=Zf.times,Mt.toFinite=Nf.toFinite,Mt.toInteger=D,Mt.toLength=Nf.toLength,Mt.toLower=Uf.toLower,Mt.toNumber=Nf.toNumber,Mt.toSafeInteger=Nf.toSafeInteger,Mt.toString=Nf.toString,Mt.toUpper=Uf.toUpper,Mt.trim=Uf.trim,Mt.trimEnd=Uf.trimEnd,Mt.trimStart=Uf.trimStart,Mt.truncate=Uf.truncate,Mt.unescape=Uf.unescape,Mt.uniqueId=Zf.uniqueId,Mt.upperCase=Uf.upperCase,Mt.upperFirst=Uf.upperFirst,Mt.each=Of.forEach,Mt.eachRight=Of.forEachRight,Mt.first=kf.head,td(Mt,(qf={},Wo(Mt,(function(t,e){Kf.call(Mt.prototype,e)||(qf[e]=t)})),qf),{chain:!1}),Mt.VERSION="4.17.21",(Mt.templateSettings=Uf.templateSettings).imports._=Mt,Bt(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Mt[t].placeholder=Mt})),Bt(["drop","take"],(function(t,e){ft.prototype[t]=function(n){n=void 0===n?1:Jf(D(n),0);var r=this.__filtered__&&!e?new ft(this):this.clone();return r.__filtered__?r.__takeCount__=$f(n,r.__takeCount__):r.__views__.push({size:$f(n,Xf),type:t+(r.__dir__<0?"Right":"")}),r},ft.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Bt(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;ft.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:zo(t),type:n}),e.__filtered__=e.__filtered__||r,e}})),Bt(["head","last"],(function(t,e){var n="take"+(e?"Right":"");ft.prototype[t]=function(){return this[n](1).value()[0]}})),Bt(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");ft.prototype[t]=function(){return this.__filtered__?new ft(this):this[n](1)}})),ft.prototype.compact=function(){return this.filter(F)},ft.prototype.find=function(t){return this.filter(t).head()},ft.prototype.findLast=function(t){return this.reverse().find(t)},ft.prototype.invokeMap=fe((function(t,e){return"function"==typeof t?new ft(this):this.map((function(n){return wu(n,t,e)}))})),ft.prototype.reject=function(t){return this.filter(Ll(zo(t)))},ft.prototype.slice=function(t,e){t=D(t);var n=this;return n.__filtered__&&(t>0||e<0)?new ft(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),void 0!==e&&(n=(e=D(e))<0?n.dropRight(-e):n.take(e-t)),n)},ft.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},ft.prototype.toArray=function(){return this.take(Xf)},Wo(ft.prototype,(function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),i=Mt[r?"take"+("last"==e?"Right":""):e],o=r||/^find/.test(e);i&&(Mt.prototype[e]=function(){var e=this.__wrapped__,a=r?[1]:arguments,s=e instanceof ft,u=a[0],l=s||v(e),c=function(t){var e=i.apply(Mt,On([t],a));return r&&h?e[0]:e};l&&n&&"function"==typeof u&&1!=u.length&&(s=l=!1);var h=this.__chain__,p=!!this.__actions__.length,f=o&&!h,d=s&&!p;if(!o&&l){e=d?e:new ft(this);var m=t.apply(e,a);return m.__actions__.push({func:Tp,args:[c],thisArg:void 0}),new bt(m,h)}return f&&d?t.apply(this,a):(m=this.thru(c),f?r?m.value()[0]:m.value():m)})})),Bt(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Yf[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Mt.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(v(i)?i:[],t)}return this[n]((function(n){return e.apply(v(n)?n:[],t)}))}})),Wo(ft.prototype,(function(t,e){var n=Mt[e];if(n){var r=n.name+"";Kf.call(yt,r)||(yt[r]=[]),yt[r].push({name:e,func:n})}})),yt[te(void 0,2).name]=[{name:"wrapper",func:void 0}],ft.prototype.clone=function(){var t=new ft(this.__wrapped__);return t.__actions__=wt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=wt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=wt(this.__views__),t},ft.prototype.reverse=function(){if(this.__filtered__){var t=new ft(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},ft.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=v(t),r=e<0,i=n?t.length:0,o=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Gf(e,t+a);break;case"takeRight":t=Vf(t,e-a)}}return{start:t,end:e}}(0,i,this.__views__),a=o.start,s=o.end,u=s-a,l=r?s:a-1,c=this.__iteratees__,h=c.length,p=0,f=Hf(u,this.__takeCount__);if(!n||!r&&i==u&&f==u)return kp(t,this.__actions__);var d=[];t:for(;u--&&p<f;){for(var m=-1,g=t[l+=e];++m<h;){var y=c[m],_=y.iteratee,x=y.type,b=_(g);if(2==x)g=b;else if(!b){if(1==x)continue t;break t}}d[p++]=g}return d},Mt.prototype.at=jf.at,Mt.prototype.chain=jf.wrapperChain,Mt.prototype.commit=jf.commit,Mt.prototype.next=jf.next,Mt.prototype.plant=jf.plant,Mt.prototype.reverse=jf.reverse,Mt.prototype.toJSON=Mt.prototype.valueOf=Mt.prototype.value=jf.value,Mt.prototype.first=Mt.prototype.head,Qf&&(Mt.prototype[Qf]=jf.toIterator);const ed=Mt}},a={};function s(t){var e=a[t];if(void 0!==e)return e.exports;var n=a[t]={id:t,loaded:!1,exports:{}};return o[t].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var u={};return(()=>{"use strict";s.r(u),s.d(u,{components:()=>MS});var t=s(3618),e=s(1024),n=s.n(e);const r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},i=100,o=301,a=302,l=306,c=1e3,h=1001,p=1002,f=1003,d=1006,m=1008,g=1009,y=1012,v=1014,_=1015,x=1016,b=1020,w=1023,S=1026,E=1027,C=33776,M=33777,T=33778,A=33779,P=2300,L=2301,I=2302,k=2400,O=2401,R=2402,D=3e3,N=3001,F="srgb",z="srgb-linear",B=7680,j=35044,U=35048,Z="300 es",V=1035;class G{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t);t.target=null}}}const H=[];for(let t=0;t<256;t++)H[t]=(t<16?"0":"")+t.toString(16);const W=Math.PI/180,q=180/Math.PI;function X(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(H[255&t]+H[t>>8&255]+H[t>>16&255]+H[t>>24&255]+"-"+H[255&e]+H[e>>8&255]+"-"+H[e>>16&15|64]+H[e>>24&255]+"-"+H[63&n|128]+H[n>>8&255]+"-"+H[n>>16&255]+H[n>>24&255]+H[255&r]+H[r>>8&255]+H[r>>16&255]+H[r>>24&255]).toLowerCase()}function Y(t,e,n){return Math.max(e,Math.min(n,t))}function K(t,e,n){return(1-n)*t+n*e}function Q(t){return 0==(t&t-1)&&0!==t}function J(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}class ${constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}$.prototype.isVector2=!0;class tt{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,o,a,s,u){const l=this.elements;return l[0]=t,l[1]=r,l[2]=a,l[3]=e,l[4]=i,l[5]=s,l[6]=n,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],p=n[5],f=n[8],d=r[0],m=r[3],g=r[6],y=r[1],v=r[4],_=r[7],x=r[2],b=r[5],w=r[8];return i[0]=o*d+a*y+s*x,i[3]=o*m+a*v+s*b,i[6]=o*g+a*_+s*w,i[1]=u*d+l*y+c*x,i[4]=u*m+l*v+c*b,i[7]=u*g+l*_+c*w,i[2]=h*d+p*y+f*x,i[5]=h*m+p*v+f*b,i[8]=h*g+p*_+f*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8];return e*o*l-e*a*u-n*i*l+n*a*s+r*i*u-r*o*s}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=l*o-a*u,h=a*s-l*i,p=u*i-o*s,f=e*c+n*h+r*p;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const d=1/f;return t[0]=c*d,t[1]=(r*u-l*n)*d,t[2]=(a*n-r*o)*d,t[3]=h*d,t[4]=(l*e-r*s)*d,t[5]=(r*i-a*e)*d,t[6]=p*d,t[7]=(n*s-u*e)*d,t[8]=(o*e-n*i)*d,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,o,a){const s=Math.cos(i),u=Math.sin(i);return this.set(n*s,n*u,-n*(s*o+u*a)+o+t,-r*u,r*s,-r*(-u*o+s*a)+a+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],u=r[4],l=r[7];return r[0]=e*i+n*s,r[3]=e*o+n*u,r[6]=e*a+n*l,r[1]=-n*i+e*s,r[4]=-n*o+e*u,r[7]=-n*a+e*l,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function et(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}function nt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function rt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function it(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}tt.prototype.isMatrix3=!0,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const ot={[F]:{[z]:rt},[z]:{[F]:it}},at={legacyMode:!0,get workingColorSpace(){return z},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,n){if(this.legacyMode||e===n||!e||!n)return t;if(ot[e]&&void 0!==ot[e][n]){const r=ot[e][n];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},st={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ut={r:0,g:0,b:0},lt={h:0,s:0,l:0},ct={h:0,s:0,l:0};function ht(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function pt(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class ft{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e="srgb"){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,at.toWorkingColorSpace(this,e),this}setRGB(t,e,n,r="srgb-linear"){return this.r=t,this.g=e,this.b=n,at.toWorkingColorSpace(this,r),this}setHSL(t,e,n,r="srgb-linear"){if(t=function(t,e){return(t%e+e)%e}(t,1),e=Y(e,0,1),n=Y(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=ht(i,r,t+1/3),this.g=ht(i,r,t),this.b=ht(i,r,t-1/3)}return at.toWorkingColorSpace(this,r),this}setStyle(t,e="srgb"){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const i=r[1],o=r[2];switch(i){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,at.toWorkingColorSpace(this,e),n(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,at.toWorkingColorSpace(this,e),n(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const r=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,o=parseInt(t[3],10)/100;return n(t[4]),this.setHSL(r,i,o,e)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=r[1],n=t.length;if(3===n)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,at.toWorkingColorSpace(this,e),this;if(6===n)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,at.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e="srgb"){const n=st[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=rt(t.r),this.g=rt(t.g),this.b=rt(t.b),this}copyLinearToSRGB(t){return this.r=it(t.r),this.g=it(t.g),this.b=it(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t="srgb"){return at.fromWorkingColorSpace(pt(this,ut),t),Y(255*ut.r,0,255)<<16^Y(255*ut.g,0,255)<<8^Y(255*ut.b,0,255)<<0}getHexString(t="srgb"){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e="srgb-linear"){at.fromWorkingColorSpace(pt(this,ut),e);const n=ut.r,r=ut.g,i=ut.b,o=Math.max(n,r,i),a=Math.min(n,r,i);let s,u;const l=(a+o)/2;if(a===o)s=0,u=0;else{const t=o-a;switch(u=l<=.5?t/(o+a):t/(2-o-a),o){case n:s=(r-i)/t+(r<i?6:0);break;case r:s=(i-n)/t+2;break;case i:s=(n-r)/t+4}s/=6}return t.h=s,t.s=u,t.l=l,t}getRGB(t,e="srgb-linear"){return at.fromWorkingColorSpace(pt(this,ut),e),t.r=ut.r,t.g=ut.g,t.b=ut.b,t}getStyle(t="srgb"){return at.fromWorkingColorSpace(pt(this,ut),t),t!==F?`color(${t} ${ut.r} ${ut.g} ${ut.b})`:`rgb(${255*ut.r|0},${255*ut.g|0},${255*ut.b|0})`}offsetHSL(t,e,n){return this.getHSL(lt),lt.h+=t,lt.s+=e,lt.l+=n,this.setHSL(lt.h,lt.s,lt.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(lt),t.getHSL(ct);const n=K(lt.h,ct.h,e),r=K(lt.s,ct.s,e),i=K(lt.l,ct.l,e);return this.setHSL(n,r,i),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let dt;ft.NAMES=st,ft.prototype.isColor=!0,ft.prototype.r=1,ft.prototype.g=1,ft.prototype.b=1;class mt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===dt&&(dt=nt("canvas")),dt.width=t.width,dt.height=t.height;const n=dt.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=dt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=nt("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let t=0;t<i.length;t++)i[t]=255*rt(i[t]/255);return n.putImageData(r,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*rt(e[t]/255)):e[t]=rt(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class gt{constructor(t=null){this.uuid=X(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(yt(r[e].image)):t.push(yt(r[e]))}else t=yt(r);n.url=t}return e||(t.images[this.uuid]=n),n}}function yt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?mt.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}gt.prototype.isSource=!0;let vt=0;class _t extends G{constructor(t=_t.DEFAULT_IMAGE,e=_t.DEFAULT_MAPPING,n=1001,r=1001,i=1006,o=1008,a=1023,s=1009,u=1,l=3e3){super(),Object.defineProperty(this,"id",{value:vt++}),this.uuid=X(),this.name="",this.source=new gt(t),this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=s,this.offset=new $(0,0),this.repeat=new $(1,1),this.center=new $(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new tt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case c:t.x=t.x-Math.floor(t.x);break;case h:t.x=t.x<0?0:1;break;case p:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case c:t.y=t.y-Math.floor(t.y);break;case h:t.y=t.y<0?0:1;break;case p:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}_t.DEFAULT_IMAGE=null,_t.DEFAULT_MAPPING=300,_t.prototype.isTexture=!0;class xt{constructor(t=0,e=0,n=0,r=1){this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const o=.01,a=.1,s=t.elements,u=s[0],l=s[4],c=s[8],h=s[1],p=s[5],f=s[9],d=s[2],m=s[6],g=s[10];if(Math.abs(l-h)<o&&Math.abs(c-d)<o&&Math.abs(f-m)<o){if(Math.abs(l+h)<a&&Math.abs(c+d)<a&&Math.abs(f+m)<a&&Math.abs(u+p+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(u+1)/2,s=(p+1)/2,y=(g+1)/2,v=(l+h)/4,_=(c+d)/4,x=(f+m)/4;return t>s&&t>y?t<o?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=v/n,i=_/n):s>y?s<o?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=v/r,i=x/r):y<o?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(y),n=_/i,r=x/i),this.set(n,r,i,e),this}let y=Math.sqrt((m-f)*(m-f)+(c-d)*(c-d)+(h-l)*(h-l));return Math.abs(y)<.001&&(y=1),this.x=(m-f)/y,this.y=(c-d)/y,this.z=(h-l)/y,this.w=Math.acos((u+p+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}xt.prototype.isVector4=!0;class bt extends G{constructor(t,e,n={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new xt(0,0,t,e),this.scissorTest=!1,this.viewport=new xt(0,0,t,e);const r={width:t,height:e,depth:1};this.texture=new _t(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:d,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},t.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}bt.prototype.isWebGLRenderTarget=!0;class wt extends _t{constructor(t=null,e=1,n=1,r=1){super(null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=f,this.minFilter=f,this.wrapR=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}wt.prototype.isDataArrayTexture=!0,class extends bt{constructor(t,e,n){super(t,e),this.depth=n,this.texture=new wt(null,t,e,n),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGLArrayRenderTarget=!0;class St extends _t{constructor(t=null,e=1,n=1,r=1){super(null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=f,this.minFilter=f,this.wrapR=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}St.prototype.isData3DTexture=!0,class extends bt{constructor(t,e,n){super(t,e),this.depth=n,this.texture=new St(null,t,e,n),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGL3DRenderTarget=!0,class extends bt{constructor(t,e,n,r={}){super(t,e,r);const i=this.texture;this.texture=[];for(let t=0;t<n;t++)this.texture[t]=i.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=t,this.texture[r].image.height=e,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone();return this}}.prototype.isWebGLMultipleRenderTargets=!0;class Et{constructor(t=0,e=0,n=0,r=1){this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,r)}static slerpFlat(t,e,n,r,i,o,a){let s=n[r+0],u=n[r+1],l=n[r+2],c=n[r+3];const h=i[o+0],p=i[o+1],f=i[o+2],d=i[o+3];if(0===a)return t[e+0]=s,t[e+1]=u,t[e+2]=l,void(t[e+3]=c);if(1===a)return t[e+0]=h,t[e+1]=p,t[e+2]=f,void(t[e+3]=d);if(c!==d||s!==h||u!==p||l!==f){let t=1-a;const e=s*h+u*p+l*f+c*d,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,e*n);t=Math.sin(t*o)/i,a=Math.sin(a*o)/i}const i=a*n;if(s=s*t+h*i,u=u*t+p*i,l=l*t+f*i,c=c*t+d*i,t===1-a){const t=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=t,u*=t,l*=t,c*=t}}t[e]=s,t[e+1]=u,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,r,i,o){const a=n[r],s=n[r+1],u=n[r+2],l=n[r+3],c=i[o],h=i[o+1],p=i[o+2],f=i[o+3];return t[e]=a*f+l*c+s*p-u*h,t[e+1]=s*f+l*h+u*c-a*p,t[e+2]=u*f+l*p+a*h-s*c,t[e+3]=l*f-a*c-s*h-u*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,i=t._z,o=t._order,a=Math.cos,s=Math.sin,u=a(n/2),l=a(r/2),c=a(i/2),h=s(n/2),p=s(r/2),f=s(i/2);switch(o){case"XYZ":this._x=h*l*c+u*p*f,this._y=u*p*c-h*l*f,this._z=u*l*f+h*p*c,this._w=u*l*c-h*p*f;break;case"YXZ":this._x=h*l*c+u*p*f,this._y=u*p*c-h*l*f,this._z=u*l*f-h*p*c,this._w=u*l*c+h*p*f;break;case"ZXY":this._x=h*l*c-u*p*f,this._y=u*p*c+h*l*f,this._z=u*l*f+h*p*c,this._w=u*l*c-h*p*f;break;case"ZYX":this._x=h*l*c-u*p*f,this._y=u*p*c+h*l*f,this._z=u*l*f-h*p*c,this._w=u*l*c+h*p*f;break;case"YZX":this._x=h*l*c+u*p*f,this._y=u*p*c+h*l*f,this._z=u*l*f-h*p*c,this._w=u*l*c-h*p*f;break;case"XZY":this._x=h*l*c-u*p*f,this._y=u*p*c-h*l*f,this._z=u*l*f+h*p*c,this._w=u*l*c+h*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],o=e[1],a=e[5],s=e[9],u=e[2],l=e[6],c=e[10],h=n+a+c;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(l-s)*t,this._y=(i-u)*t,this._z=(o-r)*t}else if(n>a&&n>c){const t=2*Math.sqrt(1+n-a-c);this._w=(l-s)/t,this._x=.25*t,this._y=(r+o)/t,this._z=(i+u)/t}else if(a>c){const t=2*Math.sqrt(1+a-n-c);this._w=(i-u)/t,this._x=(r+o)/t,this._y=.25*t,this._z=(s+l)/t}else{const t=2*Math.sqrt(1+c-n-a);this._w=(o-r)/t,this._x=(i+u)/t,this._y=(s+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Y(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,s=e._y,u=e._z,l=e._w;return this._x=n*l+o*a+r*u-i*s,this._y=r*l+o*s+i*a-n*u,this._z=i*l+o*u+n*s-r*a,this._w=o*l-n*a-r*s-i*u,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,o=this._w;let a=o*t._w+n*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const s=1-a*a;if(s<=Number.EPSILON){const t=1-e;return this._w=t*o+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(s),l=Math.atan2(u,a),c=Math.sin((1-e)*l)/u,h=Math.sin(e*l)/u;return this._w=o*c+this._w*h,this._x=n*c+this._x*h,this._y=r*c+this._y*h,this._z=i*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(e*Math.cos(r),n*Math.sin(i),n*Math.cos(i),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Et.prototype.isQuaternion=!0;class Ct{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Tt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Tt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z,s=t.w,u=s*e+o*r-a*n,l=s*n+a*e-i*r,c=s*r+i*n-o*e,h=-i*e-o*n-a*r;return this.x=u*s+h*-i+l*-a-c*-o,this.y=l*s+h*-o+c*-i-u*-a,this.z=c*s+h*-a+u*-o-l*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Mt.copy(this).projectOnVector(t),this.sub(Mt)}reflect(t){return this.sub(Mt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Y(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Ct.prototype.isVector3=!0;const Mt=new Ct,Tt=new Et;class At{constructor(t=new Ct(1/0,1/0,1/0),e=new Ct(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0;for(let s=0,u=t.length;s<u;s+=3){const u=t[s],l=t[s+1],c=t[s+2];u<e&&(e=u),l<n&&(n=l),c<r&&(r=c),u>i&&(i=u),l>o&&(o=l),c>a&&(a=c)}return this.min.set(e,n,r),this.max.set(i,o,a),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0;for(let s=0,u=t.count;s<u;s++){const u=t.getX(s),l=t.getY(s),c=t.getZ(s);u<e&&(e=u),l<n&&(n=l),c<r&&(r=c),u>i&&(i=u),l>o&&(o=l),c>a&&(a=c)}return this.min.set(e,n,r),this.max.set(i,o,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Lt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n)if(e&&null!=n.attributes&&void 0!==n.attributes.position){const e=n.attributes.position;for(let n=0,r=e.count;n<r;n++)Lt.fromBufferAttribute(e,n).applyMatrix4(t.matrixWorld),this.expandByPoint(Lt)}else null===n.boundingBox&&n.computeBoundingBox(),It.copy(n.boundingBox),It.applyMatrix4(t.matrixWorld),this.union(It);const r=t.children;for(let t=0,n=r.length;t<n;t++)this.expandByObject(r[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Lt),Lt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(zt),Bt.subVectors(this.max,zt),kt.subVectors(t.a,zt),Ot.subVectors(t.b,zt),Rt.subVectors(t.c,zt),Dt.subVectors(Ot,kt),Nt.subVectors(Rt,Ot),Ft.subVectors(kt,Rt);let e=[0,-Dt.z,Dt.y,0,-Nt.z,Nt.y,0,-Ft.z,Ft.y,Dt.z,0,-Dt.x,Nt.z,0,-Nt.x,Ft.z,0,-Ft.x,-Dt.y,Dt.x,0,-Nt.y,Nt.x,0,-Ft.y,Ft.x,0];return!!Zt(e,kt,Ot,Rt,Bt)&&(e=[1,0,0,0,1,0,0,0,1],!!Zt(e,kt,Ot,Rt,Bt)&&(jt.crossVectors(Dt,Nt),e=[jt.x,jt.y,jt.z],Zt(e,kt,Ot,Rt,Bt)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Lt.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Lt).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Pt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Pt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Pt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Pt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Pt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Pt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Pt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Pt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Pt)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}At.prototype.isBox3=!0;const Pt=[new Ct,new Ct,new Ct,new Ct,new Ct,new Ct,new Ct,new Ct],Lt=new Ct,It=new At,kt=new Ct,Ot=new Ct,Rt=new Ct,Dt=new Ct,Nt=new Ct,Ft=new Ct,zt=new Ct,Bt=new Ct,jt=new Ct,Ut=new Ct;function Zt(t,e,n,r,i){for(let o=0,a=t.length-3;o<=a;o+=3){Ut.fromArray(t,o);const a=i.x*Math.abs(Ut.x)+i.y*Math.abs(Ut.y)+i.z*Math.abs(Ut.z),s=e.dot(Ut),u=n.dot(Ut),l=r.dot(Ut);if(Math.max(-Math.max(s,u,l),Math.min(s,u,l))>a)return!1}return!0}const Vt=new At,Gt=new Ct,Ht=new Ct,Wt=new Ct;class qt{constructor(t=new Ct,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Vt.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){Wt.subVectors(t,this.center);const e=Wt.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add(Wt.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return!0===this.center.equals(t.center)?Ht.set(0,0,1).multiplyScalar(t.radius):Ht.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Gt.copy(t.center).add(Ht)),this.expandByPoint(Gt.copy(t.center).sub(Ht)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Xt=new Ct,Yt=new Ct,Kt=new Ct,Qt=new Ct,Jt=new Ct,$t=new Ct,te=new Ct;class ee{constructor(t=new Ct,e=new Ct(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Xt)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Xt.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Xt.copy(this.direction).multiplyScalar(e).add(this.origin),Xt.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){Yt.copy(t).add(e).multiplyScalar(.5),Kt.copy(e).sub(t).normalize(),Qt.copy(this.origin).sub(Yt);const i=.5*t.distanceTo(e),o=-this.direction.dot(Kt),a=Qt.dot(this.direction),s=-Qt.dot(Kt),u=Qt.lengthSq(),l=Math.abs(1-o*o);let c,h,p,f;if(l>0)if(c=o*s-a,h=o*a-s,f=i*l,c>=0)if(h>=-f)if(h<=f){const t=1/l;c*=t,h*=t,p=c*(c+o*h+2*a)+h*(o*c+h+2*s)+u}else h=i,c=Math.max(0,-(o*h+a)),p=-c*c+h*(h+2*s)+u;else h=-i,c=Math.max(0,-(o*h+a)),p=-c*c+h*(h+2*s)+u;else h<=-f?(c=Math.max(0,-(-o*i+a)),h=c>0?-i:Math.min(Math.max(-i,-s),i),p=-c*c+h*(h+2*s)+u):h<=f?(c=0,h=Math.min(Math.max(-i,-s),i),p=h*(h+2*s)+u):(c=Math.max(0,-(o*i+a)),h=c>0?i:Math.min(Math.max(-i,-s),i),p=-c*c+h*(h+2*s)+u);else h=o>0?-i:i,c=Math.max(0,-(o*h+a)),p=-c*c+h*(h+2*s)+u;return n&&n.copy(this.direction).multiplyScalar(c).add(this.origin),r&&r.copy(Kt).multiplyScalar(h).add(Yt),p}intersectSphere(t,e){Xt.subVectors(t.center,this.origin);const n=Xt.dot(this.direction),r=Xt.dot(Xt)-n*n,i=t.radius*t.radius;if(r>i)return null;const o=Math.sqrt(i-r),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,o,a,s;const u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(t.min.x-h.x)*u,r=(t.max.x-h.x)*u):(n=(t.max.x-h.x)*u,r=(t.min.x-h.x)*u),l>=0?(i=(t.min.y-h.y)*l,o=(t.max.y-h.y)*l):(i=(t.max.y-h.y)*l,o=(t.min.y-h.y)*l),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),c>=0?(a=(t.min.z-h.z)*c,s=(t.max.z-h.z)*c):(a=(t.max.z-h.z)*c,s=(t.min.z-h.z)*c),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,Xt)}intersectTriangle(t,e,n,r,i){Jt.subVectors(e,t),$t.subVectors(n,t),te.crossVectors(Jt,$t);let o,a=this.direction.dot(te);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Qt.subVectors(this.origin,t);const s=o*this.direction.dot($t.crossVectors(Qt,$t));if(s<0)return null;const u=o*this.direction.dot(Jt.cross(Qt));if(u<0)return null;if(s+u>a)return null;const l=-o*Qt.dot(te);return l<0?null:this.at(l/a,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ne{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=u,g[6]=l,g[10]=c,g[14]=h,g[3]=p,g[7]=f,g[11]=d,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ne).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/re.setFromMatrixColumn(t,0).length(),i=1/re.setFromMatrixColumn(t,1).length(),o=1/re.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),u=Math.sin(r),l=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){const t=o*l,n=o*c,r=a*l,i=a*c;e[0]=s*l,e[4]=-s*c,e[8]=u,e[1]=n+r*u,e[5]=t-i*u,e[9]=-a*s,e[2]=i-t*u,e[6]=r+n*u,e[10]=o*s}else if("YXZ"===t.order){const t=s*l,n=s*c,r=u*l,i=u*c;e[0]=t+i*a,e[4]=r*a-n,e[8]=o*u,e[1]=o*c,e[5]=o*l,e[9]=-a,e[2]=n*a-r,e[6]=i+t*a,e[10]=o*s}else if("ZXY"===t.order){const t=s*l,n=s*c,r=u*l,i=u*c;e[0]=t-i*a,e[4]=-o*c,e[8]=r+n*a,e[1]=n+r*a,e[5]=o*l,e[9]=i-t*a,e[2]=-o*u,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){const t=o*l,n=o*c,r=a*l,i=a*c;e[0]=s*l,e[4]=r*u-n,e[8]=t*u+i,e[1]=s*c,e[5]=i*u+t,e[9]=n*u-r,e[2]=-u,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){const t=o*s,n=o*u,r=a*s,i=a*u;e[0]=s*l,e[4]=i-t*c,e[8]=r*c+n,e[1]=c,e[5]=o*l,e[9]=-a*l,e[2]=-u*l,e[6]=n*c+r,e[10]=t-i*c}else if("XZY"===t.order){const t=o*s,n=o*u,r=a*s,i=a*u;e[0]=s*l,e[4]=-c,e[8]=u*l,e[1]=t*c+i,e[5]=o*l,e[9]=n*c-r,e[2]=r*c-n,e[6]=a*l,e[10]=i*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(oe,t,ae)}lookAt(t,e,n){const r=this.elements;return le.subVectors(t,e),0===le.lengthSq()&&(le.z=1),le.normalize(),se.crossVectors(n,le),0===se.lengthSq()&&(1===Math.abs(n.z)?le.x+=1e-4:le.z+=1e-4,le.normalize(),se.crossVectors(n,le)),se.normalize(),ue.crossVectors(le,se),r[0]=se.x,r[4]=ue.x,r[8]=le.x,r[1]=se.y,r[5]=ue.y,r[9]=le.y,r[2]=se.z,r[6]=ue.z,r[10]=le.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],p=n[13],f=n[2],d=n[6],m=n[10],g=n[14],y=n[3],v=n[7],_=n[11],x=n[15],b=r[0],w=r[4],S=r[8],E=r[12],C=r[1],M=r[5],T=r[9],A=r[13],P=r[2],L=r[6],I=r[10],k=r[14],O=r[3],R=r[7],D=r[11],N=r[15];return i[0]=o*b+a*C+s*P+u*O,i[4]=o*w+a*M+s*L+u*R,i[8]=o*S+a*T+s*I+u*D,i[12]=o*E+a*A+s*k+u*N,i[1]=l*b+c*C+h*P+p*O,i[5]=l*w+c*M+h*L+p*R,i[9]=l*S+c*T+h*I+p*D,i[13]=l*E+c*A+h*k+p*N,i[2]=f*b+d*C+m*P+g*O,i[6]=f*w+d*M+m*L+g*R,i[10]=f*S+d*T+m*I+g*D,i[14]=f*E+d*A+m*k+g*N,i[3]=y*b+v*C+_*P+x*O,i[7]=y*w+v*M+_*L+x*R,i[11]=y*S+v*T+_*I+x*D,i[15]=y*E+v*A+_*k+x*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],u=t[13],l=t[2],c=t[6],h=t[10],p=t[14];return t[3]*(+i*s*c-r*u*c-i*a*h+n*u*h+r*a*p-n*s*p)+t[7]*(+e*s*p-e*u*h+i*o*h-r*o*p+r*u*l-i*s*l)+t[11]*(+e*u*c-e*a*p-i*o*c+n*o*p+i*a*l-n*u*l)+t[15]*(-r*a*l-e*s*c+e*a*h+r*o*c-n*o*h+n*s*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],f=t[12],d=t[13],m=t[14],g=t[15],y=c*m*u-d*h*u+d*s*p-a*m*p-c*s*g+a*h*g,v=f*h*u-l*m*u-f*s*p+o*m*p+l*s*g-o*h*g,_=l*d*u-f*c*u+f*a*p-o*d*p-l*a*g+o*c*g,x=f*c*s-l*d*s-f*a*h+o*d*h+l*a*m-o*c*m,b=e*y+n*v+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=y*w,t[1]=(d*h*i-c*m*i-d*r*p+n*m*p+c*r*g-n*h*g)*w,t[2]=(a*m*i-d*s*i+d*r*u-n*m*u-a*r*g+n*s*g)*w,t[3]=(c*s*i-a*h*i-c*r*u+n*h*u+a*r*p-n*s*p)*w,t[4]=v*w,t[5]=(l*m*i-f*h*i+f*r*p-e*m*p-l*r*g+e*h*g)*w,t[6]=(f*s*i-o*m*i-f*r*u+e*m*u+o*r*g-e*s*g)*w,t[7]=(o*h*i-l*s*i+l*r*u-e*h*u-o*r*p+e*s*p)*w,t[8]=_*w,t[9]=(f*c*i-l*d*i-f*n*p+e*d*p+l*n*g-e*c*g)*w,t[10]=(o*d*i-f*a*i+f*n*u-e*d*u-o*n*g+e*a*g)*w,t[11]=(l*a*i-o*c*i-l*n*u+e*c*u+o*n*p-e*a*p)*w,t[12]=x*w,t[13]=(l*d*r-f*c*r+f*n*h-e*d*h-l*n*m+e*c*m)*w,t[14]=(f*a*r-o*d*r-f*n*s+e*d*s+o*n*m-e*a*m)*w,t[15]=(o*c*r-l*a*r+l*n*s-e*c*s-o*n*h+e*a*h)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,a=t.y,s=t.z,u=i*o,l=i*a;return this.set(u*o+n,u*a-r*s,u*s+r*a,0,u*a+r*s,l*a+n,l*s-r*o,0,u*s-r*a,l*s+r*o,i*s*s+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,o){return this.set(1,n,i,0,t,1,o,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,o=e._y,a=e._z,s=e._w,u=i+i,l=o+o,c=a+a,h=i*u,p=i*l,f=i*c,d=o*l,m=o*c,g=a*c,y=s*u,v=s*l,_=s*c,x=n.x,b=n.y,w=n.z;return r[0]=(1-(d+g))*x,r[1]=(p+_)*x,r[2]=(f-v)*x,r[3]=0,r[4]=(p-_)*b,r[5]=(1-(h+g))*b,r[6]=(m+y)*b,r[7]=0,r[8]=(f+v)*w,r[9]=(m-y)*w,r[10]=(1-(h+d))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=re.set(r[0],r[1],r[2]).length();const o=re.set(r[4],r[5],r[6]).length(),a=re.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],ie.copy(this);const s=1/i,u=1/o,l=1/a;return ie.elements[0]*=s,ie.elements[1]*=s,ie.elements[2]*=s,ie.elements[4]*=u,ie.elements[5]*=u,ie.elements[6]*=u,ie.elements[8]*=l,ie.elements[9]*=l,ie.elements[10]*=l,e.setFromRotationMatrix(ie),n.x=i,n.y=o,n.z=a,this}makePerspective(t,e,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,s=2*i/(e-t),u=2*i/(n-r),l=(e+t)/(e-t),c=(n+r)/(n-r),h=-(o+i)/(o-i),p=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=u,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,r,i,o){const a=this.elements,s=1/(e-t),u=1/(n-r),l=1/(o-i),c=(e+t)*s,h=(n+r)*u,p=(o+i)*l;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}ne.prototype.isMatrix4=!0;const re=new Ct,ie=new ne,oe=new Ct(0,0,0),ae=new Ct(1,1,1),se=new Ct,ue=new Ct,le=new Ct,ce=new ne,he=new Et;class pe{constructor(t=0,e=0,n=0,r=pe.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,i=r[0],o=r[4],a=r[8],s=r[1],u=r[5],l=r[9],c=r[2],h=r[6],p=r[10];switch(e){case"XYZ":this._y=Math.asin(Y(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Y(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(Y(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-Y(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,p),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(Y(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-Y(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-l,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return ce.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ce,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return he.setFromEuler(this),this.setFromQuaternion(he,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}pe.prototype.isEuler=!0,pe.DefaultOrder="XYZ",pe.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class fe{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let de=0;const me=new Ct,ge=new Et,ye=new ne,ve=new Ct,_e=new Ct,xe=new Ct,be=new Et,we=new Ct(1,0,0),Se=new Ct(0,1,0),Ee=new Ct(0,0,1),Ce={type:"added"},Me={type:"removed"};class Te extends G{constructor(){super(),Object.defineProperty(this,"id",{value:de++}),this.uuid=X(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Te.DefaultUp.clone();const t=new Ct,e=new pe,n=new Et,r=new Ct(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ne},normalMatrix:{value:new tt}}),this.matrix=new ne,this.matrixWorld=new ne,this.matrixAutoUpdate=Te.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new fe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ge.setFromAxisAngle(t,e),this.quaternion.multiply(ge),this}rotateOnWorldAxis(t,e){return ge.setFromAxisAngle(t,e),this.quaternion.premultiply(ge),this}rotateX(t){return this.rotateOnAxis(we,t)}rotateY(t){return this.rotateOnAxis(Se,t)}rotateZ(t){return this.rotateOnAxis(Ee,t)}translateOnAxis(t,e){return me.copy(t).applyQuaternion(this.quaternion),this.position.add(me.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(we,t)}translateY(t){return this.translateOnAxis(Se,t)}translateZ(t){return this.translateOnAxis(Ee,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(ye.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?ve.copy(t):ve.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),_e.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ye.lookAt(_e,ve,this.up):ye.lookAt(ve,_e,this.up),this.quaternion.setFromRotationMatrix(ye),r&&(ye.extractRotation(r.matrixWorld),ge.setFromRotationMatrix(ye),this.quaternion.premultiply(ge.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ce)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Me)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Me)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ye.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ye.multiply(t.parent.matrixWorld)),t.applyMatrix4(ye),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_e,t,xe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_e,be,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=o(t.geometries),r=o(t.materials),i=o(t.textures),a=o(t.images),s=o(t.shapes),u=o(t.skeletons),l=o(t.animations),c=o(t.nodes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),u.length>0&&(n.skeletons=u),l.length>0&&(n.animations=l),c.length>0&&(n.nodes=c)}return n.object=r,n;function o(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}Te.DefaultUp=new Ct(0,1,0),Te.DefaultMatrixAutoUpdate=!0,Te.prototype.isObject3D=!0;const Ae=new Ct,Pe=new Ct,Le=new Ct,Ie=new Ct,ke=new Ct,Oe=new Ct,Re=new Ct,De=new Ct,Ne=new Ct,Fe=new Ct;class ze{constructor(t=new Ct,e=new Ct,n=new Ct){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),Ae.subVectors(t,e),r.cross(Ae);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){Ae.subVectors(r,e),Pe.subVectors(n,e),Le.subVectors(t,e);const o=Ae.dot(Ae),a=Ae.dot(Pe),s=Ae.dot(Le),u=Pe.dot(Pe),l=Pe.dot(Le),c=o*u-a*a;if(0===c)return i.set(-2,-1,-1);const h=1/c,p=(u*s-a*l)*h,f=(o*l-a*s)*h;return i.set(1-p-f,f,p)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,Ie),Ie.x>=0&&Ie.y>=0&&Ie.x+Ie.y<=1}static getUV(t,e,n,r,i,o,a,s){return this.getBarycoord(t,e,n,r,Ie),s.set(0,0),s.addScaledVector(i,Ie.x),s.addScaledVector(o,Ie.y),s.addScaledVector(a,Ie.z),s}static isFrontFacing(t,e,n,r){return Ae.subVectors(n,e),Pe.subVectors(t,e),Ae.cross(Pe).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ae.subVectors(this.c,this.b),Pe.subVectors(this.a,this.b),.5*Ae.cross(Pe).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ze.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ze.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,r,i){return ze.getUV(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return ze.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ze.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,r=this.b,i=this.c;let o,a;ke.subVectors(r,n),Oe.subVectors(i,n),De.subVectors(t,n);const s=ke.dot(De),u=Oe.dot(De);if(s<=0&&u<=0)return e.copy(n);Ne.subVectors(t,r);const l=ke.dot(Ne),c=Oe.dot(Ne);if(l>=0&&c<=l)return e.copy(r);const h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return o=s/(s-l),e.copy(n).addScaledVector(ke,o);Fe.subVectors(t,i);const p=ke.dot(Fe),f=Oe.dot(Fe);if(f>=0&&p<=f)return e.copy(i);const d=p*u-s*f;if(d<=0&&u>=0&&f<=0)return a=u/(u-f),e.copy(n).addScaledVector(Oe,a);const m=l*f-p*c;if(m<=0&&c-l>=0&&p-f>=0)return Re.subVectors(i,r),a=(c-l)/(c-l+(p-f)),e.copy(r).addScaledVector(Re,a);const g=1/(m+d+h);return o=d*g,a=h*g,e.copy(n).addScaledVector(ke,o).addScaledVector(Oe,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Be=0;class je extends G{constructor(){super(),Object.defineProperty(this,"id",{value:Be++}),this.uuid=X(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=i,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=B,this.stencilZFail=B,this.stencilZPass=B,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}je.prototype.isMaterial=!0,je.fromType=function(){return null};class Ue extends je{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new ft(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Ue.prototype.isMeshBasicMaterial=!0;const Ze=new Ct,Ve=new $;class Ge{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=j,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new ft),e[n++]=i.r,e[n++]=i.g,e[n++]=i.b}return this}copyVector2sArray(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new $),e[n++]=i.x,e[n++]=i.y}return this}copyVector3sArray(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new Ct),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z}return this}copyVector4sArray(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new xt),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z,e[n++]=i.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Ve.fromBufferAttribute(this,e),Ve.applyMatrix3(t),this.setXY(e,Ve.x,Ve.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Ze.fromBufferAttribute(this,e),Ze.applyMatrix3(t),this.setXYZ(e,Ze.x,Ze.y,Ze.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Ze.fromBufferAttribute(this,e),Ze.applyMatrix4(t),this.setXYZ(e,Ze.x,Ze.y,Ze.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Ze.fromBufferAttribute(this,e),Ze.applyNormalMatrix(t),this.setXYZ(e,Ze.x,Ze.y,Ze.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Ze.fromBufferAttribute(this,e),Ze.transformDirection(t),this.setXYZ(e,Ze.x,Ze.y,Ze.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==j&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}Ge.prototype.isBufferAttribute=!0;class He extends Ge{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class We extends Ge{constructor(t,e,n){super(new Uint32Array(t),e,n)}}(class extends Ge{constructor(t,e,n){super(new Uint16Array(t),e,n)}}).prototype.isFloat16BufferAttribute=!0;class qe extends Ge{constructor(t,e,n){super(new Float32Array(t),e,n)}}let Xe=0;const Ye=new ne,Ke=new Te,Qe=new Ct,Je=new At,$e=new At,tn=new Ct;class en extends G{constructor(){super(),Object.defineProperty(this,"id",{value:Xe++}),this.uuid=X(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(et(t)?We:He)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new tt).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ye.makeRotationFromQuaternion(t),this.applyMatrix4(Ye),this}rotateX(t){return Ye.makeRotationX(t),this.applyMatrix4(Ye),this}rotateY(t){return Ye.makeRotationY(t),this.applyMatrix4(Ye),this}rotateZ(t){return Ye.makeRotationZ(t),this.applyMatrix4(Ye),this}translate(t,e,n){return Ye.makeTranslation(t,e,n),this.applyMatrix4(Ye),this}scale(t,e,n){return Ye.makeScale(t,e,n),this.applyMatrix4(Ye),this}lookAt(t){return Ke.lookAt(t),Ke.updateMatrix(),this.applyMatrix4(Ke.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Qe).negate(),this.translate(Qe.x,Qe.y,Qe.z),this}setFromPoints(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new qe(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new At);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Ct(-1/0,-1/0,-1/0),new Ct(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Je.setFromBufferAttribute(n),this.morphTargetsRelative?(tn.addVectors(this.boundingBox.min,Je.min),this.boundingBox.expandByPoint(tn),tn.addVectors(this.boundingBox.max,Je.max),this.boundingBox.expandByPoint(tn)):(this.boundingBox.expandByPoint(Je.min),this.boundingBox.expandByPoint(Je.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new qt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Ct,1/0);if(t){const n=this.boundingSphere.center;if(Je.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];$e.setFromBufferAttribute(n),this.morphTargetsRelative?(tn.addVectors(Je.min,$e.min),Je.expandByPoint(tn),tn.addVectors(Je.max,$e.max),Je.expandByPoint(tn)):(Je.expandByPoint($e.min),Je.expandByPoint($e.max))}Je.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)tn.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(tn));if(e)for(let i=0,o=e.length;i<o;i++){const o=e[i],a=this.morphTargetsRelative;for(let e=0,i=o.count;e<i;e++)tn.fromBufferAttribute(o,e),a&&(Qe.fromBufferAttribute(t,e),tn.add(Qe)),r=Math.max(r,n.distanceToSquared(tn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,r=e.position.array,i=e.normal.array,o=e.uv.array,a=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Ge(new Float32Array(4*a),4));const s=this.getAttribute("tangent").array,u=[],l=[];for(let t=0;t<a;t++)u[t]=new Ct,l[t]=new Ct;const c=new Ct,h=new Ct,p=new Ct,f=new $,d=new $,m=new $,g=new Ct,y=new Ct;function v(t,e,n){c.fromArray(r,3*t),h.fromArray(r,3*e),p.fromArray(r,3*n),f.fromArray(o,2*t),d.fromArray(o,2*e),m.fromArray(o,2*n),h.sub(c),p.sub(c),d.sub(f),m.sub(f);const i=1/(d.x*m.y-m.x*d.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(p,-d.y).multiplyScalar(i),y.copy(p).multiplyScalar(d.x).addScaledVector(h,-m.x).multiplyScalar(i),u[t].add(g),u[e].add(g),u[n].add(g),l[t].add(y),l[e].add(y),l[n].add(y))}let _=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(let t=0,e=_.length;t<e;++t){const e=_[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)v(n[t+0],n[t+1],n[t+2])}const x=new Ct,b=new Ct,w=new Ct,S=new Ct;function E(t){w.fromArray(i,3*t),S.copy(w);const e=u[t];x.copy(e),x.sub(w.multiplyScalar(w.dot(e))).normalize(),b.crossVectors(S,e);const n=b.dot(l[t])<0?-1:1;s[4*t]=x.x,s[4*t+1]=x.y,s[4*t+2]=x.z,s[4*t+3]=n}for(let t=0,e=_.length;t<e;++t){const e=_[t],r=e.start;for(let t=r,i=r+e.count;t<i;t+=3)E(n[t+0]),E(n[t+1]),E(n[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Ge(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new Ct,i=new Ct,o=new Ct,a=new Ct,s=new Ct,u=new Ct,l=new Ct,c=new Ct;if(t)for(let h=0,p=t.count;h<p;h+=3){const p=t.getX(h+0),f=t.getX(h+1),d=t.getX(h+2);r.fromBufferAttribute(e,p),i.fromBufferAttribute(e,f),o.fromBufferAttribute(e,d),l.subVectors(o,i),c.subVectors(r,i),l.cross(c),a.fromBufferAttribute(n,p),s.fromBufferAttribute(n,f),u.fromBufferAttribute(n,d),a.add(l),s.add(l),u.add(l),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,s.x,s.y,s.z),n.setXYZ(d,u.x,u.y,u.z)}else for(let t=0,a=e.count;t<a;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),o.fromBufferAttribute(e,t+2),l.subVectors(o,i),c.subVectors(r,i),l.cross(c),n.setXYZ(t+0,l.x,l.y,l.z),n.setXYZ(t+1,l.x,l.y,l.z),n.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===t.attributes[r])continue;const i=n[r].array,o=t.attributes[r],a=o.array,s=o.itemSize*e,u=Math.min(a.length,i.length-s);for(let t=0,e=s;t<u;t++,e++)i[e]=a[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)tn.fromBufferAttribute(t,e),tn.normalize(),t.setXYZ(e,tn.x,tn.y,tn.z)}toNonIndexed(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,o=new n.constructor(e.length*r);let a=0,s=0;for(let i=0,u=e.length;i<u;i++){a=t.isInterleavedBufferAttribute?e[i]*t.data.stride+t.offset:e[i]*r;for(let t=0;t<r;t++)o[s++]=n[a++]}return new Ge(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new en,n=this.index.array,r=this.attributes;for(const i in r){const o=t(r[i],n);e.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],a=i[r];for(let e=0,r=a.length;e<r;e++){const r=t(a[e],n);o.push(r)}e.morphAttributes[r]=o}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let t=0,n=o.length;t<n;t++){const n=o[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e];t.data.attributes[e]=r.toJSON(t.data)}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],o=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];o.push(r.toJSON(t.data))}o.length>0&&(r[e]=o,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let t=0,e=o.length;t<e;t++){const e=o[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=t.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}en.prototype.isBufferGeometry=!0;const nn=new ne,rn=new ee,on=new qt,an=new Ct,sn=new Ct,un=new Ct,ln=new Ct,cn=new Ct,hn=new Ct,pn=new Ct,fn=new Ct,dn=new Ct,mn=new $,gn=new $,yn=new $,vn=new Ct,_n=new Ct;class xn extends Te{constructor(t=new en,e=new Ue){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),on.copy(n.boundingSphere),on.applyMatrix4(i),!1===t.ray.intersectsSphere(on))return;if(nn.copy(i).invert(),rn.copy(t.ray).applyMatrix4(nn),null!==n.boundingBox&&!1===rn.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,a=n.attributes.position,s=n.morphAttributes.position,u=n.morphTargetsRelative,l=n.attributes.uv,c=n.attributes.uv2,h=n.groups,p=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,f=h.length;n<f;n++){const f=h[n],d=r[f.materialIndex];for(let n=Math.max(f.start,p.start),r=Math.min(i.count,Math.min(f.start+f.count,p.start+p.count));n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),p=i.getX(n+2);o=bn(this,d,t,rn,a,s,u,l,c,r,h,p),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=f.materialIndex,e.push(o))}}else for(let n=Math.max(0,p.start),h=Math.min(i.count,p.start+p.count);n<h;n+=3){const h=i.getX(n),p=i.getX(n+1),f=i.getX(n+2);o=bn(this,r,t,rn,a,s,u,l,c,h,p,f),o&&(o.faceIndex=Math.floor(n/3),e.push(o))}else if(void 0!==a)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],f=r[i.materialIndex];for(let n=Math.max(i.start,p.start),r=Math.min(a.count,Math.min(i.start+i.count,p.start+p.count));n<r;n+=3)o=bn(this,f,t,rn,a,s,u,l,c,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,e.push(o))}else for(let n=Math.max(0,p.start),i=Math.min(a.count,p.start+p.count);n<i;n+=3)o=bn(this,r,t,rn,a,s,u,l,c,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),e.push(o))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function bn(t,e,n,r,i,o,a,s,u,l,c,h){an.fromBufferAttribute(i,l),sn.fromBufferAttribute(i,c),un.fromBufferAttribute(i,h);const p=t.morphTargetInfluences;if(o&&p){pn.set(0,0,0),fn.set(0,0,0),dn.set(0,0,0);for(let t=0,e=o.length;t<e;t++){const e=p[t],n=o[t];0!==e&&(ln.fromBufferAttribute(n,l),cn.fromBufferAttribute(n,c),hn.fromBufferAttribute(n,h),a?(pn.addScaledVector(ln,e),fn.addScaledVector(cn,e),dn.addScaledVector(hn,e)):(pn.addScaledVector(ln.sub(an),e),fn.addScaledVector(cn.sub(sn),e),dn.addScaledVector(hn.sub(un),e)))}an.add(pn),sn.add(fn),un.add(dn)}t.isSkinnedMesh&&(t.boneTransform(l,an),t.boneTransform(c,sn),t.boneTransform(h,un));const f=function(t,e,n,r,i,o,a,s){let u;if(u=1===e.side?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,2!==e.side,s),null===u)return null;_n.copy(s),_n.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(_n);return l<n.near||l>n.far?null:{distance:l,point:_n.clone(),object:t}}(t,e,n,r,an,sn,un,vn);if(f){s&&(mn.fromBufferAttribute(s,l),gn.fromBufferAttribute(s,c),yn.fromBufferAttribute(s,h),f.uv=ze.getUV(vn,an,sn,un,mn,gn,yn,new $)),u&&(mn.fromBufferAttribute(u,l),gn.fromBufferAttribute(u,c),yn.fromBufferAttribute(u,h),f.uv2=ze.getUV(vn,an,sn,un,mn,gn,yn,new $));const t={a:l,b:c,c:h,normal:new Ct,materialIndex:0};ze.getNormal(an,sn,un,t.normal),f.face=t}return f}xn.prototype.isMesh=!0;class wn extends en{constructor(t=1,e=1,n=1,r=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const a=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const s=[],u=[],l=[],c=[];let h=0,p=0;function f(t,e,n,r,i,o,f,d,m,g,y){const v=o/m,_=f/g,x=o/2,b=f/2,w=d/2,S=m+1,E=g+1;let C=0,M=0;const T=new Ct;for(let o=0;o<E;o++){const a=o*_-b;for(let s=0;s<S;s++){const h=s*v-x;T[t]=h*r,T[e]=a*i,T[n]=w,u.push(T.x,T.y,T.z),T[t]=0,T[e]=0,T[n]=d>0?1:-1,l.push(T.x,T.y,T.z),c.push(s/m),c.push(1-o/g),C+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=h+e+S*t,r=h+e+S*(t+1),i=h+(e+1)+S*(t+1),o=h+(e+1)+S*t;s.push(n,r,o),s.push(r,i,o),M+=6}a.addGroup(p,M,y),p+=M,h+=C}f("z","y","x",-1,-1,n,e,t,o,i,0),f("z","y","x",1,-1,n,e,-t,o,i,1),f("x","z","y",1,1,t,n,e,r,o,2),f("x","z","y",1,-1,t,n,-e,r,o,3),f("x","y","z",1,-1,t,e,n,r,i,4),f("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new qe(u,3)),this.setAttribute("normal",new qe(l,3)),this.setAttribute("uv",new qe(c,2))}static fromJSON(t){return new wn(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Sn(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function En(t){const e={};for(let n=0;n<t.length;n++){const r=Sn(t[n]);for(const t in r)e[t]=r[t]}return e}const Cn={clone:Sn,merge:En};class Mn extends je{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Sn(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}Mn.prototype.isShaderMaterial=!0;class Tn extends Te{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new ne,this.projectionMatrix=new ne,this.projectionMatrixInverse=new ne}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Tn.prototype.isCamera=!0;class An extends Tn{constructor(t=50,e=1,n=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*q*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*W*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*q*Math.atan(Math.tan(.5*W*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*W*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const t=o.fullWidth,a=o.fullHeight;i+=o.offsetX*r/t,e-=o.offsetY*n/a,r*=o.width/t,n*=o.height/a}const a=this.filmOffset;0!==a&&(i+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}An.prototype.isPerspectiveCamera=!0;const Pn=90;class Ln extends Te{constructor(t,e,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new An(Pn,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Ct(1,0,0)),this.add(r);const i=new An(Pn,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Ct(-1,0,0)),this.add(i);const o=new An(Pn,1,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Ct(0,1,0)),this.add(o);const a=new An(Pn,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new Ct(0,-1,0)),this.add(a);const s=new An(Pn,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Ct(0,0,1)),this.add(s);const u=new An(Pn,1,t,e);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new Ct(0,0,-1)),this.add(u)}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,o,a,s,u]=this.children,l=t.getRenderTarget(),c=t.outputEncoding,h=t.toneMapping,p=t.xr.enabled;t.outputEncoding=D,t.toneMapping=0,t.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,a),t.setRenderTarget(n,4),t.render(e,s),n.texture.generateMipmaps=f,t.setRenderTarget(n,5),t.render(e,u),t.setRenderTarget(l),t.outputEncoding=c,t.toneMapping=h,t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class In extends _t{constructor(t,e,n,r,i,a,s,u,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:o,n,r,i,a,s,u,l,c),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}In.prototype.isCubeTexture=!0;class kn extends bt{constructor(t,e={}){super(t,t,e);const n={width:t,height:t,depth:1},r=[n,n,n,n,n,n];this.texture=new In(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:d}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new wn(5,5,5),a=new Mn({name:"CubemapFromEquirect",uniforms:Sn(n),vertexShader:r,fragmentShader:i,side:1,blending:0});a.uniforms.tEquirect.value=e;const s=new xn(o,a),u=e.minFilter;return e.minFilter===m&&(e.minFilter=d),new Ln(1,10,this).update(t,s),e.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,r){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,n,r);t.setRenderTarget(i)}}kn.prototype.isWebGLCubeRenderTarget=!0;const On=new Ct,Rn=new Ct,Dn=new tt;class Nn{constructor(t=new Ct(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=On.subVectors(n,e).cross(Rn.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(On),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(n).multiplyScalar(i).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||Dn.getNormalMatrix(t),r=this.coplanarPoint(On).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Nn.prototype.isPlane=!0;const Fn=new qt,zn=new Ct;class Bn{constructor(t=new Nn,e=new Nn,n=new Nn,r=new Nn,i=new Nn,o=new Nn){this.planes=[t,e,n,r,i,o]}set(t,e,n,r,i,o){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],p=n[9],f=n[10],d=n[11],m=n[12],g=n[13],y=n[14],v=n[15];return e[0].setComponents(a-r,c-s,d-h,v-m).normalize(),e[1].setComponents(a+r,c+s,d+h,v+m).normalize(),e[2].setComponents(a+i,c+u,d+p,v+g).normalize(),e[3].setComponents(a-i,c-u,d-p,v-g).normalize(),e[4].setComponents(a-o,c-l,d-f,v-y).normalize(),e[5].setComponents(a+o,c+l,d+f,v+y).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Fn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Fn)}intersectsSprite(t){return Fn.center.set(0,0,0),Fn.radius=.7071067811865476,Fn.applyMatrix4(t.matrixWorld),this.intersectsSphere(Fn)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(zn.x=r.normal.x>0?t.max.x:t.min.x,zn.y=r.normal.y>0?t.max.y:t.min.y,zn.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(zn)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function jn(){let t=null,e=!1,n=null,r=null;function i(e,o){n(e,o),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Un(t,e){const n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))},update:function(e,i){if(e.isGLBufferAttribute){const t=r.get(e);return void((!t||t.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const o=r.get(e);void 0===o?r.set(e,function(e,r){const i=e.array,o=e.usage,a=t.createBuffer();let s;if(t.bindBuffer(r,a),t.bufferData(r,i,o),e.onUploadCallback(),i instanceof Float32Array)s=5126;else if(i instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");s=5131}else s=5123;else if(i instanceof Int16Array)s=5122;else if(i instanceof Uint32Array)s=5125;else if(i instanceof Int32Array)s=5124;else if(i instanceof Int8Array)s=5120;else if(i instanceof Uint8Array)s=5121;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);s=5121}return{buffer:a,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,i)):o.version<e.version&&(function(e,r,i){const o=r.array,a=r.updateRange;t.bindBuffer(i,e),-1===a.count?t.bufferSubData(i,0,o):(n?t.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):t.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,e,i),o.version=e.version)}}}class Zn extends en{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=t/2,o=e/2,a=Math.floor(n),s=Math.floor(r),u=a+1,l=s+1,c=t/a,h=e/s,p=[],f=[],d=[],m=[];for(let t=0;t<l;t++){const e=t*h-o;for(let n=0;n<u;n++){const r=n*c-i;f.push(r,-e,0),d.push(0,0,1),m.push(n/a),m.push(1-t/s)}}for(let t=0;t<s;t++)for(let e=0;e<a;e++){const n=e+u*t,r=e+u*(t+1),i=e+1+u*(t+1),o=e+1+u*t;p.push(n,r,o),p.push(r,i,o)}this.setIndex(p),this.setAttribute("position",new qe(f,3)),this.setAttribute("normal",new qe(d,3)),this.setAttribute("uv",new qe(m,2))}static fromJSON(t){return new Zn(t.width,t.height,t.widthSegments,t.heightSegments)}}const Vn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Gn={common:{diffuse:{value:new ft(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new tt},uv2Transform:{value:new tt},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new $(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ft(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ft(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new tt}},sprite:{diffuse:{value:new ft(16777215)},opacity:{value:1},center:{value:new $(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new tt}}},Hn={basic:{uniforms:En([Gn.common,Gn.specularmap,Gn.envmap,Gn.aomap,Gn.lightmap,Gn.fog]),vertexShader:Vn.meshbasic_vert,fragmentShader:Vn.meshbasic_frag},lambert:{uniforms:En([Gn.common,Gn.specularmap,Gn.envmap,Gn.aomap,Gn.lightmap,Gn.emissivemap,Gn.fog,Gn.lights,{emissive:{value:new ft(0)}}]),vertexShader:Vn.meshlambert_vert,fragmentShader:Vn.meshlambert_frag},phong:{uniforms:En([Gn.common,Gn.specularmap,Gn.envmap,Gn.aomap,Gn.lightmap,Gn.emissivemap,Gn.bumpmap,Gn.normalmap,Gn.displacementmap,Gn.fog,Gn.lights,{emissive:{value:new ft(0)},specular:{value:new ft(1118481)},shininess:{value:30}}]),vertexShader:Vn.meshphong_vert,fragmentShader:Vn.meshphong_frag},standard:{uniforms:En([Gn.common,Gn.envmap,Gn.aomap,Gn.lightmap,Gn.emissivemap,Gn.bumpmap,Gn.normalmap,Gn.displacementmap,Gn.roughnessmap,Gn.metalnessmap,Gn.fog,Gn.lights,{emissive:{value:new ft(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Vn.meshphysical_vert,fragmentShader:Vn.meshphysical_frag},toon:{uniforms:En([Gn.common,Gn.aomap,Gn.lightmap,Gn.emissivemap,Gn.bumpmap,Gn.normalmap,Gn.displacementmap,Gn.gradientmap,Gn.fog,Gn.lights,{emissive:{value:new ft(0)}}]),vertexShader:Vn.meshtoon_vert,fragmentShader:Vn.meshtoon_frag},matcap:{uniforms:En([Gn.common,Gn.bumpmap,Gn.normalmap,Gn.displacementmap,Gn.fog,{matcap:{value:null}}]),vertexShader:Vn.meshmatcap_vert,fragmentShader:Vn.meshmatcap_frag},points:{uniforms:En([Gn.points,Gn.fog]),vertexShader:Vn.points_vert,fragmentShader:Vn.points_frag},dashed:{uniforms:En([Gn.common,Gn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vn.linedashed_vert,fragmentShader:Vn.linedashed_frag},depth:{uniforms:En([Gn.common,Gn.displacementmap]),vertexShader:Vn.depth_vert,fragmentShader:Vn.depth_frag},normal:{uniforms:En([Gn.common,Gn.bumpmap,Gn.normalmap,Gn.displacementmap,{opacity:{value:1}}]),vertexShader:Vn.meshnormal_vert,fragmentShader:Vn.meshnormal_frag},sprite:{uniforms:En([Gn.sprite,Gn.fog]),vertexShader:Vn.sprite_vert,fragmentShader:Vn.sprite_frag},background:{uniforms:{uvTransform:{value:new tt},t2D:{value:null}},vertexShader:Vn.background_vert,fragmentShader:Vn.background_frag},cube:{uniforms:En([Gn.envmap,{opacity:{value:1}}]),vertexShader:Vn.cube_vert,fragmentShader:Vn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vn.equirect_vert,fragmentShader:Vn.equirect_frag},distanceRGBA:{uniforms:En([Gn.common,Gn.displacementmap,{referencePosition:{value:new Ct},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vn.distanceRGBA_vert,fragmentShader:Vn.distanceRGBA_frag},shadow:{uniforms:En([Gn.lights,Gn.fog,{color:{value:new ft(0)},opacity:{value:1}}]),vertexShader:Vn.shadow_vert,fragmentShader:Vn.shadow_frag}};function Wn(t,e,n,r,i,o){const a=new ft(0);let s,u,c=!0===i?0:1,h=null,p=0,f=null;function d(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),c=e,d(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,d(a,c)},render:function(n,i){let o=!1,m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=e.get(m));const g=t.xr,y=g.getSession&&g.getSession();y&&"additive"===y.environmentBlendMode&&(m=null),null===m?d(a,c):m&&m.isColor&&(d(m,1),o=!0),(t.autoClear||o)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===l)?(void 0===u&&(u=new xn(new wn(1,1,1),new Mn({name:"BackgroundCubeMaterial",uniforms:Sn(Hn.cube.uniforms),vertexShader:Hn.cube.vertexShader,fragmentShader:Hn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=m,u.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,h===m&&p===m.version&&f===t.toneMapping||(u.material.needsUpdate=!0,h=m,p=m.version,f=t.toneMapping),n.unshift(u,u.geometry,u.material,0,0,null)):m&&m.isTexture&&(void 0===s&&(s=new xn(new Zn(2,2),new Mn({name:"BackgroundMaterial",uniforms:Sn(Hn.background.uniforms),vertexShader:Hn.background.vertexShader,fragmentShader:Hn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),s.material.uniforms.uvTransform.value.copy(m.matrix),h===m&&p===m.version&&f===t.toneMapping||(s.material.needsUpdate=!0,h=m,p=m.version,f=t.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function qn(t,e,n,r){const i=t.getParameter(34921),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||null!==o,s={},u=f(null);let l=u,c=!1;function h(e){return r.isWebGL2?t.bindVertexArray(e):o.bindVertexArrayOES(e)}function p(e){return r.isWebGL2?t.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function f(t){const e=[],n=[],r=[];for(let t=0;t<i;t++)e[t]=0,n[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function d(){const t=l.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function m(t){g(t,0)}function g(n,i){const o=l.newAttributes,a=l.enabledAttributes,s=l.attributeDivisors;o[n]=1,0===a[n]&&(t.enableVertexAttribArray(n),a[n]=1),s[n]!==i&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i)}function y(){const e=l.newAttributes,n=l.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function v(e,n,i,o,a,s){!0!==r.isWebGL2||5124!==i&&5125!==i?t.vertexAttribPointer(e,n,i,o,a,s):t.vertexAttribIPointer(e,n,i,a,s)}function _(){x(),c=!0,l!==u&&(l=u,h(l.object))}function x(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(i,u,p,_,x){let b=!1;if(a){const e=function(e,n,i){const a=!0===i.wireframe;let u=s[e.id];void 0===u&&(u={},s[e.id]=u);let l=u[n.id];void 0===l&&(l={},u[n.id]=l);let c=l[a];return void 0===c&&(c=f(r.isWebGL2?t.createVertexArray():o.createVertexArrayOES()),l[a]=c),c}(_,p,u);l!==e&&(l=e,h(l.object)),b=function(t,e){const n=l.attributes,r=t.attributes;let i=0;for(const t in r){const e=n[t],o=r[t];if(void 0===e)return!0;if(e.attribute!==o)return!0;if(e.data!==o.data)return!0;i++}return l.attributesNum!==i||l.index!==e}(_,x),b&&function(t,e){const n={},r=t.attributes;let i=0;for(const t in r){const e=r[t],o={};o.attribute=e,e.data&&(o.data=e.data),n[t]=o,i++}l.attributes=n,l.attributesNum=i,l.index=e}(_,x)}else{const t=!0===u.wireframe;l.geometry===_.id&&l.program===p.id&&l.wireframe===t||(l.geometry=_.id,l.program=p.id,l.wireframe=t,b=!0)}!0===i.isInstancedMesh&&(b=!0),null!==x&&n.update(x,34963),(b||c)&&(c=!1,function(i,o,a,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;d();const u=s.attributes,l=a.getAttributes(),c=o.defaultAttributeValues;for(const e in l){const r=l[e];if(r.location>=0){let o=u[e];if(void 0===o&&("instanceMatrix"===e&&i.instanceMatrix&&(o=i.instanceMatrix),"instanceColor"===e&&i.instanceColor&&(o=i.instanceColor)),void 0!==o){const e=o.normalized,a=o.itemSize,u=n.get(o);if(void 0===u)continue;const l=u.buffer,c=u.type,h=u.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,u=n.stride,p=o.offset;if(n.isInstancedInterleavedBuffer){for(let t=0;t<r.locationSize;t++)g(r.location+t,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<r.locationSize;t++)m(r.location+t);t.bindBuffer(34962,l);for(let t=0;t<r.locationSize;t++)v(r.location+t,a/r.locationSize,c,e,u*h,(p+a/r.locationSize*t)*h)}else{if(o.isInstancedBufferAttribute){for(let t=0;t<r.locationSize;t++)g(r.location+t,o.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let t=0;t<r.locationSize;t++)m(r.location+t);t.bindBuffer(34962,l);for(let t=0;t<r.locationSize;t++)v(r.location+t,a/r.locationSize,c,e,a*h,a/r.locationSize*t*h)}}else if(void 0!==c){const n=c[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(r.location,n);break;case 3:t.vertexAttrib3fv(r.location,n);break;case 4:t.vertexAttrib4fv(r.location,n);break;default:t.vertexAttrib1fv(r.location,n)}}}}y()}(i,u,p,_),null!==x&&t.bindBuffer(34963,n.get(x).buffer))},reset:_,resetDefaultState:x,dispose:function(){_();for(const t in s){const e=s[t];for(const t in e){const n=e[t];for(const t in n)p(n[t].object),delete n[t];delete e[t]}delete s[t]}},releaseStatesOfGeometry:function(t){if(void 0===s[t.id])return;const e=s[t.id];for(const t in e){const n=e[t];for(const t in n)p(n[t].object),delete n[t];delete e[t]}delete s[t.id]},releaseStatesOfProgram:function(t){for(const e in s){const n=s[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)p(r[t].object),delete r[t];delete n[t.id]}},initAttributes:d,enableAttribute:m,disableUnusedAttributes:y}}function Xn(t,e,n,r){const i=r.isWebGL2;let o;this.setMode=function(t){o=t},this.render=function(e,r){t.drawArrays(o,e,r),n.update(r,o,1)},this.renderInstances=function(r,a,s){if(0===s)return;let u,l;if(i)u=t,l="drawArraysInstanced";else if(u=e.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===u)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[l](o,r,a,s),n.update(a,o,s)}}function Yn(t,e,n){let r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const u=o||e.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,c=t.getParameter(34930),h=t.getParameter(35660),p=t.getParameter(3379),f=t.getParameter(34076),d=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),y=t.getParameter(36349),v=h>0,_=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:u,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:p,maxCubemapSize:f,maxAttributes:d,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:y,vertexTextures:v,floatFragmentTextures:_,floatVertexTextures:v&&_,maxSamples:o?t.getParameter(36183):0}}function Kn(t){const e=this;let n=null,r=0,i=!1,o=!1;const a=new Nn,s=new tt,u={value:null,needsUpdate:!1};function l(){u.value!==n&&(u.value=n,u.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(t,n,r,i){const o=null!==t?t.length:0;let l=null;if(0!==o){if(l=u.value,!0!==i||null===l){const e=r+4*o,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===l||l.length<e)&&(l=new Float32Array(e));for(let e=0,n=r;e!==o;++e,n+=4)a.copy(t[e]).applyMatrix4(i,s),a.normal.toArray(l,n),l[n+3]=a.constant}u.value=l,u.needsUpdate=!0}return e.numPlanes=o,e.numIntersection=0,l}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,o){const a=0!==t.length||e||0!==r||i;return i=e,n=c(t,o,0),r=t.length,a},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1,l()},this.setState=function(e,a,s){const h=e.clippingPlanes,p=e.clipIntersection,f=e.clipShadows,d=t.get(e);if(!i||null===h||0===h.length||o&&!f)o?c(null):l();else{const t=o?0:r,e=4*t;let i=d.clippingState||null;u.value=i,i=c(h,a,e,s);for(let t=0;t!==e;++t)i[t]=n[t];d.clippingState=i,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=t}}}function Qn(t){let e=new WeakMap;function n(t,e){return 303===e?t.mapping=o:304===e&&(t.mapping=a),t}function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const o=i.mapping;if(303===o||304===o){if(e.has(i))return n(e.get(i).texture,i.mapping);{const o=i.image;if(o&&o.height>0){const a=new kn(o.height/2);return a.fromEquirectangularTexture(t,i),e.set(i,a),i.addEventListener("dispose",r),n(a.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}Hn.physical={uniforms:En([Hn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new $(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new ft(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new $},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ft(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new ft(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Vn.meshphysical_vert,fragmentShader:Vn.meshphysical_frag};class Jn extends Tn{constructor(t=-1,e=1,n=1,r=-1,i=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,o=n+t,a=r+e,s=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,o=i+t*this.view.width,a-=e*this.view.offsetY,s=a-e*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Jn.prototype.isOrthographicCamera=!0;const $n=[.125,.215,.35,.446,.526,.582],tr=new Jn,er=new ft;let nr=null;const rr=(1+Math.sqrt(5))/2,ir=1/rr,or=[new Ct(1,1,1),new Ct(-1,1,1),new Ct(1,1,-1),new Ct(-1,1,-1),new Ct(0,rr,ir),new Ct(0,rr,-ir),new Ct(ir,0,rr),new Ct(-ir,0,rr),new Ct(rr,ir,0),new Ct(-rr,ir,0)];class ar{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){nr=this._renderer.getRenderTarget(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=cr(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=lr(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(nr),t.scissorTest=!1,ur(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===o||t.mapping===a?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),nr=this._renderer.getRenderTarget();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize-32,n={magFilter:d,minFilter:d,generateMipmaps:!1,type:x,format:w,encoding:D,depthBuffer:!1},r=sr(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=sr(t,e,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],r=[];let i=t;const o=t-4+1+$n.length;for(let a=0;a<o;a++){const o=Math.pow(2,i);n.push(o);let s=1/o;a>t-4?s=$n[a-t+4-1]:0===a&&(s=0),r.push(s);const u=1/(o-1),l=-u/2,c=1+u/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],p=6,f=6,d=3,m=2,g=1,y=new Float32Array(d*f*p),v=new Float32Array(m*f*p),_=new Float32Array(g*f*p);for(let t=0;t<p;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];y.set(r,d*f*t),v.set(h,m*f*t);const i=[t,t,t,t,t,t];_.set(i,g*f*t)}const x=new en;x.setAttribute("position",new Ge(y,d)),x.setAttribute("uv",new Ge(v,m)),x.setAttribute("faceIndex",new Ge(_,g)),e.push(x),i>4&&i--}return{lodPlanes:e,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(t,e,n){const r=new Float32Array(20),i=new Ct(0,1,0);return new Mn({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(r,t,e)}return r}_compileMaterial(t){const e=new xn(this._lodPlanes[0],t);this._renderer.compile(e,tr)}_sceneToCubeUV(t,e,n,r){const i=new An(90,1,e,n),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,l=s.toneMapping;s.getClearColor(er),s.toneMapping=0,s.autoClear=!1;const c=new Ue({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new xn(new wn,c);let p=!1;const f=t.background;f?f.isColor&&(c.color.copy(f),t.background=null,p=!0):(c.color.copy(er),p=!0);for(let e=0;e<6;e++){const n=e%3;0===n?(i.up.set(0,o[e],0),i.lookAt(a[e],0,0)):1===n?(i.up.set(0,0,o[e]),i.lookAt(0,a[e],0)):(i.up.set(0,o[e],0),i.lookAt(0,0,a[e]));const u=this._cubeSize;ur(r,n*u,e>2?u:0,u,u),s.setRenderTarget(r),p&&s.render(h,i),s.render(t,i)}h.geometry.dispose(),h.material.dispose(),s.toneMapping=l,s.autoClear=u,t.background=f}_textureToCubeUV(t,e){const n=this._renderer,r=t.mapping===o||t.mapping===a;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=cr()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=lr());const i=r?this._cubemapMaterial:this._equirectMaterial,s=new xn(this._lodPlanes[0],i);i.uniforms.envMap.value=t;const u=this._cubeSize;ur(e,0,0,3*u,2*u),n.setRenderTarget(e),n.render(s,tr)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),r=or[(e-1)%or.length];this._blur(t,e-1,e,n,r)}e.autoClear=n}_blur(t,e,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,r,"latitudinal",i),this._halfBlur(o,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,o,a){const s=this._renderer,u=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new xn(this._lodPlanes[r],u),c=u.uniforms,h=this._sizeLods[n]-1,p=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,f=i/p,d=isFinite(i)?1+Math.floor(3*f):20;d>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${d} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/f,n=Math.exp(-e*e/2);m.push(n),0===t?g+=n:t<d&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;c.envMap.value=t.texture,c.samples.value=d,c.weights.value=m,c.latitudinal.value="latitudinal"===o,a&&(c.poleAxis.value=a);const{_lodMax:y}=this;c.dTheta.value=p,c.mipInt.value=y-n;const v=this._sizeLods[r];ur(e,3*v*(r>y-4?r-y+4:0),4*(this._cubeSize-v),3*v,2*v),s.setRenderTarget(e),s.render(l,tr)}}function sr(t,e,n){const r=new bt(t,e,n);return r.texture.mapping=l,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function ur(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function lr(){return new Mn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function cr(){return new Mn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function hr(t){let e=new WeakMap,n=null;function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping,u=303===s||304===s,l=s===o||s===a;if(u||l){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let r=e.get(i);return null===n&&(n=new ar(t)),r=u?n.fromEquirectangular(i,r):n.fromCubemap(i,r),e.set(i,r),r.texture}if(e.has(i))return e.get(i).texture;{const o=i.image;if(u&&o&&o.height>0||l&&o&&function(t){let e=0;for(let n=0;n<6;n++)void 0!==t[n]&&e++;return 6===e}(o)){null===n&&(n=new ar(t));const o=u?n.fromEquirectangular(i):n.fromCubemap(i);return e.set(i,o),i.addEventListener("dispose",r),o.texture}return null}}}return i},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function pr(t){const e={};function n(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function fr(t,e,n,r){const i={},o=new WeakMap;function a(t){const s=t.target;null!==s.index&&e.remove(s.index);for(const t in s.attributes)e.remove(s.attributes[t]);s.removeEventListener("dispose",a),delete i[s.id];const u=o.get(s);u&&(e.remove(u),o.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(t){const n=[],r=t.index,i=t.attributes.position;let a=0;if(null!==r){const t=r.array;a=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],o=t[e+2];n.push(r,i,i,o,o,r)}}else{const t=i.array;a=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}const s=new(et(n)?We:He)(n,1);s.version=a;const u=o.get(t);u&&e.remove(u),o.set(t,s)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",a),i[e.id]=!0,n.memory.geometries++),e},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const r=t.morphAttributes;for(const t in r){const n=r[t];for(let t=0,r=n.length;t<r;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=o.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&s(t)}else s(t);return o.get(t)}}}function dr(t,e,n,r){const i=r.isWebGL2;let o,a,s;this.setMode=function(t){o=t},this.setIndex=function(t){a=t.type,s=t.bytesPerElement},this.render=function(e,r){t.drawElements(o,r,a,e*s),n.update(r,o,1)},this.renderInstances=function(r,u,l){if(0===l)return;let c,h;if(i)c=t,h="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](o,u,a,r*s,l),n.update(u,o,l)}}function mr(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(e.calls++,n){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function gr(t,e){return t[0]-e[0]}function yr(t,e){return Math.abs(e[1])-Math.abs(t[1])}function vr(t,e){let n=1;const r=e.isInterleavedBufferAttribute?e.data.array:e.array;r instanceof Int8Array?n=127:r instanceof Int16Array?n=32767:r instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),t.divideScalar(n)}function _r(t,e,n){const r={},i=new Float32Array(8),o=new WeakMap,a=new xt,s=[];for(let t=0;t<8;t++)s[t]=[t,0];return{update:function(u,l,c,h){const p=u.morphTargetInfluences;if(!0===e.isWebGL2){const f=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,d=void 0!==f?f.length:0;let m=o.get(l);if(void 0===m||m.count!==d){void 0!==m&&m.texture.dispose();const v=void 0!==l.morphAttributes.position,x=void 0!==l.morphAttributes.normal,b=void 0!==l.morphAttributes.color,w=l.morphAttributes.position||[],S=l.morphAttributes.normal||[],E=l.morphAttributes.color||[];let C=0;!0===v&&(C=1),!0===x&&(C=2),!0===b&&(C=3);let M=l.attributes.position.count*C,T=1;M>e.maxTextureSize&&(T=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);const A=new Float32Array(M*T*4*d),P=new wt(A,M,T,d);P.type=_,P.needsUpdate=!0;const L=4*C;for(let k=0;k<d;k++){const O=w[k],R=S[k],D=E[k],N=M*T*4*k;for(let F=0;F<O.count;F++){const z=F*L;!0===v&&(a.fromBufferAttribute(O,F),!0===O.normalized&&vr(a,O),A[N+z+0]=a.x,A[N+z+1]=a.y,A[N+z+2]=a.z,A[N+z+3]=0),!0===x&&(a.fromBufferAttribute(R,F),!0===R.normalized&&vr(a,R),A[N+z+4]=a.x,A[N+z+5]=a.y,A[N+z+6]=a.z,A[N+z+7]=0),!0===b&&(a.fromBufferAttribute(D,F),!0===D.normalized&&vr(a,D),A[N+z+8]=a.x,A[N+z+9]=a.y,A[N+z+10]=a.z,A[N+z+11]=4===D.itemSize?a.w:1)}}function I(){P.dispose(),o.delete(l),l.removeEventListener("dispose",I)}m={count:d,texture:P,size:new $(M,T)},o.set(l,m),l.addEventListener("dispose",I)}let g=0;for(let B=0;B<p.length;B++)g+=p[B];const y=l.morphTargetsRelative?1:1-g;h.getUniforms().setValue(t,"morphTargetBaseInfluence",y),h.getUniforms().setValue(t,"morphTargetInfluences",p),h.getUniforms().setValue(t,"morphTargetsTexture",m.texture,n),h.getUniforms().setValue(t,"morphTargetsTextureSize",m.size)}else{const j=void 0===p?0:p.length;let U=r[l.id];if(void 0===U||U.length!==j){U=[];for(let W=0;W<j;W++)U[W]=[W,0];r[l.id]=U}for(let q=0;q<j;q++){const X=U[q];X[0]=q,X[1]=p[q]}U.sort(yr);for(let Y=0;Y<8;Y++)Y<j&&U[Y][1]?(s[Y][0]=U[Y][0],s[Y][1]=U[Y][1]):(s[Y][0]=Number.MAX_SAFE_INTEGER,s[Y][1]=0);s.sort(gr);const Z=l.morphAttributes.position,V=l.morphAttributes.normal;let G=0;for(let K=0;K<8;K++){const Q=s[K],J=Q[0],tt=Q[1];J!==Number.MAX_SAFE_INTEGER&&tt?(Z&&l.getAttribute("morphTarget"+K)!==Z[J]&&l.setAttribute("morphTarget"+K,Z[J]),V&&l.getAttribute("morphNormal"+K)!==V[J]&&l.setAttribute("morphNormal"+K,V[J]),i[K]=tt,G+=tt):(Z&&!0===l.hasAttribute("morphTarget"+K)&&l.deleteAttribute("morphTarget"+K),V&&!0===l.hasAttribute("morphNormal"+K)&&l.deleteAttribute("morphNormal"+K),i[K]=0)}const H=l.morphTargetsRelative?1:1-G;h.getUniforms().setValue(t,"morphTargetBaseInfluence",H),h.getUniforms().setValue(t,"morphTargetInfluences",i)}}}}function xr(t,e,n,r){let i=new WeakMap;function o(t){const e=t.target;e.removeEventListener("dispose",o),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const a=r.render.frame,s=t.geometry,u=e.get(t,s);return i.get(u)!==a&&(e.update(u),i.set(u,a)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",o)&&t.addEventListener("dispose",o),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),u},dispose:function(){i=new WeakMap}}}const br=new _t,wr=new wt,Sr=new St,Er=new In,Cr=[],Mr=[],Tr=new Float32Array(16),Ar=new Float32Array(9),Pr=new Float32Array(4);function Lr(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let o=Cr[i];if(void 0===o&&(o=new Float32Array(i),Cr[i]=o),0!==e){r.toArray(o,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(o,i)}return o}function Ir(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function kr(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function Or(t,e){let n=Mr[e];void 0===n&&(n=new Int32Array(e),Mr[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function Rr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Dr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ir(n,e))return;t.uniform2fv(this.addr,e),kr(n,e)}}function Nr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Ir(n,e))return;t.uniform3fv(this.addr,e),kr(n,e)}}function Fr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ir(n,e))return;t.uniform4fv(this.addr,e),kr(n,e)}}function zr(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Ir(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),kr(n,e)}else{if(Ir(n,r))return;Pr.set(r),t.uniformMatrix2fv(this.addr,!1,Pr),kr(n,r)}}function Br(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Ir(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),kr(n,e)}else{if(Ir(n,r))return;Ar.set(r),t.uniformMatrix3fv(this.addr,!1,Ar),kr(n,r)}}function jr(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Ir(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),kr(n,e)}else{if(Ir(n,r))return;Tr.set(r),t.uniformMatrix4fv(this.addr,!1,Tr),kr(n,r)}}function Ur(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Zr(t,e){const n=this.cache;Ir(n,e)||(t.uniform2iv(this.addr,e),kr(n,e))}function Vr(t,e){const n=this.cache;Ir(n,e)||(t.uniform3iv(this.addr,e),kr(n,e))}function Gr(t,e){const n=this.cache;Ir(n,e)||(t.uniform4iv(this.addr,e),kr(n,e))}function Hr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Wr(t,e){const n=this.cache;Ir(n,e)||(t.uniform2uiv(this.addr,e),kr(n,e))}function qr(t,e){const n=this.cache;Ir(n,e)||(t.uniform3uiv(this.addr,e),kr(n,e))}function Xr(t,e){const n=this.cache;Ir(n,e)||(t.uniform4uiv(this.addr,e),kr(n,e))}function Yr(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(e||br,i)}function Kr(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||Sr,i)}function Qr(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||Er,i)}function Jr(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||wr,i)}function $r(t,e){t.uniform1fv(this.addr,e)}function ti(t,e){const n=Lr(e,this.size,2);t.uniform2fv(this.addr,n)}function ei(t,e){const n=Lr(e,this.size,3);t.uniform3fv(this.addr,n)}function ni(t,e){const n=Lr(e,this.size,4);t.uniform4fv(this.addr,n)}function ri(t,e){const n=Lr(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function ii(t,e){const n=Lr(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function oi(t,e){const n=Lr(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function ai(t,e){t.uniform1iv(this.addr,e)}function si(t,e){t.uniform2iv(this.addr,e)}function ui(t,e){t.uniform3iv(this.addr,e)}function li(t,e){t.uniform4iv(this.addr,e)}function ci(t,e){t.uniform1uiv(this.addr,e)}function hi(t,e){t.uniform2uiv(this.addr,e)}function pi(t,e){t.uniform3uiv(this.addr,e)}function fi(t,e){t.uniform4uiv(this.addr,e)}function di(t,e,n){const r=e.length,i=Or(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.setTexture2D(e[t]||br,i[t])}function mi(t,e,n){const r=e.length,i=Or(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.setTexture3D(e[t]||Sr,i[t])}function gi(t,e,n){const r=e.length,i=Or(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.setTextureCube(e[t]||Er,i[t])}function yi(t,e,n){const r=e.length,i=Or(n,r);t.uniform1iv(this.addr,i);for(let t=0;t!==r;++t)n.setTexture2DArray(e[t]||wr,i[t])}function vi(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Rr;case 35664:return Dr;case 35665:return Nr;case 35666:return Fr;case 35674:return zr;case 35675:return Br;case 35676:return jr;case 5124:case 35670:return Ur;case 35667:case 35671:return Zr;case 35668:case 35672:return Vr;case 35669:case 35673:return Gr;case 5125:return Hr;case 36294:return Wr;case 36295:return qr;case 36296:return Xr;case 35678:case 36198:case 36298:case 36306:case 35682:return Yr;case 35679:case 36299:case 36307:return Kr;case 35680:case 36300:case 36308:case 36293:return Qr;case 36289:case 36303:case 36311:case 36292:return Jr}}(e.type)}function _i(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return $r;case 35664:return ti;case 35665:return ei;case 35666:return ni;case 35674:return ri;case 35675:return ii;case 35676:return oi;case 5124:case 35670:return ai;case 35667:case 35671:return si;case 35668:case 35672:return ui;case 35669:case 35673:return li;case 5125:return ci;case 36294:return hi;case 36295:return pi;case 36296:return fi;case 35678:case 36198:case 36298:case 36306:case 35682:return di;case 35679:case 36299:case 36307:return mi;case 35680:case 36300:case 36308:case 36293:return gi;case 36289:case 36303:case 36311:case 36292:return yi}}(e.type)}function xi(t){this.id=t,this.seq=[],this.map={}}_i.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),kr(e,t)},xi.prototype.setValue=function(t,e,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(t,e[o.id],n)}};const bi=/(\w+)(\])?(\[|\.)?/g;function wi(t,e){t.seq.push(e),t.map[e.id]=e}function Si(t,e,n){const r=t.name,i=r.length;for(bi.lastIndex=0;;){const o=bi.exec(r),a=bi.lastIndex;let s=o[1];const u="]"===o[2],l=o[3];if(u&&(s|=0),void 0===l||"["===l&&a+2===i){wi(n,void 0===l?new vi(s,t,e):new _i(s,t,e));break}{let t=n.map[s];void 0===t&&(t=new xi(s),wi(n,t)),n=t}}}function Ei(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r);Si(n,t.getUniformLocation(e,n.name),this)}}function Ci(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}Ei.prototype.setValue=function(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)},Ei.prototype.setOptional=function(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)},Ei.upload=function(t,e,n,r){for(let i=0,o=e.length;i!==o;++i){const o=e[i],a=n[o.id];!1!==a.needsUpdate&&o.setValue(t,a.value,r)}},Ei.seqWithValue=function(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n};let Mi=0;function Ti(t,e,n){const r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";const o=parseInt(/ERROR: 0:(\d+)/.exec(i)[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(t,e){const n=t.split("\n"),r=[],i=Math.max(e-6,0),o=Math.min(e+6,n.length);for(let t=i;t<o;t++)r.push(t+1+": "+n[t]);return r.join("\n")}(t.getShaderSource(e),o)}function Ai(t,e){const n=function(t){switch(t){case D:return["Linear","( value )"];case N:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Pi(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Li(t){return""!==t}function Ii(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function ki(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Oi=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ri(t){return t.replace(Oi,Di)}function Di(t,e){const n=Vn[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Ri(n)}const Ni=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Fi=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zi(t){return t.replace(Fi,ji).replace(Ni,Bi)}function Bi(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ji(0,e,n,r)}function ji(t,e,n,r){let i="";for(let t=parseInt(e);t<parseInt(n);t++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function Ui(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Zi(t,e,n,r){const i=t.getContext(),s=n.defines;let u=n.vertexShader,c=n.fragmentShader;const h=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),p=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case o:case a:e="ENVMAP_TYPE_CUBE";break;case l:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),f=function(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===a&&(e="ENVMAP_MODE_REFRACTION"),e}(n),d=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),m=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e/32+1)+3,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),g=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Li).join("\n")}(n),y=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(s),v=i.createProgram();let _,x,b=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(_=[y].filter(Li).join("\n"),_.length>0&&(_+="\n"),x=[g,y].filter(Li).join("\n"),x.length>0&&(x+="\n")):(_=[Ui(n),"#define SHADER_NAME "+n.shaderName,y,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Li).join("\n"),x=[g,Ui(n),"#define SHADER_NAME "+n.shaderName,y,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.envMap?"#define "+f:"",n.envMap?"#define "+d:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Vn.tonemapping_pars_fragment:"",0!==n.toneMapping?Pi("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Vn.encodings_pars_fragment,Ai("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Li).join("\n")),u=Ri(u),u=Ii(u,n),u=ki(u,n),c=Ri(c),c=Ii(c,n),c=ki(c,n),u=zi(u),c=zi(c),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(b="#version 300 es\n",_=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,x=["#define varying in",n.glslVersion===Z?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Z?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const w=b+x+c,S=Ci(i,35633,b+_+u),E=Ci(i,35632,w);if(i.attachShader(v,S),i.attachShader(v,E),void 0!==n.index0AttributeName?i.bindAttribLocation(v,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(v,0,"position"),i.linkProgram(v),t.debug.checkShaderErrors){const t=i.getProgramInfoLog(v).trim(),e=i.getShaderInfoLog(S).trim(),n=i.getShaderInfoLog(E).trim();let r=!0,o=!0;if(!1===i.getProgramParameter(v,35714)){r=!1;const e=Ti(i,S,"vertex"),n=Ti(i,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(v,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:e,prefix:_},fragmentShader:{log:n,prefix:x}})}let C,M;return i.deleteShader(S),i.deleteShader(E),this.getUniforms=function(){return void 0===C&&(C=new Ei(i,v)),C},this.getAttributes=function(){return void 0===M&&(M=function(t,e){const n={},r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i),o=r.name;let a=1;35674===r.type&&(a=2),35675===r.type&&(a=3),35676===r.type&&(a=4),n[o]={type:r.type,location:t.getAttribLocation(e,o),locationSize:a}}return n}(i,v)),M},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(v),this.program=void 0},this.name=n.shaderName,this.id=Mi++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=S,this.fragmentShader=E,this}let Vi=0;class Gi{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,r=this._getShaderStage(e),i=this._getShaderStage(n),o=this._getShaderCacheForMaterial(t);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(i)&&(o.add(i),i.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(!1===e.has(t)){const n=new Hi(t);e.set(t,n)}return e.get(t)}}class Hi{constructor(t){this.id=Vi++,this.code=t,this.usedTimes=0}}function Wi(t,e,n,r,i,o,a){const s=new fe,u=new Gi,c=[],h=i.isWebGL2,p=i.logarithmicDepthBuffer,f=i.floatVertexTextures,d=i.maxVertexUniforms,m=i.vertexTextures;let g=i.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(o,s,c,v,_){const x=v.fog,b=_.geometry,w=o.isMeshStandardMaterial?v.environment:null,S=(o.isMeshStandardMaterial?n:e).get(o.envMap||w),E=S&&S.mapping===l?S.image.height:null,C=y[o.type],M=_.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(f)return 1024;{const t=d,n=Math.floor((t-20)/4),r=Math.min(n,e.length);return r<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+r+"."),0):r}}(_):0;null!==o.precision&&(g=i.getMaxPrecision(o.precision),g!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",g,"instead."));const T=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,A=void 0!==T?T.length:0;let P,L,I,k,O=0;if(void 0!==b.morphAttributes.position&&(O=1),void 0!==b.morphAttributes.normal&&(O=2),void 0!==b.morphAttributes.color&&(O=3),C){const t=Hn[C];P=t.vertexShader,L=t.fragmentShader}else P=o.vertexShader,L=o.fragmentShader,u.update(o),I=u.getVertexShaderID(o),k=u.getFragmentShaderID(o);const R=t.getRenderTarget(),F=o.alphaTest>0,z=o.clearcoat>0;return{isWebGL2:h,shaderID:C,shaderName:o.type,vertexShader:P,fragmentShader:L,defines:o.defines,customVertexShaderID:I,customFragmentShaderID:k,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:g,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:m,outputEncoding:null===R?t.outputEncoding:!0===R.isXRRenderTarget?R.texture.encoding:D,map:!!o.map,matcap:!!o.matcap,envMap:!!S,envMapMode:S&&S.mapping,envMapCubeUVHeight:E,lightMap:!!o.lightMap,aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:1===o.normalMapType,tangentSpaceNormalMap:0===o.normalMapType,decodeVideoTexture:!!o.map&&!0===o.map.isVideoTexture&&o.map.encoding===N,clearcoat:z,clearcoatMap:z&&!!o.clearcoatMap,clearcoatRoughnessMap:z&&!!o.clearcoatRoughnessMap,clearcoatNormalMap:z&&!!o.clearcoatNormalMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularColorMap:!!o.specularColorMap,opaque:!1===o.transparent&&1===o.blending,alphaMap:!!o.alphaMap,alphaTest:F,gradientMap:!!o.gradientMap,sheen:o.sheen>0,sheenColorMap:!!o.sheenColorMap,sheenRoughnessMap:!!o.sheenRoughnessMap,transmission:o.transmission>0,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!b.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.displacementMap||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheenColorMap||o.sheenRoughnessMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.transmission>0||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheen>0||o.sheenColorMap||o.sheenRoughnessMap||!o.displacementMap),fog:!!x,useFog:o.fog,fogExp2:x&&x.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:p,skinning:!0===_.isSkinnedMesh&&M>0,maxBones:M,useVertexTexture:f,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:A,morphTextureStride:O,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:o.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:2===o.side,flipSided:1===o.side,depthPacking:void 0!==o.depthPacking&&o.depthPacking,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.maxBones),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection)}(n,e),function(t,e){s.disableAll(),e.isWebGL2&&s.enable(0),e.supportsVertexTextures&&s.enable(1),e.instancing&&s.enable(2),e.instancingColor&&s.enable(3),e.map&&s.enable(4),e.matcap&&s.enable(5),e.envMap&&s.enable(6),e.lightMap&&s.enable(7),e.aoMap&&s.enable(8),e.emissiveMap&&s.enable(9),e.bumpMap&&s.enable(10),e.normalMap&&s.enable(11),e.objectSpaceNormalMap&&s.enable(12),e.tangentSpaceNormalMap&&s.enable(13),e.clearcoat&&s.enable(14),e.clearcoatMap&&s.enable(15),e.clearcoatRoughnessMap&&s.enable(16),e.clearcoatNormalMap&&s.enable(17),e.displacementMap&&s.enable(18),e.specularMap&&s.enable(19),e.roughnessMap&&s.enable(20),e.metalnessMap&&s.enable(21),e.gradientMap&&s.enable(22),e.alphaMap&&s.enable(23),e.alphaTest&&s.enable(24),e.vertexColors&&s.enable(25),e.vertexAlphas&&s.enable(26),e.vertexUvs&&s.enable(27),e.vertexTangents&&s.enable(28),e.uvsVertexOnly&&s.enable(29),e.fog&&s.enable(30),t.push(s.mask),s.disableAll(),e.useFog&&s.enable(0),e.flatShading&&s.enable(1),e.logarithmicDepthBuffer&&s.enable(2),e.skinning&&s.enable(3),e.useVertexTexture&&s.enable(4),e.morphTargets&&s.enable(5),e.morphNormals&&s.enable(6),e.morphColors&&s.enable(7),e.premultipliedAlpha&&s.enable(8),e.shadowMapEnabled&&s.enable(9),e.physicallyCorrectLights&&s.enable(10),e.doubleSided&&s.enable(11),e.flipSided&&s.enable(12),e.depthPacking&&s.enable(13),e.dithering&&s.enable(14),e.specularIntensityMap&&s.enable(15),e.specularColorMap&&s.enable(16),e.transmission&&s.enable(17),e.transmissionMap&&s.enable(18),e.thicknessMap&&s.enable(19),e.sheen&&s.enable(20),e.sheenColorMap&&s.enable(21),e.sheenRoughnessMap&&s.enable(22),e.decodeVideoTexture&&s.enable(23),e.opaque&&s.enable(24),t.push(s.mask)}(n,e),n.push(t.outputEncoding)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=y[t.type];let n;if(e){const t=Hn[e];n=Cn.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let r;for(let t=0,e=c.length;t<e;t++){const e=c[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new Zi(t,n,e,o),c.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){const e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},releaseShaderCache:function(t){u.remove(t)},programs:c,dispose:function(){u.dispose()}}}function qi(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function Xi(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Yi(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ki(){const t=[];let e=0;const n=[],r=[],i=[];function o(n,r,i,o,a,s){let u=t[e];return void 0===u?(u={id:n.id,object:n,geometry:r,material:i,groupOrder:o,renderOrder:n.renderOrder,z:a,group:s},t[e]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=i,u.groupOrder=o,u.renderOrder=n.renderOrder,u.z=a,u.group=s),e++,u}return{opaque:n,transmissive:r,transparent:i,init:function(){e=0,n.length=0,r.length=0,i.length=0},push:function(t,e,a,s,u,l){const c=o(t,e,a,s,u,l);a.transmission>0?r.push(c):!0===a.transparent?i.push(c):n.push(c)},unshift:function(t,e,a,s,u,l){const c=o(t,e,a,s,u,l);a.transmission>0?r.unshift(c):!0===a.transparent?i.unshift(c):n.unshift(c)},finish:function(){for(let n=e,r=t.length;n<r;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||Xi),r.length>1&&r.sort(e||Yi),i.length>1&&i.sort(e||Yi)}}}function Qi(){let t=new WeakMap;return{get:function(e,n){let r;return!1===t.has(e)?(r=new Ki,t.set(e,[r])):n>=t.get(e).length?(r=new Ki,t.get(e).push(r)):r=t.get(e)[n],r},dispose:function(){t=new WeakMap}}}function Ji(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Ct,color:new ft};break;case"SpotLight":n={position:new Ct,direction:new Ct,color:new ft,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ct,color:new ft,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ct,skyColor:new ft,groundColor:new ft};break;case"RectAreaLight":n={color:new ft,position:new Ct,halfWidth:new Ct,halfHeight:new Ct}}return t[e.id]=n,n}}}let $i=0;function to(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function eo(t,e){const n=new Ji,r=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)i.probe.push(new Ct);const o=new Ct,a=new ne,s=new ne;return{setup:function(o,a){let s=0,u=0,l=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let c=0,h=0,p=0,f=0,d=0,m=0,g=0,y=0;o.sort(to);const v=!0!==a?Math.PI:1;for(let t=0,e=o.length;t<e;t++){const e=o[t],a=e.color,_=e.intensity,x=e.distance,b=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)s+=a.r*_*v,u+=a.g*_*v,l+=a.b*_*v;else if(e.isLightProbe)for(let t=0;t<9;t++)i.probe[t].addScaledVector(e.sh.coefficients[t],_);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*v),e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.directionalShadow[c]=n,i.directionalShadowMap[c]=b,i.directionalShadowMatrix[c]=e.shadow.matrix,m++}i.directional[c]=t,c++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(a).multiplyScalar(_*v),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.spotShadow[p]=n,i.spotShadowMap[p]=b,i.spotShadowMatrix[p]=e.shadow.matrix,y++}i.spot[p]=t,p++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(a).multiplyScalar(_),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),i.rectArea[f]=t,f++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*v),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,i.pointShadow[h]=n,i.pointShadowMap[h]=b,i.pointShadowMatrix[h]=e.shadow.matrix,g++}i.point[h]=t,h++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(_*v),t.groundColor.copy(e.groundColor).multiplyScalar(_*v),i.hemi[d]=t,d++}}f>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=Gn.LTC_FLOAT_1,i.rectAreaLTC2=Gn.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=Gn.LTC_HALF_1,i.rectAreaLTC2=Gn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=u,i.ambient[2]=l;const _=i.hash;_.directionalLength===c&&_.pointLength===h&&_.spotLength===p&&_.rectAreaLength===f&&_.hemiLength===d&&_.numDirectionalShadows===m&&_.numPointShadows===g&&_.numSpotShadows===y||(i.directional.length=c,i.spot.length=p,i.rectArea.length=f,i.point.length=h,i.hemi.length=d,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=y,i.spotShadowMap.length=y,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=y,_.directionalLength=c,_.pointLength=h,_.spotLength=p,_.rectAreaLength=f,_.hemiLength=d,_.numDirectionalShadows=m,_.numPointShadows=g,_.numSpotShadows=y,i.version=$i++)},setupView:function(t,e){let n=0,r=0,u=0,l=0,c=0;const h=e.matrixWorldInverse;for(let e=0,p=t.length;e<p;e++){const p=t[e];if(p.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),t.direction.sub(o),t.direction.transformDirection(h),n++}else if(p.isSpotLight){const t=i.spot[u];t.position.setFromMatrixPosition(p.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),t.direction.sub(o),t.direction.transformDirection(h),u++}else if(p.isRectAreaLight){const t=i.rectArea[l];t.position.setFromMatrixPosition(p.matrixWorld),t.position.applyMatrix4(h),s.identity(),a.copy(p.matrixWorld),a.premultiply(h),s.extractRotation(a),t.halfWidth.set(.5*p.width,0,0),t.halfHeight.set(0,.5*p.height,0),t.halfWidth.applyMatrix4(s),t.halfHeight.applyMatrix4(s),l++}else if(p.isPointLight){const t=i.point[r];t.position.setFromMatrixPosition(p.matrixWorld),t.position.applyMatrix4(h),r++}else if(p.isHemisphereLight){const t=i.hemi[c];t.direction.setFromMatrixPosition(p.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),c++}}},state:i}}function no(t,e){const n=new eo(t,e),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(t){n.setup(r,t)},setupLightsView:function(t){n.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){i.push(t)}}}function ro(t,e){let n=new WeakMap;return{get:function(r,i=0){let o;return!1===n.has(r)?(o=new no(t,e),n.set(r,[o])):i>=n.get(r).length?(o=new no(t,e),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}class io extends je{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}io.prototype.isMeshDepthMaterial=!0;class oo extends je{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Ct,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function ao(t,e,n){let r=new Bn;const i=new $,o=new $,a=new xt,s=new io({depthPacking:3201}),u=new oo,l={},c=n.maxTextureSize,h={0:1,1:0,2:2},p=new Mn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new $},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=p.clone();d.defines.HORIZONTAL_PASS=1;const m=new en;m.setAttribute("position",new Ge(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new xn(m,p),y=this;function v(n,r){const i=e.update(g);p.defines.VSM_SAMPLES!==n.blurSamples&&(p.defines.VSM_SAMPLES=n.blurSamples,d.defines.VSM_SAMPLES=n.blurSamples,p.needsUpdate=!0,d.needsUpdate=!0),p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,p,g,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,d,g,null)}function _(e,n,r,i,o,a){let c=null;const p=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(c=void 0!==p?p:!0===r.isPointLight?u:s,t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const t=c.uuid,e=n.uuid;let r=l[t];void 0===r&&(r={},l[t]=r);let i=r[e];void 0===i&&(i=c.clone(),r[e]=i),c=i}return c.visible=n.visible,c.wireframe=n.wireframe,c.side=3===a?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],c.alphaMap=n.alphaMap,c.alphaTest=n.alphaTest,c.clipShadows=n.clipShadows,c.clippingPlanes=n.clippingPlanes,c.clipIntersection=n.clipIntersection,c.displacementMap=n.displacementMap,c.displacementScale=n.displacementScale,c.displacementBias=n.displacementBias,c.wireframeLinewidth=n.wireframeLinewidth,c.linewidth=n.linewidth,!0===r.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(r.matrixWorld),c.nearDistance=i,c.farDistance=o),c}function x(n,i,o,a,s){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=e.update(n),i=n.material;if(Array.isArray(i)){const e=r.groups;for(let u=0,l=e.length;u<l;u++){const l=e[u],c=i[l.materialIndex];if(c&&c.visible){const e=_(n,c,a,o.near,o.far,s);t.renderBufferDirect(o,null,r,e,n,l)}}}else if(i.visible){const e=_(n,i,a,o.near,o.far,s);t.renderBufferDirect(o,null,r,e,n,null)}}const u=n.children;for(let t=0,e=u.length;t<e;t++)x(u[t],i,o,a,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,n,s){if(!1===y.enabled)return;if(!1===y.autoUpdate&&!1===y.needsUpdate)return;if(0===e.length)return;const u=t.getRenderTarget(),l=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),p=t.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let u=0,l=e.length;u<l;u++){const l=e[u],h=l.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const d=h.getFrameExtents();if(i.multiply(d),o.copy(h.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(o.x=Math.floor(c/d.x),i.x=o.x*d.x,h.mapSize.x=o.x),i.y>c&&(o.y=Math.floor(c/d.y),i.y=o.y*d.y,h.mapSize.y=o.y)),null!==h.map||h.isPointLightShadow||3!==this.type||(h.map=new bt(i.x,i.y),h.map.texture.name=l.name+".shadowMap",h.mapPass=new bt(i.x,i.y),h.camera.updateProjectionMatrix()),null===h.map){const t={minFilter:f,magFilter:f,format:w};h.map=new bt(i.x,i.y,t),h.map.texture.name=l.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const m=h.getViewportCount();for(let t=0;t<m;t++){const e=h.getViewport(t);a.set(o.x*e.x,o.y*e.y,o.x*e.z,o.y*e.w),p.viewport(a),h.updateMatrices(l,t),r=h.getFrustum(),x(n,s,h.camera,l,this.type)}h.isPointLightShadow||3!==this.type||v(h,s),h.needsUpdate=!1}y.needsUpdate=!1,t.setRenderTarget(u,l,h)}}function so(t,e,n){const r=n.isWebGL2,o=new function(){let e=!1;const n=new xt;let r=null;const i=new xt(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,o,a,s){!0===s&&(e*=a,r*=a,o*=a),n.set(e,r,o,a),!1===i.equals(n)&&(t.clearColor(e,r,o,a),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},a=new function(){let e=!1,n=null,r=null,i=null;return{setTest:function(t){t?B(2929):j(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},s=new function(){let e=!1,n=null,r=null,i=null,o=null,a=null,s=null,u=null,l=null;return{setTest:function(t){e||(t?B(2960):j(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,a){r===e&&i===n&&o===a||(t.stencilFunc(e,n,a),r=e,i=n,o=a)},setOp:function(e,n,r){a===e&&s===n&&u===r||(t.stencilOp(e,n,r),a=e,s=n,u=r)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,n=null,r=null,i=null,o=null,a=null,s=null,u=null,l=null}}};let u={},l={},c=new WeakMap,h=[],p=null,f=!1,d=null,m=null,g=null,y=null,v=null,_=null,x=null,b=!1,w=null,S=null,E=null,C=null,M=null;const T=t.getParameter(35661);let A=!1,P=0;const L=t.getParameter(7938);-1!==L.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(L)[1]),A=P>=1):-1!==L.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),A=P>=2);let I=null,k={};const O=t.getParameter(3088),R=t.getParameter(2978),D=(new xt).fromArray(O),N=(new xt).fromArray(R);function F(e,n,r){const i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<r;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,i);return o}const z={};function B(e){!0!==u[e]&&(t.enable(e),u[e]=!0)}function j(e){!1!==u[e]&&(t.disable(e),u[e]=!1)}z[3553]=F(3553,3553,1),z[34067]=F(34067,34069,6),o.setClear(0,0,0,1),a.setClear(1),s.setClear(0),B(2929),a.setFunc(3),G(!1),H(1),B(2884),V(0);const U={[i]:32774,101:32778,102:32779};if(r)U[103]=32775,U[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(U[103]=t.MIN_EXT,U[104]=t.MAX_EXT)}const Z={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function V(e,n,r,o,a,s,u,l){if(0!==e){if(!1===f&&(B(3042),f=!0),5===e)a=a||n,s=s||r,u=u||o,n===m&&a===v||(t.blendEquationSeparate(U[n],U[a]),m=n,v=a),r===g&&o===y&&s===_&&u===x||(t.blendFuncSeparate(Z[r],Z[o],Z[s],Z[u]),g=r,y=o,_=s,x=u),d=e,b=null;else if(e!==d||l!==b){if(m===i&&v===i||(t.blendEquation(32774),m=i,v=i),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}g=null,y=null,_=null,x=null,d=e,b=l}}else!0===f&&(j(3042),f=!1)}function G(e){w!==e&&(e?t.frontFace(2304):t.frontFace(2305),w=e)}function H(e){0!==e?(B(2884),e!==S&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):j(2884),S=e}function W(e,n,r){e?(B(32823),C===n&&M===r||(t.polygonOffset(n,r),C=n,M=r)):j(32823)}function q(e){void 0===e&&(e=33984+T-1),I!==e&&(t.activeTexture(e),I=e)}return{buffers:{color:o,depth:a,stencil:s},enable:B,disable:j,bindFramebuffer:function(e,n){return l[e]!==n&&(t.bindFramebuffer(e,n),l[e]=n,r&&(36009===e&&(l[36160]=n),36160===e&&(l[36009]=n)),!0)},drawBuffers:function(r,i){let o=h,a=!1;if(r)if(o=c.get(i),void 0===o&&(o=[],c.set(i,o)),r.isWebGLMultipleRenderTargets){const t=r.texture;if(o.length!==t.length||36064!==o[0]){for(let e=0,n=t.length;e<n;e++)o[e]=36064+e;o.length=t.length,a=!0}}else 36064!==o[0]&&(o[0]=36064,a=!0);else 1029!==o[0]&&(o[0]=1029,a=!0);a&&(n.isWebGL2?t.drawBuffers(o):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(o))},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:V,setMaterial:function(t,e){2===t.side?j(2884):B(2884);let n=1===t.side;e&&(n=!n),G(n),1===t.blending&&!1===t.transparent?V(0):V(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),o.setMask(t.colorWrite);const r=t.stencilWrite;s.setTest(r),r&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),W(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?B(32926):j(32926)},setFlipSided:G,setCullFace:H,setLineWidth:function(e){e!==E&&(A&&t.lineWidth(e),E=e)},setPolygonOffset:W,setScissorTest:function(t){t?B(3089):j(3089)},activeTexture:q,bindTexture:function(e,n){null===I&&q();let r=k[I];void 0===r&&(r={type:void 0,texture:void 0},k[I]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||z[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=k[I];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===D.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),D.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===r&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},I=null,k={},l={},c=new WeakMap,h=[],p=null,f=!1,d=null,m=null,g=null,y=null,v=null,_=null,x=null,b=!1,w=null,S=null,E=null,C=null,M=null,D.set(0,0,t.canvas.width,t.canvas.height),N.set(0,0,t.canvas.width,t.canvas.height),o.reset(),a.reset(),s.reset()}}}function uo(t,e,n,r,i,o,a){const s=i.isWebGL2,u=i.maxTextures,l=i.maxCubemapSize,C=i.maxTextureSize,M=i.maxSamples,T=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,A=/OculusBrowser/g.test(navigator.userAgent),P=new WeakMap;let L;const I=new WeakMap;let k=!1;try{k="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function O(t,e){return k?new OffscreenCanvas(t,e):nt("canvas")}function R(t,e,n,r){let i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const r=e?J:Math.floor,o=r(i*t.width),a=r(i*t.height);void 0===L&&(L=O(o,a));const s=n?O(o,a):L;return s.width=o,s.height=a,s.getContext("2d").drawImage(t,0,0,o,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+a+")."),s}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function F(t){return Q(t.width)&&Q(t.height)}function z(t,e){return t.generateMipmaps&&e&&t.minFilter!==f&&t.minFilter!==d}function B(e){t.generateMipmap(e)}function j(n,r,i,o,a=!1){if(!1===s)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let u=r;return 6403===r&&(5126===i&&(u=33326),5131===i&&(u=33325),5121===i&&(u=33321)),33319===r&&(5126===i&&(u=33328),5131===i&&(u=33327),5121===i&&(u=33323)),6408===r&&(5126===i&&(u=34836),5131===i&&(u=34842),5121===i&&(u=o===N&&!1===a?35907:32856),32819===i&&(u=32854),32820===i&&(u=32855)),33325!==u&&33326!==u&&33327!==u&&33328!==u&&34842!==u&&34836!==u||e.get("EXT_color_buffer_float"),u}function U(t,e,n){return!0===z(t,n)||t.isFramebufferTexture&&t.minFilter!==f&&t.minFilter!==d?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function Z(t){return t===f||1004===t||1005===t?9728:9729}function G(t){const e=t.target;e.removeEventListener("dispose",G),function(t){const e=r.get(t);if(void 0===e.__webglInit)return;const n=t.source,i=I.get(n);if(i){const r=i[e.__cacheKey];r.usedTimes--,0===r.usedTimes&&W(t),0===Object.keys(i).length&&I.delete(n)}r.remove(t)}(e),e.isVideoTexture&&P.delete(e)}function H(e){const n=e.target;n.removeEventListener("dispose",H),function(e){const n=e.texture,i=r.get(e),o=r.get(n);if(void 0!==o.__webglTexture&&(t.deleteTexture(o.__webglTexture),a.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(i.__webglFramebuffer[e]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[e]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,i=n.length;e<i;e++){const i=r.get(n[e]);i.__webglTexture&&(t.deleteTexture(i.__webglTexture),a.memory.textures--),r.remove(n[e])}r.remove(n),r.remove(e)}(n)}function W(e){const n=r.get(e);t.deleteTexture(n.__webglTexture);const i=e.source;delete I.get(i)[n.__cacheKey],a.memory.textures--}let q=0;function X(t,e){const i=r.get(t);if(t.isVideoTexture&&function(t){const e=a.render.frame;P.get(t)!==e&&(P.set(t,e),t.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&i.__version!==t.version){const n=t.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void et(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}const Y={[c]:10497,[h]:33071,[p]:33648},K={[f]:9728,1004:9984,1005:9986,[d]:9729,1007:9985,[m]:9987};function $(n,o,a){if(a?(t.texParameteri(n,10242,Y[o.wrapS]),t.texParameteri(n,10243,Y[o.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,Y[o.wrapR]),t.texParameteri(n,10240,K[o.magFilter]),t.texParameteri(n,10241,K[o.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),o.wrapS===h&&o.wrapT===h||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,Z(o.magFilter)),t.texParameteri(n,10241,Z(o.minFilter)),o.minFilter!==f&&o.minFilter!==d&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const a=e.get("EXT_texture_filter_anisotropic");if(o.type===_&&!1===e.has("OES_texture_float_linear"))return;if(!1===s&&o.type===x&&!1===e.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(t.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function tt(e,n){let r=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",G));const i=n.source;let o=I.get(i);void 0===o&&(o={},I.set(i,o));const s=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(n);if(s!==e.__cacheKey){void 0===o[s]&&(o[s]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,r=!0),o[s].usedTimes++;const i=o[e.__cacheKey];void 0!==i&&(o[e.__cacheKey].usedTimes--,0===i.usedTimes&&W(n)),e.__cacheKey=s,e.__webglTexture=o[s].texture}return r}function et(e,r,i){let a=3553;r.isDataArrayTexture&&(a=35866),r.isData3DTexture&&(a=32879);const u=tt(e,r),l=r.source;if(n.activeTexture(33984+i),n.bindTexture(a,e.__webglTexture),l.version!==l.__currentVersion||!0===u){t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);const i=function(t){return!s&&(t.wrapS!==h||t.wrapT!==h||t.minFilter!==f&&t.minFilter!==d)}(r)&&!1===F(r.image);let u=R(r.image,i,!1,C);u=ut(r,u);const c=F(u)||s,p=o.convert(r.format,r.encoding);let m,g=o.convert(r.type),x=j(r.internalFormat,p,g,r.encoding,r.isVideoTexture);$(a,r,c);const M=r.mipmaps,T=s&&!0!==r.isVideoTexture,A=void 0===e.__version,P=U(r,u,c);if(r.isDepthTexture)x=6402,s?x=r.type===_?36012:r.type===v?33190:r.type===b?35056:33189:r.type===_&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===S&&6402===x&&r.type!==y&&r.type!==v&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=y,g=o.convert(r.type)),r.format===E&&6402===x&&(x=34041,r.type!==b&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=b,g=o.convert(r.type))),T&&A?n.texStorage2D(3553,1,x,u.width,u.height):n.texImage2D(3553,0,x,u.width,u.height,0,p,g,null);else if(r.isDataTexture)if(M.length>0&&c){T&&A&&n.texStorage2D(3553,P,x,M[0].width,M[0].height);for(let t=0,e=M.length;t<e;t++)m=M[t],T?n.texSubImage2D(3553,t,0,0,m.width,m.height,p,g,m.data):n.texImage2D(3553,t,x,m.width,m.height,0,p,g,m.data);r.generateMipmaps=!1}else T?(A&&n.texStorage2D(3553,P,x,u.width,u.height),n.texSubImage2D(3553,0,0,0,u.width,u.height,p,g,u.data)):n.texImage2D(3553,0,x,u.width,u.height,0,p,g,u.data);else if(r.isCompressedTexture){T&&A&&n.texStorage2D(3553,P,x,M[0].width,M[0].height);for(let t=0,e=M.length;t<e;t++)m=M[t],r.format!==w?null!==p?T?n.compressedTexSubImage2D(3553,t,0,0,m.width,m.height,p,m.data):n.compressedTexImage2D(3553,t,x,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?n.texSubImage2D(3553,t,0,0,m.width,m.height,p,g,m.data):n.texImage2D(3553,t,x,m.width,m.height,0,p,g,m.data)}else if(r.isDataArrayTexture)T?(A&&n.texStorage3D(35866,P,x,u.width,u.height,u.depth),n.texSubImage3D(35866,0,0,0,0,u.width,u.height,u.depth,p,g,u.data)):n.texImage3D(35866,0,x,u.width,u.height,u.depth,0,p,g,u.data);else if(r.isData3DTexture)T?(A&&n.texStorage3D(32879,P,x,u.width,u.height,u.depth),n.texSubImage3D(32879,0,0,0,0,u.width,u.height,u.depth,p,g,u.data)):n.texImage3D(32879,0,x,u.width,u.height,u.depth,0,p,g,u.data);else if(r.isFramebufferTexture)T&&A?n.texStorage2D(3553,P,x,u.width,u.height):n.texImage2D(3553,0,x,u.width,u.height,0,p,g,null);else if(M.length>0&&c){T&&A&&n.texStorage2D(3553,P,x,M[0].width,M[0].height);for(let t=0,e=M.length;t<e;t++)m=M[t],T?n.texSubImage2D(3553,t,0,0,p,g,m):n.texImage2D(3553,t,x,p,g,m);r.generateMipmaps=!1}else T?(A&&n.texStorage2D(3553,P,x,u.width,u.height),n.texSubImage2D(3553,0,0,0,p,g,u)):n.texImage2D(3553,0,x,p,g,u);z(r,c)&&B(a),l.__currentVersion=l.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}function rt(e,i,a,s,u){const l=o.convert(a.format,a.encoding),c=o.convert(a.type),h=j(a.internalFormat,l,c,a.encoding);r.get(i).__hasExternalTextures||(32879===u||35866===u?n.texImage3D(u,0,h,i.width,i.height,i.depth,0,l,c,null):n.texImage2D(u,0,h,i.width,i.height,0,l,c,null)),n.bindFramebuffer(36160,e),st(i)?T.framebufferTexture2DMultisampleEXT(36160,s,u,r.get(a).__webglTexture,0,at(i)):t.framebufferTexture2D(36160,s,u,r.get(a).__webglTexture,0),n.bindFramebuffer(36160,null)}function it(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r||st(n)){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===_?i=36012:e.type===v&&(i=33190));const r=at(n);st(n)?T.renderbufferStorageMultisampleEXT(36161,r,i,n.width,n.height):t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else t.renderbufferStorage(36161,i,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){const i=at(n);r&&!1===st(n)?t.renderbufferStorageMultisample(36161,i,35056,n.width,n.height):st(n)?T.renderbufferStorageMultisampleEXT(36161,i,35056,n.width,n.height):t.renderbufferStorage(36161,34041,n.width,n.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,i=o.convert(e.format,e.encoding),a=o.convert(e.type),s=j(e.internalFormat,i,a,e.encoding),u=at(n);r&&!1===st(n)?t.renderbufferStorageMultisample(36161,u,s,n.width,n.height):st(n)?T.renderbufferStorageMultisampleEXT(36161,u,s,n.width,n.height):t.renderbufferStorage(36161,s,n.width,n.height)}t.bindRenderbuffer(36161,null)}function ot(e){const i=r.get(e),o=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!i.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),X(i.depthTexture,0);const o=r.get(i.depthTexture).__webglTexture,a=at(i);if(i.depthTexture.format===S)st(i)?T.framebufferTexture2DMultisampleEXT(36160,36096,3553,o,0,a):t.framebufferTexture2D(36160,36096,3553,o,0);else{if(i.depthTexture.format!==E)throw new Error("Unknown depthTexture format");st(i)?T.framebufferTexture2DMultisampleEXT(36160,33306,3553,o,0,a):t.framebufferTexture2D(36160,33306,3553,o,0)}}(i.__webglFramebuffer,e)}else if(o){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(36160,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=t.createRenderbuffer(),it(i.__webglDepthbuffer[r],e,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),it(i.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function at(t){return Math.min(M,t.samples)}function st(t){const n=r.get(t);return s&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function ut(t,n){const r=t.encoding,i=t.format,o=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===V||r!==D&&(r===N?!1===s?!0===e.has("EXT_sRGB")&&i===w?(t.format=V,t.minFilter=d,t.generateMipmaps=!1):n=mt.sRGBToLinear(n):i===w&&o===g||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),n}this.allocateTextureUnit=function(){const t=q;return t>=u&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+u),q+=1,t},this.resetTextureUnits=function(){q=0},this.setTexture2D=X,this.setTexture2DArray=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?et(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?et(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=function(e,i){const a=r.get(e);e.version>0&&a.__version!==e.version?function(e,r,i){if(6!==r.image.length)return;const a=tt(e,r),u=r.source;if(n.activeTexture(33984+i),n.bindTexture(34067,e.__webglTexture),u.version!==u.__currentVersion||!0===a){t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);const i=r.isCompressedTexture||r.image[0].isCompressedTexture,a=r.image[0]&&r.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=i||a?a?r.image[t].image:r.image[t]:R(r.image[t],!1,!0,l),c[t]=ut(r,c[t]);const h=c[0],p=F(h)||s,f=o.convert(r.format,r.encoding),d=o.convert(r.type),m=j(r.internalFormat,f,d,r.encoding),g=s&&!0!==r.isVideoTexture,y=void 0===e.__version;let v,_=U(r,h,p);if($(34067,r,p),i){g&&y&&n.texStorage2D(34067,_,m,h.width,h.height);for(let t=0;t<6;t++){v=c[t].mipmaps;for(let e=0;e<v.length;e++){const i=v[e];r.format!==w?null!==f?g?n.compressedTexSubImage2D(34069+t,e,0,0,i.width,i.height,f,i.data):n.compressedTexImage2D(34069+t,e,m,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g?n.texSubImage2D(34069+t,e,0,0,i.width,i.height,f,d,i.data):n.texImage2D(34069+t,e,m,i.width,i.height,0,f,d,i.data)}}}else{v=r.mipmaps,g&&y&&(v.length>0&&_++,n.texStorage2D(34067,_,m,c[0].width,c[0].height));for(let t=0;t<6;t++)if(a){g?n.texSubImage2D(34069+t,0,0,0,c[t].width,c[t].height,f,d,c[t].data):n.texImage2D(34069+t,0,m,c[t].width,c[t].height,0,f,d,c[t].data);for(let e=0;e<v.length;e++){const r=v[e].image[t].image;g?n.texSubImage2D(34069+t,e+1,0,0,r.width,r.height,f,d,r.data):n.texImage2D(34069+t,e+1,m,r.width,r.height,0,f,d,r.data)}}else{g?n.texSubImage2D(34069+t,0,0,0,f,d,c[t]):n.texImage2D(34069+t,0,m,f,d,c[t]);for(let e=0;e<v.length;e++){const r=v[e];g?n.texSubImage2D(34069+t,e+1,0,0,f,d,r.image[t]):n.texImage2D(34069+t,e+1,m,f,d,r.image[t])}}}z(r,p)&&B(34067),u.__currentVersion=u.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}(a,e,i):(n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture))},this.rebindTextures=function(t,e,n){const i=r.get(t);void 0!==e&&rt(i.__webglFramebuffer,t,t.texture,36064,3553),void 0!==n&&ot(t)},this.setupRenderTarget=function(e){const u=e.texture,l=r.get(e),c=r.get(u);e.addEventListener("dispose",H),!0!==e.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=u.version,a.memory.textures++);const h=!0===e.isWebGLCubeRenderTarget,p=!0===e.isWebGLMultipleRenderTargets,f=F(e)||s;if(h){l.__webglFramebuffer=[];for(let e=0;e<6;e++)l.__webglFramebuffer[e]=t.createFramebuffer()}else if(l.__webglFramebuffer=t.createFramebuffer(),p)if(i.drawBuffers){const n=e.texture;for(let e=0,i=n.length;e<i;e++){const i=r.get(n[e]);void 0===i.__webglTexture&&(i.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(s&&e.samples>0&&!1===st(e)){l.__webglMultisampledFramebuffer=t.createFramebuffer(),l.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,l.__webglColorRenderbuffer);const r=o.convert(u.format,u.encoding),i=o.convert(u.type),a=j(u.internalFormat,r,i,u.encoding),s=at(e);t.renderbufferStorageMultisample(36161,s,a,e.width,e.height),n.bindFramebuffer(36160,l.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,l.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(l.__webglDepthRenderbuffer=t.createRenderbuffer(),it(l.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}if(h){n.bindTexture(34067,c.__webglTexture),$(34067,u,f);for(let t=0;t<6;t++)rt(l.__webglFramebuffer[t],e,u,36064,34069+t);z(u,f)&&B(34067),n.unbindTexture()}else if(p){const t=e.texture;for(let i=0,o=t.length;i<o;i++){const o=t[i],a=r.get(o);n.bindTexture(3553,a.__webglTexture),$(3553,o,f),rt(l.__webglFramebuffer,e,o,36064+i,3553),z(o,f)&&B(3553)}n.unbindTexture()}else{let t=3553;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(s?t=e.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(t,c.__webglTexture),$(t,u,f),rt(l.__webglFramebuffer,e,u,36064,t),z(u,f)&&B(t),n.unbindTexture()}e.depthBuffer&&ot(e)},this.updateRenderTargetMipmap=function(t){const e=F(t)||s,i=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let o=0,a=i.length;o<a;o++){const a=i[o];if(z(a,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,i=r.get(a).__webglTexture;n.bindTexture(e,i),B(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(s&&e.samples>0&&!1===st(e)){const i=e.width,o=e.height;let a=16384;const s=[36064],u=e.stencilBuffer?33306:36096;e.depthBuffer&&s.push(u);const l=r.get(e),c=void 0!==l.__ignoreDepthValues&&l.__ignoreDepthValues;!1===c&&(e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024)),n.bindFramebuffer(36008,l.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,l.__webglFramebuffer),!0===c&&(t.invalidateFramebuffer(36008,[u]),t.invalidateFramebuffer(36009,[u])),t.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728),A&&t.invalidateFramebuffer(36008,s),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,l.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ot,this.setupFrameBufferTexture=rt,this.useMultisampledRTT=st}function lo(t,e,n){const r=n.isWebGL2;return{convert:function(t,n=null){let i;if(t===g)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1010===t)return 5120;if(1011===t)return 5122;if(t===y)return 5123;if(1013===t)return 5124;if(t===v)return 5125;if(t===_)return 5126;if(t===x)return r?5131:(i=e.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(t===w)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===S)return 6402;if(t===E)return 34041;if(1028===t)return 6403;if(1022===t)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(t===V)return i=e.get("EXT_sRGB"),null!==i?i.SRGB_ALPHA_EXT:null;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1033===t)return 36249;if(t===C||t===M||t===T||t===A)if(n===N){if(i=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(t===C)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===M)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===T)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===A)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=e.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(t===C)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===M)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===T)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===A)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(i=e.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(35840===t)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return i=e.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===t||37496===t){if(i=e.get("WEBGL_compressed_texture_etc"),null===i)return null;if(37492===t)return n===N?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(37496===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t){if(i=e.get("WEBGL_compressed_texture_astc"),null===i)return null;if(37808===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===t)return n===N?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===t){if(i=e.get("EXT_texture_compression_bptc"),null===i)return null;if(36492===t)return n===N?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}return t===b?r?34042:(i=e.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}oo.prototype.isMeshDistanceMaterial=!0;class co extends An{constructor(t=[]){super(),this.cameras=t}}co.prototype.isArrayCamera=!0;class ho extends Te{constructor(){super(),this.type="Group"}}ho.prototype.isGroup=!0;const po={type:"move"};class fo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ho,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ho,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ct,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ct),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ho,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ct,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ct),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let r=null,i=null,o=null;const a=this._targetRay,s=this._grip,u=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==a&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(po))),u&&t.hand){o=!0;for(const r of t.hand.values()){const t=e.getJointPose(r,n);if(void 0===u.joints[r.jointName]){const t=new ho;t.matrixAutoUpdate=!1,t.visible=!1,u.joints[r.jointName]=t,u.add(t)}const i=u.joints[r.jointName];null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=t.radius),i.visible=null!==t}const r=u.joints["index-finger-tip"],i=u.joints["thumb-tip"],a=r.position.distanceTo(i.position),s=.02,l=.005;u.inputState.pinching&&a>s+l?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!u.inputState.pinching&&a<=s-l&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==s&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==r),null!==s&&(s.visible=null!==i),null!==u&&(u.visible=null!==o),this}}class mo extends _t{constructor(t,e,n,r,i,o,a,s,u,l){if((l=void 0!==l?l:S)!==S&&l!==E)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===S&&(n=y),void 0===n&&l===E&&(n=b),super(null,r,i,o,a,s,l,n,u),this.image={width:t,height:e},this.magFilter=void 0!==a?a:f,this.minFilter=void 0!==s?s:f,this.flipY=!1,this.generateMipmaps=!1}}mo.prototype.isDepthTexture=!0;class go extends G{constructor(t,e){super();const n=this;let r=null,i=1,o=null,a="local-floor",s=null,u=null,l=null,c=null,h=null;const p=e.getContextAttributes();let f=null,d=null;const m=[],v=new Map,_=new An;_.layers.enable(1),_.viewport=new xt;const x=new An;x.layers.enable(2),x.viewport=new xt;const C=[_,x],M=new co;M.layers.enable(1),M.layers.enable(2);let T=null,A=null;function P(t){const e=v.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function L(){v.forEach((function(t,e){t.disconnect(e)})),v.clear(),T=null,A=null,t.setRenderTarget(f),c=null,l=null,u=null,r=null,d=null,F.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function I(t){const e=r.inputSources;for(let t=0;t<m.length;t++)v.set(e[t],m[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],r=v.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),v.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],r=v.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=m[t];return void 0===e&&(e=new fo,m[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=m[t];return void 0===e&&(e=new fo,m[t]=e),e.getGripSpace()},this.getHand=function(t){let e=m[t];return void 0===e&&(e=new fo,m[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==l?l:c},this.getBinding=function(){return u},this.getFrame=function(){return h},this.getSession=function(){return r},this.setSession=async function(s){if(r=s,null!==r){if(f=t.getRenderTarget(),r.addEventListener("select",P),r.addEventListener("selectstart",P),r.addEventListener("selectend",P),r.addEventListener("squeeze",P),r.addEventListener("squeezestart",P),r.addEventListener("squeezeend",P),r.addEventListener("end",L),r.addEventListener("inputsourceschange",I),!0!==p.xrCompatible&&await e.makeXRCompatible(),void 0===r.renderState.layers||!1===t.capabilities.isWebGL2){const n={antialias:void 0!==r.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:i};c=new XRWebGLLayer(r,e,n),r.updateRenderState({baseLayer:c}),d=new bt(c.framebufferWidth,c.framebufferHeight,{format:w,type:g,encoding:t.outputEncoding})}else{let n=null,o=null,a=null;p.depth&&(a=p.stencil?35056:33190,n=p.stencil?E:S,o=p.stencil?b:y);const s={colorFormat:t.outputEncoding===N?35907:32856,depthFormat:a,scaleFactor:i};u=new XRWebGLBinding(r,e),l=u.createProjectionLayer(s),r.updateRenderState({layers:[l]}),d=new bt(l.textureWidth,l.textureHeight,{format:w,type:g,depthTexture:new mo(l.textureWidth,l.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0}),t.properties.get(d).__ignoreDepthValues=l.ignoreDepthValues}d.isXRRenderTarget=!0,this.setFoveation(1),o=await r.requestReferenceSpace(a),F.setContext(r),F.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const k=new Ct,O=new Ct;function R(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===r)return;M.near=x.near=_.near=t.near,M.far=x.far=_.far=t.far,T===M.near&&A===M.far||(r.updateRenderState({depthNear:M.near,depthFar:M.far}),T=M.near,A=M.far);const e=t.parent,n=M.cameras;R(M,e);for(let t=0;t<n.length;t++)R(n[t],e);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),t.position.copy(M.position),t.quaternion.copy(M.quaternion),t.scale.copy(M.scale),t.matrix.copy(M.matrix),t.matrixWorld.copy(M.matrixWorld);const i=t.children;for(let t=0,e=i.length;t<e;t++)i[t].updateMatrixWorld(!0);2===n.length?function(t,e,n){k.setFromMatrixPosition(e.matrixWorld),O.setFromMatrixPosition(n.matrixWorld);const r=k.distanceTo(O),i=e.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(o[8]+1)/o[0],p=a*c,f=a*h,d=r/(-c+h),m=d*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(d),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+d,y=s+d,v=p-m,_=f+(r-m),x=u*s/y*g,b=l*s/y*g;t.projectionMatrix.makePerspective(v,_,x,b,g,y)}(M,_,x):M.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){return null!==l?l.fixedFoveation:null!==c?c.fixedFoveation:void 0},this.setFoveation=function(t){null!==l&&(l.fixedFoveation=t),null!==c&&void 0!==c.fixedFoveation&&(c.fixedFoveation=t)};let D=null;const F=new jn;F.setAnimationLoop((function(e,n){if(s=n.getViewerPose(o),h=n,null!==s){const e=s.views;null!==c&&(t.setRenderTargetFramebuffer(d,c.framebuffer),t.setRenderTarget(d));let n=!1;e.length!==M.cameras.length&&(M.cameras.length=0,n=!0);for(let r=0;r<e.length;r++){const i=e[r];let o=null;if(null!==c)o=c.getViewport(i);else{const e=u.getViewSubImage(l,i);o=e.viewport,0===r&&(t.setRenderTargetTextures(d,e.colorTexture,l.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(d))}const a=C[r];a.matrix.fromArray(i.transform.matrix),a.projectionMatrix.fromArray(i.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===r&&M.matrix.copy(a.matrix),!0===n&&M.cameras.push(a)}}const i=r.inputSources;for(let t=0;t<m.length;t++){const e=m[t],r=i[t];e.update(r,n,o)}D&&D(e,n),h=null})),this.setAnimationLoop=function(t){D=t},this.dispose=function(){}}}function yo(t,e){function n(n,r){n.opacity.value=r.opacity,r.color&&n.diffuse.value.copy(r.color),r.emissive&&n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(n.map.value=r.map),r.alphaMap&&(n.alphaMap.value=r.alphaMap),r.bumpMap&&(n.bumpMap.value=r.bumpMap,n.bumpScale.value=r.bumpScale,1===r.side&&(n.bumpScale.value*=-1)),r.displacementMap&&(n.displacementMap.value=r.displacementMap,n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias),r.emissiveMap&&(n.emissiveMap.value=r.emissiveMap),r.normalMap&&(n.normalMap.value=r.normalMap,n.normalScale.value.copy(r.normalScale),1===r.side&&n.normalScale.value.negate()),r.specularMap&&(n.specularMap.value=r.specularMap),r.alphaTest>0&&(n.alphaTest.value=r.alphaTest);const i=e.get(r).envMap;if(i&&(n.envMap.value=i,n.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,n.reflectivity.value=r.reflectivity,n.ior.value=r.ior,n.refractionRatio.value=r.refractionRatio),r.lightMap){n.lightMap.value=r.lightMap;const e=!0!==t.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=r.lightMapIntensity*e}let o,a;r.aoMap&&(n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity),r.map?o=r.map:r.specularMap?o=r.specularMap:r.displacementMap?o=r.displacementMap:r.normalMap?o=r.normalMap:r.bumpMap?o=r.bumpMap:r.roughnessMap?o=r.roughnessMap:r.metalnessMap?o=r.metalnessMap:r.alphaMap?o=r.alphaMap:r.emissiveMap?o=r.emissiveMap:r.clearcoatMap?o=r.clearcoatMap:r.clearcoatNormalMap?o=r.clearcoatNormalMap:r.clearcoatRoughnessMap?o=r.clearcoatRoughnessMap:r.specularIntensityMap?o=r.specularIntensityMap:r.specularColorMap?o=r.specularColorMap:r.transmissionMap?o=r.transmissionMap:r.thicknessMap?o=r.thicknessMap:r.sheenColorMap?o=r.sheenColorMap:r.sheenRoughnessMap&&(o=r.sheenRoughnessMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),n.uvTransform.value.copy(o.matrix)),r.aoMap?a=r.aoMap:r.lightMap&&(a=r.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,o,a){r.isMeshBasicMaterial||r.isMeshLambertMaterial?n(t,r):r.isMeshToonMaterial?(n(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,r)):r.isMeshPhongMaterial?(n(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,r)):r.isMeshStandardMaterial?(n(t,r),function(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}(t,r),r.isMeshPhysicalMaterial&&function(t,e,n){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap)),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate())),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,r,a)):r.isMeshMatcapMaterial?(n(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,r)):r.isMeshDepthMaterial?n(t,r):r.isMeshDistanceMaterial?(n(t,r),function(t,e){t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?n(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r,i,o):r.isSpriteMaterial?function(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function vo(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=nt("canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,r=void 0===t.depth||t.depth,i=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,s=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,u=void 0!==t.powerPreference?t.powerPreference:"default",l=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let c;c=void 0!==t.context?n.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let h=null,p=null;const f=[],d=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=D,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let v=!1,b=0,S=0,E=null,C=-1,M=null;const T=new xt,A=new xt;let P=null,L=e.width,I=e.height,k=1,O=null,R=null;const N=new xt(0,0,L,I),F=new xt(0,0,L,I);let z=!1;const B=new Bn;let j=!1,U=!1,Z=null;const V=new ne,G=new $,H=new Ct,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===E?k:1}let X,Y,K,Q,tt,et,rt,it,ot,at,st,ut,lt,ct,ht,pt,ft,dt,mt,gt,yt,vt,_t,wt=n;function St(t,n){for(let r=0;r<t.length;r++){const i=t[r],o=e.getContext(i,n);if(null!==o)return o}return null}try{const t={alpha:!0,depth:r,stencil:i,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:s,powerPreference:u,failIfMajorPerformanceCaveat:l};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r139"),e.addEventListener("webglcontextlost",Tt,!1),e.addEventListener("webglcontextrestored",At,!1),null===wt){const e=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&e.shift(),wt=St(e,t),null===wt)throw St(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===wt.getShaderPrecisionFormat&&(wt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function Et(){X=new pr(wt),Y=new Yn(wt,X,t),X.init(Y),vt=new lo(wt,X,Y),K=new so(wt,X,Y),Q=new mr(wt),tt=new qi,et=new uo(wt,X,K,tt,Y,vt,Q),rt=new Qn(y),it=new hr(y),ot=new Un(wt,Y),_t=new qn(wt,X,ot,Y),at=new fr(wt,ot,Q,_t),st=new xr(wt,at,ot,Q),mt=new _r(wt,Y,et),pt=new Kn(tt),ut=new Wi(y,rt,it,X,Y,_t,pt),lt=new yo(y,tt),ct=new Qi,ht=new ro(X,Y),dt=new Wn(y,rt,K,st,c,a),ft=new ao(y,st,Y),gt=new Xn(wt,X,Q,Y),yt=new dr(wt,X,Q,Y),Q.programs=ut.programs,y.capabilities=Y,y.extensions=X,y.properties=tt,y.renderLists=ct,y.shadowMap=ft,y.state=K,y.info=Q}Et();const Mt=new go(y,wt);function Tt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function At(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const t=Q.autoReset,e=ft.enabled,n=ft.autoUpdate,r=ft.needsUpdate,i=ft.type;Et(),Q.autoReset=t,ft.enabled=e,ft.autoUpdate=n,ft.needsUpdate=r,ft.type=i}function Pt(t){const e=t.target;e.removeEventListener("dispose",Pt),function(t){(function(t){const e=tt.get(t).programs;void 0!==e&&(e.forEach((function(t){ut.releaseProgram(t)})),t.isShaderMaterial&&ut.releaseShaderCache(t))})(t),tt.remove(t)}(e)}this.xr=Mt,this.getContext=function(){return wt},this.getContextAttributes=function(){return wt.getContextAttributes()},this.forceContextLoss=function(){const t=X.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=X.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(t){void 0!==t&&(k=t,this.setSize(L,I,!1))},this.getSize=function(t){return t.set(L,I)},this.setSize=function(t,n,r){Mt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=t,I=n,e.width=Math.floor(t*k),e.height=Math.floor(n*k),!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(L*k,I*k).floor()},this.setDrawingBufferSize=function(t,n,r){L=t,I=n,k=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(T)},this.getViewport=function(t){return t.copy(N)},this.setViewport=function(t,e,n,r){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,n,r),K.viewport(T.copy(N).multiplyScalar(k).floor())},this.getScissor=function(t){return t.copy(F)},this.setScissor=function(t,e,n,r){t.isVector4?F.set(t.x,t.y,t.z,t.w):F.set(t,e,n,r),K.scissor(A.copy(F).multiplyScalar(k).floor())},this.getScissorTest=function(){return z},this.setScissorTest=function(t){K.setScissorTest(z=t)},this.setOpaqueSort=function(t){O=t},this.setTransparentSort=function(t){R=t},this.getClearColor=function(t){return t.copy(dt.getClearColor())},this.setClearColor=function(){dt.setClearColor.apply(dt,arguments)},this.getClearAlpha=function(){return dt.getClearAlpha()},this.setClearAlpha=function(){dt.setClearAlpha.apply(dt,arguments)},this.clear=function(t=!0,e=!0,n=!0){let r=0;t&&(r|=16384),e&&(r|=256),n&&(r|=1024),wt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Tt,!1),e.removeEventListener("webglcontextrestored",At,!1),ct.dispose(),ht.dispose(),tt.dispose(),rt.dispose(),it.dispose(),st.dispose(),_t.dispose(),ut.dispose(),Mt.dispose(),Mt.removeEventListener("sessionstart",It),Mt.removeEventListener("sessionend",kt),Z&&(Z.dispose(),Z=null),Ot.stop()},this.renderBufferDirect=function(t,e,n,r,i,o){null===e&&(e=W);const a=i.isMesh&&i.matrixWorld.determinant()<0,s=function(t,e,n,r,i){!0!==e.isScene&&(e=W),et.resetTextureUnits();const o=e.fog,a=r.isMeshStandardMaterial?e.environment:null,s=null===E?y.outputEncoding:!0===E.isXRRenderTarget?E.texture.encoding:D,u=(r.isMeshStandardMaterial?it:rt).get(r.envMap||a),l=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!r.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,f=!!n.morphAttributes.normal,d=!!n.morphAttributes.color,m=r.toneMapped?y.toneMapping:0,g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,_=tt.get(r),x=p.state.lights;if(!0===j&&(!0===U||t!==M)){const e=t===M&&r.id===C;pt.setState(r,t,e)}let b=!1;r.version===_.__version?_.needsLights&&_.lightsStateVersion!==x.state.version||_.outputEncoding!==s||i.isInstancedMesh&&!1===_.instancing?b=!0:i.isInstancedMesh||!0!==_.instancing?i.isSkinnedMesh&&!1===_.skinning?b=!0:i.isSkinnedMesh||!0!==_.skinning?_.envMap!==u||r.fog&&_.fog!==o?b=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===pt.numPlanes&&_.numIntersection===pt.numIntersection?(_.vertexAlphas!==l||_.vertexTangents!==c||_.morphTargets!==h||_.morphNormals!==f||_.morphColors!==d||_.toneMapping!==m||!0===Y.isWebGL2&&_.morphTargetsCount!==v)&&(b=!0):b=!0:b=!0:b=!0:(b=!0,_.__version=r.version);let w=_.currentProgram;!0===b&&(w=zt(r,e,i));let S=!1,T=!1,A=!1;const P=w.getUniforms(),L=_.uniforms;if(K.useProgram(w.program)&&(S=!0,T=!0,A=!0),r.id!==C&&(C=r.id,T=!0),S||M!==t){if(P.setValue(wt,"projectionMatrix",t.projectionMatrix),Y.logarithmicDepthBuffer&&P.setValue(wt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),M!==t&&(M=t,T=!0,A=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){const e=P.map.cameraPosition;void 0!==e&&e.setValue(wt,H.setFromMatrixPosition(t.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&P.setValue(wt,"isOrthographic",!0===t.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh)&&P.setValue(wt,"viewMatrix",t.matrixWorldInverse)}if(i.isSkinnedMesh){P.setOptional(wt,i,"bindMatrix"),P.setOptional(wt,i,"bindMatrixInverse");const t=i.skeleton;t&&(Y.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),P.setValue(wt,"boneTexture",t.boneTexture,et),P.setValue(wt,"boneTextureSize",t.boneTextureSize)):P.setOptional(wt,t,"boneMatrices"))}const O=n.morphAttributes;var R,N;return(void 0!==O.position||void 0!==O.normal||void 0!==O.color&&!0===Y.isWebGL2)&&mt.update(i,n,r,w),(T||_.receiveShadow!==i.receiveShadow)&&(_.receiveShadow=i.receiveShadow,P.setValue(wt,"receiveShadow",i.receiveShadow)),T&&(P.setValue(wt,"toneMappingExposure",y.toneMappingExposure),_.needsLights&&(N=A,(R=L).ambientLightColor.needsUpdate=N,R.lightProbe.needsUpdate=N,R.directionalLights.needsUpdate=N,R.directionalLightShadows.needsUpdate=N,R.pointLights.needsUpdate=N,R.pointLightShadows.needsUpdate=N,R.spotLights.needsUpdate=N,R.spotLightShadows.needsUpdate=N,R.rectAreaLights.needsUpdate=N,R.hemisphereLights.needsUpdate=N),o&&r.fog&&lt.refreshFogUniforms(L,o),lt.refreshMaterialUniforms(L,r,k,I,Z),Ei.upload(wt,_.uniformsList,L,et)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ei.upload(wt,_.uniformsList,L,et),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&P.setValue(wt,"center",i.center),P.setValue(wt,"modelViewMatrix",i.modelViewMatrix),P.setValue(wt,"normalMatrix",i.normalMatrix),P.setValue(wt,"modelMatrix",i.matrixWorld),w}(t,e,n,r,i);K.setMaterial(r,a);let u=n.index;const l=n.attributes.position;if(null===u){if(void 0===l||0===l.count)return}else if(0===u.count)return;let c,h=1;!0===r.wireframe&&(u=at.getWireframeAttribute(n),h=2),_t.setup(i,r,s,n,u);let f=gt;null!==u&&(c=ot.get(u),f=yt,f.setIndex(c));const d=null!==u?u.count:l.count,m=n.drawRange.start*h,g=n.drawRange.count*h,v=null!==o?o.start*h:0,_=null!==o?o.count*h:1/0,x=Math.max(m,v),b=Math.min(d,m+g,v+_)-1,w=Math.max(0,b-x+1);if(0!==w){if(i.isMesh)!0===r.wireframe?(K.setLineWidth(r.wireframeLinewidth*q()),f.setMode(1)):f.setMode(4);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),K.setLineWidth(t*q()),i.isLineSegments?f.setMode(1):i.isLineLoop?f.setMode(2):f.setMode(3)}else i.isPoints?f.setMode(0):i.isSprite&&f.setMode(4);if(i.isInstancedMesh)f.renderInstances(x,w,i.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);f.renderInstances(x,w,t)}else f.render(x,w)}},this.compile=function(t,e){p=ht.get(t),p.init(),d.push(p),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))})),p.setupLights(y.physicallyCorrectLights),t.traverse((function(e){const n=e.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++)zt(n[r],t,e);else zt(n,t,e)})),d.pop(),p=null};let Lt=null;function It(){Ot.stop()}function kt(){Ot.start()}const Ot=new jn;function Rt(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)p.pushLight(t),t.castShadow&&p.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||B.intersectsSprite(t)){r&&H.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=st.update(t),i=t.material;i.visible&&h.push(t,e,i,n,H.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==Q.render.frame&&(t.skeleton.update(),t.skeleton.frame=Q.render.frame),!t.frustumCulled||B.intersectsObject(t))){r&&H.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=st.update(t),i=t.material;if(Array.isArray(i)){const r=e.groups;for(let o=0,a=r.length;o<a;o++){const a=r[o],s=i[a.materialIndex];s&&s.visible&&h.push(t,e,s,n,H.z,a)}}else i.visible&&h.push(t,e,i,n,H.z,null)}const i=t.children;for(let t=0,o=i.length;t<o;t++)Rt(i[t],e,n,r)}function Dt(t,e,n,r){const i=t.opaque,a=t.transmissive,s=t.transparent;p.setupLightsView(n),a.length>0&&function(t,e,n){const r=Y.isWebGL2;null===Z&&(Z=new bt(1,1,{generateMipmaps:!0,type:null!==vt.convert(x)?x:g,minFilter:m,samples:r&&!0===o?4:0})),y.getDrawingBufferSize(G),r?Z.setSize(G.x,G.y):Z.setSize(J(G.x),J(G.y));const i=y.getRenderTarget();y.setRenderTarget(Z),y.clear();const a=y.toneMapping;y.toneMapping=0,Nt(t,e,n),y.toneMapping=a,et.updateMultisampleRenderTarget(Z),et.updateRenderTargetMipmap(Z),y.setRenderTarget(i)}(i,e,n),r&&K.viewport(T.copy(r)),i.length>0&&Nt(i,e,n),a.length>0&&Nt(a,e,n),s.length>0&&Nt(s,e,n),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function Nt(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,o=t.length;i<o;i++){const o=t[i],a=o.object,s=o.geometry,u=null===r?o.material:r,l=o.group;a.layers.test(n.layers)&&Ft(a,e,n,s,u,l)}}function Ft(t,e,n,r,i,o){t.onBeforeRender(y,e,n,r,i,o),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),i.onBeforeRender(y,e,n,r,t,o),!0===i.transparent&&2===i.side?(i.side=1,i.needsUpdate=!0,y.renderBufferDirect(n,e,r,i,t,o),i.side=0,i.needsUpdate=!0,y.renderBufferDirect(n,e,r,i,t,o),i.side=2):y.renderBufferDirect(n,e,r,i,t,o),t.onAfterRender(y,e,n,r,i,o)}function zt(t,e,n){!0!==e.isScene&&(e=W);const r=tt.get(t),i=p.state.lights,o=p.state.shadowsArray,a=i.state.version,s=ut.getParameters(t,i.state,o,e,n),u=ut.getProgramCacheKey(s);let l=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=(t.isMeshStandardMaterial?it:rt).get(t.envMap||r.environment),void 0===l&&(t.addEventListener("dispose",Pt),l=new Map,r.programs=l);let c=l.get(u);if(void 0!==c){if(r.currentProgram===c&&r.lightsStateVersion===a)return Bt(t,s),c}else s.uniforms=ut.getUniforms(t),t.onBuild(n,s,y),t.onBeforeCompile(s,y),c=ut.acquireProgram(s,u),l.set(u,c),r.uniforms=s.uniforms;const h=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=pt.uniform),Bt(t,s),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=a,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const f=c.getUniforms(),d=Ei.seqWithValue(f.seq,h);return r.currentProgram=c,r.uniformsList=d,c}function Bt(t,e){const n=tt.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}Ot.setAnimationLoop((function(t){Lt&&Lt(t)})),"undefined"!=typeof self&&Ot.setContext(self),this.setAnimationLoop=function(t){Lt=t,Mt.setAnimationLoop(t),null===t?Ot.stop():Ot.start()},Mt.addEventListener("sessionstart",It),Mt.addEventListener("sessionend",kt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===v)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===Mt.enabled&&!0===Mt.isPresenting&&(!0===Mt.cameraAutoUpdate&&Mt.updateCamera(e),e=Mt.getCamera()),!0===t.isScene&&t.onBeforeRender(y,t,e,E),p=ht.get(t,d.length),p.init(),d.push(p),V.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),B.setFromProjectionMatrix(V),U=this.localClippingEnabled,j=pt.init(this.clippingPlanes,U,e),h=ct.get(t,f.length),h.init(),f.push(h),Rt(t,e,0,y.sortObjects),h.finish(),!0===y.sortObjects&&h.sort(O,R),!0===j&&pt.beginShadows();const n=p.state.shadowsArray;if(ft.render(n,t,e),!0===j&&pt.endShadows(),!0===this.info.autoReset&&this.info.reset(),dt.render(h,t),p.setupLights(y.physicallyCorrectLights),e.isArrayCamera){const n=e.cameras;for(let e=0,r=n.length;e<r;e++){const r=n[e];Dt(h,t,r,r.viewport)}}else Dt(h,t,e);null!==E&&(et.updateMultisampleRenderTarget(E),et.updateRenderTargetMipmap(E)),!0===t.isScene&&t.onAfterRender(y,t,e),_t.resetDefaultState(),C=-1,M=null,d.pop(),p=d.length>0?d[d.length-1]:null,f.pop(),h=f.length>0?f[f.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(t,e,n){tt.get(t.texture).__webglTexture=e,tt.get(t.depthTexture).__webglTexture=n;const r=tt.get(t);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===X.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const n=tt.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){E=t,b=e,S=n;let r=!0;if(t){const e=tt.get(t);void 0!==e.__useDefaultFramebuffer?(K.bindFramebuffer(36160,null),r=!1):void 0===e.__webglFramebuffer?et.setupRenderTarget(t):e.__hasExternalTextures&&et.rebindTextures(t,tt.get(t.texture).__webglTexture,tt.get(t.depthTexture).__webglTexture)}let i=null,o=!1,a=!1;if(t){const n=t.texture;(n.isData3DTexture||n.isDataArrayTexture)&&(a=!0);const r=tt.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=r[e],o=!0):i=Y.isWebGL2&&t.samples>0&&!1===et.useMultisampledRTT(t)?tt.get(t).__webglMultisampledFramebuffer:r,T.copy(t.viewport),A.copy(t.scissor),P=t.scissorTest}else T.copy(N).multiplyScalar(k).floor(),A.copy(F).multiplyScalar(k).floor(),P=z;if(K.bindFramebuffer(36160,i)&&Y.drawBuffers&&r&&K.drawBuffers(t,i),K.viewport(T),K.scissor(A),K.setScissorTest(P),o){const r=tt.get(t.texture);wt.framebufferTexture2D(36160,36064,34069+e,r.__webglTexture,n)}else if(a){const r=tt.get(t.texture),i=e||0;wt.framebufferTextureLayer(36160,36064,r.__webglTexture,n||0,i)}C=-1},this.readRenderTargetPixels=function(t,e,n,r,i,o,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=tt.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){K.bindFramebuffer(36160,s);try{const a=t.texture,s=a.format,u=a.type;if(s!==w&&vt.convert(s)!==wt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const l=u===x&&(X.has("EXT_color_buffer_half_float")||Y.isWebGL2&&X.has("EXT_color_buffer_float"));if(!(u===g||vt.convert(u)===wt.getParameter(35738)||u===_&&(Y.isWebGL2||X.has("OES_texture_float")||X.has("WEBGL_color_buffer_float"))||l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&wt.readPixels(e,n,r,i,vt.convert(s),vt.convert(u),o)}finally{const t=null!==E?tt.get(E).__webglFramebuffer:null;K.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){if(!0!==e.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),o=Math.floor(e.image.height*r);et.setTexture2D(e,0),wt.copyTexSubImage2D(3553,n,0,0,t.x,t.y,i,o),K.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r=0){const i=e.image.width,o=e.image.height,a=vt.convert(n.format),s=vt.convert(n.type);et.setTexture2D(n,0),wt.pixelStorei(37440,n.flipY),wt.pixelStorei(37441,n.premultiplyAlpha),wt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?wt.texSubImage2D(3553,r,t.x,t.y,i,o,a,s,e.image.data):e.isCompressedTexture?wt.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):wt.texSubImage2D(3553,r,t.x,t.y,a,s,e.image),0===r&&n.generateMipmaps&&wt.generateMipmap(3553),K.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,r,i=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,s=t.max.z-t.min.z+1,u=vt.convert(r.format),l=vt.convert(r.type);let c;if(r.isData3DTexture)et.setTexture3D(r,0),c=32879;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");et.setTexture2DArray(r,0),c=35866}wt.pixelStorei(37440,r.flipY),wt.pixelStorei(37441,r.premultiplyAlpha),wt.pixelStorei(3317,r.unpackAlignment);const h=wt.getParameter(3314),p=wt.getParameter(32878),f=wt.getParameter(3316),d=wt.getParameter(3315),m=wt.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;wt.pixelStorei(3314,g.width),wt.pixelStorei(32878,g.height),wt.pixelStorei(3316,t.min.x),wt.pixelStorei(3315,t.min.y),wt.pixelStorei(32877,t.min.z),n.isDataTexture||n.isData3DTexture?wt.texSubImage3D(c,i,e.x,e.y,e.z,o,a,s,u,l,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),wt.compressedTexSubImage3D(c,i,e.x,e.y,e.z,o,a,s,u,g.data)):wt.texSubImage3D(c,i,e.x,e.y,e.z,o,a,s,u,l,g),wt.pixelStorei(3314,h),wt.pixelStorei(32878,p),wt.pixelStorei(3316,f),wt.pixelStorei(3315,d),wt.pixelStorei(32877,m),0===i&&r.generateMipmaps&&wt.generateMipmap(c),K.unbindTexture()},this.initTexture=function(t){et.setTexture2D(t,0),K.unbindTexture()},this.resetState=function(){b=0,S=0,E=null,K.reset(),_t.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}vo.prototype.isWebGLRenderer=!0,class extends vo{}.prototype.isWebGL1Renderer=!0;class _o{constructor(t,e=25e-5){this.name="",this.color=new ft(t),this.density=e}clone(){return new _o(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}_o.prototype.isFogExp2=!0;class xo{constructor(t,e=1,n=1e3){this.name="",this.color=new ft(t),this.near=e,this.far=n}clone(){return new xo(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}xo.prototype.isFog=!0;class bo extends Te{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}bo.prototype.isScene=!0;class wo{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=j,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=X()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=X()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=X()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}wo.prototype.isInterleavedBuffer=!0;const So=new Ct;class Eo{constructor(t,e,n,r=!1){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)So.fromBufferAttribute(this,e),So.applyMatrix4(t),this.setXYZ(e,So.x,So.y,So.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)So.fromBufferAttribute(this,e),So.applyNormalMatrix(t),this.setXYZ(e,So.x,So.y,So.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)So.fromBufferAttribute(this,e),So.transformDirection(t),this.setXYZ(e,So.x,So.y,So.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Ge(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Eo(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Eo.prototype.isInterleavedBufferAttribute=!0;class Co extends je{constructor(t){super(),this.type="SpriteMaterial",this.color=new ft(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let Mo;Co.prototype.isSpriteMaterial=!0;const To=new Ct,Ao=new Ct,Po=new Ct,Lo=new $,Io=new $,ko=new ne,Oo=new Ct,Ro=new Ct,Do=new Ct,No=new $,Fo=new $,zo=new $;class Bo extends Te{constructor(t){if(super(),this.type="Sprite",void 0===Mo){Mo=new en;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new wo(t,5);Mo.setIndex([0,1,2,0,2,3]),Mo.setAttribute("position",new Eo(e,3,0,!1)),Mo.setAttribute("uv",new Eo(e,2,3,!1))}this.geometry=Mo,this.material=void 0!==t?t:new Co,this.center=new $(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ao.setFromMatrixScale(this.matrixWorld),ko.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Po.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ao.multiplyScalar(-Po.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;jo(Oo.set(-.5,-.5,0),Po,o,Ao,r,i),jo(Ro.set(.5,-.5,0),Po,o,Ao,r,i),jo(Do.set(.5,.5,0),Po,o,Ao,r,i),No.set(0,0),Fo.set(1,0),zo.set(1,1);let a=t.ray.intersectTriangle(Oo,Ro,Do,!1,To);if(null===a&&(jo(Ro.set(-.5,.5,0),Po,o,Ao,r,i),Fo.set(0,1),a=t.ray.intersectTriangle(Oo,Do,Ro,!1,To),null===a))return;const s=t.ray.origin.distanceTo(To);s<t.near||s>t.far||e.push({distance:s,point:To.clone(),uv:ze.getUV(To,Oo,Ro,Do,No,Fo,zo,new $),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function jo(t,e,n,r,i,o){Lo.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(Io.x=o*Lo.x-i*Lo.y,Io.y=i*Lo.x+o*Lo.y):Io.copy(Lo),t.copy(e),t.x+=Io.x,t.y+=Io.y,t.applyMatrix4(ko)}Bo.prototype.isSprite=!0;const Uo=new Ct,Zo=new xt,Vo=new xt,Go=new Ct,Ho=new ne;class Wo extends xn{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ne,this.bindMatrixInverse=new ne}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new xt,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.fromBufferAttribute(e,n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const n=this.skeleton,r=this.geometry;Zo.fromBufferAttribute(r.attributes.skinIndex,t),Vo.fromBufferAttribute(r.attributes.skinWeight,t),Uo.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const r=Vo.getComponent(t);if(0!==r){const i=Zo.getComponent(t);Ho.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(Go.copy(Uo).applyMatrix4(Ho),r)}}return e.applyMatrix4(this.bindMatrixInverse)}}Wo.prototype.isSkinnedMesh=!0;(class extends Te{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;(class extends _t{constructor(t=null,e=1,n=1,r,i,o,a,s,u=1003,l=1003,c,h){super(null,o,a,s,u,l,r,i,c,h),this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}).prototype.isDataTexture=!0;class qo extends Ge{constructor(t,e,n,r=1){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}qo.prototype.isInstancedBufferAttribute=!0;const Xo=new ne,Yo=new ne,Ko=[],Qo=new xn;(class extends xn{constructor(t,e,n){super(t,e),this.instanceMatrix=new qo(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const n=this.matrixWorld,r=this.count;if(Qo.geometry=this.geometry,Qo.material=this.material,void 0!==Qo.material)for(let i=0;i<r;i++){this.getMatrixAt(i,Xo),Yo.multiplyMatrices(n,Xo),Qo.matrixWorld=Yo,Qo.raycast(t,Ko);for(let t=0,n=Ko.length;t<n;t++){const n=Ko[t];n.instanceId=i,n.object=this,e.push(n)}Ko.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new qo(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class Jo extends je{constructor(t){super(),this.type="LineBasicMaterial",this.color=new ft(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}Jo.prototype.isLineBasicMaterial=!0;const $o=new Ct,ta=new Ct,ea=new ne,na=new ee,ra=new qt;class ia extends Te{constructor(t=new en,e=new Jo){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)$o.fromBufferAttribute(e,t-1),ta.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=$o.distanceTo(ta);t.setAttribute("lineDistance",new qe(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ra.copy(n.boundingSphere),ra.applyMatrix4(r),ra.radius+=i,!1===t.ray.intersectsSphere(ra))return;ea.copy(r).invert(),na.copy(t.ray).applyMatrix4(ea);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,u=new Ct,l=new Ct,c=new Ct,h=new Ct,p=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r)for(let n=Math.max(0,o.start),a=Math.min(r.count,o.start+o.count)-1;n<a;n+=p){const o=r.getX(n),a=r.getX(n+1);if(u.fromBufferAttribute(i,o),l.fromBufferAttribute(i,a),na.distanceSqToSegment(u,l,h,c)>s)continue;h.applyMatrix4(this.matrixWorld);const p=t.ray.origin.distanceTo(h);p<t.near||p>t.far||e.push({distance:p,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,o.start),r=Math.min(i.count,o.start+o.count)-1;n<r;n+=p){if(u.fromBufferAttribute(i,n),l.fromBufferAttribute(i,n+1),na.distanceSqToSegment(u,l,h,c)>s)continue;h.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(h);r<t.near||r>t.far||e.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}ia.prototype.isLine=!0;const oa=new Ct,aa=new Ct;class sa extends ia{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)oa.fromBufferAttribute(e,t),aa.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+oa.distanceTo(aa);t.setAttribute("lineDistance",new qe(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}sa.prototype.isLineSegments=!0;(class extends ia{constructor(t,e){super(t,e),this.type="LineLoop"}}).prototype.isLineLoop=!0;class ua extends je{constructor(t){super(),this.type="PointsMaterial",this.color=new ft(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}ua.prototype.isPointsMaterial=!0;const la=new ne,ca=new ee,ha=new qt,pa=new Ct;function fa(t,e,n,r,i,o,a){const s=ca.distanceSqToPoint(t);if(s<n){const n=new Ct;ca.closestPointToPoint(t,n),n.applyMatrix4(r);const u=i.ray.origin.distanceTo(n);if(u<i.near||u>i.far)return;o.push({distance:u,distanceToRay:Math.sqrt(s),point:n,index:e,face:null,object:a})}}(class extends Te{constructor(t=new en,e=new ua){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ha.copy(n.boundingSphere),ha.applyMatrix4(r),ha.radius+=i,!1===t.ray.intersectsSphere(ha))return;la.copy(r).invert(),ca.copy(t.ray).applyMatrix4(la);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a;if(n.isBufferGeometry){const i=n.index,a=n.attributes.position;if(null!==i)for(let n=Math.max(0,o.start),u=Math.min(i.count,o.start+o.count);n<u;n++){const o=i.getX(n);pa.fromBufferAttribute(a,o),fa(pa,o,s,r,t,e,this)}else for(let n=Math.max(0,o.start),i=Math.min(a.count,o.start+o.count);n<i;n++)pa.fromBufferAttribute(a,n),fa(pa,n,s,r,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}).prototype.isPoints=!0,class extends _t{constructor(t,e,n,r,i,o,a,s,u){super(t,e,n,r,i,o,a,s,u),this.minFilter=void 0!==o?o:d,this.magFilter=void 0!==i?i:d,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){l.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class extends _t{constructor(t,e,n){super({width:t,height:e}),this.format=n,this.magFilter=f,this.minFilter=f,this.generateMipmaps=!1,this.needsUpdate=!0}}.prototype.isFramebufferTexture=!0;(class extends _t{constructor(t,e,n,r,i,o,a,s,u,l,c,h){super(null,o,a,s,u,l,r,i,c,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0,class extends _t{constructor(t,e,n,r,i,o,a,s,u){super(t,e,n,r,i,o,a,s,u),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0;class da{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let o=1;o<=t;o++)n=this.getPoint(o/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let r=0;const i=n.length;let o;o=e||t*n[i-1];let a,s=0,u=i-1;for(;s<=u;)if(r=Math.floor(s+(u-s)/2),a=n[r]-o,a<0)s=r+1;else{if(!(a>0)){u=r;break}u=r-1}if(r=u,n[r]===o)return r/(i-1);const l=n[r];return(r+(o-l)/(n[r+1]-l))/(i-1)}getTangent(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const o=this.getPoint(r),a=this.getPoint(i),s=e||(o.isVector2?new $:new Ct);return s.copy(a).sub(o).normalize(),s}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new Ct,r=[],i=[],o=[],a=new Ct,s=new ne;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new Ct)}i[0]=new Ct,o[0]=new Ct;let u=Number.MAX_VALUE;const l=Math.abs(r[0].x),c=Math.abs(r[0].y),h=Math.abs(r[0].z);l<=u&&(u=l,n.set(1,0,0)),c<=u&&(u=c,n.set(0,1,0)),h<=u&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),o[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),o[e]=o[e-1].clone(),a.crossVectors(r[e-1],r[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(Y(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(s.makeRotationAxis(a,t))}o[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(Y(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(a.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(s.makeRotationAxis(r[n],e*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class ma extends da{constructor(t=0,e=0,n=1,r=1,i=0,o=2*Math.PI,a=!1,s=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s}getPoint(t,e){const n=e||new $,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const a=this.aStartAngle+t*i;let s=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=s-this.aX,r=u-this.aY;s=n*t-r*e+this.aX,u=n*e+r*t+this.aY}return n.set(s,u)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}ma.prototype.isEllipseCurve=!0;class ga extends ma{constructor(t,e,n,r,i,o){super(t,e,n,n,r,i,o),this.type="ArcCurve"}}function ya(){let t=0,e=0,n=0,r=0;function i(i,o,a,s){t=i,e=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(t,e,n,r,o){i(e,n,o*(n-t),o*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,o,a,s){let u=(e-t)/o-(n-t)/(o+a)+(n-e)/a,l=(n-e)/a-(r-e)/(a+s)+(r-n)/s;u*=a,l*=a,i(e,n,u,l)},calc:function(i){const o=i*i;return t+e*i+n*o+r*(o*i)}}}ga.prototype.isArcCurve=!0;const va=new Ct,_a=new ya,xa=new ya,ba=new ya;class wa extends da{constructor(t=[],e=!1,n="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t,e=new Ct){const n=e,r=this.points,i=r.length,o=(i-(this.closed?0:1))*t;let a,s,u=Math.floor(o),l=o-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/i)+1)*i:0===l&&u===i-1&&(u=i-2,l=1),this.closed||u>0?a=r[(u-1)%i]:(va.subVectors(r[0],r[1]).add(r[0]),a=va);const c=r[u%i],h=r[(u+1)%i];if(this.closed||u+2<i?s=r[(u+2)%i]:(va.subVectors(r[i-1],r[i-2]).add(r[i-1]),s=va),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(c),t),n=Math.pow(c.distanceToSquared(h),t),r=Math.pow(h.distanceToSquared(s),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),_a.initNonuniformCatmullRom(a.x,c.x,h.x,s.x,e,n,r),xa.initNonuniformCatmullRom(a.y,c.y,h.y,s.y,e,n,r),ba.initNonuniformCatmullRom(a.z,c.z,h.z,s.z,e,n,r)}else"catmullrom"===this.curveType&&(_a.initCatmullRom(a.x,c.x,h.x,s.x,this.tension),xa.initCatmullRom(a.y,c.y,h.y,s.y,this.tension),ba.initCatmullRom(a.z,c.z,h.z,s.z,this.tension));return n.set(_a.calc(l),xa.calc(l),ba.calc(l)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Ct).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Sa(t,e,n,r,i){const o=.5*(r-e),a=.5*(i-n),s=t*t;return(2*n-2*r+o+a)*(t*s)+(-3*n+3*r-2*o-a)*s+o*t+n}function Ea(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function Ca(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}wa.prototype.isCatmullRomCurve3=!0;class Ma extends da{constructor(t=new $,e=new $,n=new $,r=new $){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new $){const n=e,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Ca(t,r.x,i.x,o.x,a.x),Ca(t,r.y,i.y,o.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Ma.prototype.isCubicBezierCurve=!0;class Ta extends da{constructor(t=new Ct,e=new Ct,n=new Ct,r=new Ct){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new Ct){const n=e,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Ca(t,r.x,i.x,o.x,a.x),Ca(t,r.y,i.y,o.y,a.y),Ca(t,r.z,i.z,o.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Ta.prototype.isCubicBezierCurve3=!0;class Aa extends da{constructor(t=new $,e=new $){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new $){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new $;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Aa.prototype.isLineCurve=!0;class Pa extends da{constructor(t=new $,e=new $,n=new $){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new $){const n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(Ea(t,r.x,i.x,o.x),Ea(t,r.y,i.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Pa.prototype.isQuadraticBezierCurve=!0;class La extends da{constructor(t=new Ct,e=new Ct,n=new Ct){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Ct){const n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(Ea(t,r.x,i.x,o.x),Ea(t,r.y,i.y,o.y),Ea(t,r.z,i.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}La.prototype.isQuadraticBezierCurve3=!0;class Ia extends da{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new $){const n=e,r=this.points,i=(r.length-1)*t,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],u=r[o],l=r[o>r.length-2?r.length-1:o+1],c=r[o>r.length-3?r.length-1:o+2];return n.set(Sa(a,s.x,u.x,l.x,c.x),Sa(a,s.y,u.y,l.y,c.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new $).fromArray(n))}return this}}Ia.prototype.isSplineCurve=!0;var ka=Object.freeze({__proto__:null,ArcCurve:ga,CatmullRomCurve3:wa,CubicBezierCurve:Ma,CubicBezierCurve3:Ta,EllipseCurve:ma,LineCurve:Aa,LineCurve3:class extends da{constructor(t=new Ct,e=new Ct){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new Ct){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:Pa,QuadraticBezierCurve3:La,SplineCurve:Ia});class Oa extends da{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Aa(e,t))}getPoint(t,e){const n=t*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const t=r[i]-n,o=this.curves[i],a=o.getLength(),s=0===a?0:1-t/a;return o.getPointAt(s,e)}i++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],a=o.isEllipseCurve?2*t:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a);for(let t=0;t<s.length;t++){const r=s[t];n&&n.equals(r)||(e.push(r),n=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new ka[n.type]).fromJSON(n))}return this}}class Ra extends Oa{constructor(t){super(),this.type="Path",this.currentPoint=new $,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new Aa(this.currentPoint.clone(),new $(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,r){const i=new Pa(this.currentPoint.clone(),new $(t,e),new $(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(t,e,n,r,i,o){const a=new Ma(this.currentPoint.clone(),new $(t,e),new $(n,r),new $(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new Ia(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,r,i,o){const a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,e+s,n,r,i,o),this}absarc(t,e,n,r,i,o){return this.absellipse(t,e,n,n,r,i,o),this}ellipse(t,e,n,r,i,o,a,s){const u=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+u,e+l,n,r,i,o,a,s),this}absellipse(t,e,n,r,i,o,a,s){const u=new ma(t,e,n,r,i,o,a,s);if(this.curves.length>0){const t=u.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(u);const l=u.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Da extends en{constructor(t=1,e=1,n=1,r=8,i=1,o=!1,a=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};const u=this;r=Math.floor(r),i=Math.floor(i);const l=[],c=[],h=[],p=[];let f=0;const d=[],m=n/2;let g=0;function y(n){const i=f,o=new $,d=new Ct;let y=0;const v=!0===n?t:e,_=!0===n?1:-1;for(let t=1;t<=r;t++)c.push(0,m*_,0),h.push(0,_,0),p.push(.5,.5),f++;const x=f;for(let t=0;t<=r;t++){const e=t/r*s+a,n=Math.cos(e),i=Math.sin(e);d.x=v*i,d.y=m*_,d.z=v*n,c.push(d.x,d.y,d.z),h.push(0,_,0),o.x=.5*n+.5,o.y=.5*i*_+.5,p.push(o.x,o.y),f++}for(let t=0;t<r;t++){const e=i+t,r=x+t;!0===n?l.push(r,r+1,e):l.push(r+1,r,e),y+=3}u.addGroup(g,y,!0===n?1:2),g+=y}!function(){const o=new Ct,y=new Ct;let v=0;const _=(e-t)/n;for(let u=0;u<=i;u++){const l=[],g=u/i,v=g*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*s+a,u=Math.sin(i),d=Math.cos(i);y.x=v*u,y.y=-g*n+m,y.z=v*d,c.push(y.x,y.y,y.z),o.set(u,_,d).normalize(),h.push(o.x,o.y,o.z),p.push(e,1-g),l.push(f++)}d.push(l)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){const n=d[e][t],r=d[e+1][t],i=d[e+1][t+1],o=d[e][t+1];l.push(n,r,o),l.push(r,i,o),v+=6}u.addGroup(g,v,0),g+=v}(),!1===o&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(l),this.setAttribute("position",new qe(c,3)),this.setAttribute("normal",new qe(h,3)),this.setAttribute("uv",new qe(p,2))}static fromJSON(t){return new Da(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Na extends Da{constructor(t=1,e=1,n=8,r=1,i=!1,o=0,a=2*Math.PI){super(0,t,e,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}static fromJSON(t){return new Na(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}new Ct,new Ct,new Ct,new ze;class Fa extends Ra{constructor(t){super(t),this.uuid=X(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new Ra).fromJSON(n))}return this}}function za(t,e,n,r,i){let o,a;if(i===function(t,e,n,r){let i=0;for(let o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,n,r)>0)for(o=e;o<n;o+=r)a=os(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=os(o,t[o],t[o+1],a);return a&&$a(a,a.next)&&(as(a),a=a.next),a}function Ba(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!$a(r,r.next)&&0!==Ja(r.prev,r,r.next))r=r.next;else{if(as(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function ja(t,e,n,r,i,o,a){if(!t)return;!a&&o&&function(t,e,n,r){let i=t;do{null===i.z&&(i.z=Xa(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ,r);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,r,i,o);let s,u,l=t;for(;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Za(t,r,i,o):Ua(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),as(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?ja(t=Va(Ba(t),e,n),e,n,r,i,o,2):2===a&&Ga(t,e,n,r,i,o):ja(Ba(t),e,n,r,i,o,1);break}}function Ua(t){const e=t.prev,n=t,r=t.next;if(Ja(e,n,r)>=0)return!1;let i=t.next.next;for(;i!==t.prev;){if(Ka(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Ja(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Za(t,e,n,r){const i=t.prev,o=t,a=t.next;if(Ja(i,o,a)>=0)return!1;const s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=Xa(s,u,e,n,r),p=Xa(l,c,e,n,r);let f=t.prevZ,d=t.nextZ;for(;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&Ka(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Ja(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&Ka(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Ja(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&Ka(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Ja(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&Ka(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Ja(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Va(t,e,n){let r=t;do{const i=r.prev,o=r.next.next;!$a(i,o)&&ts(i,r,r.next,o)&&rs(i,o)&&rs(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),as(r),as(r.next),r=t=o),r=r.next}while(r!==t);return Ba(r)}function Ga(t,e,n,r,i,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&Qa(a,t)){let s=is(a,t);return a=Ba(a,a.next),s=Ba(s,s.next),ja(a,e,n,r,i,o),void ja(s,e,n,r,i,o)}t=t.next}a=a.next}while(a!==t)}function Ha(t,e){return t.x-e.x}function Wa(t,e){if(e=function(t,e){let n=e;const r=t.x,i=t.y;let o,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const t=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>a){if(a=t,t===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(r===a)return o;const s=o,u=o.x,l=o.y;let c,h=1/0;n=o;do{r>=n.x&&n.x>=u&&r!==n.x&&Ka(i<l?r:a,i,u,l,i<l?a:r,i,n.x,n.y)&&(c=Math.abs(i-n.y)/(r-n.x),rs(n,t)&&(c<h||c===h&&(n.x>o.x||n.x===o.x&&qa(o,n)))&&(o=n,h=c)),n=n.next}while(n!==s);return o}(t,e),e){const n=is(e,t);Ba(e,e.next),Ba(n,n.next)}}function qa(t,e){return Ja(t.prev,t,e.prev)<0&&Ja(e.next,t,t.next)<0}function Xa(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ya(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Ka(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Qa(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&ts(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(rs(t,e)&&rs(e,t)&&function(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Ja(t.prev,t,e.prev)||Ja(t,e.prev,e))||$a(t,e)&&Ja(t.prev,t,t.next)>0&&Ja(e.prev,e,e.next)>0)}function Ja(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function $a(t,e){return t.x===e.x&&t.y===e.y}function ts(t,e,n,r){const i=ns(Ja(t,e,n)),o=ns(Ja(t,e,r)),a=ns(Ja(n,r,t)),s=ns(Ja(n,r,e));return i!==o&&a!==s||!(0!==i||!es(t,n,e))||!(0!==o||!es(t,r,e))||!(0!==a||!es(n,t,r))||!(0!==s||!es(n,e,r))}function es(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function ns(t){return t>0?1:t<0?-1:0}function rs(t,e){return Ja(t.prev,t,t.next)<0?Ja(t,e,t.next)>=0&&Ja(t,t.prev,e)>=0:Ja(t,e,t.prev)<0||Ja(t,t.next,e)<0}function is(t,e){const n=new ss(t.i,t.x,t.y),r=new ss(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function os(t,e,n,r){const i=new ss(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function as(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ss(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class us{static area(t){const e=t.length;let n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n}static isClockWise(t){return us.area(t)<0}static triangulateShape(t,e){const n=[],r=[],i=[];ls(t),cs(n,t);let o=t.length;e.forEach(ls);for(let t=0;t<e.length;t++)r.push(o),o+=e[t].length,cs(n,e[t]);const a=function(t,e,n=2){const r=e&&e.length,i=r?e[0]*n:t.length;let o=za(t,0,i,n,!0);const a=[];if(!o||o.next===o.prev)return a;let s,u,l,c,h,p,f;if(r&&(o=function(t,e,n,r){const i=[];let o,a,s,u,l;for(o=0,a=e.length;o<a;o++)s=e[o]*r,u=o<a-1?e[o+1]*r:t.length,l=za(t,s,u,r,!1),l===l.next&&(l.steiner=!0),i.push(Ya(l));for(i.sort(Ha),o=0;o<i.length;o++)Wa(i[o],n),n=Ba(n,n.next);return n}(t,e,o,n)),t.length>80*n){s=l=t[0],u=c=t[1];for(let e=n;e<i;e+=n)h=t[e],p=t[e+1],h<s&&(s=h),p<u&&(u=p),h>l&&(l=h),p>c&&(c=p);f=Math.max(l-s,c-u),f=0!==f?1/f:0}return ja(o,a,n,s,u,f),a}(n,r);for(let t=0;t<a.length;t+=3)i.push(a.slice(t,t+3));return i}}function ls(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function cs(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class hs extends en{constructor(t=new Fa([new $(.5,.5),new $(-.5,.5),new $(-.5,-.5),new $(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],i=[];for(let e=0,n=t.length;e<n;e++)o(t[e]);function o(t){const o=[],a=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1;let u=void 0!==e.depth?e.depth:1,l=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:.2,h=void 0!==e.bevelSize?e.bevelSize:c-.1,p=void 0!==e.bevelOffset?e.bevelOffset:0,f=void 0!==e.bevelSegments?e.bevelSegments:3;const d=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:ps;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=e.amount);let g,y,v,_,x,b=!1;d&&(g=d.getSpacedPoints(s),b=!0,l=!1,y=d.computeFrenetFrames(s,!1),v=new Ct,_=new Ct,x=new Ct),l||(f=0,c=0,h=0,p=0);const w=t.extractPoints(a);let S=w.shape;const E=w.holes;if(!us.isClockWise(S)){S=S.reverse();for(let t=0,e=E.length;t<e;t++){const e=E[t];us.isClockWise(e)&&(E[t]=e.reverse())}}const C=us.triangulateShape(S,E),M=S;for(let t=0,e=E.length;t<e;t++){const e=E[t];S=S.concat(e)}function T(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const A=S.length,P=C.length;function L(t,e,n){let r,i,o;const a=t.x-e.x,s=t.y-e.y,u=n.x-t.x,l=n.y-t.y,c=a*a+s*s,h=a*l-s*u;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(c),p=Math.sqrt(u*u+l*l),f=e.x-s/h,d=e.y+a/h,m=((n.x-l/p-f)*l-(n.y+u/p-d)*u)/(a*l-s*u);r=f+a*m-t.x,i=d+s*m-t.y;const g=r*r+i*i;if(g<=2)return new $(r,i);o=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?u>Number.EPSILON&&(t=!0):a<-Number.EPSILON?u<-Number.EPSILON&&(t=!0):Math.sign(s)===Math.sign(l)&&(t=!0),t?(r=-s,i=a,o=Math.sqrt(c)):(r=a,i=s,o=Math.sqrt(c/2))}return new $(r/o,i/o)}const I=[];for(let t=0,e=M.length,n=e-1,r=t+1;t<e;t++,n++,r++)n===e&&(n=0),r===e&&(r=0),I[t]=L(M[t],M[n],M[r]);const k=[];let O,R=I.concat();for(let t=0,e=E.length;t<e;t++){const e=E[t];O=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),O[t]=L(e[t],e[r],e[i]);k.push(O),R=R.concat(O)}for(let t=0;t<f;t++){const e=t/f,n=c*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+p;for(let t=0,e=M.length;t<e;t++){const e=T(M[t],I[t],r);F(e.x,e.y,-n)}for(let t=0,e=E.length;t<e;t++){const e=E[t];O=k[t];for(let t=0,i=e.length;t<i;t++){const i=T(e[t],O[t],r);F(i.x,i.y,-n)}}}const D=h+p;for(let t=0;t<A;t++){const e=l?T(S[t],R[t],D):S[t];b?(_.copy(y.normals[0]).multiplyScalar(e.x),v.copy(y.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(_).add(v),F(x.x,x.y,x.z)):F(e.x,e.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<A;e++){const n=l?T(S[e],R[e],D):S[e];b?(_.copy(y.normals[t]).multiplyScalar(n.x),v.copy(y.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(_).add(v),F(x.x,x.y,x.z)):F(n.x,n.y,u/s*t)}for(let t=f-1;t>=0;t--){const e=t/f,n=c*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+p;for(let t=0,e=M.length;t<e;t++){const e=T(M[t],I[t],r);F(e.x,e.y,u+n)}for(let t=0,e=E.length;t<e;t++){const e=E[t];O=k[t];for(let t=0,i=e.length;t<i;t++){const i=T(e[t],O[t],r);b?F(i.x,i.y+g[s-1].y,g[s-1].x+n):F(i.x,i.y,u+n)}}}function N(t,e){let n=t.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=t.length-1);for(let t=0,n=s+2*f;t<n;t++){const n=A*t,o=A*(t+1);B(e+r+n,e+i+n,e+i+o,e+r+o)}}}function F(t,e,n){o.push(t),o.push(e),o.push(n)}function z(t,e,i){j(t),j(e),j(i);const o=r.length/3,a=m.generateTopUV(n,r,o-3,o-2,o-1);U(a[0]),U(a[1]),U(a[2])}function B(t,e,i,o){j(t),j(e),j(o),j(e),j(i),j(o);const a=r.length/3,s=m.generateSideWallUV(n,r,a-6,a-3,a-2,a-1);U(s[0]),U(s[1]),U(s[3]),U(s[1]),U(s[2]),U(s[3])}function j(t){r.push(o[3*t+0]),r.push(o[3*t+1]),r.push(o[3*t+2])}function U(t){i.push(t.x),i.push(t.y)}!function(){const t=r.length/3;if(l){let t=0,e=A*t;for(let t=0;t<P;t++){const n=C[t];z(n[2]+e,n[1]+e,n[0]+e)}t=s+2*f,e=A*t;for(let t=0;t<P;t++){const n=C[t];z(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<P;t++){const e=C[t];z(e[2],e[1],e[0])}for(let t=0;t<P;t++){const e=C[t];z(e[0]+A*s,e[1]+A*s,e[2]+A*s)}}n.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;N(M,e),e+=M.length;for(let t=0,n=E.length;t<n;t++){const n=E[t];N(n,e),e+=n.length}n.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new qe(r,3)),this.setAttribute("uv",new qe(i,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let r=0,i=t.shapes.length;r<i;r++){const i=e[t.shapes[r]];n.push(i)}const r=t.options.extrudePath;return void 0!==r&&(t.options.extrudePath=(new ka[r.type]).fromJSON(r)),new hs(n,t.options)}}const ps={generateTopUV:function(t,e,n,r,i){const o=e[3*n],a=e[3*n+1],s=e[3*r],u=e[3*r+1],l=e[3*i],c=e[3*i+1];return[new $(o,a),new $(s,u),new $(l,c)]},generateSideWallUV:function(t,e,n,r,i,o){const a=e[3*n],s=e[3*n+1],u=e[3*n+2],l=e[3*r],c=e[3*r+1],h=e[3*r+2],p=e[3*i],f=e[3*i+1],d=e[3*i+2],m=e[3*o],g=e[3*o+1],y=e[3*o+2];return Math.abs(s-c)<Math.abs(a-l)?[new $(a,1-u),new $(l,1-h),new $(p,1-d),new $(m,1-y)]:[new $(s,1-u),new $(c,1-h),new $(f,1-d),new $(g,1-y)]}};class fs extends en{constructor(t=new Fa([new $(0,.5),new $(-.5,-.5),new $(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],r=[],i=[],o=[];let a=0,s=0;if(!1===Array.isArray(t))u(t);else for(let e=0;e<t.length;e++)u(t[e]),this.addGroup(a,s,e),a+=s,s=0;function u(t){const a=r.length/3,u=t.extractPoints(e);let l=u.shape;const c=u.holes;!1===us.isClockWise(l)&&(l=l.reverse());for(let t=0,e=c.length;t<e;t++){const e=c[t];!0===us.isClockWise(e)&&(c[t]=e.reverse())}const h=us.triangulateShape(l,c);for(let t=0,e=c.length;t<e;t++){const e=c[t];l=l.concat(e)}for(let t=0,e=l.length;t<e;t++){const e=l[t];r.push(e.x,e.y,0),i.push(0,0,1),o.push(e.x,e.y)}for(let t=0,e=h.length;t<e;t++){const e=h[t],r=e[0]+a,i=e[1]+a,o=e[2]+a;n.push(r,i,o),s+=3}}this.setIndex(n),this.setAttribute("position",new qe(r,3)),this.setAttribute("normal",new qe(i,3)),this.setAttribute("uv",new qe(o,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let r=0,i=t.shapes.length;r<i;r++){const i=e[t.shapes[r]];n.push(i)}return new fs(n,t.curveSegments)}}class ds extends en{constructor(t=1,e=32,n=16,r=0,i=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const s=Math.min(o+a,Math.PI);let u=0;const l=[],c=new Ct,h=new Ct,p=[],f=[],d=[],m=[];for(let p=0;p<=n;p++){const g=[],y=p/n;let v=0;0==p&&0==o?v=.5/e:p==n&&s==Math.PI&&(v=-.5/e);for(let n=0;n<=e;n++){const s=n/e;c.x=-t*Math.cos(r+s*i)*Math.sin(o+y*a),c.y=t*Math.cos(o+y*a),c.z=t*Math.sin(r+s*i)*Math.sin(o+y*a),f.push(c.x,c.y,c.z),h.copy(c).normalize(),d.push(h.x,h.y,h.z),m.push(s+v,1-y),g.push(u++)}l.push(g)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=l[t][r+1],i=l[t][r],a=l[t+1][r],u=l[t+1][r+1];(0!==t||o>0)&&p.push(e,i,u),(t!==n-1||s<Math.PI)&&p.push(i,a,u)}this.setIndex(p),this.setAttribute("position",new qe(f,3)),this.setAttribute("normal",new qe(d,3)),this.setAttribute("uv",new qe(m,2))}static fromJSON(t){return new ds(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class ms extends en{constructor(t=new La(new Ct(-1,-1,0),new Ct(-1,1,0),new Ct(1,1,0)),e=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const o=t.computeFrenetFrames(e,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new Ct,s=new Ct,u=new $;let l=new Ct;const c=[],h=[],p=[],f=[];function d(i){l=t.getPointAt(i/e,l);const u=o.normals[i],p=o.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),o=-Math.cos(e);s.x=o*u.x+i*p.x,s.y=o*u.y+i*p.y,s.z=o*u.z+i*p.z,s.normalize(),h.push(s.x,s.y,s.z),a.x=l.x+n*s.x,a.y=l.y+n*s.y,a.z=l.z+n*s.z,c.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)d(t);d(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)u.x=t/e,u.y=n/r,p.push(u.x,u.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),o=(r+1)*t+e,a=(r+1)*(t-1)+e;f.push(n,i,a),f.push(i,o,a)}}()}(),this.setIndex(f),this.setAttribute("position",new qe(c,3)),this.setAttribute("normal",new qe(h,3)),this.setAttribute("uv",new qe(p,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new ms((new ka[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class gs extends je{constructor(t){super(),this.type="ShadowMaterial",this.color=new ft(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}gs.prototype.isShadowMaterial=!0;class ys extends Mn{constructor(t){super(t),this.type="RawShaderMaterial"}}ys.prototype.isRawShaderMaterial=!0;class vs extends je{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ft(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}vs.prototype.isMeshStandardMaterial=!0;class _s extends vs{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new $(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Y(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new ft(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new ft(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ft(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}_s.prototype.isMeshPhysicalMaterial=!0;class xs extends je{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new ft(16777215),this.specular=new ft(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}xs.prototype.isMeshPhongMaterial=!0;class bs extends je{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ft(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}bs.prototype.isMeshToonMaterial=!0;class ws extends je{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}ws.prototype.isMeshNormalMaterial=!0;class Ss extends je{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new ft(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Ss.prototype.isMeshLambertMaterial=!0;class Es extends je{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ft(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}Es.prototype.isMeshMatcapMaterial=!0;class Cs extends Jo{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}Cs.prototype.isLineDashedMaterial=!0;const Ms={ShadowMaterial:gs,SpriteMaterial:Co,RawShaderMaterial:ys,ShaderMaterial:Mn,PointsMaterial:ua,MeshPhysicalMaterial:_s,MeshStandardMaterial:vs,MeshPhongMaterial:xs,MeshToonMaterial:bs,MeshNormalMaterial:ws,MeshLambertMaterial:Ss,MeshDepthMaterial:io,MeshDistanceMaterial:oo,MeshBasicMaterial:Ue,MeshMatcapMaterial:Es,LineDashedMaterial:Cs,LineBasicMaterial:Jo,Material:je};je.fromType=function(t){return new Ms[t]};const Ts={arraySlice:function(t,e,n){return Ts.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const r=t.length,i=new t.constructor(r);for(let o=0,a=0;a!==r;++o){const r=n[o]*e;for(let n=0;n!==e;++n)i[a++]=t[r+n]}return i},flattenJSON:function(t,e,n,r){let i=1,o=t[0];for(;void 0!==o&&void 0===o[r];)o=t[i++];if(void 0===o)return;let a=o[r];if(void 0!==a)if(Array.isArray(a))do{a=o[r],void 0!==a&&(e.push(o.time),n.push.apply(n,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[r],void 0!==a&&(e.push(o.time),a.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{a=o[r],void 0!==a&&(e.push(o.time),n.push(a)),o=t[i++]}while(void 0!==o)},subclip:function(t,e,n,r,i=30){const o=t.clone();o.name=e;const a=[];for(let t=0;t<o.tracks.length;++t){const e=o.tracks[t],s=e.getValueSize(),u=[],l=[];for(let t=0;t<e.times.length;++t){const o=e.times[t]*i;if(!(o<n||o>=r)){u.push(e.times[t]);for(let n=0;n<s;++n)l.push(e.values[t*s+n])}}0!==u.length&&(e.times=Ts.convertArray(u,e.times.constructor),e.values=Ts.convertArray(l,e.values.constructor),a.push(e))}o.tracks=a;let s=1/0;for(let t=0;t<o.tracks.length;++t)s>o.tracks[t].times[0]&&(s=o.tracks[t].times[0]);for(let t=0;t<o.tracks.length;++t)o.tracks[t].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(t,e=0,n=t,r=30){r<=0&&(r=30);const i=n.tracks.length,o=e/r;for(let e=0;e<i;++e){const r=n.tracks[e],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const a=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===i}));if(void 0===a)continue;let s=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=u/3);let l=0;const c=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);const h=r.times.length-1;let p;if(o<=r.times[0]){const t=s,e=u-s;p=Ts.arraySlice(r.values,t,e)}else if(o>=r.times[h]){const t=h*u+s,e=t+u-s;p=Ts.arraySlice(r.values,t,e)}else{const t=r.createInterpolant(),e=s,n=u-s;t.evaluate(o),p=Ts.arraySlice(t.resultBuffer,e,n)}"quaternion"===i&&(new Et).fromArray(p).normalize().conjugate().toArray(p);const f=a.times.length;for(let t=0;t<f;++t){const e=t*c+l;if("quaternion"===i)Et.multiplyQuaternionsFlat(a.values,e,p,0,a.values,e);else{const t=c-2*l;for(let n=0;n<t;++n)a.values[e+n]-=p[n]}}}return t.blendMode=2501,t}};class As{constructor(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let o;n:{r:if(!(t<r)){for(let o=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===o)break;if(i=r,r=e[++n],t<r)break e}o=e.length;break n}if(t>=i)break t;{const a=e[1];t<a&&(n=2,i=a);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===o)break;if(r=i,i=e[--n-1],t>=i)break e}o=n,n=0}}for(;n<o;){const r=n+o>>>1;t<e[r]?o=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}As.prototype.beforeStart_=As.prototype.copySampleValue_,As.prototype.afterEnd_=As.prototype.copySampleValue_;class Ps extends As{constructor(t,e,n,r){super(t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:k,endingEnd:k}}intervalChanged_(t,e,n){const r=this.parameterPositions;let i=t-2,o=t+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case O:i=t,a=2*e-n;break;case R:i=r.length-2,a=e+r[i]-r[i+1];break;default:i=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case O:o=t,s=2*n-e;break;case R:o=1,s=n+r[1]-r[0];break;default:o=t-1,s=e}const u=.5*(n-e),l=this.valueSize;this._weightPrev=u/(e-a),this._weightNext=u/(s-n),this._offsetPrev=i*l,this._offsetNext=o*l}interpolate_(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=s-a,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,p=this._weightNext,f=(n-e)/(r-e),d=f*f,m=d*f,g=-h*m+2*h*d-h*f,y=(1+h)*m+(-1.5-2*h)*d+(-.5+h)*f+1,v=(-1-p)*m+(1.5+p)*d+.5*f,_=p*m-p*d;for(let t=0;t!==a;++t)i[t]=g*o[l+t]+y*o[u+t]+v*o[s+t]+_*o[c+t];return i}}class Ls extends As{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=s-a,l=(n-e)/(r-e),c=1-l;for(let t=0;t!==a;++t)i[t]=o[u+t]*c+o[s+t]*l;return i}}class Is extends As{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class ks{constructor(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Ts.convertArray(e,this.TimeBufferType),this.values=Ts.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Ts.convertArray(t.times,Array),values:Ts.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new Is(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Ls(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Ps(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case P:e=this.InterpolantFactoryMethodDiscrete;break;case L:e=this.InterpolantFactoryMethodLinear;break;case I:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return P;case this.InterpolantFactoryMethodLinear:return L;case this.InterpolantFactoryMethodSmooth:return I}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const t=this.getValueSize();this.times=Ts.arraySlice(n,i,o),this.values=Ts.arraySlice(this.values,i*t,o*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,o),t=!1;break}o=r}if(void 0!==r&&Ts.isTypedArray(r))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=Ts.arraySlice(this.times),e=Ts.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===I,i=t.length-1;let o=1;for(let a=1;a<i;++a){let i=!1;const s=t[a];if(s!==t[a+1]&&(1!==a||s!==t[0]))if(r)i=!0;else{const t=a*n,r=t-n,o=t+n;for(let a=0;a!==n;++a){const n=e[t+a];if(n!==e[r+a]||n!==e[o+a]){i=!0;break}}}if(i){if(a!==o){t[o]=t[a];const r=a*n,i=o*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++o}}if(i>0){t[o]=t[i];for(let t=i*n,r=o*n,a=0;a!==n;++a)e[r+a]=e[t+a];++o}return o!==t.length?(this.times=Ts.arraySlice(t,0,o),this.values=Ts.arraySlice(e,0,o*n)):(this.times=t,this.values=e),this}clone(){const t=Ts.arraySlice(this.times,0),e=Ts.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}ks.prototype.TimeBufferType=Float32Array,ks.prototype.ValueBufferType=Float32Array,ks.prototype.DefaultInterpolation=L;class Os extends ks{}Os.prototype.ValueTypeName="bool",Os.prototype.ValueBufferType=Array,Os.prototype.DefaultInterpolation=P,Os.prototype.InterpolantFactoryMethodLinear=void 0,Os.prototype.InterpolantFactoryMethodSmooth=void 0;class Rs extends ks{}Rs.prototype.ValueTypeName="color";class Ds extends ks{}Ds.prototype.ValueTypeName="number";class Ns extends As{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-e)/(r-e);let u=t*a;for(let t=u+a;u!==t;u+=4)Et.slerpFlat(i,0,o,u-a,o,u,s);return i}}class Fs extends ks{InterpolantFactoryMethodLinear(t){return new Ns(this.times,this.values,this.getValueSize(),t)}}Fs.prototype.ValueTypeName="quaternion",Fs.prototype.DefaultInterpolation=L,Fs.prototype.InterpolantFactoryMethodSmooth=void 0;class zs extends ks{}zs.prototype.ValueTypeName="string",zs.prototype.ValueBufferType=Array,zs.prototype.DefaultInterpolation=P,zs.prototype.InterpolantFactoryMethodLinear=void 0,zs.prototype.InterpolantFactoryMethodSmooth=void 0;class Bs extends ks{}Bs.prototype.ValueTypeName="vector";class js{constructor(t,e=-1,n,r=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=X(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let t=0,i=n.length;t!==i;++t)e.push(Us(n[t]).scale(r));const i=new this(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i}static toJSON(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,r=n.length;t!==r;++t)e.push(ks.toJSON(n[t]));return r}static CreateFromMorphTargetSequence(t,e,n,r){const i=e.length,o=[];for(let t=0;t<i;t++){let a=[],s=[];a.push((t+i-1)%i,t,(t+1)%i),s.push(0,1,0);const u=Ts.getKeyframeOrder(a);a=Ts.sortedArray(a,1,u),s=Ts.sortedArray(s,1,u),r||0!==a[0]||(a.push(i),s.push(s[0])),o.push(new Ds(".morphTargetInfluences["+e[t].name+"]",a,s).scale(1/n))}return new this(t,-1,o)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],o=n.name.match(i);if(o&&o.length>1){const t=o[1];let e=r[t];e||(r[t]=e=[]),e.push(n)}}const o=[];for(const t in r)o.push(this.CreateFromMorphTargetSequence(t,r[t],e,n));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,i){if(0!==n.length){const o=[],a=[];Ts.flattenJSON(n,o,a,r),0!==o.length&&i.push(new t(e,o,a))}},r=[],i=t.name||"default",o=t.fps||30,a=t.blendMode;let s=t.length||-1;const u=t.hierarchy||[];for(let t=0;t<u.length;t++){const i=u[t].keys;if(i&&0!==i.length)if(i[0].morphTargets){const t={};let e;for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let n=0;n<i[e].morphTargets.length;n++)t[i[e].morphTargets[n]]=-1;for(const n in t){const t=[],o=[];for(let r=0;r!==i[e].morphTargets.length;++r){const r=i[e];t.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new Ds(".morphTargetInfluence["+n+"]",t,o))}s=t.length*o}else{const o=".bones["+e[t].name+"]";n(Bs,o+".position",i,"pos",r),n(Fs,o+".quaternion",i,"rot",r),n(Bs,o+".scale",i,"scl",r)}}return 0===r.length?null:new this(i,s,r,a)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Us(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ds;case"vector":case"vector2":case"vector3":case"vector4":return Bs;case"color":return Rs;case"quaternion":return Fs;case"bool":case"boolean":return Os;case"string":return zs}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];Ts.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Zs={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};const Vs=new class{constructor(t,e,n){const r=this;let i,o=!1,a=0,s=0;const u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){s++,!1===o&&void 0!==r.onStart&&r.onStart(t,a,s),o=!0},this.itemEnd=function(t){a++,void 0!==r.onProgress&&r.onProgress(t,a,s),a===s&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return u.push(t,e),this},this.removeHandler=function(t){const e=u.indexOf(t);return-1!==e&&u.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=u.length;e<n;e+=2){const n=u[e],r=u[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}};class Gs{constructor(t){this.manager=void 0!==t?t:Vs,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Hs={};class Ws extends Gs{constructor(t){super(t)}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=Zs.get(t);if(void 0!==i)return this.manager.itemStart(t),setTimeout((()=>{e&&e(i),this.manager.itemEnd(t)}),0),i;if(void 0!==Hs[t])return void Hs[t].push({onLoad:e,onProgress:n,onError:r});Hs[t]=[],Hs[t].push({onLoad:e,onProgress:n,onError:r});const o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,s=this.responseType;fetch(o).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=Hs[t],r=e.body.getReader(),i=e.headers.get("Content-Length"),o=i?parseInt(i):0,a=0!==o;let s=0;const u=new ReadableStream({start(t){!function e(){r.read().then((({done:r,value:i})=>{if(r)t.close();else{s+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:a,loaded:s,total:o});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(r)}t.enqueue(i),e()}}))}()}});return new Response(u)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(s){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,a)));case"json":return t.json();default:if(void 0===a)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(a),n=e&&e[1]?e[1].toLowerCase():void 0,r=new TextDecoder(n);return t.arrayBuffer().then((t=>r.decode(t)))}}})).then((e=>{Zs.add(t,e);const n=Hs[t];delete Hs[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onLoad&&r.onLoad(e)}})).catch((e=>{const n=Hs[t];if(void 0===n)throw this.manager.itemError(t),e;delete Hs[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class qs extends Gs{constructor(t){super(t)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=Zs.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;const a=nt("img");function s(){l(),Zs.add(t,this),e&&e(this),i.manager.itemEnd(t)}function u(e){l(),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}function l(){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1)}return a.addEventListener("load",s,!1),a.addEventListener("error",u,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a}}class Xs extends Gs{constructor(t){super(t)}load(t,e,n,r){const i=new In,o=new qs(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function s(n){o.load(t[n],(function(t){i.images[n]=t,a++,6===a&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(let e=0;e<t.length;++e)s(e);return i}}class Ys extends Gs{constructor(t){super(t)}load(t,e,n,r){const i=new _t,o=new qs(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(t){i.image=t,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}}class Ks extends Te{constructor(t,e=1){super(),this.type="Light",this.color=new ft(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}Ks.prototype.isLight=!0;(class extends Ks{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy(Te.DefaultUp),this.updateMatrix(),this.groundColor=new ft(e)}copy(t){return Ks.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}).prototype.isHemisphereLight=!0;const Qs=new ne,Js=new Ct,$s=new Ct;class tu{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new $(512,512),this.map=null,this.mapPass=null,this.matrix=new ne,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Bn,this._frameExtents=new $(1,1),this._viewportCount=1,this._viewports=[new xt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;Js.setFromMatrixPosition(t.matrixWorld),e.position.copy(Js),$s.setFromMatrixPosition(t.target.matrixWorld),e.lookAt($s),e.updateMatrixWorld(),Qs.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Qs),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class eu extends tu{constructor(){super(new An(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,n=2*q*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}eu.prototype.isSpotLightShadow=!0;(class extends Ks{constructor(t,e,n=0,r=Math.PI/3,i=0,o=1){super(t,e),this.type="SpotLight",this.position.copy(Te.DefaultUp),this.updateMatrix(),this.target=new Te,this.distance=n,this.angle=r,this.penumbra=i,this.decay=o,this.shadow=new eu}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isSpotLight=!0;const nu=new ne,ru=new Ct,iu=new Ct;class ou extends tu{constructor(){super(new An(90,1,.5,500)),this._frameExtents=new $(4,2),this._viewportCount=6,this._viewports=[new xt(2,1,1,1),new xt(0,1,1,1),new xt(3,1,1,1),new xt(1,1,1,1),new xt(3,0,1,1),new xt(1,0,1,1)],this._cubeDirections=[new Ct(1,0,0),new Ct(-1,0,0),new Ct(0,0,1),new Ct(0,0,-1),new Ct(0,1,0),new Ct(0,-1,0)],this._cubeUps=[new Ct(0,1,0),new Ct(0,1,0),new Ct(0,1,0),new Ct(0,1,0),new Ct(0,0,1),new Ct(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),ru.setFromMatrixPosition(t.matrixWorld),n.position.copy(ru),iu.copy(n.position),iu.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(iu),n.updateMatrixWorld(),r.makeTranslation(-ru.x,-ru.y,-ru.z),nu.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nu)}}ou.prototype.isPointLightShadow=!0;(class extends Ks{constructor(t,e,n=0,r=1){super(t,e),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new ou}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}).prototype.isPointLight=!0;class au extends tu{constructor(){super(new Jn(-5,5,5,-5,.5,500))}}au.prototype.isDirectionalLightShadow=!0;class su extends Ks{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Te.DefaultUp),this.updateMatrix(),this.target=new Te,this.shadow=new au}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}su.prototype.isDirectionalLight=!0;class uu extends Ks{constructor(t,e){super(t,e),this.type="AmbientLight"}}uu.prototype.isAmbientLight=!0;(class extends Ks{constructor(t,e,n=10,r=10){super(t,e),this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}).prototype.isRectAreaLight=!0;class lu{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Ct)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*r),e.addScaledVector(o[2],.488603*i),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*r*1.092548),e.addScaledVector(o[5],r*i*1.092548),e.addScaledVector(o[6],.315392*(3*i*i-1)),e.addScaledVector(o[7],n*i*1.092548),e.addScaledVector(o[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*r),e.addScaledVector(o[2],1.023328*i),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*r),e.addScaledVector(o[5],.858086*r*i),e.addScaledVector(o[6],.743125*i*i-.247708),e.addScaledVector(o[7],.858086*n*i),e.addScaledVector(o[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}lu.prototype.isSphericalHarmonics3=!0;class cu extends Ks{constructor(t=new lu,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}cu.prototype.isLightProbe=!0;class hu{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}let pu;(class extends en{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}).prototype.isInstancedBufferGeometry=!0,class extends Gs{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=Zs.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){Zs.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}.prototype.isImageBitmapLoader=!0;class fu extends Gs{constructor(t){super(t)}load(t,e,n,r){const i=this,o=new Ws(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{const t=n.slice(0);(void 0===pu&&(pu=new(window.AudioContext||window.webkitAudioContext)),pu).decodeAudioData(t,(function(t){e(t)}))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}}(class extends cu{constructor(t,e,n=1){super(void 0,n);const r=(new ft).set(t),i=(new ft).set(e),o=new Ct(r.r,r.g,r.b),a=new Ct(i.r,i.g,i.b),s=Math.sqrt(Math.PI),u=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(u)}}).prototype.isHemisphereLightProbe=!0,class extends cu{constructor(t,e=1){super(void 0,e);const n=(new ft).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class du{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=mu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=mu();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function mu(){return("undefined"==typeof performance?Date:performance).now()}class gu{constructor(t,e,n){let r,i,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,r=this.valueSize,i=t*r+r;let o=this.cumulativeWeight;if(0===o){for(let t=0;t!==r;++t)n[i+t]=n[t];o=e}else{o+=e;const t=e/o;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=o}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let t=e,i=e+e;t!==i;++t)if(n[t]!==n[t+e]){a.setValue(n,r);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let t=n,i=r;t!==i;++t)e[t]=e[r+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)t[e+r]=t[n+r]}_slerp(t,e,n,r){Et.slerpFlat(t,e,t,e,t,n,r)}_slerpAdditive(t,e,n,r,i){const o=this._workIndex*i;Et.multiplyQuaternionsFlat(t,o,t,e,t,n),Et.slerpFlat(t,e,t,e,t,o,r)}_lerp(t,e,n,r,i){const o=1-r;for(let a=0;a!==i;++a){const i=e+a;t[i]=t[i]*o+t[n+a]*r}}_lerpAdditive(t,e,n,r,i){for(let o=0;o!==i;++o){const i=e+o;t[i]=t[i]+t[n+o]*r}}}const yu=new RegExp("[\\[\\]\\.:\\/]","g"),vu="[^\\[\\]\\.:\\/]",_u="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",xu=/((?:WC+[\/:])*)/.source.replace("WC",vu),bu=/(WCOD+)?/.source.replace("WCOD",_u),wu=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",vu),Su=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",vu),Eu=new RegExp("^"+xu+bu+wu+Su+"$"),Cu=["material","materials","bones"];class Mu{constructor(t,e,n){this.path=e,this.parsedPath=n||Mu.parseTrackName(e),this.node=Mu.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new Mu.Composite(t,e,n):new Mu(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(yu,"")}static parseTrackName(t){const e=Eu.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==Cu.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const o=n(i.children);if(o)return o}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=Mu.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const o=t[r];if(void 0===o){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Mu.Composite=class{constructor(t,e,n){const r=n||Mu.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},Mu.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Mu.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Mu.prototype.GetterByBindingType=[Mu.prototype._getValue_direct,Mu.prototype._getValue_array,Mu.prototype._getValue_arrayElement,Mu.prototype._getValue_toArray],Mu.prototype.SetterByBindingTypeAndVersioning=[[Mu.prototype._setValue_direct,Mu.prototype._setValue_direct_setNeedsUpdate,Mu.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Mu.prototype._setValue_array,Mu.prototype._setValue_array_setNeedsUpdate,Mu.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Mu.prototype._setValue_arrayElement,Mu.prototype._setValue_arrayElement_setNeedsUpdate,Mu.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Mu.prototype._setValue_fromArray,Mu.prototype._setValue_fromArray_setNeedsUpdate,Mu.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Tu{constructor(t,e,n=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;const i=e.tracks,o=i.length,a=new Array(o),s={endingStart:k,endingEnd:k};for(let t=0;t!==o;++t){const e=i[t].createInterpolant(null);a[t]=e,e.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,r=t._clip.duration,i=r/n,o=n/r;t.warp(1,i,e),this.warp(o,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const r=this._mixer,i=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,u=a.sampleValues;return s[0]=i,s[1]=i+n,u[0]=t/o,u[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);const i=this._startTime;if(null!==i){const r=(t-i)*n;if(r<0||0===n)return;this._startTime=null,e=n*r}e*=this._updateTimeScale(t);const o=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(o),e[n].accumulateAdditive(a);else for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(o),e[n].accumulate(r,a)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let r=this.time+t,i=this._loopCount;const o=2202===n;if(0===t)return-1===i?r:o&&1==(1&i)?e-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=e||r<0){const n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);const a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return e-r}return r}_setEndings(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=O,r.endingEnd=O):(r.endingStart=t?this.zeroSlopeAtStart?O:k:R,r.endingEnd=e?this.zeroSlopeAtEnd?O:k:R)}_scheduleFading(t,e,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=n,this}}(class extends G{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings,a=t._interpolants,s=n.uuid,u=this._bindingsByRootAndName;let l=u[s];void 0===l&&(l={},u[s]=l);for(let t=0;t!==i;++t){const i=r[t],u=i.name;let c=l[u];if(void 0!==c)++c.referenceCount,o[t]=c;else{if(c=o[t],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,s,u));continue}const r=e&&e._propertyBindings[t].binding.parsedPath;c=new gu(Mu.create(n,u,r),i.ValueTypeName,i.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,s,u),o[t]=c}a[t].resultBuffer=c.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const r=this._actions,i=this._actionsByClip;let o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{const e=o.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,u=s[s.length-1],l=t._byClipCacheIndex;u._byClipCacheIndex=l,s[l]=u,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_addInactiveBinding(t,e,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[e];void 0===o&&(o={},r[e]=o),o[n]=t,t._cacheIndex=i.length,i.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=e[e.length-1],u=t._cacheIndex;s._cacheIndex=u,e[u]=s,e.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new Ls(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i}clipAction(t,e,n){const r=e||this._root,i=r.uuid;let o="string"==typeof t?js.findByName(r,t):t;const a=null!==o?o.uuid:t,s=this._actionsByClip[a];let u=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==s){const t=s.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;u=s.knownActions[0],null===o&&(o=u._clip)}if(null===o)return null;const l=new Tu(this,o,e,n);return this._bindAction(l,u),this._addInactiveAction(l,a,i),l}existingAction(t,e){const n=e||this._root,r=n.uuid,i="string"==typeof t?js.findByName(n,t):t,o=i?i.uuid:t,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1;for(let a=0;a!==n;++a)e[a]._update(r,t,i,o);const a=this._bindings,s=this._nActiveBindings;for(let t=0;t!==s;++t)a[t].apply(o);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){const r=t[n];this._deactivateAction(r);const i=r._cacheIndex,o=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,e[i]=o,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const r=n[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Au{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Au(void 0===this.value.clone?this.value:this.value.clone())}}(class extends wo{constructor(t,e,n=1){super(t,e),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}).prototype.isInstancedInterleavedBuffer=!0;class Pu{constructor(t,e,n=0,r=1/0){this.ray=new ee(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new fe,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,n=[]){return Iu(t,this,n,e),n.sort(Lu),n}intersectObjects(t,e=!0,n=[]){for(let r=0,i=t.length;r<i;r++)Iu(t[r],this,n,e);return n.sort(Lu),n}}function Lu(t,e){return t.distance-e.distance}function Iu(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)Iu(r[t],e,n,!0)}}class ku{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Y(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const Ou=new $;class Ru{constructor(t=new $(1/0,1/0),e=new $(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Ou.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Ou.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Ru.prototype.isBox2=!0;const Du=new Ct,Nu=new ne,Fu=new ne;function zu(t){const e=[];!0===t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,zu(t.children[n]));return e}const Bu=new ArrayBuffer(4),ju=(new Float32Array(Bu),new Uint32Array(Bu),new Uint32Array(512)),Uu=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(ju[t]=0,ju[256|t]=32768,Uu[t]=24,Uu[256|t]=24):e<-14?(ju[t]=1024>>-e-14,ju[256|t]=1024>>-e-14|32768,Uu[t]=-e-1,Uu[256|t]=-e-1):e<=15?(ju[t]=e+15<<10,ju[256|t]=e+15<<10|32768,Uu[t]=13,Uu[256|t]=13):e<128?(ju[t]=31744,ju[256|t]=64512,Uu[t]=24,Uu[256|t]=24):(ju[t]=31744,ju[256|t]=64512,Uu[t]=13,Uu[256|t]=13)}const Zu=new Uint32Array(2048),Vu=new Uint32Array(64),Gu=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,n=0;for(;0==(8388608&e);)e<<=1,n-=8388608;e&=-8388609,n+=947912704,Zu[t]=e|n}for(let t=1024;t<2048;++t)Zu[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)Vu[t]=t<<23;Vu[31]=1199570944,Vu[32]=2147483648;for(let t=33;t<63;++t)Vu[t]=2147483648+(t-32<<23);Vu[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(Gu[t]=1024);da.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(da.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Ra.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},class extends sa{constructor(t=10,e=10,n=4473924,r=8947848){n=new ft(n),r=new ft(r);const i=e/2,o=t/e,a=t/2,s=[],u=[];for(let t=0,l=0,c=-a;t<=e;t++,c+=o){s.push(-a,0,c,a,0,c),s.push(c,0,-a,c,0,a);const e=t===i?n:r;e.toArray(u,l),l+=3,e.toArray(u,l),l+=3,e.toArray(u,l),l+=3,e.toArray(u,l),l+=3}const l=new en;l.setAttribute("position",new qe(s,3)),l.setAttribute("color",new qe(u,3)),super(l,new Jo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends sa{constructor(t){const e=zu(t),n=new en,r=[],i=[],o=new ft(0,0,1),a=new ft(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new qe(r,3)),n.setAttribute("color",new qe(i,3)),super(n,new Jo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");Fu.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(Nu.multiplyMatrices(Fu,i.matrixWorld),Du.setFromMatrixPosition(Nu),r.setXYZ(n,Du.x,Du.y,Du.z),Nu.multiplyMatrices(Fu,i.parent.matrixWorld),Du.setFromMatrixPosition(Nu),r.setXYZ(n+1,Du.x,Du.y,Du.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Gs.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),hu.extractUrlBase(t)},Gs.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Ru.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},Ru.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ru.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Ru.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},At.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},At.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},At.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},At.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},At.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},pe.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},qt.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Bn.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},tt.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},tt.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},tt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},tt.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},tt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},tt.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},ne.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},ne.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},ne.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Ct).setFromMatrixColumn(this,3)},ne.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},ne.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},ne.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ne.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ne.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},ne.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},ne.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ne.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},ne.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},ne.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},ne.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},ne.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},ne.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ne.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},ne.prototype.makeFrustum=function(t,e,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,o)},ne.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Nn.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Et.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Et.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},ee.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},ee.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},ee.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},ze.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},ze.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},ze.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},ze.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},ze.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},ze.barycoordFromPoint=function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ze.getBarycoord(t,e,n,r,i)},ze.normal=function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ze.getNormal(t,e,n,r)},Fa.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},Fa.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new hs(this,t)},Fa.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new fs(this,t)},$.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},$.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},$.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ct.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Ct.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Ct.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},Ct.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},Ct.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},Ct.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},Ct.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Ct.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Ct.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},xt.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},xt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Te.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},Te.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Te.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},Te.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Te.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Te.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),xn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(xn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Wo.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},An.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Ks.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Ge.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===U},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(U)}}}),Ge.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?U:j),this},Ge.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Ge.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},en.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},en.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Ge(arguments[1],arguments[2])))},en.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},en.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},en.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},en.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},en.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(en.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),wo.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?U:j),this},wo.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},hs.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},hs.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},hs.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},bo.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Au.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(je.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ft}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Mn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),vo.prototype.clearTarget=function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},vo.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},vo.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},vo.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},vo.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},vo.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},vo.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},vo.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},vo.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},vo.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},vo.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},vo.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},vo.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},vo.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},vo.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},vo.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},vo.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},vo.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},vo.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},vo.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},vo.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},vo.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},vo.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},vo.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},vo.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(vo.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?N:D}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(ao.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(bt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),class extends Te{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new fu).load(t,(function(t){e.setBuffer(t)})),this},Ln.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Ln.prototype.clear=function(t,e,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,r)},mt.crossOrigin=void 0,mt.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new Ys;i.setCrossOrigin(this.crossOrigin);const o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},mt.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new Xs;i.setCrossOrigin(this.crossOrigin);const o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},mt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},mt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"139"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="139");const Hu=new Nn,Wu=new Pu,qu=new $,Xu=new Ct,Yu=new Ct,Ku=new Ct,Qu=new ne;class Ju extends G{constructor(t,e,n){super(),n.style.touchAction="none";let r=null,i=null;const o=[],a=this;function s(){n.addEventListener("pointermove",l),n.addEventListener("pointerdown",c),n.addEventListener("pointerup",h),n.addEventListener("pointerleave",h)}function u(){n.removeEventListener("pointermove",l),n.removeEventListener("pointerdown",c),n.removeEventListener("pointerup",h),n.removeEventListener("pointerleave",h),n.style.cursor=""}function l(s){if(!1!==a.enabled){if(p(s),Wu.setFromCamera(qu,e),r)return Wu.ray.intersectPlane(Hu,Yu)&&r.position.copy(Yu.sub(Xu).applyMatrix4(Qu)),void a.dispatchEvent({type:"drag",object:r});if("mouse"===s.pointerType||"pen"===s.pointerType)if(o.length=0,Wu.setFromCamera(qu,e),Wu.intersectObjects(t,!0,o),o.length>0){const t=o[0].object;Hu.setFromNormalAndCoplanarPoint(e.getWorldDirection(Hu.normal),Ku.setFromMatrixPosition(t.matrixWorld)),i!==t&&null!==i&&(a.dispatchEvent({type:"hoveroff",object:i}),n.style.cursor="auto",i=null),i!==t&&(a.dispatchEvent({type:"hoveron",object:t}),n.style.cursor="pointer",i=t)}else null!==i&&(a.dispatchEvent({type:"hoveroff",object:i}),n.style.cursor="auto",i=null)}}function c(i){!1!==a.enabled&&(p(i),o.length=0,Wu.setFromCamera(qu,e),Wu.intersectObjects(t,!0,o),o.length>0&&(r=!0===a.transformGroup?t[0]:o[0].object,Hu.setFromNormalAndCoplanarPoint(e.getWorldDirection(Hu.normal),Ku.setFromMatrixPosition(r.matrixWorld)),Wu.ray.intersectPlane(Hu,Yu)&&(Qu.copy(r.parent.matrixWorld).invert(),Xu.copy(Yu).sub(Ku.setFromMatrixPosition(r.matrixWorld))),n.style.cursor="move",a.dispatchEvent({type:"dragstart",object:r})))}function h(){!1!==a.enabled&&(r&&(a.dispatchEvent({type:"dragend",object:r}),r=null),n.style.cursor=i?"pointer":"auto")}function p(t){const e=n.getBoundingClientRect();qu.x=(t.clientX-e.left)/e.width*2-1,qu.y=-(t.clientY-e.top)/e.height*2+1}s(),this.enabled=!0,this.transformGroup=!1,this.activate=s,this.deactivate=u,this.dispose=function(){u()},this.getObjects=function(){return t},this.getRaycaster=function(){return Wu}}}var $u={value:()=>{}};function tl(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new el(r)}function el(t){this._=t}function nl(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function rl(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function il(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=$u,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}el.prototype=tl.prototype={constructor:el,on:function(t,e){var n,r=this._,i=nl(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=i[o]).type)r[n]=il(r[n],t.name,e);else if(null==e)for(n in r)r[n]=il(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=i[o]).type)&&(n=rl(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new el(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};const ol=tl;var al,sl,ul=0,ll=0,cl=0,hl=0,pl=0,fl=0,dl="object"==typeof performance&&performance.now?performance:Date,ml="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function gl(){return pl||(ml(yl),pl=dl.now()+fl)}function yl(){pl=0}function vl(){this._call=this._time=this._next=null}function _l(t,e,n){var r=new vl;return r.restart(t,e,n),r}function xl(){pl=(hl=dl.now())+fl,ul=ll=0;try{!function(){gl(),++ul;for(var t,e=al;e;)(t=pl-e._time)>=0&&e._call.call(void 0,t),e=e._next;--ul}()}finally{ul=0,function(){for(var t,e,n=al,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:al=e);sl=t,wl(r)}(),pl=0}}function bl(){var t=dl.now(),e=t-hl;e>1e3&&(fl-=e,hl=t)}function wl(t){ul||(ll&&(ll=clearTimeout(ll)),t-pl>24?(t<1/0&&(ll=setTimeout(xl,t-dl.now()-fl)),cl&&(cl=clearInterval(cl))):(cl||(hl=dl.now(),cl=setInterval(bl,1e3)),ul=1,ml(xl)))}vl.prototype=_l.prototype={constructor:vl,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?gl():+n)+(null==e?0:+e),this._next||sl===this||(sl?sl._next=this:al=this,sl=this),this._call=t,this._time=n,wl()},stop:function(){this._call&&(this._call=null,this._time=1/0,wl())}};const Sl=4294967296;function El(t){return t.x}function Cl(t){return t.y}function Ml(t){return t.z}var Tl=Math.PI*(3-Math.sqrt(5)),Al=20*Math.PI/(9+Math.sqrt(221));function Pl(t,e){e=e||2;var n,r=Math.min(3,Math.max(1,Math.round(e))),i=1,o=.001,a=1-Math.pow(o,1/300),s=0,u=.6,l=new Map,c=_l(f),h=ol("tick","end"),p=function(){let t=1;return()=>(t=(1664525*t+1013904223)%Sl)/Sl}();function f(){d(),h.call("tick",n),i<o&&(c.stop(),h.call("end",n))}function d(e){var o,c,h=t.length;void 0===e&&(e=1);for(var p=0;p<e;++p)for(i+=(s-i)*a,l.forEach((function(t){t(i)})),o=0;o<h;++o)null==(c=t[o]).fx?c.x+=c.vx*=u:(c.x=c.fx,c.vx=0),r>1&&(null==c.fy?c.y+=c.vy*=u:(c.y=c.fy,c.vy=0)),r>2&&(null==c.fz?c.z+=c.vz*=u:(c.z=c.fz,c.vz=0));return n}function m(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),null!=e.fz&&(e.z=e.fz),isNaN(e.x)||r>1&&isNaN(e.y)||r>2&&isNaN(e.z)){var o=10*(r>2?Math.cbrt(.5+n):r>1?Math.sqrt(.5+n):n),a=n*Tl,s=n*Al;1===r?e.x=o:2===r?(e.x=o*Math.cos(a),e.y=o*Math.sin(a)):(e.x=o*Math.sin(a)*Math.cos(s),e.y=o*Math.cos(a),e.z=o*Math.sin(a)*Math.sin(s))}(isNaN(e.vx)||r>1&&isNaN(e.vy)||r>2&&isNaN(e.vz))&&(e.vx=0,r>1&&(e.vy=0),r>2&&(e.vz=0))}}function g(e){return e.initialize&&e.initialize(t,p,r),e}return null==t&&(t=[]),m(),n={tick:d,restart:function(){return c.restart(f),n},stop:function(){return c.stop(),n},numDimensions:function(t){return arguments.length?(r=Math.min(3,Math.max(1,Math.round(t))),l.forEach(g),n):r},nodes:function(e){return arguments.length?(t=e,m(),l.forEach(g),n):t},alpha:function(t){return arguments.length?(i=+t,n):i},alphaMin:function(t){return arguments.length?(o=+t,n):o},alphaDecay:function(t){return arguments.length?(a=+t,n):+a},alphaTarget:function(t){return arguments.length?(s=+t,n):s},velocityDecay:function(t){return arguments.length?(u=1-t,n):1-u},randomSource:function(t){return arguments.length?(p=t,l.forEach(g),n):p},force:function(t,e){return arguments.length>1?(null==e?l.delete(t):l.set(t,g(e)),n):l.get(t)},find:function(){var e,n,i,o,a,s,u=Array.prototype.slice.call(arguments),l=u.shift()||0,c=(r>1?u.shift():null)||0,h=(r>2?u.shift():null)||0,p=u.shift()||1/0,f=0,d=t.length;for(p*=p,f=0;f<d;++f)(o=(e=l-(a=t[f]).x)*e+(n=c-(a.y||0))*n+(i=h-(a.z||0))*i)<p&&(s=a,p=o);return s},on:function(t,e){return arguments.length>1?(h.on(t,e),n):h.on(t)}}}function Ll(t){return function(){return t}}function Il(t){return 1e-6*(t()-.5)}function kl(t){return t.index}function Ol(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Rl(t){var e,n,r,i,o,a,s,u=kl,l=function(t){return 1/Math.min(o[t.source.index],o[t.target.index])},c=Ll(30),h=1;function p(r){for(var o=0,u=t.length;o<h;++o)for(var l,c,p,f,d,m=0,g=0,y=0,v=0;m<u;++m)c=(l=t[m]).source,g=(p=l.target).x+p.vx-c.x-c.vx||Il(s),i>1&&(y=p.y+p.vy-c.y-c.vy||Il(s)),i>2&&(v=p.z+p.vz-c.z-c.vz||Il(s)),g*=f=((f=Math.sqrt(g*g+y*y+v*v))-n[m])/f*r*e[m],y*=f,v*=f,p.vx-=g*(d=a[m]),i>1&&(p.vy-=y*d),i>2&&(p.vz-=v*d),c.vx+=g*(d=1-d),i>1&&(c.vy+=y*d),i>2&&(c.vz+=v*d)}function f(){if(r){var i,s,l=r.length,c=t.length,h=new Map(r.map(((t,e)=>[u(t,e,r),t])));for(i=0,o=new Array(l);i<c;++i)(s=t[i]).index=i,"object"!=typeof s.source&&(s.source=Ol(h,s.source)),"object"!=typeof s.target&&(s.target=Ol(h,s.target)),o[s.source.index]=(o[s.source.index]||0)+1,o[s.target.index]=(o[s.target.index]||0)+1;for(i=0,a=new Array(c);i<c;++i)s=t[i],a[i]=o[s.source.index]/(o[s.source.index]+o[s.target.index]);e=new Array(c),d(),n=new Array(c),m()}}function d(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+l(t[n],n,t)}function m(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+c(t[e],e,t)}return null==t&&(t=[]),p.initialize=function(t,...e){r=t,s=e.find((t=>"function"==typeof t))||Math.random,i=e.find((t=>[1,2,3].includes(t)))||2,f()},p.links=function(e){return arguments.length?(t=e,f(),p):t},p.id=function(t){return arguments.length?(u=t,p):u},p.iterations=function(t){return arguments.length?(h=+t,p):h},p.strength=function(t){return arguments.length?(l="function"==typeof t?t:Ll(+t),d(),p):l},p.distance=function(t){return arguments.length?(c="function"==typeof t?t:Ll(+t),m(),p):c},p}function Dl(t,e,n){if(isNaN(e))return t;var r,i,o,a,s,u,l=t._root,c={data:n},h=t._x0,p=t._x1;if(!l)return t._root=c,t;for(;l.length;)if((a=e>=(i=(h+p)/2))?h=i:p=i,r=l,!(l=l[s=+a]))return r[s]=c,t;if(e===(o=+t._x.call(null,l.data)))return c.next=l,r?r[s]=c:t._root=c,t;do{r=r?r[s]=new Array(2):t._root=new Array(2),(a=e>=(i=(h+p)/2))?h=i:p=i}while((s=+a)==(u=+(o>=i)));return r[u]=l,r[s]=c,t}function Nl(t,e,n){this.node=t,this.x0=e,this.x1=n}function Fl(t){return t[0]}function zl(t,e){var n=new Bl(null==e?Fl:e,NaN,NaN);return null==t?n:n.addAll(t)}function Bl(t,e,n){this._x=t,this._x0=e,this._x1=n,this._root=void 0}function jl(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Ul=zl.prototype=Bl.prototype;function Zl(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o,a,s,u,l,c,h,p,f=t._root,d={data:r},m=t._x0,g=t._y0,y=t._x1,v=t._y1;if(!f)return t._root=d,t;for(;f.length;)if((l=e>=(o=(m+y)/2))?m=o:y=o,(c=n>=(a=(g+v)/2))?g=a:v=a,i=f,!(f=f[h=c<<1|l]))return i[h]=d,t;if(s=+t._x.call(null,f.data),u=+t._y.call(null,f.data),e===s&&n===u)return d.next=f,i?i[h]=d:t._root=d,t;do{i=i?i[h]=new Array(4):t._root=new Array(4),(l=e>=(o=(m+y)/2))?m=o:y=o,(c=n>=(a=(g+v)/2))?g=a:v=a}while((h=c<<1|l)==(p=(u>=a)<<1|s>=o));return i[p]=f,i[h]=d,t}function Vl(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function Gl(t){return t[0]}function Hl(t){return t[1]}function Wl(t,e,n){var r=new ql(null==e?Gl:e,null==n?Hl:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function ql(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function Xl(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}Ul.copy=function(){var t,e,n=new Bl(this._x,this._x0,this._x1),r=this._root;if(!r)return n;if(!r.length)return n._root=jl(r),n;for(t=[{source:r,target:n._root=new Array(2)}];r=t.pop();)for(var i=0;i<2;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(2)}):r.target[i]=jl(e));return n},Ul.add=function(t){var e=+this._x.call(null,t);return Dl(this.cover(e),e,t)},Ul.addAll=function(t){var e,n,r=t.length,i=new Array(r),o=1/0,a=-1/0;for(e=0;e<r;++e)isNaN(n=+this._x.call(null,t[e]))||(i[e]=n,n<o&&(o=n),n>a&&(a=n));if(o>a)return this;for(this.cover(o).cover(a),e=0;e<r;++e)Dl(this,i[e],t[e]);return this},Ul.cover=function(t){if(isNaN(t=+t))return this;var e=this._x0,n=this._x1;if(isNaN(e))n=(e=Math.floor(t))+1;else{for(var r,i,o=n-e||1,a=this._root;e>t||t>=n;)switch(i=+(t<e),(r=new Array(2))[i]=a,a=r,o*=2,i){case 0:n=e+o;break;case 1:e=n-o}this._root&&this._root.length&&(this._root=a)}return this._x0=e,this._x1=n,this},Ul.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Ul.extent=function(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},Ul.find=function(t,e){var n,r,i,o,a,s=this._x0,u=this._x1,l=[],c=this._root;for(c&&l.push(new Nl(c,s,u)),null==e?e=1/0:(s=t-e,u=t+e);o=l.pop();)if(!(!(c=o.node)||(r=o.x0)>u||(i=o.x1)<s))if(c.length){var h=(r+i)/2;l.push(new Nl(c[1],h,i),new Nl(c[0],r,h)),(a=+(t>=h))&&(o=l[l.length-1],l[l.length-1]=l[l.length-1-a],l[l.length-1-a]=o)}else{var p=Math.abs(t-+this._x.call(null,c.data));p<e&&(e=p,s=t-p,u=t+p,n=c.data)}return n},Ul.remove=function(t){if(isNaN(o=+this._x.call(null,t)))return this;var e,n,r,i,o,a,s,u,l,c=this._root,h=this._x0,p=this._x1;if(!c)return this;if(c.length)for(;;){if((s=o>=(a=(h+p)/2))?h=a:p=a,e=c,!(c=c[u=+s]))return this;if(!c.length)break;e[u+1&1]&&(n=e,l=u)}for(;c.data!==t;)if(r=c,!(c=c.next))return this;return(i=c.next)&&delete c.next,r?(i?r.next=i:delete r.next,this):e?(i?e[u]=i:delete e[u],(c=e[0]||e[1])&&c===(e[1]||e[0])&&!c.length&&(n?n[l]=c:this._root=c),this):(this._root=i,this)},Ul.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Ul.root=function(){return this._root},Ul.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Ul.visit=function(t){var e,n,r,i,o=[],a=this._root;for(a&&o.push(new Nl(a,this._x0,this._x1));e=o.pop();)if(!t(a=e.node,r=e.x0,i=e.x1)&&a.length){var s=(r+i)/2;(n=a[1])&&o.push(new Nl(n,s,i)),(n=a[0])&&o.push(new Nl(n,r,s))}return this},Ul.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Nl(this._root,this._x0,this._x1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.x1,u=(a+s)/2;(o=i[0])&&n.push(new Nl(o,a,u)),(o=i[1])&&n.push(new Nl(o,u,s))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.x1);return this},Ul.x=function(t){return arguments.length?(this._x=t,this):this._x};var Yl=Wl.prototype=ql.prototype;function Kl(t,e,n,r,i){if(isNaN(e)||isNaN(n)||isNaN(r))return t;var o,a,s,u,l,c,h,p,f,d,m,g,y=t._root,v={data:i},_=t._x0,x=t._y0,b=t._z0,w=t._x1,S=t._y1,E=t._z1;if(!y)return t._root=v,t;for(;y.length;)if((p=e>=(a=(_+w)/2))?_=a:w=a,(f=n>=(s=(x+S)/2))?x=s:S=s,(d=r>=(u=(b+E)/2))?b=u:E=u,o=y,!(y=y[m=d<<2|f<<1|p]))return o[m]=v,t;if(l=+t._x.call(null,y.data),c=+t._y.call(null,y.data),h=+t._z.call(null,y.data),e===l&&n===c&&r===h)return v.next=y,o?o[m]=v:t._root=v,t;do{o=o?o[m]=new Array(8):t._root=new Array(8),(p=e>=(a=(_+w)/2))?_=a:w=a,(f=n>=(s=(x+S)/2))?x=s:S=s,(d=r>=(u=(b+E)/2))?b=u:E=u}while((m=d<<2|f<<1|p)==(g=(h>=u)<<2|(c>=s)<<1|l>=a));return o[g]=y,o[m]=v,t}function Ql(t,e,n,r,i,o,a){this.node=t,this.x0=e,this.y0=n,this.z0=r,this.x1=i,this.y1=o,this.z1=a}function Jl(t){return t[0]}function $l(t){return t[1]}function tc(t){return t[2]}function ec(t,e,n,r){var i=new nc(null==e?Jl:e,null==n?$l:n,null==r?tc:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function nc(t,e,n,r,i,o,a,s,u){this._x=t,this._y=e,this._z=n,this._x0=r,this._y0=i,this._z0=o,this._x1=a,this._y1=s,this._z1=u,this._root=void 0}function rc(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}Yl.copy=function(){var t,e,n=new ql(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=Xl(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=Xl(e));return n},Yl.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Zl(this.cover(e,n),e,n,t)},Yl.addAll=function(t){var e,n,r,i,o=t.length,a=new Array(o),s=new Array(o),u=1/0,l=1/0,c=-1/0,h=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(a[n]=r,s[n]=i,r<u&&(u=r),r>c&&(c=r),i<l&&(l=i),i>h&&(h=i));if(u>c||l>h)return this;for(this.cover(u,l).cover(c,h),n=0;n<o;++n)Zl(this,a[n],s[n],t[n]);return this},Yl.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{for(var a,s,u=i-n||1,l=this._root;n>t||t>=i||r>e||e>=o;)switch(s=(e<r)<<1|t<n,(a=new Array(4))[s]=l,l=a,u*=2,s){case 0:i=n+u,o=r+u;break;case 1:n=i-u,o=r+u;break;case 2:i=n+u,r=o-u;break;case 3:n=i-u,r=o-u}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},Yl.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Yl.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Yl.find=function(t,e,n){var r,i,o,a,s,u,l,c=this._x0,h=this._y0,p=this._x1,f=this._y1,d=[],m=this._root;for(m&&d.push(new Vl(m,c,h,p,f)),null==n?n=1/0:(c=t-n,h=e-n,p=t+n,f=e+n,n*=n);u=d.pop();)if(!(!(m=u.node)||(i=u.x0)>p||(o=u.y0)>f||(a=u.x1)<c||(s=u.y1)<h))if(m.length){var g=(i+a)/2,y=(o+s)/2;d.push(new Vl(m[3],g,y,a,s),new Vl(m[2],i,y,g,s),new Vl(m[1],g,o,a,y),new Vl(m[0],i,o,g,y)),(l=(e>=y)<<1|t>=g)&&(u=d[d.length-1],d[d.length-1]=d[d.length-1-l],d[d.length-1-l]=u)}else{var v=t-+this._x.call(null,m.data),_=e-+this._y.call(null,m.data),x=v*v+_*_;if(x<n){var b=Math.sqrt(n=x);c=t-b,h=e-b,p=t+b,f=e+b,r=m.data}}return r},Yl.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,r,i,o,a,s,u,l,c,h,p,f=this._root,d=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!f)return this;if(f.length)for(;;){if((l=o>=(s=(d+g)/2))?d=s:g=s,(c=a>=(u=(m+y)/2))?m=u:y=u,e=f,!(f=f[h=c<<1|l]))return this;if(!f.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,p=h)}for(;f.data!==t;)if(r=f,!(f=f.next))return this;return(i=f.next)&&delete f.next,r?(i?r.next=i:delete r.next,this):e?(i?e[h]=i:delete e[h],(f=e[0]||e[1]||e[2]||e[3])&&f===(e[3]||e[2]||e[1]||e[0])&&!f.length&&(n?n[p]=f:this._root=f),this):(this._root=i,this)},Yl.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Yl.root=function(){return this._root},Yl.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Yl.visit=function(t){var e,n,r,i,o,a,s=[],u=this._root;for(u&&s.push(new Vl(u,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(u=e.node,r=e.x0,i=e.y0,o=e.x1,a=e.y1)&&u.length){var l=(r+o)/2,c=(i+a)/2;(n=u[3])&&s.push(new Vl(n,l,c,o,a)),(n=u[2])&&s.push(new Vl(n,r,c,l,a)),(n=u[1])&&s.push(new Vl(n,l,i,o,c)),(n=u[0])&&s.push(new Vl(n,r,i,l,c))}return this},Yl.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Vl(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,u=e.x1,l=e.y1,c=(a+u)/2,h=(s+l)/2;(o=i[0])&&n.push(new Vl(o,a,s,c,h)),(o=i[1])&&n.push(new Vl(o,c,s,u,h)),(o=i[2])&&n.push(new Vl(o,a,h,c,l)),(o=i[3])&&n.push(new Vl(o,c,h,u,l))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Yl.x=function(t){return arguments.length?(this._x=t,this):this._x},Yl.y=function(t){return arguments.length?(this._y=t,this):this._y};var ic=ec.prototype=nc.prototype;function oc(){var t,e,n,r,i,o,a=Ll(-30),s=1,u=1/0,l=.81;function c(r){var o,a=t.length,s=(1===e?zl(t,El):2===e?Wl(t,El,Cl):3===e?ec(t,El,Cl,Ml):null).visitAfter(p);for(i=r,o=0;o<a;++o)n=t[o],s.visit(f)}function h(){if(t){var e,n,r=t.length;for(o=new Array(r),e=0;e<r;++e)n=t[e],o[n.index]=+a(n,e,t)}}function p(t){var n,r,i,a,s,u,l=0,c=0,h=t.length;if(h){for(i=a=s=u=0;u<h;++u)(n=t[u])&&(r=Math.abs(n.value))&&(l+=n.value,c+=r,i+=r*(n.x||0),a+=r*(n.y||0),s+=r*(n.z||0));l*=Math.sqrt(4/h),t.x=i/c,e>1&&(t.y=a/c),e>2&&(t.z=s/c)}else{(n=t).x=n.data.x,e>1&&(n.y=n.data.y),e>2&&(n.z=n.data.z);do{l+=o[n.data.index]}while(n=n.next)}t.value=l}function f(t,a,c,h,p){if(!t.value)return!0;var f=[c,h,p][e-1],d=t.x-n.x,m=e>1?t.y-n.y:0,g=e>2?t.z-n.z:0,y=f-a,v=d*d+m*m+g*g;if(y*y/l<v)return v<u&&(0===d&&(v+=(d=Il(r))*d),e>1&&0===m&&(v+=(m=Il(r))*m),e>2&&0===g&&(v+=(g=Il(r))*g),v<s&&(v=Math.sqrt(s*v)),n.vx+=d*t.value*i/v,e>1&&(n.vy+=m*t.value*i/v),e>2&&(n.vz+=g*t.value*i/v)),!0;if(!(t.length||v>=u)){(t.data!==n||t.next)&&(0===d&&(v+=(d=Il(r))*d),e>1&&0===m&&(v+=(m=Il(r))*m),e>2&&0===g&&(v+=(g=Il(r))*g),v<s&&(v=Math.sqrt(s*v)));do{t.data!==n&&(y=o[t.data.index]*i/v,n.vx+=d*y,e>1&&(n.vy+=m*y),e>2&&(n.vz+=g*y))}while(t=t.next)}}return c.initialize=function(n,...i){t=n,r=i.find((t=>"function"==typeof t))||Math.random,e=i.find((t=>[1,2,3].includes(t)))||2,h()},c.strength=function(t){return arguments.length?(a="function"==typeof t?t:Ll(+t),h(),c):a},c.distanceMin=function(t){return arguments.length?(s=t*t,c):Math.sqrt(s)},c.distanceMax=function(t){return arguments.length?(u=t*t,c):Math.sqrt(u)},c.theta=function(t){return arguments.length?(l=t*t,c):Math.sqrt(l)},c}function ac(t,e,n){var r,i=1;function o(){var o,a,s=r.length,u=0,l=0,c=0;for(o=0;o<s;++o)u+=(a=r[o]).x||0,l+=a.y||0,c+=a.z||0;for(u=(u/s-t)*i,l=(l/s-e)*i,c=(c/s-n)*i,o=0;o<s;++o)a=r[o],u&&(a.x-=u),l&&(a.y-=l),c&&(a.z-=c)}return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),o.initialize=function(t){r=t},o.x=function(e){return arguments.length?(t=+e,o):t},o.y=function(t){return arguments.length?(e=+t,o):e},o.z=function(t){return arguments.length?(n=+t,o):n},o.strength=function(t){return arguments.length?(i=+t,o):i},o}ic.copy=function(){var t,e,n=new nc(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=rc(r),n;for(t=[{source:r,target:n._root=new Array(8)}];r=t.pop();)for(var i=0;i<8;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(8)}):r.target[i]=rc(e));return n},ic.add=function(t){var e=+this._x.call(null,t),n=+this._y.call(null,t),r=+this._z.call(null,t);return Kl(this.cover(e,n,r),e,n,r,t)},ic.addAll=function(t){var e,n,r,i,o,a=t.length,s=new Array(a),u=new Array(a),l=new Array(a),c=1/0,h=1/0,p=1/0,f=-1/0,d=-1/0,m=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||isNaN(o=+this._z.call(null,e))||(s[n]=r,u[n]=i,l[n]=o,r<c&&(c=r),r>f&&(f=r),i<h&&(h=i),i>d&&(d=i),o<p&&(p=o),o>m&&(m=o));if(c>f||h>d||p>m)return this;for(this.cover(c,h,p).cover(f,d,m),n=0;n<a;++n)Kl(this,s[n],u[n],l[n],t[n]);return this},ic.cover=function(t,e,n){if(isNaN(t=+t)||isNaN(e=+e)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,o=this._z0,a=this._x1,s=this._y1,u=this._z1;if(isNaN(r))a=(r=Math.floor(t))+1,s=(i=Math.floor(e))+1,u=(o=Math.floor(n))+1;else{for(var l,c,h=a-r||1,p=this._root;r>t||t>=a||i>e||e>=s||o>n||n>=u;)switch(c=(n<o)<<2|(e<i)<<1|t<r,(l=new Array(8))[c]=p,p=l,h*=2,c){case 0:a=r+h,s=i+h,u=o+h;break;case 1:r=a-h,s=i+h,u=o+h;break;case 2:a=r+h,i=s-h,u=o+h;break;case 3:r=a-h,i=s-h,u=o+h;break;case 4:a=r+h,s=i+h,o=u-h;break;case 5:r=a-h,s=i+h,o=u-h;break;case 6:a=r+h,i=s-h,o=u-h;break;case 7:r=a-h,i=s-h,o=u-h}this._root&&this._root.length&&(this._root=p)}return this._x0=r,this._y0=i,this._z0=o,this._x1=a,this._y1=s,this._z1=u,this},ic.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},ic.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},ic.find=function(t,e,n,r){var i,o,a,s,u,l,c,h,p,f=this._x0,d=this._y0,m=this._z0,g=this._x1,y=this._y1,v=this._z1,_=[],x=this._root;for(x&&_.push(new Ql(x,f,d,m,g,y,v)),null==r?r=1/0:(f=t-r,d=e-r,m=n-r,g=t+r,y=e+r,v=n+r,r*=r);h=_.pop();)if(!(!(x=h.node)||(o=h.x0)>g||(a=h.y0)>y||(s=h.z0)>v||(u=h.x1)<f||(l=h.y1)<d||(c=h.z1)<m))if(x.length){var b=(o+u)/2,w=(a+l)/2,S=(s+c)/2;_.push(new Ql(x[7],b,w,S,u,l,c),new Ql(x[6],o,w,S,b,l,c),new Ql(x[5],b,a,S,u,w,c),new Ql(x[4],o,a,S,b,w,c),new Ql(x[3],b,w,s,u,l,S),new Ql(x[2],o,w,s,b,l,S),new Ql(x[1],b,a,s,u,w,S),new Ql(x[0],o,a,s,b,w,S)),(p=(n>=S)<<2|(e>=w)<<1|t>=b)&&(h=_[_.length-1],_[_.length-1]=_[_.length-1-p],_[_.length-1-p]=h)}else{var E=t-+this._x.call(null,x.data),C=e-+this._y.call(null,x.data),M=n-+this._z.call(null,x.data),T=E*E+C*C+M*M;if(T<r){var A=Math.sqrt(r=T);f=t-A,d=e-A,m=n-A,g=t+A,y=e+A,v=n+A,i=x.data}}return i},ic.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t))||isNaN(s=+this._z.call(null,t)))return this;var e,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g=this._root,y=this._x0,v=this._y0,_=this._z0,x=this._x1,b=this._y1,w=this._z1;if(!g)return this;if(g.length)for(;;){if((h=o>=(u=(y+x)/2))?y=u:x=u,(p=a>=(l=(v+b)/2))?v=l:b=l,(f=s>=(c=(_+w)/2))?_=c:w=c,e=g,!(g=g[d=f<<2|p<<1|h]))return this;if(!g.length)break;(e[d+1&7]||e[d+2&7]||e[d+3&7]||e[d+4&7]||e[d+5&7]||e[d+6&7]||e[d+7&7])&&(n=e,m=d)}for(;g.data!==t;)if(r=g,!(g=g.next))return this;return(i=g.next)&&delete g.next,r?(i?r.next=i:delete r.next,this):e?(i?e[d]=i:delete e[d],(g=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&g===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!g.length&&(n?n[m]=g:this._root=g),this):(this._root=i,this)},ic.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},ic.root=function(){return this._root},ic.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},ic.visit=function(t){var e,n,r,i,o,a,s,u,l=[],c=this._root;for(c&&l.push(new Ql(c,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=l.pop();)if(!t(c=e.node,r=e.x0,i=e.y0,o=e.z0,a=e.x1,s=e.y1,u=e.z1)&&c.length){var h=(r+a)/2,p=(i+s)/2,f=(o+u)/2;(n=c[7])&&l.push(new Ql(n,h,p,f,a,s,u)),(n=c[6])&&l.push(new Ql(n,r,p,f,h,s,u)),(n=c[5])&&l.push(new Ql(n,h,i,f,a,p,u)),(n=c[4])&&l.push(new Ql(n,r,i,f,h,p,u)),(n=c[3])&&l.push(new Ql(n,h,p,o,a,s,f)),(n=c[2])&&l.push(new Ql(n,r,p,o,h,s,f)),(n=c[1])&&l.push(new Ql(n,h,i,o,a,p,f)),(n=c[0])&&l.push(new Ql(n,r,i,o,h,p,f))}return this},ic.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Ql(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,u=e.z0,l=e.x1,c=e.y1,h=e.z1,p=(a+l)/2,f=(s+c)/2,d=(u+h)/2;(o=i[0])&&n.push(new Ql(o,a,s,u,p,f,d)),(o=i[1])&&n.push(new Ql(o,p,s,u,l,f,d)),(o=i[2])&&n.push(new Ql(o,a,f,u,p,c,d)),(o=i[3])&&n.push(new Ql(o,p,f,u,l,c,d)),(o=i[4])&&n.push(new Ql(o,a,s,d,p,f,h)),(o=i[5])&&n.push(new Ql(o,p,s,d,l,f,h)),(o=i[6])&&n.push(new Ql(o,a,f,d,p,c,h)),(o=i[7])&&n.push(new Ql(o,p,f,d,l,c,h))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this},ic.x=function(t){return arguments.length?(this._x=t,this):this._x},ic.y=function(t){return arguments.length?(this._y=t,this):this._y},ic.z=function(t){return arguments.length?(this._z=t,this):this._z};var sc=s(7926),uc=s.n(sc),lc=s(201),cc=s.n(lc),hc=s(2050),pc=s.n(hc);function fc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dc(t,e,n){return e&&fc(t.prototype,e),n&&fc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function mc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return gc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gc(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var yc=dc((function t(e,n){var r=n.default,i=void 0===r?null:r,o=n.triggerUpdate,a=void 0===o||o,s=n.onChange,u=void 0===s?function(t,e){}:s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.defaultVal=i,this.triggerUpdate=a,this.onChange=u}));function vc(t){var e=t.stateInit,n=void 0===e?function(){return{}}:e,r=t.props,i=void 0===r?{}:r,o=t.methods,a=void 0===o?{}:o,s=t.aliases,u=void 0===s?{}:s,l=t.init,c=void 0===l?function(){}:l,h=t.update,p=void 0===h?function(){}:h,f=Object.keys(i).map((function(t){return new yc(t,i[t])}));return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},n instanceof Function?n(t):n,{initialised:!1}),r={};function i(e){return o(e,t),s(),i}var o=function(t,n){c.call(i,t,e,n),e.initialised=!0},s=pc()((function(){e.initialised&&(p.call(i,e,r),r={})}),1);return f.forEach((function(t){i[t.name]=function(t){var n=t.name,o=t.triggerUpdate,a=void 0!==o&&o,u=t.onChange,l=void 0===u?function(t,e){}:u,c=t.defaultVal,h=void 0===c?null:c;return function(t){var o=e[n];if(!arguments.length)return o;var u=void 0===t?h:t;return e[n]=u,l.call(i,u,e,o),!r.hasOwnProperty(n)&&(r[n]=o),a&&s(),i}}(t)})),Object.keys(a).forEach((function(t){i[t]=function(){for(var n,r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(n=a[t]).call.apply(n,[i,e].concat(o))}})),Object.entries(u).forEach((function(t){var e=mc(t,2),n=e[0],r=e[1];return i[n]=i[r]})),i.resetProps=function(){return f.forEach((function(t){i[t.name](t.defaultVal)})),i},i.resetProps(),e._rerender=s,i}}const _c=function(t){return t instanceof Function?t:"string"==typeof t?function(e){return e[t]}:function(e){return t}};function xc(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function bc(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function wc(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function Sc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(t,e)||Cc(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ec(t){return function(t){if(Array.isArray(t))return Mc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Cc(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cc(t,e){if(t){if("string"==typeof t)return Mc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mc(t,e):void 0}}function Mc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Tc(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var Ac=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=(e instanceof Array?e.length?e:[void 0]:[e]).map((function(t){return{keyAccessor:t,isProp:!(t instanceof Function)}})),o=t.reduce((function(t,e){var r=t,o=e;return i.forEach((function(t,e){var a,s=t.keyAccessor;if(t.isProp){var u=o,l=u[s],c=wc(u,[s].map(Tc));a=l,o=c}else a=s(o,e);e+1<i.length?(r.hasOwnProperty(a)||(r[a]={}),r=r[a]):n?(r.hasOwnProperty(a)||(r[a]=[]),r[a].push(o)):r[a]=o})),t}),{});n instanceof Function&&function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;r===i.length?Object.keys(e).forEach((function(t){return e[t]=n(e[t])})):Object.values(e).forEach((function(e){return t(e,r+1)}))}(o);var a=o;return r&&(a=[],function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];n.length===i.length?a.push({keys:n,vals:e}):Object.entries(e).forEach((function(e){var r=Sc(e,2),i=r[0],o=r[1];return t(o,[].concat(Ec(n),[i]))}))}(o),e instanceof Array&&0===e.length&&1===a.length&&(a[0].keys=[])),a};function Pc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Lc(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ic(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(t,e)||Oc(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kc(t){return function(t){if(Array.isArray(t))return Rc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Oc(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oc(t,e){if(t){if("string"==typeof t)return Rc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rc(t,e):void 0}}function Rc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Dc=["createObj","updateObj","exitObj","objBindAttr","dataBindAttr"];function Nc(t,e,n,r,i){var o=i.createObj,a=void 0===o?function(t){return{}}:o,s=i.updateObj,u=void 0===s?function(t,e){}:s,l=i.exitObj,c=void 0===l?function(t){}:l,h=i.objBindAttr,p=void 0===h?"__obj":h,f=i.dataBindAttr,d=void 0===f?"__data":f,m=function(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}(i,Dc),g=function(t,e,n){var r=n.objBindAttr,i=void 0===r?"__obj":r,o=n.dataBindAttr,a=void 0===o?"__data":o,s=n.idAccessor,u=n.purge,l=void 0!==u&&u,c=function(t){return t.hasOwnProperty(a)},h=e.filter((function(t){return!c(t)})),p=e.filter(c).map((function(t){return t[a]})),f=l?{enter:t,exit:p,update:[]}:function(t,e,n){var r={enter:[],update:[],exit:[]};if(n){var i=Ac(t,n,!1),o=Ac(e,n,!1),a=Object.assign({},i,o);Object.entries(a).forEach((function(t){var e=Ic(t,2),n=e[0],a=e[1],s=i.hasOwnProperty(n)?o.hasOwnProperty(n)?"update":"exit":"enter";r[s].push("update"===s?[i[n],o[n]]:a)}))}else{var s=new Set(t),u=new Set(e);new Set([].concat(kc(s),kc(u))).forEach((function(t){var e=s.has(t)?u.has(t)?"update":"exit":"enter";r[e].push("update"===e?[t,t]:t)}))}return r}(p,t,s);return f.update=f.update.map((function(t){var e=Ic(t,2),n=e[0],r=e[1];return n!==r&&(r[i]=n[i],r[i][a]=r),r})),f.exit=f.exit.concat(h.map((function(t){return Lc({},i,t)}))),f}(t,e,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Pc(Object(n),!0).forEach((function(e){Lc(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({objBindAttr:p,dataBindAttr:d},m)),y=g.enter,v=g.update;g.exit.forEach((function(t){var e=t[p];delete t[p],c(e),r(e)}));var _=function(t){var e=[];return t.forEach((function(t){var n=a(t);n&&(n[d]=t,t[p]=n,e.push(n))})),e}(y);!function(t){t.forEach((function(t){var e=t[p];e&&(e[d]=t,u(e,t))}))}([].concat(kc(y),kc(v))),_.forEach(n)}class Fc extends Map{constructor(t,e=Zc){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,n]of t)this.set(e,n)}get(t){return super.get(Bc(this,t))}has(t){return super.has(Bc(this,t))}set(t,e){return super.set(jc(this,t),e)}delete(t){return super.delete(Uc(this,t))}}class zc extends Set{constructor(t,e=Zc){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const e of t)this.add(e)}has(t){return super.has(Bc(this,t))}add(t){return super.add(jc(this,t))}delete(t){return super.delete(Uc(this,t))}}function Bc({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function jc({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function Uc({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function Zc(t){return null!==t&&"object"==typeof t?t.valueOf():t}function Vc(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}const Gc=Symbol("implicit"),Hc=function(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");var Wc=s(2086),qc=s.n(Wc);function Xc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Yc(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Xc(Object(n),!0).forEach((function(e){th(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Xc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Kc(t){return Kc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kc(t)}function Qc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $c(t,e,n){return e&&Jc(t.prototype,e),n&&Jc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function th(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function eh(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rh(t,e)}function nh(t){return nh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},nh(t)}function rh(t,e){return rh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rh(t,e)}function ih(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function oh(t,e,n){return oh=ih()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&rh(i,n.prototype),i},oh.apply(null,arguments)}function ah(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function sh(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uh(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return sh(t)}function lh(t){var e=ih();return function(){var n,r=nh(t);if(e){var i=nh(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return uh(this,n)}}function ch(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(t,e)||ph(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hh(t){return function(t){if(Array.isArray(t))return fh(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ph(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ph(t,e){if(t){if("string"==typeof t)return fh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fh(t,e):void 0}}function fh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var dh=function t(e){e instanceof Array?e.forEach(t):(e.map&&e.map.dispose(),e.dispose())},mh=function t(e){e.geometry&&e.geometry.dispose(),e.material&&dh(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(t)},gh=function(t){for(;t.children.length;){var e=t.children[0];t.remove(e),mh(e)}},yh=["objFilter"];function vh(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.objFilter,i=void 0===r?function(){return!0}:r,o=ah(n,yh);return Nc(t,e.children.filter(i),(function(t){return e.add(t)}),(function(t){e.remove(t),gh(t)}),Yc({objBindAttr:"__threeObj"},o))}var _h=function(t){return isNaN(t)?parseInt(qc()(t).toHex(),16):t},xh=function(t){return isNaN(t)?qc()(t).getAlpha():1},bh=function t(){var e=new Fc,n=[],r=[],i=Gc;function o(t){let o=e.get(t);if(void 0===o){if(i!==Gc)return i;e.set(t,o=n.push(t)-1)}return r[o%r.length]}return o.domain=function(t){if(!arguments.length)return n.slice();n=[],e=new Fc;for(const r of t)e.has(r)||e.set(r,n.push(r)-1);return o},o.range=function(t){return arguments.length?(r=Array.from(t),o):r.slice()},o.unknown=function(t){return arguments.length?(i=t,o):i},o.copy=function(){return t(n,r).unknown(i)},Vc.apply(o,arguments),o}(Hc);function wh(t,e,n){e&&"string"==typeof n&&t.filter((function(t){return!t[n]})).forEach((function(t){t[n]=bh(e(t))}))}var Sh=window.THREE?window.THREE:{Group:ho,Mesh:xn,MeshLambertMaterial:Ss,Color:ft,BufferGeometry:en,BufferAttribute:Ge,Matrix4:ne,Vector3:Ct,SphereGeometry:ds,CylinderGeometry:Da,TubeGeometry:ms,ConeGeometry:Na,Line:ia,LineBasicMaterial:Jo,QuadraticBezierCurve3:La,CubicBezierCurve3:Ta,Box3:At},Eh={graph:uc(),forcelayout:cc()},Ch=(new Sh.BufferGeometry).setAttribute?"setAttribute":"addAttribute",Mh=(new Sh.BufferGeometry).applyMatrix4?"applyMatrix4":"applyMatrix",Th=vc({props:{jsonUrl:{onChange:function(t,e){var n=this;t&&!e.fetchingJson&&(e.fetchingJson=!0,e.onLoading(),fetch(t).then((function(t){return t.json()})).then((function(t){e.fetchingJson=!1,e.onFinishLoading(t),n.graphData(t)})))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(t,e){e.engineRunning=!1}},numDimensions:{default:3,onChange:function(t,e){var n=e.d3ForceLayout.force("charge");function r(t,e){t.forEach((function(t){delete t[e],delete t["v".concat(e)]}))}n&&n.strength(t>2?-60:-30),t<3&&r(e.graphData.nodes,"z"),t<2&&r(e.graphData.nodes,"y")}},dagMode:{onChange:function(t,e){!t&&"d3"===e.forceEngine&&(e.graphData.nodes||[]).forEach((function(t){return t.fx=t.fy=t.fz=void 0}))}},dagLevelDistance:{},dagNodeFilter:{default:function(t){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.alphaDecay(t)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.alphaTarget(t)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.velocityDecay(t)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(t){return t._flushObjects=!0,t._rerender(),this},d3Force:function(t,e,n){return void 0===n?t.d3ForceLayout.force(e):(t.d3ForceLayout.force(e,n),this)},d3ReheatSimulation:function(t){return t.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(t){return t.cntTicks=0,t.startTickTime=new Date,t.engineRunning=!0,this},tickFrame:function(t){var e,n,r,i,o="ngraph"!==t.forceEngine;return t.engineRunning&&function(){++t.cntTicks>t.cooldownTicks||new Date-t.startTickTime>t.cooldownTime||o&&t.d3AlphaMin>0&&t.d3ForceLayout.alpha()<t.d3AlphaMin?(t.engineRunning=!1,t.onEngineStop()):(t.layout[o?"tick":"step"](),t.onEngineTick()),t.graphData.nodes.forEach((function(e){var n=e.__threeObj;if(n){var r=o?e:t.layout.getNodePosition(e[t.nodeId]);n.position.x=r.x,n.position.y=r.y||0,n.position.z=r.z||0}}));var e=_c(t.linkWidth),n=_c(t.linkCurvature),r=_c(t.linkCurveRotation),i=_c(t.linkThreeObjectExtend);t.graphData.links.forEach((function(a){var s=a.__lineObj;if(s){var u=o?a:t.layout.getLinkPosition(t.layout.graph.getLink(a.source,a.target).id),l=u[o?"source":"from"],c=u[o?"target":"to"];if(l&&c&&l.hasOwnProperty("x")&&c.hasOwnProperty("x")){!function(e){var i=o?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),a=i[o?"source":"from"],s=i[o?"target":"to"];if(a&&s&&a.hasOwnProperty("x")&&s.hasOwnProperty("x")){var u=n(e);if(u){var l,c=new Sh.Vector3(a.x,a.y||0,a.z||0),h=new Sh.Vector3(s.x,s.y||0,s.z||0),p=c.distanceTo(h),f=r(e);if(p>0){var d=s.x-a.x,m=s.y-a.y||0,g=(new Sh.Vector3).subVectors(h,c),y=g.clone().multiplyScalar(u).cross(0!==d||0!==m?new Sh.Vector3(0,0,1):new Sh.Vector3(0,1,0)).applyAxisAngle(g.normalize(),f).add((new Sh.Vector3).addVectors(c,h).divideScalar(2));l=new Sh.QuadraticBezierCurve3(c,y,h)}else{var v=70*u,_=-f,x=_+Math.PI/2;l=new Sh.CubicBezierCurve3(c,new Sh.Vector3(v*Math.cos(x),v*Math.sin(x),0).add(c),new Sh.Vector3(v*Math.cos(_),v*Math.sin(_),0).add(c),h)}e.__curve=l}else e.__curve=null}}(a);var h=i(a);if(!t.linkPositionUpdate||!t.linkPositionUpdate(h?s.children[1]:s,{start:{x:l.x,y:l.y,z:l.z},end:{x:c.x,y:c.y,z:c.z}},a)||h){var p=a.__curve,f=s.children.length?s.children[0]:s;if("Line"===f.type){if(p)f.geometry.setFromPoints(p.getPoints(30));else{var d=f.geometry.getAttribute("position");d&&d.array&&6===d.array.length||f.geometry[Ch]("position",d=new Sh.BufferAttribute(new Float32Array(6),3)),d.array[0]=l.x,d.array[1]=l.y||0,d.array[2]=l.z||0,d.array[3]=c.x,d.array[4]=c.y||0,d.array[5]=c.z||0,d.needsUpdate=!0}f.geometry.computeBoundingSphere()}else if("Mesh"===f.type)if(p){f.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(f.position.set(0,0,0),f.rotation.set(0,0,0),f.scale.set(1,1,1));var m=Math.ceil(10*e(a))/10/2,g=new Sh.TubeGeometry(p,30,m,t.linkResolution,!1);f.geometry.dispose(),f.geometry=g}else{if(!f.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var y=Math.ceil(10*e(a))/10/2,v=new Sh.CylinderGeometry(y,y,1,t.linkResolution,1,!1);v[Mh]((new Sh.Matrix4).makeTranslation(0,.5,0)),v[Mh]((new Sh.Matrix4).makeRotationX(Math.PI/2)),f.geometry.dispose(),f.geometry=v}var _=new Sh.Vector3(l.x,l.y||0,l.z||0),x=new Sh.Vector3(c.x,c.y||0,c.z||0),b=_.distanceTo(x);f.position.x=_.x,f.position.y=_.y,f.position.z=_.z,f.scale.z=b,f.parent.localToWorld(x),f.lookAt(x)}}}}}))}(),e=_c(t.linkDirectionalArrowRelPos),n=_c(t.linkDirectionalArrowLength),r=_c(t.nodeVal),t.graphData.links.forEach((function(i){var a=i.__arrowObj;if(a){var s=o?i:t.layout.getLinkPosition(t.layout.graph.getLink(i.source,i.target).id),u=s[o?"source":"from"],l=s[o?"target":"to"];if(u&&l&&u.hasOwnProperty("x")&&l.hasOwnProperty("x")){var c=Math.cbrt(Math.max(0,r(u)||1))*t.nodeRelSize,h=Math.cbrt(Math.max(0,r(l)||1))*t.nodeRelSize,p=n(i),f=e(i),d=i.__curve?function(t){return i.__curve.getPoint(t)}:function(t){var e=function(t,e,n,r){return e[t]+(n[t]-e[t])*r||0};return{x:e("x",u,l,t),y:e("y",u,l,t),z:e("z",u,l,t)}},m=i.__curve?i.__curve.getLength():Math.sqrt(["x","y","z"].map((function(t){return Math.pow((l[t]||0)-(u[t]||0),2)})).reduce((function(t,e){return t+e}),0)),g=c+p+(m-c-h-p)*f,y=d(g/m),v=d((g-p)/m);["x","y","z"].forEach((function(t){return a.position[t]=v[t]}));var _=oh(Sh.Vector3,hh(["x","y","z"].map((function(t){return y[t]}))));a.parent.localToWorld(_),a.lookAt(_)}}})),i=_c(t.linkDirectionalParticleSpeed),t.graphData.links.forEach((function(e){var n=e.__photonsObj&&e.__photonsObj.children,r=e.__singleHopPhotonsObj&&e.__singleHopPhotonsObj.children;if(r&&r.length||n&&n.length){var a=o?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),s=a[o?"source":"from"],u=a[o?"target":"to"];if(s&&u&&s.hasOwnProperty("x")&&u.hasOwnProperty("x")){var l=i(e),c=e.__curve?function(t){return e.__curve.getPoint(t)}:function(t){var e=function(t,e,n,r){return e[t]+(n[t]-e[t])*r||0};return{x:e("x",s,u,t),y:e("y",s,u,t),z:e("z",s,u,t)}};[].concat(hh(n||[]),hh(r||[])).forEach((function(t,e){var r="singleHopPhotons"===t.parent.__linkThreeObjType;if(t.hasOwnProperty("__progressRatio")||(t.__progressRatio=r?0:e/n.length),t.__progressRatio+=l,t.__progressRatio>=1){if(r)return t.parent.remove(t),void gh(t);t.__progressRatio=t.__progressRatio%1}var i=t.__progressRatio,o=c(i);["x","y","z"].forEach((function(e){return t.position[e]=o[e]}))}))}}})),this},emitParticle:function(t,e){if(e&&t.graphData.links.includes(e)){if(!e.__singleHopPhotonsObj){var n=new Sh.Group;n.__linkThreeObjType="singleHopPhotons",e.__singleHopPhotonsObj=n,t.graphScene.add(n)}var r=_c(t.linkDirectionalParticleWidth),i=Math.ceil(10*r(e))/10/2,o=t.linkDirectionalParticleResolution,a=new Sh.SphereGeometry(i,o,o),s=_c(t.linkColor),u=_c(t.linkDirectionalParticleColor)(e)||s(e)||"#f0f0f0",l=new Sh.Color(_h(u)),c=3*t.linkOpacity,h=new Sh.MeshLambertMaterial({color:l,transparent:!0,opacity:c});e.__singleHopPhotonsObj.add(new Sh.Mesh(a,h))}return this},getGraphBbox:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};if(!t.initialised)return null;var n=function t(n){var r=[];if(n.geometry){n.geometry.computeBoundingBox();var i=new Sh.Box3;i.copy(n.geometry.boundingBox).applyMatrix4(n.matrixWorld),r.push(i)}return r.concat.apply(r,hh((n.children||[]).filter((function(t){return!t.hasOwnProperty("__graphObjType")||"node"===t.__graphObjType&&e(t.__data)})).map(t)))}(t.graphScene);return n.length?Object.assign.apply(Object,hh(["x","y","z"].map((function(t){return th({},t,[xc(n,(function(e){return e.min[t]})),bc(n,(function(e){return e.max[t]}))])})))):null}},stateInit:function(){return{d3ForceLayout:Pl().force("link",Rl()).force("charge",oc()).force("center",ac()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(t,e){e.graphScene=t},update:function(t,e){var n=function(t){return t.some((function(t){return e.hasOwnProperty(t)}))};if(t.engineRunning=!1,t.onUpdate(),null!==t.nodeAutoColorBy&&n(["nodeAutoColorBy","graphData","nodeColor"])&&wh(t.graphData.nodes,_c(t.nodeAutoColorBy),t.nodeColor),null!==t.linkAutoColorBy&&n(["linkAutoColorBy","graphData","linkColor"])&&wh(t.graphData.links,_c(t.linkAutoColorBy),t.linkColor),t._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=_c(t.nodeThreeObject),i=_c(t.nodeThreeObjectExtend),o=_c(t.nodeVal),a=_c(t.nodeColor),s=_c(t.nodeVisibility),u={},l={};vh(t.graphData.nodes.filter(s),t.graphScene,{purge:t._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]),objFilter:function(t){return"node"===t.__graphObjType},createObj:function(e){var n,o=r(e),a=i(e);return o&&t.nodeThreeObject===o&&(o=o.clone()),o&&!a?n=o:((n=new Sh.Mesh).__graphDefaultObj=!0,o&&a&&n.add(o)),n.__graphObjType="node",n},updateObj:function(e,n){if(e.__graphDefaultObj){var r=o(n)||1,i=Math.cbrt(r)*t.nodeRelSize,s=t.nodeResolution;e.geometry.type.match(/^Sphere(Buffer)?Geometry$/)&&e.geometry.parameters.radius===i&&e.geometry.parameters.widthSegments===s||(u.hasOwnProperty(r)||(u[r]=new Sh.SphereGeometry(i,s,s)),e.geometry.dispose(),e.geometry=u[r]);var c=a(n),h=new Sh.Color(_h(c||"#ffffaa")),p=t.nodeOpacity*xh(c);"MeshLambertMaterial"===e.material.type&&e.material.color.equals(h)&&e.material.opacity===p||(l.hasOwnProperty(c)||(l[c]=new Sh.MeshLambertMaterial({color:h,transparent:!0,opacity:p})),e.material.dispose(),e.material=l[c])}}})}if(t._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var c=_c(t.linkThreeObject),h=_c(t.linkThreeObjectExtend),p=_c(t.linkMaterial),f=_c(t.linkVisibility),d=_c(t.linkColor),m=_c(t.linkWidth),g={},y={},v={},_=t.graphData.links.filter(f);if(vh(_,t.graphScene,{objBindAttr:"__lineObj",purge:t._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]),objFilter:function(t){return"link"===t.__graphObjType},exitObj:function(t){var e=t.__data&&t.__data.__singleHopPhotonsObj;e&&(e.parent.remove(e),gh(e),delete t.__data.__singleHopPhotonsObj)},createObj:function(e){var n,r,i=c(e),o=h(e);if(i&&t.linkThreeObject===i&&(i=i.clone()),!i||o)if(m(e))n=new Sh.Mesh;else{var a=new Sh.BufferGeometry;a[Ch]("position",new Sh.BufferAttribute(new Float32Array(6),3)),n=new Sh.Line(a)}return i?o?((r=new Sh.Group).__graphDefaultObj=!0,r.add(n),r.add(i)):r=i:(r=n).__graphDefaultObj=!0,r.renderOrder=10,r.__graphObjType="link",r},updateObj:function(e,n){if(e.__graphDefaultObj){var r=e.children.length?e.children[0]:e,i=Math.ceil(10*m(n))/10,o=!!i;if(o){var a=i/2,s=t.linkResolution;if(!r.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||r.geometry.parameters.radiusTop!==a||r.geometry.parameters.radialSegments!==s){if(!g.hasOwnProperty(i)){var u=new Sh.CylinderGeometry(a,a,1,s,1,!1);u[Mh]((new Sh.Matrix4).makeTranslation(0,.5,0)),u[Mh]((new Sh.Matrix4).makeRotationX(Math.PI/2)),g[i]=u}r.geometry.dispose(),r.geometry=g[i]}}var l=p(n);if(l)r.material=l;else{var c=d(n),h=new Sh.Color(_h(c||"#f0f0f0")),f=t.linkOpacity*xh(c),_=o?"MeshLambertMaterial":"LineBasicMaterial";if(r.material.type!==_||!r.material.color.equals(h)||r.material.opacity!==f){var x=o?y:v;x.hasOwnProperty(c)||(x[c]=new Sh[_]({color:h,transparent:f<1,opacity:f,depthWrite:f>=1})),r.material.dispose(),r.material=x[c]}}}}}),t.linkDirectionalArrowLength||e.hasOwnProperty("linkDirectionalArrowLength")){var x=_c(t.linkDirectionalArrowLength),b=_c(t.linkDirectionalArrowColor);vh(_.filter(x),t.graphScene,{objBindAttr:"__arrowObj",objFilter:function(t){return"arrow"===t.__linkThreeObjType},createObj:function(){var t=new Sh.Mesh(void 0,new Sh.MeshLambertMaterial({transparent:!0}));return t.__linkThreeObjType="arrow",t},updateObj:function(e,n){var r=x(n),i=t.linkDirectionalArrowResolution;if(!e.geometry.type.match(/^Cone(Buffer)?Geometry$/)||e.geometry.parameters.height!==r||e.geometry.parameters.radialSegments!==i){var o=new Sh.ConeGeometry(.25*r,r,i);o.translate(0,r/2,0),o.rotateX(Math.PI/2),e.geometry.dispose(),e.geometry=o}e.material.color=new Sh.Color(b(n)||d(n)||"#f0f0f0"),e.material.opacity=3*t.linkOpacity}})}if(t.linkDirectionalParticles||e.hasOwnProperty("linkDirectionalParticles")){var w=_c(t.linkDirectionalParticles),S=_c(t.linkDirectionalParticleWidth),E=_c(t.linkDirectionalParticleColor),C={},M={};vh(_.filter(w),t.graphScene,{objBindAttr:"__photonsObj",objFilter:function(t){return"photons"===t.__linkThreeObjType},createObj:function(){var t=new Sh.Group;return t.__linkThreeObjType="photons",t},updateObj:function(e,n){var r,i=Math.round(Math.abs(w(n))),o=!!e.children.length&&e.children[0],a=Math.ceil(10*S(n))/10/2,s=t.linkDirectionalParticleResolution;o&&o.geometry.parameters.radius===a&&o.geometry.parameters.widthSegments===s?r=o.geometry:(M.hasOwnProperty(a)||(M[a]=new Sh.SphereGeometry(a,s,s)),r=M[a],o&&o.geometry.dispose());var u,l=E(n)||d(n)||"#f0f0f0",c=new Sh.Color(_h(l)),h=3*t.linkOpacity;o&&o.material.color.equals(c)&&o.material.opacity===h?u=o.material:(C.hasOwnProperty(l)||(C[l]=new Sh.MeshLambertMaterial({color:c,transparent:!0,opacity:h})),u=C[l],o&&o.material.dispose()),vh(hh(new Array(i)).map((function(t,e){return{idx:e}})),e,{idAccessor:function(t){return t.idx},createObj:function(){return new Sh.Mesh(r,u)},updateObj:function(t){t.geometry=r,t.material=u}})}})}}if(t._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){t.engineRunning=!1,t.graphData.links.forEach((function(e){e.source=e[t.linkSource],e.target=e[t.linkTarget]}));var T,A="ngraph"!==t.forceEngine;if(A){(T=t.d3ForceLayout).stop().alpha(1).numDimensions(t.numDimensions).nodes(t.graphData.nodes);var P=t.d3ForceLayout.force("link");P&&P.id((function(e){return e[t.nodeId]})).links(t.graphData.links);var L=t.dagMode&&function(t,e){var n=t.nodes,r=t.links,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i.nodeFilter,a=void 0===o?function(){return!0}:o,s=i.onLoopError,u=void 0===s?function(t){throw"Invalid DAG structure! Found cycle in node path: ".concat(t.join(" -> "),".")}:s,l={};n.forEach((function(t){return l[e(t)]={data:t,out:[],depth:-1,skip:!a(t)}})),r.forEach((function(t){var n=t.source,r=t.target,i=u(n),o=u(r);if(!l.hasOwnProperty(i))throw"Missing source node with id: ".concat(i);if(!l.hasOwnProperty(o))throw"Missing target node with id: ".concat(o);var a=l[i],s=l[o];function u(t){return"object"===Kc(t)?e(t):t}a.out.push(s)}));var c=[];return h(Object.values(l)),Object.assign.apply(Object,[{}].concat(hh(Object.entries(l).filter((function(t){return!ch(t,2)[1].skip})).map((function(t){var e=ch(t,2);return th({},e[0],e[1].depth)})))));function h(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=0,o=t.length;i<o;i++){var a=t[i];if(-1!==n.indexOf(a)){var s=function(){var t=[].concat(hh(n.slice(n.indexOf(a))),[a]).map((function(t){return e(t.data)}));return c.some((function(e){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}))||(c.push(t),u(t)),"continue"}();if("continue"===s)continue}r>a.depth&&(a.depth=r,h(a.out,[].concat(hh(n),[a]),r+(a.skip?0:1)))}}}(t.graphData,(function(e){return e[t.nodeId]}),{nodeFilter:t.dagNodeFilter,onLoopError:t.onDagError||void 0}),I=Math.max.apply(Math,hh(Object.values(L||[]))),k=t.dagLevelDistance||t.graphData.nodes.length/(I||1)*2*(-1!==["radialin","radialout"].indexOf(t.dagMode)?.7:1);if(t.dagMode){var O=function(e,n){return function(r){return e?(L[r[t.nodeId]]-I/2)*k*(n?-1:1):void 0}},R=O(-1!==["lr","rl"].indexOf(t.dagMode),"rl"===t.dagMode),D=O(-1!==["td","bu"].indexOf(t.dagMode),"td"===t.dagMode),N=O(-1!==["zin","zout"].indexOf(t.dagMode),"zout"===t.dagMode);t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(t){t.fx=R(t),t.fy=D(t),t.fz=N(t)}))}t.d3ForceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(t.dagMode)?function(t,e,n,r){var i,o,a,s,u=Ll(.1);function l(t){for(var u=0,l=i.length;u<l;++u){var c=i[u],h=c.x-e||1e-6,p=(c.y||0)-n||1e-6,f=(c.z||0)-r||1e-6,d=Math.sqrt(h*h+p*p+f*f),m=(s[u]-d)*a[u]*t/d;c.vx+=h*m,o>1&&(c.vy+=p*m),o>2&&(c.vz+=f*m)}}function c(){if(i){var e,n=i.length;for(a=new Array(n),s=new Array(n),e=0;e<n;++e)s[e]=+t(i[e],e,i),a[e]=isNaN(s[e])?0:+u(i[e],e,i)}}return"function"!=typeof t&&(t=Ll(+t)),null==e&&(e=0),null==n&&(n=0),null==r&&(r=0),l.initialize=function(t,...e){i=t,o=e.find((t=>[1,2,3].includes(t)))||2,c()},l.strength=function(t){return arguments.length?(u="function"==typeof t?t:Ll(+t),c(),l):u},l.radius=function(e){return arguments.length?(t="function"==typeof e?e:Ll(+e),c(),l):t},l.x=function(t){return arguments.length?(e=+t,l):e},l.y=function(t){return arguments.length?(n=+t,l):n},l.z=function(t){return arguments.length?(r=+t,l):r},l}((function(e){var n=L[e[t.nodeId]]||-1;return("radialin"===t.dagMode?I-n:n)*k})).strength((function(e){return t.dagNodeFilter(e)?1:0})):null)}else{var F=Eh.graph();t.graphData.nodes.forEach((function(e){F.addNode(e[t.nodeId])})),t.graphData.links.forEach((function(t){F.addLink(t.source,t.target)})),(T=Eh.forcelayout(F,Yc({dimensions:t.numDimensions},t.ngraphPhysics))).graph=F}for(var z=0;z<t.warmupTicks&&!(A&&t.d3AlphaMin>0&&t.d3ForceLayout.alpha()<t.d3AlphaMin);z++)T[A?"tick":"step"]();t.layout=T,this.resetCountdown()}t.engineRunning=!0,t.onFinishUpdate()}}),Ah=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=function(e){eh(i,e);var r=lh(i);function i(){var e;Qc(this,i);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return(e=r.call.apply(r,[this].concat(a))).__kapsuleInstance=t().apply(void 0,[].concat(hh(n?[sh(e)]:[]),a)),e}return $c(i)}(e);return Object.keys(t()).forEach((function(t){return r.prototype[t]=function(){var e,n=(e=this.__kapsuleInstance)[t].apply(e,arguments);return n===this.__kapsuleInstance?this:n}})),r}(Th,(window.THREE?window.THREE:{Group:ho}).Group,!0);const Ph={type:"change"},Lh={type:"start"},Ih={type:"end"};class kh extends G{constructor(t,e){super(),void 0===e&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');const n=this,i=-1;this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:r.ROTATE,MIDDLE:r.DOLLY,RIGHT:r.PAN},this.target=new Ct;const o=1e-6,a=new Ct;let s=1,u=i,l=i,c=0,h=0,p=0;const f=new Ct,d=new $,m=new $,g=new Ct,y=new $,v=new $,_=new $,x=new $,b=[],w={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const t=n.domElement.getBoundingClientRect(),e=n.domElement.ownerDocument.documentElement;n.screen.left=t.left+window.pageXOffset-e.clientLeft,n.screen.top=t.top+window.pageYOffset-e.clientTop,n.screen.width=t.width,n.screen.height=t.height};const S=function(){const t=new $;return function(e,r){return t.set((e-n.screen.left)/n.screen.width,(r-n.screen.top)/n.screen.height),t}}(),E=function(){const t=new $;return function(e,r){return t.set((e-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(n.screen.height+2*(n.screen.top-r))/n.screen.width),t}}();function C(t){!1!==n.enabled&&(0===b.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",M),n.domElement.addEventListener("pointerup",T)),function(t){b.push(t)}(t),"touch"===t.pointerType?function(t){if(1===(R(t),b.length))u=3,m.copy(E(b[0].pageX,b[0].pageY)),d.copy(m);else{u=4;const t=b[0].pageX-b[1].pageX,e=b[0].pageY-b[1].pageY;h=c=Math.sqrt(t*t+e*e);const n=(b[0].pageX+b[1].pageX)/2,r=(b[0].pageY+b[1].pageY)/2;_.copy(S(n,r)),x.copy(_)}n.dispatchEvent(Lh)}(t):function(t){if(u===i)switch(t.button){case n.mouseButtons.LEFT:u=0;break;case n.mouseButtons.MIDDLE:u=1;break;case n.mouseButtons.RIGHT:u=2}const e=l!==i?l:u;0!==e||n.noRotate?1!==e||n.noZoom?2!==e||n.noPan||(_.copy(S(t.pageX,t.pageY)),x.copy(_)):(y.copy(S(t.pageX,t.pageY)),v.copy(y)):(m.copy(E(t.pageX,t.pageY)),d.copy(m)),n.dispatchEvent(Lh)}(t))}function M(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){if(1===(R(t),b.length))d.copy(m),m.copy(E(t.pageX,t.pageY));else{const e=function(t){const e=t.pointerId===b[0].pointerId?b[1]:b[0];return w[e.pointerId]}(t),n=t.pageX-e.x,r=t.pageY-e.y;h=Math.sqrt(n*n+r*r);const i=(t.pageX+e.x)/2,o=(t.pageY+e.y)/2;x.copy(S(i,o))}}(t):function(t){const e=l!==i?l:u;0!==e||n.noRotate?1!==e||n.noZoom?2!==e||n.noPan||x.copy(S(t.pageX,t.pageY)):v.copy(S(t.pageX,t.pageY)):(d.copy(m),m.copy(E(t.pageX,t.pageY)))}(t))}function T(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch(b.length){case 0:u=i;break;case 1:u=3,m.copy(E(t.pageX,t.pageY)),d.copy(m);break;case 2:u=4,m.copy(E(t.pageX-d.x,t.pageY-d.y)),d.copy(m)}n.dispatchEvent(Ih)}(t):(u=i,n.dispatchEvent(Ih)),O(t),0===b.length&&(n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",M),n.domElement.removeEventListener("pointerup",T)))}function A(t){O(t)}function P(t){!1!==n.enabled&&(window.removeEventListener("keydown",P),l===i&&(t.code!==n.keys[0]||n.noRotate?t.code!==n.keys[1]||n.noZoom?t.code!==n.keys[2]||n.noPan||(l=2):l=1:l=0))}function L(){!1!==n.enabled&&(l=i,window.addEventListener("keydown",P))}function I(t){if(!1!==n.enabled&&!0!==n.noZoom){switch(t.preventDefault(),t.deltaMode){case 2:y.y-=.025*t.deltaY;break;case 1:y.y-=.01*t.deltaY;break;default:y.y-=25e-5*t.deltaY}n.dispatchEvent(Lh),n.dispatchEvent(Ih)}}function k(t){!1!==n.enabled&&t.preventDefault()}function O(t){delete w[t.pointerId];for(let e=0;e<b.length;e++)if(b[e].pointerId==t.pointerId)return void b.splice(e,1)}function R(t){let e=w[t.pointerId];void 0===e&&(e=new $,w[t.pointerId]=e),e.set(t.pageX,t.pageY)}this.rotateCamera=function(){const t=new Ct,e=new Et,r=new Ct,i=new Ct,o=new Ct,a=new Ct;return function(){a.set(m.x-d.x,m.y-d.y,0);let s=a.length();s?(f.copy(n.object.position).sub(n.target),r.copy(f).normalize(),i.copy(n.object.up).normalize(),o.crossVectors(i,r).normalize(),i.setLength(m.y-d.y),o.setLength(m.x-d.x),a.copy(i.add(o)),t.crossVectors(a,f).normalize(),s*=n.rotateSpeed,e.setFromAxisAngle(t,s),f.applyQuaternion(e),n.object.up.applyQuaternion(e),g.copy(t),p=s):!n.staticMoving&&p&&(p*=Math.sqrt(1-n.dynamicDampingFactor),f.copy(n.object.position).sub(n.target),e.setFromAxisAngle(g,p),f.applyQuaternion(e),n.object.up.applyQuaternion(e)),d.copy(m)}}(),this.zoomCamera=function(){let t;4===u?(t=c/h,c=h,n.object.isPerspectiveCamera?f.multiplyScalar(t):n.object.isOrthographicCamera?(n.object.zoom/=t,n.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(t=1+(v.y-y.y)*n.zoomSpeed,1!==t&&t>0&&(n.object.isPerspectiveCamera?f.multiplyScalar(t):n.object.isOrthographicCamera?(n.object.zoom/=t,n.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),n.staticMoving?y.copy(v):y.y+=(v.y-y.y)*this.dynamicDampingFactor)},this.panCamera=function(){const t=new $,e=new Ct,r=new Ct;return function(){if(t.copy(x).sub(_),t.lengthSq()){if(n.object.isOrthographicCamera){const e=(n.object.right-n.object.left)/n.object.zoom/n.domElement.clientWidth,r=(n.object.top-n.object.bottom)/n.object.zoom/n.domElement.clientWidth;t.x*=e,t.y*=r}t.multiplyScalar(f.length()*n.panSpeed),r.copy(f).cross(n.object.up).setLength(t.x),r.add(e.copy(n.object.up).setLength(t.y)),n.object.position.add(r),n.target.add(r),n.staticMoving?_.copy(x):_.add(t.subVectors(x,_).multiplyScalar(n.dynamicDampingFactor))}}}(),this.checkDistances=function(){n.noZoom&&n.noPan||(f.lengthSq()>n.maxDistance*n.maxDistance&&(n.object.position.addVectors(n.target,f.setLength(n.maxDistance)),y.copy(v)),f.lengthSq()<n.minDistance*n.minDistance&&(n.object.position.addVectors(n.target,f.setLength(n.minDistance)),y.copy(v)))},this.update=function(){f.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,f),n.object.isPerspectiveCamera?(n.checkDistances(),n.object.lookAt(n.target),a.distanceToSquared(n.object.position)>o&&(n.dispatchEvent(Ph),a.copy(n.object.position))):n.object.isOrthographicCamera?(n.object.lookAt(n.target),(a.distanceToSquared(n.object.position)>o||s!==n.object.zoom)&&(n.dispatchEvent(Ph),a.copy(n.object.position),s=n.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){u=i,l=i,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),f.subVectors(n.object.position,n.target),n.object.lookAt(n.target),n.dispatchEvent(Ph),a.copy(n.object.position),s=n.object.zoom},this.dispose=function(){n.domElement.removeEventListener("contextmenu",k),n.domElement.removeEventListener("pointerdown",C),n.domElement.removeEventListener("pointercancel",A),n.domElement.removeEventListener("wheel",I),n.domElement.removeEventListener("pointermove",M),n.domElement.removeEventListener("pointerup",T),window.removeEventListener("keydown",P),window.removeEventListener("keyup",L)},this.domElement.addEventListener("contextmenu",k),this.domElement.addEventListener("pointerdown",C),this.domElement.addEventListener("pointercancel",A),this.domElement.addEventListener("wheel",I,{passive:!1}),window.addEventListener("keydown",P),window.addEventListener("keyup",L),this.handleResize(),this.update()}}const Oh={type:"change"},Rh={type:"start"},Dh={type:"end"};class Nh extends G{constructor(t,e){super(),void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Ct,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:r.ROTATE,MIDDLE:r.DOLLY,RIGHT:r.PAN},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return s.phi},this.getAzimuthalAngle=function(){return s.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",G),this._domElementKeyEvents=t},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Oh),n.update(),o=i.NONE},this.update=function(){const e=new Ct,r=(new Et).setFromUnitVectors(t.up,new Ct(0,1,0)),p=r.clone().invert(),f=new Ct,d=new Et,m=2*Math.PI;return function(){const t=n.object.position;e.copy(t).sub(n.target),e.applyQuaternion(r),s.setFromVector3(e),n.autoRotate&&o===i.NONE&&E(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(s.theta+=u.theta*n.dampingFactor,s.phi+=u.phi*n.dampingFactor):(s.theta+=u.theta,s.phi+=u.phi);let g=n.minAzimuthAngle,y=n.maxAzimuthAngle;return isFinite(g)&&isFinite(y)&&(g<-Math.PI?g+=m:g>Math.PI&&(g-=m),y<-Math.PI?y+=m:y>Math.PI&&(y-=m),s.theta=g<=y?Math.max(g,Math.min(y,s.theta)):s.theta>(g+y)/2?Math.max(g,s.theta):Math.min(y,s.theta)),s.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,s.phi)),s.makeSafe(),s.radius*=l,s.radius=Math.max(n.minDistance,Math.min(n.maxDistance,s.radius)),!0===n.enableDamping?n.target.addScaledVector(c,n.dampingFactor):n.target.add(c),e.setFromSpherical(s),e.applyQuaternion(p),t.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,c.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),c.set(0,0,0)),l=1,!!(h||f.distanceToSquared(n.object.position)>a||8*(1-d.dot(n.object.quaternion))>a)&&(n.dispatchEvent(Oh),f.copy(n.object.position),d.copy(n.object.quaternion),h=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",H),n.domElement.removeEventListener("pointerdown",B),n.domElement.removeEventListener("pointercancel",Z),n.domElement.removeEventListener("wheel",V),n.domElement.removeEventListener("pointermove",j),n.domElement.removeEventListener("pointerup",U),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",G)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=i.NONE;const a=1e-6,s=new ku,u=new ku;let l=1;const c=new Ct;let h=!1;const p=new $,f=new $,d=new $,m=new $,g=new $,y=new $,v=new $,_=new $,x=new $,b=[],w={};function S(){return Math.pow(.95,n.zoomSpeed)}function E(t){u.theta-=t}function C(t){u.phi-=t}const M=function(){const t=new Ct;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),c.add(t)}}(),T=function(){const t=new Ct;return function(e,r){!0===n.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),c.add(t)}}(),A=function(){const t=new Ct;return function(e,r){const i=n.domElement;if(n.object.isPerspectiveCamera){const o=n.object.position;t.copy(o).sub(n.target);let a=t.length();a*=Math.tan(n.object.fov/2*Math.PI/180),M(2*e*a/i.clientHeight,n.object.matrix),T(2*r*a/i.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(M(e*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),T(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function P(t){n.object.isPerspectiveCamera?l/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(t){n.object.isPerspectiveCamera?l*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(t){p.set(t.clientX,t.clientY)}function k(t){m.set(t.clientX,t.clientY)}function O(){if(1===b.length)p.set(b[0].pageX,b[0].pageY);else{const t=.5*(b[0].pageX+b[1].pageX),e=.5*(b[0].pageY+b[1].pageY);p.set(t,e)}}function R(){if(1===b.length)m.set(b[0].pageX,b[0].pageY);else{const t=.5*(b[0].pageX+b[1].pageX),e=.5*(b[0].pageY+b[1].pageY);m.set(t,e)}}function D(){const t=b[0].pageX-b[1].pageX,e=b[0].pageY-b[1].pageY,n=Math.sqrt(t*t+e*e);v.set(0,n)}function N(t){if(1==b.length)f.set(t.pageX,t.pageY);else{const e=X(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);f.set(n,r)}d.subVectors(f,p).multiplyScalar(n.rotateSpeed);const e=n.domElement;E(2*Math.PI*d.x/e.clientHeight),C(2*Math.PI*d.y/e.clientHeight),p.copy(f)}function F(t){if(1===b.length)g.set(t.pageX,t.pageY);else{const e=X(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);g.set(n,r)}y.subVectors(g,m).multiplyScalar(n.panSpeed),A(y.x,y.y),m.copy(g)}function z(t){const e=X(t),r=t.pageX-e.x,i=t.pageY-e.y,o=Math.sqrt(r*r+i*i);_.set(0,o),x.set(0,Math.pow(_.y/v.y,n.zoomSpeed)),P(x.y),v.copy(_)}function B(t){!1!==n.enabled&&(0===b.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",j),n.domElement.addEventListener("pointerup",U)),function(t){b.push(t)}(t),"touch"===t.pointerType?function(t){switch(q(t),b.length){case 1:switch(n.touches.ONE){case 0:if(!1===n.enableRotate)return;O(),o=i.TOUCH_ROTATE;break;case 1:if(!1===n.enablePan)return;R(),o=i.TOUCH_PAN;break;default:o=i.NONE}break;case 2:switch(n.touches.TWO){case 2:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&D(),n.enablePan&&R(),o=i.TOUCH_DOLLY_PAN;break;case 3:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&D(),n.enableRotate&&O(),o=i.TOUCH_DOLLY_ROTATE;break;default:o=i.NONE}break;default:o=i.NONE}o!==i.NONE&&n.dispatchEvent(Rh)}(t):function(t){let e;switch(t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case r.DOLLY:if(!1===n.enableZoom)return;!function(t){v.set(t.clientX,t.clientY)}(t),o=i.DOLLY;break;case r.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;k(t),o=i.PAN}else{if(!1===n.enableRotate)return;I(t),o=i.ROTATE}break;case r.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;I(t),o=i.ROTATE}else{if(!1===n.enablePan)return;k(t),o=i.PAN}break;default:o=i.NONE}o!==i.NONE&&n.dispatchEvent(Rh)}(t))}function j(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch(q(t),o){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;N(t),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;F(t),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&z(t),n.enablePan&&F(t)}(t),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&z(t),n.enableRotate&&N(t)}(t),n.update();break;default:o=i.NONE}}(t):function(t){if(!1!==n.enabled)switch(o){case i.ROTATE:if(!1===n.enableRotate)return;!function(t){f.set(t.clientX,t.clientY),d.subVectors(f,p).multiplyScalar(n.rotateSpeed);const e=n.domElement;E(2*Math.PI*d.x/e.clientHeight),C(2*Math.PI*d.y/e.clientHeight),p.copy(f),n.update()}(t);break;case i.DOLLY:if(!1===n.enableZoom)return;!function(t){_.set(t.clientX,t.clientY),x.subVectors(_,v),x.y>0?P(S()):x.y<0&&L(S()),v.copy(_),n.update()}(t);break;case i.PAN:if(!1===n.enablePan)return;!function(t){g.set(t.clientX,t.clientY),y.subVectors(g,m).multiplyScalar(n.panSpeed),A(y.x,y.y),m.copy(g),n.update()}(t)}}(t))}function U(t){W(t),0===b.length&&(n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",j),n.domElement.removeEventListener("pointerup",U)),n.dispatchEvent(Dh),o=i.NONE}function Z(t){W(t)}function V(t){!1!==n.enabled&&!1!==n.enableZoom&&o===i.NONE&&(t.preventDefault(),n.dispatchEvent(Rh),function(t){t.deltaY<0?L(S()):t.deltaY>0&&P(S()),n.update()}(t),n.dispatchEvent(Dh))}function G(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){let e=!1;switch(t.code){case n.keys.UP:A(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:A(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:A(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:A(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function H(t){!1!==n.enabled&&t.preventDefault()}function W(t){delete w[t.pointerId];for(let e=0;e<b.length;e++)if(b[e].pointerId==t.pointerId)return void b.splice(e,1)}function q(t){let e=w[t.pointerId];void 0===e&&(e=new $,w[t.pointerId]=e),e.set(t.pageX,t.pageY)}function X(t){const e=t.pointerId===b[0].pointerId?b[1]:b[0];return w[e.pointerId]}n.domElement.addEventListener("contextmenu",H),n.domElement.addEventListener("pointerdown",B),n.domElement.addEventListener("pointercancel",Z),n.domElement.addEventListener("wheel",V,{passive:!1}),this.update()}}const Fh={type:"change"};class zh extends G{constructor(t,e){super(),void 0===e&&(console.warn('THREE.FlyControls: The second parameter "domElement" is now mandatory.'),e=document),this.object=t,this.domElement=e,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const n=this,r=1e-6,i=new Et,o=new Ct;this.tmpQuaternion=new Et,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new Ct(0,0,0),this.rotationVector=new Ct(0,0,0),this.keydown=function(t){if(!t.altKey){switch(t.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(t){switch(t.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(t){if(this.dragToLook)this.mouseStatus++;else{switch(t.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},this.mousemove=function(t){if(!this.dragToLook||this.mouseStatus>0){const e=this.getContainerDimensions(),n=e.size[0]/2,r=e.size[1]/2;this.moveState.yawLeft=-(t.pageX-e.offset[0]-n)/n,this.moveState.pitchDown=(t.pageY-e.offset[1]-r)/r,this.updateRotationVector()}},this.mouseup=function(t){if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(t.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},this.update=function(t){const e=t*n.movementSpeed,a=t*n.rollSpeed;n.object.translateX(n.moveVector.x*e),n.object.translateY(n.moveVector.y*e),n.object.translateZ(n.moveVector.z*e),n.tmpQuaternion.set(n.rotationVector.x*a,n.rotationVector.y*a,n.rotationVector.z*a,1).normalize(),n.object.quaternion.multiply(n.tmpQuaternion),(o.distanceToSquared(n.object.position)>r||8*(1-i.dot(n.object.quaternion))>r)&&(n.dispatchEvent(Fh),i.copy(n.object.quaternion),o.copy(n.object.position))},this.updateMovementVector=function(){const t=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-t+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",Bh),this.domElement.removeEventListener("mousedown",s),this.domElement.removeEventListener("mousemove",a),this.domElement.removeEventListener("mouseup",u),window.removeEventListener("keydown",l),window.removeEventListener("keyup",c)};const a=this.mousemove.bind(this),s=this.mousedown.bind(this),u=this.mouseup.bind(this),l=this.keydown.bind(this),c=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",Bh),this.domElement.addEventListener("mousemove",a),this.domElement.addEventListener("mousedown",s),this.domElement.addEventListener("mouseup",u),window.addEventListener("keydown",l),window.addEventListener("keyup",c),this.updateMovementVector(),this.updateRotationVector()}}function Bh(t){t.preventDefault()}const jh={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class Uh{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const Zh=new Jn(-1,1,1,-1,0,1),Vh=new en;Vh.setAttribute("position",new qe([-1,3,0,-1,-1,0,3,-1,0],3)),Vh.setAttribute("uv",new qe([0,2,0,0,2,0],2));class Gh{constructor(t){this._mesh=new xn(Vh,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,Zh)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class Hh extends Uh{constructor(t,e){super(),this.textureID=void 0!==e?e:"tDiffuse",t instanceof Mn?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=Cn.clone(t.uniforms),this.material=new Mn({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new Gh(this.material)}render(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class Wh extends Uh{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,n){const r=t.getContext(),i=t.state;let o,a;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class qh extends Uh{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class Xh{constructor(t,e){if(this.renderer=t,void 0===e){const n=t.getSize(new $);this._pixelRatio=t.getPixelRatio(),this._width=n.width,this._height=n.height,(e=new bt(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===jh&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===Hh&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Hh(jh),this.clock=new du}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let n=!1;for(let e=0,r=this.passes.length;e<r;e++){const r=this.passes[e];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),r.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),r.needsSwap){if(n){const e=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),n.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Wh&&(r instanceof Wh?n=!0:r instanceof qh&&(n=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new $);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(n,r)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}new Jn(-1,1,1,-1,0,1);const Yh=new en;Yh.setAttribute("position",new qe([-1,3,0,-1,-1,0,3,-1,0],3)),Yh.setAttribute("uv",new qe([0,2,0,0,2,0],2));class Kh extends Uh{constructor(t,e,n,r,i){super(),this.scene=t,this.camera=e,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new ft}render(t,e,n){const r=t.autoClear;let i,o;t.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),i=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=r}}function Qh(){return Qh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Qh.apply(this,arguments)}var Jh=s(3058),$h=s(4625),tp=function(t){var e,n;function r(e){var n;return n=t.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+e+" for more information.")||this,(0,Jh.Z)(n)}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,(0,$h.Z)(e,n),r}((0,s(1392).Z)(Error));function ep(t){return Math.round(255*t)}function np(t,e,n){return ep(t)+","+ep(e)+","+ep(n)}function rp(t,e,n,r){if(void 0===r&&(r=np),0===e)return r(n,n,n);var i=(t%360+360)%360/60,o=(1-Math.abs(2*n-1))*e,a=o*(1-Math.abs(i%2-1)),s=0,u=0,l=0;i>=0&&i<1?(s=o,u=a):i>=1&&i<2?(s=a,u=o):i>=2&&i<3?(u=o,l=a):i>=3&&i<4?(u=a,l=o):i>=4&&i<5?(s=a,l=o):i>=5&&i<6&&(s=o,l=a);var c=n-o/2;return r(s+c,u+c,l+c)}var ip={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},op=/^#[a-fA-F0-9]{6}$/,ap=/^#[a-fA-F0-9]{8}$/,sp=/^#[a-fA-F0-9]{3}$/,up=/^#[a-fA-F0-9]{4}$/,lp=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,cp=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,hp=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,pp=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function fp(t){if("string"!=typeof t)throw new tp(3);var e=function(t){if("string"!=typeof t)return t;var e=t.toLowerCase();return ip[e]?"#"+ip[e]:t}(t);if(e.match(op))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(ap)){var n=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:n}}if(e.match(sp))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(up)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var i=lp.exec(e);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var o=cp.exec(e.substring(0,50));if(o)return{red:parseInt(""+o[1],10),green:parseInt(""+o[2],10),blue:parseInt(""+o[3],10),alpha:parseFloat(""+o[4])>1?parseFloat(""+o[4])/100:parseFloat(""+o[4])};var a=hp.exec(e);if(a){var s="rgb("+rp(parseInt(""+a[1],10),parseInt(""+a[2],10)/100,parseInt(""+a[3],10)/100)+")",u=lp.exec(s);if(!u)throw new tp(4,e,s);return{red:parseInt(""+u[1],10),green:parseInt(""+u[2],10),blue:parseInt(""+u[3],10)}}var l=pp.exec(e.substring(0,50));if(l){var c="rgb("+rp(parseInt(""+l[1],10),parseInt(""+l[2],10)/100,parseInt(""+l[3],10)/100)+")",h=lp.exec(c);if(!h)throw new tp(4,e,c);return{red:parseInt(""+h[1],10),green:parseInt(""+h[2],10),blue:parseInt(""+h[3],10),alpha:parseFloat(""+l[4])>1?parseFloat(""+l[4])/100:parseFloat(""+l[4])}}throw new tp(5)}var dp=function(t){return 7===t.length&&t[1]===t[2]&&t[3]===t[4]&&t[5]===t[6]?"#"+t[1]+t[3]+t[5]:t};function mp(t){var e=t.toString(16);return 1===e.length?"0"+e:e}function gp(t,e,n){if("number"==typeof t&&"number"==typeof e&&"number"==typeof n)return dp("#"+mp(t)+mp(e)+mp(n));if("object"==typeof t&&void 0===e&&void 0===n)return dp("#"+mp(t.red)+mp(t.green)+mp(t.blue));throw new tp(6)}function yp(t,e,n){return function(){var r=n.concat(Array.prototype.slice.call(arguments));return r.length>=e?t.apply(this,r):yp(t,e,r)}}function vp(t){return yp(t,t.length,[])}function _p(t,e){if("transparent"===e)return e;var n,r,i,o=fp(e);return function(t,e,n,r){if("string"==typeof t&&"number"==typeof e){var i=fp(t);return"rgba("+i.red+","+i.green+","+i.blue+","+e+")"}if("number"==typeof t&&"number"==typeof e&&"number"==typeof n&&"number"==typeof r)return r>=1?gp(t,e,n):"rgba("+t+","+e+","+n+","+r+")";if("object"==typeof t&&void 0===e&&void 0===n&&void 0===r)return t.alpha>=1?gp(t.red,t.green,t.blue):"rgba("+t.red+","+t.green+","+t.blue+","+t.alpha+")";throw new tp(7)}(Qh({},o,{alpha:(n=0,r=1,i=(100*("number"==typeof o.alpha?o.alpha:1)+100*parseFloat(t))/100,Math.max(n,Math.min(r,i)))}))}var xp,bp=vp(_p),wp={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-wp.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*wp.Bounce.In(2*t):.5*wp.Bounce.Out(2*t-1)+.5}}},Sp="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},Ep=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=Sp()),void 0===e&&(e=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]],o=!e;i&&!1===i.update(t,o)&&!e&&delete this._tweens[n[r]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),Cp={Linear:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),o=Cp.Utils.Linear;return e<0?o(t[0],t[1],r):e>1?o(t[n],t[n-1],n-r):o(t[i],t[i+1>n?n:i+1],r-i)},Bezier:function(t,e){for(var n=0,r=t.length-1,i=Math.pow,o=Cp.Utils.Bernstein,a=0;a<=r;a++)n+=i(1-e,r-a)*i(e,a)*t[a]*o(r,a);return n},CatmullRom:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),o=Cp.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(i=Math.floor(r=n*(1+e))),o(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],r-i)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[n]-(o(t[n],t[n],t[n-1],t[n-1],r-n)-t[n]):o(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],r-i)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=Cp.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(xp=[1],function(t){var e=1;if(xp[t])return xp[t];for(var n=t;n>1;n--)e*=n;return xp[t]=e,e}),CatmullRom:function(t,e,n,r,i){var o=.5*(n-t),a=.5*(r-e),s=i*i;return(2*e-2*n+o+a)*(i*s)+(-3*e+3*n-2*o-a)*s+o*i+e}}},Mp=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),Tp=new Ep,Ap=function(){function t(t,e){void 0===e&&(e=Tp),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=wp.Linear.None,this._interpolationFunction=Cp.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Mp.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?Sp()+parseFloat(t):t:Sp(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,r){for(var i in n){var o=t[i],a=Array.isArray(o),s=a?"array":typeof o,u=!a&&Array.isArray(n[i]);if("undefined"!==s&&"function"!==s){if(u){var l=n[i];if(0===l.length)continue;l=l.map(this._handleRelativeValue.bind(this,o)),n[i]=[o].concat(l)}if("object"!==s&&!a||!o||u)void 0===e[i]&&(e[i]=o),a||(e[i]*=1),r[i]=u?n[i].slice().reverse():e[i]||0;else{for(var c in e[i]=a?[]:{},o)e[i][c]=o[c];r[i]=a?[]:{},this._setupProperties(o,e[i],n[i],r[i])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=Sp()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=Sp()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=Sp()),void 0===e&&(e=!0),this._isPaused)return!0;var n,r,i=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>i)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(t-this._startTime)/this._duration,r=0===this._duration||r>1?1:r;var o=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,s=this._chainedTweens.length;a<s;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,r){for(var i in n)if(void 0!==e[i]){var o=e[i]||0,a=n[i],s=Array.isArray(t[i]),u=Array.isArray(a);!s&&u?t[i]=this._interpolationFunction(a,r):"object"==typeof a&&a?this._updateProperties(t[i],o,a,r):"number"==typeof(a=this._handleRelativeValue(o,a))&&(t[i]=o+(a-o)*r)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),Pp=Mp.nextId,Lp=Tp,Ip=Lp.getAll.bind(Lp),kp=Lp.removeAll.bind(Lp),Op=Lp.add.bind(Lp),Rp=Lp.remove.bind(Lp),Dp=Lp.update.bind(Lp);const Np={Easing:wp,Group:Ep,Interpolation:Cp,now:Sp,Sequence:Mp,nextId:Pp,Tween:Ap,VERSION:"18.6.4",getAll:Ip,removeAll:kp,add:Op,remove:Rp,update:Dp};function Fp(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zp(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(t,e)||jp(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bp(t){return function(t){if(Array.isArray(t))return Up(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||jp(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jp(t,e){if(t){if("string"==typeof t)return Up(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Up(t,e):void 0}}function Up(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".scene-nav-info {\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n}\n\n.scene-tooltip {\n  top: 0;\n  color: lavender;\n  font-size: 15px;\n}\n\n.scene-nav-info, .scene-tooltip {\n  position: absolute;\n  font-family: sans-serif;\n  pointer-events: none;\n}\n\n.scene-container canvas:focus {\n  outline: none;\n}");var Zp=window.THREE?window.THREE:{WebGLRenderer:vo,Scene:bo,PerspectiveCamera:An,Raycaster:Pu,TextureLoader:Ys,Vector2:$,Vector3:Ct,Box3:At,Color:ft,Mesh:xn,SphereGeometry:ds,MeshBasicMaterial:Ue,BackSide:1,EventDispatcher:G,MOUSE:r,Quaternion:Et,Spherical:ku,Clock:du},Vp=vc({props:{width:{default:window.innerWidth,onChange:function(t,e,n){isNaN(t)&&(e.width=n)}},height:{default:window.innerHeight,onChange:function(t,e,n){isNaN(t)&&(e.height=n)}},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},enablePointerInteraction:{default:!0,onChange:function(t,e){e.hoverObj=null,e.toolTipElem&&(e.toolTipElem.innerHTML="")},triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{default:function(){return-1},triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(t){if(t.initialised){if(t.controls.update&&t.controls.update(t.clock.getDelta()),t.postProcessingComposer?t.postProcessingComposer.render():t.renderer.render(t.scene,t.camera),t.extraRenderers.forEach((function(e){return e.render(t.scene,t.camera)})),t.enablePointerInteraction){var e=null;if(t.hoverDuringDrag||!t.isPointerDragging){var n=this.intersectingObjects(t.pointerPos.x,t.pointerPos.y).filter((function(e){return t.hoverFilter(e.object)})).sort((function(e,n){return t.hoverOrderComparator(e.object,n.object)})),r=n.length?n[0]:null;e=r?r.object:null,t.intersectionPoint=r?r.point:null}e!==t.hoverObj&&(t.onHover(e,t.hoverObj),t.toolTipElem.innerHTML=e&&_c(t.tooltipContent)(e)||"",t.hoverObj=e)}Np.update()}return this},getPointerPos:function(t){var e=t.pointerPos;return{x:e.x,y:e.y}},cameraPosition:function(t,e,n,r){var i=t.camera;if(e&&t.initialised){var o=e,a=n||{x:0,y:0,z:0};if(r){var s=Object.assign({},i.position),u=h();new Np.Tween(s).to(o,r).easing(Np.Easing.Quadratic.Out).onUpdate(l).start(),new Np.Tween(u).to(a,r/3).easing(Np.Easing.Quadratic.Out).onUpdate(c).start()}else l(o),c(a);return this}return Object.assign({},i.position,{lookAt:h()});function l(t){var e=t.x,n=t.y,r=t.z;void 0!==e&&(i.position.x=e),void 0!==n&&(i.position.y=n),void 0!==r&&(i.position.z=r)}function c(e){var n=new Zp.Vector3(e.x,e.y,e.z);t.controls.target?t.controls.target=n:i.lookAt(n)}function h(){return Object.assign(new Zp.Vector3(0,0,-1e3).applyQuaternion(i.quaternion).add(i.position))}},zoomToFit:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,i),e,n)},fitToBbox:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,i=t.camera;if(e){var o=new Zp.Vector3(0,0,0),a=2*Math.max.apply(Math,Bp(Object.entries(e).map((function(t){var e=zp(t,2),n=e[0],r=e[1];return Math.max.apply(Math,Bp(r.map((function(t){return Math.abs(o[n]-t)}))))})))),s=(1-2*r/t.height)*i.fov,u=a/Math.atan(s*Math.PI/180),l=u/i.aspect,c=Math.max(u,l);if(c>0){var h=o.clone().sub(i.position).normalize().multiplyScalar(-c);this.cameraPosition(h,o,n)}}return this},getBbox:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=new Zp.Box3(new Zp.Vector3(0,0,0),new Zp.Vector3(0,0,0)),r=t.objects.filter(e);return r.length?(r.forEach((function(t){return n.expandByObject(t)})),Object.assign.apply(Object,Bp(["x","y","z"].map((function(t){return Fp({},t,[n.min[t],n.max[t]])}))))):null},getScreenCoords:function(t,e,n,r){var i=new Zp.Vector3(e,n,r);return i.project(this.camera()),{x:(i.x+1)*t.width/2,y:-(i.y-1)*t.height/2}},getSceneCoords:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new Zp.Vector2(e/t.width*2-1,-n/t.height*2+1),o=new Zp.Raycaster;return o.setFromCamera(i,t.camera),Object.assign({},o.ray.at(r,new Zp.Vector3))},intersectingObjects:function(t,e,n){var r=new Zp.Vector2(e/t.width*2-1,-n/t.height*2+1),i=new Zp.Raycaster;return i.params.Line.threshold=t.lineHoverPrecision,i.setFromCamera(r,t.camera),i.intersectObjects(t.objects,!0)},renderer:function(t){return t.renderer},scene:function(t){return t.scene},camera:function(t){return t.camera},postProcessingComposer:function(t){return t.postProcessingComposer},controls:function(t){return t.controls},tbControls:function(t){return t.controls}},stateInit:function(){return{scene:new Zp.Scene,camera:new Zp.PerspectiveCamera,clock:new Zp.Clock}},init:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.controlType,i=void 0===r?"trackball":r,o=n.rendererConfig,a=void 0===o?{}:o,s=n.extraRenderers,u=void 0===s?[]:s,l=n.waitForLoadComplete,c=void 0===l||l;t.innerHTML="",t.appendChild(e.container=document.createElement("div")),e.container.className="scene-container",e.container.style.position="relative",e.container.appendChild(e.navInfo=document.createElement("div")),e.navInfo.className="scene-nav-info",e.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[i]||"",e.navInfo.style.display=e.showNavInfo?null:"none",e.toolTipElem=document.createElement("div"),e.toolTipElem.classList.add("scene-tooltip"),e.container.appendChild(e.toolTipElem),e.pointerPos=new Zp.Vector2,e.pointerPos.x=-2,e.pointerPos.y=-2,["pointermove","pointerdown"].forEach((function(t){return e.container.addEventListener(t,(function(n){if("pointerdown"===t&&(e.isPointerPressed=!0),!e.isPointerDragging&&"pointermove"===n.type&&(n.pressure>0||e.isPointerPressed)&&("touch"!==n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some((function(t){return Math.abs(t)>1})))&&(e.isPointerDragging=!0),e.enablePointerInteraction){var r=(i=e.container.getBoundingClientRect(),o=window.pageXOffset||document.documentElement.scrollLeft,a=window.pageYOffset||document.documentElement.scrollTop,{top:i.top+a,left:i.left+o});e.pointerPos.x=n.pageX-r.left,e.pointerPos.y=n.pageY-r.top,e.toolTipElem.style.top="".concat(e.pointerPos.y,"px"),e.toolTipElem.style.left="".concat(e.pointerPos.x,"px"),e.toolTipElem.style.transform="translate(-".concat(e.pointerPos.x/e.width*100,"%, ").concat(e.height-e.pointerPos.y<100?"calc(-100% - 8px)":"21px",")")}var i,o,a}),{passive:!0})})),e.container.addEventListener("pointerup",(function(t){e.isPointerPressed=!1,e.isPointerDragging&&(e.isPointerDragging=!1,!e.clickAfterDrag)||requestAnimationFrame((function(){0===t.button&&e.onClick(e.hoverObj||null,t,e.intersectionPoint),2===t.button&&e.onRightClick&&e.onRightClick(e.hoverObj||null,t,e.intersectionPoint)}))}),{passive:!0,capture:!0}),e.container.addEventListener("contextmenu",(function(t){e.onRightClick&&t.preventDefault()})),e.renderer=new Zp.WebGLRenderer(Object.assign({antialias:!0,alpha:!0},a)),e.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),e.container.appendChild(e.renderer.domElement),e.extraRenderers=u,e.extraRenderers.forEach((function(t){t.domElement.style.position="absolute",t.domElement.style.top="0px",t.domElement.style.pointerEvents="none",e.container.appendChild(t.domElement)})),e.postProcessingComposer=new Xh(e.renderer),e.postProcessingComposer.addPass(new Kh(e.scene,e.camera)),e.controls=new{trackball:kh,orbit:Nh,fly:zh}[i](e.camera,e.renderer.domElement),"fly"===i&&(e.controls.movementSpeed=300,e.controls.rollSpeed=Math.PI/6,e.controls.dragToLook=!0),"trackball"!==i&&"orbit"!==i||(e.controls.minDistance=.1,e.controls.maxDistance=e.skyRadius,e.controls.addEventListener("start",(function(){e.controlsEngaged=!0})),e.controls.addEventListener("change",(function(){e.controlsEngaged&&(e.controlsDragging=!0)})),e.controls.addEventListener("end",(function(){e.controlsEngaged=!1,e.controlsDragging=!1}))),[e.renderer,e.postProcessingComposer].concat(Bp(e.extraRenderers)).forEach((function(t){return t.setSize(e.width,e.height)})),e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix(),e.camera.position.z=1e3,e.scene.add(e.skysphere=new Zp.Mesh),e.skysphere.visible=!1,e.loadComplete=e.scene.visible=!c,window.scene=e.scene},update:function(t,e){if(t.width&&t.height&&(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&(t.container.style.width="".concat(t.width,"px"),t.container.style.height="".concat(t.height,"px"),[t.renderer,t.postProcessingComposer].concat(Bp(t.extraRenderers)).forEach((function(e){return e.setSize(t.width,t.height)})),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix()),e.hasOwnProperty("skyRadius")&&t.skyRadius&&(t.controls.hasOwnProperty("maxDistance")&&e.skyRadius&&(t.controls.maxDistance=Math.min(t.controls.maxDistance,t.skyRadius)),t.camera.far=2.5*t.skyRadius,t.camera.updateProjectionMatrix(),t.skysphere.geometry=new Zp.SphereGeometry(t.skyRadius)),e.hasOwnProperty("backgroundColor")){var n=fp(t.backgroundColor).alpha;void 0===n&&(n=1),t.renderer.setClearColor(new Zp.Color(bp(1,t.backgroundColor)),n)}function r(){t.loadComplete=t.scene.visible=!0}e.hasOwnProperty("backgroundImageUrl")&&(t.backgroundImageUrl?(new Zp.TextureLoader).load(t.backgroundImageUrl,(function(e){t.skysphere.material=new Zp.MeshBasicMaterial({map:e,side:Zp.BackSide}),t.skysphere.visible=!0,t.onBackgroundImageLoaded&&setTimeout(t.onBackgroundImageLoaded),!t.loadComplete&&r()})):(t.skysphere.visible=!1,t.skysphere.material.map=null,!t.loadComplete&&r())),e.hasOwnProperty("showNavInfo")&&(t.navInfo.style.display=t.showNavInfo?null:"none"),e.hasOwnProperty("objects")&&((e.objects||[]).forEach((function(e){return t.scene.remove(e)})),t.objects.forEach((function(e){return t.scene.add(e)})))}});function Gp(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Hp(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Gp(Object(n),!0).forEach((function(e){Wp(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Gp(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Wp(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function qp(t){return function(t){if(Array.isArray(t))return Xp(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Xp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xp(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Yp(t,e){var n=new e;return{linkProp:function(e){return{default:n[e](),onChange:function(n,r){r[t][e](n)},triggerUpdate:!1}},linkMethod:function(e){return function(n){for(var r=n[t],i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];var s=r[e].apply(r,o);return s===r?this:s}}}}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".graph-info-msg {\n  top: 50%;\n  width: 100%;\n  text-align: center;\n  color: lavender;\n  opacity: 0.7;\n  font-size: 22px;\n  position: absolute;\n  font-family: Sans-serif;\n}\n\n.scene-container .clickable {\n  cursor: pointer;\n}\n\n.scene-container .grabbable {\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.scene-container .grabbable:active {\n  cursor: grabbing;\n  cursor: -moz-grabbing;\n  cursor: -webkit-grabbing;\n}");var Kp=window.THREE?window.THREE:{AmbientLight:uu,DirectionalLight:su,Vector3:Ct},Qp=Yp("forceGraph",Ah),Jp=Object.assign.apply(Object,qp(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map((function(t){return Wp({},t,Qp.linkProp(t))})))),$p=Object.assign.apply(Object,qp(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map((function(t){return Wp({},t,Qp.linkMethod(t))})))),tf=Yp("renderObjs",Vp),ef=Object.assign.apply(Object,qp(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map((function(t){return Wp({},t,tf.linkProp(t))})))),nf=Object.assign.apply(Object,qp(["cameraPosition","postProcessingComposer"].map((function(t){return Wp({},t,tf.linkMethod(t))}))).concat([{graph2ScreenCoords:tf.linkMethod("getScreenCoords"),screen2GraphCoords:tf.linkMethod("getSceneCoords")}])),rf=vc({props:Hp(Hp({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(t,e){return e.renderObjs.lineHoverPrecision(t)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(t,e){var n=e.renderObjs.controls();n&&(n.enabled=t)},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},Jp),ef),methods:Hp(Hp({zoomToFit:function(t,e,n){for(var r,i=arguments.length,o=new Array(i>3?i-3:0),a=3;a<i;a++)o[a-3]=arguments[a];return t.renderObjs.fitToBbox((r=t.forceGraph).getGraphBbox.apply(r,o),e,n),this},pauseAnimation:function(t){return null!==t.animationFrameRequestId&&(cancelAnimationFrame(t.animationFrameRequestId),t.animationFrameRequestId=null),this},resumeAnimation:function(t){return null===t.animationFrameRequestId&&this._animationCycle(),this},_animationCycle:function(t){t.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),t.forceGraph.tickFrame(),t.renderObjs.tick(),t.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(t){return t.renderObjs.scene()},camera:function(t){return t.renderObjs.camera()},renderer:function(t){return t.renderObjs.renderer()},controls:function(t){return t.renderObjs.controls()},tbControls:function(t){return t.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},$p),nf),stateInit:function(t){var e=t.controlType,n=t.rendererConfig,r=t.extraRenderers;return{forceGraph:new Ah,renderObjs:Vp({controlType:e,rendererConfig:n,extraRenderers:r})}},init:function(t,e){t.innerHTML="",t.appendChild(e.container=document.createElement("div")),e.container.style.position="relative";var n=document.createElement("div");e.container.appendChild(n),e.renderObjs(n);var r,i=e.renderObjs.camera(),o=e.renderObjs.renderer(),a=e.renderObjs.controls();a.enabled=!!e.enableNavigationControls,e.lastSetCameraZ=i.position.z,e.container.appendChild(r=document.createElement("div")),r.className="graph-info-msg",r.textContent="",e.forceGraph.onLoading((function(){r.textContent="Loading..."})).onFinishLoading((function(){r.textContent=""})).onUpdate((function(){e.graphData=e.forceGraph.graphData(),0===i.position.x&&0===i.position.y&&i.position.z===e.lastSetCameraZ&&e.graphData.nodes.length&&(i.lookAt(e.forceGraph.position),e.lastSetCameraZ=i.position.z=170*Math.cbrt(e.graphData.nodes.length))})).onFinishUpdate((function(){if(e._dragControls){var t=e.graphData.nodes.find((function(t){return t.__initialFixedPos&&!t.__disposeControlsAfterDrag}));t?t.__disposeControlsAfterDrag=!0:e._dragControls.dispose(),e._dragControls=void 0}if(e.enableNodeDrag&&e.enablePointerInteraction&&"d3"===e.forceEngine){var n=e._dragControls=new Ju(e.graphData.nodes.map((function(t){return t.__threeObj})).filter((function(t){return t})),i,o.domElement);n.addEventListener("dragstart",(function(t){a.enabled=!1,t.object.__initialPos=t.object.position.clone(),t.object.__prevPos=t.object.position.clone();var e=of(t.object).__data;!e.__initialFixedPos&&(e.__initialFixedPos={fx:e.fx,fy:e.fy,fz:e.fz}),!e.__initialPos&&(e.__initialPos={x:e.x,y:e.y,z:e.z}),["x","y","z"].forEach((function(t){return e["f".concat(t)]=e[t]})),o.domElement.classList.add("grabbable")})),n.addEventListener("drag",(function(t){var n=of(t.object);if(!t.object.hasOwnProperty("__graphObjType")){var r=t.object.__initialPos,i=t.object.__prevPos,o=t.object.position;n.position.add(o.clone().sub(i)),i.copy(o),o.copy(r)}var a=n.__data,s=n.position,u={x:s.x-a.x,y:s.y-a.y,z:s.z-a.z};["x","y","z"].forEach((function(t){return a["f".concat(t)]=a[t]=s[t]})),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),a.__dragged=!0,e.onNodeDrag(a,u)})),n.addEventListener("dragend",(function(t){delete t.object.__initialPos,delete t.object.__prevPos;var r=of(t.object).__data;r.__disposeControlsAfterDrag&&(n.dispose(),delete r.__disposeControlsAfterDrag);var i=r.__initialFixedPos,s=r.__initialPos,u={x:s.x-r.x,y:s.y-r.y,z:s.z-r.z};i&&(["x","y","z"].forEach((function(t){var e="f".concat(t);void 0===i[e]&&delete r[e]})),delete r.__initialFixedPos,delete r.__initialPos,r.__dragged&&(delete r.__dragged,e.onNodeDragEnd(r,u))),e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.enableNavigationControls&&(a.enabled=!0,a.domElement&&a.domElement.ownerDocument&&a.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),o.domElement.classList.remove("grabbable")}))}})),e.renderObjs.objects([new Kp.AmbientLight(12303291),new Kp.DirectionalLight(16777215,.6),e.forceGraph]).hoverOrderComparator((function(t,e){var n=of(t);if(!n)return 1;var r=of(e);if(!r)return-1;var i=function(t){return"node"===t.__graphObjType};return i(r)-i(n)})).tooltipContent((function(t){var n=of(t);return n&&_c(e["".concat(n.__graphObjType,"Label")])(n.__data)||""})).hoverDuringDrag(!1).onHover((function(t){var n=of(t);if(n!==e.hoverObj){var r=e.hoverObj?e.hoverObj.__graphObjType:null,i=e.hoverObj?e.hoverObj.__data:null,a=n?n.__graphObjType:null,s=n?n.__data:null;if(r&&r!==a){var u=e["on".concat("node"===r?"Node":"Link","Hover")];u&&u(null,i)}if(a){var l=e["on".concat("node"===a?"Node":"Link","Hover")];l&&l(s,r===a?i:null)}o.domElement.classList[n&&e["on".concat("node"===a?"Node":"Link","Click")]||!n&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=n}})).clickAfterDrag(!1).onClick((function(t,n){var r=of(t);if(r){var i=e["on".concat("node"===r.__graphObjType?"Node":"Link","Click")];i&&i(r.__data,n)}else e.onBackgroundClick&&e.onBackgroundClick(n)})).onRightClick((function(t,n){var r=of(t);if(r){var i=e["on".concat("node"===r.__graphObjType?"Node":"Link","RightClick")];i&&i(r.__data,n)}else e.onBackgroundRightClick&&e.onBackgroundRightClick(n)})),this._animationCycle()}});function of(t){for(var e=t;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var af=s(314),sf=s.n(af);let uf=Ef();const lf=t=>xf(t,uf);let cf=Ef();lf.write=t=>xf(t,cf);let hf=Ef();lf.onStart=t=>xf(t,hf);let pf=Ef();lf.onFrame=t=>xf(t,pf);let ff=Ef();lf.onFinish=t=>xf(t,ff);let df=[];lf.setTimeout=(t,e)=>{let n=lf.now()+e,r=()=>{let t=df.findIndex((t=>t.cancel==r));~t&&df.splice(t,1),vf-=~t?1:0},i={time:n,handler:t,cancel:r};return df.splice(mf(n),0,i),vf+=1,bf(),i};let mf=t=>~(~df.findIndex((e=>e.time>t))||~df.length);lf.cancel=t=>{hf.delete(t),pf.delete(t),ff.delete(t),uf.delete(t),cf.delete(t)},lf.sync=t=>{_f=!0,lf.batchedUpdates(t),_f=!1},lf.throttle=t=>{let e;function n(){try{t(...e)}finally{e=null}}function r(...t){e=t,lf.onStart(n)}return r.handler=t,r.cancel=()=>{hf.delete(n),e=null},r};let gf="undefined"!=typeof window?window.requestAnimationFrame:()=>{};lf.use=t=>gf=t,lf.now="undefined"!=typeof performance?()=>performance.now():Date.now,lf.batchedUpdates=t=>t(),lf.catch=console.error,lf.frameLoop="always",lf.advance=()=>{"demand"!==lf.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):Sf()};let yf=-1,vf=0,_f=!1;function xf(t,e){_f?(e.delete(t),t(0)):(e.add(t),bf())}function bf(){yf<0&&(yf=0,"demand"!==lf.frameLoop&&gf(wf))}function wf(){~yf&&(gf(wf),lf.batchedUpdates(Sf))}function Sf(){let t=yf;yf=lf.now();let e=mf(yf);e&&(Cf(df.splice(0,e),(t=>t.handler())),vf-=e),vf?(hf.flush(),uf.flush(t?Math.min(64,yf-t):16.667),pf.flush(),cf.flush(),ff.flush()):yf=-1}function Ef(){let t=new Set,e=t;return{add(n){vf+=e!=t||t.has(n)?0:1,t.add(n)},delete:n=>(vf-=e==t&&t.has(n)?1:0,t.delete(n)),flush(n){e.size&&(t=new Set,vf-=e.size,Cf(e,(e=>e(n)&&t.add(e))),vf+=t.size,e=t)}}}function Cf(t,e){t.forEach((t=>{try{e(t)}catch(t){lf.catch(t)}}))}function Mf(){}const Tf={arr:Array.isArray,obj:t=>!!t&&"Object"===t.constructor.name,fun:t=>"function"==typeof t,str:t=>"string"==typeof t,num:t=>"number"==typeof t,und:t=>void 0===t};function Af(t,e){if(Tf.arr(t)){if(!Tf.arr(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return t===e}const Pf=(t,e)=>t.forEach(e);function Lf(t,e,n){if(Tf.arr(t))for(let r=0;r<t.length;r++)e.call(n,t[r],`${r}`);else for(const r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r)}const If=t=>Tf.und(t)?[]:Tf.arr(t)?t:[t];function kf(t,e){if(t.size){const n=Array.from(t);t.clear(),Pf(n,e)}}const Of=(t,...e)=>kf(t,(t=>t(...e))),Rf=()=>"undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent);let Df,Nf,Ff=null,zf=!1,Bf=Mf;var jf=Object.freeze({__proto__:null,get createStringInterpolator(){return Df},get to(){return Nf},get colors(){return Ff},get skipAnimation(){return zf},get willAdvance(){return Bf},assign:t=>{t.to&&(Nf=t.to),t.now&&(lf.now=t.now),void 0!==t.colors&&(Ff=t.colors),null!=t.skipAnimation&&(zf=t.skipAnimation),t.createStringInterpolator&&(Df=t.createStringInterpolator),t.requestAnimationFrame&&lf.use(t.requestAnimationFrame),t.batchedUpdates&&(lf.batchedUpdates=t.batchedUpdates),t.willAdvance&&(Bf=t.willAdvance),t.frameLoop&&(lf.frameLoop=t.frameLoop)}});const Uf=new Set;let Zf=[],Vf=[],Gf=0;const Hf={get idle(){return!Uf.size&&!Zf.length},start(t){Gf>t.priority?(Uf.add(t),lf.onStart(Wf)):(qf(t),lf(Yf))},advance:Yf,sort(t){if(Gf)lf.onFrame((()=>Hf.sort(t)));else{const e=Zf.indexOf(t);~e&&(Zf.splice(e,1),Xf(t))}},clear(){Zf=[],Uf.clear()}};function Wf(){Uf.forEach(qf),Uf.clear(),lf(Yf)}function qf(t){Zf.includes(t)||Xf(t)}function Xf(t){Zf.splice(function(e,n){const r=e.findIndex((e=>e.priority>t.priority));return r<0?e.length:r}(Zf),0,t)}function Yf(t){const e=Vf;for(let n=0;n<Zf.length;n++){const r=Zf[n];Gf=r.priority,r.idle||(Bf(r),r.advance(t),r.idle||e.push(r))}return Gf=0,Vf=Zf,Vf.length=0,Zf=e,Zf.length>0}const Kf="[-+]?\\d*\\.?\\d+",Qf=Kf+"%";function Jf(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}const $f=new RegExp("rgb"+Jf(Kf,Kf,Kf)),td=new RegExp("rgba"+Jf(Kf,Kf,Kf,Kf)),ed=new RegExp("hsl"+Jf(Kf,Qf,Qf)),nd=new RegExp("hsla"+Jf(Kf,Qf,Qf,Kf)),rd=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,id=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,od=/^#([0-9a-fA-F]{6})$/,ad=/^#([0-9a-fA-F]{8})$/;function sd(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function ud(t,e,n){const r=n<.5?n*(1+e):n+e-n*e,i=2*n-r,o=sd(i,r,t+1/3),a=sd(i,r,t),s=sd(i,r,t-1/3);return Math.round(255*o)<<24|Math.round(255*a)<<16|Math.round(255*s)<<8}function ld(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function cd(t){return(parseFloat(t)%360+360)%360/360}function hd(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(255*e)}function pd(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function fd(t){let e=function(t){let e;return"number"==typeof t?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=od.exec(t))?parseInt(e[1]+"ff",16)>>>0:Ff&&void 0!==Ff[t]?Ff[t]:(e=$f.exec(t))?(ld(e[1])<<24|ld(e[2])<<16|ld(e[3])<<8|255)>>>0:(e=td.exec(t))?(ld(e[1])<<24|ld(e[2])<<16|ld(e[3])<<8|hd(e[4]))>>>0:(e=rd.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=ad.exec(t))?parseInt(e[1],16)>>>0:(e=id.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=ed.exec(t))?(255|ud(cd(e[1]),pd(e[2]),pd(e[3])))>>>0:(e=nd.exec(t))?(ud(cd(e[1]),pd(e[2]),pd(e[3]))|hd(e[4]))>>>0:null}(t);return null===e?t:(e=e||0,`rgba(${(4278190080&e)>>>24}, ${(16711680&e)>>>16}, ${(65280&e)>>>8}, ${(255&e)/255})`)}const dd=(t,e,n)=>{if(Tf.fun(t))return t;if(Tf.arr(t))return dd({range:t,output:e,extrapolate:n});if(Tf.str(t.output[0]))return Df(t);const r=t,i=r.output,o=r.range||[0,1],a=r.extrapolateLeft||r.extrapolate||"extend",s=r.extrapolateRight||r.extrapolate||"extend",u=r.easing||(t=>t);return t=>{const e=function(t,e){for(var n=1;n<e.length-1&&!(e[n]>=t);++n);return n-1}(t,o);return function(t,e,n,r,i,o,a,s,u){let l=u?u(t):t;if(l<e){if("identity"===a)return l;"clamp"===a&&(l=e)}if(l>n){if("identity"===s)return l;"clamp"===s&&(l=n)}return r===i?r:e===n?t<=e?r:i:(e===-1/0?l=-l:n===1/0?l-=e:l=(l-e)/(n-e),l=o(l),r===-1/0?l=-l:i===1/0?l+=r:l=l*(i-r)+r,l)}(t,o[e],o[e+1],i[e],i[e+1],u,a,s,r.map)}};function md(){return md=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},md.apply(this,arguments)}const gd=Symbol.for("FluidValue.get"),yd=Symbol.for("FluidValue.observers"),vd=t=>Boolean(t&&t[gd]),_d=t=>t&&t[gd]?t[gd]():t,xd=t=>t[yd]||null;function bd(t,e){let n=t[yd];n&&n.forEach((t=>{!function(t,e){t.eventObserved?t.eventObserved(e):t(e)}(t,e)}))}class wd{constructor(t){if(this[gd]=void 0,this[yd]=void 0,!t&&!(t=this.get))throw Error("Unknown getter");Sd(this,t)}}const Sd=(t,e)=>Md(t,gd,e);function Ed(t,e){if(t[gd]){let n=t[yd];n||Md(t,yd,n=new Set),n.has(e)||(n.add(e),t.observerAdded&&t.observerAdded(n.size,e))}return e}function Cd(t,e){let n=t[yd];if(n&&n.has(e)){const r=n.size-1;r?n.delete(e):t[yd]=null,t.observerRemoved&&t.observerRemoved(r,e)}}const Md=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),Td=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Ad=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,Pd=new RegExp(`(${Td.source})(%|[a-z]+)`,"i"),Ld=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,Id=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,kd=t=>{const[e,n]=Od(t);if(!e||Rf())return t;const r=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(r)return r.trim();if(n&&n.startsWith("--")){return window.getComputedStyle(document.documentElement).getPropertyValue(n)||t}return n&&Id.test(n)?kd(n):n||t},Od=t=>{const e=Id.exec(t);if(!e)return[,];const[,n,r]=e;return[n,r]};let Rd;const Dd=(t,e,n,r,i)=>`rgba(${Math.round(e)}, ${Math.round(n)}, ${Math.round(r)}, ${i})`,Nd=t=>{Rd||(Rd=Ff?new RegExp(`(${Object.keys(Ff).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map((t=>_d(t).replace(Id,kd).replace(Ad,fd).replace(Rd,fd))),n=e.map((t=>t.match(Td).map(Number))),r=n[0].map(((t,e)=>n.map((t=>{if(!(e in t))throw Error('The arity of each "output" value must be equal');return t[e]})))).map((e=>dd(md({},t,{output:e}))));return t=>{var n;const i=!Pd.test(e[0])&&(null==(n=e.find((t=>Pd.test(t))))?void 0:n.replace(Td,""));let o=0;return e[0].replace(Td,(()=>`${r[o++](t)}${i||""}`)).replace(Ld,Dd)}},Fd="react-spring: ",zd=t=>{const e=t;let n=!1;if("function"!=typeof e)throw new TypeError(`${Fd}once requires a function parameter`);return(...t)=>{n||(e(...t),n=!0)}},Bd=zd(console.warn),jd=zd(console.warn);function Ud(t){return Tf.str(t)&&("#"==t[0]||/\d/.test(t)||!Rf()&&Id.test(t)||t in(Ff||{}))}const Zd=Rf()?e.useEffect:e.useLayoutEffect;function Vd(){const t=(0,e.useState)()[1],n=(()=>{const t=(0,e.useRef)(!1);return Zd((()=>(t.current=!0,()=>{t.current=!1})),[]),t})();return()=>{n.current&&t(Math.random())}}const Gd=t=>(0,e.useEffect)(t,Hd),Hd=[];function Wd(t){const n=(0,e.useRef)();return(0,e.useEffect)((()=>{n.current=t})),n.current}const qd=Symbol.for("Animated:node"),Xd=t=>t&&t[qd],Yd=(t,e)=>{return n=t,r=qd,i=e,Object.defineProperty(n,r,{value:i,writable:!0,configurable:!0});var n,r,i},Kd=t=>t&&t[qd]&&t[qd].getPayload();class Qd{constructor(){this.payload=void 0,Yd(this,this)}getPayload(){return this.payload||[]}}class Jd extends Qd{constructor(t){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=t,Tf.num(this._value)&&(this.lastPosition=this._value)}static create(t){return new Jd(t)}getPayload(){return[this]}getValue(){return this._value}setValue(t,e){return Tf.num(t)&&(this.lastPosition=t,e&&(t=Math.round(t/e)*e,this.done&&(this.lastPosition=t))),this._value!==t&&(this._value=t,!0)}reset(){const{done:t}=this;this.done=!1,Tf.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,t&&(this.lastVelocity=null),this.v0=null)}}class $d extends Jd{constructor(t){super(0),this._string=null,this._toString=void 0,this._toString=dd({output:[t,t]})}static create(t){return new $d(t)}getValue(){let t=this._string;return null==t?this._string=this._toString(this._value):t}setValue(t){if(Tf.str(t)){if(t==this._string)return!1;this._string=t,this._value=1}else{if(!super.setValue(t))return!1;this._string=null}return!0}reset(t){t&&(this._toString=dd({output:[this.getValue(),t]})),this._value=0,super.reset()}}const tm={dependencies:null};class em extends Qd{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return Lf(this.source,((n,r)=>{var i;(i=n)&&i[qd]===i?e[r]=n.getValue(t):vd(n)?e[r]=_d(n):t||(e[r]=n)})),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&Pf(this.payload,(t=>t.reset()))}_makePayload(t){if(t){const e=new Set;return Lf(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){tm.dependencies&&vd(t)&&tm.dependencies.add(t);const e=Kd(t);e&&Pf(e,(t=>this.add(t)))}}class nm extends em{constructor(t){super(t)}static create(t){return new nm(t)}getValue(){return this.source.map((t=>t.getValue()))}setValue(t){const e=this.getPayload();return t.length==e.length?e.map(((e,n)=>e.setValue(t[n]))).some(Boolean):(super.setValue(t.map(rm)),!0)}}function rm(t){return(Ud(t)?$d:Jd).create(t)}function im(t){const e=Xd(t);return e?e.constructor:Tf.arr(t)?nm:Ud(t)?$d:Jd}function om(){return om=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},om.apply(this,arguments)}const am=(t,n)=>{const r=!Tf.fun(t)||t.prototype&&t.prototype.isReactComponent;return(0,e.forwardRef)(((i,o)=>{const a=(0,e.useRef)(null),s=r&&(0,e.useCallback)((t=>{a.current=function(t,e){return t&&(Tf.fun(t)?t(e):t.current=e),e}(o,t)}),[o]),[u,l]=function(t,e){const n=new Set;return tm.dependencies=n,t.style&&(t=om({},t,{style:e.createAnimatedStyle(t.style)})),t=new em(t),tm.dependencies=null,[t,n]}(i,n),c=Vd(),h=()=>{const t=a.current;r&&!t||!1===(!!t&&n.applyAnimatedValues(t,u.getValue(!0)))&&c()},p=new sm(h,l),f=(0,e.useRef)();Zd((()=>(f.current=p,Pf(l,(t=>Ed(t,p))),()=>{f.current&&(Pf(f.current.deps,(t=>Cd(t,f.current))),lf.cancel(f.current.update))}))),(0,e.useEffect)(h,[]),Gd((()=>()=>{const t=f.current;Pf(t.deps,(e=>Cd(e,t)))}));const d=n.getComponentProps(u.getValue());return e.createElement(t,om({},d,{ref:s}))}))};class sm{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){"change"==t.type&&lf.write(this.update)}}const um=Symbol.for("AnimatedComponent"),lm=t=>Tf.str(t)?t:t&&Tf.str(t.displayName)?t.displayName:Tf.fun(t)&&t.name||null;function cm(){return cm=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},cm.apply(this,arguments)}function hm(t,...e){return Tf.fun(t)?t(...e):t}const pm=(t,e)=>!0===t||!!(e&&t&&(Tf.fun(t)?t(e):If(t).includes(e))),fm=(t,e)=>Tf.obj(t)?e&&t[e]:t,dm=(t,e)=>!0===t.default?t[e]:t.default?t.default[e]:void 0,mm=t=>t,gm=(t,e=mm)=>{let n=ym;t.default&&!0!==t.default&&(t=t.default,n=Object.keys(t));const r={};for(const i of n){const n=e(t[i],i);Tf.und(n)||(r[i]=n)}return r},ym=["config","onProps","onStart","onChange","onPause","onResume","onRest"],vm={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function _m(t){const e=function(t){const e={};let n=0;if(Lf(t,((t,r)=>{vm[r]||(e[r]=t,n++)})),n)return e}(t);if(e){const n={to:e};return Lf(t,((t,r)=>r in e||(n[r]=t))),n}return cm({},t)}function xm(t){return t=_d(t),Tf.arr(t)?t.map(xm):Ud(t)?jf.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function bm(t){for(const e in t)return!0;return!1}function wm(t){return Tf.fun(t)||Tf.arr(t)&&Tf.obj(t[0])}function Sm(t,e){var n;null==(n=t.ref)||n.delete(t),null==e||e.delete(t)}function Em(t,e){var n;e&&t.ref!==e&&(null==(n=t.ref)||n.delete(t),e.add(t),t.ref=e)}const Cm=1.70158,Mm=1.525*Cm,Tm=Cm+1,Am=2*Math.PI/3,Pm=2*Math.PI/4.5,Lm=t=>{const e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375},Im={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>0===t?0:Math.pow(2,10*t-10),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>Tm*t*t*t-Cm*t*t,easeOutBack:t=>1+Tm*Math.pow(t-1,3)+Cm*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*(7.189819*t-Mm)/2:(Math.pow(2*t-2,2)*((Mm+1)*(2*t-2)+Mm)+2)/2,easeInElastic:t=>0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*Am),easeOutElastic:t=>0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*Am)+1,easeInOutElastic:t=>0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*Pm)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*Pm)/2+1,easeInBounce:t=>1-Lm(1-t),easeOutBounce:Lm,easeInOutBounce:t=>t<.5?(1-Lm(1-2*t))/2:(1+Lm(2*t-1))/2},km=cm({},{tension:170,friction:26},{mass:1,damping:1,easing:Im.linear,clamp:!1});class Om{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,km)}}function Rm(t,e){if(Tf.und(e.decay)){const n=!Tf.und(e.tension)||!Tf.und(e.friction);!n&&Tf.und(e.frequency)&&Tf.und(e.damping)&&Tf.und(e.mass)||(t.duration=void 0,t.decay=void 0),n&&(t.frequency=void 0)}else t.duration=void 0}const Dm=[];class Nm{constructor(){this.changed=!1,this.values=Dm,this.toValues=null,this.fromValues=Dm,this.to=void 0,this.from=void 0,this.config=new Om,this.immediate=!1}}function Fm(t,{key:e,props:n,defaultProps:r,state:i,actions:o}){return new Promise(((a,s)=>{var u;let l,c,h=pm(null!=(u=n.cancel)?u:null==r?void 0:r.cancel,e);if(h)d();else{Tf.und(n.pause)||(i.paused=pm(n.pause,e));let t=null==r?void 0:r.pause;!0!==t&&(t=i.paused||pm(t,e)),l=hm(n.delay||0,e),t?(i.resumeQueue.add(f),o.pause()):(o.resume(),f())}function p(){i.resumeQueue.add(f),i.timeouts.delete(c),c.cancel(),l=c.time-lf.now()}function f(){l>0&&!jf.skipAnimation?(i.delayed=!0,c=lf.setTimeout(d,l),i.pauseQueue.add(p),i.timeouts.add(c)):d()}function d(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(p),i.timeouts.delete(c),t<=(i.cancelId||0)&&(h=!0);try{o.start(cm({},n,{callId:t,cancel:h}),a)}catch(t){s(t)}}}))}const zm=(t,e)=>1==e.length?e[0]:e.some((t=>t.cancelled))?Um(t.get()):e.every((t=>t.noop))?Bm(t.get()):jm(t.get(),e.every((t=>t.finished))),Bm=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),jm=(t,e,n=!1)=>({value:t,finished:e,cancelled:n}),Um=t=>({value:t,cancelled:!0,finished:!1});function Zm(t,e,n,r){const{callId:i,parentId:o,onRest:a}=e,{asyncTo:s,promise:u}=n;return o||t!==s||e.reset?n.promise=(async()=>{n.asyncId=i,n.asyncTo=t;const l=gm(e,((t,e)=>"onRest"===e?void 0:t));let c,h;const p=new Promise(((t,e)=>(c=t,h=e))),f=t=>{const e=i<=(n.cancelId||0)&&Um(r)||i!==n.asyncId&&jm(r,!1);if(e)throw t.result=e,h(t),t},d=(t,e)=>{const o=new Gm,a=new Hm;return(async()=>{if(jf.skipAnimation)throw Vm(n),a.result=jm(r,!1),h(a),a;f(o);const s=Tf.obj(t)?cm({},t):cm({},e,{to:t});s.parentId=i,Lf(l,((t,e)=>{Tf.und(s[e])&&(s[e]=t)}));const u=await r.start(s);return f(o),n.paused&&await new Promise((t=>{n.resumeQueue.add(t)})),u})()};let m;if(jf.skipAnimation)return Vm(n),jm(r,!1);try{let e;e=Tf.arr(t)?(async t=>{for(const e of t)await d(e)})(t):Promise.resolve(t(d,r.stop.bind(r))),await Promise.all([e.then(c),p]),m=jm(r.get(),!0,!1)}catch(t){if(t instanceof Gm)m=t.result;else{if(!(t instanceof Hm))throw t;m=t.result}}finally{i==n.asyncId&&(n.asyncId=o,n.asyncTo=o?s:void 0,n.promise=o?u:void 0)}return Tf.fun(a)&&lf.batchedUpdates((()=>{a(m,r,r.item)})),m})():u}function Vm(t,e){kf(t.timeouts,(t=>t.cancel())),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}class Gm extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class Hm extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}const Wm=t=>t instanceof Xm;let qm=1;class Xm extends wd{constructor(...t){super(...t),this.id=qm++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=Xd(this);return t&&t.getValue()}to(...t){return jf.to(this,t)}interpolate(...t){return Bd(`${Fd}The "interpolate" function is deprecated in v9 (use "to" instead)`),jf.to(this,t)}toJSON(){return this.get()}observerAdded(t){1==t&&this._attach()}observerRemoved(t){0==t&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){bd(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||Hf.sort(this),bd(this,{type:"priority",parent:this,priority:t})}}const Ym=Symbol.for("SpringPhase"),Km=t=>(1&t[Ym])>0,Qm=t=>(2&t[Ym])>0,Jm=t=>(4&t[Ym])>0,$m=(t,e)=>e?t[Ym]|=3:t[Ym]&=-3,tg=(t,e)=>e?t[Ym]|=4:t[Ym]&=-5;class eg extends Xm{constructor(t,e){if(super(),this.key=void 0,this.animation=new Nm,this.queue=void 0,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!Tf.und(t)||!Tf.und(e)){const n=Tf.obj(t)?cm({},t):cm({},e,{from:t});Tf.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(Qm(this)||this._state.asyncTo)||Jm(this)}get goal(){return _d(this.animation.to)}get velocity(){const t=Xd(this);return t instanceof Jd?t.lastVelocity||0:t.getPayload().map((t=>t.lastVelocity||0))}get hasAnimated(){return Km(this)}get isAnimating(){return Qm(this)}get isPaused(){return Jm(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,n=!1;const r=this.animation;let{config:i,toValues:o}=r;const a=Kd(r.to);!a&&vd(r.to)&&(o=If(_d(r.to))),r.values.forEach(((s,u)=>{if(s.done)return;const l=s.constructor==$d?1:a?a[u].lastPosition:o[u];let c=r.immediate,h=l;if(!c){if(h=s.lastPosition,i.tension<=0)return void(s.done=!0);let e=s.elapsedTime+=t;const n=r.fromValues[u],o=null!=s.v0?s.v0:s.v0=Tf.arr(i.velocity)?i.velocity[u]:i.velocity;let a;const p=i.precision||(n==l?.005:Math.min(1,.001*Math.abs(l-n)));if(Tf.und(i.duration))if(i.decay){const t=!0===i.decay?.998:i.decay,r=Math.exp(-(1-t)*e);h=n+o/(1-t)*(1-r),c=Math.abs(s.lastPosition-h)<=p,a=o*r}else{a=null==s.lastVelocity?o:s.lastVelocity;const e=i.restVelocity||p/10,r=i.clamp?0:i.bounce,u=!Tf.und(r),f=n==l?s.v0>0:n<l;let d,m=!1;const g=1,y=Math.ceil(t/g);for(let t=0;t<y&&(d=Math.abs(a)>e,d||(c=Math.abs(l-h)<=p,!c));++t)u&&(m=h==l||h>l==f,m&&(a=-a*r,h=l)),a+=(1e-6*-i.tension*(h-l)+.001*-i.friction*a)/i.mass*g,h+=a*g}else{let r=1;i.duration>0&&(this._memoizedDuration!==i.duration&&(this._memoizedDuration=i.duration,s.durationProgress>0&&(s.elapsedTime=i.duration*s.durationProgress,e=s.elapsedTime+=t)),r=(i.progress||0)+e/this._memoizedDuration,r=r>1?1:r<0?0:r,s.durationProgress=r),h=n+i.easing(r)*(l-n),a=(h-s.lastPosition)/t,c=1==r}s.lastVelocity=a,Number.isNaN(h)&&(console.warn("Got NaN while animating:",this),c=!0)}a&&!a[u].done&&(c=!1),c?s.done=!0:e=!1,s.setValue(h,i.round)&&(n=!0)}));const s=Xd(this),u=s.getValue();if(e){const t=_d(r.to);u===t&&!n||i.decay?n&&i.decay&&this._onChange(u):(s.setValue(t),this._onChange(t)),this._stop()}else n&&this._onChange(u)}set(t){return lf.batchedUpdates((()=>{this._stop(),this._focus(t),this._set(t)})),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Qm(this)){const{to:t,config:e}=this.animation;lf.batchedUpdates((()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()}))}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let n;return Tf.und(t)?(n=this.queue||[],this.queue=[]):n=[Tf.obj(t)?t:cm({},e,{to:t})],Promise.all(n.map((t=>this._update(t)))).then((t=>zm(this,t)))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),Vm(this._state,t&&this._lastCallId),lf.batchedUpdates((()=>this._stop(e,t))),this}reset(){this._update({reset:!0})}eventObserved(t){"change"==t.type?this._start():"priority"==t.type&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:n,from:r}=t;n=Tf.obj(n)?n[e]:n,(null==n||wm(n))&&(n=void 0),r=Tf.obj(r)?r[e]:r,null==r&&(r=void 0);const i={to:n,from:r};return Km(this)||(t.reverse&&([n,r]=[r,n]),r=_d(r),Tf.und(r)?Xd(this)||this._set(n):this._set(r)),i}_update(t,e){let n=cm({},t);const{key:r,defaultProps:i}=this;n.default&&Object.assign(i,gm(n,((t,e)=>/^on/.test(e)?fm(t,r):t))),ug(this,n,"onProps"),lg(this,"onProps",n,this);const o=this._prepareNode(n);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const a=this._state;return Fm(++this._lastCallId,{key:r,props:n,defaultProps:i,state:a,actions:{pause:()=>{Jm(this)||(tg(this,!0),Of(a.pauseQueue),lg(this,"onPause",jm(this,ng(this,this.animation.to)),this))},resume:()=>{Jm(this)&&(tg(this,!1),Qm(this)&&this._resume(),Of(a.resumeQueue),lg(this,"onResume",jm(this,ng(this,this.animation.to)),this))},start:this._merge.bind(this,o)}}).then((t=>{if(n.loop&&t.finished&&(!e||!t.noop)){const t=rg(n);if(t)return this._update(t,!0)}return t}))}_merge(t,e,n){if(e.cancel)return this.stop(!0),n(Um(this));const r=!Tf.und(t.to),i=!Tf.und(t.from);if(r||i){if(!(e.callId>this._lastToId))return n(Um(this));this._lastToId=e.callId}const{key:o,defaultProps:a,animation:s}=this,{to:u,from:l}=s;let{to:c=u,from:h=l}=t;!i||r||e.default&&!Tf.und(c)||(c=h),e.reverse&&([c,h]=[h,c]);const p=!Af(h,l);p&&(s.from=h),h=_d(h);const f=!Af(c,u);f&&this._focus(c);const d=wm(e.to),{config:m}=s,{decay:g,velocity:y}=m;(r||i)&&(m.velocity=0),e.config&&!d&&function(t,e,n){n&&(Rm(n=cm({},n),e),e=cm({},n,e)),Rm(t,e),Object.assign(t,e);for(const e in km)null==t[e]&&(t[e]=km[e]);let{mass:r,frequency:i,damping:o}=t;Tf.und(i)||(i<.01&&(i=.01),o<0&&(o=0),t.tension=Math.pow(2*Math.PI/i,2)*r,t.friction=4*Math.PI*o*r/i)}(m,hm(e.config,o),e.config!==a.config?hm(a.config,o):void 0);let v=Xd(this);if(!v||Tf.und(c))return n(jm(this,!0));const _=Tf.und(e.reset)?i&&!e.default:!Tf.und(h)&&pm(e.reset,o),x=_?h:this.get(),b=xm(c),w=Tf.num(b)||Tf.arr(b)||Ud(b),S=!d&&(!w||pm(a.immediate||e.immediate,o));if(f){const t=im(c);if(t!==v.constructor){if(!S)throw Error(`Cannot animate between ${v.constructor.name} and ${t.name}, as the "to" prop suggests`);v=this._set(b)}}const E=v.constructor;let C=vd(c),M=!1;if(!C){const t=_||!Km(this)&&p;(f||t)&&(M=Af(xm(x),b),C=!M),(Af(s.immediate,S)||S)&&Af(m.decay,g)&&Af(m.velocity,y)||(C=!0)}if(M&&Qm(this)&&(s.changed&&!_?C=!0:C||this._stop(u)),!d&&((C||vd(u))&&(s.values=v.getPayload(),s.toValues=vd(c)?null:E==$d?[1]:If(b)),s.immediate!=S&&(s.immediate=S,S||_||this._set(u)),C)){const{onRest:t}=s;Pf(sg,(t=>ug(this,e,t)));const r=jm(this,ng(this,u));Of(this._pendingCalls,r),this._pendingCalls.add(n),s.changed&&lf.batchedUpdates((()=>{s.changed=!_,null==t||t(r,this),_?hm(a.onRest,r):null==s.onStart||s.onStart(r,this)}))}_&&this._set(x),d?n(Zm(e.to,e,this._state,this)):C?this._start():Qm(this)&&!f?this._pendingCalls.add(n):n(Bm(x))}_focus(t){const e=this.animation;t!==e.to&&(xd(this)&&this._detach(),e.to=t,xd(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;vd(e)&&(Ed(e,this),Wm(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;vd(t)&&Cd(t,this)}_set(t,e=!0){const n=_d(t);if(!Tf.und(n)){const t=Xd(this);if(!t||!Af(n,t.getValue())){const r=im(n);t&&t.constructor==r?t.setValue(n):Yd(this,r.create(n)),t&&lf.batchedUpdates((()=>{this._onChange(n,e)}))}}return Xd(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,lg(this,"onStart",jm(this,ng(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),hm(this.animation.onChange,t,this)),hm(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;Xd(this).reset(_d(t.to)),t.immediate||(t.fromValues=t.values.map((t=>t.lastPosition))),Qm(this)||($m(this,!0),Jm(this)||this._resume())}_resume(){jf.skipAnimation?this.finish():Hf.start(this)}_stop(t,e){if(Qm(this)){$m(this,!1);const n=this.animation;Pf(n.values,(t=>{t.done=!0})),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),bd(this,{type:"idle",parent:this});const r=e?Um(this.get()):jm(this.get(),ng(this,null!=t?t:n.to));Of(this._pendingCalls,r),n.changed&&(n.changed=!1,lg(this,"onRest",r,this))}}}function ng(t,e){const n=xm(e);return Af(xm(t.get()),n)}function rg(t,e=t.loop,n=t.to){let r=hm(e);if(r){const i=!0!==r&&_m(r),o=(i||t).reverse,a=!i||i.reset;return ig(cm({},t,{loop:e,default:!1,pause:void 0,to:!o||wm(n)?n:void 0,from:a?t.from:void 0,reset:a},i))}}function ig(t){const{to:e,from:n}=t=_m(t),r=new Set;return Tf.obj(e)&&ag(e,r),Tf.obj(n)&&ag(n,r),t.keys=r.size?Array.from(r):null,t}function og(t){const e=ig(t);return Tf.und(e.default)&&(e.default=gm(e)),e}function ag(t,e){Lf(t,((t,n)=>null!=t&&e.add(n)))}const sg=["onStart","onRest","onChange","onPause","onResume"];function ug(t,e,n){t.animation[n]=e[n]!==dm(e,n)?fm(e[n],t.key):void 0}function lg(t,e,...n){var r,i,o,a;null==(r=(i=t.animation)[e])||r.call(i,...n),null==(o=(a=t.defaultProps)[e])||o.call(a,...n)}const cg=["onStart","onChange","onRest"];let hg=1;class pg{constructor(t,e){this.id=hg++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),e&&(this._flush=e),t&&this.start(cm({default:!0},t))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every((t=>t.idle&&!t.isDelayed&&!t.isPaused))}get item(){return this._item}set item(t){this._item=t}get(){const t={};return this.each(((e,n)=>t[n]=e.get())),t}set(t){for(const e in t){const n=t[e];Tf.und(n)||this.springs[e].set(n)}}update(t){return t&&this.queue.push(ig(t)),this}start(t){let{queue:e}=this;return t?e=If(t).map(ig):this.queue=[],this._flush?this._flush(this,e):(_g(this,e),fg(this,e))}stop(t,e){if(t!==!!t&&(e=t),e){const n=this.springs;Pf(If(e),(e=>n[e].stop(!!t)))}else Vm(this._state,this._lastAsyncId),this.each((e=>e.stop(!!t)));return this}pause(t){if(Tf.und(t))this.start({pause:!0});else{const e=this.springs;Pf(If(t),(t=>e[t].pause()))}return this}resume(t){if(Tf.und(t))this.start({pause:!1});else{const e=this.springs;Pf(If(t),(t=>e[t].resume()))}return this}each(t){Lf(this.springs,t)}_onFrame(){const{onStart:t,onChange:e,onRest:n}=this._events,r=this._active.size>0,i=this._changed.size>0;(r&&!this._started||i&&!this._started)&&(this._started=!0,kf(t,(([t,e])=>{e.value=this.get(),t(e,this,this._item)})));const o=!r&&this._started,a=i||o&&n.size?this.get():null;i&&e.size&&kf(e,(([t,e])=>{e.value=a,t(e,this,this._item)})),o&&(this._started=!1,kf(n,(([t,e])=>{e.value=a,t(e,this,this._item)})))}eventObserved(t){if("change"==t.type)this._changed.add(t.parent),t.idle||this._active.add(t.parent);else{if("idle"!=t.type)return;this._active.delete(t.parent)}lf.onFrame(this._onFrame)}}function fg(t,e){return Promise.all(e.map((e=>dg(t,e)))).then((e=>zm(t,e)))}async function dg(t,e,n){const{keys:r,to:i,from:o,loop:a,onRest:s,onResolve:u}=e,l=Tf.obj(e.default)&&e.default;a&&(e.loop=!1),!1===i&&(e.to=null),!1===o&&(e.from=null);const c=Tf.arr(i)||Tf.fun(i)?i:void 0;c?(e.to=void 0,e.onRest=void 0,l&&(l.onRest=void 0)):Pf(cg,(n=>{const r=e[n];if(Tf.fun(r)){const i=t._events[n];e[n]=({finished:t,cancelled:e})=>{const n=i.get(r);n?(t||(n.finished=!1),e&&(n.cancelled=!0)):i.set(r,{value:null,finished:t||!1,cancelled:e||!1})},l&&(l[n]=e[n])}}));const h=t._state;e.pause===!h.paused?(h.paused=e.pause,Of(e.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(e.pause=!0);const p=(r||Object.keys(t.springs)).map((n=>t.springs[n].start(e))),f=!0===e.cancel||!0===dm(e,"cancel");(c||f&&h.asyncId)&&p.push(Fm(++t._lastAsyncId,{props:e,state:h,actions:{pause:Mf,resume:Mf,start(e,n){f?(Vm(h,t._lastAsyncId),n(Um(t))):(e.onRest=s,n(Zm(c,e,h,t)))}}})),h.paused&&await new Promise((t=>{h.resumeQueue.add(t)}));const d=zm(t,await Promise.all(p));if(a&&d.finished&&(!n||!d.noop)){const n=rg(e,a,i);if(n)return _g(t,[n]),dg(t,n,!0)}return u&&lf.batchedUpdates((()=>u(d,t,t.item))),d}function mg(t,e){const n=cm({},t.springs);return e&&Pf(If(e),(t=>{Tf.und(t.keys)&&(t=ig(t)),Tf.obj(t.to)||(t=cm({},t,{to:void 0})),vg(n,t,(t=>yg(t)))})),gg(t,n),n}function gg(t,e){Lf(e,((e,n)=>{t.springs[n]||(t.springs[n]=e,Ed(e,t))}))}function yg(t,e){const n=new eg;return n.key=t,e&&Ed(n,e),n}function vg(t,e,n){e.keys&&Pf(e.keys,(r=>{(t[r]||(t[r]=n(r)))._prepareNode(e)}))}function _g(t,e){Pf(e,(e=>{vg(t.springs,e,(e=>yg(e,t)))}))}const xg=["children"],bg=t=>{let{children:n}=t,r=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,xg);const i=(0,e.useContext)(wg),o=r.pause||!!i.pause,a=r.immediate||!!i.immediate;r=function(t,n){const[r]=(0,e.useState)((()=>({inputs:n,result:t()}))),i=(0,e.useRef)(),o=i.current;let a=o;return a?Boolean(n&&a.inputs&&function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(n,a.inputs))||(a={inputs:n,result:t()}):a=r,(0,e.useEffect)((()=>{i.current=a,o==r&&(r.inputs=r.result=void 0)}),[a]),a.result}((()=>({pause:o,immediate:a})),[o,a]);const{Provider:s}=wg;return e.createElement(s,{value:r},n)},wg=(Sg=bg,Eg={},Object.assign(Sg,e.createContext(Eg)),Sg.Provider._context=Sg,Sg.Consumer._context=Sg,Sg);var Sg,Eg;bg.Provider=wg.Provider,bg.Consumer=wg.Consumer;const Cg=()=>{const t=[],e=function(e){jd(`${Fd}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`);const r=[];return Pf(t,((t,i)=>{if(Tf.und(e))r.push(t.start());else{const o=n(e,t,i);o&&r.push(t.start(o))}})),r};e.current=t,e.add=function(e){t.includes(e)||t.push(e)},e.delete=function(e){const n=t.indexOf(e);~n&&t.splice(n,1)},e.pause=function(){return Pf(t,(t=>t.pause(...arguments))),this},e.resume=function(){return Pf(t,(t=>t.resume(...arguments))),this},e.set=function(e){Pf(t,(t=>t.set(e)))},e.start=function(e){const n=[];return Pf(t,((t,r)=>{if(Tf.und(e))n.push(t.start());else{const i=this._getProps(e,t,r);i&&n.push(t.start(i))}})),n},e.stop=function(){return Pf(t,(t=>t.stop(...arguments))),this},e.update=function(e){return Pf(t,((t,n)=>t.update(this._getProps(e,t,n)))),this};const n=function(t,e,n){return Tf.fun(t)?t(n,e):t};return e._getProps=n,e};function Mg(t,n,r){const i=Tf.fun(n)&&n;i&&!r&&(r=[]);const o=(0,e.useMemo)((()=>i||3==arguments.length?Cg():void 0),[]),a=(0,e.useRef)(0),s=Vd(),u=(0,e.useMemo)((()=>({ctrls:[],queue:[],flush(t,e){const n=mg(t,e);return a.current>0&&!u.queue.length&&!Object.keys(n).some((e=>!t.springs[e]))?fg(t,e):new Promise((r=>{gg(t,n),u.queue.push((()=>{r(fg(t,e))})),s()}))}})),[]),l=(0,e.useRef)([...u.ctrls]),c=[],h=Wd(t)||0;function p(t,e){for(let r=t;r<e;r++){const t=l.current[r]||(l.current[r]=new pg(null,u.flush)),e=i?i(r,t):n[r];e&&(c[r]=og(e))}}(0,e.useMemo)((()=>{Pf(l.current.slice(t,h),(t=>{Sm(t,o),t.stop(!0)})),l.current.length=t,p(h,t)}),[t]),(0,e.useMemo)((()=>{p(0,Math.min(h,t))}),r);const f=l.current.map(((t,e)=>mg(t,c[e]))),d=(0,e.useContext)(bg),m=Wd(d),g=d!==m&&bm(d);Zd((()=>{a.current++,u.ctrls=l.current;const{queue:t}=u;t.length&&(u.queue=[],Pf(t,(t=>t()))),Pf(l.current,((t,e)=>{null==o||o.add(t),g&&t.start({default:d});const n=c[e];n&&(Em(t,n.ref),t.ref?t.queue.push(n):t.start(n))}))})),Gd((()=>()=>{Pf(u.ctrls,(t=>t.stop(!0)))}));const y=f.map((t=>cm({},t)));return o?[y,o]:y}let Tg;!function(t){t.MOUNT="mount",t.ENTER="enter",t.UPDATE="update",t.LEAVE="leave"}(Tg||(Tg={}));class Ag extends Xm{constructor(t,e){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=t,this.calc=dd(...e);const n=this._get(),r=im(n);Yd(this,r.create(n))}advance(t){const e=this._get();Af(e,this.get())||(Xd(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&Lg(this._active)&&Ig(this)}_get(){const t=Tf.arr(this.source)?this.source.map(_d):If(_d(this.source));return this.calc(...t)}_start(){this.idle&&!Lg(this._active)&&(this.idle=!1,Pf(Kd(this),(t=>{t.done=!1})),jf.skipAnimation?(lf.batchedUpdates((()=>this.advance())),Ig(this)):Hf.start(this))}_attach(){let t=1;Pf(If(this.source),(e=>{vd(e)&&Ed(e,this),Wm(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))})),this.priority=t,this._start()}_detach(){Pf(If(this.source),(t=>{vd(t)&&Cd(t,this)})),this._active.clear(),Ig(this)}eventObserved(t){"change"==t.type?t.idle?this.advance():(this._active.add(t.parent),this._start()):"idle"==t.type?this._active.delete(t.parent):"priority"==t.type&&(this.priority=If(this.source).reduce(((t,e)=>Math.max(t,(Wm(e)?e.priority:0)+1)),0))}}function Pg(t){return!1!==t.idle}function Lg(t){return!t.size||Array.from(t).every(Pg)}function Ig(t){t.idle||(t.idle=!0,Pf(Kd(t),(t=>{t.done=!0})),bd(t,{type:"idle",parent:t}))}function kg(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}jf.assign({createStringInterpolator:Nd,to:(t,e)=>new Ag(t,e)}),Hf.advance;const Og=["style","children","scrollTop","scrollLeft"],Rg=/^--/;function Dg(t,e){return null==e||"boolean"==typeof e||""===e?"":"number"!=typeof e||0===e||Rg.test(t)||Fg.hasOwnProperty(t)&&Fg[t]?(""+e).trim():e+"px"}const Ng={};let Fg={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};const zg=["Webkit","Ms","Moz","O"];Fg=Object.keys(Fg).reduce(((t,e)=>(zg.forEach((n=>t[((t,e)=>t+e.charAt(0).toUpperCase()+e.substring(1))(n,e)]=t[e])),t)),Fg);const Bg=["x","y","z"],jg=/^(matrix|translate|scale|rotate|skew)/,Ug=/^(translate)/,Zg=/^(rotate|skew)/,Vg=(t,e)=>Tf.num(t)&&0!==t?t+e:t,Gg=(t,e)=>Tf.arr(t)?t.every((t=>Gg(t,e))):Tf.num(t)?t===e:parseFloat(t)===e;class Hg extends em{constructor(t){let{x:e,y:n,z:r}=t,i=kg(t,Bg);const o=[],a=[];(e||n||r)&&(o.push([e||0,n||0,r||0]),a.push((t=>[`translate3d(${t.map((t=>Vg(t,"px"))).join(",")})`,Gg(t,0)]))),Lf(i,((t,e)=>{if("transform"===e)o.push([t||""]),a.push((t=>[t,""===t]));else if(jg.test(e)){if(delete i[e],Tf.und(t))return;const n=Ug.test(e)?"px":Zg.test(e)?"deg":"";o.push(If(t)),a.push("rotate3d"===e?([t,e,r,i])=>[`rotate3d(${t},${e},${r},${Vg(i,n)})`,Gg(i,0)]:t=>[`${e}(${t.map((t=>Vg(t,n))).join(",")})`,Gg(t,e.startsWith("scale")?1:0)])}})),o.length&&(i.transform=new Wg(o,a)),super(i)}}class Wg extends wd{constructor(t,e){super(),this._value=null,this.inputs=t,this.transforms=e}get(){return this._value||(this._value=this._get())}_get(){let t="",e=!0;return Pf(this.inputs,((n,r)=>{const i=_d(n[0]),[o,a]=this.transforms[r](Tf.arr(i)?i:n.map(_d));t+=" "+o,e=e&&a})),e?"none":t}observerAdded(t){1==t&&Pf(this.inputs,(t=>Pf(t,(t=>vd(t)&&Ed(t,this)))))}observerRemoved(t){0==t&&Pf(this.inputs,(t=>Pf(t,(t=>vd(t)&&Cd(t,this)))))}eventObserved(t){"change"==t.type&&(this._value=null),bd(this,t)}}const qg=["scrollTop","scrollLeft"];jf.assign({batchedUpdates:af.unstable_batchedUpdates,createStringInterpolator:Nd,colors:{transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199}});const Xg=((t,{applyAnimatedValues:e=(()=>!1),createAnimatedStyle:n=(t=>new em(t)),getComponentProps:r=(t=>t)}={})=>{const i={applyAnimatedValues:e,createAnimatedStyle:n,getComponentProps:r},o=t=>{const e=lm(t)||"Anonymous";return(t=Tf.str(t)?o[t]||(o[t]=am(t,i)):t[um]||(t[um]=am(t,i))).displayName=`Animated(${e})`,t};return Lf(t,((e,n)=>{Tf.arr(t)&&(n=lm(e)),o[n]=o(e)})),{animated:o}})(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],{applyAnimatedValues:function(t,e){if(!t.nodeType||!t.setAttribute)return!1;const n="filter"===t.nodeName||t.parentNode&&"filter"===t.parentNode.nodeName,r=e,{style:i,children:o,scrollTop:a,scrollLeft:s}=r,u=kg(r,Og),l=Object.values(u),c=Object.keys(u).map((e=>n||t.hasAttribute(e)?e:Ng[e]||(Ng[e]=e.replace(/([A-Z])/g,(t=>"-"+t.toLowerCase())))));void 0!==o&&(t.textContent=o);for(let e in i)if(i.hasOwnProperty(e)){const n=Dg(e,i[e]);Rg.test(e)?t.style.setProperty(e,n):t.style[e]=n}c.forEach(((e,n)=>{t.setAttribute(e,l[n])})),void 0!==a&&(t.scrollTop=a),void 0!==s&&(t.scrollLeft=s)},createAnimatedStyle:t=>new Hg(t),getComponentProps:t=>kg(t,qg)}),Yg=Xg.animated;const Kg=n=>{const{toggle:r,maxSize:i="100%",minSize:o="20%",placement:a="RB",offset:s=[8,8]}=n,u=function(t,e){const n=Tf.fun(t),[[r],i]=Mg(1,n?t:[t],n?e||[]:e);return n||2==arguments.length?[r,i]:r}({from:{size:i,background:"hotpink"},to:{size:r?o:i,background:r?"#ddd":"hotpink"}}),{size:l,background:c}=u,h=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(u,["size","background"]),p=t.utils.getPositionStyles(a,s);return e.createElement(Yg.div,{style:Object.assign(Object.assign(Object.assign({},p),{width:l,height:l,position:"absolute",zIndex:9,boxShadow:r?"0 0 10px rgba(0,0,0,0.5)":"none"}),h)},n.children)},Qg={zIndex:999,background:"#fff",marginBlockEnd:"0px"},Jg=t=>{const{children:e,style:r={},direction:i="horizontal"}=t,o="horizontal"===i,a={position:"absolute"};return o?(a.right=0,a.top=0):(a.left=0,a.bottom=0),n().createElement("div",{style:Object.assign(Object.assign(Object.assign({},Qg),a),r),className:"graphin-components-toolbar"},n().createElement("ul",{className:"graphin-components-toolbar-content",style:{display:o?"flex":"",marginBlockEnd:"0px"}},e))},$g=e=>{const n=e.components.find((t=>"Toolbar"===t.id))||{id:"Toolbar",props:{direction:"horizontal",placement:"LT",offset:[10,10]}},{direction:r,placement:i,offset:o}=n.props;return{direction:r,positionStyles:t.utils.getPositionStyles(i,o)}},{GIAComponent:ty,deepClone:ey}=t.extra,ny=t=>{const{GIAC:n,config:r,handleSwitchMap:i,handleToggleMap:o}=t,a=e.useMemo((()=>{const t=ey(n);return t.icon="icon-fullscreen",t.title="小窗",t.tooltipPlacement="right",t}),[n]),{direction:s,positionStyles:u}=$g(r);return e.createElement("div",null,e.createElement(Jg,{direction:s,style:u},e.createElement(ty,{GIAC:n,onClick:i}),e.createElement(ty,{GIAC:a,onClick:o})))},{deepClone:ry}=t.extra,iy=n=>{const{updateContext:r,source:i,largeGraphData:o,largeGraphLimit:a,data:s,GISDK_ID:u,apis:l,config:c,transform:h}=(0,t.useContext)(),{GIAC:p,handleClick:f,maxSize:d,minSize:m,placement:g,offset:y,highlightColor:v,backgroundColor:_}=n,x=e.useRef();let b=i,w=[],S=[];o&&(b=o,s.nodes.length>0&&(w=s.nodes.map((t=>t.id)),S=s.edges.map((t=>`${t.source}_${t.target}`))));const[E,C]=e.useState({toggle:!1}),{toggle:M}=E;return e.useLayoutEffect((()=>{const e=document.getElementById("gi-3d-graph"),n=e.offsetWidth,r=e.offsetHeight;console.time("cost deepclone");let i=ry(b.nodes),o=ry(b.edges);if(console.timeEnd("cost deepclone"),!t.utils.isStyles(b.nodes)){const t=h(b);i=t.nodes,o=t.edges}const a={nodes:i,links:o};try{x.current=rf()(e).width(n).height(r).graphData(a).enableNodeDrag(!1).nodeAutoColorBy("nodeType").nodeLabel((t=>(null==t?void 0:t.style.label.value)?t.style.label.value:t.id)).linkCurvature((t=>t.style&&t.style.keyshape&&t.style.keyshape.poly?.5:.1)).onNodeClick((t=>{const e=1+40/Math.hypot(t.x,t.y,t.z);x.current&&x.current.cameraPosition({x:t.x*e,y:t.y*e,z:t.z*e},t,3e3)}))}catch(t){console.log("error",t)}return()=>{x.current&&x.current._destructor()}}),[]),e.useEffect((()=>{const t=x.current;if(!t)return;const e=t=>{const e=`${t.source.id}_${t.target.id}`;return-1!==S.indexOf(e)?2:0},n=new Map;t.backgroundColor(_).linkWidth((t=>e(t))).linkDirectionalParticles((t=>e(t))).linkDirectionalParticleWidth(2).linkColor((t=>{const e=`${t.source.id}_${t.target.id}`;if(-1!==S.indexOf(e))return v;if(t.style&&t.style.keyshape){const{stroke:e}=t.style.keyshape;return e}})).nodeThreeObject((t=>{if(t.style.icon&&"image"===t.style.icon.type){const e=t.style.icon.value,n=(new Ys).load(e),r=new Co({map:n}),i=new Bo(r);return i.scale.set(24,24),i}let{size:e,fill:r}=t.style.keyshape||{size:40,fill:"#ddd"};-1!==w.indexOf(t.id)&&(r=v,e*=1.5);const i=new ds(3,e);let o=n.get(r);return o||(o=new Ss({color:r,transparent:!0,opacity:.75}),n.set(r,o)),new xn(i,o)})),t.linkDirectionalArrowLength(1.5).linkDirectionalArrowRelPos(1),(S.length>0||S.length>0)&&(t=>{t.nodeColor(t.nodeColor()).linkWidth(t.linkWidth()).linkDirectionalParticles(t.linkDirectionalParticles())})(t)}),[S,w,x,!0,v,_]),sf().createPortal(e.createElement(Kg,{toggle:M,maxSize:d,minSize:m,placement:g,offset:y},e.createElement(ny,{GIAC:p,config:c,handleSwitchMap:f,handleToggleMap:()=>{var t;t=!M,C((e=>Object.assign(Object.assign({},e),{toggle:t})))}}),e.createElement("div",{id:"gi-3d-graph",style:{position:"relative",width:"100%",height:"100%"}})),document.getElementById(`${u}-graphin-container`))},{GIAComponent:oy}=t.extra,ay={id:"LargeGraph",name:"3D大图",category:"scene-analysis",desc:"启用3D视图，可右键节点交互",icon:"icon-3d",cover:"http://xxxx.jpg",type:"GIAC"},{GIAC_METAS:sy,deepClone:uy}=t.extra,ly=uy(sy);ly.GIAC.properties.GIAC.properties.title.default=ay.name,ly.GIAC.properties.GIAC.properties.isShowTitle.default=!1,ly.GIAC.properties.GIAC.properties.icon.default=ay.icon,ly.GIAC.properties.GIAC.properties.isVertical.default=!0,ly.GIAC.properties.GIAC.properties.tooltipPlacement.default="right";const cy={info:ay,component:t=>{const n=Object.assign({},t.GIAC),{visible:r,maxSize:i,minSize:o,placement:a,offset:s,highlightColor:u,backgroundColor:l}=t,[c,h]=e.useState(r);return n.title=c?"切换至2D":"切换至3D",e.createElement(e.Fragment,null,e.createElement(oy,{GIAC:n,onClick:()=>{h(!0)}}),c&&e.createElement(iy,{backgroundColor:l,highlightColor:u,minSize:o,maxSize:i,placement:a,offset:s,GIAC:n,handleClick:()=>{h(!1)}}))},registerMeta:()=>Object.assign({visible:{title:"默认显示",type:"string","x-decorator":"FormItem","x-component":"Switch",default:!1},backgroundColor:{title:"背景颜色",type:"string","x-decorator":"FormItem","x-component":"ColorInput",default:"#fff"},highlightColor:{title:"高亮颜色",type:"string","x-decorator":"FormItem","x-component":"ColorInput",default:"red"},minSize:{type:"string",title:"最小尺寸","x-decorator":"FormItem","x-component":"Input",default:"20%"},maxSize:{type:"string",title:"最大尺寸","x-decorator":"FormItem","x-component":"Input",default:"100%"},placement:{title:"放置方位",type:"string",default:"RB","x-decorator":"FormItem","x-component":"Select","x-component-props":{options:[{value:"LT",label:"左上 / top"},{value:"RT",label:"右上 / right"},{value:"LB",label:"左下 / left"},{value:"RB",label:"右下 / bottom"}]}},offset:{title:"偏移距离",type:"string","x-decorator":"FormItem","x-component":"Offset","x-component-props":{min:0,max:400},default:[0,0]}},ly)};s(4793),s(4534);var hy=s(137),py=s(5803),fy=s(9470),dy=s(3959),my=s(2923),gy=s.n(my);function yy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var vy=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"getInstance",value:function(){return this.instance||(this.instance=new this),this.instance}}],null&&yy(e.prototype,null),n&&yy(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function _y(t){return _y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_y(t)}function xy(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function by(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wy(t,e){return wy=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},wy(t,e)}function Sy(t,e){if(e&&("object"===_y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ey(t){return Ey=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ey(t)}vy.instance=void 0;var Cy=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wy(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ey(r);if(i){var n=Ey(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Sy(this,t)});function a(){var t;xy(this,a);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).styleVariant="line",t}return e=a,(n=[{key:"execute",value:function(t,e){var n=e[this.styleVariant],r=new hy.LineLayer({pickingBuffer:3}).source(t).shape("line").color(n.color).size(n.size).style(n.style);return r.zIndex=n.zIndex,[r]}}])&&by(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(vy);function My(t){return My="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},My(t)}function Ty(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ay(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Py(t,e){return Py=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Py(t,e)}function Ly(t,e){if(e&&("object"===My(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Iy(t){return Iy=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Iy(t)}var ky=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Py(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Iy(r);if(i){var n=Iy(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Ly(this,t)});function a(){var t;Ty(this,a);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).styleVariant="point",t}return e=a,(n=[{key:"execute",value:function(t,e){var n,r,i=e[this.styleVariant];if(null===(n=t.features[0])||void 0===n||null===(r=n.properties)||void 0===r?void 0:r.value)return[];var o=new hy.PointLayer({zIndex:2,pickingBuffer:3}).source(t).shape("circle").color(i.color).size(i.size).style(i.style);return o.zIndex=i.zIndex,[o]}}])&&Ay(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(vy);function Oy(t){return Oy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oy(t)}function Ry(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Dy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ny(t,e){return Ny=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ny(t,e)}function Fy(t,e){if(e&&("object"===Oy(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function zy(t){return zy=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},zy(t)}var By=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ny(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=zy(r);if(i){var n=zy(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Fy(this,t)});function a(){var t;Ry(this,a);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).styleVariant="polygon",t}return e=a,(n=[{key:"execute",value:function(t,e){var n=e[this.styleVariant],r=(new hy.PolygonLayer).source(t).shape("fill").color(n.color).size(n.size).style({opacity:n.style.opacity});n.active&&r.active(n.active);var i=(new hy.PolygonLayer).source(t).shape("line").color(n.style.stroke).size(n.style.strokeWidth).style({opacity:n.style.strokeOpacity,lineType:n.style.lineType,dashArray:n.style.dashArray});return n.active&&i.active(n.active),r.zIndex=i.zIndex=n.zIndex,[r,i]}}])&&Dy(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(vy);function jy(t){return jy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jy(t)}function Uy(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vy(t,e){return Vy=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Vy(t,e)}function Gy(t,e){if(e&&("object"===jy(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Hy(t){return Hy=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Hy(t)}var Wy=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vy(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Hy(r);if(i){var n=Hy(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Gy(this,t)});function a(){var t;Uy(this,a);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).styleVariant="point",t}return e=a,(n=[{key:"execute",value:function(t,e){var n,r,i=e[this.styleVariant];if(!(null===(n=t.features[0])||void 0===n||null===(r=n.properties)||void 0===r?void 0:r.value))return[];var o=new hy.PointLayer({zIndex:2,pickingBuffer:3}).source(t).style(i.style).shape("value","text").size(14).color(i.color);return o.zIndex=i.zIndex,[o]}}])&&Zy(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(vy);function qy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Xy=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.strategyMap=void 0,this.strategyMap={}}var e,n,r;return e=t,r=[{key:"defaultRenderer",value:function(){var e=new t;return e.setStrategy(ky.getInstance(),"Point"),e.setStrategy(Wy.getInstance(),"Point"),e.setStrategy(By.getInstance(),"Polygon"),e.setStrategy(Cy.getInstance(),"LineString"),e}}],(n=[{key:"setStrategy",value:function(t,e){var n=this.strategyMap[e];this.strategyMap[e]=(n||[]).concat(t)}},{key:"renderFeature",value:function(t,e){var n,r,i=null===(n=t.features[0])||void 0===n||null===(r=n.geometry)||void 0===r?void 0:r.type,o=(this.strategyMap[i]||[]).map((function(n){return n.execute(t,e)}));return gy()(o)}}])&&qy(e.prototype,n),r&&qy(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Yy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ky=Xy.defaultRenderer(),Qy=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.drawLayers=[],this.draw=void 0,this.isEnableDrag=void 0,this.isEnableEdit=void 0,this.styleVariant="normal",this.draw=e}var e,n;return e=t,(n=[{key:"update",value:function(t){this.removeLayers(),this.drawLayers=Ky.renderFeature(t,this.draw.getStyle(this.styleVariant)),this.addLayers()}},{key:"on",value:function(t,e){this.drawLayers[0].on(t,e)}},{key:"off",value:function(t,e){this.drawLayers[0].off(t,e)}},{key:"emit",value:function(t,e){this.drawLayers[0].emit(t,e)}},{key:"updateData",value:function(t){0===this.drawLayers.length&&this.update(t),this.drawLayers.forEach((function(e){return e.setData(t)}))}},{key:"destroy",value:function(){this.removeLayers()}},{key:"removeLayers",value:function(){var t=this;0!==this.drawLayers.length&&this.drawLayers.forEach((function(e){return t.draw.scene.removeLayer(e)}))}},{key:"addLayers",value:function(){var t=this;this.drawLayers.forEach((function(e){return t.draw.scene.addLayer(e)}))}},{key:"show",value:function(){this.drawLayers.forEach((function(t){return t.show()}))}},{key:"hide",value:function(){this.drawLayers.forEach((function(t){return t.hide()}))}}])&&Yy(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Jy=function(t){return"LineString"===t.geometry.type},$y=function(t){return"Polygon"===t.geometry.type},tv=s(601);var ev=s(8912),nv=6378137;function rv(t){var e=0;if(t&&t.length>0){e+=Math.abs(iv(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(iv(t[n]))}return e}function iv(t){var e,n,r,i,o,a,s=0,u=t.length;if(u>2){for(a=0;a<u;a++)a===u-2?(r=u-2,i=u-1,o=0):a===u-1?(r=u-1,i=0,o=1):(r=a,i=a+1,o=a+2),e=t[r],n=t[i],s+=(ov(t[o][0])-ov(e[0]))*Math.sin(ov(n[1]));s=s*nv*nv/2}return s}function ov(t){return t*Math.PI/180}var av=function(t,e){return function(t,e,n){void 0===n&&(n={});var r=(0,tv.c9)(t),i=(0,tv.c9)(e),o=(0,dy.Ht)(i[1]-r[1]),a=(0,dy.Ht)(i[0]-r[0]),s=(0,dy.Ht)(r[1]),u=(0,dy.Ht)(i[1]),l=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(u);return(0,dy.DL)(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n.units)}(t,e,{units:"kilometers"}).toFixed(2)+"km"},sv=function(t){return(e=t,(0,ev.mm)(e,(function(t,e){return t+function(t){var e,n=0;switch(t.type){case"Polygon":return rv(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)n+=rv(t.coordinates[e]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)}),0)/1e6).toFixed(2)+"km²";var e};function uv(t){return uv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uv(t)}function lv(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function hv(t,e,n){return e&&cv(t.prototype,e),n&&cv(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function pv(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fv(t,e)}function fv(t,e){return fv=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},fv(t,e)}function dv(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=gv(t);if(e){var i=gv(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return mv(this,n)}}function mv(t,e){if(e&&("object"===uv(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function gv(t){return gv=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},gv(t)}var yv,vv,_v,xv,bv,wv=new Xy,Sv=function(t){pv(n,t);var e=dv(n);function n(){var t;lv(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).styleVariant="polygon",t}return hv(n,[{key:"execute",value:function(t,e){var n=e[this.styleVariant],r=(new hy.PolygonLayer).source(t).shape("fill").color(n.color).style({opacity:n.style.opacity}).active(n.active);r.zIndex=n.zIndex;var i=t.features[0],o=[];if($y(i)){var a=i.geometry.coordinates[0];o=(0,dy.uf)(a.map((function(t,e){if(a[e+1])return(0,dy.Tu)([t,a[e+1]])})).filter(Boolean))}var s=e.line,u=new hy.LineLayer({pickingBuffer:3}).source(o).color(s.style.stroke).size(s.style.strokeWidth).style({opacity:s.style.strokeOpacity,lineType:s.style.lineType,dashArray:s.style.dashArray}).active(s.active);return u.zIndex=s.zIndex,u.setBlend("max"),[r,u]}}]),n}(vy),Ev=function(t){pv(n,t);var e=dv(n);function n(){var t;lv(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).styleVariant="line",t}return hv(n,[{key:"execute",value:function(t,e){var n=e[this.styleVariant],r=t.features[0],i=[];if(Jy(r)){var o=r.geometry.coordinates;i=(0,dy.uf)(o.map((function(t,e){if(o[e+1])return(0,dy.Tu)([t,o[e+1]])})).filter(Boolean))}var a=new hy.LineLayer({pickingBuffer:5}).source(i).color(n.style.stroke).size(n.style.strokeWidth).style({opacity:n.style.strokeOpacity,lineType:n.style.lineType,dashArray:n.style.dashArray}).active(n.active);return a.zIndex=n.zIndex,a.setBlend("max"),[a]}}]),n}(vy);function Cv(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Mv(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Cv(Object(n),!0).forEach((function(e){Tv(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Cv(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Tv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Av(t,e,n){var r=Math.min(t[0],e[0]),i=Math.min(t[1],e[1]),o=Math.max(t[0],e[0]),a=Math.max(t[1],e[1]);return{type:"Feature",properties:Mv({type:"rect",active:!0,startPoint:{lng:t[0],lat:t[1]},endPoint:{lng:e[0],lat:e[1]}},n),geometry:{type:"Polygon",coordinates:[[[r,i],[r,a],[o,a],[o,i],[r,i]]]}}}function Pv(t){return Pv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pv(t)}function Lv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Iv(t,e){return Iv=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Iv(t,e)}function kv(t,e){if(e&&("object"===Pv(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ov(t)}function Ov(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Rv(t){return Rv=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Rv(t)}wv.setStrategy(Sv.getInstance(),"Polygon"),wv.setStrategy(Ev.getInstance(),"LineString"),(bv=yv||(yv={})).CREATE="draw.create",bv.DELETE="draw.delete",bv.Move="draw.move",bv.Edit="draw.edit",bv.UPDATE="draw.update",bv.CHANGE="draw.change",bv.SELECTION_CHANGE="draw.selectionchange",bv.MODE_CHANGE="draw.modechange",bv.ACTIONABLE="draw.actionable",bv.RENDER="draw.render",bv.COMBINE_FEATURES="draw.combine",bv.UNCOMBINE_FEATURES="draw.uncombine",bv.ADD_POINT="draw.addpoint",bv.MEASURE="draw.measure",bv.MULTI_SELECT="draw.multiselect",bv.BOX_SELECT="draw.boxselect",bv.ENABLE="draw.enable",bv.DISABLE="draw.disable",(xv=vv||(vv={})).DRAW_Circle="draw_circle",xv.DRAW_Rect="draw_rect",xv.DRAW_LINE_STRING="draw_line_string",xv.DRAW_POLYGON="draw_polygon",xv.DRAW_POINT="draw_point",xv.SIMPLE_SELECT="simple_select",xv.DIRECT_SELECT="direct_select",xv.STATIC="static",xv.RULER="ruler",function(t){t.FEATURE="Feature",t.POLYGON="Polygon",t.LINE_STRING="LineString",t.POINT="Point",t.FEATURE_COLLECTION="FeatureCollection",t.MULTI_PREFIX="Multi",t.MULTI_POINT="MultiPoint",t.MULTI_LINE_STRING="MultiLineString",t.MULTI_POLYGON="MultiPolygon"}(_v||(_v={}));var Dv=Xy.defaultRenderer(),Nv=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Iv(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Rv(r);if(i){var n=Rv(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return kv(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,t)).styleVariant="normal",(0,fy.bindAll)(["onDeleteClick","onClick"],Ov(e)),e}return e=a,(n=[{key:"update",value:function(t){if(this.drawLayers.length>0)this.updateData(t);else{this.removeLayers();var e=this.draw.getStyle(this.styleVariant);this.drawLayers=Dv.renderFeature(t,e),this.addFilter(),this.addLayers()}}},{key:"enableSelect",value:function(){if(!this.isEnableDrag&&this.draw.selectEnable){var t=this.drawLayers[0];t&&(t.on("click",this.onClick),this.isEnableDrag=!0)}}},{key:"disableSelect",value:function(){this.isEnableDrag&&(this.drawLayers[0].off("click",this.onClick),this.isEnableDrag=!1)}},{key:"enableDelete",value:function(){this.disableSelect(),this.drawLayers[0].on("click",this.onDeleteClick)}},{key:"disableDelete",value:function(){this.drawLayers[0].off("click",this.onDeleteClick)}},{key:"addFilter",value:function(){this.drawLayers.forEach((function(t){return t.filter("active",(function(t){return!t}))}))}},{key:"onClick",value:function(t){this.draw.getDrawable()&&(this.draw.source.setFeatureUnActive(this.draw.getCurrentFeature()),this.draw.setCurrentFeature(t.feature),this.draw.source.setFeatureActive(t.feature),this.updateData(this.draw.source.data),this.draw.emit(yv.MODE_CHANGE,vv.SIMPLE_SELECT))}},{key:"onDeleteClick",value:function(t){this.draw.source.removeFeature(t.feature),this.updateData(this.draw.source.data)}}])&&Lv(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Qy);function Fv(t){return Fv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fv(t)}function zv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Bv(t,e){return Bv=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Bv(t,e)}function jv(t,e){if(e&&("object"===Fv(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Uv(t)}function Uv(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Zv(t){return Zv=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Zv(t)}var Vv=Xy.defaultRenderer(),Gv=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bv(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Zv(r);if(i){var n=Zv(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return jv(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,t)).styleVariant="active",(0,fy.bindAll)(["onMouseMove","onUnMouseMove","onClick","onUnClick"],Uv(e)),e}return e=a,(n=[{key:"update",value:function(t){this.removeLayers();var e=this.draw.getStyle(this.styleVariant);this.drawLayers=Vv.renderFeature(t,e),this.addLayers()}},{key:"enableSelect",value:function(){if(this.show(),!this.isEnableDrag){var t=this.drawLayers[0];t.on("mouseenter",this.onMouseMove),t.on("mouseout",this.onUnMouseMove),this.draw.editEnable&&t.on("click",this.onClick),t.on("unclick",this.onUnClick),this.isEnableDrag=!0}}},{key:"disableSelect",value:function(){if(this.isEnableDrag){var t=this.drawLayers[0];t.off("mouseenter",this.onMouseMove),t.off("mouseout",this.onUnMouseMove),t.off("click",this.onClick),t.off("unclick",this.onUnClick),this.isEnableDrag=!1}}},{key:"enableEdit",value:function(){this.isEnableEdit||(this.drawLayers[0].on("unclick",this.onUnClick),this.isEnableDrag=!0)}},{key:"disableEdit",value:function(){this.isEnableEdit&&(this.drawLayers[0].off("unclick",this.onUnClick),this.isEnableDrag=!1)}},{key:"onMouseMove",value:function(t){this.draw.setCursor("move"),this.draw.selectMode.enable(),this.draw.measureMode.enable()}},{key:"onUnMouseMove",value:function(t){this.draw.resetCursor(),this.draw.selectMode.disable()}},{key:"onClick",value:function(t){this.draw.getDrawable()&&(this.draw.selectMode.disable(),this.draw.editMode.enable(),this.disableSelect(),this.draw.resetCursor(),this.enableEdit(),this.draw.setCurrentFeature(t.feature),this.draw.emit(yv.MODE_CHANGE,vv.DIRECT_SELECT))}},{key:"onUnClick",value:function(t){this.draw.selectMode.disable(),this.draw.editMode.disable(),this.draw.source.setFeatureUnActive(this.draw.getCurrentFeature()),this.disableSelect(),this.disableEdit(),this.hide(),this.draw.emit(yv.MODE_CHANGE,vv.STATIC)}}])&&zv(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Qy);function Hv(t){return Hv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hv(t)}function Wv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qv(t,e){return qv=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},qv(t,e)}function Xv(t,e){if(e&&("object"===Hv(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Yv(t)}function Yv(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Kv(t){return Kv=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Kv(t)}var Qv=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qv(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Kv(r);if(i){var n=Kv(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Xv(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,t)).styleVariant="active",(0,fy.bindAll)(["onMouseEnter","onMouseOut","onClick"],Yv(e)),e}return e=a,(n=[{key:"enableSelect",value:function(){}},{key:"disableSelect",value:function(){}},{key:"enableEdit",value:function(){if(!this.isEnableEdit){var t=this.drawLayers[0];t.on("mouseenter",this.onMouseEnter),t.on("mouseout",this.onMouseOut),t.on("click",this.onClick),this.isEnableEdit=!0}}},{key:"disableEdit",value:function(){if(this.isEnableEdit){var t=this.drawLayers[0];t.off("mouseenter",this.onMouseEnter),t.off("mouseout",this.onMouseOut),t.off("click",this.onClick),this.isEnableEdit=!1}}},{key:"onMouseEnter",value:function(t){this.draw.setCursor("move"),this.draw.setCurrentVertex(t.feature),this.draw.editMode.enable()}},{key:"onMouseOut",value:function(t){this.draw.resetCursor(),this.draw.editMode.disable()}},{key:"onClick",value:function(t){this.draw.getDrawable()&&(this.draw.setCurrentVertex(t.feature),this.draw.editMode.enable())}}])&&Wv(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Qy),Jv=6371008.8,$v={meters:Jv,metres:Jv,millimeters:6371008800,millimetres:6371008800,centimeters:637100880,centimetres:637100880,kilometers:6371.0088,kilometres:6371.0088,miles:3958.761333810546,nauticalmiles:3440.069546436285,inches:250826616.45599997,yards:5825721.287490856,feet:20902260.511392,radians:1,degrees:57.22891354143274};function t_(t,e,n){if(!i_(n=n||{}))throw new Error("options is invalid");var r=n.bbox,i=n.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");r&&function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!r_(t))throw new Error("bbox must only contain numbers")}))}(r),i&&function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}(i);var o={type:"Feature"};return i&&(o.id=i),r&&(o.bbox=r),o.properties=e||{},o.geometry=t,o}function e_(t){if(null==t)throw new Error("radians is required");return t%(2*Math.PI)*180/Math.PI}function n_(t){if(null==t)throw new Error("degrees is required");return t%360*Math.PI/180}function r_(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function i_(t){return!!t&&t.constructor===Object}function o_(t){if(!t)throw new Error("coord is required");if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates;if(Array.isArray(t)&&t.length>=2&&void 0===t[0].length&&void 0===t[1].length)return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}const a_=function t(e,n,r){if(!i_(r=r||{}))throw new Error("options is invalid");if(!0===r.final)return function(e,n){var r=t(n,e);return(r+180)%360}(e,n);var i=o_(e),o=o_(n),a=n_(i[0]),s=n_(o[0]),u=n_(i[1]),l=n_(o[1]),c=Math.sin(s-a)*Math.cos(l),h=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-a);return e_(Math.atan2(c,h))},s_=function(t,e,n,r){if(!i_(r=r||{}))throw new Error("options is invalid");var i=r.units,o=r.properties,a=o_(t),s=n_(a[0]),u=n_(a[1]),l=n_(n),c=function(t,e){if(null==t)throw new Error("distance is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var n=$v[e||"kilometers"];if(!n)throw new Error(e+" units is invalid");return t/n}(e,i),h=Math.asin(Math.sin(u)*Math.cos(c)+Math.cos(u)*Math.sin(c)*Math.cos(l));return function(t,e,n){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!r_(t[0])||!r_(t[1]))throw new Error("coordinates must contain numbers");return t_({type:"Point",coordinates:t},e,n)}([e_(s+Math.atan2(Math.sin(l)*Math.sin(c)*Math.cos(u),Math.cos(c)-Math.sin(u)*Math.sin(h))),e_(h)],o)},u_=function(t,e,n){if(!i_(n=n||{}))throw new Error("options is invalid");var r=n.units,i=o_(t),o=o_(e),a=n_(o[1]-i[1]),s=n_(o[0]-i[0]),u=n_(i[1]),l=n_(o[1]),c=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return function(t,e){if(null==t)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var n=$v[e||"kilometers"];if(!n)throw new Error(e+" units is invalid");return t*n}(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),r)};function l_(t){return l_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l_(t)}function c_(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h_(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f_(t,e){return f_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},f_(t,e)}function d_(t,e){if(e&&("object"===l_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function m_(t){return m_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},m_(t)}var g_=Xy.defaultRenderer(),y_=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f_(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=m_(r);if(i){var n=m_(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return d_(this,t)});function a(){var t;h_(this,a);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).showLine=!0,t}return e=a,n=[{key:"update",value:function(t){if(!t.features.every(Jy))throw new Error("All features must be LineString in order to calculate distance.");this.removeLayers();var e,n,r=t.features.map((function(t){var e,n,r,i,o,a,s=null==t||null===(e=t.geometry)||void 0===e?void 0:e.coordinates[0],u=null==t||null===(n=t.geometry)||void 0===n?void 0:n.coordinates[1],l=av(s,u),c=(o=u_(r=s,i=u),a=a_(r,i),s_(r,o/2,a));return c.properties.value=l,c})),i=this.draw.getStyle("active");this.drawLayers=g_.renderFeature((0,dy.uf)(r),i),this.showLine&&(e=this.drawLayers).push.apply(e,function(t){if(Array.isArray(t))return c_(t)}(n=g_.renderFeature(t,i))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return c_(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c_(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),this.addLayers()}}],n&&p_(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Qy),v_=s(8304);const __=function(t,e){void 0===e&&(e={});var n=0,r=0,i=0;return(0,ev.pZ)(t,(function(t){n+=t[0],r+=t[1],i++}),!0),(0,dy.xm)([n/i,r/i],e.properties)},x_=function t(e,n){switch(void 0===n&&(n={}),(0,tv.oL)(e)){case"Point":return(0,dy.xm)((0,tv.c9)(e),n.properties);case"Polygon":var r=[];(0,ev.pZ)(e,(function(t){r.push(t)}));var i,o,a,s,u,l,c,h,p=__(e,{properties:n.properties}),f=p.geometry.coordinates,d=0,m=0,g=0,y=r.map((function(t){return[t[0]-f[0],t[1]-f[1]]}));for(i=0;i<r.length-1;i++)s=(o=y[i])[0],l=o[1],u=(a=y[i+1])[0],g+=h=s*(c=a[1])-u*l,d+=(s+u)*h,m+=(l+c)*h;if(0===g)return p;var v=1/(.5*g*6);return(0,dy.xm)([f[0]+v*d,f[1]+v*m],n.properties);default:var _=function(t,e){void 0===e&&(e={}),e.concavity=e.concavity||1/0;var n=[];if((0,ev.pZ)(t,(function(t){n.push([t[0],t[1]])})),!n.length)return null;var r=v_(n,e.concavity);return r.length>3?(0,dy.yu)([r]):null}(e);return _?t(_,{properties:n.properties}):__(e,{properties:n.properties})}};function b_(t){return b_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b_(t)}function w_(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function S_(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function C_(t,e){return C_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},C_(t,e)}function M_(t,e){if(e&&("object"===b_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function T_(t){return T_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},T_(t)}var A_=Xy.defaultRenderer(),P_=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&C_(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=T_(r);if(i){var n=T_(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return M_(this,t)});function a(){var t;S_(this,a);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).showArea=!0,t}return e=a,(n=[{key:"update",value:function(t){if(!t.features.every($y))throw new Error("All features must be LineString in order to calculate distance.");this.removeLayers();var e,n,r=t.features.map((function(t){return x_(t,{properties:{value:sv(t.geometry)}})})),i=this.draw.getStyle("active");this.drawLayers=A_.renderFeature((0,dy.uf)(r),i),this.showArea&&(e=this.drawLayers).push.apply(e,function(t){if(Array.isArray(t))return w_(t)}(n=A_.renderFeature(t,i))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return w_(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w_(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),this.addLayers()}}])&&E_(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Qy),L_=s(1883),I_=s(8469),k_=s.n(I_),O_=s(2576),R_=s.n(O_),D_=s(7179),N_=s.n(D_);function F_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var z_=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=void 0,this.initData=void 0,"FeatureCollection"!==(null==e?void 0:e.type)?(e&&(this.initData=e),this.data=this.getDefaultData()):this.data=R_()(e||this.getDefaultData(),!0)}var e,n;return e=t,n=[{key:"addFeature",value:function(t){this.data.features.push(t)}},{key:"getData",value:function(){return{type:"FeatureCollection",features:N_()(this.data.features)}}},{key:"getFeature",value:function(t){var e;return null===(e=this.data)||void 0===e?void 0:e.features.find((function(e){var n;return(null==e||null===(n=e.properties)||void 0===n?void 0:n.id)===t}))}},{key:"removeAllFeatures",value:function(){this.data=this.getDefaultData()}},{key:"removeFeature",value:function(t){var e=this.getFeatureIndex(t);void 0!==e&&this.data.features.splice(e,1)}},{key:"setFeatureActive",value:function(t){var e,n=this.getFeature(null==t||null===(e=t.properties)||void 0===e?void 0:e.id);n&&n.properties&&(n.properties.active=!0)}},{key:"setFeatureUnActive",value:function(t){var e,n=this.getFeature(null==t||null===(e=t.properties)||void 0===e?void 0:e.id);n&&n.properties&&(n.properties.active=!1)}},{key:"clearFeatureActive",value:function(){this.data.features.forEach((function(t){t&&t.properties&&(t.properties.active=!1)}))}},{key:"updateFeature",value:function(t){this.removeFeature(t),this.addFeature(t)}},{key:"destroy",value:function(){this.data=this.getDefaultData()}},{key:"getDefaultData",value:function(){return{type:"FeatureCollection",features:[]}}},{key:"getFeatureIndex",value:function(t){return this.data.features.findIndex((function(e){var n,r;return(null==e||null===(n=e.properties)||void 0===n?void 0:n.id)===(null==t||null===(r=t.properties)||void 0===r?void 0:r.id)}))}}],n&&F_(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();const B_={boxSelect:{polygon:{shape:"fill",color:"#black",style:{stroke:"black",strokeWidth:1,strokeOpacity:1,lineType:"dash",dashArray:[1,1]},zIndex:0}},active:{point:{type:"PointLayer",shape:"circle",color:"#fbb03b",size:5,style:{stroke:"#fff",strokeWidth:2},zIndex:0},line:{type:"LineLayer",shape:"line",color:"#fbb03b",size:1,style:{opacity:1,lineType:"dash",dashArray:[2,2]},zIndex:0},polygon:{shape:"fill",color:"#fbb03b",style:{opacity:.1,stroke:"#fbb03b",strokeWidth:1,strokeOpacity:1,lineType:"dash",dashArray:[2,2]},zIndex:0}},normal:{polygon:{type:"PolygonLayer",shape:"fill",color:"#3bb2d0",style:{opacity:.1,stroke:"#3bb2d0",strokeWidth:1,strokeOpacity:1,lineType:"solid",dashArray:[2,2]},zIndex:0},line:{type:"LineLayer",shape:"line",size:1,color:"#3bb2d0",style:{opacity:1},zIndex:0},point:{type:"PointLayer",shape:"circle",color:"#3bb2d0",size:3,style:{stroke:"#fff",strokeWidth:2},zIndex:0}},normal_point:{type:"PointLayer",shape:"circle",color:"#3bb2d0",size:3,style:{stroke:"#fff",strokeWidth:2},zIndex:0},mid_point:{point:{type:"PointLayer",shape:"circle",color:"#fbb03b",size:3,style:{},zIndex:0}},ruler:{polygon:{type:"PolygonLayer",shape:"fill",active:{color:"#FB93FF"},color:"#883BF2",style:{opacity:.1,stroke:"#883BF2",strokeWidth:1,strokeOpacity:1,lineType:"solid",dashArray:[2,2]},zIndex:0},line:{type:"LineLayer",shape:"line",size:1,color:"#883BF2",active:{color:"#FB93FF"},style:{stroke:"#883BF2",strokeWidth:1,strokeOpacity:1,lineType:"solid"},zIndex:0},point:{type:"PointLayer",shape:"circle",color:"#883BF2",size:3,style:{stroke:"#fff",strokeWidth:2},zIndex:0}}};function j_(t){return j_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j_(t)}function U_(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function V_(t,e){return V_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},V_(t,e)}function G_(t,e){if(e&&("object"===j_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return H_(t)}function H_(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function W_(t){return W_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},W_(t)}var q_=0;const X_=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&V_(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=W_(r);if(i){var n=W_(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return G_(this,t)});function a(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};U_(this,a),(e=o.call(this)).source=void 0,e.scene=void 0,e.type=void 0,e.title=void 0,e.isEnable=!1,e.options={style:B_},e.drawStatus="Drawing",e.currentFeature=void 0,e.currentVertex=void 0,e.popup=void 0,e.drawMode=void 0,e.drawable=!0;var r=n.data;return e.scene=t,e.source=new z_(r),e.options=k_()(e.options,e.getDefaultOptions(),n),e.title=e.getOption("title"),(0,fy.bindAll)(["onDragStart","onDragging","onDragEnd","onClick","onCheckDrawable"],H_(e)),e}return e=a,(n=[{key:"getDrawMode",value:function(){return this.drawMode}},{key:"enable",value:function(){this.scene.setMapStatus({dragEnable:!1}),this.isEnable||(this.drawStatus="Drawing",this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.scene.on("click",this.onClick),this.scene.on("mousemove",this.onCheckDrawable),this.setCursor(this.getOption("cursor")),this.isEnable=!0,this.emit(yv.ENABLE,this))}},{key:"resetDraw",value:function(){}},{key:"disable",value:function(){this.isEnable&&(this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.scene.off("click",this.onClick),this.scene.off("mousemove",this.onCheckDrawable),this.resetCursor(),this.scene.setMapStatus({dragEnable:!0}),this.isEnable=!1,this.drawStatus="DrawFinish",this.emit(yv.DISABLE,this))}},{key:"onCheckDrawable",value:function(t){var e=t.lnglat,n=this.getOption("checkDrawable");n&&"Drawing"===this.drawStatus&&(n(e,this)?(this.setCursor(this.getOption("cursor")),this.drawable=!0):(this.setCursor("not-allowed"),this.drawable=!1))}},{key:"setCurrentFeature",value:function(t){this.currentFeature=t,this.source.setFeatureActive(t)}},{key:"setCurrentVertex",value:function(t){this.currentVertex=t}},{key:"deleteCurrentFeature",value:function(){throw new Error("子类未实现该方法")}},{key:"getCurrentVertex",value:function(){return this.currentVertex}},{key:"getCurrentFeature",value:function(){return this.currentFeature}},{key:"getOption",value:function(t){return this.options[t]}},{key:"setOption",value:function(t,e){return this.options[t]=e}},{key:"getStyle",value:function(t){return this.getOption("style")[t]}},{key:"getUniqId",value:function(){return q_++}},{key:"setCursor",value:function(t){var e=this.scene.getMapCanvasContainer();if(e){var n,r,i=null!==(n=this.getOption("rewriteCursor"))&&void 0!==n?n:{};e.style.cursor=null!==(r=i[t])&&void 0!==r?r:t}}},{key:"resetCursor",value:function(){var t=this.scene.getMapCanvasContainer();t&&t.removeAttribute("style")}},{key:"getCursor",value:function(){var t,e=this.scene.getMapCanvasContainer();if(e)return null!==(t=e.style.cursor)&&void 0!==t?t:""}},{key:"destroy",value:function(){q_=0,this.removeAllListeners(),this.disable()}},{key:"getDrawable",value:function(){return this.drawable}},{key:"setDrawMode",value:function(t){this.drawMode=t}},{key:"getDefaultOptions",value:function(){return{}}},{key:"onClick",value:function(t){return null}}])&&Z_(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(L_.EventEmitter);function Y_(t){return Y_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y_(t)}function K_(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Q_(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?K_(Object(n),!0).forEach((function(e){J_(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):K_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function J_(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $_(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ex(){return ex="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=nx(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},ex.apply(this,arguments)}function nx(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ox(t)););return t}function rx(t,e){return rx=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},rx(t,e)}function ix(t,e){if(e&&("object"===Y_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ox(t){return ox=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ox(t)}var ax=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rx(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ox(r);if(i){var n=ox(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return ix(this,t)});function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $_(this,a),o.call(this,t,e)}return e=a,(n=[{key:"enable",value:function(){this.emit(yv.DELETE,"")}},{key:"disable",value:function(){return null}},{key:"getDefaultOptions",value:function(){return Q_(Q_({},ex(ox(a.prototype),"getDefaultOptions",this).call(this)),{},{title:"删除图形"})}},{key:"onDragStart",value:function(t){throw new Error("Method not implemented.")}},{key:"onDragging",value:function(t){}},{key:"onDragEnd",value:function(){throw new Error("Method not implemented.")}},{key:"onClick",value:function(){return null}}])&&tx(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(X_);function sx(t){return sx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sx(t)}function ux(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function cx(t,e){return cx=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},cx(t,e)}function hx(t,e){if(e&&("object"===sx(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function px(t){return px=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},px(t)}var fx=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cx(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=px(r);if(i){var n=px(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return hx(this,t)});function a(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ux(this,a),(e=o.call(this,t,n)).endPoint=void 0,e.onDragStart=function(t){},e.onDragging=function(t){e.endPoint=t.lngLat,e.emit(yv.Edit,e.endPoint)},e.onDragEnd=function(){e.emit(yv.UPDATE,e.currentFeature),e.resetCursor(),e.disable()},e.onClick=function(){return null},e}return e=a,(n=[{key:"setEditFeature",value:function(t){this.currentFeature=t}},{key:"getDefaultOptions",value:function(){return{steps:64,units:"kilometers",cursor:"move"}}}])&&lx(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(X_);function dx(t){return dx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dx(t)}function mx(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function yx(t,e){return yx=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},yx(t,e)}function vx(t,e){if(e&&("object"===dx(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _x(t){return _x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},_x(t)}var xx=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yx(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_x(r);if(i){var n=_x(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return vx(this,t)});function a(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return mx(this,a),(e=o.call(this,t,n)).center=void 0,e.dragStartPoint=void 0,e}return e=a,(n=[{key:"setSelectedFeature",value:function(t){this.currentFeature=t}},{key:"onDragStart",value:function(t){this.scene.setMapStatus({dragEnable:!1}),this.dragStartPoint=t.lngLat}},{key:"getDefaultOptions",value:function(){return{steps:64,units:"kilometers",cursor:"move"}}},{key:"onDragging",value:function(t){var e={lng:t.lngLat.lng-this.dragStartPoint.lng,lat:t.lngLat.lat-this.dragStartPoint.lat};this.emit(yv.Move,e),this.dragStartPoint=t.lngLat}},{key:"onDragEnd",value:function(){this.emit(yv.UPDATE,this.currentFeature)}},{key:"onClick",value:function(){return null}}])&&gx(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(X_);function bx(t){return bx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bx(t)}function wx(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ex(t,e){return Ex=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ex(t,e)}function Cx(t,e){if(e&&("object"===bx(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Mx(t){return Mx=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Mx(t)}var Tx=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ex(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Mx(r);if(i){var n=Mx(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Cx(this,t)});function a(){return wx(this,a),o.apply(this,arguments)}return e=a,(n=[{key:"update",value:function(t){}},{key:"on",value:function(t,e){}},{key:"off",value:function(t,e){}},{key:"emit",value:function(t,e){}},{key:"updateData",value:function(t){}},{key:"destroy",value:function(){}},{key:"removeLayers",value:function(){}},{key:"addLayers",value:function(){}},{key:"show",value:function(){}},{key:"hide",value:function(){}}])&&Sx(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Qy);function Ax(t){return Ax="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ax(t)}function Px(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Lx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ix(t,e){return Ix=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ix(t,e)}function kx(t,e){if(e&&("object"===Ax(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ox(t){return Ox=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ox(t)}var Rx=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ix(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ox(r);if(i){var n=Ox(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return kx(this,t)});function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Px(this,a),o.call(this,t,e)}return e=a,(n=[{key:"setSelectedFeature",value:function(t){this.currentFeature=t,this.emit(yv.MEASURE,this.currentFeature)}},{key:"onDragStart",value:function(t){}},{key:"getDefaultOptions",value:function(){return{steps:64,units:"kilometers",cursor:"move"}}},{key:"onDragging",value:function(t){}},{key:"onDragEnd",value:function(){}},{key:"onClick",value:function(){}}])&&Lx(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(X_);function Dx(t){return Dx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dx(t)}function Nx(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Fx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function zx(t,e){return zx=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},zx(t,e)}function Bx(t,e){if(e&&("object"===Dx(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return jx(t)}function jx(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ux(t){return Ux=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ux(t)}var Zx=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zx(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ux(r);if(i){var n=Ux(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Bx(this,t)});function a(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Nx(this,a),(e=o.call(this,t,n)).selectMode=void 0,e.editMode=void 0,e.measureMode=void 0,e.deleteMode=void 0,e.editEnable=void 0,e.showDistance=void 0,e.showArea=void 0,e.dragEnable=void 0,e.selectEnable=void 0,e.normalLayer=void 0,e.drawLayer=void 0,e.drawVertexLayer=void 0,e.drawDistanceLayer=void 0,e.drawAreaLayer=void 0,e.onModeChange=function(t){var n,r,i,o;switch(e.setDrawMode(t),t){case vv.DIRECT_SELECT:if(!e.editEnable)return;e.editMode.enable(),e.editMode.setEditFeature(e.currentFeature),e.drawLayer.updateData((0,dy.uf)([e.currentFeature])),e.drawVertexLayer.updateData((0,dy.uf)(null===(n=e.currentFeature)||void 0===n||null===(r=n.properties)||void 0===r?void 0:r.pointFeatures)),e.drawVertexLayer.show(),e.drawVertexLayer.enableEdit(),e.drawDistanceLayer.show(),e.drawAreaLayer.show(),e.showOtherLayer(),e.drawStatus="DrawEdit";break;case vv.SIMPLE_SELECT:if(!e.selectEnable)return e.drawLayer.hide(),e.drawVertexLayer.hide(),e.hideOtherLayer(),void e.emit(yv.MODE_CHANGE,vv.STATIC);e.selectMode.setSelectedFeature(e.currentFeature),e.selectMode.enable(),e.measureMode.setSelectedFeature(e.currentFeature),e.measureMode.enable(),e.drawLayer.updateData((0,dy.uf)([e.currentFeature])),e.drawLayer.enableSelect(),e.drawVertexLayer.updateData((0,dy.uf)(null===(i=e.currentFeature)||void 0===i||null===(o=i.properties)||void 0===o?void 0:o.pointFeatures)),e.drawVertexLayer.disableEdit(),e.drawVertexLayer.show(),e.drawDistanceLayer.show(),e.drawAreaLayer.show(),e.drawLayer.show(),e.showOtherLayer(),e.drawStatus="DrawSelected";break;case vv.STATIC:if(!e.getOption("showFeature"))return;e.source.updateFeature(e.currentFeature),e.selectMode.disable(),e.editMode.disable(),e.measureMode.disable(),e.source.clearFeatureActive(),e.drawVertexLayer.hide(),e.drawDistanceLayer.hide(),e.drawAreaLayer.hide(),e.drawVertexLayer.disableEdit(),e.hideOtherLayer(),e.normalLayer.update(e.source.data),e.normalLayer.enableSelect(),e.drawStatus="DrawFinish"}},e.onDrawCreate=function(t){e.source.addFeature(t)},e.onDrawUpdate=function(t){e.source.updateFeature(e.currentFeature),e.emit(yv.UPDATE,e.currentFeature)},e.onDrawMove=function(t){"DrawSelected"!==e.drawStatus&&"DrawFinish"!==e.drawStatus||!e.dragEnable||e.moveFeature(t)},e.onDrawEdit=function(t){e.editFeature(t)},e.onDrawDelete=function(){"DrawSelected"===e.drawStatus&&(e.clear(),e.source.removeFeature(e.currentFeature),e.normalLayer.update(e.source.data),e.drawLayer.disableSelect(),e.selectMode.disable(),e.currentFeature=null)},e.addKeyDownEvent=function(t){var n=t||window.event;n&&8===n.keyCode&&e.deleteMode.enable(),n&&90===n.keyCode&&n.ctrlKey&&"Drawing"===e.drawStatus&&e.removeLatestVertex()},e.selectEnable=e.getOption("selectEnable"),e.editEnable=e.getOption("editEnable"),e.showDistance=e.getOption("showDistance"),e.showArea=e.getOption("showArea"),e.dragEnable=e.getOption("dragEnable"),e.drawLayer=new Gv(jx(e)),e.drawVertexLayer=new Qv(jx(e)),e.showDistance?e.drawDistanceLayer=new y_(jx(e)):e.drawDistanceLayer=new Tx(jx(e)),e.showArea?e.drawAreaLayer=new P_(jx(e)):e.drawAreaLayer=new Tx(jx(e)),e.normalLayer=new Nv(jx(e)),e.selectMode=new xx(e.scene,{}),e.editMode=new fx(e.scene,{}),e.deleteMode=new ax(e.scene,{}),e.measureMode=new Rx(e.scene,{}),e.selectMode.on(yv.UPDATE,e.onDrawUpdate),e.selectMode.on(yv.Move,e.onDrawMove),e.editMode.on(yv.MODE_CHANGE,e.onModeChange),e.editMode.on(yv.UPDATE,e.onDrawUpdate),e.editMode.on(yv.Edit,e.onDrawEdit),e.selectMode.on(yv.MODE_CHANGE,e.onModeChange),e.deleteMode.on(yv.DELETE,e.onDrawDelete),e.on(yv.CREATE,e.onDrawCreate),e.on(yv.MODE_CHANGE,e.onModeChange),document.addEventListener("keydown",e.addKeyDownEvent),e.options.data&&e.initData()&&(e.normalLayer.update(e.source.data),e.normalLayer.enableSelect()),e}return e=a,(n=[{key:"setCurrentFeature",value:function(t){this.currentFeature=t,this.pointFeatures=t.properties.pointFeatures,this.source.setFeatureActive(t)}},{key:"deleteCurrentFeature",value:function(){this.deleteMode.enable()}},{key:"disableLayer",value:function(){this.drawLayer.disableSelect()}},{key:"enableLayer",value:function(){this.drawLayer.enableSelect()}},{key:"getData",value:function(){return this.source.getData()}},{key:"resetData",value:function(t){this.source=new z_(t),this.options=k_()(this.options,this.getDefaultOptions(),{data:t}),this.initData(),this.normalLayer.update(this.source.data),this.normalLayer.enableSelect(),this.normalLayer.show()}},{key:"removeAllData",value:function(){this.resetData()}},{key:"clear",value:function(){this.drawLayer.disableSelect(),this.drawLayer.disableEdit(),this.drawLayer.hide(),this.drawVertexLayer.hide(),this.hideOtherLayer(),this.emit(yv.MODE_CHANGE,vv.STATIC)}},{key:"reset",value:function(){this.drawLayer.show(),this.drawVertexLayer.show(),this.showOtherLayer()}},{key:"addVertex",value:function(t){throw new Error("子类未实现该方法")}},{key:"onRemove",value:function(){this.destroy(),this.selectMode.destroy(),this.editMode.destroy(),this.measureMode.destroy(),this.source.destroy(),this.drawLayer.destroy(),this.drawVertexLayer.destroy(),this.normalLayer.destroy(),document.removeEventListener("keydown",this.addKeyDownEvent)}},{key:"getDefaultOptions",value:function(){return{steps:64,units:"kilometers",cursor:"crosshair",editEnable:!0,selectEnable:!0,showFeature:!0,enableCustomDraw:!0,dragEnable:!0}}},{key:"initData",value:function(){return!1}},{key:"addDrawPopup",value:function(t,e){var n=new py.Popup({anchor:"left",closeButton:!1}).setLnglat(t).setText("半径:".concat(e.toFixed(2),"千米"));this.scene.addPopup(n),this.popup=n}}])&&Fx(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(X_);function Vx(t){return Vx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vx(t)}function Gx(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Hx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Wx(t,e){return Wx=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Wx(t,e)}function qx(t,e){if(e&&("object"===Vx(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Xx(t)}function Xx(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yx(t){return Yx=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Yx(t)}Xy.defaultRenderer();var Kx=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wx(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yx(r);if(i){var n=Yx(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return qx(this,t)});function a(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Gx(this,a),(e=o.call(this,t,n)).startPoint=void 0,e.endPoint=void 0,e.drawDistanceLayer=new Tx(Xx(e)),e.drawLayer.styleVariant="boxSelect",e}return e=a,n=[{key:"drawFinish",value:function(){}},{key:"moveFeature",value:function(t){}},{key:"editFeature",value:function(t){}},{key:"hideOtherLayer",value:function(){}},{key:"removeLatestVertex",value:function(){}},{key:"showOtherLayer",value:function(){}},{key:"onDragStart",value:function(t){"Drawing"!==this.drawStatus&&this.drawLayer.emit("unclick",null),this.startPoint=t.lngLat,this.setCursor("crosshair")}},{key:"onDragging",value:function(t){this.endPoint=t.lngLat;var e=this.createFeature();this.drawLayer.update((0,dy.uf)([e]))}},{key:"onDragEnd",value:function(){this.drawLayer.update((0,dy.uf)([])),this.emit(yv.BOX_SELECT,{startPoint:this.startPoint,endPoint:this.endPoint}),this.disable()}},{key:"createFeature",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0",e=Av([this.startPoint.lng,this.startPoint.lat],[this.endPoint.lng,this.endPoint.lat],{id:t,pointFeatures:[]});return e}}],n&&Hx(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Zx),Qx=s(8532),Jx=s(2512);function $x(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var r=(0,tv.c9)(t),i=(0,tv.wA)(e),o=i.type,a=e.bbox,s=i.coordinates;if(a&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(r,a))return!1;"Polygon"===o&&(s=[s]);for(var u=!1,l=0;l<s.length&&!u;l++)if(tb(r,s[l][0],n.ignoreBoundary)){for(var c=!1,h=1;h<s[l].length&&!c;)tb(r,s[l][h],!n.ignoreBoundary)&&(c=!0),h++;c||(u=!0)}return u}function tb(t,e,n){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var a=e[i][0],s=e[i][1],u=e[o][0],l=e[o][1];if(t[1]*(a-u)+s*(u-t[0])+l*(t[0]-a)==0&&(a-t[0])*(u-t[0])<=0&&(s-t[1])*(l-t[1])<=0)return!n;s>t[1]!=l>t[1]&&t[0]<(u-a)*(t[1]-s)/(l-s)+a&&(r=!r)}return r}s(2458),Object.prototype.hasOwnProperty;var eb=new ArrayBuffer(16);new Float64Array(eb),new Uint32Array(eb),s(6690),function(){function t(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var e=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(e=0;e<this.length-1;e++){var n=this.points[e],r=this.points[e+1];this.centers.push({x:(n.x+r.x)/2,y:(n.y+r.y)/2,z:(n.z+r.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),e=0;e<this.centers.length-1;e++){var i=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,o=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,a=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+a)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+a)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}t.prototype.cacheSteps=function(t){var e=[],n=this.pos(0);e.push(0);for(var r=0;r<this.duration;r+=10){var i=this.pos(r);Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y)+(i.z-n.z)*(i.z-n.z))>t&&(e.push(r),n=i)}return e},t.prototype.vector=function(t){var e=this.pos(t+10),n=this.pos(t-10);return{angle:180*Math.atan2(e.y-n.y,e.x-n.x)/3.14,speed:Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)+(n.z-e.z)*(n.z-e.z))}},t.prototype.pos=function(t){var e=t-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var n=e/this.duration;if(n>=1)return this.points[this.length-1];var r=Math.floor((this.points.length-1)*n);return function(t,e,n,r,i){var o=function(t){var e=t*t;return[e*t,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}(t);return{x:i.x*o[0]+r.x*o[1]+n.x*o[2]+e.x*o[3],y:i.y*o[0]+r.y*o[1]+n.y*o[2]+e.y*o[3],z:i.z*o[0]+r.z*o[1]+n.z*o[2]+e.z*o[3]}}((this.length-1)*n-r,this.points[r],this.controls[r][1],this.controls[r+1][0],this.points[r+1])}}();var nb=s(5203);s(6319),s(2399);var rb=Math.PI/180,ib=180/Math.PI,ob=function(t,e){this.lon=t,this.lat=e,this.x=rb*t,this.y=rb*e};ob.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},ob.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new ob(e,t)};var ab=function(){this.coords=[],this.length=0};ab.prototype.move_to=function(t){this.length++,this.coords.push(t)};var sb=function(t){this.properties=t||{},this.geometries=[]};sb.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},sb.prototype.wkt=function(){for(var t="",e="LINESTRING(",n=function(t){e+=t[0]+" "+t[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),t+=e.substring(0,e.length-1)+")"}return t};var ub=function(t,e,n){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new ob(t.x,t.y),this.end=new ob(e.x,e.y),this.properties=n||{};var r=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};ub.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),n=Math.sin(t*this.g)/Math.sin(this.g),r=e*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+n*Math.sin(this.end.y),a=ib*Math.atan2(o,Math.sqrt(Math.pow(r,2)+Math.pow(i,2)));return[ib*Math.atan2(i,r),a]},ub.prototype.Arc=function(t,e){var n=[];if(!t||t<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(t-1),i=0;i<t;++i){var o=r*i,a=this.interpolate(o);n.push(a)}for(var s=!1,u=0,l=e&&e.offset?e.offset:10,c=180-l,h=-180+l,p=360-l,f=1;f<n.length;++f){var d=n[f-1][0],m=n[f][0],g=Math.abs(m-d);g>p&&(m>c&&d<h||d>c&&m<h)?s=!0:g>u&&(u=g)}var y=[];if(s&&u<l){var v=[];y.push(v);for(var _=0;_<n.length;++_){var x=parseFloat(n[_][0]);if(_>0&&Math.abs(x-n[_-1][0])>p){var b=parseFloat(n[_-1][0]),w=parseFloat(n[_-1][1]),S=parseFloat(n[_][0]),E=parseFloat(n[_][1]);if(b>-180&&b<h&&180===S&&_+1<n.length&&n[_-1][0]>-180&&n[_-1][0]<h){v.push([-180,n[_][1]]),_++,v.push([n[_][0],n[_][1]]);continue}if(b>c&&b<180&&-180===S&&_+1<n.length&&n[_-1][0]>c&&n[_-1][0]<180){v.push([180,n[_][1]]),_++,v.push([n[_][0],n[_][1]]);continue}if(b<h&&S>c){var C=b;b=S,S=C;var M=w;w=E,E=M}if(b>c&&S<h&&(S+=360),b<=180&&S>=180&&b<S){var T=(180-b)/(S-b),A=T*E+(1-T)*w;v.push([n[_-1][0]>c?180:-180,A]),(v=[]).push([n[_-1][0]>c?-180:180,A]),y.push(v)}else v=[],y.push(v);v.push([x,n[_][1]])}else v.push([n[_][0],n[_][1]])}}else{var P=[];y.push(P);for(var L=0;L<n.length;++L)P.push([n[L][0],n[L][1]])}for(var I=new sb(this.properties),k=0;k<y.length;++k){var O=new ab;I.geometries.push(O);for(var R=y[k],D=0;D<R.length;++D)O.move_to(R[D])}return I},s(1691),s(1374);var lb=[],cb=[],hb=[],pb=[],fb=[],db=[],mb=[],gb=[],yb=[],vb=[],_b=[],xb=[],bb=[],wb=[],Sb=[],Eb=[],Cb=[],Mb=[],Tb=[],Ab=[],Pb=[],Lb=[],Ib=[],kb=[];mb[85]=vb[85]=-1,gb[85]=_b[85]=0,yb[85]=xb[85]=1,Tb[85]=Lb[85]=1,Ab[85]=Ib[85]=0,Pb[85]=kb[85]=1,lb[85]=pb[85]=0,cb[85]=fb[85]=-1,hb[85]=Sb[85]=0,Eb[85]=bb[85]=0,Cb[85]=wb[85]=1,db[85]=Mb[85]=1,Lb[1]=Lb[169]=0,Ib[1]=Ib[169]=-1,kb[1]=kb[169]=0,bb[1]=bb[169]=-1,wb[1]=wb[169]=0,Sb[1]=Sb[169]=0,vb[4]=vb[166]=0,_b[4]=_b[166]=-1,xb[4]=xb[166]=1,Eb[4]=Eb[166]=1,Cb[4]=Cb[166]=0,Mb[4]=Mb[166]=0,mb[16]=mb[154]=0,gb[16]=gb[154]=1,yb[16]=yb[154]=1,pb[16]=pb[154]=1,fb[16]=fb[154]=0,db[16]=db[154]=1,Tb[64]=Tb[106]=0,Ab[64]=Ab[106]=1,Pb[64]=Pb[106]=0,lb[64]=lb[106]=-1,cb[64]=cb[106]=0,hb[64]=hb[106]=1,Tb[2]=Tb[168]=0,Ab[2]=Ab[168]=-1,Pb[2]=Pb[168]=1,Lb[2]=Lb[168]=0,Ib[2]=Ib[168]=-1,kb[2]=kb[168]=0,bb[2]=bb[168]=-1,wb[2]=wb[168]=0,Sb[2]=Sb[168]=0,Eb[2]=Eb[168]=-1,Cb[2]=Cb[168]=0,Mb[2]=Mb[168]=1,mb[8]=mb[162]=0,gb[8]=gb[162]=-1,yb[8]=yb[162]=0,vb[8]=vb[162]=0,_b[8]=_b[162]=-1,xb[8]=xb[162]=1,bb[8]=bb[162]=1,wb[8]=wb[162]=0,Sb[8]=Sb[162]=1,Eb[8]=Eb[162]=1,Cb[8]=Cb[162]=0,Mb[8]=Mb[162]=0,mb[32]=mb[138]=0,gb[32]=gb[138]=1,yb[32]=yb[138]=1,vb[32]=vb[138]=0,_b[32]=_b[138]=1,xb[32]=xb[138]=0,lb[32]=lb[138]=1,cb[32]=cb[138]=0,hb[32]=hb[138]=0,pb[32]=pb[138]=1,fb[32]=fb[138]=0,db[32]=db[138]=1,Lb[128]=Lb[42]=0,Ib[128]=Ib[42]=1,kb[128]=kb[42]=1,Tb[128]=Tb[42]=0,Ab[128]=Ab[42]=1,Pb[128]=Pb[42]=0,lb[128]=lb[42]=-1,cb[128]=cb[42]=0,hb[128]=hb[42]=1,pb[128]=pb[42]=-1,fb[128]=fb[42]=0,db[128]=db[42]=0,vb[5]=vb[165]=-1,_b[5]=_b[165]=0,xb[5]=xb[165]=0,Lb[5]=Lb[165]=1,Ib[5]=Ib[165]=0,kb[5]=kb[165]=0,Eb[20]=Eb[150]=0,Cb[20]=Cb[150]=1,Mb[20]=Mb[150]=1,pb[20]=pb[150]=0,fb[20]=fb[150]=-1,db[20]=db[150]=1,mb[80]=mb[90]=-1,gb[80]=gb[90]=0,yb[80]=yb[90]=1,Tb[80]=Tb[90]=1,Ab[80]=Ab[90]=0,Pb[80]=Pb[90]=1,bb[65]=bb[105]=0,wb[65]=wb[105]=1,Sb[65]=Sb[105]=0,lb[65]=lb[105]=0,cb[65]=cb[105]=-1,hb[65]=hb[105]=0,mb[160]=mb[10]=-1,gb[160]=gb[10]=0,yb[160]=yb[10]=1,vb[160]=vb[10]=-1,_b[160]=_b[10]=0,xb[160]=xb[10]=0,Lb[160]=Lb[10]=1,Ib[160]=Ib[10]=0,kb[160]=kb[10]=0,Tb[160]=Tb[10]=1,Ab[160]=Ab[10]=0,Pb[160]=Pb[10]=1,Eb[130]=Eb[40]=0,Cb[130]=Cb[40]=1,Mb[130]=Mb[40]=1,bb[130]=bb[40]=0,wb[130]=wb[40]=1,Sb[130]=Sb[40]=0,lb[130]=lb[40]=0,cb[130]=cb[40]=-1,hb[130]=hb[40]=0,pb[130]=pb[40]=0,fb[130]=fb[40]=-1,db[130]=db[40]=1,vb[37]=vb[133]=0,_b[37]=_b[133]=1,xb[37]=xb[133]=1,Lb[37]=Lb[133]=0,Ib[37]=Ib[133]=1,kb[37]=kb[133]=0,lb[37]=lb[133]=-1,cb[37]=cb[133]=0,hb[37]=hb[133]=0,pb[37]=pb[133]=1,fb[37]=fb[133]=0,db[37]=db[133]=0,Eb[148]=Eb[22]=-1,Cb[148]=Cb[22]=0,Mb[148]=Mb[22]=0,Lb[148]=Lb[22]=0,Ib[148]=Ib[22]=-1,kb[148]=kb[22]=1,Tb[148]=Tb[22]=0,Ab[148]=Ab[22]=1,Pb[148]=Pb[22]=1,pb[148]=pb[22]=-1,fb[148]=fb[22]=0,db[148]=db[22]=1,mb[82]=mb[88]=0,gb[82]=gb[88]=-1,yb[82]=yb[88]=1,Eb[82]=Eb[88]=1,Cb[82]=Cb[88]=0,Mb[82]=Mb[88]=1,bb[82]=bb[88]=-1,wb[82]=wb[88]=0,Sb[82]=Sb[88]=1,Tb[82]=Tb[88]=0,Ab[82]=Ab[88]=-1,Pb[82]=Pb[88]=0,mb[73]=mb[97]=0,gb[73]=gb[97]=1,yb[73]=yb[97]=0,vb[73]=vb[97]=0,_b[73]=_b[97]=-1,xb[73]=xb[97]=0,bb[73]=bb[97]=1,wb[73]=wb[97]=0,Sb[73]=Sb[97]=0,lb[73]=lb[97]=1,cb[73]=cb[97]=0,hb[73]=hb[97]=1,mb[145]=mb[25]=0,gb[145]=gb[25]=-1,yb[145]=yb[25]=0,bb[145]=bb[25]=1,wb[145]=wb[25]=0,Sb[145]=Sb[25]=1,Lb[145]=Lb[25]=0,Ib[145]=Ib[25]=1,kb[145]=kb[25]=1,pb[145]=pb[25]=-1,fb[145]=fb[25]=0,db[145]=db[25]=0,vb[70]=vb[100]=0,_b[70]=_b[100]=1,xb[70]=xb[100]=0,Eb[70]=Eb[100]=-1,Cb[70]=Cb[100]=0,Mb[70]=Mb[100]=1,Tb[70]=Tb[100]=0,Ab[70]=Ab[100]=-1,Pb[70]=Pb[100]=1,lb[70]=lb[100]=1,cb[70]=cb[100]=0,hb[70]=hb[100]=0,vb[101]=vb[69]=0,_b[101]=_b[69]=1,xb[101]=xb[69]=0,lb[101]=lb[69]=1,cb[101]=cb[69]=0,hb[101]=hb[69]=0,Lb[149]=Lb[21]=0,Ib[149]=Ib[21]=1,kb[149]=kb[21]=1,pb[149]=pb[21]=-1,fb[149]=fb[21]=0,db[149]=db[21]=0,Eb[86]=Eb[84]=-1,Cb[86]=Cb[84]=0,Mb[86]=Mb[84]=1,Tb[86]=Tb[84]=0,Ab[86]=Ab[84]=-1,Pb[86]=Pb[84]=1,mb[89]=mb[81]=0,gb[89]=gb[81]=-1,yb[89]=yb[81]=0,bb[89]=bb[81]=1,wb[89]=wb[81]=0,Sb[89]=Sb[81]=1,mb[96]=mb[74]=0,gb[96]=gb[74]=1,yb[96]=yb[74]=0,vb[96]=vb[74]=-1,_b[96]=_b[74]=0,xb[96]=xb[74]=1,Tb[96]=Tb[74]=1,Ab[96]=Ab[74]=0,Pb[96]=Pb[74]=0,lb[96]=lb[74]=1,cb[96]=cb[74]=0,hb[96]=hb[74]=1,mb[24]=mb[146]=0,gb[24]=gb[146]=-1,yb[24]=yb[146]=1,Eb[24]=Eb[146]=1,Cb[24]=Cb[146]=0,Mb[24]=Mb[146]=1,bb[24]=bb[146]=0,wb[24]=wb[146]=1,Sb[24]=Sb[146]=1,pb[24]=pb[146]=0,fb[24]=fb[146]=-1,db[24]=db[146]=0,vb[6]=vb[164]=-1,_b[6]=_b[164]=0,xb[6]=xb[164]=1,Eb[6]=Eb[164]=-1,Cb[6]=Cb[164]=0,Mb[6]=Mb[164]=0,Lb[6]=Lb[164]=0,Ib[6]=Ib[164]=-1,kb[6]=kb[164]=1,Tb[6]=Tb[164]=1,Ab[6]=Ab[164]=0,Pb[6]=Pb[164]=0,bb[129]=bb[41]=0,wb[129]=wb[41]=1,Sb[129]=Sb[41]=1,Lb[129]=Lb[41]=0,Ib[129]=Ib[41]=1,kb[129]=kb[41]=0,lb[129]=lb[41]=-1,cb[129]=cb[41]=0,hb[129]=hb[41]=0,pb[129]=pb[41]=0,fb[129]=fb[41]=-1,db[129]=db[41]=0,Eb[66]=Eb[104]=0,Cb[66]=Cb[104]=1,Mb[66]=Mb[104]=0,bb[66]=bb[104]=-1,wb[66]=wb[104]=0,Sb[66]=Sb[104]=1,Tb[66]=Tb[104]=0,Ab[66]=Ab[104]=-1,Pb[66]=Pb[104]=0,lb[66]=lb[104]=0,cb[66]=cb[104]=-1,hb[66]=hb[104]=1,mb[144]=mb[26]=-1,gb[144]=gb[26]=0,yb[144]=yb[26]=0,Lb[144]=Lb[26]=1,Ib[144]=Ib[26]=0,kb[144]=kb[26]=1,Tb[144]=Tb[26]=0,Ab[144]=Ab[26]=1,Pb[144]=Pb[26]=1,pb[144]=pb[26]=-1,fb[144]=fb[26]=0,db[144]=db[26]=1,vb[36]=vb[134]=0,_b[36]=_b[134]=1,xb[36]=xb[134]=1,Eb[36]=Eb[134]=0,Cb[36]=Cb[134]=1,Mb[36]=Mb[134]=0,lb[36]=lb[134]=0,cb[36]=cb[134]=-1,hb[36]=hb[134]=1,pb[36]=pb[134]=1,fb[36]=fb[134]=0,db[36]=db[134]=0,mb[9]=mb[161]=-1,gb[9]=gb[161]=0,yb[9]=yb[161]=0,vb[9]=vb[161]=0,_b[9]=_b[161]=-1,xb[9]=xb[161]=0,bb[9]=bb[161]=1,wb[9]=wb[161]=0,Sb[9]=Sb[161]=0,Lb[9]=Lb[161]=1,Ib[9]=Ib[161]=0,kb[9]=kb[161]=1,mb[136]=0,gb[136]=1,yb[136]=1,vb[136]=0,_b[136]=1,xb[136]=0,Eb[136]=-1,Cb[136]=0,Mb[136]=1,bb[136]=-1,wb[136]=0,Sb[136]=0,Lb[136]=0,Ib[136]=-1,kb[136]=0,Tb[136]=0,Ab[136]=-1,Pb[136]=1,lb[136]=1,cb[136]=0,hb[136]=0,pb[136]=1,fb[136]=0,db[136]=1,mb[34]=0,gb[34]=-1,yb[34]=0,vb[34]=0,_b[34]=-1,xb[34]=1,Eb[34]=1,Cb[34]=0,Mb[34]=0,bb[34]=1,wb[34]=0,Sb[34]=1,Lb[34]=0,Ib[34]=1,kb[34]=1,Tb[34]=0,Ab[34]=1,Pb[34]=0,lb[34]=-1,cb[34]=0,hb[34]=1,pb[34]=-1,fb[34]=0,db[34]=0,mb[35]=0,gb[35]=1,yb[35]=1,vb[35]=0,_b[35]=-1,xb[35]=1,Eb[35]=1,Cb[35]=0,Mb[35]=0,bb[35]=-1,wb[35]=0,Sb[35]=0,Lb[35]=0,Ib[35]=-1,kb[35]=0,Tb[35]=0,Ab[35]=1,Pb[35]=0,lb[35]=-1,cb[35]=0,hb[35]=1,pb[35]=1,fb[35]=0,db[35]=1,mb[153]=0,gb[153]=1,yb[153]=1,bb[153]=-1,wb[153]=0,Sb[153]=0,Lb[153]=0,Ib[153]=-1,kb[153]=0,pb[153]=1,fb[153]=0,db[153]=1,vb[102]=0,_b[102]=-1,xb[102]=1,Eb[102]=1,Cb[102]=0,Mb[102]=0,Tb[102]=0,Ab[102]=1,Pb[102]=0,lb[102]=-1,cb[102]=0,hb[102]=1,mb[155]=0,gb[155]=-1,yb[155]=0,bb[155]=1,wb[155]=0,Sb[155]=1,Lb[155]=0,Ib[155]=1,kb[155]=1,pb[155]=-1,fb[155]=0,db[155]=0,vb[103]=0,_b[103]=1,xb[103]=0,Eb[103]=-1,Cb[103]=0,Mb[103]=1,Tb[103]=0,Ab[103]=-1,Pb[103]=1,lb[103]=1,cb[103]=0,hb[103]=0,mb[152]=0,gb[152]=1,yb[152]=1,Eb[152]=-1,Cb[152]=0,Mb[152]=1,bb[152]=-1,wb[152]=0,Sb[152]=0,Lb[152]=0,Ib[152]=-1,kb[152]=0,Tb[152]=0,Ab[152]=-1,Pb[152]=1,pb[152]=1,fb[152]=0,db[152]=1,mb[156]=0,gb[156]=-1,yb[156]=1,Eb[156]=1,Cb[156]=0,Mb[156]=1,bb[156]=-1,wb[156]=0,Sb[156]=0,Lb[156]=0,Ib[156]=-1,kb[156]=0,Tb[156]=0,Ab[156]=1,Pb[156]=1,pb[156]=-1,fb[156]=0,db[156]=1,mb[137]=0,gb[137]=1,yb[137]=1,vb[137]=0,_b[137]=1,xb[137]=0,bb[137]=-1,wb[137]=0,Sb[137]=0,Lb[137]=0,Ib[137]=-1,kb[137]=0,lb[137]=1,cb[137]=0,hb[137]=0,pb[137]=1,fb[137]=0,db[137]=1,mb[139]=0,gb[139]=1,yb[139]=1,vb[139]=0,_b[139]=-1,xb[139]=0,bb[139]=1,wb[139]=0,Sb[139]=0,Lb[139]=0,Ib[139]=1,kb[139]=0,lb[139]=-1,cb[139]=0,hb[139]=0,pb[139]=1,fb[139]=0,db[139]=1,mb[98]=0,gb[98]=-1,yb[98]=0,vb[98]=0,_b[98]=-1,xb[98]=1,Eb[98]=1,Cb[98]=0,Mb[98]=0,bb[98]=1,wb[98]=0,Sb[98]=1,Tb[98]=0,Ab[98]=1,Pb[98]=0,lb[98]=-1,cb[98]=0,hb[98]=1,mb[99]=0,gb[99]=1,yb[99]=0,vb[99]=0,_b[99]=-1,xb[99]=1,Eb[99]=1,Cb[99]=0,Mb[99]=0,bb[99]=-1,wb[99]=0,Sb[99]=1,Tb[99]=0,Ab[99]=-1,Pb[99]=0,lb[99]=1,cb[99]=0,hb[99]=1,vb[38]=0,_b[38]=-1,xb[38]=1,Eb[38]=1,Cb[38]=0,Mb[38]=0,Lb[38]=0,Ib[38]=1,kb[38]=1,Tb[38]=0,Ab[38]=1,Pb[38]=0,lb[38]=-1,cb[38]=0,hb[38]=1,pb[38]=-1,fb[38]=0,db[38]=0,vb[39]=0,_b[39]=1,xb[39]=1,Eb[39]=-1,Cb[39]=0,Mb[39]=0,Lb[39]=0,Ib[39]=-1,kb[39]=1,Tb[39]=0,Ab[39]=1,Pb[39]=0,lb[39]=-1,cb[39]=0,hb[39]=1,pb[39]=1,fb[39]=0,db[39]=0;var Ob=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Rb=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},Db=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},Nb=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},Fb=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},zb=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},Bb=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},jb=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Ub=[],Zb=[],Vb=[],Gb=[],Hb=[],Wb=[],qb=[],Xb=[];Gb[1]=Hb[1]=18,Gb[169]=Hb[169]=18,Vb[4]=Zb[4]=12,Vb[166]=Zb[166]=12,Ub[16]=Xb[16]=4,Ub[154]=Xb[154]=4,Wb[64]=qb[64]=22,Wb[106]=qb[106]=22,Vb[2]=Wb[2]=17,Gb[2]=Hb[2]=18,Vb[168]=Wb[168]=17,Gb[168]=Hb[168]=18,Ub[8]=Gb[8]=9,Zb[8]=Vb[8]=12,Ub[162]=Gb[162]=9,Zb[162]=Vb[162]=12,Ub[32]=Xb[32]=4,Zb[32]=qb[32]=1,Ub[138]=Xb[138]=4,Zb[138]=qb[138]=1,Hb[128]=Xb[128]=21,Wb[128]=qb[128]=22,Hb[42]=Xb[42]=21,Wb[42]=qb[42]=22,Zb[5]=Hb[5]=14,Zb[165]=Hb[165]=14,Vb[20]=Xb[20]=6,Vb[150]=Xb[150]=6,Ub[80]=Wb[80]=11,Ub[90]=Wb[90]=11,Gb[65]=qb[65]=3,Gb[105]=qb[105]=3,Ub[160]=Wb[160]=11,Zb[160]=Hb[160]=14,Ub[10]=Wb[10]=11,Zb[10]=Hb[10]=14,Vb[130]=Xb[130]=6,Gb[130]=qb[130]=3,Vb[40]=Xb[40]=6,Gb[40]=qb[40]=3,Zb[101]=qb[101]=1,Zb[69]=qb[69]=1,Hb[149]=Xb[149]=21,Hb[21]=Xb[21]=21,Vb[86]=Wb[86]=17,Vb[84]=Wb[84]=17,Ub[89]=Gb[89]=9,Ub[81]=Gb[81]=9,Ub[96]=qb[96]=0,Zb[96]=Wb[96]=15,Ub[74]=qb[74]=0,Zb[74]=Wb[74]=15,Ub[24]=Vb[24]=8,Gb[24]=Xb[24]=7,Ub[146]=Vb[146]=8,Gb[146]=Xb[146]=7,Zb[6]=Wb[6]=15,Vb[6]=Hb[6]=16,Zb[164]=Wb[164]=15,Vb[164]=Hb[164]=16,Gb[129]=Xb[129]=7,Hb[129]=qb[129]=20,Gb[41]=Xb[41]=7,Hb[41]=qb[41]=20,Vb[66]=qb[66]=2,Gb[66]=Wb[66]=19,Vb[104]=qb[104]=2,Gb[104]=Wb[104]=19,Ub[144]=Hb[144]=10,Wb[144]=Xb[144]=23,Ub[26]=Hb[26]=10,Wb[26]=Xb[26]=23,Zb[36]=Xb[36]=5,Vb[36]=qb[36]=2,Zb[134]=Xb[134]=5,Vb[134]=qb[134]=2,Ub[9]=Hb[9]=10,Zb[9]=Gb[9]=13,Ub[161]=Hb[161]=10,Zb[161]=Gb[161]=13,Zb[37]=Xb[37]=5,Hb[37]=qb[37]=20,Zb[133]=Xb[133]=5,Hb[133]=qb[133]=20,Vb[148]=Hb[148]=16,Wb[148]=Xb[148]=23,Vb[22]=Hb[22]=16,Wb[22]=Xb[22]=23,Ub[82]=Vb[82]=8,Gb[82]=Wb[82]=19,Ub[88]=Vb[88]=8,Gb[88]=Wb[88]=19,Ub[73]=qb[73]=0,Zb[73]=Gb[73]=13,Ub[97]=qb[97]=0,Zb[97]=Gb[97]=13,Ub[145]=Gb[145]=9,Hb[145]=Xb[145]=21,Ub[25]=Gb[25]=9,Hb[25]=Xb[25]=21,Zb[70]=qb[70]=1,Vb[70]=Wb[70]=17,Zb[100]=qb[100]=1,Vb[100]=Wb[100]=17,Ub[34]=Gb[34]=9,Zb[34]=Vb[34]=12,Hb[34]=Xb[34]=21,Wb[34]=qb[34]=22,Ub[136]=Xb[136]=4,Zb[136]=qb[136]=1,Vb[136]=Wb[136]=17,Gb[136]=Hb[136]=18,Ub[35]=Xb[35]=4,Zb[35]=Vb[35]=12,Gb[35]=Hb[35]=18,Wb[35]=qb[35]=22,Ub[153]=Xb[153]=4,Gb[153]=Hb[153]=18,Zb[102]=Vb[102]=12,Wb[102]=qb[102]=22,Ub[155]=Gb[155]=9,Hb[155]=Xb[155]=23,Zb[103]=qb[103]=1,Vb[103]=Wb[103]=17,Ub[152]=Xb[152]=4,Vb[152]=Wb[152]=17,Gb[152]=Hb[152]=18,Ub[156]=Vb[156]=8,Gb[156]=Hb[156]=18,Wb[156]=Xb[156]=23,Ub[137]=Xb[137]=4,Zb[137]=qb[137]=1,Gb[137]=Hb[137]=18,Ub[139]=Xb[139]=4,Zb[139]=Gb[139]=13,Hb[139]=qb[139]=20,Ub[98]=Gb[98]=9,Zb[98]=Vb[98]=12,Wb[98]=qb[98]=22,Ub[99]=qb[99]=0,Zb[99]=Vb[99]=12,Gb[99]=Wb[99]=19,Zb[38]=Vb[38]=12,Hb[38]=Xb[38]=21,Wb[38]=qb[38]=22,Zb[39]=Xb[39]=5,Vb[39]=Hb[39]=16,Wb[39]=qb[39]=22;var Yb=[];function Kb(t,e,n){var r=e[0]-t[0],i=e[1]-t[1],o=n[0]-e[0];return function(t){return(t>0)-(t<0)||+t}(r*(n[1]-e[1])-o*i)}function Qb(t,e){return e.geometry.coordinates[0].every((function(e){return $x((0,dy.xm)(e),t)}))}Yb[1]=Yb[169]=Ob,Yb[4]=Yb[166]=Rb,Yb[16]=Yb[154]=Db,Yb[64]=Yb[106]=Nb,Yb[168]=Yb[2]=Fb,Yb[162]=Yb[8]=zb,Yb[138]=Yb[32]=Bb,Yb[42]=Yb[128]=jb,Yb[5]=Yb[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},Yb[20]=Yb[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},Yb[80]=Yb[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},Yb[65]=Yb[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Yb[160]=Yb[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},Yb[130]=Yb[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},Yb[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},Yb[101]=Yb[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},Yb[149]=Yb[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},Yb[86]=Yb[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},Yb[89]=Yb[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},Yb[96]=Yb[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},Yb[24]=Yb[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},Yb[6]=Yb[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},Yb[129]=Yb[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},Yb[66]=Yb[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Yb[144]=Yb[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Yb[36]=Yb[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},Yb[9]=Yb[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Yb[37]=Yb[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Yb[148]=Yb[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Yb[82]=Yb[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},Yb[73]=Yb[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Yb[145]=Yb[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},Yb[70]=Yb[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Yb[34]=function(t){return[jb(t),zb(t)]},Yb[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Yb[136]=function(t){return[Bb(t),Fb(t)]},Yb[153]=function(t){return[Db(t),Ob(t)]},Yb[102]=function(t){return[Rb(t),Nb(t)]},Yb[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},Yb[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Yb[152]=function(t){return[Db(t),Fb(t)]},Yb[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Yb[137]=function(t){return[Bb(t),Ob(t)]},Yb[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Yb[98]=function(t){return[zb(t),Nb(t)]},Yb[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Yb[38]=function(t){return[Rb(t),jb(t)]},Yb[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]};var Jb=function(){function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return t.buildId=function(t){return t.join(",")},t.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter((function(e){return e.from.id!==t.from.id}))},t.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter((function(e){return e.to.id!==t.to.id}))},t.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},t.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort((function(e,n){var r=e.to,i=n.to;if(r.coordinates[0]-t.coordinates[0]>=0&&i.coordinates[0]-t.coordinates[0]<0)return 1;if(r.coordinates[0]-t.coordinates[0]<0&&i.coordinates[0]-t.coordinates[0]>=0)return-1;if(r.coordinates[0]-t.coordinates[0]==0&&i.coordinates[0]-t.coordinates[0]==0)return r.coordinates[1]-t.coordinates[1]>=0||i.coordinates[1]-t.coordinates[1]>=0?r.coordinates[1]-i.coordinates[1]:i.coordinates[1]-r.coordinates[1];var o=Kb(t.coordinates,r.coordinates,i.coordinates);return o<0?1:o>0?-1:Math.pow(r.coordinates[0]-t.coordinates[0],2)+Math.pow(r.coordinates[1]-t.coordinates[1],2)-(Math.pow(i.coordinates[0]-t.coordinates[0],2)+Math.pow(i.coordinates[1]-t.coordinates[1],2))})),this.outerEdgesSorted=!0)},t.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},t.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},t.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},t}();const $b=Jb;var tw=function(){function t(t,e){this.from=t,this.to=e,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return t.prototype.getSymetric=function(){return this.symetric||(this.symetric=new t(this.to,this.from),this.symetric.symetric=this),this.symetric},t.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},t.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},t.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},t.prototype.toLineString=function(){return(0,dy.Tu)([this.from.coordinates,this.to.coordinates])},t.prototype.compareTo=function(t){return Kb(t.from.coordinates,t.to.coordinates,this.to.coordinates)},t}();const ew=tw;var nw=function(){function t(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return t.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},t.prototype.get=function(t){return this.edges[t]},Object.defineProperty(t.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.edges.forEach(t)},t.prototype.map=function(t){return this.edges.map(t)},t.prototype.some=function(t){return this.edges.some(t)},t.prototype.isValid=function(){return!0},t.prototype.isHole=function(){var t=this,e=this.edges.reduce((function(e,n,r){return n.from.coordinates[1]>t.edges[e].from.coordinates[1]&&(e=r),e}),0),n=(0===e?this.length:e)-1,r=(e+1)%this.length,i=Kb(this.edges[n].from.coordinates,this.edges[e].from.coordinates,this.edges[r].from.coordinates);return 0===i?this.edges[n].from.coordinates[0]>this.edges[r].from.coordinates[0]:i>0},t.prototype.toMultiPoint=function(){return(0,dy.ot)(this.edges.map((function(t){return t.from.coordinates})))},t.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map((function(t){return t.from.coordinates}));return t.push(this.edges[0].from.coordinates),this.polygon=(0,dy.yu)([t])},t.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=(t=this.toPolygon(),(0,nb.Z)((0,Jx.Z)(t)));var t},t.findEdgeRingContaining=function(t,e){var n,r,i=t.getEnvelope();return e.forEach((function(e){var o,a,s,u,l,c,h=e.getEnvelope();if(r&&(n=r.getEnvelope()),a=i,s=(o=h).geometry.coordinates[0].map((function(t){return t[0]})),u=o.geometry.coordinates[0].map((function(t){return t[1]})),l=a.geometry.coordinates[0].map((function(t){return t[0]})),c=a.geometry.coordinates[0].map((function(t){return t[1]})),(Math.max.apply(null,s)!==Math.max.apply(null,l)||Math.max.apply(null,u)!==Math.max.apply(null,c)||Math.min.apply(null,s)!==Math.min.apply(null,l)||Math.min.apply(null,u)!==Math.min.apply(null,c))&&Qb(h,i)){for(var p=t.map((function(t){return t.from.coordinates})),f=void 0,d=function(t){e.some((function(e){return n=t,r=e.from.coordinates,n[0]===r[0]&&n[1]===r[1];var n,r}))||(f=t)},m=0,g=p;m<g.length;m++)d(g[m]);f&&e.inside((0,dy.xm)(f))&&(r&&!Qb(n,h)||(r=e))}})),r},t.prototype.inside=function(t){return $x(t,this.toPolygon())},t}();const rw=nw;function iw(t){for(var e=t,n=[];e.parent;)n.unshift(e),e=e.parent;return n}!function(){function t(){this.edges=[],this.nodes={}}t.fromGeoJson=function(e){!function(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(e);var n=new t;return(0,ev.nG)(e,(function(t){(0,tv.nK)(t,"LineString","Graph::fromGeoJson"),(0,ev.Lo)(t,(function(t,e){if(t){var r=n.getNode(t),i=n.getNode(e);n.addEdge(r,i)}return e}))})),n},t.prototype.getNode=function(t){var e=$b.buildId(t),n=this.nodes[e];return n||(n=this.nodes[e]=new $b(t)),n},t.prototype.addEdge=function(t,e){var n=new ew(t,e),r=n.getSymetric();this.edges.push(n),this.edges.push(r)},t.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map((function(e){return t.nodes[e]})).forEach((function(e){return t._removeIfDangle(e)}))},t.prototype._removeIfDangle=function(t){var e=this;if(t.innerEdges.length<=1){var n=t.getOuterEdges().map((function(t){return t.to}));this.removeNode(t),n.forEach((function(t){return e._removeIfDangle(t)}))}},t.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach((function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))}))},t.prototype._computeNextCWEdges=function(t){var e=this;void 0===t?Object.keys(this.nodes).forEach((function(t){return e._computeNextCWEdges(e.nodes[t])})):t.getOuterEdges().forEach((function(e,n){t.getOuterEdge((0===n?t.getOuterEdges().length:n)-1).symetric.next=e}))},t.prototype._computeNextCCWEdges=function(t,e){for(var n,r,i=t.getOuterEdges(),o=i.length-1;o>=0;--o){var a=i[o],s=a.symetric,u=void 0,l=void 0;a.label===e&&(u=a),s.label===e&&(l=s),u&&l&&(l&&(r=l),u&&(r&&(r.next=u,r=void 0),n||(n=u)))}r&&(r.next=n)},t.prototype._findLabeledEdgeRings=function(){var t=[],e=0;return this.edges.forEach((function(n){if(!(n.label>=0)){t.push(n);var r=n;do{r.label=e,r=r.next}while(!n.isEqual(r));e++}})),t},t.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach((function(t){t.label=void 0})),this._findLabeledEdgeRings().forEach((function(e){t._findIntersectionNodes(e).forEach((function(n){t._computeNextCCWEdges(n,e.label)}))}));var e=[];return this.edges.forEach((function(n){n.ring||e.push(t._findEdgeRing(n))})),e},t.prototype._findIntersectionNodes=function(t){var e=[],n=t,r=function(){var r=0;n.from.getOuterEdges().forEach((function(e){e.label===t.label&&++r})),r>1&&e.push(n.from),n=n.next};do{r()}while(!t.isEqual(n));return e},t.prototype._findEdgeRing=function(t){var e=t,n=new rw;do{n.push(e),e.ring=n,e=e.next}while(!t.isEqual(e));return n},t.prototype.removeNode=function(t){var e=this;t.getOuterEdges().forEach((function(t){return e.removeEdge(t)})),t.innerEdges.forEach((function(t){return e.removeEdge(t)})),delete this.nodes[t.id]},t.prototype.removeEdge=function(t){this.edges=this.edges.filter((function(e){return!e.isEqual(t)})),t.deleteEdge()}}(),s(2950),s(8788),s(2087);var ow={search:function(t,e,n,r){t.cleanDirty();var i=(r=r||{}).heuristic||ow.heuristics.manhattan,o=r.closest||!1,a=new uw((function(t){return t.f})),s=e;for(e.h=i(e,n),a.push(e);a.size()>0;){var u=a.pop();if(u===n)return iw(u);u.closed=!0;for(var l=t.neighbors(u),c=0,h=l.length;c<h;++c){var p=l[c];if(!p.closed&&!p.isWall()){var f=u.g+p.getCost(u),d=p.visited;(!d||f<p.g)&&(p.visited=!0,p.parent=u,p.h=p.h||i(p,n),p.g=f,p.f=p.g+p.h,t.markDirty(p),o&&(p.h<s.h||p.h===s.h&&p.g<s.g)&&(s=p),d?a.rescoreElement(p):a.push(p))}}}return o?iw(s):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var n=Math.sqrt(2),r=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return 1*(r+i)+(n-2)*Math.min(r,i)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};function aw(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var n=0;n<t.length;n++){this.grid[n]=[];for(var r=0,i=t[n];r<i.length;r++){var o=new sw(n,r,i[r]);this.grid[n][r]=o,this.nodes.push(o)}}this.init()}function sw(t,e,n){this.x=t,this.y=e,this.weight=n}function uw(t){this.content=[],this.scoreFunction=t}function lw(){this._=null}function cw(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function hw(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function pw(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function fw(t){for(;t.L;)t=t.L;return t}aw.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)ow.cleanNode(this.nodes[t])},aw.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)ow.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},aw.prototype.markDirty=function(t){this.dirtyNodes.push(t)},aw.prototype.neighbors=function(t){var e=[],n=t.x,r=t.y,i=this.grid;return i[n-1]&&i[n-1][r]&&e.push(i[n-1][r]),i[n+1]&&i[n+1][r]&&e.push(i[n+1][r]),i[n]&&i[n][r-1]&&e.push(i[n][r-1]),i[n]&&i[n][r+1]&&e.push(i[n][r+1]),this.diagonal&&(i[n-1]&&i[n-1][r-1]&&e.push(i[n-1][r-1]),i[n+1]&&i[n+1][r-1]&&e.push(i[n+1][r-1]),i[n-1]&&i[n-1][r+1]&&e.push(i[n-1][r+1]),i[n+1]&&i[n+1][r+1]&&e.push(i[n+1][r+1])),e},aw.prototype.toString=function(){for(var t,e,n,r,i=[],o=this.grid,a=0,s=o.length;a<s;a++){for(t=[],n=0,r=(e=o[a]).length;n<r;n++)t.push(e[n].weight);i.push(t.join(" "))}return i.join("\n")},sw.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},sw.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},sw.prototype.isWall=function(){return 0===this.weight},uw.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),n=this.content.pop();e!==this.content.length-1&&(this.content[e]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var n=(t+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}},bubbleUp:function(t){for(var e=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var i,o=t+1<<1,a=o-1,s=null;if(a<e){var u=this.content[a];(i=this.scoreFunction(u))<r&&(s=a)}if(o<e){var l=this.content[o];this.scoreFunction(l)<(null===s?r:i)&&(s=o)}if(null===s)break;this.content[t]=this.content[s],this.content[s]=n,t=s}}},lw.prototype={constructor:lw,insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=fw(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(hw(this,n),n=(t=n).U),n.C=!1,r.C=!0,pw(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(pw(this,n),n=(t=n).U),n.C=!1,r.C=!0,hw(this,r)),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,a=t.R;if(n=o?a?fw(a):o:a,i?i.L===t?i.L=n:i.R=n:this._=n,o&&a?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==a?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=a,a.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,hw(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,pw(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,hw(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,pw(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,hw(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,pw(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};const dw=lw;function mw(t,e,n,r){var i=[null,null],o=Bw.push(i)-1;return i.left=t,i.right=e,n&&yw(i,t,e,n),r&&yw(i,e,t,r),Fw[t.index].halfedges.push(o),Fw[e.index].halfedges.push(o),i}function gw(t,e,n){var r=[e,n];return r.left=t,r}function yw(t,e,n,r){t[0]||t[1]?t.left===n?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=n)}function vw(t,e,n,r,i){var o,a=t[0],s=t[1],u=a[0],l=a[1],c=0,h=1,p=s[0]-u,f=s[1]-l;if(o=e-u,p||!(o>0)){if(o/=p,p<0){if(o<c)return;o<h&&(h=o)}else if(p>0){if(o>h)return;o>c&&(c=o)}if(o=r-u,p||!(o<0)){if(o/=p,p<0){if(o>h)return;o>c&&(c=o)}else if(p>0){if(o<c)return;o<h&&(h=o)}if(o=n-l,f||!(o>0)){if(o/=f,f<0){if(o<c)return;o<h&&(h=o)}else if(f>0){if(o>h)return;o>c&&(c=o)}if(o=i-l,f||!(o<0)){if(o/=f,f<0){if(o>h)return;o>c&&(c=o)}else if(f>0){if(o<c)return;o<h&&(h=o)}return!(c>0||h<1)||(c>0&&(t[0]=[u+c*p,l+c*f]),h<1&&(t[1]=[u+h*p,l+h*f]),!0)}}}}}function _w(t,e,n,r,i){var o=t[1];if(o)return!0;var a,s,u=t[0],l=t.left,c=t.right,h=l[0],p=l[1],f=c[0],d=c[1],m=(h+f)/2,g=(p+d)/2;if(d===p){if(m<e||m>=r)return;if(h>f){if(u){if(u[1]>=i)return}else u=[m,n];o=[m,i]}else{if(u){if(u[1]<n)return}else u=[m,i];o=[m,n]}}else if(s=g-(a=(h-f)/(d-p))*m,a<-1||a>1)if(h>f){if(u){if(u[1]>=i)return}else u=[(n-s)/a,n];o=[(i-s)/a,i]}else{if(u){if(u[1]<n)return}else u=[(i-s)/a,i];o=[(n-s)/a,n]}else if(p<d){if(u){if(u[0]>=r)return}else u=[e,a*e+s];o=[r,a*r+s]}else{if(u){if(u[0]<e)return}else u=[r,a*r+s];o=[e,a*e+s]}return t[0]=u,t[1]=o,!0}function xw(t,e){var n=t.site,r=e.left,i=e.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=e[1],i=e[0]):(r=e[0],i=e[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function bw(t,e){return e[+(e.left!==t.site)]}function ww(t,e){return e[+(e.left===t.site)]}var Sw,Ew=[];function Cw(){cw(this),this.x=this.y=this.arc=this.site=this.cy=null}function Mw(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var a=i[0],s=i[1],u=r[0]-a,l=r[1]-s,c=o[0]-a,h=o[1]-s,p=2*(u*h-l*c);if(!(p>=-Uw)){var f=u*u+l*l,d=c*c+h*h,m=(h*f-l*d)/p,g=(u*d-c*f)/p,y=Ew.pop()||new Cw;y.arc=t,y.site=i,y.x=m+a,y.y=(y.cy=g+s)+Math.sqrt(m*m+g*g),t.circle=y;for(var v=null,_=zw._;_;)if(y.y<_.y||y.y===_.y&&y.x<=_.x){if(!_.L){v=_.P;break}_=_.L}else{if(!_.R){v=_;break}_=_.R}zw.insert(v,y),v||(Sw=y)}}}}function Tw(t){var e=t.circle;e&&(e.P||(Sw=e.N),zw.remove(e),Ew.push(e),cw(e),t.circle=null)}var Aw=[];function Pw(){cw(this),this.edge=this.site=this.circle=null}function Lw(t){var e=Aw.pop()||new Pw;return e.site=t,e}function Iw(t){Tw(t),Nw.remove(t),Aw.push(t),cw(t)}function kw(t){var e=t.circle,n=e.x,r=e.cy,i=[n,r],o=t.P,a=t.N,s=[t];Iw(t);for(var u=o;u.circle&&Math.abs(n-u.circle.x)<jw&&Math.abs(r-u.circle.cy)<jw;)o=u.P,s.unshift(u),Iw(u),u=o;s.unshift(u),Tw(u);for(var l=a;l.circle&&Math.abs(n-l.circle.x)<jw&&Math.abs(r-l.circle.cy)<jw;)a=l.N,s.push(l),Iw(l),l=a;s.push(l),Tw(l);var c,h=s.length;for(c=1;c<h;++c)l=s[c],u=s[c-1],yw(l.edge,u.site,l.site,i);u=s[0],(l=s[h-1]).edge=mw(u.site,l.site,null,i),Mw(u),Mw(l)}function Ow(t){for(var e,n,r,i,o=t[0],a=t[1],s=Nw._;s;)if((r=Rw(s,a)-o)>jw)s=s.L;else{if(!((i=o-Dw(s,a))>jw)){r>-jw?(e=s.P,n=s):i>-jw?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}!function(t){Fw[t.index]={site:t,halfedges:[]}}(t);var u=Lw(t);if(Nw.insert(e,u),e||n){if(e===n)return Tw(e),n=Lw(e.site),Nw.insert(u,n),u.edge=n.edge=mw(e.site,u.site),Mw(e),void Mw(n);if(n){Tw(e),Tw(n);var l=e.site,c=l[0],h=l[1],p=t[0]-c,f=t[1]-h,d=n.site,m=d[0]-c,g=d[1]-h,y=2*(p*g-f*m),v=p*p+f*f,_=m*m+g*g,x=[(g*v-f*_)/y+c,(p*_-m*v)/y+h];yw(n.edge,l,d,x),u.edge=mw(l,t,null,x),n.edge=mw(t,d,null,x),Mw(e),Mw(n)}else u.edge=mw(e.site,u.site)}}function Rw(t,e){var n=t.site,r=n[0],i=n[1],o=i-e;if(!o)return r;var a=t.P;if(!a)return-1/0;var s=(n=a.site)[0],u=n[1],l=u-e;if(!l)return s;var c=s-r,h=1/o-1/l,p=c/l;return h?(-p+Math.sqrt(p*p-2*h*(c*c/(-2*l)-u+l/2+i-o/2)))/h+r:(r+s)/2}function Dw(t,e){var n=t.N;if(n)return Rw(n,e);var r=t.site;return r[1]===e?r[0]:1/0}var Nw,Fw,zw,Bw,jw=1e-6,Uw=1e-12;function Zw(t,e,n){return(t[0]-n[0])*(e[1]-t[1])-(t[0]-e[0])*(n[1]-t[1])}function Vw(t,e){return e[1]-t[1]||e[0]-t[0]}function Gw(t,e){var n,r,i,o=t.sort(Vw).pop();for(Bw=[],Fw=new Array(t.length),Nw=new dw,zw=new dw;;)if(i=Sw,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===n&&o[1]===r||(Ow(o),n=o[0],r=o[1]),o=t.pop();else{if(!i)break;kw(i.arc)}if(function(){for(var t,e,n,r,i=0,o=Fw.length;i<o;++i)if((t=Fw[i])&&(r=(e=t.halfedges).length)){var a=new Array(r),s=new Array(r);for(n=0;n<r;++n)a[n]=n,s[n]=xw(t,Bw[e[n]]);for(a.sort((function(t,e){return s[e]-s[t]})),n=0;n<r;++n)s[n]=e[a[n]];for(n=0;n<r;++n)e[n]=s[n]}}(),e){var a=+e[0][0],s=+e[0][1],u=+e[1][0],l=+e[1][1];!function(t,e,n,r){for(var i,o=Bw.length;o--;)_w(i=Bw[o],t,e,n,r)&&vw(i,t,e,n,r)&&(Math.abs(i[0][0]-i[1][0])>jw||Math.abs(i[0][1]-i[1][1])>jw)||delete Bw[o]}(a,s,u,l),function(t,e,n,r){var i,o,a,s,u,l,c,h,p,f,d,m,g=Fw.length,y=!0;for(i=0;i<g;++i)if(o=Fw[i]){for(a=o.site,s=(u=o.halfedges).length;s--;)Bw[u[s]]||u.splice(s,1);for(s=0,l=u.length;s<l;)d=(f=ww(o,Bw[u[s]]))[0],m=f[1],h=(c=bw(o,Bw[u[++s%l]]))[0],p=c[1],(Math.abs(d-h)>jw||Math.abs(m-p)>jw)&&(u.splice(s,0,Bw.push(gw(a,f,Math.abs(d-t)<jw&&r-m>jw?[t,Math.abs(h-t)<jw?p:r]:Math.abs(m-r)<jw&&n-d>jw?[Math.abs(p-r)<jw?h:n,r]:Math.abs(d-n)<jw&&m-e>jw?[n,Math.abs(h-n)<jw?p:e]:Math.abs(m-e)<jw&&d-t>jw?[Math.abs(p-e)<jw?h:t,e]:null))-1),++l);l&&(y=!1)}if(y){var v,_,x,b=1/0;for(i=0,y=null;i<g;++i)(o=Fw[i])&&(x=(v=(a=o.site)[0]-t)*v+(_=a[1]-e)*_)<b&&(b=x,y=o);if(y){var w=[t,e],S=[t,r],E=[n,r],C=[n,e];y.halfedges.push(Bw.push(gw(a=y.site,w,S))-1,Bw.push(gw(a,S,E))-1,Bw.push(gw(a,E,C))-1,Bw.push(gw(a,C,w))-1)}}for(i=0;i<g;++i)(o=Fw[i])&&(o.halfedges.length||delete Fw[i])}(a,s,u,l)}this.edges=Bw,this.cells=Fw,Nw=zw=Bw=Fw=null}function Hw(){return new Ww}function Ww(){this.reset()}Gw.prototype={constructor:Gw,polygons:function(){var t=this.edges;return this.cells.map((function(e){var n=e.halfedges.map((function(n){return bw(e,t[n])}));return n.data=e.site.data,n}))},triangles:function(){var t=[],e=this.edges;return this.cells.forEach((function(n,r){if(o=(i=n.halfedges).length)for(var i,o,a,s=n.site,u=-1,l=e[i[o-1]],c=l.left===s?l.right:l.left;++u<o;)a=c,c=(l=e[i[u]]).left===s?l.right:l.left,a&&c&&r<a.index&&r<c.index&&Zw(s,a,c)<0&&t.push([s.data,a.data,c.data])})),t},links:function(){return this.edges.filter((function(t){return t.right})).map((function(t){return{source:t.left.data,target:t.right.data}}))},find:function(t,e,n){for(var r,i,o=this,a=o._found||0,s=o.cells.length;!(i=o.cells[a]);)if(++a>=s)return null;var u=t-i.site[0],l=e-i.site[1],c=u*u+l*l;do{i=o.cells[r=a],a=null,i.halfedges.forEach((function(n){var r=o.edges[n],s=r.left;if(s!==i.site&&s||(s=r.right)){var u=t-s[0],l=e-s[1],h=u*u+l*l;h<c&&(c=h,a=s.index)}}))}while(null!==a);return o._found=r,null==n||c<=n*n?i.site:null}},s(7516),s(9055),Ww.prototype={constructor:Ww,reset:function(){this.s=this.t=0},add:function(t){Xw(qw,t,this.t),Xw(this,qw.s,this.s),this.s?this.t+=qw.t:this.s=qw.t},valueOf:function(){return this.s}};var qw=new Ww;function Xw(t,e,n){var r=t.s=e+n,i=r-e,o=r-i;t.t=e-o+(n-i)}var Yw=Math.PI,Kw=Yw/2,Qw=2*Yw,Jw=Yw/180,$w=(Math.abs,Math.atan),tS=Math.atan2,eS=Math.cos,nS=(Math.ceil,Math.exp,Math.floor,Math.log,Math.pow,Math.sin),rS=(Math.sign,Math.sqrt);Math.tan;function iS(t){return t>1?Kw:t<-1?-Kw:Math.asin(t)}function oS(t,e){return[t>Yw?t-Qw:t<-Yw?t+Qw:t,e]}Hw(),Hw(),Hw(),oS.invert=oS;s(937),Hw();function aS(){}function sS(t){return function(e,n){var r=eS(e),i=eS(n),o=t(r*i);return[o*i*nS(e),o*nS(n)]}}function uS(t){return function(e,n){var r=rS(e*e+n*n),i=t(r),o=nS(i),a=eS(i);return[tS(e*o,r*a),iS(r&&n*o/r)]}}Hw(),Hw(),Hw(),Hw(),aS.prototype={constructor:aS,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},eS(30*Jw),sS((function(t){return rS(2/(1+t))})).invert=uS((function(t){return 2*iS(t/2)}));var lS=sS((function(t){return(t=function(t){return t>1?0:t<-1?Yw:Math.acos(t)}(t))&&t/nS(t)}));function cS(t,e){return[t,e]}lS.invert=uS((function(t){return t})),cS.invert=cS,uS($w),uS(iS),uS((function(t){return 2*$w(t)})),s(9349);var hS=s(2721);const{Search:pS}=hS.Input,fS=t=>{const{data:n}=t;return e.createElement("div",{className:"gi-properties-pannel"},e.createElement("h3",null,n.id),e.createElement(pS,{placeholder:"Search in the properties",onSearch:()=>{},style:{width:"100%"}}),e.createElement("ul",null,Object.keys(n).map((t=>{let r=n[t],i=!1;return"object"==typeof r&&(r=JSON.stringify(r,null,2),i=!0),e.createElement("li",{key:t},e.createElement("div",{className:"key"},t),e.createElement("div",{className:"value"},i?e.createElement("pre",null,r):r))}))))};var dS=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))};const mS=e=>{const{mapInstance:r,geoData:i,updateState:o}=e,{config:a,services:s}=(0,t.useContext)(),u=n().useMemo((()=>{try{return a.components.find((t=>"PropertiesPanel"===t.id)).props.serviceId}catch(t){return}}),[a]);if(!u)return null;const l=t.utils.getService(s,u);if(!l)return null;const[c,h]=n().useState({visible:!1,detail:null,isLoading:!1});n().useLayoutEffect((()=>{const t=t=>dS(void 0,void 0,void 0,(function*(){h((t=>Object.assign(Object.assign({},t),{visible:!0,isLoading:!0})));const e=t.feature,n=yield l(e);h((t=>Object.assign(Object.assign({},t),{detail:n,isLoading:!1})))})),e=t=>dS(void 0,void 0,void 0,(function*(){h((t=>Object.assign(Object.assign({},t),{visible:!0,isLoading:!0})));const e=t.feature,n=yield l(e);h((t=>Object.assign(Object.assign({},t),{detail:n,isLoading:!1})))}));if(!r)return;const n=r.layerGroup.getLayerByName("node"),i=r.layerGroup.getLayerByName("edge");return n&&i&&(n.on("click",t),i.on("click",e)),()=>{n&&i&&(n.off("click",t),i.off("click",e))}}),[i]);const{visible:p,detail:f,isLoading:d}=c,m=!d&&f?n().createElement(fS,{data:f}):n().createElement(hS.Skeleton,{active:!0});return n().createElement(hS.Drawer,{visible:p,placement:"right",onClose:()=>{h((t=>t.visible?{visible:!1,isLoading:!1,detail:null}:t))},title:"属性面板",width:"356px",style:{marginTop:"61px"},mask:!1,bodyStyle:{padding:"12px 24px"}},m)},{GIAComponent:gS,deepClone:yS}=t.extra,vS=t=>{const{GIAC:n,config:r,handleBrush:i,handleSwitchMap:o,handleToggleMap:a}=t,s=e.useMemo((()=>{const t=yS(n);return t.icon="icon-highlight",t.title="圈选",t.tooltipPlacement="right",t}),[n]),u=e.useMemo((()=>{const t=yS(n);return t.icon="icon-location",t.title="返回网图模式",t.tooltipPlacement="right",t}),[n]),l=e.useMemo((()=>{const t=yS(n);return t.icon="icon-fullscreen",t.title="小窗",t.tooltipPlacement="right",t}),[n]),{direction:c,positionStyles:h}=$g(r);return e.createElement("div",null,e.createElement(Jg,{direction:c,style:h},e.createElement(gS,{GIAC:u,onClick:o}),e.createElement(gS,{GIAC:l,onClick:a}),e.createElement(gS,{GIAC:s,onClick:i})))},{deepClone:_S}=t.extra,xS=n=>{const{theme:r,type:i,maxSize:o,minSize:a,placement:s,offset:u,longitudeKey:l,latitudeKey:c}=n,h=(0,t.useContext)(),{data:p,graph:f,config:d,GISDK_ID:m,apis:g}=h,{color:y}=d.nodes&&d.nodes[0].props||{},[v,_]=e.useState({isReady:!1,mapInstance:void 0,toggle:!1,drawbox:void 0}),{handleClick:x,GIAC:b}=n,w=e.useMemo((()=>p.nodes.filter((t=>{const e=t.data;return!(!e[l]||!e[c])})).map((t=>{const e=t.data;let n=e[l],r=e[c];if("string"==typeof n||"string"==typeof r)try{n=Number(JSON.parse(n)),r=Number(JSON.parse(r))}catch(t){console.log("error",t)}return Object.assign(Object.assign({},t),{location:[n,r]})}))),[p]),S=e.useMemo((()=>f.getEdges().filter((t=>{t.get("model");const e=t.get("source").get("model"),n=t.get("target").get("model");return!!(e.data[l]&&e.data[c]&&n.data[l]&&n.data[c])})).map((t=>{const e=t.get("model"),n=t.get("source").get("model"),r=t.get("target").get("model");let i=n.data[l],o=n.data[c],a=r.data[l],s=r.data[c];if("string"==typeof i||"string"==typeof o||"string"==typeof a||"string"==typeof s)try{i=Number(JSON.parse(i)),o=Number(JSON.parse(o)),a=Number(JSON.parse(a)),s=Number(JSON.parse(s))}catch(t){console.log("error",t)}return Object.assign(Object.assign({},e),{lnglat:[[i,o],[a,s]]})}))),[p]);if(0===w.length)return console.warn("%c invalid data","color:red","nodes has no longitude or latitude field"),null;console.log(w,S),e.useEffect((()=>{const t=w[0].location,e=0!==S.length,n={map:{type:i,style:r,center:t,zoom:15,pitch:0},layers:[...e?[{name:"edge",type:"pathLayer",source:{data:S,parser:{type:"json",coordinates:"lnglat"}},color:"#ddd",size:1,style:{opacity:1}}]:[],{name:"node",type:"dotLayer",shape:"circle",source:{data:w,parser:{type:"json",coordinates:"location"}},color:{field:"type",value:({type:t})=>y},state:{select:{color:"red",size:20}},size:10,style:{opacity:.8}},{name:"text",type:"textLayer",shape:"text",field:"id",source:{data:w,parser:{type:"json",coordinates:"location"}},style:{fontSize:20,fill:"#000",textAnchor:"bottom",textOffset:[0,-20]}}]},o=new Qx.L7Plot("map-container",n);return o.on("loaded",(()=>{const t=o.getScene(),e=new Kx(t);e.on("draw.boxselect",(t=>{const{endPoint:e,startPoint:n}=t,r=nb.Z([n.lng,n.lat,e.lng,e.lat]),i=w.filter((t=>$x(dy.xm(t.location),r)));_((t=>Object.assign(Object.assign({},t),{toggle:!0}))),setTimeout((()=>{const t=i.map((t=>t.id));g.focusNodeById(t[0]||""),p.nodes.forEach((e=>{t.includes(e.id)?f.setItemState(e.id,"selected",!0):f.setItemState(e.id,"inactive",!0)})),p.edges.forEach((e=>{const{source:n,target:r}=e;t.includes(n)&&t.includes(r)?f.setItemState(e.id,"selected",!0):f.setItemState(e.id,"inactive",!0)}))}),0)})),_((t=>Object.assign(Object.assign({},t),{isReady:!0,mapInstance:o,drawbox:e})))})),()=>{o.destroy()}}),[i,r]);const{isReady:E,mapInstance:C,toggle:M}=v,T=e.createElement(Kg,{toggle:M,maxSize:o,minSize:a,offset:u,placement:s},e.createElement("div",{id:"map-container",style:{position:"absolute",left:"0px",right:"0px",bottom:"0px",top:"0px"}},e.createElement("div",{style:{position:"absolute",left:"0px",top:"0px",zIndex:9999}},e.createElement(vS,{config:d,GIAC:b,handleBrush:()=>{const{drawbox:t}=v;t&&t.enable()},handleSwitchMap:x,handleToggleMap:()=>{_((t=>Object.assign(Object.assign({},t),{toggle:!t.toggle})))}}),E&&e.createElement(mS,{mapInstance:C,geoData:w,updateState:_})))),A=document.getElementById(`${m}-graphin-container`);return e.createElement("div",null,sf().createPortal(T,A))},{GIAComponent:bS}=t.extra,wS={id:"MapMode",name:"地图模式",desc:"将节点的地理坐标映射到地图上",icon:"icon-global",cover:"http://xxxx.jpg",category:"scene-analysis",type:"GIAC"},{GIAC_METAS:SS,deepClone:ES}=t.extra,CS=ES(SS);CS.GIAC.properties.GIAC.properties.title.default=wS.name,CS.GIAC.properties.GIAC.properties.isShowTitle.default=!1,CS.GIAC.properties.GIAC.properties.icon.default=wS.icon,CS.GIAC.properties.GIAC.properties.isVertical.default=!0,CS.GIAC.properties.GIAC.properties.tooltipPlacement.default="right";const MS={MapMode:{info:wS,component:t=>{const n=Object.assign({},t.GIAC),{visible:r,theme:i,type:o,minSize:a,maxSize:s,placement:u,offset:l,latitudeKey:c,longitudeKey:h}=t,[p,f]=e.useState(r);return n.title=p?"切换至网图":"切换至地图",e.createElement("div",null,e.createElement(bS,{GIAC:n,onClick:()=>{f(!0)}}),p&&e.createElement(xS,{latitudeKey:c,longitudeKey:h,minSize:a,maxSize:s,placement:u,offset:l,theme:i,type:o,GIAC:n,handleClick:()=>{f(!1)}}))},registerMeta:t=>{const{keys:e}=t,n=e.map((t=>({label:t,value:t})));return Object.assign({visible:{title:"默认显示",type:"string","x-decorator":"FormItem","x-component":"Switch",default:!1},type:{type:"string",title:"地图类型","x-decorator":"FormItem","x-component":"Select","x-component-props":{options:[{label:"高德",value:"amap"},{label:"MapBox",value:"mapbox"}]},default:"amap"},theme:{type:"string",title:"主题","x-decorator":"FormItem","x-component":"Select","x-component-props":{options:[{label:"明亮",value:"light"},{label:"黑暗",value:"dark"}]},default:"light"},minSize:{type:"string",title:"最小尺寸","x-decorator":"FormItem","x-component":"Input",default:"20%"},maxSize:{type:"string",title:"最大尺寸","x-decorator":"FormItem","x-component":"Input",default:"100%"},placement:{title:"放置方位",type:"string",default:"RB","x-decorator":"FormItem","x-component":"Select","x-component-props":{options:[{value:"LT",label:"左上 / top"},{value:"RT",label:"右上 / right"},{value:"LB",label:"左下 / left"},{value:"RB",label:"右下 / bottom"}]}},offset:{title:"偏移距离",type:"string","x-decorator":"FormItem","x-component":"Offset","x-component-props":{min:0,max:400},default:[0,0]},longitudeKey:{type:"string",title:"经度字段","x-decorator":"FormItem","x-component":"Select","x-component-props":{options:n},default:"longitude"},latitudeKey:{type:"string",title:"纬度字段","x-decorator":"FormItem","x-component":"Select","x-component-props":{options:n},default:"latitude"}},CS)}},LargeGraph:cy}})(),u})()));